<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>08-2Solidityç¬”è®°ä¹‹äºŒ</title>
    <link href="/2025/04/28/08-2Solidity%E7%AC%94%E8%AE%B0%E4%B9%8B%E4%BA%8C/"/>
    <url>/2025/04/28/08-2Solidity%E7%AC%94%E8%AE%B0%E4%B9%8B%E4%BA%8C/</url>
    
    <content type="html"><![CDATA[<h1 id="10-æ§åˆ¶æµï¼Œç”¨Solidityå®ç°æ’å…¥æ’åº"><a href="#10-æ§åˆ¶æµï¼Œç”¨Solidityå®ç°æ’å…¥æ’åº" class="headerlink" title="10. æ§åˆ¶æµï¼Œç”¨Solidityå®ç°æ’å…¥æ’åº"></a>10. æ§åˆ¶æµï¼Œç”¨Solidityå®ç°æ’å…¥æ’åº</h1><h2 id="æ§åˆ¶æµ"><a href="#æ§åˆ¶æµ" class="headerlink" title="æ§åˆ¶æµ"></a>æ§åˆ¶æµ</h2><p><code>solidity</code>çš„å‡ ç§æ§åˆ¶æµ</p><ol><li>if-else</li><li>forå¾ªç¯</li><li>whileå¾ªç¯</li><li>do-whileå¾ªç¯</li></ol>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Solidityç¬”è®°ä¹‹åŸºç¡€å˜é‡</title>
    <link href="/2025/04/22/08-1Solidity%E7%AC%94%E8%AE%B0/"/>
    <url>/2025/04/22/08-1Solidity%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="Solidityä¸­çš„å˜é‡ç±»å‹"><a href="#Solidityä¸­çš„å˜é‡ç±»å‹" class="headerlink" title="Solidityä¸­çš„å˜é‡ç±»å‹"></a>Solidityä¸­çš„å˜é‡ç±»å‹</h1><ol><li>**å€¼ç±»å‹(Value Type)**ï¼šåŒ…æ‹¬å¸ƒå°”å‹ï¼Œæ•´æ•°å‹ç­‰ç­‰ï¼Œè¿™ç±»å˜é‡èµ‹å€¼æ—¶å€™ç›´æ¥ä¼ é€’æ•°å€¼ã€‚</li><li>**å¼•ç”¨ç±»å‹(Reference Type)**ï¼šåŒ…æ‹¬æ•°ç»„å’Œç»“æ„ä½“ï¼Œè¿™ç±»å˜é‡å ç©ºé—´å¤§ï¼Œèµ‹å€¼æ—¶å€™ç›´æ¥ä¼ é€’åœ°å€ï¼ˆç±»ä¼¼æŒ‡é’ˆï¼‰ã€‚</li><li><strong>æ˜ å°„ç±»å‹(Mapping Type)</strong>: Solidityä¸­å­˜å‚¨é”®å€¼å¯¹çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥ç†è§£ä¸ºå“ˆå¸Œè¡¨</li></ol><p>æˆ‘ä»¬å°†ä»…ä»‹ç»å¸¸ç”¨ç±»å‹ï¼Œä¸å¸¸ç”¨çš„ç±»å‹ä¸ä¼šæ¶‰åŠï¼Œæœ¬ç¯‡å°†ä»‹ç»å€¼ç±»å‹ã€‚</p><h1 id="2-å€¼ç±»å‹"><a href="#2-å€¼ç±»å‹" class="headerlink" title="2. å€¼ç±»å‹"></a>2. å€¼ç±»å‹</h1><h3 id="1-å¸ƒå°”å‹"><a href="#1-å¸ƒå°”å‹" class="headerlink" title="1. å¸ƒå°”å‹"></a>1. å¸ƒå°”å‹</h3><p>å¸ƒå°”å‹æ˜¯äºŒå€¼å˜é‡ï¼Œå–å€¼ä¸º <code>true</code> æˆ– <code>false</code>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs solidity">// å¸ƒå°”å€¼<br>bool public _bool = true; <br>//ç±»å‹ å…¬æœ‰ å€¼åç§°=å€¼<br></code></pre></td></tr></table></figure><p>å¸ƒå°”å€¼çš„è¿ç®—ç¬¦åŒ…æ‹¬ï¼š</p><ul><li><code>!</code> ï¼ˆé€»è¾‘éï¼‰</li><li><code>&amp;&amp;</code> ï¼ˆé€»è¾‘ä¸ï¼Œâ€andâ€ï¼‰</li><li><code>||</code> ï¼ˆé€»è¾‘æˆ–ï¼Œâ€orâ€ï¼‰</li><li><code>==</code> ï¼ˆç­‰äºï¼‰</li><li><code>!=</code> ï¼ˆä¸ç­‰äºï¼‰</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs solidity">// å¸ƒå°”è¿ç®—<br>bool public _bool1 = !_bool; // å–é<br>bool public _bool2 = _bool &amp;&amp; _bool1; // ä¸<br>bool public _bool3 = _bool || _bool1; // æˆ–<br>bool public _bool4 = _bool == _bool1; // ç›¸ç­‰<br>bool public _bool5 = _bool != _bool1; // ä¸ç›¸ç­‰<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼šå˜é‡ <code>_bool</code> çš„å–å€¼æ˜¯ <code>true</code>ï¼›<code>_bool1</code> æ˜¯ <code>_bool</code> çš„éï¼Œä¸º <code>false</code>ï¼›<code>_bool &amp;&amp; _bool1</code> ä¸º <code>false</code>ï¼›<code>_bool || _bool1</code> ä¸º <code>true</code>ï¼›<code>_bool == _bool1</code> ä¸º <code>false</code>ï¼›<code>_bool != _bool1</code> ä¸º <code>true</code>ã€‚</p><p><strong>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼š</strong><code>&amp;&amp;</code> å’Œ <code>||</code> è¿ç®—ç¬¦éµå¾ªçŸ­è·¯è§„åˆ™ï¼Œè¿™æ„å‘³ç€ï¼Œå‡å¦‚å­˜åœ¨ <code>f(x) || g(y)</code> çš„è¡¨è¾¾å¼ï¼Œå¦‚æœ <code>f(x)</code> æ˜¯ <code>true</code>ï¼Œ<code>g(y)</code> ä¸ä¼šè¢«è®¡ç®—ï¼Œå³ä½¿å®ƒå’Œ <code>f(x)</code> çš„ç»“æœæ˜¯ç›¸åçš„ã€‚å‡å¦‚å­˜åœ¨<code>f(x) &amp;&amp; g(y)</code> çš„è¡¨è¾¾å¼ï¼Œå¦‚æœ <code>f(x)</code> æ˜¯ <code>false</code>ï¼Œ<code>g(y)</code> ä¸ä¼šè¢«è®¡ç®—ã€‚ æ‰€è°“â€œçŸ­è·¯è§„åˆ™â€ï¼Œä¸€èˆ¬å‡ºç°åœ¨é€»è¾‘ä¸ï¼ˆ&amp;&amp;ï¼‰å’Œé€»è¾‘æˆ–ï¼ˆ||ï¼‰ä¸­ã€‚ å½“é€»è¾‘ä¸ï¼ˆ&amp;&amp;ï¼‰çš„ç¬¬ä¸€ä¸ªæ¡ä»¶ä¸ºfalseæ—¶ï¼Œå°±ä¸ä¼šå†å»åˆ¤æ–­ç¬¬äºŒä¸ªæ¡ä»¶ï¼› å½“é€»è¾‘æˆ–ï¼ˆ||ï¼‰çš„ç¬¬ä¸€ä¸ªæ¡ä»¶ä¸ºtrueæ—¶ï¼Œå°±ä¸ä¼šå†å»åˆ¤æ–­ç¬¬äºŒä¸ªæ¡ä»¶ï¼Œè¿™å°±æ˜¯çŸ­è·¯è§„åˆ™ã€‚</p><h3 id="2-æ•´å‹"><a href="#2-æ•´å‹" class="headerlink" title="2. æ•´å‹"></a>2. æ•´å‹</h3><p>æ•´å‹æ˜¯ Solidity ä¸­çš„æ•´æ•°ï¼Œæœ€å¸¸ç”¨çš„åŒ…æ‹¬ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs solidity">// æ•´å‹<br>int public _int = -1; // æ•´æ•°ï¼ŒåŒ…æ‹¬è´Ÿæ•°<br>uint public _uint = 1; // æ— ç¬¦å·æ•´æ•°<br>uint256 public _number = 20220330; // 256ä½æ— ç¬¦å·æ•´æ•°<br></code></pre></td></tr></table></figure><p>å¸¸ç”¨çš„æ•´å‹è¿ç®—ç¬¦åŒ…æ‹¬ï¼š</p><ul><li>æ¯”è¾ƒè¿ç®—ç¬¦ï¼ˆè¿”å›å¸ƒå°”å€¼ï¼‰ï¼š <code>&lt;=</code>ï¼Œ <code>&lt;</code>ï¼Œ<code>==</code>ï¼Œ <code>!=</code>ï¼Œ <code>&gt;=</code>ï¼Œ <code>&gt;</code></li><li>ç®—æœ¯è¿ç®—ç¬¦ï¼š <code>+</code>ï¼Œ <code>-</code>ï¼Œ <code>*</code>ï¼Œ <code>/</code>ï¼Œ <code>%</code>ï¼ˆå–ä½™ï¼‰ï¼Œ<code>**</code>ï¼ˆå¹‚ï¼‰</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs solidity">// æ•´æ•°è¿ç®—<br>uint256 public _number1 = _number + 1; // +ï¼Œ-ï¼Œ*ï¼Œ/<br>uint256 public _number2 = 2**2; // æŒ‡æ•°<br>uint256 public _number3 = 7 % 2; // å–ä½™æ•°<br>bool public _numberbool = _number2 &gt; _number3; // æ¯”å¤§å°<br></code></pre></td></tr></table></figure><p>å¤§å®¶å¯ä»¥è¿è¡Œä¸€ä¸‹ä»£ç ï¼Œçœ‹çœ‹è¿™ 4 ä¸ªå˜é‡åˆ†åˆ«æ˜¯å¤šå°‘ã€‚</p><h3 id="3-åœ°å€ç±»å‹"><a href="#3-åœ°å€ç±»å‹" class="headerlink" title="3. åœ°å€ç±»å‹"></a>3. åœ°å€ç±»å‹</h3><p>åœ°å€ç±»å‹æœ‰ä¸¤ç±»ï¼š</p><ul><li>æ™®é€šåœ°å€: å­˜å‚¨ä¸€ä¸ª 20 å­—èŠ‚çš„å€¼ï¼ˆä»¥å¤ªåŠåœ°å€çš„å¤§å°ï¼‰ã€‚</li><li>Payable address ï¼šæ¯”æ™®é€šåœ°å€å¤šäº†<code>transfer</code>å’Œ<code>send</code>ä¸¤ä¸ªæˆå‘˜æ–¹æ³•ï¼Œç”¨äºæ¥æ”¶è½¬è´¦ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs solidity">// åœ°å€<br>address public _address = 0x7A58c0Be72BE218B41C608b7Fe7C5bB630736C71;<br>address payable public _address1 = payable(_address); // payable addressï¼Œå¯ä»¥è½¬è´¦ã€æŸ¥ä½™é¢<br>// åœ°å€ç±»å‹çš„æˆå‘˜<br>uint256 public balance = _address1.balance; // balance of address<br></code></pre></td></tr></table></figure><h3 id="4-å®šé•¿å­—èŠ‚æ•°ç»„"><a href="#4-å®šé•¿å­—èŠ‚æ•°ç»„" class="headerlink" title="4. å®šé•¿å­—èŠ‚æ•°ç»„"></a>4. å®šé•¿å­—èŠ‚æ•°ç»„</h3><p>å­—èŠ‚æ•°ç»„æ°›å›´å®šé•¿å’Œä¸å®šé•¿ä¸¤ç§</p><ul><li>å®šé•¿å­—èŠ‚æ•°ç»„ï¼šå±äºå€¼ç±»å‹ï¼Œæ•°ç»„é•¿åº¦åœ¨å£°æ˜ä¹‹åä¸èƒ½æ”¹å˜ã€‚æ ¹æ®å­—èŠ‚æ•°ç»„çš„é•¿åº¦åˆ†ä¸º <code>bytes1</code>, <code>bytes8</code>, <code>bytes32</code> ç­‰ç±»å‹ã€‚å®šé•¿å­—èŠ‚æ•°ç»„æœ€å¤šå­˜å‚¨ 32 bytes æ•°æ®ï¼Œå³<code>bytes32</code>ã€‚</li><li><strong>ä¸å®šé•¿å­—èŠ‚æ•°ç»„</strong>: å±äºå¼•ç”¨ç±»å‹ï¼ˆä¹‹åçš„ç« èŠ‚ä»‹ç»ï¼‰ï¼Œæ•°ç»„é•¿åº¦åœ¨å£°æ˜ä¹‹åå¯ä»¥æ”¹å˜ï¼ŒåŒ…æ‹¬ <code>bytes</code> ç­‰ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs solidity">// å›ºå®šé•¿åº¦çš„å­—èŠ‚æ•°ç»„<br>bytes32 public _byte32 = &quot;MiniSolidity&quot;; // å­—èŠ‚å½¢å¼<br>bytes1 public _byte = _byte32[0]; // å–å…¶ç¬¬ä¸€ä¸ªå­—èŠ‚<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œå­—ç¬¦ä¸² <code>MiniSolidity</code> ä»¥å­—èŠ‚çš„æ–¹å¼å­˜å‚¨è¿›å˜é‡ <code>_byte32</code>ã€‚å¦‚æœæŠŠå®ƒè½¬æ¢æˆ <code>16 è¿›åˆ¶</code>ï¼Œå°±æ˜¯ï¼š<code>0x4d696e69536f6c69646974790000000000000000000000000000000000000000</code></p><p><code>_byte</code> å˜é‡çš„å€¼ä¸º <code>_byte32</code> çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œå³ <code>0x4d</code>ã€‚</p><h3 id="5-æšä¸¾-enum"><a href="#5-æšä¸¾-enum" class="headerlink" title="5. æšä¸¾ enum"></a>5. æšä¸¾ enum</h3><p>æšä¸¾ï¼ˆ<code>enum</code>ï¼‰æ˜¯ Solidity ä¸­ç”¨æˆ·å®šä¹‰çš„æ•°æ®ç±»å‹ã€‚å®ƒä¸»è¦ç”¨äºä¸º <code>uint</code> åˆ†é…åç§°ï¼Œä½¿ç¨‹åºæ˜“äºé˜…è¯»å’Œç»´æŠ¤ã€‚å®ƒä¸ <code>C è¯­è¨€</code> ä¸­çš„ <code>enum</code> ç±»ä¼¼ï¼Œä½¿ç”¨åç§°æ¥ä»£æ›¿ä» <code>0</code> å¼€å§‹çš„ <code>uint</code>ï¼š</p><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs fortran">// ç”¨<span class="hljs-keyword">enum</span>å°†uint <span class="hljs-number">0</span>ï¼Œ <span class="hljs-number">1</span>ï¼Œ <span class="hljs-number">2</span>è¡¨ç¤ºä¸ºBuy, Hold, Sell<br><span class="hljs-keyword">enum</span> ActionSet &#123; Buy, Hold, Sell &#125;<br>// åˆ›å»º<span class="hljs-keyword">enum</span>å˜é‡ <span class="hljs-keyword">action</span><br>ActionSet <span class="hljs-keyword">action</span> = ActionSet.Buy;<br></code></pre></td></tr></table></figure><p>æšä¸¾å¯ä»¥æ˜¾å¼åœ°å’Œ <code>uint</code> ç›¸äº’è½¬æ¢ï¼Œå¹¶ä¼šæ£€æŸ¥è½¬æ¢çš„æ— ç¬¦å·æ•´æ•°æ˜¯å¦åœ¨æšä¸¾çš„é•¿åº¦å†…ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-comment">// enumå¯ä»¥å’Œuintæ˜¾å¼çš„è½¬æ¢</span><br>function <span class="hljs-built_in">enumToUint</span>() external view <span class="hljs-built_in">returns</span>(uint)&#123;<br>    return <span class="hljs-built_in">uint</span>(action);<br>&#125;<br></code></pre></td></tr></table></figure><p><strong><code>enum</code> æ˜¯ä¸€ä¸ªæ¯”è¾ƒå†·é—¨çš„æ•°æ®ç±»å‹ï¼Œå‡ ä¹æ²¡ä»€ä¹ˆäººç”¨ã€‚</strong></p><h1 id="3-å‡½æ•°"><a href="#3-å‡½æ•°" class="headerlink" title="3. å‡½æ•°"></a>3. å‡½æ•°</h1><h2 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h2><p>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ Solidity ä¸­å‡½æ•°çš„å½¢å¼:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs solidity">function &lt;function name&gt;([parameter types[, ...]]) &#123;internal|external|public|private&#125; [pure|view|payable] [virtual|override] [&lt;modifiers&gt;]<br>[returns (&lt;return types&gt;)]&#123; &lt;function body&gt; &#125;<br></code></pre></td></tr></table></figure><p>çœ‹ç€æœ‰ä¸€äº›å¤æ‚ï¼Œè®©æˆ‘ä»¬ä»å‰å¾€åé€ä¸ªè§£é‡Š(æ–¹æ‹¬å·ä¸­çš„æ˜¯å¯å†™å¯ä¸ å†™çš„å…³é”®å­—)ï¼š</p><ol><li><p><code>function</code>ï¼šå£°æ˜å‡½æ•°æ—¶çš„å›ºå®šç”¨æ³•ã€‚è¦ç¼–å†™å‡½æ•°ï¼Œå°±éœ€è¦ä»¥ <code>function</code> å…³é”®å­—å¼€å¤´ã€‚</p></li><li><p><code>&lt;function name&gt;</code>ï¼šå‡½æ•°åã€‚</p></li><li><p><code>([parameter types[, ...]])</code>ï¼šåœ†æ‹¬å·å†…å†™å…¥å‡½æ•°çš„å‚æ•°ï¼Œå³è¾“å…¥åˆ°å‡½æ•°çš„å˜é‡ç±»å‹å’Œåç§°ã€‚</p></li><li><p><code>&#123;internal|external|public|private&#125;</code>ï¼šå‡½æ•°å¯è§æ€§è¯´æ˜ç¬¦ï¼Œå…±æœ‰4ç§ã€‚</p><ul><li><code>public</code>ï¼šå†…éƒ¨å’Œå¤–éƒ¨å‡å¯è§ã€‚</li><li><code>private</code>ï¼šåªèƒ½ä»æœ¬åˆçº¦å†…éƒ¨è®¿é—®ï¼Œç»§æ‰¿çš„åˆçº¦ä¹Ÿä¸èƒ½ä½¿ç”¨ã€‚</li><li><code>external</code>ï¼šåªèƒ½ä»åˆçº¦å¤–éƒ¨è®¿é—®ï¼ˆä½†å†…éƒ¨å¯ä»¥é€šè¿‡ <code>this.f()</code> æ¥è°ƒç”¨ï¼Œ<code>f</code>æ˜¯å‡½æ•°åï¼‰ã€‚</li><li><code>internal</code>: åªèƒ½ä»åˆçº¦å†…éƒ¨è®¿é—®ï¼Œç»§æ‰¿çš„åˆçº¦å¯ä»¥ç”¨ã€‚</li></ul><p><strong>æ³¨æ„ 1</strong>ï¼šåˆçº¦ä¸­å®šä¹‰çš„å‡½æ•°éœ€è¦æ˜ç¡®æŒ‡å®šå¯è§æ€§ï¼Œå®ƒä»¬æ²¡æœ‰é»˜è®¤å€¼ã€‚</p><p><strong>æ³¨æ„ 2</strong>ï¼š<code>public|private|internal</code> ä¹Ÿå¯ç”¨äºä¿®é¥°çŠ¶æ€å˜é‡(å®šä¹‰å¯å‚è€ƒ<a href="https://github.com/AmazingAng/WTF-Solidity/blob/main/03_Function/[../05_DataStorage/readme.md#1-%E7%8A%B6%E6%80%81%E5%8F%98%E9%87%8F](https:/github.com/AmazingAng/WTF-Solidity/tree/main/05_DataStorage#1-%E7%8A%B6%E6%80%81%E5%8F%98%E9%87%8F)">WTF Solidity ç¬¬5è®²çš„ç›¸å…³å†…å®¹</a>)ã€‚<code>public</code>å˜é‡ä¼šè‡ªåŠ¨ç”ŸæˆåŒåçš„<code>getter</code>å‡½æ•°ï¼Œç”¨äºæŸ¥è¯¢æ•°å€¼ã€‚æœªæ ‡æ˜å¯è§æ€§ç±»å‹çš„çŠ¶æ€å˜é‡ï¼Œé»˜è®¤ä¸º<code>internal</code>ã€‚</p></li><li><p><code>[pure|view|payable]</code>ï¼šå†³å®šå‡½æ•°æƒé™&#x2F;åŠŸèƒ½çš„å…³é”®å­—ã€‚<code>payable</code>ï¼ˆå¯æ”¯ä»˜çš„ï¼‰å¾ˆå¥½ç†è§£ï¼Œå¸¦ç€å®ƒçš„å‡½æ•°ï¼Œè¿è¡Œçš„æ—¶å€™å¯ä»¥ç»™åˆçº¦è½¬å…¥ ETHã€‚<code>pure</code> å’Œ <code>view</code> çš„ä»‹ç»è§ä¸‹ä¸€èŠ‚ã€‚</p></li><li><p><code>[virtual|override]</code>: æ–¹æ³•æ˜¯å¦å¯ä»¥è¢«é‡å†™ï¼Œæˆ–è€…æ˜¯å¦æ˜¯é‡å†™æ–¹æ³•ã€‚<code>virtual</code>ç”¨åœ¨çˆ¶åˆçº¦ä¸Šï¼Œæ ‡è¯†çš„æ–¹æ³•å¯ä»¥è¢«å­åˆçº¦é‡å†™ã€‚<code>override</code>ç”¨åœ¨å­åˆçº¦ä¸Šï¼Œè¡¨åæ–¹æ³•é‡å†™äº†çˆ¶åˆçº¦çš„æ–¹æ³•ã€‚</p></li><li><p><code>&lt;modifiers&gt;</code>: è‡ªå®šä¹‰çš„ä¿®é¥°å™¨ï¼Œå¯ä»¥æœ‰0ä¸ªæˆ–å¤šä¸ªä¿®é¥°å™¨ã€‚</p></li><li><p><code>[returns ()]</code>ï¼šå‡½æ•°è¿”å›çš„å˜é‡ç±»å‹å’Œåç§°ã€‚</p></li><li><p><code>&lt;function body&gt;</code>: å‡½æ•°ä½“ã€‚</p></li></ol><h2 id="åˆ°åº•ä»€ä¹ˆæ˜¯-Pure-å’ŒViewï¼Ÿ"><a href="#åˆ°åº•ä»€ä¹ˆæ˜¯-Pure-å’ŒViewï¼Ÿ" class="headerlink" title="åˆ°åº•ä»€ä¹ˆæ˜¯ Pure å’ŒViewï¼Ÿ"></a>åˆ°åº•ä»€ä¹ˆæ˜¯ <code>Pure</code> å’Œ<code>View</code>ï¼Ÿ</h2><p>åˆšå¼€å§‹å­¦ä¹  <code>solidity</code> æ—¶ï¼Œ<code>pure</code> å’Œ <code>view</code> å…³é”®å­—å¯èƒ½ä»¤äººè´¹è§£ï¼Œå› ä¸ºå…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸­æ²¡æœ‰ç±»ä¼¼çš„å…³é”®å­—ã€‚<code>solidity</code> å¼•å…¥è¿™ä¸¤ä¸ªå…³é”®å­—ä¸»è¦æ˜¯å› ä¸º ä»¥å¤ªåŠäº¤æ˜“éœ€è¦æ”¯ä»˜æ°”è´¹ï¼ˆgas feeï¼‰ã€‚åˆçº¦çš„çŠ¶æ€å˜é‡å­˜å‚¨åœ¨é“¾ä¸Šï¼Œgas fee å¾ˆè´µï¼Œå¦‚æœè®¡ç®—ä¸æ”¹å˜é“¾ä¸ŠçŠ¶æ€ï¼Œå°±å¯ä»¥ä¸ç”¨ä»˜ <code>gas</code>ã€‚åŒ…å« <code>pure</code> å’Œ <code>view</code> å…³é”®å­—çš„å‡½æ•°æ˜¯ä¸æ”¹å†™é“¾ä¸ŠçŠ¶æ€çš„ï¼Œå› æ­¤ç”¨æˆ·ç›´æ¥è°ƒç”¨å®ƒä»¬æ˜¯ä¸éœ€è¦ä»˜ gas çš„ï¼ˆæ³¨æ„ï¼Œåˆçº¦ä¸­é <code>pure</code>&#x2F;<code>view</code> å‡½æ•°è°ƒç”¨ <code>pure</code>&#x2F;<code>view</code> å‡½æ•°æ—¶éœ€è¦ä»˜gasï¼‰ã€‚</p><p>åœ¨ä»¥å¤ªåŠä¸­ï¼Œä»¥ä¸‹è¯­å¥è¢«è§†ä¸ºä¿®æ”¹é“¾ä¸ŠçŠ¶æ€ï¼š</p><ol><li>å†™å…¥çŠ¶æ€å˜é‡ã€‚</li><li>é‡Šæ”¾äº‹ä»¶ã€‚</li><li>åˆ›å»ºå…¶ä»–åˆçº¦ã€‚</li><li>ä½¿ç”¨ <code>selfdestruct</code>.</li><li>é€šè¿‡è°ƒç”¨å‘é€ä»¥å¤ªå¸ã€‚</li><li>è°ƒç”¨ä»»ä½•æœªæ ‡è®° <code>view</code> æˆ– <code>pure</code> çš„å‡½æ•°ã€‚</li><li>ä½¿ç”¨ä½çº§è°ƒç”¨ï¼ˆlow-level callsï¼‰ã€‚</li><li>ä½¿ç”¨åŒ…å«æŸäº›æ“ä½œç çš„å†…è”æ±‡ç¼–ã€‚</li></ol><ul><li><code>pure</code>ï¼Œä¸­æ–‡æ„æ€æ˜¯â€œçº¯â€ï¼Œè¿™é‡Œå¯ä»¥ç†è§£ä¸ºâ€çº¯æ‰“é…±æ²¹çš„â€ã€‚<code>pure</code> å‡½æ•°æ—¢ä¸èƒ½è¯»å–ä¹Ÿä¸èƒ½å†™å…¥é“¾ä¸Šçš„çŠ¶æ€å˜é‡ã€‚å°±åƒå°æ€ªä¸€æ ·ï¼Œçœ‹ä¸åˆ°ä¹Ÿæ‘¸ä¸åˆ°ç¢§çªå…¬ä¸»ã€‚</li><li><code>view</code>ï¼Œâ€œçœ‹â€ï¼Œè¿™é‡Œå¯ä»¥ç†è§£ä¸ºâ€œçœ‹å®¢â€ã€‚<code>view</code>å‡½æ•°èƒ½è¯»å–ä½†ä¹Ÿä¸èƒ½å†™å…¥çŠ¶æ€å˜é‡ã€‚ç±»ä¼¼é©¬é‡Œå¥¥ï¼Œèƒ½çœ‹åˆ°ç¢§çªå…¬ä¸»ï¼Œä½†ç»ˆç©¶æ˜¯çœ‹å®¢ï¼Œä¸èƒ½å…¥æ´æˆ¿ã€‚</li><li>é <code>pure</code> æˆ– <code>view</code> çš„å‡½æ•°æ—¢å¯ä»¥è¯»å–ä¹Ÿå¯ä»¥å†™å…¥çŠ¶æ€å˜é‡ã€‚ç±»ä¼¼é©¬é‡Œå¥¥é‡Œçš„ <code>boss</code>ï¼Œå¯ä»¥å¯¹ç¢§çªå…¬ä¸»ä¸ºæ‰€æ¬²ä¸ºğŸ¶ã€‚</li></ul><h1 id="4-å‡½æ•°è¾“å‡º"><a href="#4-å‡½æ•°è¾“å‡º" class="headerlink" title="4. å‡½æ•°è¾“å‡º"></a>4. å‡½æ•°è¾“å‡º</h1><h2 id="è¿”å›å€¼ï¼šreturn-å’Œ-returns"><a href="#è¿”å›å€¼ï¼šreturn-å’Œ-returns" class="headerlink" title="è¿”å›å€¼ï¼šreturn å’Œ returns"></a>è¿”å›å€¼ï¼šreturn å’Œ returns</h2><p>åœ¨å‡½æ•°å®šä¹‰è¡Œä¸­æœ‰ä¸¤ä¸ªå…³é”®å­—<code>return</code>å’Œ<code>returns</code>ï¼Œä»–ä»¬åŒºåˆ«æ˜¯ï¼š</p><ul><li><code>return</code>è·Ÿåœ¨å‡½æ•°ååé¢ï¼Œç”¨äºå£°æ˜è¿”å›çš„å˜é‡ç±»å‹ä»¥åŠå˜é‡åç§°</li><li><code>return</code>:ç”¨äºå‡½æ•°ä¸»é¢˜ä¸­ï¼Œè¿”å›æŒ‡å®šçš„å˜é‡</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs solidity">// è¿”å›å¤šä¸ªå˜é‡<br>function returnMultiple() public pure returns(uint256, bool, uint256[3] memory)&#123;<br>    return(1, true, [uint256(1),2,5]);<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨ <code>returns</code> å…³é”®å­—å£°æ˜äº†æœ‰å¤šä¸ªè¿”å›å€¼çš„ <code>returnMultiple()</code> å‡½æ•°ï¼Œç„¶åæˆ‘ä»¬åœ¨å‡½æ•°ä¸»ä½“ä¸­ä½¿ç”¨ <code>return(1, true, [uint256(1),2,5])</code> ç¡®å®šäº†è¿”å›å€¼ã€‚</p><p>è¿™é‡Œ<code>uint256[3]</code>å£°æ˜äº†ä¸€ä¸ªé•¿åº¦ä¸º<code>3</code>ä¸”ç±»å‹ä¸º<code>uint256</code>çš„æ•°ç»„ä½œä¸ºè¿”å›å€¼ã€‚å› ä¸º<code>[1,2,3]</code>ä¼šé»˜è®¤ä¸º<code>uint8(3)</code>ï¼Œå› æ­¤<code>[uint256(1),2,5]</code>ä¸­é¦–ä¸ªå…ƒç´ å¿…é¡»å¼ºè½¬</p><h2 id="å‘½åå¼è¿”å›"><a href="#å‘½åå¼è¿”å›" class="headerlink" title="å‘½åå¼è¿”å›"></a>å‘½åå¼è¿”å›</h2><p>æˆ‘ä»¬å¯ä»¥åœ¨ <code>returns</code> ä¸­æ ‡æ˜è¿”å›å˜é‡çš„åç§°ã€‚Solidity ä¼šåˆå§‹åŒ–è¿™äº›å˜é‡ï¼Œå¹¶ä¸”è‡ªåŠ¨è¿”å›è¿™äº›å˜é‡çš„å€¼ï¼Œæ— éœ€ä½¿ç”¨ <code>return</code>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs solidity">// å‘½åå¼è¿”å›<br>function returnNamed() public pure returns(uint256 _number, bool _bool, uint256[3] memory _array)&#123;<br>    _number = 2;<br>    _bool = false;<br>    _array = [uint256(3),2,1];<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬ç”¨ <code>returns(uint256 _number, bool _bool, uint256[3] memory _array)</code> å£°æ˜äº†è¿”å›å˜é‡ç±»å‹ä»¥åŠå˜é‡åã€‚è¿™æ ·ï¼Œåœ¨ä¸»ä½“ä¸­åªéœ€ä¸ºå˜é‡ <code>_number</code>ã€<code>_bool</code>å’Œ<code>_array</code> èµ‹å€¼ï¼Œå³å¯è‡ªåŠ¨è¿”å›ã€‚</p><p>å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨å‘½åå¼è¿”å›ä¸­ç”¨ <code>return</code> æ¥è¿”å›å˜é‡ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs solidity">// å‘½åå¼è¿”å›ï¼Œä¾ç„¶æ”¯æŒreturn<br>function returnNamed2() public pure returns(uint256 _number, bool _bool, uint256[3] memory _array)&#123;<br>    return(1, true, [uint256(1),2,5]);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="è§£æ„å¼èµ‹å€¼"><a href="#è§£æ„å¼èµ‹å€¼" class="headerlink" title="è§£æ„å¼èµ‹å€¼"></a>è§£æ„å¼èµ‹å€¼</h2><p>Solidity æ”¯æŒä½¿ç”¨è§£æ„å¼èµ‹å€¼è§„åˆ™æ¥è¯»å–å‡½æ•°çš„å…¨éƒ¨æˆ–éƒ¨åˆ†è¿”å›å€¼ã€‚</p><ul><li><p>è¯»å–æ‰€æœ‰è¿”å›å€¼ï¼šå£°æ˜å˜é‡ï¼Œç„¶åå°†è¦èµ‹å€¼çš„å˜é‡ç”¨<code>,</code>éš”å¼€ï¼ŒæŒ‰é¡ºåºæ’åˆ—ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs solidity">uint256 _number;<br>bool _bool;<br>uint256[3] memory _array;<br>(_number, _bool, _array) = returnNamed();<br></code></pre></td></tr></table></figure></li><li><p>è¯»å–éƒ¨åˆ†è¿”å›å€¼ï¼šå£°æ˜è¦è¯»å–çš„è¿”å›å€¼å¯¹åº”çš„å˜é‡ï¼Œä¸è¯»å–çš„ç•™ç©ºã€‚åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åªè¯»å–<code>_bool</code>ï¼Œè€Œä¸è¯»å–è¿”å›çš„<code>_number</code>å’Œ<code>_array</code>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs solidity">(, _bool2, ) = returnNamed();<br></code></pre></td></tr></table></figure></li></ul><p>å¦‚æœä¸¤ä¸ªå¸ç§å‘ç”Ÿè¾ƒå¤§æ±‡ç‡çš„å˜åŒ–å°±ä¼šæœ‰æŸå¤±</p><h1 id="5-å˜é‡æ•°æ®å­˜å‚¨å’Œä½œç”¨åŸŸ"><a href="#5-å˜é‡æ•°æ®å­˜å‚¨å’Œä½œç”¨åŸŸ" class="headerlink" title="5. å˜é‡æ•°æ®å­˜å‚¨å’Œä½œç”¨åŸŸ"></a>5. å˜é‡æ•°æ®å­˜å‚¨å’Œä½œç”¨åŸŸ</h1><p>å¼•ç”¨ç±»å‹(Reference Type) ï¼šåŒ…æ‹¬æ•°ç»„(array)å’Œç»“æ„ä½“(struct)ï¼Œç”±äºè¿™ç±»å˜é‡çš„ç±»å‹æ¯”è¾ƒå¤æ‚ä¸”å ç”¨ç©ºé—´æ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥ä½¿ç”¨çš„æ—¶å€™å¿…é¡»è¦å£°æ˜æ•°æ®æ‰€å­˜å‚¨çš„ä½ç½®ï¼Œ</p><h2 id="æ•°æ®ä½ç½®"><a href="#æ•°æ®ä½ç½®" class="headerlink" title="æ•°æ®ä½ç½®"></a>æ•°æ®ä½ç½®</h2><p>æ•°æ®çš„ä½ç½®åŒ…å«ä¸‰ç§ç±»å‹<code>storage</code>,<code>memory</code>,<code>calldata</code></p><ul><li><p><code>storage</code>ï¼šåˆçº¦é‡Œçš„çŠ¶æ€å˜é‡é»˜è®¤æ˜¯storageï¼Œå­˜å‚¨åœ¨é“¾ä¸Šçš„ï¼Œç±»ä¼¼è®¡ç®—æœºçš„ç¡¬ç›˜â€”ä¸€ç§æŒä¹…åŒ–å­˜å‚¨ï¼Œç”±é“¾å¸®ä½ æŒä¹…åŒ–ï¼Œæ‰€ä»¥å½±å“äº†é“¾ï¼Œæ‰€ä»¥æ¶ˆè€—çš„gasæ¯”è¾ƒå¤§</p></li><li><p><code>memory</code>:å‡½æ•°é‡Œçš„å‚æ•°å’Œä¸´æ—¶ä½¿ç”¨çš„å˜é‡ä¸€èˆ¬ç”¨memoryï¼Œè§åçŸ¥æ„ï¼Œå†…å­˜ï¼Œå­˜å‚¨åœ¨å†…å­˜ä¸­çš„ï¼Œä¸ä¸Šé“¾ï¼Œå°¤å…¶æ˜¯å½“è¿”å›æ•°æ®ç±»å‹æ˜¯<strong>å˜é•¿</strong>çš„æƒ…å†µä¸‹ï¼Œå¿…é¡»åŠ memoryä¿®é¥°ï¼Œä¾‹å¦‚ï¼šstring,bytesï¼Œarrayå’Œè‡ªå®šä¹‰ç»“æ„ï¼Œ</p></li><li><p><code>calldata</code>ï¼šå’Œ<code>memory</code>ç±»ä¼¼ï¼Œä¹Ÿæ˜¯å‚¨å­˜åœ¨å†…å­˜ä¸­ï¼Œä¸ä¸Šé“¾ï¼Œä¸åŒç‚¹æ˜¯ä¸èƒ½ä¿®å¯’è¿™ä¸ªå˜é‡ï¼Œä¸€èˆ¬ç”¨äºå‡½æ•°çš„å‚æ•°ï¼Œå…¥å‚è¿›æ¥åä¸ä¼šè¢«æ”¹å˜ï¼šå¦‚</p></li><li><pre><code class="solidity">function fCallData(uint[] calldata _x)public pure returns (uint[] calldata) &#123;        // _x[0]=0; // å½“ä½ ä¿®æ”¹çš„æ—¶å€™ï¼Œå°±ä¼šæŠ¥é”™TypeError: Calldata arrays are read-only.        return (_x);    &#125;<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><br><span class="hljs-meta">### æ•°æ®ä½ç½®å’Œèµ‹å€¼è§„åˆ™</span><br><br>èµ‹å€¼çš„æœ¬è´¨æ˜¯åˆ›å»ºå¼•ç”¨æŒ‡å‘æœ¬åœŸï¼Œå› æ­¤ä¿®æ”¹æœ¬ä½“æˆ–è€…æ˜¯ä¿®æ”¹å¼•ç”¨ï¼Œå˜åŒ–å¯ä»¥è¢«åŒæ­¥<br><br>- `storage`(åˆçº¦çš„çŠ¶æ€å˜é‡)èµ‹å€¼ç»™æœ¬åœ°`storage`ï¼ˆå‡½æ•°é‡Œçš„ï¼‰æ—¶å€™ï¼Œä¼šåˆ›å»ºå¼•ç”¨ï¼Œæ”¹å˜æ–°å˜é‡ä¼šå½±å“åŸæ¥çš„å˜é‡ã€‚ä¾‹å¦‚a<br><br>```solidity<br>    <span class="hljs-built_in">uint</span>[] x =[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>];<br>    <span class="hljs-function">function <span class="hljs-title">sStorage</span>() <span class="hljs-keyword">public</span></span> &#123;<br>        <span class="hljs-built_in">uint</span>[] storage xStorage = x; <span class="hljs-comment">// xStorageæ˜¯uint[]ç±»å‹ï¼Œä½ç½®æ˜¯storageï¼Œå¼•ç”¨äº†xï¼Œå½“ä¿®æ”¹xStorageçš„æ—¶å€™ï¼Œxä¹Ÿä¼šè¢«ä¿®æ”¹ï¼Œ</span><br>        xStorage[<span class="hljs-number">0</span>]=<span class="hljs-number">101</span>;<span class="hljs-comment">//å½“æˆ‘ä»¬è°ƒç”¨äº†Sstorageæ–¹æ³•çš„æ—¶å€™å°±xStorageä»¥åŠxçš„ç¬¬1ä¸ªå…ƒç´ æ”¹æˆ100ï¼Œ</span><br>        <span class="hljs-comment">// åœ¨debugçš„æ—¶å€™å¯ä»¥çœ‹åˆ°xçš„ç¬¬1ä¸ªå…ƒç´ ä¸€å¼€æ˜¯1 ï¼Œåé¢å˜æˆäº†100</span><br>        <br>    &#125;<br>    <span class="hljs-comment">// ä¸ºäº†æ›´æ–¹ä¾¿è§‚å¯Ÿã€‚å†™äº†ä¸€ä¸ªgetXæ–¹æ³•æ¥æŸ¥è¯¢xçš„å€¼ï¼Œå½“è°ƒç”¨äº†sStorageåxçš„ç¬¬ä¸€ä¸ªå…ƒç´ å°±å˜æˆäº†101äº†ï¼›</span><br>    <span class="hljs-function">function <span class="hljs-title">getX</span>() <span class="hljs-keyword">public</span> view <span class="hljs-title">returns</span> (<span class="hljs-params"><span class="hljs-built_in">uint</span>[] memory</span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> (x);<br>    &#125;<br></code></pre></td></tr></table></figure></code></pre></li><li><p><code>memory</code>èµ‹å€¼ç»™<code>memory</code>ï¼Œä¼šåˆ›å»ºå¼•ç”¨ï¼Œæ”¹å˜æ–°å˜é‡ä¼šå½±å“åŸå˜é‡ã€‚</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs solidity"><br>uint[] y  =[1,2,3]; // åœ¨å‡½æ•°ä¹‹å¤–å®šä¹‰çš„å˜é‡ï¼Œé»˜è®¤å°±æ˜¯stroageç±»å‹çš„ï¼Œ<br><br><br>function yMemory() public view &#123;<br>    uint[] memory ymemory = y; // yæ˜¯storageç±»çš„ï¼Œymemoryæ˜¯å¼•ç”¨äº†yï¼Œæ‰€ä»¥ä¿®æ”¹ymemoryçš„æ—¶å€™ä¸ä¼šä¿®æ”¹åˆ°y<br>    ymemory[0]=101;<br>    <br>&#125;<br>// æˆ‘ä»¬è°ƒç”¨getYçš„æ—¶å€™å°±ä¼šå‘ç°ï¼Œå…¶å®yMemoryæ–¹æ³•å¹¶ä¸èƒ½ä¿®æ”¹yçš„å€¼ï¼Œè¿™å°±æ˜¯å¼•ç”¨<br>function getY() public view returns (uint[] memory)&#123;<br>    return (y);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>å…¶ä»–æƒ…å†µä¸‹ï¼Œèµ‹å€¼åˆ›å»ºçš„æ˜¯æœ¬ä½“çš„å‰¯æœ¬ï¼Œå³å¯¹äºŒè€…ä¹‹ä¸€çš„ä¿®æ”¹ï¼Œå¹¶ä¸ä¼šåŒæ­¥åˆ°å¦ä¸€æ–¹ã€‚è¿™æœ‰æ—¶ä¼šæ¶‰åŠåˆ°å¼€å‘ä¸­çš„é—®é¢˜ï¼Œæ¯”å¦‚ä»<code>storage</code>ä¸­è¯»å–æ•°æ®ï¼Œèµ‹å€¼ç»™<code>memory</code>ï¼Œç„¶åä¿®æ”¹<code>memory</code>çš„æ•°æ®ï¼Œä½†å¦‚æœæ²¡æœ‰å°†<code>memory</code>çš„æ•°æ®èµ‹å€¼å›<code>storage</code>ï¼Œé‚£ä¹ˆ<code>storage</code>çš„æ•°æ®æ˜¯ä¸ä¼šæ”¹å˜çš„ã€‚ä¸Šé¢çš„ä¾‹å­å°±æ˜¯æŒ‡çš„å…¶ä»–æƒ…å†µï¼Œæ˜¯storage ç±»å‹è¢«memoryç±»å‹æ”¹å˜ï¼Œå®é™…æ˜¯æ”¹å˜ä¸æˆåŠŸçš„</li><li>è¿˜æœ‰ä¸€ç§æƒ…å†µå°±æ˜¯memoryç±»å‹çš„è¢«memoryç±»å‹çš„ä¿®æ”¹ï¼Œè¿™ä¸ªæš‚æ—¶è¿˜ä¸çŸ¥é“æ€ä¹ˆæ‰“å°</li></ul><h2 id="å˜é‡çš„ä½œç”¨åŸŸ"><a href="#å˜é‡çš„ä½œç”¨åŸŸ" class="headerlink" title="å˜é‡çš„ä½œç”¨åŸŸ"></a>å˜é‡çš„ä½œç”¨åŸŸ</h2><p>å‰é¢æ”¶çš„storageå’Œmemoryè®¨è®ºçš„æ˜¯å˜é‡å­˜å‚¨çš„ä½ç½®ï¼Œä»¥åŠå¼•ç”¨çš„æ–¹å¼ï¼Œå°±åƒç†è§£æŒ‡é’ˆå’Œå¼•ç”¨ä¸€æ ·ï¼Œä¸‹é¢æ¥å­¦å˜é‡çš„ä½œç”¨åŸŸï¼Œæ‰€è°“æ‰€ç”¨åŸŸå°±æ˜¯æŒ‡è¿™ä¸ªå˜é‡åœ¨å“ªé‡Œå¯ä»¥ç”¨å®ƒ</p><p><code>Solidity</code>ä¸­å˜é‡æŒ‰ä½œç”¨åŸŸåˆ’åˆ†æœ‰ä¸‰ç§ï¼Œåˆ†åˆ«æ˜¯çŠ¶æ€å˜é‡ï¼ˆstate variableï¼‰ï¼Œå±€éƒ¨å˜é‡ï¼ˆlocal variableï¼‰å’Œå…¨å±€å˜é‡(global variable)</p><h3 id="1-çŠ¶æ€å˜é‡"><a href="#1-çŠ¶æ€å˜é‡" class="headerlink" title="1. çŠ¶æ€å˜é‡"></a>1. çŠ¶æ€å˜é‡</h3><p>çŠ¶æ€å˜é‡æ˜¯æ•°æ®å­˜å‚¨åœ¨é“¾ä¸Šçš„å˜é‡ï¼Œæ‰€æœ‰åˆçº¦å†…å‡½æ•°éƒ½å¯ä»¥è®¿é—®ï¼Œ<code>gas</code>æ¶ˆè€—é«˜ã€‚çŠ¶æ€å˜é‡åœ¨åˆçº¦å†…ã€å‡½æ•°å¤–å£°æ˜ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs solidity">contract Variables &#123;<br>     // 2.å˜é‡çš„ä½œç”¨åŸŸ<br>    // 2.1 çŠ¶æ€å˜é‡ï¼š é“¾ä¸Šçš„å˜é‡ï¼šå†™åœ¨åˆçº¦é‡Œé¢å‡½æ•°å¤–é¢çš„å˜é‡ï¼Œå°±æ˜¯çŠ¶æ€å˜é‡ï¼Œåœ¨æ‰€æœ‰åˆçº¦å†…å‡½æ•°éƒ½å¯ä»¥è®¿é—®ï¼ŒåŒæ ·gasçš„æ¶ˆè€—ä¹Ÿé«˜<br>    uint public a=1;<br>    uint public b;<br>    string public z;// è¿™äº›å˜é‡éƒ½æ˜¯çŠ¶æ€å˜é‡ï¼ŒåŒæ—¶ï¼Œè¿™äº›å˜é‡ä¼šè‡ªå¸¦æœ‰getæ–¹æ³•å»æŸ¥çœ‹ä»–ä»¬çš„å€¼ï¼Œï¼ˆæ•°ç»„æ²¡æœ‰è‡ªå¸¦getï¼‰<br>    <br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥åœ¨å‡½æ•°é‡Œæ›´æ”¹çŠ¶æ€å˜é‡çš„å€¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs solidity">function foo() external&#123;<br>    // å¯ä»¥åœ¨å‡½æ•°é‡Œæ›´æ”¹çŠ¶æ€å˜é‡çš„å€¼<br>    x = 5;<br>    y = 2;<br>    z = &quot;0xAA&quot;;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-å±€éƒ¨å˜é‡"><a href="#2-å±€éƒ¨å˜é‡" class="headerlink" title="2. å±€éƒ¨å˜é‡"></a>2. å±€éƒ¨å˜é‡</h3><p>å±€éƒ¨å˜é‡æ˜¯ä»…åœ¨å‡½æ•°æ‰§è¡Œè¿‡ç¨‹ä¸­æœ‰æ•ˆçš„å˜é‡ï¼Œå‡½æ•°é€€å‡ºåï¼Œå˜é‡æ— æ•ˆã€‚å±€éƒ¨å˜é‡çš„æ•°æ®å­˜å‚¨åœ¨å†…å­˜é‡Œï¼Œä¸ä¸Šé“¾ï¼Œ<code>gas</code>ä½ã€‚å±€éƒ¨å˜é‡åœ¨å‡½æ•°å†…å£°æ˜ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs solidity"> // 2.2 å±€éƒ¨å˜é‡ï¼Œè¿™ä¸ªå°±å¾ˆå¥½ç†è§£äº†ï¼Œå°±æ˜¯åœ¨å‡½æ•°å†…éƒ¨å®šä¹‰çš„å˜é‡ï¼Œåªä½œç”¨çš„å‡½æ•°å†…ï¼Œå‡ºå»äº†å°±æ²¡ç”¨å•¦<br>function bar() external pure returns(uint)&#123;<br>    uint xx = 1;<br>    uint yy = 3;<br>    uint zz = xx + yy;<br>    return(zz);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-å…¨å±€å˜é‡"><a href="#3-å…¨å±€å˜é‡" class="headerlink" title="3. å…¨å±€å˜é‡"></a>3. å…¨å±€å˜é‡</h3><p>å…¨å±€å˜é‡æ˜¯å…¨å±€èŒƒå›´å·¥ä½œçš„å˜é‡ï¼Œéƒ½æ˜¯<code>solidity</code>é¢„ç•™å…³é”®å­—ã€‚ä»–ä»¬å¯ä»¥åœ¨å‡½æ•°å†…ä¸å£°æ˜ç›´æ¥ä½¿ç”¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs solidity">// 2.3 å…¨å±€å˜é‡ï¼Œè¿™é‡Œçš„å…¨å±€å˜é‡å’Œpyä¸åŒï¼Œè¿™é‡ŒæŒ‡çš„æ˜¯solidityé¢„ç•™å…³é”®å­—çš„å˜é‡ï¼Œä»–ä»¬å¯ä»¥åœ¨å‡½æ•°å†…ä¸å£°æ˜ç›´æ¥ä½¿ç”¨<br>   function global()external view returns(address,uint,bytes32,bytes memory)  &#123;<br>       address sender=msg.sender; // å‘é€è€…çš„åœ°å€ï¼ŒçŒœæµ‹åº”è¯¥æ˜¯è°ƒç”¨è¿™ä¸ªåˆçº¦çš„äººçš„åœ°å€,addressæ˜¯ä¸€ç§ç±»å‹<br>       uint blockNum = block.number; // å½“å‰åŒºå—é«˜åº¦ï¼Ÿ<br>       bytes32 bHash = blockhash(blockNum - 1); // è·å–åŒºå—å“ˆå¸Œ<br>       bytes memory data=msg.data; //è¿™ä¸ªæ²¡ç”¨è¿‡ ,byteæ˜¯ç±»å‹ï¼Œmemoryæ˜¯ä½ç½®<br>       return (sender,blockNum,bHash,data);<br>   &#125;<br></code></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨çš„å…¨å±€å˜é‡ï¼Œæ›´å®Œæ•´çš„åˆ—è¡¨è¯·çœ‹è¿™ä¸ª<a href="https://learnblockchain.cn/docs/solidity/units-and-global-variables.html#special-variables-and-functions">é“¾æ¥</a>ï¼š</p><ul><li><code>blockhash(uint blockNumber)</code>: (<code>bytes32</code>) ç»™å®šåŒºå—çš„å“ˆå¸Œå€¼ â€“ åªé€‚ç”¨äºæœ€è¿‘çš„256ä¸ªåŒºå—, ä¸åŒ…å«å½“å‰åŒºå—ã€‚</li><li><code>block.coinbase</code>: (<code>address payable</code>) å½“å‰åŒºå—çŸ¿å·¥çš„åœ°å€</li><li><code>block.gaslimit</code>: (<code>uint</code>) å½“å‰åŒºå—çš„gaslimit</li><li><code>block.number</code>: (<code>uint</code>) å½“å‰åŒºå—çš„number</li><li><code>block.timestamp</code>: (<code>uint</code>) å½“å‰åŒºå—çš„æ—¶é—´æˆ³ï¼Œä¸ºunixçºªå…ƒä»¥æ¥çš„ç§’</li><li><code>gasleft()</code>: (<code>uint256</code>) å‰©ä½™ gas</li><li><code>msg.data</code>: (<code>bytes calldata</code>) å®Œæ•´call data</li><li><code>msg.sender</code>: (<code>address payable</code>) æ¶ˆæ¯å‘é€è€… (å½“å‰ caller)</li><li><code>msg.sig</code>: (<code>bytes4</code>) calldataçš„å‰å››ä¸ªå­—èŠ‚ (function identifier)</li><li><code>msg.value</code>: (<code>uint</code>) å½“å‰äº¤æ˜“å‘é€çš„ <code>wei</code> å€¼</li><li><code>block.blobbasefee</code>: (<code>uint</code>) å½“å‰åŒºå—çš„blobåŸºç¡€è´¹ç”¨ã€‚è¿™æ˜¯Cancunå‡çº§æ–°å¢çš„å…¨å±€å˜é‡ã€‚</li><li><code>blobhash(uint index)</code>: (<code>bytes32</code>) è¿”å›è·Ÿå½“å‰äº¤æ˜“å…³è”çš„ç¬¬ <code>index</code> ä¸ªblobçš„ç‰ˆæœ¬åŒ–å“ˆå¸Œï¼ˆç¬¬ä¸€ä¸ªå­—èŠ‚ä¸ºç‰ˆæœ¬å·ï¼Œå½“å‰ä¸º<code>0x01</code>ï¼Œåé¢æ¥KZGæ‰¿è¯ºçš„SHA256å“ˆå¸Œçš„æœ€å31ä¸ªå­—èŠ‚ï¼‰ã€‚è‹¥å½“å‰äº¤æ˜“ä¸åŒ…å«blobï¼Œåˆ™è¿”å›ç©ºå­—èŠ‚ã€‚è¿™æ˜¯Cancunå‡çº§æ–°å¢çš„å…¨å±€å˜é‡ã€‚</li></ul><h3 id="4-å…¨å±€å˜é‡-ä»¥å¤ªå•ä½ä¸æ—¶é—´å•ä½"><a href="#4-å…¨å±€å˜é‡-ä»¥å¤ªå•ä½ä¸æ—¶é—´å•ä½" class="headerlink" title="4. å…¨å±€å˜é‡-ä»¥å¤ªå•ä½ä¸æ—¶é—´å•ä½"></a>4. å…¨å±€å˜é‡-ä»¥å¤ªå•ä½ä¸æ—¶é—´å•ä½</h3><h4 id="ä»¥å¤ªå•ä½"><a href="#ä»¥å¤ªå•ä½" class="headerlink" title="ä»¥å¤ªå•ä½"></a>ä»¥å¤ªå•ä½</h4><p><code>Solidity</code>ä¸­ä¸å­˜åœ¨å°æ•°ç‚¹ï¼Œä»¥<code>0</code>ä»£æ›¿ä¸ºå°æ•°ç‚¹ï¼Œæ¥ç¡®ä¿äº¤æ˜“çš„ç²¾ç¡®åº¦ï¼Œå¹¶ä¸”é˜²æ­¢ç²¾åº¦çš„æŸå¤±ï¼Œåˆ©ç”¨ä»¥å¤ªå•ä½å¯ä»¥é¿å…è¯¯ç®—çš„é—®é¢˜ï¼Œæ–¹ä¾¿ç¨‹åºå‘˜åœ¨åˆçº¦ä¸­å¤„ç†è´§å¸äº¤æ˜“ã€‚</p><ul><li><code>wei</code>: 1</li><li><code>gwei</code>: 1e9 &#x3D; 1000000000</li><li><code>ether</code>: 1e18 &#x3D; 1000000000000000000</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs solidity">// ä»¥å¤ªåŠæ²¡æœ‰å°æ•°ç‚¹ï¼Œç”¨0ä»£æ›¿ä¸ºå°æ•°ç‚¹æ¥ç¡®ä¿äº¤æ˜“çš„ç²¾åº¦ï¼Œä¸ºäº†é˜²æ­¢ç²¾åº¦çš„æŸå¤±ï¼Œåˆ©ç”¨ä¸€å°å•ä½å¯ä»¥é¿å…è¯¯ç®—ï¼Œ<br>  // wei : 1<br>  // gwei : 1e9 =1000000000<br>  // ether : 1e18 = 100000000000000000<br>  function weiUit()external pure returns(uint)  &#123;<br>      assert(1 wei ==1e0);<br>      assert(1 wei == 1);<br>      // return 1 wei; // è°ƒç”¨çš„æ—¶å€™å°±çœ‹åˆ°è¿”å›äº†1ï¼Œ<br>      return 1 gwei; // è¯•è¯•çœ‹è¿”å›ä»€ä¹ˆ è¿”å› <br>  &#125;<br>  function gweiUit()external pure returns(uint)  &#123;<br>      assert(1 gwei ==1e9);<br>      assert(1 gwei == 1000000000); // å¦‚æœasserté”™è¯¯ï¼Œè°ƒç”¨çš„æ—¶å€™ä¼šæŠ¥é”™çš„å˜¿å˜¿<br>      <br>      return 1 gwei; // è¯•è¯•çœ‹è¿”å›ä»€ä¹ˆ è¿”å›  1000000000<br>  &#125;<br>  function etherUit()external pure returns(uint)  &#123;<br>      assert(1 ether ==1e18);<br>      assert(1 ether == 1000000000000000000);<br>      // return 1 wei; // è°ƒç”¨çš„æ—¶å€™å°±çœ‹åˆ°è¿”å›äº†1ï¼Œ<br>      return 1 ether; // è¯•è¯•çœ‹è¿”å›ä»€ä¹ˆ è¿”å›  1000000000000000000<br>  &#125;<br></code></pre></td></tr></table></figure><h4 id="æ—¶é—´å•ä½"><a href="#æ—¶é—´å•ä½" class="headerlink" title="æ—¶é—´å•ä½"></a>æ—¶é—´å•ä½</h4><p>å¯ä»¥åœ¨åˆçº¦ä¸­è§„å®šä¸€ä¸ªæ“ä½œå¿…é¡»åœ¨ä¸€å‘¨å†…å®Œæˆï¼Œæˆ–è€…æŸä¸ªäº‹ä»¶åœ¨ä¸€ä¸ªæœˆåå‘ç”Ÿã€‚è¿™æ ·å°±èƒ½è®©åˆçº¦çš„æ‰§è¡Œå¯ä»¥æ›´åŠ ç²¾ç¡®ï¼Œä¸ä¼šå› ä¸ºæŠ€æœ¯ä¸Šçš„è¯¯å·®è€Œå½±å“åˆçº¦çš„ç»“æœã€‚å› æ­¤ï¼Œæ—¶é—´å•ä½åœ¨<code>Solidity</code>ä¸­æ˜¯ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µï¼Œæœ‰åŠ©äºæé«˜åˆçº¦çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p><ul><li><code>seconds</code>: 1</li><li><code>minutes</code>: 60 seconds &#x3D; 60</li><li><code>hours</code>: 60 minutes &#x3D; 3600</li><li><code>days</code>: 24 hours &#x3D; 86400</li><li><code>weeks</code>: 7 days &#x3D; 604800</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs solidity">function secondsUnit() external pure returns(uint) &#123;<br>    assert(1 seconds == 1);<br>    return 1 seconds;<br>&#125;<br><br>function minutesUnit() external pure returns(uint) &#123;<br>    assert(1 minutes == 60);<br>    assert(1 minutes == 60 seconds);<br>    return 1 minutes;<br>&#125;<br><br>function hoursUnit() external pure returns(uint) &#123;<br>    assert(1 hours == 3600);<br>    assert(1 hours == 60 minutes);<br>    return 1 hours;<br>&#125;<br><br>function daysUnit() external pure returns(uint) &#123;<br>    assert(1 days == 86400);<br>    assert(1 days == 24 hours);<br>    return 1 days;<br>&#125;<br><br>function weeksUnit() external pure returns(uint) &#123;<br>    assert(1 weeks == 604800);<br>    assert(1 weeks == 7 days);<br>    return 1 weeks;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ä»‹ç»äº†<code>Solidity</code>ä¸­çš„å¼•ç”¨ç±»å‹ï¼Œæ•°æ®ä½ç½®å’Œå˜é‡çš„ä½œç”¨åŸŸã€‚é‡ç‚¹æ˜¯<code>storage</code>, <code>memory</code>å’Œ<code>calldata</code>ä¸‰ä¸ªå…³é”®å­—çš„ç”¨æ³•ã€‚ä»–ä»¬å‡ºç°çš„åŸå› æ˜¯ä¸ºäº†èŠ‚çœé“¾ä¸Šæœ‰é™çš„å­˜å‚¨ç©ºé—´å’Œé™ä½<code>gas</code>ã€‚ä¸‹ä¸€è®²æˆ‘ä»¬ä¼šä»‹ç»å¼•ç”¨ç±»å‹ä¸­çš„æ•°ç»„ã€‚</p><h1 id="6-å¼•ç”¨ç±»å‹-array-struct"><a href="#6-å¼•ç”¨ç±»å‹-array-struct" class="headerlink" title="6. å¼•ç”¨ç±»å‹, array, struct"></a>6. å¼•ç”¨ç±»å‹, array, struct</h1><p>æ•°ç»„ï¼ˆ<code>Array</code>ï¼‰æ˜¯<code>Solidity</code>å¸¸ç”¨çš„ä¸€ç§å˜é‡ç±»å‹ï¼Œç”¨æ¥å­˜å‚¨ä¸€ç»„æ•°æ®ï¼ˆæ•´æ•°ï¼Œå­—èŠ‚ï¼Œåœ°å€ç­‰ç­‰ï¼‰ã€‚æ•°ç»„åˆ†ä¸ºå›ºå®šé•¿åº¦æ•°ç»„å’Œå¯å˜é•¿åº¦æ•°ç»„ä¸¤ç§ï¼š</p><ul><li><p>å›ºå®šé•¿åº¦æ•°ç»„ï¼šåœ¨å£°æ˜æ—¶æŒ‡å®šæ•°ç»„çš„é•¿åº¦ã€‚ç”¨<code>T[k]</code>çš„æ ¼å¼å£°æ˜ï¼Œå…¶ä¸­<code>T</code>æ˜¯å…ƒç´ çš„ç±»å‹ï¼Œ<code>k</code>æ˜¯é•¿åº¦ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs solidity">// å›ºå®šé•¿åº¦ Array<br>uint[8] array1;<br>bytes1[5] array2;<br>address[100] array3;<br></code></pre></td></tr></table></figure></li><li><p>å¯å˜é•¿åº¦æ•°ç»„ï¼ˆåŠ¨æ€æ•°ç»„ï¼‰ï¼šåœ¨å£°æ˜æ—¶ä¸æŒ‡å®šæ•°ç»„çš„é•¿åº¦ã€‚ç”¨<code>T[]</code>çš„æ ¼å¼å£°æ˜ï¼Œå…¶ä¸­<code>T</code>æ˜¯å…ƒç´ çš„ç±»å‹ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs solidity">// å¯å˜é•¿åº¦ Array<br>uint[] array4;<br>bytes1[] array5;<br>address[] array6;<br>bytes array7;<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼š<code>bytes</code>æ¯”è¾ƒç‰¹æ®Šï¼Œæ˜¯æ•°ç»„ï¼Œä½†æ˜¯ä¸ç”¨åŠ <code>[]</code>ã€‚å¦å¤–ï¼Œä¸èƒ½ç”¨<code>byte[]</code>å£°æ˜å•å­—èŠ‚æ•°ç»„ï¼Œå¯ä»¥ä½¿ç”¨<code>bytes</code>æˆ–<code>bytes1[]</code>ã€‚<code>bytes</code> æ¯” <code>bytes1[]</code> çœgasã€‚</p></li></ul><h3 id="åˆ›å»ºæ•°ç»„çš„è§„åˆ™"><a href="#åˆ›å»ºæ•°ç»„çš„è§„åˆ™" class="headerlink" title="åˆ›å»ºæ•°ç»„çš„è§„åˆ™"></a>åˆ›å»ºæ•°ç»„çš„è§„åˆ™</h3><p>åœ¨Solidityé‡Œï¼Œåˆ›å»ºæ•°ç»„æœ‰ä¸€äº›è§„åˆ™ï¼š</p><ul><li><p>å¯¹äº<code>memory</code>ä¿®é¥°çš„<code>åŠ¨æ€æ•°ç»„</code>ï¼Œå¯ä»¥ç”¨<code>new</code>æ“ä½œç¬¦æ¥åˆ›å»ºï¼Œä½†æ˜¯å¿…é¡»å£°æ˜é•¿åº¦ï¼Œå¹¶ä¸”å£°æ˜åé•¿åº¦ä¸èƒ½æ”¹å˜ã€‚ä¾‹å­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs solidity">// memoryåŠ¨æ€æ•°ç»„<br>uint[] memory array8 = new uint[](5);<br>bytes memory array9 = new bytes(9);<br></code></pre></td></tr></table></figure></li><li><p>æ•°ç»„å­—é¢å¸¸æ•°(Array Literals)æ˜¯å†™ä½œè¡¨è¾¾å¼å½¢å¼çš„æ•°ç»„ï¼Œç”¨æ–¹æ‹¬å·åŒ…ç€æ¥åˆå§‹åŒ–arrayçš„ä¸€ç§æ–¹å¼ï¼Œå¹¶ä¸”é‡Œé¢æ¯ä¸€ä¸ªå…ƒç´ çš„typeæ˜¯ä»¥ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºå‡†çš„ï¼Œä¾‹å¦‚<code>[1,2,3]</code>é‡Œé¢æ‰€æœ‰çš„å…ƒç´ éƒ½æ˜¯<code>uint8</code>ç±»å‹ï¼Œå› ä¸ºåœ¨Solidityä¸­ï¼Œå¦‚æœä¸€ä¸ªå€¼æ²¡æœ‰æŒ‡å®štypeçš„è¯ï¼Œä¼šæ ¹æ®ä¸Šä¸‹æ–‡æ¨æ–­å‡ºå…ƒç´ çš„ç±»å‹ï¼Œé»˜è®¤å°±æ˜¯æœ€å°å•ä½çš„typeï¼Œè¿™é‡Œé»˜è®¤æœ€å°å•ä½ç±»å‹æ˜¯<code>uint8</code>ã€‚è€Œ<code>[uint(1),2,3]</code>é‡Œé¢çš„å…ƒç´ éƒ½æ˜¯<code>uint</code>ç±»å‹ï¼Œå› ä¸ºç¬¬ä¸€ä¸ªå…ƒç´ æŒ‡å®šäº†æ˜¯<code>uint</code>ç±»å‹äº†ï¼Œé‡Œé¢æ¯ä¸€ä¸ªå…ƒç´ çš„typeéƒ½ä»¥ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºå‡†ã€‚</p><p>ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œå¦‚æœæ²¡æœ‰å¯¹ä¼ å…¥ <code>g()</code> å‡½æ•°çš„æ•°ç»„è¿›è¡Œ <code>uint</code> è½¬æ¢ï¼Œæ˜¯ä¼šæŠ¥é”™çš„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs solidity">// SPDX-License-Identifier: GPL-3.0<br>pragma solidity &gt;=0.4.16 &lt;0.9.0;<br><br>contract C &#123;<br>    function f() public pure &#123;<br>        g([uint(1), 2, 3]);<br>    &#125;<br>    function g(uint[3] memory _data) public pure &#123;<br>        // ...<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>å¦‚æœåˆ›å»ºçš„æ˜¯åŠ¨æ€æ•°ç»„ï¼Œä½ éœ€è¦ä¸€ä¸ªä¸€ä¸ªå…ƒç´ çš„èµ‹å€¼ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs solidity">uint[] memory x = new uint[](3);<br>x[0] = 1;<br>x[1] = 3;<br>x[2] = 4;<br></code></pre></td></tr></table></figure></li></ul><h3 id="æ•°ç»„æˆå‘˜"><a href="#æ•°ç»„æˆå‘˜" class="headerlink" title="æ•°ç»„æˆå‘˜"></a>æ•°ç»„æˆå‘˜</h3><ul><li><code>length</code>: æ•°ç»„æœ‰ä¸€ä¸ªåŒ…å«å…ƒç´ æ•°é‡çš„<code>length</code>æˆå‘˜ï¼Œ<code>memory</code>æ•°ç»„çš„é•¿åº¦åœ¨åˆ›å»ºåæ˜¯å›ºå®šçš„ã€‚</li><li><code>push()</code>: <code>åŠ¨æ€æ•°ç»„</code>æ‹¥æœ‰<code>push()</code>æˆå‘˜ï¼Œå¯ä»¥åœ¨æ•°ç»„æœ€åæ·»åŠ ä¸€ä¸ª<code>0</code>å…ƒç´ ï¼Œå¹¶è¿”å›è¯¥å…ƒç´ çš„å¼•ç”¨ã€‚</li><li><code>push(x)</code>: <code>åŠ¨æ€æ•°ç»„</code>æ‹¥æœ‰<code>push(x)</code>æˆå‘˜ï¼Œå¯ä»¥åœ¨æ•°ç»„æœ€åæ·»åŠ ä¸€ä¸ª<code>x</code>å…ƒç´ ã€‚</li><li><code>pop()</code>: <code>åŠ¨æ€æ•°ç»„</code>æ‹¥æœ‰<code>pop()</code>æˆå‘˜ï¼Œå¯ä»¥ç§»é™¤æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ ã€‚</li></ul><h2 id="ç»“æ„ä½“-struct"><a href="#ç»“æ„ä½“-struct" class="headerlink" title="ç»“æ„ä½“ struct"></a>ç»“æ„ä½“ struct</h2><p><code>Solidity</code>æ”¯æŒé€šè¿‡æ„é€ ç»“æ„ä½“çš„å½¢å¼å®šä¹‰æ–°çš„ç±»å‹ã€‚ç»“æ„ä½“ä¸­çš„å…ƒç´ å¯ä»¥æ˜¯åŸå§‹ç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯å¼•ç”¨ç±»å‹ï¼›ç»“æ„ä½“å¯ä»¥ä½œä¸ºæ•°ç»„æˆ–æ˜ å°„çš„å…ƒç´ ã€‚åˆ›å»ºç»“æ„ä½“çš„æ–¹æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs solidity">// ç»“æ„ä½“<br>struct Student&#123;<br>    uint256 id;<br>    uint256 score; <br>&#125;<br><br>Student student; // åˆå§‹ä¸€ä¸ªstudentç»“æ„ä½“<br></code></pre></td></tr></table></figure><p>ç»™ç»“æ„ä½“èµ‹å€¼çš„å››ç§æ–¹æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs solidity">//  ç»™ç»“æ„ä½“èµ‹å€¼<br>// æ–¹æ³•1:åœ¨å‡½æ•°ä¸­åˆ›å»ºä¸€ä¸ªstorageçš„structå¼•ç”¨<br> // 4 ç»“æ„ä½“ï¼Œé¡¾åæ€ä¹‰ï¼Œå„ç§æ•°æ®ç±»å‹ç»„åˆçš„ç»“æ„ä½“ï¼Œç»“æ„ä½“ä¸­çš„å…ƒç´ å¯ä»¥æ˜¯åŸå§‹ç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯å¼•ç”¨ç±»å‹ï¼›ç»“æ„ä½“å¯ä»¥ä½œä¸ºæ•°ç»„æˆ–æ˜ å°„çš„å…ƒç´ ã€‚åˆ›å»ºç»“æ„ä½“çš„æ–¹æ³•ï¼š<br>    struct Student&#123;<br>        uint256 id;<br>        uint256 score;<br>    &#125;<br>    Student student; // èˆ’é€‚åŒ–è¿™ä¸ªç»“æ„ä½“ï¼Œå¾…ä¼šä¸‹é¢ä¼šç”¨åˆ°çš„<br>    // 4.1 æ–¹æ³•1: ç»™ç»“æ„ä½“èµ‹å€¼æ–¹å¼ä¸€ï¼š<br>    function initStudent1()external  &#123;<br>        Student storage _student=student ;// storageçŠ¶æ€å˜é‡ï¼Œé“¾ä¸Šå­˜å‚¨<br>        _student.id=11;<br>        _student.score=100; // debugçš„æ—¶å€™ä¼šå‘ç°ï¼Œå½“ç¨‹åºèµ°åˆ°è¿™é‡Œçš„æ—¶å€™ studentçš„å±æ€§å‘ç”Ÿäº†æ”¹å˜<br>    &#125;<br>    // 4.2 æ–¹æ³•2:ç›´æ¥å¼•ç”¨çŠ¶æ€å˜é‡çš„struct<br>    function initStudent2() external&#123;   <br>        student.id = 1;<br>        student.score = 80;<br>    &#125;<br>    // 4.3 æ–¹æ³•3:æ„é€ å‡½æ•°å¼ï¼Œç±»ä¼¼ä¸ç±»çš„åˆå§‹åŒ–<br>    function initStudent3() external &#123;<br>        student = Student(3, 90);<br>    &#125;<br>    // æ–¹æ³•4:key value<br>    function initStudent4() external &#123;<br>        student =Student(<br>            &#123;<br>                id:4,<br>                score:50<br>            &#125;<br>        );<br>    &#125;<br></code></pre></td></tr></table></figure><h1 id="7-æ˜ å°„ç±»å‹-mapping"><a href="#7-æ˜ å°„ç±»å‹-mapping" class="headerlink" title="7. æ˜ å°„ç±»å‹ mapping"></a>7. æ˜ å°„ç±»å‹ mapping</h1><h2 id="æ˜ å°„Mapping"><a href="#æ˜ å°„Mapping" class="headerlink" title="æ˜ å°„Mapping"></a>æ˜ å°„Mapping</h2><p>åœ¨æ˜ å°„ä¸­ï¼Œäººä»¬å¯ä»¥é€šè¿‡é”®ï¼ˆ<code>Key</code>ï¼‰æ¥æŸ¥è¯¢å¯¹åº”çš„å€¼ï¼ˆ<code>Value</code>ï¼‰ï¼Œæ¯”å¦‚ï¼šé€šè¿‡ä¸€ä¸ªäººçš„<code>id</code>æ¥æŸ¥è¯¢ä»–çš„é’±åŒ…åœ°å€ã€‚</p><p>å£°æ˜æ˜ å°„çš„æ ¼å¼ä¸º<code>mapping(_KeyType =&gt; _ValueType)</code>ï¼Œå…¶ä¸­<code>_KeyType</code>å’Œ<code>_ValueType</code>åˆ†åˆ«æ˜¯<code>Key</code>å’Œ<code>Value</code>çš„å˜é‡ç±»å‹ã€‚ä¾‹å­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs solidity">mapping(uint =&gt; address) public idToAddress; // idæ˜ å°„åˆ°åœ°å€<br>mapping(address =&gt; address) public swapPair; // å¸å¯¹çš„æ˜ å°„ï¼Œåœ°å€åˆ°åœ°å€<br></code></pre></td></tr></table></figure><h2 id="æ˜ å°„çš„è§„åˆ™"><a href="#æ˜ å°„çš„è§„åˆ™" class="headerlink" title="æ˜ å°„çš„è§„åˆ™"></a>æ˜ å°„çš„è§„åˆ™</h2><p>â€‹    &#x2F;&#x2F; 1ã€map çš„key åªèƒ½æ˜¯solidity å†…ç½®ç±»å‹ï¼Œå€¼å¯ä»¥ç”¨è‡ªå®šä¹‰çš„ç»“æ„ä½“</p><p>â€‹    &#x2F;&#x2F; 2ã€mapçš„å­˜å‚¨ä½ç½®å¿…é¡»æ˜¯storage å› æ­¤å¯ä»¥ç”¨äºåˆçº¦çš„çŠ¶æ€å˜é‡ã€å‡½æ•°ä¸­çš„storageçš„å˜é‡å’Œlibrryå‡½æ•°çš„å‚æ•°</p><p>â€‹    &#x2F;&#x2F; ä½†æ˜¯ä¸èƒ½ç”¨äºpublicå‡½æ•°çš„å•Šå‚æ•°æˆ–è€…è¿”å›å€¼ï¼Œå› ä¸ºmapè®°å½•çš„æ˜¯ä¸€ç§key-valueçš„å…³ç³»</p><p>â€‹    &#x2F;&#x2F; 3ã€å¦‚æœæ˜ å°„å£°æ˜ä¸ºpublic é‚£ä¹ˆsolidityä¼šè‡ªåŠ¨ä¸ºæ­¤å˜é‡åˆ›å»ºä¸€ä¸ªgetterå‡½æ•°æ¥è®©ä½ é€šè¿‡keyæ¥æŸ¥è¯¢value</p><p>â€‹    &#x2F;&#x2F; 4ã€å¢åŠ é”®å€¼å¯¹çš„è¯­æ³•ä¸º ï¼š Var[_Key] &#x3D; _Value,å…¶ä¸­_Varæ˜¯æ˜ å°„å˜é‡åï¼Œ_Keyå’Œ_Valueå¯¹åº”æ–°å¢çš„é”®å€¼å¯¹</p><h2 id="æ˜ å°„çš„åŸç†"><a href="#æ˜ å°„çš„åŸç†" class="headerlink" title="æ˜ å°„çš„åŸç†"></a>æ˜ å°„çš„åŸç†</h2><ul><li><strong>åŸç†1</strong>: æ˜ å°„ä¸å‚¨å­˜ä»»ä½•é”®ï¼ˆ<code>Key</code>ï¼‰çš„èµ„è®¯ï¼Œä¹Ÿæ²¡æœ‰lengthçš„èµ„è®¯ã€‚</li><li><strong>åŸç†2</strong>: å¯¹äºæ˜ å°„ä½¿ç”¨<code>keccak256(h(key) . slot)</code>è®¡ç®—å­˜å–valueçš„ä½ç½®ã€‚æ„Ÿå…´è¶£çš„å¯ä»¥å»é˜…è¯» <a href="https://github.com/WTFAcademy/WTF-Solidity-Internals/tree/master/tutorials/02_MappingStorage">WTF Solidity å†…éƒ¨è§„åˆ™: æ˜ å°„å­˜å‚¨å¸ƒå±€</a></li><li><strong>åŸç†3</strong>: å› ä¸ºEthereumä¼šå®šä¹‰æ‰€æœ‰æœªä½¿ç”¨çš„ç©ºé—´ä¸º0ï¼Œæ‰€ä»¥æœªèµ‹å€¼ï¼ˆ<code>Value</code>ï¼‰çš„é”®ï¼ˆ<code>Key</code>ï¼‰åˆå§‹å€¼éƒ½æ˜¯å„ä¸ªtypeçš„é»˜è®¤å€¼ï¼Œå¦‚uintçš„é»˜è®¤å€¼æ˜¯0ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs solidity">function writeMap(uint _Key,address _Value)public  &#123;<br>    idToAddress[_Key]=_Value;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="8-å˜é‡åˆå§‹å€¼"><a href="#8-å˜é‡åˆå§‹å€¼" class="headerlink" title="8. å˜é‡åˆå§‹å€¼"></a>8. å˜é‡åˆå§‹å€¼</h1><p>Solidity å’Œgo ä¸€æ ·ï¼Œå£°æ˜ä½†æ²¡èµ‹å€¼çš„å˜é‡éƒ½æœ‰å®ƒçš„åˆå§‹å€¼æˆ–è€…é»˜è®¤å€¼ï¼Œ</p><h2 id="å€¼ç±»å‹å˜é‡çš„åˆå§‹å€¼"><a href="#å€¼ç±»å‹å˜é‡çš„åˆå§‹å€¼" class="headerlink" title="å€¼ç±»å‹å˜é‡çš„åˆå§‹å€¼"></a>å€¼ç±»å‹å˜é‡çš„åˆå§‹å€¼</h2><ul><li><p><code>boolean</code>: <code>false</code></p></li><li><p><code>string</code>: <code>&quot;&quot;</code></p></li><li><p><code>int</code>: <code>0</code></p></li><li><p><code>uint</code>: <code>0</code></p></li><li><p><code>enum</code>: æšä¸¾ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ </p></li><li><p><code>address</code>: <code>0x0000000000000000000000000000000000000000</code> (æˆ– <code>address(0)</code>)</p></li><li><pre><code class="hljs">function<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><br>  - `<span class="hljs-keyword">internal</span>`: ç©ºç™½å‡½æ•°<br>  - `external`: ç©ºç™½å‡½æ•°<br><br>å¯ä»¥ç”¨<span class="hljs-keyword">public</span>å˜é‡çš„getterå‡½æ•°éªŒè¯åˆå§‹å€¼<br><br>```solidity<br>contract InitialValue &#123;<br>    <span class="hljs-built_in">bool</span> <span class="hljs-keyword">public</span> _bool;<br>    <span class="hljs-built_in">string</span> <span class="hljs-keyword">public</span> _string;<br>    <span class="hljs-built_in">int</span> <span class="hljs-keyword">public</span> _int;<br>    <span class="hljs-built_in">uint</span> <span class="hljs-keyword">public</span> _uint;<br>    address <span class="hljs-keyword">public</span> _address;<span class="hljs-comment">//0x0000000000000000000000000000000000000000</span><br>    <span class="hljs-function">function <span class="hljs-title">fi</span>()<span class="hljs-keyword">internal</span></span> &#123;&#125;<span class="hljs-comment">//fi å†…éƒ¨å‡½æ•°æ— æ³•è°ƒç”¨</span><br>    <span class="hljs-function">function <span class="hljs-title">fe</span>()external</span> &#123;&#125;<span class="hljs-comment">// ç©ºç™½å‡½æ•°</span><br>&#125;<br></code></pre></td></tr></table></figure></code></pre></li></ul><h3 id="å¼•ç”¨ç±»å‹åˆå§‹å€¼"><a href="#å¼•ç”¨ç±»å‹åˆå§‹å€¼" class="headerlink" title="å¼•ç”¨ç±»å‹åˆå§‹å€¼"></a>å¼•ç”¨ç±»å‹åˆå§‹å€¼</h3><ul><li>æ˜ å°„<code>mapping</code>: æ‰€æœ‰å…ƒç´ éƒ½ä¸ºå…¶é»˜è®¤å€¼çš„<code>mapping</code></li><li>ç»“æ„ä½“<code>struct</code>: æ‰€æœ‰æˆå‘˜è®¾ä¸ºå…¶é»˜è®¤å€¼çš„ç»“æ„ä½“</li><li>æ•°ç»„array<ul><li>åŠ¨æ€æ•°ç»„: <code>[]</code></li><li>é™æ€æ•°ç»„ï¼ˆå®šé•¿ï¼‰: æ‰€æœ‰æˆå‘˜è®¾ä¸ºå…¶é»˜è®¤å€¼çš„é™æ€æ•°ç»„</li></ul></li></ul><p>å¯ä»¥ç”¨<code>public</code>å˜é‡çš„<code>getter</code>å‡½æ•°éªŒè¯ä¸Šé¢å†™çš„åˆå§‹å€¼æ˜¯å¦æ­£ç¡®ï¼š</p><p><code>delete</code>æ“ä½œç¬¦</p><p><code>delete a </code>ä¼šè®©å˜é‡<code>a</code>çš„å€¼å˜ä¸ºåˆå§‹å€¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs solidity">// 3 deleteæ“ä½œç¬¦<br>bool public _bool2=true;<br>function fd()external &#123;<br>    delete _bool2;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="9-å¸¸æ•°-constantå’Œimmutable"><a href="#9-å¸¸æ•°-constantå’Œimmutable" class="headerlink" title="9. å¸¸æ•° constantå’Œimmutable"></a>9. å¸¸æ•° constantå’Œimmutable</h1><p><code>constant</code>:å¸¸æ•°,</p><p><code>immutable</code>ï¼šä¸å˜é‡</p><p>åªæœ‰æ•°å€¼ç±»å‹çš„å¯ä»¥å£°æ˜ç§°constant å’Œ immutable ï¼›</p><p><code>string</code>å’Œ<code>bytes</code>å¯ä»¥å£°æ˜ä¸ºconstant ä½†ä¸èƒ½ä¸ºimmutable;</p><p><code>constant</code>å˜é‡å¿…é¡»åœ¨å£°æ˜çš„æ—¶å€™åˆå§‹åŒ–ï¼Œä¹‹åå†ä¹Ÿä¸èƒ½æ”¹å˜ã€‚å°è¯•æ”¹å˜çš„è¯ï¼Œç¼–è¯‘ä¸é€šè¿‡ã€‚</p><p><code>immutable</code>å˜é‡å¯ä»¥åœ¨å£°æ˜æ—¶æˆ–æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–ï¼Œå› æ­¤æ›´åŠ çµæ´»ã€‚åœ¨<code>Solidity v0.8.21</code>ä»¥åï¼Œ<code>immutable</code>å˜é‡ä¸éœ€è¦æ˜¾å¼åˆå§‹åŒ–ï¼Œæœªæ˜¾å¼åˆå§‹åŒ–çš„<code>immutable</code>å˜é‡å°†ä½¿ç”¨æ•°å€¼ç±»å‹çš„åˆå§‹å€¼ï¼ˆè§ <a href="https://github.com/AmazingAng/WTF-Solidity/blob/main/08_InitialValue/readme.md#%E5%8F%98%E9%87%8F%E5%88%9D%E5%A7%8B%E5%80%BC">8. å˜é‡åˆå§‹å€¼</a>ï¼‰ã€‚åä¹‹ï¼Œåˆ™éœ€è¦æ˜¾å¼åˆå§‹åŒ–ã€‚ è‹¥<code>immutable</code>å˜é‡æ—¢åœ¨å£°æ˜æ—¶åˆå§‹åŒ–ï¼Œåˆåœ¨constructorä¸­åˆå§‹åŒ–ï¼Œä¼šä½¿ç”¨constructoråˆå§‹åŒ–çš„å€¼ã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Solidityç¬”è®°ä¹‹åŸºç¡€å˜é‡</title>
    <link href="/2025/04/22/08-1Solidity%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%8F%98%E9%87%8F%E7%B1%BB%E5%9E%8B/"/>
    <url>/2025/04/22/08-1Solidity%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%8F%98%E9%87%8F%E7%B1%BB%E5%9E%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="Solidityä¸­çš„å˜é‡ç±»å‹"><a href="#Solidityä¸­çš„å˜é‡ç±»å‹" class="headerlink" title="Solidityä¸­çš„å˜é‡ç±»å‹"></a>Solidityä¸­çš„å˜é‡ç±»å‹</h1><ol><li>**å€¼ç±»å‹(Value Type)**ï¼šåŒ…æ‹¬å¸ƒå°”å‹ï¼Œæ•´æ•°å‹ç­‰ç­‰ï¼Œè¿™ç±»å˜é‡èµ‹å€¼æ—¶å€™ç›´æ¥ä¼ é€’æ•°å€¼ã€‚</li><li>**å¼•ç”¨ç±»å‹(Reference Type)**ï¼šåŒ…æ‹¬æ•°ç»„å’Œç»“æ„ä½“ï¼Œè¿™ç±»å˜é‡å ç©ºé—´å¤§ï¼Œèµ‹å€¼æ—¶å€™ç›´æ¥ä¼ é€’åœ°å€ï¼ˆç±»ä¼¼æŒ‡é’ˆï¼‰ã€‚</li><li><strong>æ˜ å°„ç±»å‹(Mapping Type)</strong>: Solidityä¸­å­˜å‚¨é”®å€¼å¯¹çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥ç†è§£ä¸ºå“ˆå¸Œè¡¨</li></ol><p>æˆ‘ä»¬å°†ä»…ä»‹ç»å¸¸ç”¨ç±»å‹ï¼Œä¸å¸¸ç”¨çš„ç±»å‹ä¸ä¼šæ¶‰åŠï¼Œæœ¬ç¯‡å°†ä»‹ç»å€¼ç±»å‹ã€‚</p><h1 id="2-å€¼ç±»å‹"><a href="#2-å€¼ç±»å‹" class="headerlink" title="2. å€¼ç±»å‹"></a>2. å€¼ç±»å‹</h1><h3 id="1-å¸ƒå°”å‹"><a href="#1-å¸ƒå°”å‹" class="headerlink" title="1. å¸ƒå°”å‹"></a>1. å¸ƒå°”å‹</h3><p>å¸ƒå°”å‹æ˜¯äºŒå€¼å˜é‡ï¼Œå–å€¼ä¸º <code>true</code> æˆ– <code>false</code>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs solidity">// å¸ƒå°”å€¼<br>bool public _bool = true; <br>//ç±»å‹ å…¬æœ‰ å€¼åç§°=å€¼<br></code></pre></td></tr></table></figure><p>å¸ƒå°”å€¼çš„è¿ç®—ç¬¦åŒ…æ‹¬ï¼š</p><ul><li><code>!</code> ï¼ˆé€»è¾‘éï¼‰</li><li><code>&amp;&amp;</code> ï¼ˆé€»è¾‘ä¸ï¼Œâ€andâ€ï¼‰</li><li><code>||</code> ï¼ˆé€»è¾‘æˆ–ï¼Œâ€orâ€ï¼‰</li><li><code>==</code> ï¼ˆç­‰äºï¼‰</li><li><code>!=</code> ï¼ˆä¸ç­‰äºï¼‰</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs solidity">// å¸ƒå°”è¿ç®—<br>bool public _bool1 = !_bool; // å–é<br>bool public _bool2 = _bool &amp;&amp; _bool1; // ä¸<br>bool public _bool3 = _bool || _bool1; // æˆ–<br>bool public _bool4 = _bool == _bool1; // ç›¸ç­‰<br>bool public _bool5 = _bool != _bool1; // ä¸ç›¸ç­‰<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼šå˜é‡ <code>_bool</code> çš„å–å€¼æ˜¯ <code>true</code>ï¼›<code>_bool1</code> æ˜¯ <code>_bool</code> çš„éï¼Œä¸º <code>false</code>ï¼›<code>_bool &amp;&amp; _bool1</code> ä¸º <code>false</code>ï¼›<code>_bool || _bool1</code> ä¸º <code>true</code>ï¼›<code>_bool == _bool1</code> ä¸º <code>false</code>ï¼›<code>_bool != _bool1</code> ä¸º <code>true</code>ã€‚</p><p><strong>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼š</strong><code>&amp;&amp;</code> å’Œ <code>||</code> è¿ç®—ç¬¦éµå¾ªçŸ­è·¯è§„åˆ™ï¼Œè¿™æ„å‘³ç€ï¼Œå‡å¦‚å­˜åœ¨ <code>f(x) || g(y)</code> çš„è¡¨è¾¾å¼ï¼Œå¦‚æœ <code>f(x)</code> æ˜¯ <code>true</code>ï¼Œ<code>g(y)</code> ä¸ä¼šè¢«è®¡ç®—ï¼Œå³ä½¿å®ƒå’Œ <code>f(x)</code> çš„ç»“æœæ˜¯ç›¸åçš„ã€‚å‡å¦‚å­˜åœ¨<code>f(x) &amp;&amp; g(y)</code> çš„è¡¨è¾¾å¼ï¼Œå¦‚æœ <code>f(x)</code> æ˜¯ <code>false</code>ï¼Œ<code>g(y)</code> ä¸ä¼šè¢«è®¡ç®—ã€‚ æ‰€è°“â€œçŸ­è·¯è§„åˆ™â€ï¼Œä¸€èˆ¬å‡ºç°åœ¨é€»è¾‘ä¸ï¼ˆ&amp;&amp;ï¼‰å’Œé€»è¾‘æˆ–ï¼ˆ||ï¼‰ä¸­ã€‚ å½“é€»è¾‘ä¸ï¼ˆ&amp;&amp;ï¼‰çš„ç¬¬ä¸€ä¸ªæ¡ä»¶ä¸ºfalseæ—¶ï¼Œå°±ä¸ä¼šå†å»åˆ¤æ–­ç¬¬äºŒä¸ªæ¡ä»¶ï¼› å½“é€»è¾‘æˆ–ï¼ˆ||ï¼‰çš„ç¬¬ä¸€ä¸ªæ¡ä»¶ä¸ºtrueæ—¶ï¼Œå°±ä¸ä¼šå†å»åˆ¤æ–­ç¬¬äºŒä¸ªæ¡ä»¶ï¼Œè¿™å°±æ˜¯çŸ­è·¯è§„åˆ™ã€‚</p><h3 id="2-æ•´å‹"><a href="#2-æ•´å‹" class="headerlink" title="2. æ•´å‹"></a>2. æ•´å‹</h3><p>æ•´å‹æ˜¯ Solidity ä¸­çš„æ•´æ•°ï¼Œæœ€å¸¸ç”¨çš„åŒ…æ‹¬ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs solidity">// æ•´å‹<br>int public _int = -1; // æ•´æ•°ï¼ŒåŒ…æ‹¬è´Ÿæ•°<br>uint public _uint = 1; // æ— ç¬¦å·æ•´æ•°<br>uint256 public _number = 20220330; // 256ä½æ— ç¬¦å·æ•´æ•°<br></code></pre></td></tr></table></figure><p>å¸¸ç”¨çš„æ•´å‹è¿ç®—ç¬¦åŒ…æ‹¬ï¼š</p><ul><li>æ¯”è¾ƒè¿ç®—ç¬¦ï¼ˆè¿”å›å¸ƒå°”å€¼ï¼‰ï¼š <code>&lt;=</code>ï¼Œ <code>&lt;</code>ï¼Œ<code>==</code>ï¼Œ <code>!=</code>ï¼Œ <code>&gt;=</code>ï¼Œ <code>&gt;</code></li><li>ç®—æœ¯è¿ç®—ç¬¦ï¼š <code>+</code>ï¼Œ <code>-</code>ï¼Œ <code>*</code>ï¼Œ <code>/</code>ï¼Œ <code>%</code>ï¼ˆå–ä½™ï¼‰ï¼Œ<code>**</code>ï¼ˆå¹‚ï¼‰</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs solidity">// æ•´æ•°è¿ç®—<br>uint256 public _number1 = _number + 1; // +ï¼Œ-ï¼Œ*ï¼Œ/<br>uint256 public _number2 = 2**2; // æŒ‡æ•°<br>uint256 public _number3 = 7 % 2; // å–ä½™æ•°<br>bool public _numberbool = _number2 &gt; _number3; // æ¯”å¤§å°<br></code></pre></td></tr></table></figure><p>å¤§å®¶å¯ä»¥è¿è¡Œä¸€ä¸‹ä»£ç ï¼Œçœ‹çœ‹è¿™ 4 ä¸ªå˜é‡åˆ†åˆ«æ˜¯å¤šå°‘ã€‚</p><h3 id="3-åœ°å€ç±»å‹"><a href="#3-åœ°å€ç±»å‹" class="headerlink" title="3. åœ°å€ç±»å‹"></a>3. åœ°å€ç±»å‹</h3><p>åœ°å€ç±»å‹æœ‰ä¸¤ç±»ï¼š</p><ul><li>æ™®é€šåœ°å€: å­˜å‚¨ä¸€ä¸ª 20 å­—èŠ‚çš„å€¼ï¼ˆä»¥å¤ªåŠåœ°å€çš„å¤§å°ï¼‰ã€‚</li><li>Payable address ï¼šæ¯”æ™®é€šåœ°å€å¤šäº†<code>transfer</code>å’Œ<code>send</code>ä¸¤ä¸ªæˆå‘˜æ–¹æ³•ï¼Œç”¨äºæ¥æ”¶è½¬è´¦ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs solidity">// åœ°å€<br>address public _address = 0x7A58c0Be72BE218B41C608b7Fe7C5bB630736C71;<br>address payable public _address1 = payable(_address); // payable addressï¼Œå¯ä»¥è½¬è´¦ã€æŸ¥ä½™é¢<br>// åœ°å€ç±»å‹çš„æˆå‘˜<br>uint256 public balance = _address1.balance; // balance of address<br></code></pre></td></tr></table></figure><h3 id="4-å®šé•¿å­—èŠ‚æ•°ç»„"><a href="#4-å®šé•¿å­—èŠ‚æ•°ç»„" class="headerlink" title="4. å®šé•¿å­—èŠ‚æ•°ç»„"></a>4. å®šé•¿å­—èŠ‚æ•°ç»„</h3><p>å­—èŠ‚æ•°ç»„æ°›å›´å®šé•¿å’Œä¸å®šé•¿ä¸¤ç§</p><ul><li>å®šé•¿å­—èŠ‚æ•°ç»„ï¼šå±äºå€¼ç±»å‹ï¼Œæ•°ç»„é•¿åº¦åœ¨å£°æ˜ä¹‹åä¸èƒ½æ”¹å˜ã€‚æ ¹æ®å­—èŠ‚æ•°ç»„çš„é•¿åº¦åˆ†ä¸º <code>bytes1</code>, <code>bytes8</code>, <code>bytes32</code> ç­‰ç±»å‹ã€‚å®šé•¿å­—èŠ‚æ•°ç»„æœ€å¤šå­˜å‚¨ 32 bytes æ•°æ®ï¼Œå³<code>bytes32</code>ã€‚</li><li><strong>ä¸å®šé•¿å­—èŠ‚æ•°ç»„</strong>: å±äºå¼•ç”¨ç±»å‹ï¼ˆä¹‹åçš„ç« èŠ‚ä»‹ç»ï¼‰ï¼Œæ•°ç»„é•¿åº¦åœ¨å£°æ˜ä¹‹åå¯ä»¥æ”¹å˜ï¼ŒåŒ…æ‹¬ <code>bytes</code> ç­‰ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs solidity">// å›ºå®šé•¿åº¦çš„å­—èŠ‚æ•°ç»„<br>bytes32 public _byte32 = &quot;MiniSolidity&quot;; // å­—èŠ‚å½¢å¼<br>bytes1 public _byte = _byte32[0]; // å–å…¶ç¬¬ä¸€ä¸ªå­—èŠ‚<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œå­—ç¬¦ä¸² <code>MiniSolidity</code> ä»¥å­—èŠ‚çš„æ–¹å¼å­˜å‚¨è¿›å˜é‡ <code>_byte32</code>ã€‚å¦‚æœæŠŠå®ƒè½¬æ¢æˆ <code>16 è¿›åˆ¶</code>ï¼Œå°±æ˜¯ï¼š<code>0x4d696e69536f6c69646974790000000000000000000000000000000000000000</code></p><p><code>_byte</code> å˜é‡çš„å€¼ä¸º <code>_byte32</code> çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œå³ <code>0x4d</code>ã€‚</p><h3 id="5-æšä¸¾-enum"><a href="#5-æšä¸¾-enum" class="headerlink" title="5. æšä¸¾ enum"></a>5. æšä¸¾ enum</h3><p>æšä¸¾ï¼ˆ<code>enum</code>ï¼‰æ˜¯ Solidity ä¸­ç”¨æˆ·å®šä¹‰çš„æ•°æ®ç±»å‹ã€‚å®ƒä¸»è¦ç”¨äºä¸º <code>uint</code> åˆ†é…åç§°ï¼Œä½¿ç¨‹åºæ˜“äºé˜…è¯»å’Œç»´æŠ¤ã€‚å®ƒä¸ <code>C è¯­è¨€</code> ä¸­çš„ <code>enum</code> ç±»ä¼¼ï¼Œä½¿ç”¨åç§°æ¥ä»£æ›¿ä» <code>0</code> å¼€å§‹çš„ <code>uint</code>ï¼š</p><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs fortran">// ç”¨<span class="hljs-keyword">enum</span>å°†uint <span class="hljs-number">0</span>ï¼Œ <span class="hljs-number">1</span>ï¼Œ <span class="hljs-number">2</span>è¡¨ç¤ºä¸ºBuy, Hold, Sell<br><span class="hljs-keyword">enum</span> ActionSet &#123; Buy, Hold, Sell &#125;<br>// åˆ›å»º<span class="hljs-keyword">enum</span>å˜é‡ <span class="hljs-keyword">action</span><br>ActionSet <span class="hljs-keyword">action</span> = ActionSet.Buy;<br></code></pre></td></tr></table></figure><p>æšä¸¾å¯ä»¥æ˜¾å¼åœ°å’Œ <code>uint</code> ç›¸äº’è½¬æ¢ï¼Œå¹¶ä¼šæ£€æŸ¥è½¬æ¢çš„æ— ç¬¦å·æ•´æ•°æ˜¯å¦åœ¨æšä¸¾çš„é•¿åº¦å†…ï¼Œå¦åˆ™ä¼šæŠ¥é”™ï¼š</p><figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs scss"><span class="hljs-comment">// enumå¯ä»¥å’Œuintæ˜¾å¼çš„è½¬æ¢</span><br>function <span class="hljs-built_in">enumToUint</span>() external view <span class="hljs-built_in">returns</span>(uint)&#123;<br>    return <span class="hljs-built_in">uint</span>(action);<br>&#125;<br></code></pre></td></tr></table></figure><p><strong><code>enum</code> æ˜¯ä¸€ä¸ªæ¯”è¾ƒå†·é—¨çš„æ•°æ®ç±»å‹ï¼Œå‡ ä¹æ²¡ä»€ä¹ˆäººç”¨ã€‚</strong></p><h1 id="3-å‡½æ•°"><a href="#3-å‡½æ•°" class="headerlink" title="3. å‡½æ•°"></a>3. å‡½æ•°</h1><h2 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h2><p>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹ Solidity ä¸­å‡½æ•°çš„å½¢å¼:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs solidity">function &lt;function name&gt;([parameter types[, ...]]) &#123;internal|external|public|private&#125; [pure|view|payable] [virtual|override] [&lt;modifiers&gt;]<br>[returns (&lt;return types&gt;)]&#123; &lt;function body&gt; &#125;<br></code></pre></td></tr></table></figure><p>çœ‹ç€æœ‰ä¸€äº›å¤æ‚ï¼Œè®©æˆ‘ä»¬ä»å‰å¾€åé€ä¸ªè§£é‡Š(æ–¹æ‹¬å·ä¸­çš„æ˜¯å¯å†™å¯ä¸ å†™çš„å…³é”®å­—)ï¼š</p><ol><li><p><code>function</code>ï¼šå£°æ˜å‡½æ•°æ—¶çš„å›ºå®šç”¨æ³•ã€‚è¦ç¼–å†™å‡½æ•°ï¼Œå°±éœ€è¦ä»¥ <code>function</code> å…³é”®å­—å¼€å¤´ã€‚</p></li><li><p><code>&lt;function name&gt;</code>ï¼šå‡½æ•°åã€‚</p></li><li><p><code>([parameter types[, ...]])</code>ï¼šåœ†æ‹¬å·å†…å†™å…¥å‡½æ•°çš„å‚æ•°ï¼Œå³è¾“å…¥åˆ°å‡½æ•°çš„å˜é‡ç±»å‹å’Œåç§°ã€‚</p></li><li><p><code>&#123;internal|external|public|private&#125;</code>ï¼šå‡½æ•°å¯è§æ€§è¯´æ˜ç¬¦ï¼Œå…±æœ‰4ç§ã€‚</p><ul><li><code>public</code>ï¼šå†…éƒ¨å’Œå¤–éƒ¨å‡å¯è§ã€‚</li><li><code>private</code>ï¼šåªèƒ½ä»æœ¬åˆçº¦å†…éƒ¨è®¿é—®ï¼Œç»§æ‰¿çš„åˆçº¦ä¹Ÿä¸èƒ½ä½¿ç”¨ã€‚</li><li><code>external</code>ï¼šåªèƒ½ä»åˆçº¦å¤–éƒ¨è®¿é—®ï¼ˆä½†å†…éƒ¨å¯ä»¥é€šè¿‡ <code>this.f()</code> æ¥è°ƒç”¨ï¼Œ<code>f</code>æ˜¯å‡½æ•°åï¼‰ã€‚</li><li><code>internal</code>: åªèƒ½ä»åˆçº¦å†…éƒ¨è®¿é—®ï¼Œç»§æ‰¿çš„åˆçº¦å¯ä»¥ç”¨ã€‚</li></ul><p><strong>æ³¨æ„ 1</strong>ï¼šåˆçº¦ä¸­å®šä¹‰çš„å‡½æ•°éœ€è¦æ˜ç¡®æŒ‡å®šå¯è§æ€§ï¼Œå®ƒä»¬æ²¡æœ‰é»˜è®¤å€¼ã€‚</p><p><strong>æ³¨æ„ 2</strong>ï¼š<code>public|private|internal</code> ä¹Ÿå¯ç”¨äºä¿®é¥°çŠ¶æ€å˜é‡(å®šä¹‰å¯å‚è€ƒ<a href="https://github.com/AmazingAng/WTF-Solidity/blob/main/03_Function/[../05_DataStorage/readme.md#1-%E7%8A%B6%E6%80%81%E5%8F%98%E9%87%8F](https:/github.com/AmazingAng/WTF-Solidity/tree/main/05_DataStorage#1-%E7%8A%B6%E6%80%81%E5%8F%98%E9%87%8F)">WTF Solidity ç¬¬5è®²çš„ç›¸å…³å†…å®¹</a>)ã€‚<code>public</code>å˜é‡ä¼šè‡ªåŠ¨ç”ŸæˆåŒåçš„<code>getter</code>å‡½æ•°ï¼Œç”¨äºæŸ¥è¯¢æ•°å€¼ã€‚æœªæ ‡æ˜å¯è§æ€§ç±»å‹çš„çŠ¶æ€å˜é‡ï¼Œé»˜è®¤ä¸º<code>internal</code>ã€‚</p></li><li><p><code>[pure|view|payable]</code>ï¼šå†³å®šå‡½æ•°æƒé™&#x2F;åŠŸèƒ½çš„å…³é”®å­—ã€‚<code>payable</code>ï¼ˆå¯æ”¯ä»˜çš„ï¼‰å¾ˆå¥½ç†è§£ï¼Œå¸¦ç€å®ƒçš„å‡½æ•°ï¼Œè¿è¡Œçš„æ—¶å€™å¯ä»¥ç»™åˆçº¦è½¬å…¥ ETHã€‚<code>pure</code> å’Œ <code>view</code> çš„ä»‹ç»è§ä¸‹ä¸€èŠ‚ã€‚</p></li><li><p><code>[virtual|override]</code>: æ–¹æ³•æ˜¯å¦å¯ä»¥è¢«é‡å†™ï¼Œæˆ–è€…æ˜¯å¦æ˜¯é‡å†™æ–¹æ³•ã€‚<code>virtual</code>ç”¨åœ¨çˆ¶åˆçº¦ä¸Šï¼Œæ ‡è¯†çš„æ–¹æ³•å¯ä»¥è¢«å­åˆçº¦é‡å†™ã€‚<code>override</code>ç”¨åœ¨å­åˆçº¦ä¸Šï¼Œè¡¨åæ–¹æ³•é‡å†™äº†çˆ¶åˆçº¦çš„æ–¹æ³•ã€‚</p></li><li><p><code>&lt;modifiers&gt;</code>: è‡ªå®šä¹‰çš„ä¿®é¥°å™¨ï¼Œå¯ä»¥æœ‰0ä¸ªæˆ–å¤šä¸ªä¿®é¥°å™¨ã€‚</p></li><li><p><code>[returns ()]</code>ï¼šå‡½æ•°è¿”å›çš„å˜é‡ç±»å‹å’Œåç§°ã€‚</p></li><li><p><code>&lt;function body&gt;</code>: å‡½æ•°ä½“ã€‚</p></li></ol><h2 id="åˆ°åº•ä»€ä¹ˆæ˜¯-Pure-å’ŒViewï¼Ÿ"><a href="#åˆ°åº•ä»€ä¹ˆæ˜¯-Pure-å’ŒViewï¼Ÿ" class="headerlink" title="åˆ°åº•ä»€ä¹ˆæ˜¯ Pure å’ŒViewï¼Ÿ"></a>åˆ°åº•ä»€ä¹ˆæ˜¯ <code>Pure</code> å’Œ<code>View</code>ï¼Ÿ</h2><p>åˆšå¼€å§‹å­¦ä¹  <code>solidity</code> æ—¶ï¼Œ<code>pure</code> å’Œ <code>view</code> å…³é”®å­—å¯èƒ½ä»¤äººè´¹è§£ï¼Œå› ä¸ºå…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸­æ²¡æœ‰ç±»ä¼¼çš„å…³é”®å­—ã€‚<code>solidity</code> å¼•å…¥è¿™ä¸¤ä¸ªå…³é”®å­—ä¸»è¦æ˜¯å› ä¸º ä»¥å¤ªåŠäº¤æ˜“éœ€è¦æ”¯ä»˜æ°”è´¹ï¼ˆgas feeï¼‰ã€‚åˆçº¦çš„çŠ¶æ€å˜é‡å­˜å‚¨åœ¨é“¾ä¸Šï¼Œgas fee å¾ˆè´µï¼Œå¦‚æœè®¡ç®—ä¸æ”¹å˜é“¾ä¸ŠçŠ¶æ€ï¼Œå°±å¯ä»¥ä¸ç”¨ä»˜ <code>gas</code>ã€‚åŒ…å« <code>pure</code> å’Œ <code>view</code> å…³é”®å­—çš„å‡½æ•°æ˜¯ä¸æ”¹å†™é“¾ä¸ŠçŠ¶æ€çš„ï¼Œå› æ­¤ç”¨æˆ·ç›´æ¥è°ƒç”¨å®ƒä»¬æ˜¯ä¸éœ€è¦ä»˜ gas çš„ï¼ˆæ³¨æ„ï¼Œåˆçº¦ä¸­é <code>pure</code>&#x2F;<code>view</code> å‡½æ•°è°ƒç”¨ <code>pure</code>&#x2F;<code>view</code> å‡½æ•°æ—¶éœ€è¦ä»˜gasï¼‰ã€‚</p><p>åœ¨ä»¥å¤ªåŠä¸­ï¼Œä»¥ä¸‹è¯­å¥è¢«è§†ä¸ºä¿®æ”¹é“¾ä¸ŠçŠ¶æ€ï¼š</p><ol><li>å†™å…¥çŠ¶æ€å˜é‡ã€‚</li><li>é‡Šæ”¾äº‹ä»¶ã€‚</li><li>åˆ›å»ºå…¶ä»–åˆçº¦ã€‚</li><li>ä½¿ç”¨ <code>selfdestruct</code>.</li><li>é€šè¿‡è°ƒç”¨å‘é€ä»¥å¤ªå¸ã€‚</li><li>è°ƒç”¨ä»»ä½•æœªæ ‡è®° <code>view</code> æˆ– <code>pure</code> çš„å‡½æ•°ã€‚</li><li>ä½¿ç”¨ä½çº§è°ƒç”¨ï¼ˆlow-level callsï¼‰ã€‚</li><li>ä½¿ç”¨åŒ…å«æŸäº›æ“ä½œç çš„å†…è”æ±‡ç¼–ã€‚</li></ol><ul><li><code>pure</code>ï¼Œä¸­æ–‡æ„æ€æ˜¯â€œçº¯â€ï¼Œè¿™é‡Œå¯ä»¥ç†è§£ä¸ºâ€çº¯æ‰“é…±æ²¹çš„â€ã€‚<code>pure</code> å‡½æ•°æ—¢ä¸èƒ½è¯»å–ä¹Ÿä¸èƒ½å†™å…¥é“¾ä¸Šçš„çŠ¶æ€å˜é‡ã€‚å°±åƒå°æ€ªä¸€æ ·ï¼Œçœ‹ä¸åˆ°ä¹Ÿæ‘¸ä¸åˆ°ç¢§çªå…¬ä¸»ã€‚</li><li><code>view</code>ï¼Œâ€œçœ‹â€ï¼Œè¿™é‡Œå¯ä»¥ç†è§£ä¸ºâ€œçœ‹å®¢â€ã€‚<code>view</code>å‡½æ•°èƒ½è¯»å–ä½†ä¹Ÿä¸èƒ½å†™å…¥çŠ¶æ€å˜é‡ã€‚ç±»ä¼¼é©¬é‡Œå¥¥ï¼Œèƒ½çœ‹åˆ°ç¢§çªå…¬ä¸»ï¼Œä½†ç»ˆç©¶æ˜¯çœ‹å®¢ï¼Œä¸èƒ½å…¥æ´æˆ¿ã€‚</li><li>é <code>pure</code> æˆ– <code>view</code> çš„å‡½æ•°æ—¢å¯ä»¥è¯»å–ä¹Ÿå¯ä»¥å†™å…¥çŠ¶æ€å˜é‡ã€‚ç±»ä¼¼é©¬é‡Œå¥¥é‡Œçš„ <code>boss</code>ï¼Œå¯ä»¥å¯¹ç¢§çªå…¬ä¸»ä¸ºæ‰€æ¬²ä¸ºğŸ¶ã€‚</li></ul><h1 id="4-å‡½æ•°è¾“å‡º"><a href="#4-å‡½æ•°è¾“å‡º" class="headerlink" title="4. å‡½æ•°è¾“å‡º"></a>4. å‡½æ•°è¾“å‡º</h1><h2 id="è¿”å›å€¼ï¼šreturn-å’Œ-returns"><a href="#è¿”å›å€¼ï¼šreturn-å’Œ-returns" class="headerlink" title="è¿”å›å€¼ï¼šreturn å’Œ returns"></a>è¿”å›å€¼ï¼šreturn å’Œ returns</h2><p>åœ¨å‡½æ•°å®šä¹‰è¡Œä¸­æœ‰ä¸¤ä¸ªå…³é”®å­—<code>return</code>å’Œ<code>returns</code>ï¼Œä»–ä»¬åŒºåˆ«æ˜¯ï¼š</p><ul><li><code>return</code>è·Ÿåœ¨å‡½æ•°ååé¢ï¼Œç”¨äºå£°æ˜è¿”å›çš„å˜é‡ç±»å‹ä»¥åŠå˜é‡åç§°</li><li><code>return</code>:ç”¨äºå‡½æ•°ä¸»é¢˜ä¸­ï¼Œè¿”å›æŒ‡å®šçš„å˜é‡</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs solidity">// è¿”å›å¤šä¸ªå˜é‡<br>function returnMultiple() public pure returns(uint256, bool, uint256[3] memory)&#123;<br>    return(1, true, [uint256(1),2,5]);<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ©ç”¨ <code>returns</code> å…³é”®å­—å£°æ˜äº†æœ‰å¤šä¸ªè¿”å›å€¼çš„ <code>returnMultiple()</code> å‡½æ•°ï¼Œç„¶åæˆ‘ä»¬åœ¨å‡½æ•°ä¸»ä½“ä¸­ä½¿ç”¨ <code>return(1, true, [uint256(1),2,5])</code> ç¡®å®šäº†è¿”å›å€¼ã€‚</p><p>è¿™é‡Œ<code>uint256[3]</code>å£°æ˜äº†ä¸€ä¸ªé•¿åº¦ä¸º<code>3</code>ä¸”ç±»å‹ä¸º<code>uint256</code>çš„æ•°ç»„ä½œä¸ºè¿”å›å€¼ã€‚å› ä¸º<code>[1,2,3]</code>ä¼šé»˜è®¤ä¸º<code>uint8(3)</code>ï¼Œå› æ­¤<code>[uint256(1),2,5]</code>ä¸­é¦–ä¸ªå…ƒç´ å¿…é¡»å¼ºè½¬</p><h2 id="å‘½åå¼è¿”å›"><a href="#å‘½åå¼è¿”å›" class="headerlink" title="å‘½åå¼è¿”å›"></a>å‘½åå¼è¿”å›</h2><p>æˆ‘ä»¬å¯ä»¥åœ¨ <code>returns</code> ä¸­æ ‡æ˜è¿”å›å˜é‡çš„åç§°ã€‚Solidity ä¼šåˆå§‹åŒ–è¿™äº›å˜é‡ï¼Œå¹¶ä¸”è‡ªåŠ¨è¿”å›è¿™äº›å˜é‡çš„å€¼ï¼Œæ— éœ€ä½¿ç”¨ <code>return</code>ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs solidity">// å‘½åå¼è¿”å›<br>function returnNamed() public pure returns(uint256 _number, bool _bool, uint256[3] memory _array)&#123;<br>    _number = 2;<br>    _bool = false;<br>    _array = [uint256(3),2,1];<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬ç”¨ <code>returns(uint256 _number, bool _bool, uint256[3] memory _array)</code> å£°æ˜äº†è¿”å›å˜é‡ç±»å‹ä»¥åŠå˜é‡åã€‚è¿™æ ·ï¼Œåœ¨ä¸»ä½“ä¸­åªéœ€ä¸ºå˜é‡ <code>_number</code>ã€<code>_bool</code>å’Œ<code>_array</code> èµ‹å€¼ï¼Œå³å¯è‡ªåŠ¨è¿”å›ã€‚</p><p>å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨å‘½åå¼è¿”å›ä¸­ç”¨ <code>return</code> æ¥è¿”å›å˜é‡ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs solidity">// å‘½åå¼è¿”å›ï¼Œä¾ç„¶æ”¯æŒreturn<br>function returnNamed2() public pure returns(uint256 _number, bool _bool, uint256[3] memory _array)&#123;<br>    return(1, true, [uint256(1),2,5]);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="è§£æ„å¼èµ‹å€¼"><a href="#è§£æ„å¼èµ‹å€¼" class="headerlink" title="è§£æ„å¼èµ‹å€¼"></a>è§£æ„å¼èµ‹å€¼</h2><p>Solidity æ”¯æŒä½¿ç”¨è§£æ„å¼èµ‹å€¼è§„åˆ™æ¥è¯»å–å‡½æ•°çš„å…¨éƒ¨æˆ–éƒ¨åˆ†è¿”å›å€¼ã€‚</p><ul><li><p>è¯»å–æ‰€æœ‰è¿”å›å€¼ï¼šå£°æ˜å˜é‡ï¼Œç„¶åå°†è¦èµ‹å€¼çš„å˜é‡ç”¨<code>,</code>éš”å¼€ï¼ŒæŒ‰é¡ºåºæ’åˆ—ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs solidity">uint256 _number;<br>bool _bool;<br>uint256[3] memory _array;<br>(_number, _bool, _array) = returnNamed();<br></code></pre></td></tr></table></figure></li><li><p>è¯»å–éƒ¨åˆ†è¿”å›å€¼ï¼šå£°æ˜è¦è¯»å–çš„è¿”å›å€¼å¯¹åº”çš„å˜é‡ï¼Œä¸è¯»å–çš„ç•™ç©ºã€‚åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬åªè¯»å–<code>_bool</code>ï¼Œè€Œä¸è¯»å–è¿”å›çš„<code>_number</code>å’Œ<code>_array</code>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs solidity">(, _bool2, ) = returnNamed();<br></code></pre></td></tr></table></figure></li></ul><p>å¦‚æœä¸¤ä¸ªå¸ç§å‘ç”Ÿè¾ƒå¤§æ±‡ç‡çš„å˜åŒ–å°±ä¼šæœ‰æŸå¤±</p><h1 id="5-å˜é‡æ•°æ®å­˜å‚¨å’Œä½œç”¨åŸŸ"><a href="#5-å˜é‡æ•°æ®å­˜å‚¨å’Œä½œç”¨åŸŸ" class="headerlink" title="5. å˜é‡æ•°æ®å­˜å‚¨å’Œä½œç”¨åŸŸ"></a>5. å˜é‡æ•°æ®å­˜å‚¨å’Œä½œç”¨åŸŸ</h1><p>å¼•ç”¨ç±»å‹(Reference Type) ï¼šåŒ…æ‹¬æ•°ç»„(array)å’Œç»“æ„ä½“(struct)ï¼Œç”±äºè¿™ç±»å˜é‡çš„ç±»å‹æ¯”è¾ƒå¤æ‚ä¸”å ç”¨ç©ºé—´æ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥ä½¿ç”¨çš„æ—¶å€™å¿…é¡»è¦å£°æ˜æ•°æ®æ‰€å­˜å‚¨çš„ä½ç½®ï¼Œ</p><h2 id="æ•°æ®ä½ç½®"><a href="#æ•°æ®ä½ç½®" class="headerlink" title="æ•°æ®ä½ç½®"></a>æ•°æ®ä½ç½®</h2><p>æ•°æ®çš„ä½ç½®åŒ…å«ä¸‰ç§ç±»å‹<code>storage</code>,<code>memory</code>,<code>calldata</code></p><ul><li><p><code>storage</code>ï¼šåˆçº¦é‡Œçš„çŠ¶æ€å˜é‡é»˜è®¤æ˜¯storageï¼Œå­˜å‚¨åœ¨é“¾ä¸Šçš„ï¼Œç±»ä¼¼è®¡ç®—æœºçš„ç¡¬ç›˜â€”ä¸€ç§æŒä¹…åŒ–å­˜å‚¨ï¼Œç”±é“¾å¸®ä½ æŒä¹…åŒ–ï¼Œæ‰€ä»¥å½±å“äº†é“¾ï¼Œæ‰€ä»¥æ¶ˆè€—çš„gasæ¯”è¾ƒå¤§</p></li><li><p><code>memory</code>:å‡½æ•°é‡Œçš„å‚æ•°å’Œä¸´æ—¶ä½¿ç”¨çš„å˜é‡ä¸€èˆ¬ç”¨memoryï¼Œè§åçŸ¥æ„ï¼Œå†…å­˜ï¼Œå­˜å‚¨åœ¨å†…å­˜ä¸­çš„ï¼Œä¸ä¸Šé“¾ï¼Œå°¤å…¶æ˜¯å½“è¿”å›æ•°æ®ç±»å‹æ˜¯<strong>å˜é•¿</strong>çš„æƒ…å†µä¸‹ï¼Œå¿…é¡»åŠ memoryä¿®é¥°ï¼Œä¾‹å¦‚ï¼šstring,bytesï¼Œarrayå’Œè‡ªå®šä¹‰ç»“æ„ï¼Œ</p></li><li><p><code>calldata</code>ï¼šå’Œ<code>memory</code>ç±»ä¼¼ï¼Œä¹Ÿæ˜¯å‚¨å­˜åœ¨å†…å­˜ä¸­ï¼Œä¸ä¸Šé“¾ï¼Œä¸åŒç‚¹æ˜¯ä¸èƒ½ä¿®å¯’è¿™ä¸ªå˜é‡ï¼Œä¸€èˆ¬ç”¨äºå‡½æ•°çš„å‚æ•°ï¼Œå…¥å‚è¿›æ¥åä¸ä¼šè¢«æ”¹å˜ï¼šå¦‚</p></li><li><pre><code class="solidity">function fCallData(uint[] calldata _x)public pure returns (uint[] calldata) &#123;        // _x[0]=0; // å½“ä½ ä¿®æ”¹çš„æ—¶å€™ï¼Œå°±ä¼šæŠ¥é”™TypeError: Calldata arrays are read-only.        return (_x);    &#125;<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><br><span class="hljs-meta">### æ•°æ®ä½ç½®å’Œèµ‹å€¼è§„åˆ™</span><br><br>èµ‹å€¼çš„æœ¬è´¨æ˜¯åˆ›å»ºå¼•ç”¨æŒ‡å‘æœ¬åœŸï¼Œå› æ­¤ä¿®æ”¹æœ¬ä½“æˆ–è€…æ˜¯ä¿®æ”¹å¼•ç”¨ï¼Œå˜åŒ–å¯ä»¥è¢«åŒæ­¥<br><br>- `storage`(åˆçº¦çš„çŠ¶æ€å˜é‡)èµ‹å€¼ç»™æœ¬åœ°`storage`ï¼ˆå‡½æ•°é‡Œçš„ï¼‰æ—¶å€™ï¼Œä¼šåˆ›å»ºå¼•ç”¨ï¼Œæ”¹å˜æ–°å˜é‡ä¼šå½±å“åŸæ¥çš„å˜é‡ã€‚ä¾‹å¦‚a<br><br>```solidity<br>    <span class="hljs-built_in">uint</span>[] x =[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>];<br>    <span class="hljs-function">function <span class="hljs-title">sStorage</span>() <span class="hljs-keyword">public</span></span> &#123;<br>        <span class="hljs-built_in">uint</span>[] storage xStorage = x; <span class="hljs-comment">// xStorageæ˜¯uint[]ç±»å‹ï¼Œä½ç½®æ˜¯storageï¼Œå¼•ç”¨äº†xï¼Œå½“ä¿®æ”¹xStorageçš„æ—¶å€™ï¼Œxä¹Ÿä¼šè¢«ä¿®æ”¹ï¼Œ</span><br>        xStorage[<span class="hljs-number">0</span>]=<span class="hljs-number">101</span>;<span class="hljs-comment">//å½“æˆ‘ä»¬è°ƒç”¨äº†Sstorageæ–¹æ³•çš„æ—¶å€™å°±xStorageä»¥åŠxçš„ç¬¬1ä¸ªå…ƒç´ æ”¹æˆ100ï¼Œ</span><br>        <span class="hljs-comment">// åœ¨debugçš„æ—¶å€™å¯ä»¥çœ‹åˆ°xçš„ç¬¬1ä¸ªå…ƒç´ ä¸€å¼€æ˜¯1 ï¼Œåé¢å˜æˆäº†100</span><br>        <br>    &#125;<br>    <span class="hljs-comment">// ä¸ºäº†æ›´æ–¹ä¾¿è§‚å¯Ÿã€‚å†™äº†ä¸€ä¸ªgetXæ–¹æ³•æ¥æŸ¥è¯¢xçš„å€¼ï¼Œå½“è°ƒç”¨äº†sStorageåxçš„ç¬¬ä¸€ä¸ªå…ƒç´ å°±å˜æˆäº†101äº†ï¼›</span><br>    <span class="hljs-function">function <span class="hljs-title">getX</span>() <span class="hljs-keyword">public</span> view <span class="hljs-title">returns</span> (<span class="hljs-params"><span class="hljs-built_in">uint</span>[] memory</span>)</span>&#123;<br>        <span class="hljs-keyword">return</span> (x);<br>    &#125;<br></code></pre></td></tr></table></figure></code></pre></li><li><p><code>memory</code>èµ‹å€¼ç»™<code>memory</code>ï¼Œä¼šåˆ›å»ºå¼•ç”¨ï¼Œæ”¹å˜æ–°å˜é‡ä¼šå½±å“åŸå˜é‡ã€‚</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs solidity"><br>uint[] y  =[1,2,3]; // åœ¨å‡½æ•°ä¹‹å¤–å®šä¹‰çš„å˜é‡ï¼Œé»˜è®¤å°±æ˜¯stroageç±»å‹çš„ï¼Œ<br><br><br>function yMemory() public view &#123;<br>    uint[] memory ymemory = y; // yæ˜¯storageç±»çš„ï¼Œymemoryæ˜¯å¼•ç”¨äº†yï¼Œæ‰€ä»¥ä¿®æ”¹ymemoryçš„æ—¶å€™ä¸ä¼šä¿®æ”¹åˆ°y<br>    ymemory[0]=101;<br>    <br>&#125;<br>// æˆ‘ä»¬è°ƒç”¨getYçš„æ—¶å€™å°±ä¼šå‘ç°ï¼Œå…¶å®yMemoryæ–¹æ³•å¹¶ä¸èƒ½ä¿®æ”¹yçš„å€¼ï¼Œè¿™å°±æ˜¯å¼•ç”¨<br>function getY() public view returns (uint[] memory)&#123;<br>    return (y);<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>å…¶ä»–æƒ…å†µä¸‹ï¼Œèµ‹å€¼åˆ›å»ºçš„æ˜¯æœ¬ä½“çš„å‰¯æœ¬ï¼Œå³å¯¹äºŒè€…ä¹‹ä¸€çš„ä¿®æ”¹ï¼Œå¹¶ä¸ä¼šåŒæ­¥åˆ°å¦ä¸€æ–¹ã€‚è¿™æœ‰æ—¶ä¼šæ¶‰åŠåˆ°å¼€å‘ä¸­çš„é—®é¢˜ï¼Œæ¯”å¦‚ä»<code>storage</code>ä¸­è¯»å–æ•°æ®ï¼Œèµ‹å€¼ç»™<code>memory</code>ï¼Œç„¶åä¿®æ”¹<code>memory</code>çš„æ•°æ®ï¼Œä½†å¦‚æœæ²¡æœ‰å°†<code>memory</code>çš„æ•°æ®èµ‹å€¼å›<code>storage</code>ï¼Œé‚£ä¹ˆ<code>storage</code>çš„æ•°æ®æ˜¯ä¸ä¼šæ”¹å˜çš„ã€‚ä¸Šé¢çš„ä¾‹å­å°±æ˜¯æŒ‡çš„å…¶ä»–æƒ…å†µï¼Œæ˜¯storage ç±»å‹è¢«memoryç±»å‹æ”¹å˜ï¼Œå®é™…æ˜¯æ”¹å˜ä¸æˆåŠŸçš„</li><li>è¿˜æœ‰ä¸€ç§æƒ…å†µå°±æ˜¯memoryç±»å‹çš„è¢«memoryç±»å‹çš„ä¿®æ”¹ï¼Œè¿™ä¸ªæš‚æ—¶è¿˜ä¸çŸ¥é“æ€ä¹ˆæ‰“å°</li></ul><h2 id="å˜é‡çš„ä½œç”¨åŸŸ"><a href="#å˜é‡çš„ä½œç”¨åŸŸ" class="headerlink" title="å˜é‡çš„ä½œç”¨åŸŸ"></a>å˜é‡çš„ä½œç”¨åŸŸ</h2><p>å‰é¢æ”¶çš„storageå’Œmemoryè®¨è®ºçš„æ˜¯å˜é‡å­˜å‚¨çš„ä½ç½®ï¼Œä»¥åŠå¼•ç”¨çš„æ–¹å¼ï¼Œå°±åƒç†è§£æŒ‡é’ˆå’Œå¼•ç”¨ä¸€æ ·ï¼Œä¸‹é¢æ¥å­¦å˜é‡çš„ä½œç”¨åŸŸï¼Œæ‰€è°“æ‰€ç”¨åŸŸå°±æ˜¯æŒ‡è¿™ä¸ªå˜é‡åœ¨å“ªé‡Œå¯ä»¥ç”¨å®ƒ</p><p><code>Solidity</code>ä¸­å˜é‡æŒ‰ä½œç”¨åŸŸåˆ’åˆ†æœ‰ä¸‰ç§ï¼Œåˆ†åˆ«æ˜¯çŠ¶æ€å˜é‡ï¼ˆstate variableï¼‰ï¼Œå±€éƒ¨å˜é‡ï¼ˆlocal variableï¼‰å’Œå…¨å±€å˜é‡(global variable)</p><h3 id="1-çŠ¶æ€å˜é‡"><a href="#1-çŠ¶æ€å˜é‡" class="headerlink" title="1. çŠ¶æ€å˜é‡"></a>1. çŠ¶æ€å˜é‡</h3><p>çŠ¶æ€å˜é‡æ˜¯æ•°æ®å­˜å‚¨åœ¨é“¾ä¸Šçš„å˜é‡ï¼Œæ‰€æœ‰åˆçº¦å†…å‡½æ•°éƒ½å¯ä»¥è®¿é—®ï¼Œ<code>gas</code>æ¶ˆè€—é«˜ã€‚çŠ¶æ€å˜é‡åœ¨åˆçº¦å†…ã€å‡½æ•°å¤–å£°æ˜ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs solidity">contract Variables &#123;<br>     // 2.å˜é‡çš„ä½œç”¨åŸŸ<br>    // 2.1 çŠ¶æ€å˜é‡ï¼š é“¾ä¸Šçš„å˜é‡ï¼šå†™åœ¨åˆçº¦é‡Œé¢å‡½æ•°å¤–é¢çš„å˜é‡ï¼Œå°±æ˜¯çŠ¶æ€å˜é‡ï¼Œåœ¨æ‰€æœ‰åˆçº¦å†…å‡½æ•°éƒ½å¯ä»¥è®¿é—®ï¼ŒåŒæ ·gasçš„æ¶ˆè€—ä¹Ÿé«˜<br>    uint public a=1;<br>    uint public b;<br>    string public z;// è¿™äº›å˜é‡éƒ½æ˜¯çŠ¶æ€å˜é‡ï¼ŒåŒæ—¶ï¼Œè¿™äº›å˜é‡ä¼šè‡ªå¸¦æœ‰getæ–¹æ³•å»æŸ¥çœ‹ä»–ä»¬çš„å€¼ï¼Œï¼ˆæ•°ç»„æ²¡æœ‰è‡ªå¸¦getï¼‰<br>    <br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥åœ¨å‡½æ•°é‡Œæ›´æ”¹çŠ¶æ€å˜é‡çš„å€¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs solidity">function foo() external&#123;<br>    // å¯ä»¥åœ¨å‡½æ•°é‡Œæ›´æ”¹çŠ¶æ€å˜é‡çš„å€¼<br>    x = 5;<br>    y = 2;<br>    z = &quot;0xAA&quot;;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="2-å±€éƒ¨å˜é‡"><a href="#2-å±€éƒ¨å˜é‡" class="headerlink" title="2. å±€éƒ¨å˜é‡"></a>2. å±€éƒ¨å˜é‡</h3><p>å±€éƒ¨å˜é‡æ˜¯ä»…åœ¨å‡½æ•°æ‰§è¡Œè¿‡ç¨‹ä¸­æœ‰æ•ˆçš„å˜é‡ï¼Œå‡½æ•°é€€å‡ºåï¼Œå˜é‡æ— æ•ˆã€‚å±€éƒ¨å˜é‡çš„æ•°æ®å­˜å‚¨åœ¨å†…å­˜é‡Œï¼Œä¸ä¸Šé“¾ï¼Œ<code>gas</code>ä½ã€‚å±€éƒ¨å˜é‡åœ¨å‡½æ•°å†…å£°æ˜ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs solidity"> // 2.2 å±€éƒ¨å˜é‡ï¼Œè¿™ä¸ªå°±å¾ˆå¥½ç†è§£äº†ï¼Œå°±æ˜¯åœ¨å‡½æ•°å†…éƒ¨å®šä¹‰çš„å˜é‡ï¼Œåªä½œç”¨çš„å‡½æ•°å†…ï¼Œå‡ºå»äº†å°±æ²¡ç”¨å•¦<br>function bar() external pure returns(uint)&#123;<br>    uint xx = 1;<br>    uint yy = 3;<br>    uint zz = xx + yy;<br>    return(zz);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-å…¨å±€å˜é‡"><a href="#3-å…¨å±€å˜é‡" class="headerlink" title="3. å…¨å±€å˜é‡"></a>3. å…¨å±€å˜é‡</h3><p>å…¨å±€å˜é‡æ˜¯å…¨å±€èŒƒå›´å·¥ä½œçš„å˜é‡ï¼Œéƒ½æ˜¯<code>solidity</code>é¢„ç•™å…³é”®å­—ã€‚ä»–ä»¬å¯ä»¥åœ¨å‡½æ•°å†…ä¸å£°æ˜ç›´æ¥ä½¿ç”¨ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs solidity">// 2.3 å…¨å±€å˜é‡ï¼Œè¿™é‡Œçš„å…¨å±€å˜é‡å’Œpyä¸åŒï¼Œè¿™é‡ŒæŒ‡çš„æ˜¯solidityé¢„ç•™å…³é”®å­—çš„å˜é‡ï¼Œä»–ä»¬å¯ä»¥åœ¨å‡½æ•°å†…ä¸å£°æ˜ç›´æ¥ä½¿ç”¨<br>   function global()external view returns(address,uint,bytes32,bytes memory)  &#123;<br>       address sender=msg.sender; // å‘é€è€…çš„åœ°å€ï¼ŒçŒœæµ‹åº”è¯¥æ˜¯è°ƒç”¨è¿™ä¸ªåˆçº¦çš„äººçš„åœ°å€,addressæ˜¯ä¸€ç§ç±»å‹<br>       uint blockNum = block.number; // å½“å‰åŒºå—é«˜åº¦ï¼Ÿ<br>       bytes32 bHash = blockhash(blockNum - 1); // è·å–åŒºå—å“ˆå¸Œ<br>       bytes memory data=msg.data; //è¿™ä¸ªæ²¡ç”¨è¿‡ ,byteæ˜¯ç±»å‹ï¼Œmemoryæ˜¯ä½ç½®<br>       return (sender,blockNum,bHash,data);<br>   &#125;<br></code></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯ä¸€äº›å¸¸ç”¨çš„å…¨å±€å˜é‡ï¼Œæ›´å®Œæ•´çš„åˆ—è¡¨è¯·çœ‹è¿™ä¸ª<a href="https://learnblockchain.cn/docs/solidity/units-and-global-variables.html#special-variables-and-functions">é“¾æ¥</a>ï¼š</p><ul><li><code>blockhash(uint blockNumber)</code>: (<code>bytes32</code>) ç»™å®šåŒºå—çš„å“ˆå¸Œå€¼ â€“ åªé€‚ç”¨äºæœ€è¿‘çš„256ä¸ªåŒºå—, ä¸åŒ…å«å½“å‰åŒºå—ã€‚</li><li><code>block.coinbase</code>: (<code>address payable</code>) å½“å‰åŒºå—çŸ¿å·¥çš„åœ°å€</li><li><code>block.gaslimit</code>: (<code>uint</code>) å½“å‰åŒºå—çš„gaslimit</li><li><code>block.number</code>: (<code>uint</code>) å½“å‰åŒºå—çš„number</li><li><code>block.timestamp</code>: (<code>uint</code>) å½“å‰åŒºå—çš„æ—¶é—´æˆ³ï¼Œä¸ºunixçºªå…ƒä»¥æ¥çš„ç§’</li><li><code>gasleft()</code>: (<code>uint256</code>) å‰©ä½™ gas</li><li><code>msg.data</code>: (<code>bytes calldata</code>) å®Œæ•´call data</li><li><code>msg.sender</code>: (<code>address payable</code>) æ¶ˆæ¯å‘é€è€… (å½“å‰ caller)</li><li><code>msg.sig</code>: (<code>bytes4</code>) calldataçš„å‰å››ä¸ªå­—èŠ‚ (function identifier)</li><li><code>msg.value</code>: (<code>uint</code>) å½“å‰äº¤æ˜“å‘é€çš„ <code>wei</code> å€¼</li><li><code>block.blobbasefee</code>: (<code>uint</code>) å½“å‰åŒºå—çš„blobåŸºç¡€è´¹ç”¨ã€‚è¿™æ˜¯Cancunå‡çº§æ–°å¢çš„å…¨å±€å˜é‡ã€‚</li><li><code>blobhash(uint index)</code>: (<code>bytes32</code>) è¿”å›è·Ÿå½“å‰äº¤æ˜“å…³è”çš„ç¬¬ <code>index</code> ä¸ªblobçš„ç‰ˆæœ¬åŒ–å“ˆå¸Œï¼ˆç¬¬ä¸€ä¸ªå­—èŠ‚ä¸ºç‰ˆæœ¬å·ï¼Œå½“å‰ä¸º<code>0x01</code>ï¼Œåé¢æ¥KZGæ‰¿è¯ºçš„SHA256å“ˆå¸Œçš„æœ€å31ä¸ªå­—èŠ‚ï¼‰ã€‚è‹¥å½“å‰äº¤æ˜“ä¸åŒ…å«blobï¼Œåˆ™è¿”å›ç©ºå­—èŠ‚ã€‚è¿™æ˜¯Cancunå‡çº§æ–°å¢çš„å…¨å±€å˜é‡ã€‚</li></ul><h3 id="4-å…¨å±€å˜é‡-ä»¥å¤ªå•ä½ä¸æ—¶é—´å•ä½"><a href="#4-å…¨å±€å˜é‡-ä»¥å¤ªå•ä½ä¸æ—¶é—´å•ä½" class="headerlink" title="4. å…¨å±€å˜é‡-ä»¥å¤ªå•ä½ä¸æ—¶é—´å•ä½"></a>4. å…¨å±€å˜é‡-ä»¥å¤ªå•ä½ä¸æ—¶é—´å•ä½</h3><h4 id="ä»¥å¤ªå•ä½"><a href="#ä»¥å¤ªå•ä½" class="headerlink" title="ä»¥å¤ªå•ä½"></a>ä»¥å¤ªå•ä½</h4><p><code>Solidity</code>ä¸­ä¸å­˜åœ¨å°æ•°ç‚¹ï¼Œä»¥<code>0</code>ä»£æ›¿ä¸ºå°æ•°ç‚¹ï¼Œæ¥ç¡®ä¿äº¤æ˜“çš„ç²¾ç¡®åº¦ï¼Œå¹¶ä¸”é˜²æ­¢ç²¾åº¦çš„æŸå¤±ï¼Œåˆ©ç”¨ä»¥å¤ªå•ä½å¯ä»¥é¿å…è¯¯ç®—çš„é—®é¢˜ï¼Œæ–¹ä¾¿ç¨‹åºå‘˜åœ¨åˆçº¦ä¸­å¤„ç†è´§å¸äº¤æ˜“ã€‚</p><ul><li><code>wei</code>: 1</li><li><code>gwei</code>: 1e9 &#x3D; 1000000000</li><li><code>ether</code>: 1e18 &#x3D; 1000000000000000000</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs solidity">// ä»¥å¤ªåŠæ²¡æœ‰å°æ•°ç‚¹ï¼Œç”¨0ä»£æ›¿ä¸ºå°æ•°ç‚¹æ¥ç¡®ä¿äº¤æ˜“çš„ç²¾åº¦ï¼Œä¸ºäº†é˜²æ­¢ç²¾åº¦çš„æŸå¤±ï¼Œåˆ©ç”¨ä¸€å°å•ä½å¯ä»¥é¿å…è¯¯ç®—ï¼Œ<br>  // wei : 1<br>  // gwei : 1e9 =1000000000<br>  // ether : 1e18 = 100000000000000000<br>  function weiUit()external pure returns(uint)  &#123;<br>      assert(1 wei ==1e0);<br>      assert(1 wei == 1);<br>      // return 1 wei; // è°ƒç”¨çš„æ—¶å€™å°±çœ‹åˆ°è¿”å›äº†1ï¼Œ<br>      return 1 gwei; // è¯•è¯•çœ‹è¿”å›ä»€ä¹ˆ è¿”å› <br>  &#125;<br>  function gweiUit()external pure returns(uint)  &#123;<br>      assert(1 gwei ==1e9);<br>      assert(1 gwei == 1000000000); // å¦‚æœasserté”™è¯¯ï¼Œè°ƒç”¨çš„æ—¶å€™ä¼šæŠ¥é”™çš„å˜¿å˜¿<br>      <br>      return 1 gwei; // è¯•è¯•çœ‹è¿”å›ä»€ä¹ˆ è¿”å›  1000000000<br>  &#125;<br>  function etherUit()external pure returns(uint)  &#123;<br>      assert(1 ether ==1e18);<br>      assert(1 ether == 1000000000000000000);<br>      // return 1 wei; // è°ƒç”¨çš„æ—¶å€™å°±çœ‹åˆ°è¿”å›äº†1ï¼Œ<br>      return 1 ether; // è¯•è¯•çœ‹è¿”å›ä»€ä¹ˆ è¿”å›  1000000000000000000<br>  &#125;<br></code></pre></td></tr></table></figure><h4 id="æ—¶é—´å•ä½"><a href="#æ—¶é—´å•ä½" class="headerlink" title="æ—¶é—´å•ä½"></a>æ—¶é—´å•ä½</h4><p>å¯ä»¥åœ¨åˆçº¦ä¸­è§„å®šä¸€ä¸ªæ“ä½œå¿…é¡»åœ¨ä¸€å‘¨å†…å®Œæˆï¼Œæˆ–è€…æŸä¸ªäº‹ä»¶åœ¨ä¸€ä¸ªæœˆåå‘ç”Ÿã€‚è¿™æ ·å°±èƒ½è®©åˆçº¦çš„æ‰§è¡Œå¯ä»¥æ›´åŠ ç²¾ç¡®ï¼Œä¸ä¼šå› ä¸ºæŠ€æœ¯ä¸Šçš„è¯¯å·®è€Œå½±å“åˆçº¦çš„ç»“æœã€‚å› æ­¤ï¼Œæ—¶é—´å•ä½åœ¨<code>Solidity</code>ä¸­æ˜¯ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µï¼Œæœ‰åŠ©äºæé«˜åˆçº¦çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p><ul><li><code>seconds</code>: 1</li><li><code>minutes</code>: 60 seconds &#x3D; 60</li><li><code>hours</code>: 60 minutes &#x3D; 3600</li><li><code>days</code>: 24 hours &#x3D; 86400</li><li><code>weeks</code>: 7 days &#x3D; 604800</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs solidity">function secondsUnit() external pure returns(uint) &#123;<br>    assert(1 seconds == 1);<br>    return 1 seconds;<br>&#125;<br><br>function minutesUnit() external pure returns(uint) &#123;<br>    assert(1 minutes == 60);<br>    assert(1 minutes == 60 seconds);<br>    return 1 minutes;<br>&#125;<br><br>function hoursUnit() external pure returns(uint) &#123;<br>    assert(1 hours == 3600);<br>    assert(1 hours == 60 minutes);<br>    return 1 hours;<br>&#125;<br><br>function daysUnit() external pure returns(uint) &#123;<br>    assert(1 days == 86400);<br>    assert(1 days == 24 hours);<br>    return 1 days;<br>&#125;<br><br>function weeksUnit() external pure returns(uint) &#123;<br>    assert(1 weeks == 604800);<br>    assert(1 weeks == 7 days);<br>    return 1 weeks;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ä»‹ç»äº†<code>Solidity</code>ä¸­çš„å¼•ç”¨ç±»å‹ï¼Œæ•°æ®ä½ç½®å’Œå˜é‡çš„ä½œç”¨åŸŸã€‚é‡ç‚¹æ˜¯<code>storage</code>, <code>memory</code>å’Œ<code>calldata</code>ä¸‰ä¸ªå…³é”®å­—çš„ç”¨æ³•ã€‚ä»–ä»¬å‡ºç°çš„åŸå› æ˜¯ä¸ºäº†èŠ‚çœé“¾ä¸Šæœ‰é™çš„å­˜å‚¨ç©ºé—´å’Œé™ä½<code>gas</code>ã€‚ä¸‹ä¸€è®²æˆ‘ä»¬ä¼šä»‹ç»å¼•ç”¨ç±»å‹ä¸­çš„æ•°ç»„ã€‚</p><h1 id="6-å¼•ç”¨ç±»å‹-array-struct"><a href="#6-å¼•ç”¨ç±»å‹-array-struct" class="headerlink" title="6. å¼•ç”¨ç±»å‹, array, struct"></a>6. å¼•ç”¨ç±»å‹, array, struct</h1><p>æ•°ç»„ï¼ˆ<code>Array</code>ï¼‰æ˜¯<code>Solidity</code>å¸¸ç”¨çš„ä¸€ç§å˜é‡ç±»å‹ï¼Œç”¨æ¥å­˜å‚¨ä¸€ç»„æ•°æ®ï¼ˆæ•´æ•°ï¼Œå­—èŠ‚ï¼Œåœ°å€ç­‰ç­‰ï¼‰ã€‚æ•°ç»„åˆ†ä¸ºå›ºå®šé•¿åº¦æ•°ç»„å’Œå¯å˜é•¿åº¦æ•°ç»„ä¸¤ç§ï¼š</p><ul><li><p>å›ºå®šé•¿åº¦æ•°ç»„ï¼šåœ¨å£°æ˜æ—¶æŒ‡å®šæ•°ç»„çš„é•¿åº¦ã€‚ç”¨<code>T[k]</code>çš„æ ¼å¼å£°æ˜ï¼Œå…¶ä¸­<code>T</code>æ˜¯å…ƒç´ çš„ç±»å‹ï¼Œ<code>k</code>æ˜¯é•¿åº¦ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs solidity">// å›ºå®šé•¿åº¦ Array<br>uint[8] array1;<br>bytes1[5] array2;<br>address[100] array3;<br></code></pre></td></tr></table></figure></li><li><p>å¯å˜é•¿åº¦æ•°ç»„ï¼ˆåŠ¨æ€æ•°ç»„ï¼‰ï¼šåœ¨å£°æ˜æ—¶ä¸æŒ‡å®šæ•°ç»„çš„é•¿åº¦ã€‚ç”¨<code>T[]</code>çš„æ ¼å¼å£°æ˜ï¼Œå…¶ä¸­<code>T</code>æ˜¯å…ƒç´ çš„ç±»å‹ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs solidity">// å¯å˜é•¿åº¦ Array<br>uint[] array4;<br>bytes1[] array5;<br>address[] array6;<br>bytes array7;<br></code></pre></td></tr></table></figure><p><strong>æ³¨æ„</strong>ï¼š<code>bytes</code>æ¯”è¾ƒç‰¹æ®Šï¼Œæ˜¯æ•°ç»„ï¼Œä½†æ˜¯ä¸ç”¨åŠ <code>[]</code>ã€‚å¦å¤–ï¼Œä¸èƒ½ç”¨<code>byte[]</code>å£°æ˜å•å­—èŠ‚æ•°ç»„ï¼Œå¯ä»¥ä½¿ç”¨<code>bytes</code>æˆ–<code>bytes1[]</code>ã€‚<code>bytes</code> æ¯” <code>bytes1[]</code> çœgasã€‚</p></li></ul><h3 id="åˆ›å»ºæ•°ç»„çš„è§„åˆ™"><a href="#åˆ›å»ºæ•°ç»„çš„è§„åˆ™" class="headerlink" title="åˆ›å»ºæ•°ç»„çš„è§„åˆ™"></a>åˆ›å»ºæ•°ç»„çš„è§„åˆ™</h3><p>åœ¨Solidityé‡Œï¼Œåˆ›å»ºæ•°ç»„æœ‰ä¸€äº›è§„åˆ™ï¼š</p><ul><li><p>å¯¹äº<code>memory</code>ä¿®é¥°çš„<code>åŠ¨æ€æ•°ç»„</code>ï¼Œå¯ä»¥ç”¨<code>new</code>æ“ä½œç¬¦æ¥åˆ›å»ºï¼Œä½†æ˜¯å¿…é¡»å£°æ˜é•¿åº¦ï¼Œå¹¶ä¸”å£°æ˜åé•¿åº¦ä¸èƒ½æ”¹å˜ã€‚ä¾‹å­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs solidity">// memoryåŠ¨æ€æ•°ç»„<br>uint[] memory array8 = new uint[](5);<br>bytes memory array9 = new bytes(9);<br></code></pre></td></tr></table></figure></li><li><p>æ•°ç»„å­—é¢å¸¸æ•°(Array Literals)æ˜¯å†™ä½œè¡¨è¾¾å¼å½¢å¼çš„æ•°ç»„ï¼Œç”¨æ–¹æ‹¬å·åŒ…ç€æ¥åˆå§‹åŒ–arrayçš„ä¸€ç§æ–¹å¼ï¼Œå¹¶ä¸”é‡Œé¢æ¯ä¸€ä¸ªå…ƒç´ çš„typeæ˜¯ä»¥ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºå‡†çš„ï¼Œä¾‹å¦‚<code>[1,2,3]</code>é‡Œé¢æ‰€æœ‰çš„å…ƒç´ éƒ½æ˜¯<code>uint8</code>ç±»å‹ï¼Œå› ä¸ºåœ¨Solidityä¸­ï¼Œå¦‚æœä¸€ä¸ªå€¼æ²¡æœ‰æŒ‡å®štypeçš„è¯ï¼Œä¼šæ ¹æ®ä¸Šä¸‹æ–‡æ¨æ–­å‡ºå…ƒç´ çš„ç±»å‹ï¼Œé»˜è®¤å°±æ˜¯æœ€å°å•ä½çš„typeï¼Œè¿™é‡Œé»˜è®¤æœ€å°å•ä½ç±»å‹æ˜¯<code>uint8</code>ã€‚è€Œ<code>[uint(1),2,3]</code>é‡Œé¢çš„å…ƒç´ éƒ½æ˜¯<code>uint</code>ç±»å‹ï¼Œå› ä¸ºç¬¬ä¸€ä¸ªå…ƒç´ æŒ‡å®šäº†æ˜¯<code>uint</code>ç±»å‹äº†ï¼Œé‡Œé¢æ¯ä¸€ä¸ªå…ƒç´ çš„typeéƒ½ä»¥ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ºå‡†ã€‚</p><p>ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œå¦‚æœæ²¡æœ‰å¯¹ä¼ å…¥ <code>g()</code> å‡½æ•°çš„æ•°ç»„è¿›è¡Œ <code>uint</code> è½¬æ¢ï¼Œæ˜¯ä¼šæŠ¥é”™çš„ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs solidity">// SPDX-License-Identifier: GPL-3.0<br>pragma solidity &gt;=0.4.16 &lt;0.9.0;<br><br>contract C &#123;<br>    function f() public pure &#123;<br>        g([uint(1), 2, 3]);<br>    &#125;<br>    function g(uint[3] memory _data) public pure &#123;<br>        // ...<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>å¦‚æœåˆ›å»ºçš„æ˜¯åŠ¨æ€æ•°ç»„ï¼Œä½ éœ€è¦ä¸€ä¸ªä¸€ä¸ªå…ƒç´ çš„èµ‹å€¼ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs solidity">uint[] memory x = new uint[](3);<br>x[0] = 1;<br>x[1] = 3;<br>x[2] = 4;<br></code></pre></td></tr></table></figure></li></ul><h3 id="æ•°ç»„æˆå‘˜"><a href="#æ•°ç»„æˆå‘˜" class="headerlink" title="æ•°ç»„æˆå‘˜"></a>æ•°ç»„æˆå‘˜</h3><ul><li><code>length</code>: æ•°ç»„æœ‰ä¸€ä¸ªåŒ…å«å…ƒç´ æ•°é‡çš„<code>length</code>æˆå‘˜ï¼Œ<code>memory</code>æ•°ç»„çš„é•¿åº¦åœ¨åˆ›å»ºåæ˜¯å›ºå®šçš„ã€‚</li><li><code>push()</code>: <code>åŠ¨æ€æ•°ç»„</code>æ‹¥æœ‰<code>push()</code>æˆå‘˜ï¼Œå¯ä»¥åœ¨æ•°ç»„æœ€åæ·»åŠ ä¸€ä¸ª<code>0</code>å…ƒç´ ï¼Œå¹¶è¿”å›è¯¥å…ƒç´ çš„å¼•ç”¨ã€‚</li><li><code>push(x)</code>: <code>åŠ¨æ€æ•°ç»„</code>æ‹¥æœ‰<code>push(x)</code>æˆå‘˜ï¼Œå¯ä»¥åœ¨æ•°ç»„æœ€åæ·»åŠ ä¸€ä¸ª<code>x</code>å…ƒç´ ã€‚</li><li><code>pop()</code>: <code>åŠ¨æ€æ•°ç»„</code>æ‹¥æœ‰<code>pop()</code>æˆå‘˜ï¼Œå¯ä»¥ç§»é™¤æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ ã€‚</li></ul><h2 id="ç»“æ„ä½“-struct"><a href="#ç»“æ„ä½“-struct" class="headerlink" title="ç»“æ„ä½“ struct"></a>ç»“æ„ä½“ struct</h2><p><code>Solidity</code>æ”¯æŒé€šè¿‡æ„é€ ç»“æ„ä½“çš„å½¢å¼å®šä¹‰æ–°çš„ç±»å‹ã€‚ç»“æ„ä½“ä¸­çš„å…ƒç´ å¯ä»¥æ˜¯åŸå§‹ç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯å¼•ç”¨ç±»å‹ï¼›ç»“æ„ä½“å¯ä»¥ä½œä¸ºæ•°ç»„æˆ–æ˜ å°„çš„å…ƒç´ ã€‚åˆ›å»ºç»“æ„ä½“çš„æ–¹æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs solidity">// ç»“æ„ä½“<br>struct Student&#123;<br>    uint256 id;<br>    uint256 score; <br>&#125;<br><br>Student student; // åˆå§‹ä¸€ä¸ªstudentç»“æ„ä½“<br></code></pre></td></tr></table></figure><p>ç»™ç»“æ„ä½“èµ‹å€¼çš„å››ç§æ–¹æ³•ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs solidity">//  ç»™ç»“æ„ä½“èµ‹å€¼<br>// æ–¹æ³•1:åœ¨å‡½æ•°ä¸­åˆ›å»ºä¸€ä¸ªstorageçš„structå¼•ç”¨<br> // 4 ç»“æ„ä½“ï¼Œé¡¾åæ€ä¹‰ï¼Œå„ç§æ•°æ®ç±»å‹ç»„åˆçš„ç»“æ„ä½“ï¼Œç»“æ„ä½“ä¸­çš„å…ƒç´ å¯ä»¥æ˜¯åŸå§‹ç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯å¼•ç”¨ç±»å‹ï¼›ç»“æ„ä½“å¯ä»¥ä½œä¸ºæ•°ç»„æˆ–æ˜ å°„çš„å…ƒç´ ã€‚åˆ›å»ºç»“æ„ä½“çš„æ–¹æ³•ï¼š<br>    struct Student&#123;<br>        uint256 id;<br>        uint256 score;<br>    &#125;<br>    Student student; // èˆ’é€‚åŒ–è¿™ä¸ªç»“æ„ä½“ï¼Œå¾…ä¼šä¸‹é¢ä¼šç”¨åˆ°çš„<br>    // 4.1 æ–¹æ³•1: ç»™ç»“æ„ä½“èµ‹å€¼æ–¹å¼ä¸€ï¼š<br>    function initStudent1()external  &#123;<br>        Student storage _student=student ;// storageçŠ¶æ€å˜é‡ï¼Œé“¾ä¸Šå­˜å‚¨<br>        _student.id=11;<br>        _student.score=100; // debugçš„æ—¶å€™ä¼šå‘ç°ï¼Œå½“ç¨‹åºèµ°åˆ°è¿™é‡Œçš„æ—¶å€™ studentçš„å±æ€§å‘ç”Ÿäº†æ”¹å˜<br>    &#125;<br>    // 4.2 æ–¹æ³•2:ç›´æ¥å¼•ç”¨çŠ¶æ€å˜é‡çš„struct<br>    function initStudent2() external&#123;   <br>        student.id = 1;<br>        student.score = 80;<br>    &#125;<br>    // 4.3 æ–¹æ³•3:æ„é€ å‡½æ•°å¼ï¼Œç±»ä¼¼ä¸ç±»çš„åˆå§‹åŒ–<br>    function initStudent3() external &#123;<br>        student = Student(3, 90);<br>    &#125;<br>    // æ–¹æ³•4:key value<br>    function initStudent4() external &#123;<br>        student =Student(<br>            &#123;<br>                id:4,<br>                score:50<br>            &#125;<br>        );<br>    &#125;<br></code></pre></td></tr></table></figure><h1 id="7-æ˜ å°„ç±»å‹-mapping"><a href="#7-æ˜ å°„ç±»å‹-mapping" class="headerlink" title="7. æ˜ å°„ç±»å‹ mapping"></a>7. æ˜ å°„ç±»å‹ mapping</h1><h2 id="æ˜ å°„Mapping"><a href="#æ˜ å°„Mapping" class="headerlink" title="æ˜ å°„Mapping"></a>æ˜ å°„Mapping</h2><p>åœ¨æ˜ å°„ä¸­ï¼Œäººä»¬å¯ä»¥é€šè¿‡é”®ï¼ˆ<code>Key</code>ï¼‰æ¥æŸ¥è¯¢å¯¹åº”çš„å€¼ï¼ˆ<code>Value</code>ï¼‰ï¼Œæ¯”å¦‚ï¼šé€šè¿‡ä¸€ä¸ªäººçš„<code>id</code>æ¥æŸ¥è¯¢ä»–çš„é’±åŒ…åœ°å€ã€‚</p><p>å£°æ˜æ˜ å°„çš„æ ¼å¼ä¸º<code>mapping(_KeyType =&gt; _ValueType)</code>ï¼Œå…¶ä¸­<code>_KeyType</code>å’Œ<code>_ValueType</code>åˆ†åˆ«æ˜¯<code>Key</code>å’Œ<code>Value</code>çš„å˜é‡ç±»å‹ã€‚ä¾‹å­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs solidity">mapping(uint =&gt; address) public idToAddress; // idæ˜ å°„åˆ°åœ°å€<br>mapping(address =&gt; address) public swapPair; // å¸å¯¹çš„æ˜ å°„ï¼Œåœ°å€åˆ°åœ°å€<br></code></pre></td></tr></table></figure><h2 id="æ˜ å°„çš„è§„åˆ™"><a href="#æ˜ å°„çš„è§„åˆ™" class="headerlink" title="æ˜ å°„çš„è§„åˆ™"></a>æ˜ å°„çš„è§„åˆ™</h2><p>â€‹    &#x2F;&#x2F; 1ã€map çš„key åªèƒ½æ˜¯solidity å†…ç½®ç±»å‹ï¼Œå€¼å¯ä»¥ç”¨è‡ªå®šä¹‰çš„ç»“æ„ä½“</p><p>â€‹    &#x2F;&#x2F; 2ã€mapçš„å­˜å‚¨ä½ç½®å¿…é¡»æ˜¯storage å› æ­¤å¯ä»¥ç”¨äºåˆçº¦çš„çŠ¶æ€å˜é‡ã€å‡½æ•°ä¸­çš„storageçš„å˜é‡å’Œlibrryå‡½æ•°çš„å‚æ•°</p><p>â€‹    &#x2F;&#x2F; ä½†æ˜¯ä¸èƒ½ç”¨äºpublicå‡½æ•°çš„å•Šå‚æ•°æˆ–è€…è¿”å›å€¼ï¼Œå› ä¸ºmapè®°å½•çš„æ˜¯ä¸€ç§key-valueçš„å…³ç³»</p><p>â€‹    &#x2F;&#x2F; 3ã€å¦‚æœæ˜ å°„å£°æ˜ä¸ºpublic é‚£ä¹ˆsolidityä¼šè‡ªåŠ¨ä¸ºæ­¤å˜é‡åˆ›å»ºä¸€ä¸ªgetterå‡½æ•°æ¥è®©ä½ é€šè¿‡keyæ¥æŸ¥è¯¢value</p><p>â€‹    &#x2F;&#x2F; 4ã€å¢åŠ é”®å€¼å¯¹çš„è¯­æ³•ä¸º ï¼š Var[_Key] &#x3D; _Value,å…¶ä¸­_Varæ˜¯æ˜ å°„å˜é‡åï¼Œ_Keyå’Œ_Valueå¯¹åº”æ–°å¢çš„é”®å€¼å¯¹</p><h2 id="æ˜ å°„çš„åŸç†"><a href="#æ˜ å°„çš„åŸç†" class="headerlink" title="æ˜ å°„çš„åŸç†"></a>æ˜ å°„çš„åŸç†</h2><ul><li><strong>åŸç†1</strong>: æ˜ å°„ä¸å‚¨å­˜ä»»ä½•é”®ï¼ˆ<code>Key</code>ï¼‰çš„èµ„è®¯ï¼Œä¹Ÿæ²¡æœ‰lengthçš„èµ„è®¯ã€‚</li><li><strong>åŸç†2</strong>: å¯¹äºæ˜ å°„ä½¿ç”¨<code>keccak256(h(key) . slot)</code>è®¡ç®—å­˜å–valueçš„ä½ç½®ã€‚æ„Ÿå…´è¶£çš„å¯ä»¥å»é˜…è¯» <a href="https://github.com/WTFAcademy/WTF-Solidity-Internals/tree/master/tutorials/02_MappingStorage">WTF Solidity å†…éƒ¨è§„åˆ™: æ˜ å°„å­˜å‚¨å¸ƒå±€</a></li><li><strong>åŸç†3</strong>: å› ä¸ºEthereumä¼šå®šä¹‰æ‰€æœ‰æœªä½¿ç”¨çš„ç©ºé—´ä¸º0ï¼Œæ‰€ä»¥æœªèµ‹å€¼ï¼ˆ<code>Value</code>ï¼‰çš„é”®ï¼ˆ<code>Key</code>ï¼‰åˆå§‹å€¼éƒ½æ˜¯å„ä¸ªtypeçš„é»˜è®¤å€¼ï¼Œå¦‚uintçš„é»˜è®¤å€¼æ˜¯0ã€‚</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs solidity">function writeMap(uint _Key,address _Value)public  &#123;<br>    idToAddress[_Key]=_Value;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="8-å˜é‡åˆå§‹å€¼"><a href="#8-å˜é‡åˆå§‹å€¼" class="headerlink" title="8. å˜é‡åˆå§‹å€¼"></a>8. å˜é‡åˆå§‹å€¼</h1><p>Solidity å’Œgo ä¸€æ ·ï¼Œå£°æ˜ä½†æ²¡èµ‹å€¼çš„å˜é‡éƒ½æœ‰å®ƒçš„åˆå§‹å€¼æˆ–è€…é»˜è®¤å€¼ï¼Œ</p><h2 id="å€¼ç±»å‹å˜é‡çš„åˆå§‹å€¼"><a href="#å€¼ç±»å‹å˜é‡çš„åˆå§‹å€¼" class="headerlink" title="å€¼ç±»å‹å˜é‡çš„åˆå§‹å€¼"></a>å€¼ç±»å‹å˜é‡çš„åˆå§‹å€¼</h2><ul><li><p><code>boolean</code>: <code>false</code></p></li><li><p><code>string</code>: <code>&quot;&quot;</code></p></li><li><p><code>int</code>: <code>0</code></p></li><li><p><code>uint</code>: <code>0</code></p></li><li><p><code>enum</code>: æšä¸¾ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ </p></li><li><p><code>address</code>: <code>0x0000000000000000000000000000000000000000</code> (æˆ– <code>address(0)</code>)</p></li><li><pre><code class="hljs">function<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs csharp"><br>  - `<span class="hljs-keyword">internal</span>`: ç©ºç™½å‡½æ•°<br>  - `external`: ç©ºç™½å‡½æ•°<br><br>å¯ä»¥ç”¨<span class="hljs-keyword">public</span>å˜é‡çš„getterå‡½æ•°éªŒè¯åˆå§‹å€¼<br><br>```solidity<br>contract InitialValue &#123;<br>    <span class="hljs-built_in">bool</span> <span class="hljs-keyword">public</span> _bool;<br>    <span class="hljs-built_in">string</span> <span class="hljs-keyword">public</span> _string;<br>    <span class="hljs-built_in">int</span> <span class="hljs-keyword">public</span> _int;<br>    <span class="hljs-built_in">uint</span> <span class="hljs-keyword">public</span> _uint;<br>    address <span class="hljs-keyword">public</span> _address;<span class="hljs-comment">//0x0000000000000000000000000000000000000000</span><br>    <span class="hljs-function">function <span class="hljs-title">fi</span>()<span class="hljs-keyword">internal</span></span> &#123;&#125;<span class="hljs-comment">//fi å†…éƒ¨å‡½æ•°æ— æ³•è°ƒç”¨</span><br>    <span class="hljs-function">function <span class="hljs-title">fe</span>()external</span> &#123;&#125;<span class="hljs-comment">// ç©ºç™½å‡½æ•°</span><br>&#125;<br></code></pre></td></tr></table></figure></code></pre></li></ul><h3 id="å¼•ç”¨ç±»å‹åˆå§‹å€¼"><a href="#å¼•ç”¨ç±»å‹åˆå§‹å€¼" class="headerlink" title="å¼•ç”¨ç±»å‹åˆå§‹å€¼"></a>å¼•ç”¨ç±»å‹åˆå§‹å€¼</h3><ul><li>æ˜ å°„<code>mapping</code>: æ‰€æœ‰å…ƒç´ éƒ½ä¸ºå…¶é»˜è®¤å€¼çš„<code>mapping</code></li><li>ç»“æ„ä½“<code>struct</code>: æ‰€æœ‰æˆå‘˜è®¾ä¸ºå…¶é»˜è®¤å€¼çš„ç»“æ„ä½“</li><li>æ•°ç»„array<ul><li>åŠ¨æ€æ•°ç»„: <code>[]</code></li><li>é™æ€æ•°ç»„ï¼ˆå®šé•¿ï¼‰: æ‰€æœ‰æˆå‘˜è®¾ä¸ºå…¶é»˜è®¤å€¼çš„é™æ€æ•°ç»„</li></ul></li></ul><p>å¯ä»¥ç”¨<code>public</code>å˜é‡çš„<code>getter</code>å‡½æ•°éªŒè¯ä¸Šé¢å†™çš„åˆå§‹å€¼æ˜¯å¦æ­£ç¡®ï¼š</p><p><code>delete</code>æ“ä½œç¬¦</p><p><code>delete a </code>ä¼šè®©å˜é‡<code>a</code>çš„å€¼å˜ä¸ºåˆå§‹å€¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs solidity">// 3 deleteæ“ä½œç¬¦<br>bool public _bool2=true;<br>function fd()external &#123;<br>    delete _bool2;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="9-å¸¸æ•°-constantå’Œimmutable"><a href="#9-å¸¸æ•°-constantå’Œimmutable" class="headerlink" title="9. å¸¸æ•° constantå’Œimmutable"></a>9. å¸¸æ•° constantå’Œimmutable</h1><p><code>constant</code>:å¸¸æ•°,</p><p><code>immutable</code>ï¼šä¸å˜é‡</p><p>åªæœ‰æ•°å€¼ç±»å‹çš„å¯ä»¥å£°æ˜ç§°constant å’Œ immutable ï¼›</p><p><code>string</code>å’Œ<code>bytes</code>å¯ä»¥å£°æ˜ä¸ºconstant ä½†ä¸èƒ½ä¸ºimmutable;</p><p><code>constant</code>å˜é‡å¿…é¡»åœ¨å£°æ˜çš„æ—¶å€™åˆå§‹åŒ–ï¼Œä¹‹åå†ä¹Ÿä¸èƒ½æ”¹å˜ã€‚å°è¯•æ”¹å˜çš„è¯ï¼Œç¼–è¯‘ä¸é€šè¿‡ã€‚</p><p><code>immutable</code>å˜é‡å¯ä»¥åœ¨å£°æ˜æ—¶æˆ–æ„é€ å‡½æ•°ä¸­åˆå§‹åŒ–ï¼Œå› æ­¤æ›´åŠ çµæ´»ã€‚åœ¨<code>Solidity v0.8.21</code>ä»¥åï¼Œ<code>immutable</code>å˜é‡ä¸éœ€è¦æ˜¾å¼åˆå§‹åŒ–ï¼Œæœªæ˜¾å¼åˆå§‹åŒ–çš„<code>immutable</code>å˜é‡å°†ä½¿ç”¨æ•°å€¼ç±»å‹çš„åˆå§‹å€¼ï¼ˆè§ <a href="https://github.com/AmazingAng/WTF-Solidity/blob/main/08_InitialValue/readme.md#%E5%8F%98%E9%87%8F%E5%88%9D%E5%A7%8B%E5%80%BC">8. å˜é‡åˆå§‹å€¼</a>ï¼‰ã€‚åä¹‹ï¼Œåˆ™éœ€è¦æ˜¾å¼åˆå§‹åŒ–ã€‚ è‹¥<code>immutable</code>å˜é‡æ—¢åœ¨å£°æ˜æ—¶åˆå§‹åŒ–ï¼Œåˆåœ¨constructorä¸­åˆå§‹åŒ–ï¼Œä¼šä½¿ç”¨constructoråˆå§‹åŒ–çš„å€¼ã€‚</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>07-8TRONæ³¢åœºé’±åŒ…å¼€å‘æµç¨‹</title>
    <link href="/2025/03/13/07-8TRON%E6%B3%A2%E5%9C%BA%E9%92%B1%E5%8C%85%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/"/>
    <url>/2025/03/13/07-8TRON%E6%B3%A2%E5%9C%BA%E9%92%B1%E5%8C%85%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="Troné’±åŒ…å¼€å‘è¯¦ç»†æ•™ç¨‹"><a href="#Troné’±åŒ…å¼€å‘è¯¦ç»†æ•™ç¨‹" class="headerlink" title="Troné’±åŒ…å¼€å‘è¯¦ç»†æ•™ç¨‹"></a>Troné’±åŒ…å¼€å‘è¯¦ç»†æ•™ç¨‹</h1><h1 id="ä¸€-Tron-ç®€ä»‹"><a href="#ä¸€-Tron-ç®€ä»‹" class="headerlink" title="ä¸€ Tron ç®€ä»‹"></a>ä¸€ Tron ç®€ä»‹</h1><p>Tronï¼ˆæ³¢åœºï¼‰ æ˜¯ä¸€ä¸ªå…¼å®¹ EVM çš„åŒºå—é“¾å¹³å°,  Tronçš„æŠ€æœ¯æ¶æ„ç”±ä¸‰å±‚ç»„æˆï¼š</p><ul><li>å­˜å‚¨å±‚ï¼šåŒ…æ‹¬åŒºå—å­˜å‚¨å’ŒçŠ¶æ€å­˜å‚¨ï¼Œæ”¯æŒå¤šç§å­˜å‚¨æœºåˆ¶ã€‚</li><li>æ ¸å¿ƒå±‚ï¼šå®ç°äº†æ™ºèƒ½åˆçº¦ã€è´¦æˆ·ç®¡ç†å’Œå…±è¯†æœºåˆ¶ï¼ˆç›®å‰ä½¿ç”¨çš„æ˜¯DPoSï¼Œå³å§”æ‰˜æƒç›Šè¯æ˜ï¼‰ã€‚</li><li>åº”ç”¨å±‚ï¼šä¸ºå¼€å‘è€…æä¾›APIå’ŒSDKï¼Œæ”¯æŒå¼€å‘å»ä¸­å¿ƒåŒ–åº”ç”¨ï¼ˆDAppsï¼‰</li></ul><h2 id="1-ä¸»è¦ç»„ä»¶å’ŒåŠŸèƒ½"><a href="#1-ä¸»è¦ç»„ä»¶å’ŒåŠŸèƒ½" class="headerlink" title="1.ä¸»è¦ç»„ä»¶å’ŒåŠŸèƒ½"></a>1.ä¸»è¦ç»„ä»¶å’ŒåŠŸèƒ½</h2><ul><li>Tronè™šæ‹Ÿæœºï¼ˆTVMï¼‰ï¼šå…¼å®¹ä»¥å¤ªåŠè™šæ‹Ÿæœºï¼ˆEVMï¼‰ï¼Œä½¿å¼€å‘è€…å¯ä»¥è½»æ¾å°†ä»¥å¤ªåŠä¸Šçš„åº”ç”¨è¿ç§»åˆ°Tronä¸Šã€‚</li><li>æ™ºèƒ½åˆçº¦ï¼šæ”¯æŒSolidityè¯­è¨€ç¼–å†™çš„æ™ºèƒ½åˆçº¦ã€‚</li><li>TRC-20å’ŒTRC-721æ ‡å‡†ï¼šTRC-20æ˜¯Tronçš„ä»£å¸æ ‡å‡†ï¼Œç±»ä¼¼äºä»¥å¤ªåŠçš„ERC-20ï¼›TRC-721åˆ™æ˜¯éåŒè´¨åŒ–ä»£å¸æ ‡å‡†ï¼Œç±»ä¼¼äºERC-721ã€‚</li></ul><h2 id="2-å…±è¯†æœºåˆ¶"><a href="#2-å…±è¯†æœºåˆ¶" class="headerlink" title="2.å…±è¯†æœºåˆ¶"></a>2.å…±è¯†æœºåˆ¶</h2><ul><li>Troné‡‡ç”¨å§”æ‰˜æƒç›Šè¯æ˜ï¼ˆDPoSï¼‰æœºåˆ¶ã€‚TRXæŒæœ‰è€…å¯ä»¥æŠ•ç¥¨é€‰ä¸¾è¶…çº§ä»£è¡¨ï¼ˆSuper Representativesï¼ŒSRï¼‰ï¼Œè¿™äº›SRè´Ÿè´£éªŒè¯äº¤æ˜“å’Œç»´æŠ¤ç½‘ç»œçš„å®‰å…¨ã€‚</li></ul><h2 id="3-ç”Ÿæ€ç³»ç»Ÿ"><a href="#3-ç”Ÿæ€ç³»ç»Ÿ" class="headerlink" title="3.ç”Ÿæ€ç³»ç»Ÿ"></a>3.ç”Ÿæ€ç³»ç»Ÿ</h2><ul><li>Tronç”Ÿæ€ç³»ç»ŸåŒ…å«å¤šä¸ªé‡è¦ç»„ä»¶å’Œé¡¹ç›®ï¼š</li><li>TronLinkï¼šå®˜æ–¹é’±åŒ…ï¼Œæ”¯æŒTRXå’ŒTRC-20ä»£å¸çš„å­˜å‚¨å’Œäº¤æ˜“ã€‚</li><li>JustSwapï¼šå»ä¸­å¿ƒåŒ–äº¤æ˜“æ‰€ï¼Œæ”¯æŒTRC-20ä»£å¸çš„äº¤æ˜“ã€‚</li><li>Sun Networkï¼šä¾§é“¾æ‰©å±•æ–¹æ¡ˆï¼Œæ—¨åœ¨æå‡Tronä¸»ç½‘çš„æ‰©å±•æ€§ã€‚</li><li>BitTorrentï¼šTronæ”¶è´­çš„å»ä¸­å¿ƒåŒ–æ–‡ä»¶å…±äº«åè®®ï¼Œä¸Tronç½‘ç»œæ·±åº¦é›†æˆã€‚</li><li>DAppsï¼šå¤§é‡å»ä¸­å¿ƒåŒ–åº”ç”¨åœ¨ Tron å¹³å°ä¸Šè¿è¡Œã€‚</li></ul><h2 id="ä»£å¸ï¼ˆTRXï¼‰"><a href="#ä»£å¸ï¼ˆTRXï¼‰" class="headerlink" title="ä»£å¸ï¼ˆTRXï¼‰"></a>ä»£å¸ï¼ˆTRXï¼‰</h2><ul><li>Tronçš„åŸç”Ÿä»£å¸æ˜¯TRXï¼Œä¸»è¦ç”¨äºä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</li><li>äº¤æ˜“è´¹ç”¨ï¼šæ”¯ä»˜ç½‘ç»œä¸Šçš„äº¤æ˜“è´¹ç”¨ã€‚</li><li>Stakingå’ŒæŠ•ç¥¨ï¼šTRXæŒæœ‰è€…å¯ä»¥è´¨æŠ¼ä»£å¸å¹¶å‚ä¸è¶…çº§ä»£è¡¨çš„é€‰ä¸¾ã€‚</li><li>DAppæ”¯ä»˜ï¼šåœ¨Tronå¹³å°ä¸Šçš„å»ä¸­å¿ƒåŒ–åº”ç”¨ä¸­è¿›è¡Œæ”¯ä»˜å’Œäº¤æ˜“ã€‚</li></ul><h2 id="å…¶ä»–ä¿¡æ¯"><a href="#å…¶ä»–ä¿¡æ¯" class="headerlink" title="å…¶ä»–ä¿¡æ¯"></a>å…¶ä»–ä¿¡æ¯</h2><ul><li>ç²¾åº¦</li><li>å®˜æ–¹ç½‘ç«™ï¼š<a href="https://tron.network/index?lng=zh">https://tron.network/index?lng=zh</a></li><li>å®˜æ–¹é›†æˆæ–‡æ¡£ï¼š<a href="https://developers.tron.network/">https://developers.tron.network/</a></li></ul><hr><ul><li><p>æ˜¯å¦æ”¯æŒä»£å¸ï¼šæ”¯æŒ</p></li><li><p>æ˜¯å¦æ”¯æŒè´¨æŠ¼ï¼šæ”¯æŒ</p></li><li><p>åŒºå—æµè§ˆå™¨</p><ul><li>ä¸»ç½‘ï¼š<a href="https://tronscan.org/#/">https://tronscan.org/#/</a></li><li>æµ‹è¯•ç½‘ï¼š<a href="https://nile.tronscan.org/?_gl=1">https://nile.tronscan.org/?_gl=1</a></li></ul></li><li><p>å‡ºå—æ—¶é—´ï¼šæ¯ä¸ªåŒºå—çš„ç”Ÿæˆæ—¶é—´çº¦ä¸º <strong>3 ç§’</strong>ã€‚</p></li><li><p>ç¡®è®¤ä½ï¼šTron ä½¿ç”¨ <strong>DPoSï¼ˆå§”æ‰˜æƒç›Šè¯æ˜ï¼‰</strong>å…±è¯†æœºåˆ¶ï¼Œç”± 27 ä¸ªè¶…çº§ä»£è¡¨ï¼ˆSuper Representatives, SRï¼‰è½®æµå‡ºå—ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œ<strong>19 ä¸ªåŒºå—ç¡®è®¤</strong>ï¼ˆçº¦ 57 ç§’ï¼‰è¢«è®¤ä¸ºæ˜¯æœ€ç»ˆç¡®è®¤ã€‚</p></li><li><p>ååé‡ï¼šTron çš„ååé‡å¯ä»¥è¾¾åˆ° <strong>2000+ TPSï¼ˆæ¯ç§’äº¤æ˜“æ•°ï¼‰</strong>ï¼Œè¿œé«˜äºä»¥å¤ªåŠç­‰åŒºå—é“¾ã€‚</p></li><li><p>åœ°å€ï¼šTron åœ°å€æ˜¯ä¸€ä¸ª <strong>Base58Check ç¼–ç çš„å­—ç¬¦ä¸²</strong>ï¼Œé•¿åº¦ä¸º <strong>34 ä¸ªå­—ç¬¦</strong>ï¼Œé€šå¸¸ä»¥å­—æ¯ <strong>â€œTâ€</strong> å¼€å¤´ã€‚ä¾‹å¦‚ï¼š</p><ul><li>ä¸»ç½‘åœ°å€ä»¥ <strong>â€œTâ€</strong> å¼€å¤´ã€‚</li><li>æµ‹è¯•ç½‘åœ°å€ä»¥ <strong>â€œ27â€</strong> å¼€å¤´ã€‚</li></ul></li><li><p>æ„å»ºäº¤æ˜“æ¡ˆä¾‹ï¼š</p></li><li><p>äº¤æ˜“ç­¾åç®—æ³•ï¼š</p></li><li><p>åŒæ­¥æ¨¡å‹</p><ul><li><p><input checked="" disabled="" type="checkbox"> å¤šåœ°å€ Account</p></li><li><p><input disabled="" type="checkbox"> å¤šåœ°å€ UTxO</p></li><li><p><input disabled="" type="checkbox"> å•åœ°å€ Memo</p></li><li><p><input disabled="" type="checkbox"> å•åœ°å€ Paging</p></li><li><p><input disabled="" type="checkbox"> å…¶å®ƒæ–¹å¼</p></li></ul></li></ul><h2 id="çŸ¿å·¥è´¹å½¢å¼ï¼ŒTRONæ¯”è¾ƒç‰¹æ®Šï¼Œå•ç‹¬åˆ—å‡ºæ¥"><a href="#çŸ¿å·¥è´¹å½¢å¼ï¼ŒTRONæ¯”è¾ƒç‰¹æ®Šï¼Œå•ç‹¬åˆ—å‡ºæ¥" class="headerlink" title="çŸ¿å·¥è´¹å½¢å¼ï¼ŒTRONæ¯”è¾ƒç‰¹æ®Šï¼Œå•ç‹¬åˆ—å‡ºæ¥"></a>çŸ¿å·¥è´¹å½¢å¼ï¼ŒTRONæ¯”è¾ƒç‰¹æ®Šï¼Œå•ç‹¬åˆ—å‡ºæ¥</h2><p>çŸ¿å·¥è´¹å½¢å¼ï¼š</p><h3 id="1-èƒ½é‡ï¼ˆEnergyï¼‰å’Œå¸¦å®½ï¼ˆBandwidthï¼‰"><a href="#1-èƒ½é‡ï¼ˆEnergyï¼‰å’Œå¸¦å®½ï¼ˆBandwidthï¼‰" class="headerlink" title="1.èƒ½é‡ï¼ˆEnergyï¼‰å’Œå¸¦å®½ï¼ˆBandwidthï¼‰"></a>1.èƒ½é‡ï¼ˆEnergyï¼‰å’Œå¸¦å®½ï¼ˆBandwidthï¼‰</h3><ul><li><p>Tron ä½¿ç”¨ä¸¤ç§èµ„æºæ¥è®¡ç®—äº¤æ˜“è´¹ç”¨ï¼š</p><ul><li><p><strong>å¸¦å®½ï¼ˆBandwidthï¼‰</strong>ï¼šç”¨äºæ™®é€šäº¤æ˜“ï¼ˆå¦‚è½¬è´¦ TRX æˆ–è°ƒç”¨æ™ºèƒ½åˆçº¦ï¼‰ã€‚</p></li><li><p><strong>èƒ½é‡ï¼ˆEnergyï¼‰</strong>ï¼šç”¨äºæ‰§è¡Œæ™ºèƒ½åˆçº¦çš„å¤æ‚æ“ä½œã€‚</p></li></ul></li><li><p>ç”¨æˆ·å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å–å¸¦å®½å’Œèƒ½é‡ï¼š</p><ul><li><p><strong>è´¨æŠ¼ TRX</strong>ï¼šç”¨æˆ·å¯ä»¥é€šè¿‡è´¨æŠ¼ï¼ˆå†»ç»“ï¼‰TRX æ¥è·å¾—å¸¦å®½å’Œèƒ½é‡ã€‚</p></li><li><p><strong>ç›´æ¥æ”¯ä»˜ TRX</strong>ï¼šå¦‚æœç”¨æˆ·æ²¡æœ‰è¶³å¤Ÿçš„å¸¦å®½æˆ–èƒ½é‡ï¼Œå¯ä»¥ç›´æ¥ç”¨ TRX æ”¯ä»˜äº¤æ˜“è´¹ç”¨ã€‚</p></li></ul></li></ul><h3 id="2-å¸¦å®½ï¼ˆBandwidthï¼‰"><a href="#2-å¸¦å®½ï¼ˆBandwidthï¼‰" class="headerlink" title="2.å¸¦å®½ï¼ˆBandwidthï¼‰"></a>2.<strong>å¸¦å®½ï¼ˆBandwidthï¼‰</strong></h3><ul><li><p><strong>ç”¨é€”</strong>ï¼šç”¨äºæ™®é€šäº¤æ˜“ï¼ˆå¦‚ TRX è½¬è´¦ã€TRC-10 ä»£å¸è½¬è´¦ï¼‰ã€‚</p></li><li><p>è·å–æ–¹å¼ï¼š</p><ul><li><strong>æ¯å¤©å…è´¹è·å¾—ä¸€å®šæ•°é‡çš„å¸¦å®½ï¼ˆåŸºäºè´¨æŠ¼çš„ TRX æ•°é‡</strong>ï¼‰ã€‚</li><li>å¦‚æœå¸¦å®½ä¸è¶³ï¼Œå¯ä»¥ç”¨ TRX æ”¯ä»˜äº¤æ˜“è´¹ç”¨ã€‚</li></ul></li><li><p>è´¹ç”¨è®¡ç®—</p><ul><li><strong>æ¯ç¬”äº¤æ˜“æ¶ˆè€—å›ºå®šçš„å¸¦å®½ç‚¹æ•°ï¼ˆä¾‹å¦‚ï¼ŒTRX è½¬è´¦æ¶ˆè€—çº¦ 200 å¸¦å®½ï¼‰</strong>ã€‚</li></ul></li><li><p>å¦‚æœå¸¦å®½ä¸è¶³ï¼Œæ¯å­—èŠ‚äº¤æ˜“æ•°æ®æ¶ˆè€— 0.002 TRXã€‚</p></li></ul><hr><h3 id="3-èƒ½é‡ï¼ˆEnergyï¼‰"><a href="#3-èƒ½é‡ï¼ˆEnergyï¼‰" class="headerlink" title="3. èƒ½é‡ï¼ˆEnergyï¼‰"></a>3. <strong>èƒ½é‡ï¼ˆEnergyï¼‰</strong></h3><ul><li><p><strong>ç”¨é€”</strong>ï¼šç”¨äºæ‰§è¡Œæ™ºèƒ½åˆçº¦ï¼ˆå¦‚ TRC-20 ä»£å¸è½¬è´¦ã€è°ƒç”¨æ™ºèƒ½åˆçº¦ï¼‰ã€‚</p></li><li><p>è·å–æ–¹å¼ï¼š</p><ul><li>é€šè¿‡è´¨æŠ¼ TRX è·å¾—èƒ½é‡ã€‚</li><li>å¦‚æœèƒ½é‡ä¸è¶³ï¼Œå¯ä»¥ç”¨ TRX æ”¯ä»˜äº¤æ˜“è´¹ç”¨ã€‚</li></ul></li><li><p>è´¹ç”¨è®¡ç®—ï¼š</p><ul><li>èƒ½é‡æ¶ˆè€—å–å†³äºæ™ºèƒ½åˆçº¦çš„å¤æ‚æ€§å’Œè®¡ç®—èµ„æºéœ€æ±‚ã€‚</li></ul></li><li><p>å¦‚æœèƒ½é‡ä¸è¶³ï¼Œæ¯å•ä½èƒ½é‡æ¶ˆè€— 0.00001 TRXã€‚</p></li></ul><h3 id="4-TRX-æ”¯ä»˜"><a href="#4-TRX-æ”¯ä»˜" class="headerlink" title="4. TRX æ”¯ä»˜"></a>4. <strong>TRX æ”¯ä»˜</strong></h3><p>å¦‚æœç”¨æˆ·æ²¡æœ‰è¶³å¤Ÿçš„å¸¦å®½æˆ–èƒ½é‡ï¼Œå¯ä»¥ç›´æ¥ç”¨ TRX æ”¯ä»˜äº¤æ˜“è´¹ç”¨ã€‚è´¹ç”¨ä¼šæ ¹æ®äº¤æ˜“ç±»å‹å’Œèµ„æºæ¶ˆè€—åŠ¨æ€è®¡ç®—ã€‚</p><hr><h3 id="5-å…è´¹äº¤æ˜“"><a href="#5-å…è´¹äº¤æ˜“" class="headerlink" title="5. å…è´¹äº¤æ˜“"></a>5. <strong>å…è´¹äº¤æ˜“</strong></h3><p>Tron å…è®¸ç”¨æˆ·æ¯å¤©è¿›è¡Œä¸€å®šæ•°é‡çš„å…è´¹äº¤æ˜“ï¼ˆåŸºäºè´¨æŠ¼çš„ TRX æ•°é‡ï¼‰ã€‚è¿™äº›å…è´¹äº¤æ˜“ä½¿ç”¨å¸¦å®½ï¼Œè€Œä¸æ¶ˆè€— TRXã€‚</p><hr><h3 id="6-çŸ¿å·¥è´¹ä¼˜åŠ¿"><a href="#6-çŸ¿å·¥è´¹ä¼˜åŠ¿" class="headerlink" title="6. çŸ¿å·¥è´¹ä¼˜åŠ¿"></a>6. <strong>çŸ¿å·¥è´¹ä¼˜åŠ¿</strong></h3><ul><li><strong>ä½è´¹ç”¨</strong>ï¼šTron çš„äº¤æ˜“è´¹ç”¨é€šå¸¸æ¯”ä»¥å¤ªåŠä½å¾—å¤šï¼Œå°¤å…¶æ˜¯æ™®é€šè½¬è´¦ã€‚</li><li><strong>çµæ´»æ€§</strong>ï¼šç”¨æˆ·å¯ä»¥é€‰æ‹©è´¨æŠ¼ TRX è·å–èµ„æºï¼Œæˆ–è€…ç›´æ¥æ”¯ä»˜ TRXã€‚</li><li><strong>é«˜æ•ˆæ€§</strong>ï¼šTron çš„é«˜ååé‡ï¼ˆ2000+ TPSï¼‰å’Œä½å»¶è¿Ÿä½¿å¾—äº¤æ˜“å¤„ç†é€Ÿåº¦æ›´å¿«ã€‚</li></ul><hr><h3 id="7-ç¤ºä¾‹"><a href="#7-ç¤ºä¾‹" class="headerlink" title="7. ç¤ºä¾‹"></a>7. <strong>ç¤ºä¾‹</strong></h3><ul><li><strong>TRX è½¬è´¦</strong>ï¼šæ¶ˆè€—å¸¦å®½ï¼Œè´¹ç”¨æä½ï¼ˆçº¦ 0.00001 TRXï¼‰ã€‚</li><li><strong>TRC-20 ä»£å¸è½¬è´¦</strong>ï¼šæ¶ˆè€—èƒ½é‡ï¼Œè´¹ç”¨ç¨é«˜ï¼ˆçº¦ 0.1-1 TRXï¼Œå–å†³äºåˆçº¦å¤æ‚æ€§ï¼‰ã€‚</li><li><strong>æ™ºèƒ½åˆçº¦è°ƒç”¨</strong>ï¼šæ¶ˆè€—èƒ½é‡ï¼Œè´¹ç”¨å–å†³äºåˆçº¦çš„è®¡ç®—å¤æ‚åº¦ã€‚</li></ul><hr><h3 id="8-æ€»ç»“"><a href="#8-æ€»ç»“" class="headerlink" title="8. æ€»ç»“"></a>8. <strong>æ€»ç»“</strong></h3><p>Tron çš„çŸ¿å·¥è´¹å½¢å¼ä»¥å¸¦å®½å’Œèƒ½é‡ä¸ºæ ¸å¿ƒï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡è´¨æŠ¼ TRX è·å–èµ„æºï¼Œæˆ–è€…ç›´æ¥æ”¯ä»˜ TRXã€‚è¿™ç§è®¾è®¡ä½¿å¾— Tron çš„äº¤æ˜“è´¹ç”¨æ›´ä½ã€æ›´çµæ´»ï¼Œé€‚åˆé«˜é¢‘äº¤æ˜“å’Œå»ä¸­å¿ƒåŒ–åº”ç”¨ï¼ˆDAppsï¼‰çš„è¿è¡Œã€‚</p><p>å¦‚æœä½ æœ‰æ›´å¤šå…³äº Tron çš„é—®é¢˜ï¼Œæ¬¢è¿ç»§ç»­æé—®ï¼</p><h3 id="9-äº¤æ˜“çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#9-äº¤æ˜“çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="9. äº¤æ˜“çš„ç”Ÿå‘½å‘¨æœŸ"></a>9. <strong>äº¤æ˜“çš„ç”Ÿå‘½å‘¨æœŸ</strong></h3><p>æµç¨‹ï¼šæ„å»ºâ€“&gt;ç­¾åâ€“&gt;å¹¿æ’­â€“&gt;ç¡®è®¤</p><p>ç”Ÿå‘½å‘¨æœŸï¼š</p><ul><li>äº¤æ˜“çš„åˆ›å»ºå’Œç­¾å</li><li>å¹¿æ’­é“Tronç½‘ç»œä¸­ï¼Œç»è¿‡èŠ‚ç‚¹éªŒè¯å’Œæ‰§è¡Œï¼Œæ”¶å½•è¿›ä¸€ä¸ªäº¤æ˜“ç¼“å­˜æ± ä¸­</li><li>å‡ºå—èŠ‚ç‚¹æŒ‰ç…§äº¤æ˜“æ”¾å…¥çš„é¡ºåºï¼Œé€ä¸ªä»äº¤æ˜“ç¼“å­˜æ± ä¸­å–å‡ºäº¤æ˜“ï¼Œæ‰“åŒ…æˆä¸€ä¸ªæ–°åŒºå—ï¼Œç„¶åå°†æ–°åŒºå—å¹¿æ’­åˆ°TRONç½‘ç»œã€‚</li><li>äº¤æ˜“ä¼šè¢«â€œç¡®è®¤â€ã€‚äº¤æ˜“æ˜¯å¦è¢«ç¡®è®¤ï¼Œå–å†³äºåŒ…å«è¯¥äº¤æ˜“çš„åŒºå—æ˜¯å¦è¢«ç¡®è®¤ã€‚TRONçš„åŒºå—ç¡®è®¤æœºåˆ¶æ˜¯ï¼Œä¸€ä¸ªåŒºå—äº§ç”Ÿåï¼Œ19ä¸ªä¸åŒçš„è¶…çº§èŠ‚ç‚¹ä¼šæ ¹æ®è¿™ä¸ªåŒºå—äº§ç”Ÿåç»­çš„åŒºå—ï¼Œç„¶åè¿™ä¸ªåŒºå—å°±è¢«ç¡®è®¤äº†ã€‚</li></ul><h2 id="èŠ‚ç‚¹"><a href="#èŠ‚ç‚¹" class="headerlink" title="èŠ‚ç‚¹"></a>èŠ‚ç‚¹</h2><p><strong>èŠ‚ç‚¹æ„å»ºå’Œä½¿ç”¨æ–‡æ¡£</strong></p><p><a href="https://docs.vite.org/vite-docs/tutorial/node/install.html">https://docs.vite.org/vite-docs/tutorial/node/install.html</a></p><p><strong>RPCæ–‡æ¡£</strong></p><p><a href="https://docs.vite.org/vite-docs/api/rpc/ledger_v2.html">https://docs.vite.org/vite-docs/api/rpc/ledger_v2.html</a></p><p><strong>RPCé€šä¿¡æ–¹å¼</strong></p><ul><li><input checked="" disabled="" type="checkbox"> HTTP(s)</li><li><input disabled="" type="checkbox"> WebSocket</li><li><input disabled="" type="checkbox"> GRPC<br><strong>å…¬å…±èŠ‚ç‚¹</strong></li></ul><h3 id="å…¬å…±èŠ‚ç‚¹"><a href="#å…¬å…±èŠ‚ç‚¹" class="headerlink" title="å…¬å…±èŠ‚ç‚¹"></a>å…¬å…±èŠ‚ç‚¹</h3><p>èŠ‚ç‚¹ï¼š<a href="https://docs.vite.org/vite-docs/tutorial/sppguide/tutorials/dev-wallet.html#personal-wallet-setup">https://docs.vite.org/vite-docs/tutorial/sppguide/tutorials/dev-wallet.html#personal-wallet-setup</a></p><ol><li>[ä¸»ç½‘]ï¼š<a href="https://node.vite.net/gvite">https://node.vite.net/gvite</a></li><li>[æµ‹è¯•ç½‘]ï¼š<a href="https://buidl.vite.net/gvite">https://buidl.vite.net/gvite</a></li></ol><h3 id="æµè§ˆå™¨é’±åŒ…"><a href="#æµè§ˆå™¨é’±åŒ…" class="headerlink" title="æµè§ˆå™¨é’±åŒ…"></a>æµè§ˆå™¨é’±åŒ…</h3><p><a href="https://app.vite.net/">https://app.vite.net/</a></p><h2 id="SDK"><a href="#SDK" class="headerlink" title="SDK"></a>SDK</h2><p>ä»“åº“ï¼š<a href="https://github.com/vitelabs/go-vite">https://github.com/vitelabs/go-vite</a></p><p>äº¤æ˜“æ‰€æ•´åˆVITEï¼š<a href="https://docs.vite.org/vite-docs/tutorial/faq/dex.html">https://docs.vite.org/vite-docs/tutorial/faq/dex.html</a></p><p>APIï¼š<a href="https://docs.vite.org/vite-docs/tutorial/faq/dex.html#">https://docs.vite.org/vite-docs/tutorial/faq/dex.html#</a></p><p><strong>ç¼–ç¨‹è¯­è¨€</strong></p><p>Go</p><p><strong>ä»¥ä¸‹æµç¨‹æ˜¯å¦å®Œæ•´æ”¯æŒ</strong></p><ul><li><input checked="" disabled="" type="checkbox"> HTTP</li><li><input checked="" disabled="" type="checkbox"> æ„å»ºå¾…ç­¾åäº¤æ˜“</li><li><input checked="" disabled="" type="checkbox"> åˆå¹¶ç­¾åå’ŒåŸå§‹äº¤æ˜“</li><li><input checked="" disabled="" type="checkbox"> è·å–ç­¾åäº¤æ˜“ ID</li><li><input checked="" disabled="" type="checkbox"> ç”Ÿæˆåœ°å€</li><li><input checked="" disabled="" type="checkbox"> æ ¡éªŒåœ°å€</li></ul><h1 id="åœ°å€ç”Ÿæˆ"><a href="#åœ°å€ç”Ÿæˆ" class="headerlink" title="åœ°å€ç”Ÿæˆ"></a>åœ°å€ç”Ÿæˆ</h1><h1 id="æ„å»ºäº¤æ˜“"><a href="#æ„å»ºäº¤æ˜“" class="headerlink" title="æ„å»ºäº¤æ˜“"></a>æ„å»ºäº¤æ˜“</h1><p>Tron åœ°å€çš„ç”Ÿæˆè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ol><li><p><strong>ç”Ÿæˆç§é’¥</strong>ï¼šéšæœºç”Ÿæˆä¸€ä¸ª 256 ä½çš„ç§é’¥ã€‚</p></li><li><p><strong>ç”Ÿæˆå…¬é’¥</strong>ï¼šé€šè¿‡æ¤­åœ†æ›²çº¿åŠ å¯†ç®—æ³•ï¼ˆECDSAï¼Œsecp256k1ï¼‰ä»ç§é’¥ç”Ÿæˆå…¬é’¥ã€‚</p></li><li><p>è®¡ç®—å…¬é’¥å“ˆå¸Œï¼š</p><ul><li><p>å¯¹å…¬é’¥è¿›è¡Œ Keccak-256 å“ˆå¸Œè¿ç®—ã€‚</p></li><li><p>å–å“ˆå¸Œå€¼çš„æœ€å 20 å­—èŠ‚ä½œä¸ºå…¬é’¥å“ˆå¸Œã€‚</p></li></ul></li><li><p>æ·»åŠ å‰ç¼€ï¼š</p><ul><li>åœ¨ä¸»ç½‘ä¸­ï¼Œæ·»åŠ å­—èŠ‚ <code>0x41</code> ä½œä¸ºå‰ç¼€ã€‚</li></ul></li><li><p>è®¡ç®—æ ¡éªŒå’Œï¼š</p><ul><li>å¯¹å‰ç¼€å’Œå…¬é’¥å“ˆå¸Œè¿›è¡Œä¸¤æ¬¡ SHA-256 å“ˆå¸Œè¿ç®—ã€‚</li><li>å–å‰ 4 ä¸ªå­—èŠ‚ä½œä¸ºæ ¡éªŒå’Œã€‚</li></ul></li><li><p>Base58Check ç¼–ç ï¼š</p><ul><li>å°†å‰ç¼€ã€å…¬é’¥å“ˆå¸Œå’Œæ ¡éªŒå’Œç»„åˆï¼Œå¹¶è¿›è¡Œ Base58Check ç¼–ç ï¼Œç”Ÿæˆæœ€ç»ˆçš„ Tron åœ°å€ã€‚</li></ul></li></ol><h2 id="æ„å»ºå‘é€TRXäº¤æ˜“ï¼ŒåŸºæœ¬ä¸éœ€è¦æ¶ˆè€—fee"><a href="#æ„å»ºå‘é€TRXäº¤æ˜“ï¼ŒåŸºæœ¬ä¸éœ€è¦æ¶ˆè€—fee" class="headerlink" title="æ„å»ºå‘é€TRXäº¤æ˜“ï¼ŒåŸºæœ¬ä¸éœ€è¦æ¶ˆè€—fee"></a>æ„å»ºå‘é€TRXäº¤æ˜“ï¼ŒåŸºæœ¬ä¸éœ€è¦æ¶ˆè€—fee</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs go"><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SendTrx</span><span class="hljs-params">()</span></span> <span class="hljs-type">bool</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;å¼€å§‹å‘é€TRX&quot;</span>) <span class="hljs-comment">// api key b862ca9d-563b-4eec-8108-2d436b614561</span><br>opts := <span class="hljs-built_in">make</span>([]grpc.DialOption, <span class="hljs-number">0</span>)<br>opts = <span class="hljs-built_in">append</span>(opts, grpc.WithInsecure())<br>c := client.NewGrpcClient(<span class="hljs-string">&quot;grpc.nile.trongrid.io:50051&quot;</span>)<br><br><span class="hljs-keyword">if</span> err := c.Start(opts...); err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;Start err:&quot;</span>, err)<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>&#125;<br><span class="hljs-keyword">if</span> err := c.SetAPIKey(<span class="hljs-string">&quot;b862ca9d-563b-4eec-8108-2d436b614561&quot;</span>); err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;SetAPIKey err:&quot;</span>, err)<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>&#125;<br>alice := <span class="hljs-string">&quot;TBSssNBoAX5isgjaR9cLZ4i84rf1Q7A5gr&quot;</span><br>bob := <span class="hljs-string">&quot;TJF5RmJW2io8pcbHVXAGf9i5uXncJQBxX3&quot;</span><br><br><span class="hljs-comment">// 1. åˆ›å»ºè½¬è´¦äº¤æ˜“</span><br>tx, err := c.Transfer(alice, bob, <span class="hljs-number">1000</span>)<br><span class="hljs-comment">// æ²¡æœ‰æ‰¾åˆ°è‡ªå®šä¹‰å¸¦å®½å’Œèƒ½é‡çš„æ–¹æ³•ï¼Œåªèƒ½ç”¨é»˜è®¤çš„</span><br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;åˆ›å»ºäº¤æ˜“å¤±è´¥:&quot;</span>, err)<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>&#125;<br><span class="hljs-comment">// 2.æ¢å¤ç­¾åè€…</span><br>keyStore, keyStoreAccount, err := store.UnlockedKeystore(alice, <span class="hljs-string">&quot;&quot;</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Printf(<span class="hljs-string">&quot;è§£é”è´¦æˆ·å¤±è´¥=%v&quot;</span>, err)<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>&#125;<br><span class="hljs-comment">// 3. ç­¾åäº¤æ˜“</span><br>controller := transaction.NewController(c, keyStore, keyStoreAccount, tx.Transaction)<br><span class="hljs-comment">// 4. å¹¿æ’­äº¤æ˜“---&gt;è¿™é‡Œå¾ˆç‰¹åˆ«ï¼Œæ–°å»ºæ§åˆ¶å™¨ï¼Œé€šè¿‡æ§åˆ¶å™¨å»æ‰§è¡Œäº¤æ˜“ï¼Œæ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼ŒæŠŠæ­¥éª¤å˜æˆä¸€ç§è¡Œä¸º</span><br><span class="hljs-keyword">if</span> err = controller.ExecuteTransaction(); err != <span class="hljs-literal">nil</span> &#123;<br>logrus.Warnf(<span class="hljs-string">&quot;ExecuteTransaction error: %s&quot;</span>, err)<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>&#125;<br>txHash, err := controller.TransactionHash()<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;TransactionHash err:&quot;</span>, err)<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>&#125;<br>fmt.Printf(<span class="hljs-string">&quot;https://nile.tronscan.org/#/transaction/%s&quot;</span>, txHash[<span class="hljs-number">2</span>:])<br><span class="hljs-keyword">return</span> controller.Result.Result<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æ„å»ºTRC20-è½¬è´¦äº¤æ˜“"><a href="#æ„å»ºTRC20-è½¬è´¦äº¤æ˜“" class="headerlink" title="æ„å»ºTRC20 è½¬è´¦äº¤æ˜“"></a>æ„å»ºTRC20 è½¬è´¦äº¤æ˜“</h2><p>ä¸åŒçš„å°±æ˜¯æ„å»ºäº¤æ˜“é‚£é‡Œæ¢ä¸€ä¸ªæ–¹æ³•è¾“å…¥å¯¹åº”çš„åˆçº¦è°ƒç”¨</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// 1. æ„å»ºå‘é€TRC20äº¤æ˜“</span><br>tx, err := c.TRC20Send(alice, bob, contractAddress, big.NewInt(<span class="hljs-number">100000000</span>), <span class="hljs-number">25000000</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;TRC20Send err:&quot;</span>, err)<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="ä¸‹é¢æ˜¯æ‰‹åŠ¨æ„å»ºæ‰‹åŠ¨å‰é¢ï¼Œå¹¶ä¸”è®¡ç®—gasfee"><a href="#ä¸‹é¢æ˜¯æ‰‹åŠ¨æ„å»ºæ‰‹åŠ¨å‰é¢ï¼Œå¹¶ä¸”è®¡ç®—gasfee" class="headerlink" title="ä¸‹é¢æ˜¯æ‰‹åŠ¨æ„å»ºæ‰‹åŠ¨å‰é¢ï¼Œå¹¶ä¸”è®¡ç®—gasfee"></a>ä¸‹é¢æ˜¯æ‰‹åŠ¨æ„å»ºæ‰‹åŠ¨å‰é¢ï¼Œå¹¶ä¸”è®¡ç®—gasfee</h2><h3 id="gas-fee-limit-çš„ä¸‰ç§è®¾ç½®æ–¹å¼"><a href="#gas-fee-limit-çš„ä¸‰ç§è®¾ç½®æ–¹å¼" class="headerlink" title="gas fee limit çš„ä¸‰ç§è®¾ç½®æ–¹å¼"></a>gas fee limit çš„ä¸‰ç§è®¾ç½®æ–¹å¼</h3><p>EnergyPriceå•ä»·ä¸º210 sun</p><ul><li><strong>ç¬¬ä¸€ç§ï¼š</strong>æ¯æ¬¡åˆçº¦è°ƒç”¨å‰ä¼°ç®—èƒ½æº</li></ul><p>æœ€ç²¾å‡†çš„æ–¹å¼ï¼Œä¹Ÿæ˜¯æœ€ç¹çï¼Œæ¯ç¬”äº¤æ˜“å‰éƒ½éœ€è¦ä¼°ç®—ï¼š</p><p>æ¯æ¬¡äº¤æ˜“å‰é€šè¿‡æ¥å£</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">FeeLimit of contract transaction = estimated total energy consumption * EnergyPrice<br>åˆçº¦äº¤æ˜“çš„FeeLimit=é¢„è®¡æ€»èƒ½æºæ¶ˆè€—é‡*EnergyPrice<br>é¢„è®¡æ€»èƒ½æºæ¶ˆè€—é‡æ˜¯energy_useå—ï¼Ÿ<br>EnergyPriceå•ä»·æ˜¯å¤šå°‘ï¼Ÿ<br>ç›®å‰èƒ½æºå•ä»·ä¸º210å¤ªé˜³èƒ½ã€‚æœ‰å…³å¦‚ä½•ä¼°ç®—èƒ½æºæ¶ˆè€—<br></code></pre></td></tr></table></figure><ul><li><strong>ç¬¬äºŒç§ï¼š</strong>æ¯ç»´æŠ¤å‘¨æœŸè·å–ä¸€æ¬¡åˆçº¦<code>energy_factor</code></li></ul><p>é€šè¿‡æ¥å£è·å–æ‹¿åˆ°èƒ½æºæ¶ˆè€—energy_use,å†é€šè¿‡æ¥å£æ‹¿åˆ°energy_factorï¼Œæ ¹æ®å…¬å¼</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">FeeLimit of contract transaction = estimated basic energy consumption * (1 + energy_factor) * EnergyPrice<br>FeeLimit = é¢„ä¼°åŸºç¡€èƒ½æºæ¶ˆè€—energy_use * (1 + energy_factor) * EnergyPrice<br>è¿™ä¸ªEnergyPrice æ˜¯ä»€ä¹ˆï¼Ÿ<br></code></pre></td></tr></table></figure><ul><li><strong>ç¬¬ä¸‰ç§ï¼š</strong>æ ¹æ®<code>max_factor</code>è®¾ç½®<code>feelimit</code></li></ul><p>é¦–å…ˆé€šè¿‡<a href="https://developers.tron.network/reference/triggerconstantcontract">triggerconstantcontract</a> APIæˆ–è€…åˆçº¦è¿‡å»çš„å†å²ç»éªŒç¡®å®šæŸä¸ªåˆçº¦æŸä¸ªå‡½æ•°çš„åŸºæœ¬èƒ½è€—ï¼Œç„¶åå–é“¾çš„<code>max_factor</code>å‚æ•°<code>max_factor</code>æ˜¯èƒ½è€—æƒ©ç½šç³»æ•°çš„æœ€å¤§æ¯”ä¾‹ï¼Œæ‰€ä»¥æ— è®ºçƒ­é—¨åˆçº¦çš„èƒ½è€—å¦‚ä½•æ³¢åŠ¨ï¼Œéƒ½ä¸ä¼šè¶…è¿‡è¿™ä¸ªæœ€å¤§æ¯”ä¾‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">FeeLimit of contract transaction = estimated basic energy consumption *ï¼ˆ1 + max_factorï¼‰* EnergyPrice<br>åˆçº¦äº¤æ˜“çš„FeeLimit = é¢„ä¼°åŸºç¡€èƒ½æºæ¶ˆè€—*ï¼ˆ1 + max_factorï¼‰* EnergyPrice<br>max_factor=3.4 æ˜¯ç¬¬äºŒç§æ–¹å¼é‡Œçš„energy_factorçš„æœ€å¤§å€¼<br></code></pre></td></tr></table></figure><h3 id="å¸¦å®½è´¹-ä¸ç”¨è®¾ç½®å¸¦å®½"><a href="#å¸¦å®½è´¹-ä¸ç”¨è®¾ç½®å¸¦å®½" class="headerlink" title="å¸¦å®½è´¹ ä¸ç”¨è®¾ç½®å¸¦å®½"></a>å¸¦å®½è´¹ ä¸ç”¨è®¾ç½®å¸¦å®½</h3><p>ç›®å‰å¸¦å®½å•ä»·ä¸º1000sun</p><p>ä¸€ç¬”äº¤æ˜“æ‰€æ¶ˆè€—çš„å¸¦å®½ç­‰äºé“¾ä¸Šäº¤æ˜“å ç”¨çš„å­—èŠ‚æ•°ï¼Œé“¾ä¸Šäº¤æ˜“åŒ…æ‹¬äº¤æ˜“çš„raw_dataã€äº¤æ˜“ç­¾åã€äº¤æ˜“ç»“æœä¸‰éƒ¨åˆ†ï¼Œè¿™ä¸‰éƒ¨åˆ†ç»è¿‡protobufåºåˆ—åŒ–ç¼–ç åæ‰€å çš„å­—èŠ‚æ•°å°±æ˜¯è¿™ç¬”äº¤æ˜“æ‰€æ¶ˆè€—çš„å¸¦å®½ã€‚ä»¥tridentå’Œtronwebä¸ºä¾‹ï¼Œè¯´æ˜å¦‚ä½•ä¼°ç®—å¸¦å®½ï¼š</p><ul><li><p>ä½¿ç”¨ trident ä¼°ç®—å¸¦å®½</p><p>trident æä¾›äº†ä¸€ä¸ªå¸¦å®½é¢„ä¼°<a href="https://developers.tron.network/reference/apis-transactions#estimatebandwidth">APIestimateBandwidth</a> ï¼Œå‚æ•°æ˜¯ä¸€ä¸ªç­¾åçš„äº¤æ˜“ï¼Œæ¥å£å®ç°å¦‚ä¸‹ï¼š</p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs javascript">public long <span class="hljs-title function_">estimateBandwidth</span>(<span class="hljs-params">Transaction txn</span>) <br>&#123;<br>    long byteSize = txn.<span class="hljs-title function_">toBuilder</span>().<span class="hljs-title function_">clearRet</span>().<span class="hljs-title function_">build</span>().<span class="hljs-title function_">getSerializedSize</span>() + <span class="hljs-number">64</span>;<br>    <span class="hljs-keyword">return</span> byteSize;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ tronweb ä¼°ç®—å¸¦å®½,è¿™ä¸ªæœ‰ç‚¹å¤æ‚</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">function</span> <span class="hljs-title function_">estimateBandwidth</span>(<span class="hljs-params">signedTxn</span>)<br>&#123;<br>    <span class="hljs-keyword">var</span> <span class="hljs-variable constant_">DATA_HEX_PROTOBUF_EXTRA</span> = <span class="hljs-number">3</span>;<br>    <span class="hljs-keyword">var</span> <span class="hljs-variable constant_">MAX_RESULT_SIZE_IN_TX</span> = <span class="hljs-number">64</span>;<br>    <span class="hljs-keyword">var</span> <span class="hljs-variable constant_">A_SIGNATURE</span> = <span class="hljs-number">67</span>;<br><br>    <span class="hljs-keyword">var</span> len = signedTxn.<span class="hljs-property">raw_data_hex</span>.<span class="hljs-property">length</span> /<span class="hljs-number">2</span> + <span class="hljs-variable constant_">DATA_HEX_PROTOBUF_EXTRA</span> + <span class="hljs-variable constant_">MAX_RESULT_SIZE_IN_TX</span>  ;<br>    <span class="hljs-keyword">var</span> signatureListSize = signedTxn.<span class="hljs-property">signature</span>.<span class="hljs-property">length</span><br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(signatureListSize)<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">let</span> i=<span class="hljs-number">0</span>;i&lt;signatureListSize;i++)<br>    &#123;<br>        len += <span class="hljs-variable constant_">A_SIGNATURE</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> len;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="æ‰‹åŠ¨æ„å»º"><a href="#æ‰‹åŠ¨æ„å»º" class="headerlink" title="æ‰‹åŠ¨æ„å»º"></a>æ‰‹åŠ¨æ„å»º</h2><p>æ­¥éª¤è¿˜æ˜¯å’Œå…¶ä»–é“¾ä¸€æ ·æ„å»ºâ€“&gt;ç­¾åâ€“&gt;å¹¿æ’­</p><p>æ„å»ºä¹‹å‰ç®—å¥½fee_limitå³å¯</p><p>Feee_limit ç­‰äº é¢„ä¼°èƒ½æºæ¶ˆè€— x èƒ½æºå•ä»·å³å¯</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TransactionBuilder</span><span class="hljs-params">()</span></span> <span class="hljs-type">bool</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;å¼€å§‹æ„å»ºäº¤æ˜“&quot;</span>)<br>c := getClient()<br>alice := <span class="hljs-string">&quot;TBSssNBoAX5isgjaR9cLZ4i84rf1Q7A5gr&quot;</span><br>bob := <span class="hljs-string">&quot;TJF5RmJW2io8pcbHVXAGf9i5uXncJQBxX3&quot;</span><br><br>from := alice<br>contractAddress := <span class="hljs-string">&quot;TF17BgPaZYbz8oxbjhriubPDsA7ArKoLX3&quot;</span><br>method := <span class="hljs-string">&quot;transfer(address,uint256)&quot;</span><br><br><span class="hljs-comment">// 1 è®¡ç®—èƒ½æºæ¶ˆè€—</span><br>estimateEnergyMessage, err := c.EstimateEnergy(from, contractAddress, method, fmt.Sprintf(<span class="hljs-string">`</span><br><span class="hljs-string">[</span><br><span class="hljs-string">&#123;&quot;address&quot;:&quot;TBSssNBoAX5isgjaR9cLZ4i84rf1Q7A5gr&quot;&#125;,</span><br><span class="hljs-string">&#123;&quot;uint256&quot;:&quot;100000000000000000&quot;&#125;</span><br><span class="hljs-string">]</span><br><span class="hljs-string">`</span>), <span class="hljs-number">0</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-number">0</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;EstimateEnergy err:&quot;</span>, err)<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>&#125;<br>fmt.Printf(<span class="hljs-string">&quot;txExtention: %+v\n&quot;</span>, estimateEnergyMessage)<br><span class="hljs-comment">// èƒ½æºæ¶ˆè€—=estimateEnergyMessage.EnergyRequired  result:&#123;result:true&#125; energy_required:16915</span><br><span class="hljs-comment">// èƒ½æºæ¶ˆè€—ä¹˜ä»¥å•ä»·210</span><br>fee_limit := estimateEnergyMessage.EnergyRequired * <span class="hljs-number">180</span><br>fmt.Println(<span class="hljs-string">&quot;energyCost&quot;</span>, fee_limit)<br><span class="hljs-comment">// 2ç»„è£…äº¤æ˜“</span><br>tx, err := c.TRC20Send(alice, bob, contractAddress, big.NewInt(<span class="hljs-number">100000000000000000</span>), fee_limit)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;TRC20Send err:&quot;</span>, err)<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>&#125;<br><span class="hljs-comment">// 3.æ¢å¤ç­¾åè€…</span><br>keyStore, keyStoreAccount, err := store.UnlockedKeystore(alice, <span class="hljs-string">&quot;&quot;</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Printf(<span class="hljs-string">&quot;è§£é”è´¦æˆ·å¤±è´¥=%v&quot;</span>, err)<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>&#125;<br><span class="hljs-comment">// 4.ç­¾åäº¤æ˜“</span><br>signedTx, err := keyStore.SignTx(*keyStoreAccount, tx.Transaction)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;SignTx err:&quot;</span>, err)<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br><br>&#125;<br>rawData := signedTx.GetRawData()<br>rawDataPro, _ := proto.Marshal(rawData)<br>h256h := sha256.New()<br>h256h.Write(rawDataPro)<br>hash := h256h.Sum(<span class="hljs-literal">nil</span>)<br><span class="hljs-comment">//fmt.Printf(&quot;hash=%v&quot;, common.BytesToHexString(hash))</span><br>fmt.Printf(<span class="hljs-string">&quot;https://nile.tronscan.org/#/transaction/%s&quot;</span>, hex.EncodeToString(hash))<br><span class="hljs-comment">// 5.å¹¿æ’­äº¤æ˜“</span><br>res, err := c.Broadcast(signedTx)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;Broadcast err:&quot;</span>, err)<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br><br>&#125;<br><span class="hljs-keyword">return</span> res.Result<br></code></pre></td></tr></table></figure><h1 id="è´¨æŠ¼"><a href="#è´¨æŠ¼" class="headerlink" title="è´¨æŠ¼"></a>è´¨æŠ¼</h1><p>TRONç½‘ç»œæœ‰ä¸‰ç§ç³»ç»Ÿèµ„æºï¼š</p><ul><li><a href="https://developers.tron.network/docs/resource-model#energy">Energy æ´»åŠ›</a></li><li><a href="https://developers.tron.network/docs/resource-model#bandwidth">Bandwidth å¸¦å®½</a></li><li><a href="https://developers.tron.network/docs/resource-model#voting-right">Voting right æŠ•ç¥¨æƒ</a></li></ul><p>èƒ½æºå’Œå¸¦å®½èµ„æºç”±è´¦æˆ·æ‰€æœ‰è€…é€šè¿‡ Stake è·å¾—ï¼Œå¦‚ä½•é€šè¿‡ HTTP API å®Œæˆ Stake æ“ä½œè¯·å‚é˜…<a href="https://developers.tron.network/reference/freezebalancev2-1">wallet&#x2F;freezebalancev2</a> ï¼Œå¦‚ä½•é€šè¿‡åˆçº¦å®Œæˆ Stake æ“ä½œè¯·å‚é˜…<a href="https://developers.tron.network/docs/stake-20-solidity-api#freezebalancev2uint-amount-uint-resourcetype">Stake2.0 Solidity API</a> ã€‚</p><p>TRON é€šè¿‡è´¨æŠ¼æœºåˆ¶æ¥åˆ†é…èµ„æºï¼Œè´¨æŠ¼ TRX é™¤äº†å¯ä»¥è·å¾—å¸¦å®½æˆ–èƒ½æºèµ„æºå¤–ï¼Œè¿˜å°†è·å¾—ä¸è´¨æŠ¼é‡‘é¢ç­‰å€¼çš„æŠ•ç¥¨æƒï¼ˆTRON Powerï¼Œç®€ç§° TPï¼‰ã€‚è´¨æŠ¼ 1 ä¸ª TRXï¼Œå¯è·å¾— 1TPã€‚è´¨æŠ¼è·å¾—çš„èƒ½æºæˆ–å¸¦å®½èµ„æºç”¨äºæ”¯ä»˜äº¤æ˜“æ‰‹ç»­è´¹ï¼Œè·å¾—çš„æŠ•ç¥¨æƒç”¨äº<a href="https://developers.tron.network/reference/votewitnessaccount">æŠ•ç¥¨é€‰å‡º</a>è¶…çº§ä»£è¡¨ï¼Œè·å¾—æŠ•ç¥¨å¥–åŠ±ã€‚</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GetContractABI</span><span class="hljs-params">(contractAddress <span class="hljs-type">string</span>)</span></span> &#123;<br>c := getClient()<br><br><span class="hljs-comment">// fmt.Println(&quot;abi&quot;, abi)</span><br><span class="hljs-comment">// abiJson, _ := json.MarshalIndent(&amp;abitest, &quot;&quot;, &quot;  &quot;)</span><br><span class="hljs-comment">// fmt.Println(&quot;abiJson&quot;, string(abiJson))</span><br>method := <span class="hljs-string">&quot;transfer&quot;</span><br>abitest, err := c.GetContractABI(contractAddress)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;GetContractABI err:&quot;</span>, err)<br>&#125;<br>Arguments, err := abi.GetInputsParser(abitest, method)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;GetParser err:&quot;</span>, err)<br>&#125;<br><span class="hljs-comment">// fmt.Println(&quot;Arguments&quot;, Arguments)</span><br><span class="hljs-keyword">for</span> _, arg := <span class="hljs-keyword">range</span> Arguments &#123;<br>fmt.Println(<span class="hljs-string">&quot;arg&quot;</span>, arg)<br><br>&#125;<br>&#125;<br><br><span class="hljs-keyword">const</span> (<br>ResourceCode_BANDWIDTH  = <span class="hljs-number">0</span> <span class="hljs-comment">// å¸¦å®½</span><br>ResourceCode_ENERGY     = <span class="hljs-number">1</span> <span class="hljs-comment">// èƒ½é‡</span><br>ResourceCode_TRON_POWER = <span class="hljs-number">2</span> <span class="hljs-comment">// è¶…çº§èŠ‚ç‚¹æŠ•ç¥¨æƒ ä¸å¯ç”¨ï¼Œ</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">DelegateTrx</span><span class="hljs-params">()</span></span> <span class="hljs-type">bool</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;å¼€å§‹å§”æ‰˜TRX&quot;</span>)<br>c := getClient()<br>alice := <span class="hljs-string">&quot;TBSssNBoAX5isgjaR9cLZ4i84rf1Q7A5gr&quot;</span><br><span class="hljs-comment">// bob := &quot;TJF5RmJW2io8pcbHVXAGf9i5uXncJQBxX3&quot;</span><br><span class="hljs-comment">// è´¨æŠ¼TRX æœ‰ä¸‰ç§ï¼šBANDWIDTHå¸¦å®½ï¼ŒENERGYèƒ½é‡ï¼ŒTRON_POWERè¶…çº§èŠ‚ç‚¹æŠ•ç¥¨æƒ</span><br><span class="hljs-comment">// ç¬¬ä¸€ç§ï¼šå¸¦å®½</span><br><span class="hljs-comment">// tx, err := c.FreezeBalanceV2(alice, ResourceCode_BANDWIDTH, 297000000)</span><br>tx, err := c.FreezeBalanceV2(alice, ResourceCode_ENERGY, <span class="hljs-number">297000000</span>)<br><span class="hljs-comment">// tx, err := c.FreezeBalanceV2(alice, ResourceCode_TRON_POWER, 297000000) // ä¸å¯ç”¨</span><br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;FreezeBalanceV2 err:&quot;</span>, err)<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>&#125;<br>fmt.Println(<span class="hljs-string">&quot;tx&quot;</span>, tx)<br><span class="hljs-comment">// 2.æ¢å¤ç­¾åè€…</span><br>keyStore, keyStoreAccount, err := store.UnlockedKeystore(alice, <span class="hljs-string">&quot;&quot;</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Printf(<span class="hljs-string">&quot;è§£é”è´¦æˆ·å¤±è´¥=%v&quot;</span>, err)<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>&#125;<br><span class="hljs-comment">// 3. ç­¾åäº¤æ˜“</span><br>controller := transaction.NewController(c, keyStore, keyStoreAccount, tx.Transaction)<br><span class="hljs-comment">// 4. å¹¿æ’­äº¤æ˜“---&gt;è¿™é‡Œå¾ˆç‰¹åˆ«ï¼Œæ–°å»ºæ§åˆ¶å™¨ï¼Œé€šè¿‡æ§åˆ¶å™¨å»æ‰§è¡Œäº¤æ˜“ï¼Œæ˜¯ä¸€ç§è®¾è®¡æ¨¡å¼ï¼ŒæŠŠæ­¥éª¤å˜æˆä¸€ç§è¡Œä¸º</span><br><span class="hljs-keyword">if</span> err = controller.ExecuteTransaction(); err != <span class="hljs-literal">nil</span> &#123;<br>logrus.Warnf(<span class="hljs-string">&quot;ExecuteTransaction error: %s&quot;</span>, err)<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>&#125;<br>txHash, err := controller.TransactionHash()<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;TransactionHash err:&quot;</span>, err)<br><span class="hljs-keyword">return</span> <span class="hljs-literal">false</span><br>&#125;<br>fmt.Println(<span class="hljs-string">&quot;txHash&quot;</span>, txHash)<br>fmt.Printf(<span class="hljs-string">&quot;https://nile.tronscan.org/#/transaction/%s&quot;</span>, txHash[<span class="hljs-number">2</span>:])<br><br><span class="hljs-keyword">return</span> controller.Result.Result<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>07-7DOTæ³¢å¡é’±åŒ…å¼€å‘æµç¨‹</title>
    <link href="/2024/11/26/07-7DOT%E6%B3%A2%E5%8D%A1%E9%92%B1%E5%8C%85%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/"/>
    <url>/2024/11/26/07-7DOT%E6%B3%A2%E5%8D%A1%E9%92%B1%E5%8C%85%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€-Polkadotç®€ä»‹"><a href="#ä¸€-Polkadotç®€ä»‹" class="headerlink" title="ä¸€ Polkadotç®€ä»‹"></a>ä¸€ Polkadotç®€ä»‹</h1><p>åç§°ï¼š</p><p>ç²¾åº¦ï¼š</p><p>ç¡®è®¤æ•°ï¼šxxxå—åäº¤æ˜“å®‰å…¨ä¸æ˜“ä¼šæ»š</p><p>æ˜¯å¦æ”¯æŒtokenä»£å¸ï¼šæ˜¯</p><p>æ˜¯å¦æ”¯æŒè´¨æŠ¼:æ˜¯</p><p>å‡ºå—æ—¶é—´:</p><p>åœ°å€ï¼šBase58</p><p><strong>äº¤æ˜“ç­¾åç®—æ³•</strong></p><ul><li><input disabled="" type="checkbox"> secp256k1</li><li><input checked="" disabled="" type="checkbox"> ed25519 BLAKE2b</li><li><input disabled="" type="checkbox"> schnorr_1</li><li><input disabled="" type="checkbox"> å…¶å®ƒç­¾åç®—æ³•</li></ul><h1 id="äºŒ-ç¦»çº¿åœ°å€ç”Ÿæˆ"><a href="#äºŒ-ç¦»çº¿åœ°å€ç”Ÿæˆ" class="headerlink" title="äºŒ ç¦»çº¿åœ°å€ç”Ÿæˆ"></a>äºŒ ç¦»çº¿åœ°å€ç”Ÿæˆ</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GenerateOfflineAddress</span><span class="hljs-params">()</span></span> types.Account &#123;<br>    <span class="hljs-comment">// ç”Ÿæˆéšæœºå¢’---bit39</span><br>    entropy, _ := bip39.NewEntropy(<span class="hljs-number">256</span>)<br>    <span class="hljs-comment">// å¢’ç”ŸæˆåŠ©è®°è¯</span><br>    mnemonic, _ := bip39.NewMnemonic(entropy)<br><br>    <span class="hljs-comment">// ä»åŠ©è®°è¯ç”Ÿæˆç§å­</span><br><br>    logrus.Infof(<span class="hljs-string">&quot;mnemonic: %s&quot;</span>, mnemonic)<br>    seed := bip39.NewSeed(mnemonic, <span class="hljs-string">&quot;&quot;</span>)<br><br>    path := <span class="hljs-string">`m/44&#x27;/501&#x27;/0&#x27;/0&#x27;`</span><br>    derivedKey, _ := hdwallet.Derived(path, seed)<br>    <span class="hljs-comment">//accountFromSeed, err := types.AccountFromBytes(derivedKey)</span><br>    accountFromSeed, err := types.AccountFromSeed(derivedKey.PrivateKey)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>       fmt.Printf(<span class="hljs-string">&quot;err=%v&quot;</span>, err)<br>    &#125;<br>    publicKey := accountFromSeed.PublicKey.ToBase58()<br>    fmt.Println(<span class="hljs-string">&quot;Solana Wallet Address:&quot;</span>, publicKey)<br>    <span class="hljs-keyword">return</span> accountFromSeed<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="ä¸‰-ç¦»çº¿ç­¾å"><a href="#ä¸‰-ç¦»çº¿ç­¾å" class="headerlink" title="ä¸‰ ç¦»çº¿ç­¾å"></a>ä¸‰ ç¦»çº¿ç­¾å</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs go">NewTx := types.NewTransactionParam&#123;<br>    Message: types.NewMessage(types.NewMessageParam&#123;<br>       FeePayer:        Account.PublicKey,<br>       RecentBlockhash: block.Blockhash,<br>       Instructions: []types.Instruction&#123;system.Transfer(system.TransferParam&#123;<br>          From:   Account.PublicKey,<br>          To:     common.PublicKeyFromString(<span class="hljs-string">&quot;6cPnfGr9Y4bZK7ykNpxe2hkKfaPPgsy6Tu5ahyGhzQLt&quot;</span>),<br>          Amount: <span class="hljs-number">123000</span>,<br>       &#125;)&#125;,<br>    &#125;),<br>    Signers: []types.Account&#123;Account&#125;,<br>&#125;<br><br>tx, err := types.NewTransaction(NewTx)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>    logrus.Warnf(<span class="hljs-string">&quot;new transaction error: %s&quot;</span>, err)<br>&#125;<br><br>hash, err := solClient.SendTransaction(bg, tx)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>    logrus.Warnf(<span class="hljs-string">&quot;new transaction error: %s&quot;</span>, err)<br>&#125;<br>logrus.Infof(<span class="hljs-string">&quot;hash: %v&quot;</span>, hash)<br></code></pre></td></tr></table></figure><h1 id="å››-Stacksé’±åŒ…å¼€å‘ä¸­çš„API"><a href="#å››-Stacksé’±åŒ…å¼€å‘ä¸­çš„API" class="headerlink" title="å›› Stacksé’±åŒ…å¼€å‘ä¸­çš„API"></a>å›› Stacksé’±åŒ…å¼€å‘ä¸­çš„API</h1><h2 id="1-è·å–è´¦æˆ·ä¿¡æ¯"><a href="#1-è·å–è´¦æˆ·ä¿¡æ¯" class="headerlink" title="1.è·å–è´¦æˆ·ä¿¡æ¯"></a>1.è·å–è´¦æˆ·ä¿¡æ¯</h2><h2 id="2-è·å–-recentBlochHash-ç›´æ¥ç­¾åçš„è¯-recentBlochHash-ç›¸å½“äº-nonce"><a href="#2-è·å–-recentBlochHash-ç›´æ¥ç­¾åçš„è¯-recentBlochHash-ç›¸å½“äº-nonce" class="headerlink" title="2.è·å– recentBlochHash, ç›´æ¥ç­¾åçš„è¯ recentBlochHash ç›¸å½“äº nonce"></a>2.è·å– recentBlochHash, ç›´æ¥ç­¾åçš„è¯ recentBlochHash ç›¸å½“äº nonce</h2><h2 id="3-è·å–å‡†å¤‡-nonce-è´¦æˆ·çš„-Minimum-Balance-For-Rent-æ•°æ®"><a href="#3-è·å–å‡†å¤‡-nonce-è´¦æˆ·çš„-Minimum-Balance-For-Rent-æ•°æ®" class="headerlink" title="3. è·å–å‡†å¤‡ nonce è´¦æˆ·çš„ Minimum Balance For Rent æ•°æ®"></a>3. è·å–å‡†å¤‡ nonce è´¦æˆ·çš„ Minimum Balance For Rent æ•°æ®</h2><h2 id="4-è·å–æœ€æ–°å—é«˜-ï¼ˆSlotï¼‰"><a href="#4-è·å–æœ€æ–°å—é«˜-ï¼ˆSlotï¼‰" class="headerlink" title="4. è·å–æœ€æ–°å—é«˜ ï¼ˆSlotï¼‰"></a>4. è·å–æœ€æ–°å—é«˜ ï¼ˆSlotï¼‰</h2><h2 id="5-æ ¹æ®å—é«˜è·å–äº¤æ˜“"><a href="#5-æ ¹æ®å—é«˜è·å–äº¤æ˜“" class="headerlink" title="5. æ ¹æ®å—é«˜è·å–äº¤æ˜“"></a>5. æ ¹æ®å—é«˜è·å–äº¤æ˜“</h2><h2 id="6-æ ¹æ®äº¤æ˜“-Hash-è·å–äº¤æ˜“è¯¦æƒ…"><a href="#6-æ ¹æ®äº¤æ˜“-Hash-è·å–äº¤æ˜“è¯¦æƒ…" class="headerlink" title="6. æ ¹æ®äº¤æ˜“ Hash è·å–äº¤æ˜“è¯¦æƒ…"></a>6. æ ¹æ®äº¤æ˜“ Hash è·å–äº¤æ˜“è¯¦æƒ…</h2><h2 id="7-å‘é€äº¤æ˜“åˆ°åŒºå—é“¾ç½‘ç»œ"><a href="#7-å‘é€äº¤æ˜“åˆ°åŒºå—é“¾ç½‘ç»œ" class="headerlink" title="7.å‘é€äº¤æ˜“åˆ°åŒºå—é“¾ç½‘ç»œ"></a>7.å‘é€äº¤æ˜“åˆ°åŒºå—é“¾ç½‘ç»œ</h2><h1 id="äº”-ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘"><a href="#äº”-ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘" class="headerlink" title="äº” ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘"></a>äº” ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘</h1><h1 id="å…­ã€å»ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘-HDé’±åŒ…"><a href="#å…­ã€å»ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘-HDé’±åŒ…" class="headerlink" title="å…­ã€å»ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘ HDé’±åŒ…"></a>å…­ã€å»ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘ HDé’±åŒ…</h1><h1 id="ä¸ƒã€æ€»ç»“"><a href="#ä¸ƒã€æ€»ç»“" class="headerlink" title="ä¸ƒã€æ€»ç»“"></a>ä¸ƒã€æ€»ç»“</h1><h1 id="å…«ã€é™„ä»¶"><a href="#å…«ã€é™„ä»¶" class="headerlink" title="å…«ã€é™„ä»¶"></a>å…«ã€é™„ä»¶</h1><p>å®˜ç½‘ï¼š<a href="https://polkadot.com/">https://polkadot.com/</a></p><p>æ–‡æ¡£ï¼š<a href="https://docs.substrate.io/">https://docs.substrate.io/</a></p><p>èµ„æ–™ï¼›</p><p>èŠ‚ç‚¹ï¼š<a href="https://dashboard.alchemy.com/">https://dashboard.alchemy.com/</a> ç¬¬ä¸‰æ–¹èŠ‚ç‚¹</p><p>æµè§ˆå™¨ï¼š<a href="https://polkadot.subscan.io/">https://polkadot.subscan.io/</a></p><p>ç¬¬ä¸‰æ–¹SDKï¼š<a href="https://github.com/blocto/solana-go-sdk">https://github.com/blocto/solana-go-sdk</a></p><p>API&#x2F;Swager æ–‡æ¡£:<a href="https://solana.com/zh/docs/rpc">https://solana.com/zh/docs/rpc</a></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">solana1.jpg<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>07-6Stacksé’±åŒ…å¼€å‘æµç¨‹</title>
    <link href="/2024/11/26/07-6Stacks%E9%92%B1%E5%8C%85%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/"/>
    <url>/2024/11/26/07-6Stacks%E9%92%B1%E5%8C%85%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="Stacksé’±åŒ…å¼€å‘ç®€å•æ•™ç¨‹"><a href="#Stacksé’±åŒ…å¼€å‘ç®€å•æ•™ç¨‹" class="headerlink" title="Stacksé’±åŒ…å¼€å‘ç®€å•æ•™ç¨‹"></a>Stacksé’±åŒ…å¼€å‘ç®€å•æ•™ç¨‹</h1><h1 id="ä¸€-Stacksç®€ä»‹"><a href="#ä¸€-Stacksç®€ä»‹" class="headerlink" title="ä¸€ Stacksç®€ä»‹"></a>ä¸€ Stacksç®€ä»‹</h1><p>åç§°ï¼š</p><p>ç²¾åº¦ï¼š</p><p>ç¡®è®¤æ•°ï¼šxxxå—åäº¤æ˜“å®‰å…¨ä¸æ˜“ä¼šæ»š</p><p>æ˜¯å¦æ”¯æŒtokenä»£å¸ï¼šæ˜¯</p><p>æ˜¯å¦æ”¯æŒè´¨æŠ¼:æ˜¯</p><p>å‡ºå—æ—¶é—´:</p><p>åœ°å€ï¼šBase58</p><p><strong>äº¤æ˜“ç­¾åç®—æ³•</strong></p><ul><li><input disabled="" type="checkbox"> secp256k1</li><li><input checked="" disabled="" type="checkbox"> ed25519 BLAKE2b</li><li><input disabled="" type="checkbox"> schnorr_1</li><li><input disabled="" type="checkbox"> å…¶å®ƒç­¾åç®—æ³•</li></ul><h1 id="äºŒ-ç¦»çº¿åœ°å€ç”Ÿæˆ"><a href="#äºŒ-ç¦»çº¿åœ°å€ç”Ÿæˆ" class="headerlink" title="äºŒ ç¦»çº¿åœ°å€ç”Ÿæˆ"></a>äºŒ ç¦»çº¿åœ°å€ç”Ÿæˆ</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GenerateOfflineAddress</span><span class="hljs-params">()</span></span> types.Account &#123;<br>    <span class="hljs-comment">// ç”Ÿæˆéšæœºå¢’---bit39</span><br>    entropy, _ := bip39.NewEntropy(<span class="hljs-number">256</span>)<br>    <span class="hljs-comment">// å¢’ç”ŸæˆåŠ©è®°è¯</span><br>    mnemonic, _ := bip39.NewMnemonic(entropy)<br><br>    <span class="hljs-comment">// ä»åŠ©è®°è¯ç”Ÿæˆç§å­</span><br><br>    logrus.Infof(<span class="hljs-string">&quot;mnemonic: %s&quot;</span>, mnemonic)<br>    seed := bip39.NewSeed(mnemonic, <span class="hljs-string">&quot;&quot;</span>)<br><br>    path := <span class="hljs-string">`m/44&#x27;/501&#x27;/0&#x27;/0&#x27;`</span><br>    derivedKey, _ := hdwallet.Derived(path, seed)<br>    <span class="hljs-comment">//accountFromSeed, err := types.AccountFromBytes(derivedKey)</span><br>    accountFromSeed, err := types.AccountFromSeed(derivedKey.PrivateKey)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>       fmt.Printf(<span class="hljs-string">&quot;err=%v&quot;</span>, err)<br>    &#125;<br>    publicKey := accountFromSeed.PublicKey.ToBase58()<br>    fmt.Println(<span class="hljs-string">&quot;Solana Wallet Address:&quot;</span>, publicKey)<br>    <span class="hljs-keyword">return</span> accountFromSeed<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="ä¸‰-ç¦»çº¿ç­¾å"><a href="#ä¸‰-ç¦»çº¿ç­¾å" class="headerlink" title="ä¸‰ ç¦»çº¿ç­¾å"></a>ä¸‰ ç¦»çº¿ç­¾å</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs go">NewTx := types.NewTransactionParam&#123;<br>    Message: types.NewMessage(types.NewMessageParam&#123;<br>       FeePayer:        Account.PublicKey,<br>       RecentBlockhash: block.Blockhash,<br>       Instructions: []types.Instruction&#123;system.Transfer(system.TransferParam&#123;<br>          From:   Account.PublicKey,<br>          To:     common.PublicKeyFromString(<span class="hljs-string">&quot;6cPnfGr9Y4bZK7ykNpxe2hkKfaPPgsy6Tu5ahyGhzQLt&quot;</span>),<br>          Amount: <span class="hljs-number">123000</span>,<br>       &#125;)&#125;,<br>    &#125;),<br>    Signers: []types.Account&#123;Account&#125;,<br>&#125;<br><br>tx, err := types.NewTransaction(NewTx)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>    logrus.Warnf(<span class="hljs-string">&quot;new transaction error: %s&quot;</span>, err)<br>&#125;<br><br>hash, err := solClient.SendTransaction(bg, tx)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>    logrus.Warnf(<span class="hljs-string">&quot;new transaction error: %s&quot;</span>, err)<br>&#125;<br>logrus.Infof(<span class="hljs-string">&quot;hash: %v&quot;</span>, hash)<br></code></pre></td></tr></table></figure><h1 id="å››-Stacksé’±åŒ…å¼€å‘ä¸­çš„API"><a href="#å››-Stacksé’±åŒ…å¼€å‘ä¸­çš„API" class="headerlink" title="å›› Stacksé’±åŒ…å¼€å‘ä¸­çš„API"></a>å›› Stacksé’±åŒ…å¼€å‘ä¸­çš„API</h1><h2 id="1-è·å–è´¦æˆ·ä¿¡æ¯"><a href="#1-è·å–è´¦æˆ·ä¿¡æ¯" class="headerlink" title="1.è·å–è´¦æˆ·ä¿¡æ¯"></a>1.è·å–è´¦æˆ·ä¿¡æ¯</h2><h2 id="2-è·å–-recentBlochHash-ç›´æ¥ç­¾åçš„è¯-recentBlochHash-ç›¸å½“äº-nonce"><a href="#2-è·å–-recentBlochHash-ç›´æ¥ç­¾åçš„è¯-recentBlochHash-ç›¸å½“äº-nonce" class="headerlink" title="2.è·å– recentBlochHash, ç›´æ¥ç­¾åçš„è¯ recentBlochHash ç›¸å½“äº nonce"></a>2.è·å– recentBlochHash, ç›´æ¥ç­¾åçš„è¯ recentBlochHash ç›¸å½“äº nonce</h2><h2 id="3-è·å–å‡†å¤‡-nonce-è´¦æˆ·çš„-Minimum-Balance-For-Rent-æ•°æ®"><a href="#3-è·å–å‡†å¤‡-nonce-è´¦æˆ·çš„-Minimum-Balance-For-Rent-æ•°æ®" class="headerlink" title="3. è·å–å‡†å¤‡ nonce è´¦æˆ·çš„ Minimum Balance For Rent æ•°æ®"></a>3. è·å–å‡†å¤‡ nonce è´¦æˆ·çš„ Minimum Balance For Rent æ•°æ®</h2><h2 id="4-è·å–æœ€æ–°å—é«˜-ï¼ˆSlotï¼‰"><a href="#4-è·å–æœ€æ–°å—é«˜-ï¼ˆSlotï¼‰" class="headerlink" title="4. è·å–æœ€æ–°å—é«˜ ï¼ˆSlotï¼‰"></a>4. è·å–æœ€æ–°å—é«˜ ï¼ˆSlotï¼‰</h2><h2 id="5-æ ¹æ®å—é«˜è·å–äº¤æ˜“"><a href="#5-æ ¹æ®å—é«˜è·å–äº¤æ˜“" class="headerlink" title="5. æ ¹æ®å—é«˜è·å–äº¤æ˜“"></a>5. æ ¹æ®å—é«˜è·å–äº¤æ˜“</h2><h2 id="6-æ ¹æ®äº¤æ˜“-Hash-è·å–äº¤æ˜“è¯¦æƒ…"><a href="#6-æ ¹æ®äº¤æ˜“-Hash-è·å–äº¤æ˜“è¯¦æƒ…" class="headerlink" title="6. æ ¹æ®äº¤æ˜“ Hash è·å–äº¤æ˜“è¯¦æƒ…"></a>6. æ ¹æ®äº¤æ˜“ Hash è·å–äº¤æ˜“è¯¦æƒ…</h2><h2 id="7-å‘é€äº¤æ˜“åˆ°åŒºå—é“¾ç½‘ç»œ"><a href="#7-å‘é€äº¤æ˜“åˆ°åŒºå—é“¾ç½‘ç»œ" class="headerlink" title="7.å‘é€äº¤æ˜“åˆ°åŒºå—é“¾ç½‘ç»œ"></a>7.å‘é€äº¤æ˜“åˆ°åŒºå—é“¾ç½‘ç»œ</h2><h1 id="äº”-ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘"><a href="#äº”-ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘" class="headerlink" title="äº” ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘"></a>äº” ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘</h1><h1 id="å…­ã€å»ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘-HDé’±åŒ…"><a href="#å…­ã€å»ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘-HDé’±åŒ…" class="headerlink" title="å…­ã€å»ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘ HDé’±åŒ…"></a>å…­ã€å»ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘ HDé’±åŒ…</h1><h1 id="ä¸ƒã€æ€»ç»“"><a href="#ä¸ƒã€æ€»ç»“" class="headerlink" title="ä¸ƒã€æ€»ç»“"></a>ä¸ƒã€æ€»ç»“</h1><h1 id="å…«ã€é™„ä»¶"><a href="#å…«ã€é™„ä»¶" class="headerlink" title="å…«ã€é™„ä»¶"></a>å…«ã€é™„ä»¶</h1><p>å®˜ç½‘ï¼š<a href="https://www.stacks.co/">https://www.stacks.co/</a></p><p>æ–‡æ¡£ï¼š<a href="https://docs.stacks.co/stacks-101/what-is-stacks">https://docs.stacks.co/stacks-101/what-is-stacks</a></p><p>èµ„æ–™ï¼›</p><p>èŠ‚ç‚¹ï¼š<a href="https://dashboard.alchemy.com/">https://dashboard.alchemy.com/</a> ç¬¬ä¸‰æ–¹èŠ‚ç‚¹</p><p>æµè§ˆå™¨ï¼š<a href="https://solscan.io/">https://solscan.io/</a></p><p>ç¬¬ä¸‰æ–¹SDKï¼š<a href="https://github.com/blocto/solana-go-sdk">https://github.com/blocto/solana-go-sdk</a></p><p>API&#x2F;Swager æ–‡æ¡£:<a href="https://solana.com/zh/docs/rpc">https://solana.com/zh/docs/rpc</a></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go"><br>solana1.jpg<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>blockChain</category>
      
    </categories>
    
    
    <tags>
      
      <tag>block</tag>
      
      <tag>æ¦‚å¿µ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>07-5SOLé’±åŒ…å¼€å‘æµç¨‹</title>
    <link href="/2024/11/22/07-5SOL%E9%92%B1%E5%8C%85%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/"/>
    <url>/2024/11/22/07-5SOL%E9%92%B1%E5%8C%85%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€-SOLç®€ä»‹"><a href="#ä¸€-SOLç®€ä»‹" class="headerlink" title="ä¸€ SOLç®€ä»‹"></a>ä¸€ SOLç®€ä»‹</h1><p>åç§°ï¼š</p><p>ç²¾åº¦ï¼š</p><p>ç¡®è®¤æ•°ï¼šxxxå—åäº¤æ˜“å®‰å…¨ä¸æ˜“ä¼šæ»š</p><p>æ˜¯å¦æ”¯æŒtokenä»£å¸ï¼šæ˜¯</p><p>æ˜¯å¦æ”¯æŒè´¨æŠ¼:æ˜¯</p><p>å‡ºå—æ—¶é—´:</p><p>åœ°å€ï¼šBase58</p><p><strong>äº¤æ˜“ç­¾åç®—æ³•</strong></p><ul><li><input disabled="" type="checkbox"> secp256k1</li><li><input checked="" disabled="" type="checkbox"> ed25519 BLAKE2b</li><li><input disabled="" type="checkbox"> schnorr_1</li><li><input disabled="" type="checkbox"> å…¶å®ƒç­¾åç®—æ³•</li></ul><h1 id="äºŒ-ç¦»çº¿åœ°å€ç”Ÿæˆ"><a href="#äºŒ-ç¦»çº¿åœ°å€ç”Ÿæˆ" class="headerlink" title="äºŒ ç¦»çº¿åœ°å€ç”Ÿæˆ"></a>äºŒ ç¦»çº¿åœ°å€ç”Ÿæˆ</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">GenerateOfflineAddress</span><span class="hljs-params">()</span></span> types.Account &#123;<br>    <span class="hljs-comment">// ç”Ÿæˆéšæœºå¢’---bit39</span><br>    entropy, _ := bip39.NewEntropy(<span class="hljs-number">256</span>)<br>    <span class="hljs-comment">// å¢’ç”ŸæˆåŠ©è®°è¯</span><br>    mnemonic, _ := bip39.NewMnemonic(entropy)<br><br>    <span class="hljs-comment">// ä»åŠ©è®°è¯ç”Ÿæˆç§å­</span><br><br>    logrus.Infof(<span class="hljs-string">&quot;mnemonic: %s&quot;</span>, mnemonic)<br>    seed := bip39.NewSeed(mnemonic, <span class="hljs-string">&quot;&quot;</span>)<br><br>    path := <span class="hljs-string">`m/44&#x27;/501&#x27;/0&#x27;/0&#x27;`</span><br>    derivedKey, _ := hdwallet.Derived(path, seed)<br>    <span class="hljs-comment">//accountFromSeed, err := types.AccountFromBytes(derivedKey)</span><br>    accountFromSeed, err := types.AccountFromSeed(derivedKey.PrivateKey)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>       fmt.Printf(<span class="hljs-string">&quot;err=%v&quot;</span>, err)<br>    &#125;<br>    publicKey := accountFromSeed.PublicKey.ToBase58()<br>    fmt.Println(<span class="hljs-string">&quot;Solana Wallet Address:&quot;</span>, publicKey)<br>    <span class="hljs-keyword">return</span> accountFromSeed<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="ä¸‰-ç¦»çº¿ç­¾å"><a href="#ä¸‰-ç¦»çº¿ç­¾å" class="headerlink" title="ä¸‰ ç¦»çº¿ç­¾å"></a>ä¸‰ ç¦»çº¿ç­¾å</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs go">NewTx := types.NewTransactionParam&#123;<br>    Message: types.NewMessage(types.NewMessageParam&#123;<br>       FeePayer:        Account.PublicKey,<br>       RecentBlockhash: block.Blockhash,<br>       Instructions: []types.Instruction&#123;system.Transfer(system.TransferParam&#123;<br>          From:   Account.PublicKey,<br>          To:     common.PublicKeyFromString(<span class="hljs-string">&quot;6cPnfGr9Y4bZK7ykNpxe2hkKfaPPgsy6Tu5ahyGhzQLt&quot;</span>),<br>          Amount: <span class="hljs-number">123000</span>,<br>       &#125;)&#125;,<br>    &#125;),<br>    Signers: []types.Account&#123;Account&#125;,<br>&#125;<br><br>tx, err := types.NewTransaction(NewTx)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>    logrus.Warnf(<span class="hljs-string">&quot;new transaction error: %s&quot;</span>, err)<br>&#125;<br><br>hash, err := solClient.SendTransaction(bg, tx)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>    logrus.Warnf(<span class="hljs-string">&quot;new transaction error: %s&quot;</span>, err)<br>&#125;<br>logrus.Infof(<span class="hljs-string">&quot;hash: %v&quot;</span>, hash)<br></code></pre></td></tr></table></figure><p>ä¸‰ã€äº¤æ˜“ç†è§£</p><p>solè½¬è´¦äº¤æ˜“</p><p>äº¤æ˜“åŒ…æ‹¬ä¸€ä¸ªæˆ–å¤šä¸ª <a href="https://solana.com/docs/core/transactions#instruction">æŒ‡ä»¤</a>ï¼Œæ¯ä¸ªä»£è¡¨è¦å¤„ç†çš„ç‰¹å®šæ“ä½œã€‚æŒ‡ä»¤çš„æ‰§è¡Œé€»è¾‘å­˜å‚¨åœ¨éƒ¨ç½²åˆ°Solanaç½‘ç»œçš„<a href="https://solana.com/docs/core/programs">ç¨‹åº</a>ä¸Šï¼Œæ¯ä¸ªç¨‹åºéƒ½å­˜å‚¨è‡ªå·±çš„æŒ‡ä»¤é›†ã€‚</p><p>ä¸ºç®€å•èµ·è§ï¼Œå¯ä»¥å°†äº¤æ˜“è§†ä¸ºå¤„ç†ä¸€ä¸ªæˆ–å¤šä¸ªè¯´æ˜çš„è¯·æ±‚</p><p><img src="/img/web3/soltrx1.jpg" alt="s"></p><p>æ³¨æ„ï¼šä¼šæŒ‰ç…§é¡ºåºæ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨é€šè¿‡ï¼Œè¦ä¹ˆå…¨éƒ¨ä¸é€šè¿‡</p><p>Instruction æŒ‡ä»¤ï¼Œä¸‹é¢æ˜¯å•ä¸ªæŒ‡ä»¤çš„ç¤ºæ„å›¾</p><p><img src="/img/web3/soltrx2.jpg" alt="s"></p><p>æŒ‡ä»¤ä¸­åŒ…å«:</p><ul><li>System Program </li><li>Accounts:å¸æˆ·ä¿¡æ¯ï¼šSender åœ°å€ å’Œ Receiver åœ°å€</li><li>Transfer Amount è½¬è´¦é‡‘é¢ï¼Œæ³¨æ„ï¼šç»™ä¸€ä¸ªæ–°åœ°å€è½¬è´¦çš„æ—¶å€™ï¼Œå¿…é¡»è¦å¤§äºç­‰äºç§Ÿé‡‘è´¹ç”¨890880 ä¹Ÿå°±æ˜¯0.00089088ï¼Œæ»¡è¶³ç§Ÿé‡‘åå°±å¯ä»¥éšä¾¿è½¬è´¦äº†,å¯ä»¥é€šè¿‡GetMinimumBalanceForRentExemptionæ¥å£æ‹¿åˆ°è¿™ä¸ªé‡‘é¢</li></ul><p>çœ‹ä»£ç </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><code class="hljs go"><br><span class="hljs-comment">// SendSol ç”¨äºç»„è£…solå¸çš„çš„äº¤æ˜“</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SendSol</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-comment">// æ‹†è§£</span><br>DEV := <span class="hljs-string">&quot;https://solana-devnet.g.alchemy.com/v2/wqZxT7UnY6AgrzV42CtGgGQ7ZGM-UrTq&quot;</span><br>c := client.NewClient(DEV)<br><span class="hljs-comment">// 1ã€å¯¼å…¥ç§é’¥æ¢å¤å¸æˆ·</span><br>piv := <span class="hljs-string">&quot;46M2pAp4z3mNPuTh7jS8XHSn69TC4FAnX33Avjx7wqy3W1zzZKiSoBmNTH5PEBDKu7xR2rPa9ocSyzGWYFK7VRF2&quot;</span><br>alice, err := types.AccountFromBase58(piv)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Printf(<span class="hljs-string">&quot;err=%v&quot;</span>, err)<br>&#125;<br>bob := <span class="hljs-string">&quot;6cPnfGr9Y4bZK7ykNpxe2hkKfaPPgsy6Tu5ahyGhzQLt&quot;</span><br><br><span class="hljs-comment">// æŸ¥è¯¢ä¸‹åœ°å€çš„å½“å‰ä½™é¢</span><br>balances, err := c.GetBalance(context.Background(), alice.PublicKey.String())<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Printf(<span class="hljs-string">&quot;get balances err = %v&quot;</span>, err)<br>&#125;<br>fmt.Printf(<span class="hljs-string">&quot;balances = %v\n&quot;</span>, balances)<br><span class="hljs-comment">// 2ã€ç»„è£…äº¤æ˜“</span><br><span class="hljs-comment">// 2.1 æ‹¿recentBlockhashResponse</span><br>recentBlockhashResponse, err := c.GetLatestBlockhash(context.Background())<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatalf(<span class="hljs-string">&quot;failed to get recent blockhash, err: %v&quot;</span>, err)<br>&#125;<br><span class="hljs-comment">// æœ€å°è½¬è´¦é‡‘é¢</span><br>minimumBalanceForRentExemption, err := c.GetMinimumBalanceForRentExemption(context.Background(), <span class="hljs-number">0</span>)<br>fmt.Printf(<span class="hljs-string">&quot;minimumBalanceForRentExemption = %v\n&quot;</span>, minimumBalanceForRentExemption)<br><span class="hljs-comment">// 2.2 å®šä¹‰Instructionç„¶åå¡«å……å®ƒ</span><br>ins := <span class="hljs-built_in">make</span>([]types.Instruction, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>)<br><span class="hljs-comment">// createAccount</span><br><span class="hljs-comment">//createAccountInstruction := system.CreateAccount(</span><br><span class="hljs-comment">//system.CreateAccountParam&#123;</span><br><span class="hljs-comment">//From:     alice.PublicKey,</span><br><span class="hljs-comment">//New:      common.PublicKeyFromString(alice.PublicKey.String()),</span><br><span class="hljs-comment">//Owner:    common.StakeProgramID,</span><br><span class="hljs-comment">//Lamports: nonceAccountMinimumBalance,</span><br><span class="hljs-comment">//Space:    system.NonceAccountSize,</span><br><span class="hljs-comment">//&#125;)</span><br><span class="hljs-comment">//ins = append(ins, createAccountInstruction)</span><br><span class="hljs-comment">// äº¤æ˜“åˆ†æˆ2ä¸ªå¤§éƒ¨ä»½ Transactions å’Œ Instructions æŒ‡ä»¤ï¼ŒInstructionså¯ä»¥æœ‰å¤šä¸ª</span><br><span class="hljs-comment">// è¿™é‡Œæˆ‘ä»¬å…ˆåšä¸€ä¸ªç®€å•çš„äº¤æ˜“ inså°±æ˜¯Instructions\</span><br>ins = <span class="hljs-built_in">append</span>(ins, system.Transfer(<br>system.TransferParam&#123;<br>From:   common.PublicKeyFromString(alice.PublicKey.String()),<br>To:     common.PublicKeyFromString(bob),<br>Amount: minimumBalanceForRentExemption,<br>&#125;))<br>message := types.NewMessage(<br>types.NewMessageParam&#123;<br>FeePayer:        common.PublicKeyFromString(alice.PublicKey.String()),<br>Instructions:    ins,<br>RecentBlockhash: recentBlockhashResponse.Blockhash,<br>&#125;)<br>tx, err := types.NewTransaction(types.NewTransactionParam&#123;<br>Message: message,<br>Signers: []types.Account&#123;alice&#125;,<br>&#125;)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatalf(<span class="hljs-string">&quot;failed to new transaction, err: %v&quot;</span>, err)<br>&#125;<br><span class="hljs-comment">// 3ã€å¹¿æ’­ä¸Šé“¾</span><br>txhash, err := c.SendTransaction(context.Background(), tx)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatalf(<span class="hljs-string">&quot;failed to SendTransaction, err: %v&quot;</span>, err)<br>&#125;<br>fmt.Println(<span class="hljs-string">&quot;tx hash&quot;</span>, txhash)<br>&#125;<br></code></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬æ¥çœ‹çœ‹è½¬è´¦æŒ‡ä»¤å‘ç”Ÿäº†ä»€ä¹ˆ</p><p><img src="/img/web3/soltrx3.jpg" alt="s"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå†…éƒ¨æ˜¯ç”±å‘é€è€…Sender åœ°å€çš„Lamprotså¸æˆ·è½¬ç»™äº† å’Œ Receiver åœ°å€çš„Lamprotså¸æˆ·ï¼Œå› ä¸ºsolä¸€åˆ‡çš†ä¸ºå¸æˆ·</p><p>ç»§ç»­å¾€ä¸‹çœ‹ï¼Œäº¤æ˜“ç”±ä»€ä¹ˆç»„æˆï¼Œç”± ç­¾åSignatures + æ¶ˆæ¯Messageç»„æˆ</p><p><img src="/img/web3/soltrx4.jpg" alt="s"></p><p>æ¶ˆæ¯Messageé‡ŒåŒ…å«äº†ä»€ä¹ˆï¼Ÿ4ä¸ªä¸œè¥¿</p><ul><li><a href="https://solana.com/docs/core/transactions#message-header">Message Header</a>: Specifies the number of signer and read-only account.<br><a href="https://solana.com/docs/core/transactions#message-header">æ¶ˆæ¯å¤´</a>ï¼šæŒ‡å®šç­¾åè€…çš„æ•°é‡å’Œä»…é˜…è¯»å¸æˆ·çš„æ•°é‡ã€‚</li><li><a href="https://solana.com/docs/core/transactions#array-of-account-addresses">Account Addresses</a>: An array of account addresses required by the instructions on the transaction.<br><a href="https://solana.com/docs/core/transactions#array-of-account-addresses">å¸æˆ·åœ°å€</a>ï¼šäº¤æ˜“æŒ‡ä»¤è¦æ±‚çš„å¸æˆ·åœ°å€æ•°ç»„ã€‚</li><li><a href="https://solana.com/docs/core/transactions#recent-blockhash">Recent Blockhash</a>: Acts as a timestamp for the transaction.<br><a href="https://solana.com/docs/core/transactions#recent-blockhash">æœ€è¿‘çš„å—</a>ï¼šå……å½“äº¤æ˜“çš„æ—¶é—´æˆ³ã€‚</li><li><a href="https://solana.com/docs/core/transactions#array-of-instructions">Instructions</a>: An array of instructions to be executed.<br><a href="https://solana.com/docs/core/transactions#array-of-instructions">è¯´æ˜</a>ï¼šè¦æ‰§è¡Œçš„ä¸€ç³»åˆ—è¯´æ˜</li></ul><p><img src="/img/web3/soltrx5.jpg" alt="s"></p><h2 id="Tokençš„è½¬è´¦"><a href="#Tokençš„è½¬è´¦" class="headerlink" title="Tokençš„è½¬è´¦"></a>Tokençš„è½¬è´¦</h2><p>tokenè½¬è´¦çš„å…³é”®å°±æ˜¯æ‹¿åˆ°å‘é€è€…å’Œæ¥æ”¶è€…åœ¨è¿™ä¸ªä»£å¸åˆçº¦ä¸Šçš„åœ°å€</p><p>è¿˜æœ‰è¦ç¡®å®šæ¥æ”¶è€…çš„å­å¸æˆ·(åœ¨è¿™ä¸ªtokenä¸Šçš„åœ°å€)æ˜¯å¦ä¸Šé“¾ï¼Œå¦‚æœæ²¡æœ‰ä¸Šè¿‡é“¾(æ–°åœ°å€)åˆ™éœ€è¦ä¸ºå…¶åˆ›å»ºå¯¹åº”çš„å­å¸æˆ·åœ°å€ç”¨äºæ¥æ”¶token</p><p>çœ‹ä»£ç </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// SendToken ç”¨äºç»„è£…Tokenä»£å¸çš„çš„äº¤æ˜“</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">SendToken</span><span class="hljs-params">()</span></span> &#123;<br><br>    tokenAddress := <span class="hljs-string">&quot;58g1sdTgzazjR4ApXxPP63JRHj4ZDXePX251An7fxEhG&quot;</span><br>    DEV := <span class="hljs-string">&quot;https://solana-devnet.g.alchemy.com/v2/wqZxT7UnY6AgrzV42CtGgGQ7ZGM-UrTq&quot;</span><br>    c := client.NewClient(DEV)<br>    <span class="hljs-comment">// 1ã€è·å–ä»£å¸çš„owner æ‹¥æœ‰è€…</span><br>    <span class="hljs-comment">//accInfo, err := c.GetAccountInfo(context.Background(), tokenAddress)</span><br>    <span class="hljs-comment">//if err != nil &#123;</span><br>    <span class="hljs-comment">// log.Fatalf(&quot;failed to GetAccountInfo, err: %v&quot;, err)</span><br>    <span class="hljs-comment">//&#125;</span><br>    <span class="hljs-comment">//</span><br>    <span class="hljs-comment">//fmt.Printf(&quot;accInfo Owner =%v\n&quot;, accInfo.Owner)</span><br>    <span class="hljs-comment">// 2 å¯»æ‰¾ç”¨æˆ·åœ¨è¿™ä¸ªtokenä¸Šçš„åœ°å€</span><br>    piv := <span class="hljs-string">&quot;46M2pAp4z3mNPuTh7jS8XHSn69TC4FAnX33Avjx7wqy3W1zzZKiSoBmNTH5PEBDKu7xR2rPa9ocSyzGWYFK7VRF2&quot;</span><br>    alice, err := types.AccountFromBase58(piv)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>       fmt.Printf(<span class="hljs-string">&quot;err=%v&quot;</span>, err)<br>    &#125;<br>    bob := <span class="hljs-string">&quot;6cPnfGr9Y4bZK7ykNpxe2hkKfaPPgsy6Tu5ahyGhzQLt&quot;</span><br>    <span class="hljs-comment">//bob := &quot;8pZWotbBSKBy6Luxf41TxUxDvZHp49jAbuUe2yFZRorE&quot;</span><br>    fromTokenATA, _, err := common.FindAssociatedTokenAddress(alice.PublicKey, common.PublicKeyFromString(tokenAddress))<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>       log.Fatalf(<span class="hljs-string">&quot;failed to FindAssociatedTokenAddress, err: %v&quot;</span>, err)<br>    &#125;<br>    <span class="hljs-comment">//fmt.Printf(&quot;fromTokenATA=%v\n&quot;, fromTokenATA)</span><br>    toTokenATA, _, err := common.FindAssociatedTokenAddress(common.PublicKeyFromString(bob), common.PublicKeyFromString(tokenAddress))<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>       log.Fatalf(<span class="hljs-string">&quot;failed to FindAssociatedTokenAddress, err: %v&quot;</span>, err)<br>    &#125;<br>    <span class="hljs-comment">//fmt.Printf(&quot;toTokenATA=%v\n&quot;, toTokenATA)</span><br>    ins := <span class="hljs-built_in">make</span>([]types.Instruction, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>)<br>    recentBlockhashResponse, err := c.GetLatestBlockhash(context.Background())<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>       log.Fatalf(<span class="hljs-string">&quot;failed to get recent blockhash, err: %v&quot;</span>, err)<br>    &#125;<br>    info, err := c.GetTokenAccount(context.Background(), toTokenATA.ToBase58())<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>       <span class="hljs-keyword">if</span> errors.Is(err, token.ErrInvalidAccountOwner) &#123;<br>          fmt.Println(<span class="hljs-string">&quot;test&quot;</span>)<br>          ins = <span class="hljs-built_in">append</span>(ins, associated_token_account.Create(<br>             associated_token_account.CreateParam&#123;<br>                Funder:                 common.PublicKeyFromString(alice.PublicKey.String()),<br>                Owner:                  common.PublicKeyFromString(bob),<br>                Mint:                   common.PublicKeyFromString(tokenAddress),<br>                AssociatedTokenAccount: toTokenATA,<br>                <span class="hljs-comment">//ProgramID:              programID,</span><br>             &#125;))<br><br>       &#125; <span class="hljs-keyword">else</span> &#123;<br>          log.Fatalf(<span class="hljs-string">&quot;failed to GetTokenAccount, err: %v&quot;</span>, err)<br>       &#125;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>       <span class="hljs-keyword">if</span> info.Owner.ToBase58() != bob &#123;<br>          log.Fatalf(<span class="hljs-string">&quot;failed to GetTokenAccount,info!=bob err: %v&quot;</span>, err)<br>       &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// è¿½åŠ ä¼˜å…ˆè´¹</span><br>    ComputerUnitPrice := <span class="hljs-type">uint64</span>(<span class="hljs-number">110000</span>) <span class="hljs-comment">//ä¸€ä¸ªè®¡ç®—å•å…ƒçš„ä»·æ ¼</span><br>    ComputerUnitLimit := <span class="hljs-type">uint32</span>(<span class="hljs-number">200000</span>) <span class="hljs-comment">//è®¡ç®—å•å…ƒçš„é™åˆ¶</span><br>    ins = <span class="hljs-built_in">append</span>(ins, compute_budget.SetComputeUnitPrice(compute_budget.SetComputeUnitPriceParam&#123;<br>       MicroLamports: ComputerUnitPrice,<br>    &#125;))<br><br>    ins = <span class="hljs-built_in">append</span>(ins, compute_budget.SetComputeUnitLimit(compute_budget.SetComputeUnitLimitParam&#123;<br>       Units: ComputerUnitLimit,<br>    &#125;))<br>    ins = <span class="hljs-built_in">append</span>(ins, token.TransferChecked(<br>       token.TransferCheckedParam&#123;<br>          From:     fromTokenATA,<br>          To:       toTokenATA,<br>          Mint:     common.PublicKeyFromString(tokenAddress),<br>          Auth:     alice.PublicKey,<br>          Signers:  []common.PublicKey&#123;alice.PublicKey&#125;,<br>          Amount:   <span class="hljs-number">40000000000</span>,<br>          Decimals: <span class="hljs-number">9</span>, <span class="hljs-comment">//ç²¾åº¦</span><br><br>       &#125;),<br>    )<br><br>    message := types.NewMessage(<br>       types.NewMessageParam&#123;<br>          FeePayer:        common.PublicKeyFromString(alice.PublicKey.String()),<br>          Instructions:    ins,<br>          RecentBlockhash: recentBlockhashResponse.Blockhash,<br>       &#125;)<br>    tx, err := types.NewTransaction(types.NewTransactionParam&#123;<br>       Message: message,<br>       Signers: []types.Account&#123;alice&#125;,<br>    &#125;)<br><br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>       log.Fatalf(<span class="hljs-string">&quot;failed to new transaction, err: %v&quot;</span>, err)<br>    &#125;<br>    <span class="hljs-comment">// 3ã€å¹¿æ’­ä¸Šé“¾</span><br>    txhash, err := c.SendTransaction(context.Background(), tx)<br>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>       log.Fatalf(<span class="hljs-string">&quot;failed to SendTransaction, err: %v&quot;</span>, err)<br>    &#125;<br>    fmt.Println(<span class="hljs-string">&quot;tx hash&quot;</span>, txhash)<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="å››-SOLé’±åŒ…å¼€å‘ä¸­çš„API"><a href="#å››-SOLé’±åŒ…å¼€å‘ä¸­çš„API" class="headerlink" title="å›› SOLé’±åŒ…å¼€å‘ä¸­çš„API"></a>å›› SOLé’±åŒ…å¼€å‘ä¸­çš„API</h1><h2 id="1-è·å–è´¦æˆ·ä¿¡æ¯"><a href="#1-è·å–è´¦æˆ·ä¿¡æ¯" class="headerlink" title="1.è·å–è´¦æˆ·ä¿¡æ¯"></a>1.è·å–è´¦æˆ·ä¿¡æ¯</h2><h2 id="2-è·å–-recentBlochHash-ç›´æ¥ç­¾åçš„è¯-recentBlochHash-ç›¸å½“äº-nonce"><a href="#2-è·å–-recentBlochHash-ç›´æ¥ç­¾åçš„è¯-recentBlochHash-ç›¸å½“äº-nonce" class="headerlink" title="2.è·å– recentBlochHash, ç›´æ¥ç­¾åçš„è¯ recentBlochHash ç›¸å½“äº nonce"></a>2.è·å– recentBlochHash, ç›´æ¥ç­¾åçš„è¯ recentBlochHash ç›¸å½“äº nonce</h2><h2 id="3-è·å–å‡†å¤‡-nonce-è´¦æˆ·çš„-Minimum-Balance-For-Rent-æ•°æ®"><a href="#3-è·å–å‡†å¤‡-nonce-è´¦æˆ·çš„-Minimum-Balance-For-Rent-æ•°æ®" class="headerlink" title="3. è·å–å‡†å¤‡ nonce è´¦æˆ·çš„ Minimum Balance For Rent æ•°æ®"></a>3. è·å–å‡†å¤‡ nonce è´¦æˆ·çš„ Minimum Balance For Rent æ•°æ®</h2><h2 id="4-è·å–æœ€æ–°å—é«˜-ï¼ˆSlotï¼‰"><a href="#4-è·å–æœ€æ–°å—é«˜-ï¼ˆSlotï¼‰" class="headerlink" title="4. è·å–æœ€æ–°å—é«˜ ï¼ˆSlotï¼‰"></a>4. è·å–æœ€æ–°å—é«˜ ï¼ˆSlotï¼‰</h2><h2 id="5-æ ¹æ®å—é«˜è·å–äº¤æ˜“"><a href="#5-æ ¹æ®å—é«˜è·å–äº¤æ˜“" class="headerlink" title="5. æ ¹æ®å—é«˜è·å–äº¤æ˜“"></a>5. æ ¹æ®å—é«˜è·å–äº¤æ˜“</h2><h2 id="6-æ ¹æ®äº¤æ˜“-Hash-è·å–äº¤æ˜“è¯¦æƒ…"><a href="#6-æ ¹æ®äº¤æ˜“-Hash-è·å–äº¤æ˜“è¯¦æƒ…" class="headerlink" title="6. æ ¹æ®äº¤æ˜“ Hash è·å–äº¤æ˜“è¯¦æƒ…"></a>6. æ ¹æ®äº¤æ˜“ Hash è·å–äº¤æ˜“è¯¦æƒ…</h2><h2 id="7-å‘é€äº¤æ˜“åˆ°åŒºå—é“¾ç½‘ç»œ"><a href="#7-å‘é€äº¤æ˜“åˆ°åŒºå—é“¾ç½‘ç»œ" class="headerlink" title="7.å‘é€äº¤æ˜“åˆ°åŒºå—é“¾ç½‘ç»œ"></a>7.å‘é€äº¤æ˜“åˆ°åŒºå—é“¾ç½‘ç»œ</h2><h1 id="äº”-ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘"><a href="#äº”-ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘" class="headerlink" title="äº” ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘"></a>äº” ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘</h1><h1 id="å…­ã€å»ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘-HDé’±åŒ…"><a href="#å…­ã€å»ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘-HDé’±åŒ…" class="headerlink" title="å…­ã€å»ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘ HDé’±åŒ…"></a>å…­ã€å»ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘ HDé’±åŒ…</h1><h1 id="ä¸ƒã€æ€»ç»“"><a href="#ä¸ƒã€æ€»ç»“" class="headerlink" title="ä¸ƒã€æ€»ç»“"></a>ä¸ƒã€æ€»ç»“</h1><h1 id="å…«ã€é™„ä»¶"><a href="#å…«ã€é™„ä»¶" class="headerlink" title="å…«ã€é™„ä»¶"></a>å…«ã€é™„ä»¶</h1><p>èµ„æ–™ï¼›</p><p>èŠ‚ç‚¹ï¼š<a href="https://dashboard.alchemy.com/">https://dashboard.alchemy.com/</a> ç¬¬ä¸‰æ–¹èŠ‚ç‚¹</p><p>æµè§ˆå™¨ï¼š<a href="https://solscan.io/">https://solscan.io/</a></p><p>ç¬¬ä¸‰æ–¹SDKï¼š<a href="https://github.com/blocto/solana-go-sdk">https://github.com/blocto/solana-go-sdk</a></p><p>æ–‡æ¡£ï¼š<a href="https://solana.com/zh/docs">https://solana.com/zh/docs</a></p><p>API&#x2F;Swager æ–‡æ¡£:<a href="https://solana.com/zh/docs/rpc">https://solana.com/zh/docs/rpc</a></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go"><br><br>solana1.jpg<br></code></pre></td></tr></table></figure><h1 id="é¢å¤–ç¬”è®°"><a href="#é¢å¤–ç¬”è®°" class="headerlink" title="é¢å¤–ç¬”è®°"></a>é¢å¤–ç¬”è®°</h1><h3 id="äº¤æ˜“"><a href="#äº¤æ˜“" class="headerlink" title="äº¤æ˜“"></a>äº¤æ˜“</h3><p>æˆ‘ä»¬å‘é€åˆ° Solana ç½‘ç»œä¸­çš„ä¸€ç¬”äº¤æ˜“åŒ…æ‹¬å››ä¸ªéƒ¨åˆ†ï¼š</p><ul><li>ä¸€ä¸ªæˆ–å¤šä¸ªæŒ‡ä»¤ ï¼ˆ<code>instructions</code>ï¼‰</li><li>ä¸€ä¸ªè¦è¯»å–æˆ–å†™å…¥çš„è´¦æˆ·æ•°ç»„ ï¼ˆ<code>account_keys</code>ï¼‰</li><li>ä¸€ä¸ªæˆ–å¤šä¸ªç­¾å ï¼ˆ<code>signatures</code>ï¼‰</li><li>æœ€è¿‘çš„åŒºå—å“ˆå¸Œ ï¼ˆ<code>recent_blockhash</code>ï¼‰</li></ul><p>ä¸€ä¸ª<a href="https://solana.com/docs/terminology#instruction">æŒ‡ä»¤</a>æ˜¯ Solana ä¸Šæœ€å°çš„æ‰§è¡Œé€»è¾‘ã€‚æŒ‡ä»¤æŒ‡å®šäº†æ‰§è¡Œç¨‹åºã€æ¶‰åŠçš„æ‰€æœ‰è´¦æˆ·å’Œæ“ä½œæ•°æ®ã€‚æŒ‡ä»¤è°ƒç”¨ç¨‹åºæ›´æ–°çŠ¶æ€ï¼ˆä¾‹å¦‚ï¼Œè°ƒç”¨ä»£å¸ç¨‹åºå°†ä»£å¸ä»ä½ çš„å¸æˆ·è½¬ç§»åˆ°å¦ä¸€ä¸ªå¸æˆ·ï¼‰ï¼Œç¨‹åºè§£é‡ŠæŒ‡ä»¤ä¸­çš„æ•°æ®ï¼Œå¹¶å¯¹æŒ‡å®šè´¦æˆ·è¿›è¡Œæ“ä½œ</p><blockquote><p>æŒ‡ä»¤â€”&gt;ç±»ä¼¼äºä»¥å¤ªåŠæ™ºèƒ½åˆçº¦ä¸Šçš„å‡½æ•°è°ƒç”¨</p></blockquote><h2 id="äº¤æ˜“è´¹â€”åŸºç¡€æ‰‹ç»­è´¹-å’Œ-ä¼˜å…ˆè´¹"><a href="#äº¤æ˜“è´¹â€”åŸºç¡€æ‰‹ç»­è´¹-å’Œ-ä¼˜å…ˆè´¹" class="headerlink" title="äº¤æ˜“è´¹â€”åŸºç¡€æ‰‹ç»­è´¹ å’Œ ä¼˜å…ˆè´¹"></a>äº¤æ˜“è´¹â€”åŸºç¡€æ‰‹ç»­è´¹ å’Œ ä¼˜å…ˆè´¹</h2><p>ï¼ˆ<code>lamports_per_signature</code>ï¼‰ï¼Œ<strong>åŸºç¡€æ‰‹ç»­è´¹</strong>ç›®å‰è®¾å®šä¸ºæ¯ä¸ªç­¾å 0.000005 SOLï¼ˆ5k lamportsï¼‰ï¼Œè¿™æ˜¯ä¸€æ¬¡æ€§çš„è´¹ç”¨ï¼Œä»¥ä¾¿è·å¾—ä½¿ç”¨ç½‘ç»œèµ„æºçš„æƒåˆ©ï¼Œæ— è®ºå®é™…ä½¿ç”¨å¤šå°‘èµ„æºæ¥æ‰§è¡Œäº¤æ˜“ï¼ˆæˆ–è€…äº¤æ˜“æ˜¯å¦æ‰§è¡Œï¼‰ï¼Œéƒ½éœ€è¦é¢„å…ˆæ”¯ä»˜ç»™ç½‘ç»œã€‚50% çš„è´¹ç”¨æ”¯ä»˜ç»™äº§ç”ŸåŒºå—çš„éªŒè¯èŠ‚ç‚¹ï¼Œå‰©ä½™çš„ 50% åˆ™è¢«é”€æ¯ã€‚</p><p>å¦‚æœæƒ³æé«˜å…¶äº¤æ˜“çš„ä¼˜å…ˆçº§ã€å¯é€‰çš„è´¹ç”¨ã€‘ï¼Œå®ƒå¯ä»¥è®¾ç½®ä¸€ä¸ª â€œè®¡ç®—å•å…ƒä»·æ ¼â€ã€‚ è¿™ä¸ªä»·æ ¼ä¸ <a href="https://solana.com/zh/docs/core/fees#compute-unit-limit">è®¡ç®—å•å…ƒé™åˆ¶</a> ç»“åˆä½¿ç”¨ï¼Œç”¨æ¥ç¡®å®šäº¤æ˜“çš„ä¼˜å…ˆçº§è´¹ç”¨ã€‚</p><p>é»˜è®¤çš„è®¡ç®—å•å…ƒé™åˆ¶ä¸º <a href="https://github.com/anza-xyz/agave/blob/b7bbe36918f23d98e2e73502e3c4cba78d395ba9/program-runtime/src/compute_budget_processor.rs#L18">æ¯ä¸ªæŒ‡ä»¤ 20 ä¸‡ CU</a>ï¼Œ å¦‚æœè®¡ç®—é‡æ¯”è¾ƒå¤§ï¼Œå¯ä»¥è®¾ç½®æœ€å¤§ä¸º 140 ä¸‡ Cuã€‚ Solana äº¤æ˜“ä¼šé¢„å…ˆè¯·æ±‚æŒ‡å®šæ•°é‡çš„è®¡ç®—å•å…ƒï¼ˆCUsï¼‰ï¼Œå¦‚æœè¶…å‡ºè¿™ä¸ªæ•°é‡ï¼Œäº¤æ˜“å°†å¤±è´¥ã€‚</p><p>å¦å¤–ï¼ŒSolana äº¤æ˜“è¿˜ä¼šæ”¶äº¤æ˜“åŒ…å¤§å°çš„é™åˆ¶ï¼ŒSolana ç½‘ç»œéµå¾ªæœ€å¤§ä¼ è¾“å•å…ƒ (MTU) å¤§å°ä¸º 1280 å­—èŠ‚ï¼Œè¿™ä¸ IPv6 MTU å¤§å°çº¦æŸä¸€è‡´ï¼Œä»¥ç¡®ä¿é€šè¿‡ UDP ä¼ è¾“é›†ç¾¤ä¿¡æ¯çš„å¿«é€Ÿå’Œå¯é æ€§ã€‚åœ¨è®¡ç®—å¿…è¦çš„æ ‡å¤´ï¼ˆIPv6 çš„ 40 å­—èŠ‚å’Œ 8 å­—èŠ‚çš„ç‰‡æ®µå¤´ï¼‰åï¼Œ1232 å­—èŠ‚ä»ç„¶å¯ç”¨äºæ•°æ®åŒ…ï¼Œ ç­¾åå’Œæ¶ˆæ¯çš„ç»„åˆä¸èƒ½è¶…è¿‡æ­¤é™åˆ¶ã€‚</p><blockquote><p> ä»¥ä¸‹å®˜æ–¹è§†é¢‘ä»‹ç»</p></blockquote><h1 id="Accounts"><a href="#Accounts" class="headerlink" title="Accounts"></a>Accounts</h1><p>sol Accounts æ¨¡å‹</p><p>Solana ä¸Šçš„å®—æ—¨æ˜¯ä¸€åˆ‡çš†ä¸ºå¸æˆ·ï¼Œç±»ä¼¼Linux çš„ä¸€åˆ‡çš†æ–‡ä»¶ä¸€æ ·ï¼Œ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">&#123;<br>  &quot;key&quot;:number,// è§†ä¸ºåŒºå—é“¾å…¬å…±åœ°å€<br>  &quot;lamports&quot;:number, // å®é™…æ€»ä½™é¢ æœ¬åœ°soltoken çš„æœ€å°å•ä½ï¼Œ1 lamports=0.0000000001sol<br>  &quot;data&quot;:Unit8Array,// æ— ç¬¦å·æ•´æ•°å­˜å‚¨çš„åŸå§‹å­—èŠ‚<br>  &quot;is_executable&quot;:boolean, // æ˜¯å¦ä¸ºç¨‹åºï¼Œå¦‚æœä¸ºtrue å°±æ˜¯å¯æ‰§è¡Œç¨‹åºï¼Œflaseå°±æ˜¯æ™®é€šæ•°æ®å¸æˆ·<br>  &quot;ower&quot;:Publickey // æ‰€æœ‰è€…ï¼Œåªæœ‰è¯¥å¸æˆ·çš„æ‰€æœ‰è€…æ‰å¯ä»¥æ›´æ–°è¯¥å¸æˆ·å†…æ•°æ®<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="Programs"><a href="#Programs" class="headerlink" title="Programs"></a>Programs</h1><p>Programs ç¨‹åºå°±æ˜¯solana ä¸Šçš„æ™ºèƒ½åˆçº¦Smart contracts on Solana</p><ul><li><p>ç¨‹åºæ˜¯æ— çŠ¶æ€çš„ï¼Œåªèƒ½è¯»å–å’Œå†™å…¥åˆ«äººçš„å¸æˆ·æ•°æ®</p></li><li><p>å¿…é¡»æ˜¯å¸æˆ·æ‰€æœ‰è€…æ‰èƒ½ä¿®æ”¹</p></li><li><p>ç¨‹åºè¿è¡ŒæŒ‡ä»¤</p></li><li><p>ç¨‹åºèƒ½å‘é€æŒ‡ä»¤ç»™å…¶ä»–ç¨‹åº</p></li></ul><p>æ€»ç»“</p><ul><li>ä¸€åˆ‡çš†ç¨‹åº</li><li>æ‰€æœ‰å¸æˆ·éƒ½æŒæœ‰SOL</li><li>å¸æˆ·èƒ½å­˜å‚¨ä»»æ„æ•°æ®</li><li>å¸æˆ·ä¹Ÿèƒ½å­˜å‚¨<strong>å¯æ‰§è¡Œç¨‹åº</strong></li><li>å¸æˆ·ä¹Ÿèƒ½åºŠåº•åˆ°ç¨‹åºä¸­å¹¶è¡Œæ‰§è¡Œ</li></ul><h1 id="Programs-Instructions"><a href="#Programs-Instructions" class="headerlink" title="Programs Instructions"></a>Programs Instructions</h1><p>ç¨‹åºæŒ‡ä»¤</p><p>åŸå§‹æ¨¡å‹ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs go">&#123;<br>  <span class="hljs-string">&quot;program_id&quot;</span>:number,<span class="hljs-comment">// æŒ‡å®šç¨‹åºçš„id,è¯¥æŒ‡ä»¤ç”¨äºçš„ç¨‹åº</span><br>  <span class="hljs-string">&quot;keys&quot;</span>:Array&lt;&#123; <span class="hljs-comment">// è®¾è®¡æŒ‡ä»¤çš„å¸æˆ·ï¼Œè¿™é‡Œç”¨äº†æ•°ç»„ï¼Œè¯´æ˜æ˜¯å¯ä»¥ä¼ é€’å¤šä¸ªçš„</span><br>    <span class="hljs-string">&quot;key&quot;</span>:Publcky,<br>    <span class="hljs-string">&quot;is_mutable&quot;</span>:boolean,<br>    <span class="hljs-string">&quot;is_signer&quot;</span>:boolean,<br>  &#125;&gt;,<br>  <span class="hljs-string">&quot;data&quot;</span>:Unit8Array <span class="hljs-comment">//ä½ æœ‰ä¸€å®šé‡çš„æ•°æ®é€šè¿‡åŸå§‹å­—èŠ‚çš„å½¢å¼å‘é€åˆ°ç½‘ç»œä¸­</span><br>&#125;<br><br><br><span class="hljs-comment">// ä¸‹é¢æ˜¯goä¸­çš„</span><br><span class="hljs-keyword">type</span> Instruction <span class="hljs-keyword">struct</span> &#123;<br>ProgramID common.PublicKey<br>Accounts  []AccountMeta<br>Data      []<span class="hljs-type">byte</span><br>&#125;<br><br><span class="hljs-keyword">type</span> AccountMeta <span class="hljs-keyword">struct</span> &#123;<br>PubKey     common.PublicKey<br>IsSigner   <span class="hljs-type">bool</span><br>IsWritable <span class="hljs-type">bool</span><br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="ç®€å•æŒ‡ä»¤"><a href="#ç®€å•æŒ‡ä»¤" class="headerlink" title="ç®€å•æŒ‡ä»¤"></a>ç®€å•æŒ‡ä»¤</h2><p>å¤šä¸ªæŒ‡ä»¤æ†ç»‘åœ¨ä¸€èµ·ï¼Œå°±å¯ä»¥ç»„æˆä¸€ä¸ªäº¤æ˜“</p><p>Transactions äº¤æ˜“</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go">message := types.NewMessage(<br>   types.NewMessageParam&#123;<br>      FeePayer:        common.PublicKeyFromString(alice.PublicKey.String()),<br>      Instructions:    ins,<br>      RecentBlockhash: recentBlockhashResponse.Blockhash,<br>   &#125;)<br>tx, err := types.NewTransaction(types.NewTransactionParam&#123;<br>   Message: message,<br>   Signers: []types.Account&#123;alice&#125;,<br>&#125;)<br></code></pre></td></tr></table></figure><p><strong>åˆ›å»ºå¸æˆ·çš„æŒ‡ä»¤</strong></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">CreateAccountSimpleTx</span><span class="hljs-params">()</span></span> &#123;<br>c := NewClient()<br>alice, err := types.AccountFromBase58(Piv)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Printf(<span class="hljs-string">&quot;err=%v&quot;</span>, err)<br>&#125;<br>fmt.Printf(<span class="hljs-string">&quot;alice=%v\n&quot;</span>, alice.PublicKey.String())<br><span class="hljs-comment">// æŸ¥è¯¢ä¸‹åœ°å€çš„å½“å‰ä½™é¢</span><br>balances, err := c.GetBalance(context.Background(), alice.PublicKey.String())<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Printf(<span class="hljs-string">&quot;get balances err = %v&quot;</span>, err)<br>&#125;<br>fmt.Printf(<span class="hljs-string">&quot;balances = %v\n&quot;</span>, balances)<br><span class="hljs-comment">// 2ã€ç»„è£…äº¤æ˜“</span><br><span class="hljs-comment">// 2.1 æ‹¿recentBlockhashResponse</span><br>recentBlockhashResponse, err := c.GetLatestBlockhash(context.Background())<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatalf(<span class="hljs-string">&quot;failed to get recent blockhash, err: %v&quot;</span>, err)<br>&#125;<br>fmt.Printf(<span class="hljs-string">&quot;recentBlockhashResponse = %v\n&quot;</span>, recentBlockhashResponse)<br><br><span class="hljs-comment">// æœ€å°è½¬è´¦é‡‘é¢</span><br>minimumBalanceForRentExemption, err := c.GetMinimumBalanceForRentExemption(context.Background(), <span class="hljs-number">0</span>)<br>fmt.Printf(<span class="hljs-string">&quot;minimumBalanceForRentExemption = %v\n&quot;</span>, minimumBalanceForRentExemption)<br><span class="hljs-comment">// 2.2 å®šä¹‰Instructionç„¶åå¡«å……å®ƒ</span><br>ins := <span class="hljs-built_in">make</span>([]types.Instruction, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>)<br><span class="hljs-comment">// äº¤æ˜“åˆ†æˆ2ä¸ªå¤§éƒ¨ä»½ Transactions å’Œ Instructions æŒ‡ä»¤ï¼ŒInstructionså¯ä»¥æœ‰å¤šä¸ª</span><br><span class="hljs-comment">// è¿½åŠ ä¼˜å…ˆè´¹</span><br>ComputerUnitPrice := <span class="hljs-type">uint64</span>(<span class="hljs-number">200000</span>) <span class="hljs-comment">//ä¸€ä¸ªè®¡ç®—å•å…ƒçš„ä»·æ ¼</span><br>ComputerUnitLimit := <span class="hljs-type">uint32</span>(<span class="hljs-number">200000</span>) <span class="hljs-comment">//è®¡ç®—å•å…ƒçš„é™åˆ¶</span><br>ins = <span class="hljs-built_in">append</span>(ins, compute_budget.SetComputeUnitPrice(compute_budget.SetComputeUnitPriceParam&#123;<br>MicroLamports: ComputerUnitPrice,<br>&#125;))<br><br>ins = <span class="hljs-built_in">append</span>(ins, compute_budget.SetComputeUnitLimit(compute_budget.SetComputeUnitLimitParam&#123;<br>Units: ComputerUnitLimit,<br>&#125;))<br><br><span class="hljs-comment">// DOINGS æˆ‘åœ¨åšçš„äº‹æƒ…æ˜¯åˆ›å»ºä¸€ä¸ªåœ°å€å¹¶ä¸ºå…¶åœ¨é“¾ä¸Šåˆ›å»ºä¸€ä¸ªè´¦å·,å‚è€ƒcreateAccountæ–¹æ³•</span><br><span class="hljs-comment">// ç”Ÿæˆä¸€ä¸ªé’±åŒ…ï¼Œå…ˆä¸ç®¡ä»–çš„åœ°å€</span><br>bob := types.NewAccount()<br>fmt.Printf(<span class="hljs-string">&quot;bob address=%s\n&quot;</span>, bob.PublicKey.String())<br><span class="hljs-comment">// æŒ‡ä»¤ä¸‰çº¬åº¦ï¼ŒProgramId ã€ Accountsã€Data</span><br>Accounts := []types.AccountMeta&#123;<br>&#123;PubKey: common.PublicKeyFromString(alice.PublicKey.String()), IsSigner: <span class="hljs-literal">true</span>, IsWritable: <span class="hljs-literal">true</span>&#125;,<br>&#123;PubKey: common.PublicKeyFromString(bob.PublicKey.String()), IsSigner: <span class="hljs-literal">true</span>, IsWritable: <span class="hljs-literal">true</span>&#125;,<br>&#125;<br>data, err := bincode.SerializeData(<span class="hljs-keyword">struct</span> &#123;<br>Instruction system.Instruction<br>Lamports    <span class="hljs-type">uint64</span><br>Space       <span class="hljs-type">uint64</span><br>Owner       common.PublicKey<br>&#125;&#123;<br>Instruction: system.InstructionCreateAccount,<br>Lamports:    minimumBalanceForRentExemption + <span class="hljs-number">1</span>,<br><span class="hljs-comment">//Space:       system.NonceAccountSize,</span><br>Space: <span class="hljs-number">0</span>,<br>Owner: common.SystemProgramID,<br>&#125;)<br>createAccountIns := types.Instruction&#123;<br>ProgramID: common.SystemProgramID,<br>Accounts:  Accounts,<br><span class="hljs-comment">//Data:      []byte&#123;0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 200, 0, 0, 0, 0, 0, 0, 0, 6, 161, 216, 23, 145, 55, 84, 42, 152, 52, 55, 189, 254, 42, 122, 178, 85, 127, 83, 92, 138, 120, 114, 43, 104, 164, 157, 192, 0, 0, 0, 0&#125;,</span><br>Data: data,<br>&#125;<br>ins = <span class="hljs-built_in">append</span>(ins, createAccountIns)<br><span class="hljs-comment">// æ¶ˆæ¯åŒ…å«æŒ‡ä»¤ã€åŒºå—å“ˆå¸Œã€feeæ”¯ä»˜è€…</span><br>message := types.NewMessage(<br>types.NewMessageParam&#123;<br>FeePayer: alice.PublicKey,<br>Instructions:    ins,<br>RecentBlockhash: recentBlockhashResponse.Blockhash,<br>&#125;)<br><span class="hljs-comment">// äº¤æ˜“åŒ…å«ç­¾åå’Œæ¶ˆæ¯</span><br>tx, err := types.NewTransaction(types.NewTransactionParam&#123;<br>Message: message,<br>Signers: []types.Account&#123;alice, bob&#125;,<br>&#125;)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatalf(<span class="hljs-string">&quot;failed to new transaction, err: %v&quot;</span>, err)<br>&#125;<br><span class="hljs-comment">// 3ã€å¹¿æ’­ä¸Šé“¾</span><br>txhash, err := c.SendTransaction(context.Background(), tx)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatalf(<span class="hljs-string">&quot;failed to SendTransaction, err: %v&quot;</span>, err)<br>&#125;<br>fmt.Println(<span class="hljs-string">&quot;tx hash&quot;</span>, txhash)<br>&#125;<br><br><span class="hljs-comment">// ä¸‹é¢æ˜¯ä½¿ç”¨sdkè‡ªå¸¦çš„æ–¹æ³•</span><br>bob := types.NewAccount()<br>fmt.Printf(<span class="hljs-string">&quot;bob address=%s\n&quot;</span>, bob.PublicKey.String())<br><br>createAccountIns2 := system.CreateAccount(system.CreateAccountParam&#123;<br>From:     alice.PublicKey,<br>New:      bob.PublicKey,<br>Owner:    common.SystemProgramID, <span class="hljs-comment">// ä½ è¦ä¸ºä»–åˆ›å»ºå“ªä¸ªå¸æˆ·å°±ç”¨å“ªä¸ªowner</span><br>Lamports: minimumBalanceForRentExemption + <span class="hljs-number">1</span>, <span class="hljs-comment">// æœ€ä½ç§Ÿé‡‘+1</span><br>Space:    <span class="hljs-number">0</span>,<br>&#125;)<br>ins = <span class="hljs-built_in">append</span>(ins, createAccountIns2)<br></code></pre></td></tr></table></figure><p>æ€»ç»“</p><ul><li>ç¨‹åºè°ƒç”¨æŒ‡ä»¤</li><li>æŒ‡ä»¤é€šè¿‡äº¤æ˜“å‘é€å¹¿æ’­å‡ºå»</li><li>äº¤æ˜“éœ€è¦æ˜¯åŸå­çš„</li><li>æ‰€æœ‰äº¤æ˜“éƒ½å¿…é¡»ç­¾å</li></ul><p>Solana äº¤æ˜“çš„ç”Ÿå‘½å‘¨æœŸâ€”-&gt;ä¸å•å•æ˜¯solana å¾ˆå¤šé¢˜ç›®éƒ½ä¼šå‡ºç°</p><ul><li>æŒ‡ä»¤åŒ…å«ä»€ä¹ˆï¼šç¨‹åºidã€ å¸æˆ·keyæ•°ç»„ ã€data</li><li>äº¤æ˜“åŒ…å«ä»€ä¹ˆï¼šæŒ‡ä»¤ã€RecentBlockhashã€ç­¾åæ¶ˆæ¯ã€feeæ”¯ä»˜è€…</li><li>å»ä¸­å¿ƒåŒ–åº”ç”¨DAPP å®¢æˆ·ç«¯ ç»„è£…äº¤æ˜“ï¼ˆæŒ‡ä»¤ï¼‰ï¼Œ</li><li>äº¤æ˜“è¢«å‘é€åˆ°RPC å®¢æˆ·ç«¯ </li><li>RPCå®¢æˆ·ç«¯æŠŠæ‰€æœ‰äº¤æ˜“è½¬å‘ç»™æŠ•ç¥¨éªŒè¯è€…</li><li>éªŒè¯è€…å°†å®é™…ä½¿ç”¨solanaè¿è¡Œæ—¶æ¥å¯ç”¨ï¼Œè¿è¡Œæ—¶å®é™…æ‰§è¡Œæ¯ä¸ªäº¤æ˜“å†…çš„æ¯ä¸ªæŒ‡ä»¤</li><li>æ¯ä¸ªæŒ‡ä»¤å°†è°ƒç”¨ä¸€ä¸ªç‰¹å®šç¨‹åºæ¥å®é™…æ‰§è¡Œè¯¥ç¨‹åºä»£ç è¯•å›¾åšçš„äº‹æƒ…ï¼Œè¿™ä¸ªç¨‹åºåªæ˜¯å¢åŠ ä¸€ä¸ªè®¡æ•°å™¨å¹¶é€’å¢1</li></ul><h2 id="å¤æ‚æŒ‡ä»¤"><a href="#å¤æ‚æŒ‡ä»¤" class="headerlink" title="å¤æ‚æŒ‡ä»¤"></a>å¤æ‚æŒ‡ä»¤</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">CreateComplexTx</span><span class="hljs-params">()</span></span> &#123;<br><br>c := NewClient()<br>alice, err := types.AccountFromBase58(Piv)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Printf(<span class="hljs-string">&quot;err=%v&quot;</span>, err)<br>&#125;<br>fmt.Printf(<span class="hljs-string">&quot;alice=%v\n&quot;</span>, alice.PublicKey.String())<br><span class="hljs-comment">// æŸ¥è¯¢ä¸‹åœ°å€çš„å½“å‰ä½™é¢</span><br>balances, err := c.GetBalance(context.Background(), alice.PublicKey.String())<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Printf(<span class="hljs-string">&quot;get balances err = %v&quot;</span>, err)<br>&#125;<br>fmt.Printf(<span class="hljs-string">&quot;balances = %v\n&quot;</span>, balances)<br><span class="hljs-comment">// 2ã€ç»„è£…äº¤æ˜“</span><br><span class="hljs-comment">// 2.1 æ‹¿recentBlockhashResponse</span><br>recentBlockhashResponse, err := c.GetLatestBlockhash(context.Background())<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatalf(<span class="hljs-string">&quot;failed to get recent blockhash, err: %v&quot;</span>, err)<br>&#125;<br><br><span class="hljs-comment">// æœ€å°è½¬è´¦é‡‘é¢</span><br>minimumBalanceForRentExemption, err := c.GetMinimumBalanceForRentExemption(context.Background(), <span class="hljs-number">0</span>)<br>fmt.Printf(<span class="hljs-string">&quot;minimumBalanceForRentExemption = %v\n&quot;</span>, minimumBalanceForRentExemption)<br><span class="hljs-comment">// 2.2 å®šä¹‰Instructionç„¶åå¡«å……å®ƒ</span><br>ins := <span class="hljs-built_in">make</span>([]types.Instruction, <span class="hljs-number">0</span>, <span class="hljs-number">4</span>)<br><span class="hljs-comment">// äº¤æ˜“åˆ†æˆ2ä¸ªå¤§éƒ¨ä»½ Transactions å’Œ Instructions æŒ‡ä»¤ï¼ŒInstructionså¯ä»¥æœ‰å¤šä¸ª</span><br><span class="hljs-comment">// è¿½åŠ ä¼˜å…ˆè´¹</span><br>ComputerUnitPrice := <span class="hljs-type">uint64</span>(<span class="hljs-number">2000000</span>) <span class="hljs-comment">//ä¸€ä¸ªè®¡ç®—å•å…ƒçš„ä»·æ ¼</span><br>ComputerUnitLimit := <span class="hljs-type">uint32</span>(<span class="hljs-number">2000000</span>) <span class="hljs-comment">//è®¡ç®—å•å…ƒçš„é™åˆ¶</span><br>ins = <span class="hljs-built_in">append</span>(ins, compute_budget.SetComputeUnitPrice(compute_budget.SetComputeUnitPriceParam&#123;<br>MicroLamports: ComputerUnitPrice,<br>&#125;))<br><br>ins = <span class="hljs-built_in">append</span>(ins, compute_budget.SetComputeUnitLimit(compute_budget.SetComputeUnitLimitParam&#123;<br>Units: ComputerUnitLimit,<br>&#125;))<br><br><span class="hljs-comment">// DOINGS æˆ‘åœ¨åšçš„äº‹æƒ…æ˜¯åˆ›å»ºä¸€ä¸ªåœ°å€å¹¶ä¸ºå…¶åœ¨é“¾ä¸Šåˆ›å»ºä¸€ä¸ªè´¦å·,å‚è€ƒcreateAccountæ–¹æ³•</span><br><span class="hljs-comment">// åˆ›å»ºæµ‹è¯•å¸æˆ·æŒ‡ä»¤ï¼Œç”Ÿæˆä¸€ä¸ªé’±åŒ…ï¼Œå…ˆä¸ç®¡ä»–çš„åœ°å€</span><br>bob := types.NewAccount()<br>fmt.Printf(<span class="hljs-string">&quot;bob address=%s\n&quot;</span>, bob.PublicKey.String())<br>createAccountIns2 := system.CreateAccount(system.CreateAccountParam&#123;<br>From:     alice.PublicKey,<br>New:      bob.PublicKey,<br>Owner:    common.SystemProgramID,<br>Lamports: minimumBalanceForRentExemption + <span class="hljs-number">1</span>,<br>Space:    <span class="hljs-number">0</span>,<br>&#125;)<br>ins = <span class="hljs-built_in">append</span>(ins, createAccountIns2)<br><span class="hljs-comment">// ç¬¬äºŒä¸ªæŒ‡ä»¤ï¼Œç»™é™æ€åœ°å€è½¬è´¦</span><br>Cindy := common.PublicKeyFromString(<span class="hljs-string">&quot;2e7MJy7rh3mr7myjEtyD6Bjyyc9fYcYVwwhGhgVDbx5U&quot;</span>) <span class="hljs-comment">// éšä¾¿ä¸€ä¸ªé™æ€åœ°å€</span><br>ins = <span class="hljs-built_in">append</span>(ins, system.Transfer(system.TransferParam&#123;<br>From:   alice.PublicKey,<br>To:     Cindy,<br>Amount: <span class="hljs-number">100000000</span>,<br>&#125;))<br><span class="hljs-comment">// ç¬¬ä¸‰ä¸ªæŒ‡ä»¤ï¼Œç»™æµ‹è¯•å¸æˆ·è½¬è´¦</span><br>ins = <span class="hljs-built_in">append</span>(ins, system.Transfer(system.TransferParam&#123;<br>From:   alice.PublicKey,<br>To:     bob.PublicKey,<br>Amount: <span class="hljs-number">200000000</span>,<br>&#125;))<br><span class="hljs-comment">// ç¬¬å››ä¸ªæŒ‡ä»¤ï¼Œç»™é™æ€åœ°å€è½¬è´¦</span><br>ins = <span class="hljs-built_in">append</span>(ins, system.Transfer(system.TransferParam&#123;<br>From:   alice.PublicKey,<br>To:     Cindy,<br>Amount: <span class="hljs-number">300000000</span>,<br>&#125;))<br><span class="hljs-comment">// æ¶ˆæ¯åŒ…å«æŒ‡ä»¤ã€åŒºå—å“ˆå¸Œã€feeæ”¯ä»˜è€…</span><br>message := types.NewMessage(<br>types.NewMessageParam&#123;<br>FeePayer: alice.PublicKey,<br>Instructions:    ins,<br>RecentBlockhash: recentBlockhashResponse.Blockhash,<br>&#125;)<br><span class="hljs-comment">// äº¤æ˜“åŒ…å«ç­¾åå’Œæ¶ˆæ¯</span><br>tx, err := types.NewTransaction(types.NewTransactionParam&#123;<br>Message: message,<br>Signers: []types.Account&#123;alice, bob&#125;,<br>&#125;)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatalf(<span class="hljs-string">&quot;failed to new transaction, err: %v&quot;</span>, err)<br>&#125;<br><span class="hljs-comment">// 3ã€å¹¿æ’­ä¸Šé“¾</span><br>txhash, err := c.SendTransaction(context.Background(), tx)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatalf(<span class="hljs-string">&quot;failed to SendTransaction, err: %v&quot;</span>, err)<br>&#125;<br>fmt.Println(<span class="hljs-string">&quot;tx hash&quot;</span>, txhash)<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="TOKEN-æŒ‡ä»¤â€“-åˆ›å»ºTokenå’Œå…ƒæ•°æ®"><a href="#TOKEN-æŒ‡ä»¤â€“-åˆ›å»ºTokenå’Œå…ƒæ•°æ®" class="headerlink" title="TOKEN æŒ‡ä»¤â€“&gt;åˆ›å»ºTokenå’Œå…ƒæ•°æ®"></a>TOKEN æŒ‡ä»¤â€“&gt;åˆ›å»ºTokenå’Œå…ƒæ•°æ®</h2><p>createTokenWithMetadata</p><p>åˆ†æˆ4ä¸ªæ­¥éª¤</p><ol><li>Create a new account åˆ›å»ºä¸€ä¸ªæ–°å¸æˆ·ï¼Œ</li><li>Initialize that account as a mint  åˆå§‹åŒ–è¿™ä¸ªå¸æˆ·ä¸ºé“¸é€ æ–¹</li><li>Create an associated token account  åˆ›å»ºå…³è”ä»£å¸å¸æˆ· ATA</li><li>Mint new tokens to that associated token account å°†æ–°ä»£å¸é“¸é€ åˆ°å…³è”çš„ä»£å¸è´¦æˆ·</li></ol><p>æˆ‘ä»¬å…ˆå®Œæˆå‰é¢3ä¸ªæ­¥éª¤æ¥åˆ›å»ºtokenå’Œå…ƒæ•°æ®ï¼Œ3ä¸ªæŒ‡ä»¤</p><p>createMintAccountInstruction,</p><p> initializeMintInstruction,</p><p>createMetadataInstruction,</p><p>è§ä»£ç   </p><p>ç¬¬å››æ­¥å°±æ˜¯mint to é“¸é€ ä¸€å®šæ•°é‡çš„tokenå‘é€ç»™æŸä¸ªæ¥æ”¶è€…åœ°å€</p><p>è§ä»£ç </p><h2 id="æ›´æ”¹ä»£å¸å…ƒæ•°æ®"><a href="#æ›´æ”¹ä»£å¸å…ƒæ•°æ®" class="headerlink" title="æ›´æ”¹ä»£å¸å…ƒæ•°æ®"></a>æ›´æ”¹ä»£å¸å…ƒæ•°æ®</h2><p>è§ä»£ç </p><p>æ€»ç»“é“¸é€ æµç¨‹ï¼š</p><ol><li>åˆ›å»ºä¸€ä¸ªå¸æˆ·,<code>system.CreateAccount()æ–¹æ³•</code></li><li>ä¸ºå¸æˆ·åˆå§‹åŒ–ä¸ºä¸€ä¸ªé“¸å¸å¸æˆ·Mint <code>token.InitializeMint()æ–¹æ³•</code></li><li>ä¸ºè¯¥å¸æˆ·åˆå§‹åç§°å¹¶åˆ›å»ºå…ƒæ•°æ®å¸æˆ·åœ°å€(PDAæ´¾ç”Ÿé‚£ä¸€æ­¥),<code>common.FindProgramAddress()åŠ ä¸Štoken_metadata.CreateMetadataAccountV3()æ–¹æ³•</code></li><li>create an associated token account for the userâ€™s walletä¸ºç”¨æˆ·çš„é’±åŒ…åˆ›å»ºå…³è”çš„ä»£å¸è´¦æˆ· Â·<code>associated_token_account.Create()æ–¹æ³•</code></li><li>mint a token to the userâ€™s associated token accountå‘ç”¨æˆ·å…³è”çš„ä»£å¸è´¦æˆ·é“¸é€ ä»£å¸ <code>token.MintTo()æ–¹æ³•</code></li></ol><h1 id="NFT"><a href="#NFT" class="headerlink" title="NFT"></a>NFT</h1><p>NFTå°±æ˜¯ä¸€ä¸ªsplat Token æ˜¯ä¸€ä¸ªå…·æœ‰ç‹¬ç‰¹å±æ€§çš„éåŒè´¨åŒ–ä»£å¸</p><p>ç‰¹æ€§</p><ol><li>Are SPL Tokens æ˜¯token</li><li>å°æ•°ç²¾åº¦ä¸º0</li><li>æ€»ä¾›åº”é‡ä¸º1</li><li>é«˜åº¦å¯å®šåˆ¶çš„å…ƒæ•°æ®å¦‚å›¾åƒç­‰å„ç§å±æ€§</li></ol><p>è¿˜æœ‰ä¸¤ä¸ªæ¦‚å¿µï¼Œä¸»æ¿å’Œé›†åˆ</p><h1 id="è°ƒç”¨åˆçº¦"><a href="#è°ƒç”¨åˆçº¦" class="headerlink" title="è°ƒç”¨åˆçº¦"></a>è°ƒç”¨åˆçº¦</h1><p>å‚è€ƒäº¤æ˜“<a href="https://solscan.io/tx/4kEqM9WYQnud3G2UjiNgRktQKGkRu3B4PSuLepSrqYubU3Ha5J88PGmWNnt85MKwDuCyrc2q5odU8nWRNnUFVtNw?cluster=devnet">https://solscan.io/tx/4kEqM9WYQnud3G2UjiNgRktQKGkRu3B4PSuLepSrqYubU3Ha5J88PGmWNnt85MKwDuCyrc2q5odU8nWRNnUFVtNw?cluster=devnet</a></p><p>åˆ›å»ºæ± å­çš„äº¤æ˜“:</p><p><a href="https://solscan.io/tx/4kEqM9WYQnud3G2UjiNgRktQKGkRu3B4PSuLepSrqYubU3Ha5J88PGmWNnt85MKwDuCyrc2q5odU8nWRNnUFVtNw?cluster=devnet">https://solscan.io/tx/4kEqM9WYQnud3G2UjiNgRktQKGkRu3B4PSuLepSrqYubU3Ha5J88PGmWNnt85MKwDuCyrc2q5odU8nWRNnUFVtNw?cluster=devnet</a></p><p>3aPmA4hTkMQMFfF5cpktFSK6rniJHoL2DdmqVi1q3SoLTNXzisK4FiW6XJcD1tftygq9n1vMyjBLBrP6gymWapeK</p><ul><li>å¾—åˆ°çš„ä»£å¸å¯å®¹å¿çš„æ•°é‡å·®ï¼Œè¶…å‡ºå®¹å¿åº¦ï¼Œè¶…å‡º</li><li></li></ul><p>AMM</p><p>CLMM</p><p>CPMM </p>]]></content>
    
    
    <categories>
      
      <category>blockChain</category>
      
    </categories>
    
    
    <tags>
      
      <tag>block</tag>
      
      <tag>æ¦‚å¿µ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>07-4TONé’±åŒ…å¼€å‘æµç¨‹</title>
    <link href="/2024/11/19/07-4TON%E9%92%B1%E5%8C%85%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/"/>
    <url>/2024/11/19/07-4TON%E9%92%B1%E5%8C%85%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€-TONç®€ä»‹"><a href="#ä¸€-TONç®€ä»‹" class="headerlink" title="ä¸€ TONç®€ä»‹"></a>ä¸€ TONç®€ä»‹</h1><h1 id="äºŒ-ç¦»çº¿åœ°å€ç”Ÿæˆ"><a href="#äºŒ-ç¦»çº¿åœ°å€ç”Ÿæˆ" class="headerlink" title="äºŒ ç¦»çº¿åœ°å€ç”Ÿæˆ"></a>äºŒ ç¦»çº¿åœ°å€ç”Ÿæˆ</h1><h1 id="ä¸‰-ç¦»çº¿ç­¾å"><a href="#ä¸‰-ç¦»çº¿ç­¾å" class="headerlink" title="ä¸‰ ç¦»çº¿ç­¾å"></a>ä¸‰ ç¦»çº¿ç­¾å</h1><h1 id="å››-TONé’±åŒ…å¼€å‘ä¸­çš„API"><a href="#å››-TONé’±åŒ…å¼€å‘ä¸­çš„API" class="headerlink" title="å›› TONé’±åŒ…å¼€å‘ä¸­çš„API"></a>å›› TONé’±åŒ…å¼€å‘ä¸­çš„API</h1><h1 id="äº”-ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘"><a href="#äº”-ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘" class="headerlink" title="äº” ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘"></a>äº” ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘</h1><h1 id="å…­ã€å»ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘-HDé’±åŒ…"><a href="#å…­ã€å»ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘-HDé’±åŒ…" class="headerlink" title="å…­ã€å»ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘ HDé’±åŒ…"></a>å…­ã€å»ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘ HDé’±åŒ…</h1><h1 id="ä¸ƒã€æ€»ç»“"><a href="#ä¸ƒã€æ€»ç»“" class="headerlink" title="ä¸ƒã€æ€»ç»“"></a>ä¸ƒã€æ€»ç»“</h1><h1 id="å…«ã€é™„ä»¶"><a href="#å…«ã€é™„ä»¶" class="headerlink" title="å…«ã€é™„ä»¶"></a>å…«ã€é™„ä»¶</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>blockChain</category>
      
    </categories>
    
    
    <tags>
      
      <tag>block</tag>
      
      <tag>æ¦‚å¿µ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä¸å†™ä»£ç ä¸ç”¨å›½å¤–æ‰‹æœºå·ä¸€é”®éƒ¨ç½²è‡ªå·±çš„ChatGPT</title>
    <link href="/2024/08/11/PrivateGPT/"/>
    <url>/2024/08/11/PrivateGPT/</url>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p><strong>ä¸å†™ä¸€è¡Œä»£ç ä¸ç”¨å›½å¤–æ‰‹æœºå·å›½å¤–é“¶è¡Œå¡ä¸€é”®éƒ¨ç½²ä½ è‡ªå·±çš„ChatGPT</strong></p><blockquote><p>Gpt-4,Gpt-4o,Gpt-4-Turbo,Gpt-4o-mini,Gemma,Claude,Llama,Qwenéƒ½å¯ç”¨</p></blockquote><h2 id="ä»€ä¹ˆæ˜¯gptï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯gptï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯gptï¼Ÿ"></a>ä»€ä¹ˆæ˜¯gptï¼Ÿ</h2><p>å‡ºé—¨å³æ‹</p><h2 id="æˆ‘éœ€è¦å‡†å¤‡ä»€ä¹ˆï¼Ÿ"><a href="#æˆ‘éœ€è¦å‡†å¤‡ä»€ä¹ˆï¼Ÿ" class="headerlink" title="æˆ‘éœ€è¦å‡†å¤‡ä»€ä¹ˆï¼Ÿ"></a>æˆ‘éœ€è¦å‡†å¤‡ä»€ä¹ˆï¼Ÿ</h2><ul><li>è´¦å·ï¼š<ul><li>ä¸€ä¸ªé‚®ç®±ï¼ˆå¿…å¤‡ï¼Œæœ€å¥½googleï¼‰</li><li>GitHub è´¦å·ï¼ˆå¯é€‰ï¼‰</li></ul></li><li>æ”¯ä»˜æ–¹å¼ï¼š<ul><li>æ”¯ä»˜å®</li><li>å›½å†…é“¶è¡Œå¡</li><li>ETHæ”¯ä»˜</li><li>Visaä¿¡ç”¨å¡æ”¯ä»˜ï¼ˆå¯é€‰ï¼‰</li><li>å…¶ä»–æ”¯ä»˜ã€‚ã€‚ã€‚ã€‚</li></ul></li></ul><h1 id="æµç¨‹å›¾"><a href="#æµç¨‹å›¾" class="headerlink" title="æµç¨‹å›¾"></a>æµç¨‹å›¾</h1><p><img src="/img/pic/MyChat.jpg" alt="æµç¨‹å›¾"></p><h1 id="ç”¨ä»€ä¹ˆæ”¯ä»˜ï¼Ÿ"><a href="#ç”¨ä»€ä¹ˆæ”¯ä»˜ï¼Ÿ" class="headerlink" title="ç”¨ä»€ä¹ˆæ”¯ä»˜ï¼Ÿ"></a>ç”¨ä»€ä¹ˆæ”¯ä»˜ï¼Ÿ</h1><p>æ¨èå›½å†…é“¶è¡Œå¡ã€æ”¯ä»˜å®ã€Base_ETHï¼›</p><h1 id="æ”¯ä»˜ç»™è°ï¼Ÿ"><a href="#æ”¯ä»˜ç»™è°ï¼Ÿ" class="headerlink" title="æ”¯ä»˜ç»™è°ï¼Ÿ"></a>æ”¯ä»˜ç»™è°ï¼Ÿ</h1><p><a href="https://openrouter.ai/">https://openrouter.ai/</a>  æ˜¯ä¸€å®¶å…¨çƒæœ€å¤§çš„æ‰¿åŒ…æœåŠ¡å•†ï¼Œå¯ä»¥æä¾›ChatGPTã€Geminiã€Claude ç­‰å¯¹è¯æœåŠ¡å’ŒAPI Key</p><h2 id="ç™»å½•"><a href="#ç™»å½•" class="headerlink" title="ç™»å½•"></a>ç™»å½•</h2><p><img src="/img/pic/login.jpg" alt="ç™»å½•"></p><h2 id="è¿›å…¥é¦–é¡µ"><a href="#è¿›å…¥é¦–é¡µ" class="headerlink" title="è¿›å…¥é¦–é¡µ"></a>è¿›å…¥é¦–é¡µ</h2><p><img src="/img/pic/home.jpg" alt="é¦–é¡µ"></p><h2 id="å……é’±å‘€"><a href="#å……é’±å‘€" class="headerlink" title="å……é’±å‘€"></a>å……é’±å‘€</h2><h3 id="æ™®é€šå……å€¼-éœ€VISAå¡-éœ€è¦-5-æ‰‹ç»­è´¹"><a href="#æ™®é€šå……å€¼-éœ€VISAå¡-éœ€è¦-5-æ‰‹ç»­è´¹" class="headerlink" title="æ™®é€šå……å€¼(éœ€VISAå¡,éœ€è¦+5%æ‰‹ç»­è´¹)"></a>æ™®é€šå……å€¼(éœ€VISAå¡,éœ€è¦+5%æ‰‹ç»­è´¹)</h3><p><img src="/img/pic/deposit.jpg" alt="æ™®é€šå……å€¼"></p><h3 id="ä¹Ÿæ”¯æŒæ”¯æŒå›½å†…é“¶è¡Œå¡æ”¯ä»˜ï¼Œä¹Ÿæ”¯æŒæ”¯ä»˜å®æ”¯ä»˜ï¼Œä¹Ÿæœ‰æ‰‹ç»­è´¹çš„"><a href="#ä¹Ÿæ”¯æŒæ”¯æŒå›½å†…é“¶è¡Œå¡æ”¯ä»˜ï¼Œä¹Ÿæ”¯æŒæ”¯ä»˜å®æ”¯ä»˜ï¼Œä¹Ÿæœ‰æ‰‹ç»­è´¹çš„" class="headerlink" title="ä¹Ÿæ”¯æŒæ”¯æŒå›½å†…é“¶è¡Œå¡æ”¯ä»˜ï¼Œä¹Ÿæ”¯æŒæ”¯ä»˜å®æ”¯ä»˜ï¼Œä¹Ÿæœ‰æ‰‹ç»­è´¹çš„"></a>ä¹Ÿæ”¯æŒæ”¯æŒå›½å†…é“¶è¡Œå¡æ”¯ä»˜ï¼Œä¹Ÿæ”¯æŒæ”¯ä»˜å®æ”¯ä»˜ï¼Œä¹Ÿæœ‰æ‰‹ç»­è´¹çš„</h3><p><img src="/img/pic/alipay.jpg" alt="æ™®é€šå……å€¼"></p><h3 id="ä½¿ç”¨ETHå……å€¼-é¦–æ¨ï¼ŒåŒæ ·éœ€è¦-5-æ‰‹ç»­è´¹"><a href="#ä½¿ç”¨ETHå……å€¼-é¦–æ¨ï¼ŒåŒæ ·éœ€è¦-5-æ‰‹ç»­è´¹" class="headerlink" title="ä½¿ç”¨ETHå……å€¼(é¦–æ¨ï¼ŒåŒæ ·éœ€è¦+5%æ‰‹ç»­è´¹)"></a>ä½¿ç”¨ETHå……å€¼(é¦–æ¨ï¼ŒåŒæ ·éœ€è¦+5%æ‰‹ç»­è´¹)</h3><p><img src="/img/pic/crypto2.jpg" alt="ethå……å€¼"></p><h3 id="åˆ›å»ºApi-Key-ä¸”ä¿å­˜"><a href="#åˆ›å»ºApi-Key-ä¸”ä¿å­˜" class="headerlink" title="åˆ›å»ºApi Key ä¸”ä¿å­˜"></a>åˆ›å»ºApi Key ä¸”ä¿å­˜</h3><p><img src="/img/pic/createkey.jpg" alt="åˆ›å»ºkey"></p><p>è¿™ä¸ªå¹³å°ä¸Šé¢å¯ä»¥ç›´æ¥ä½¿ç”¨Chatgpt4 ä½†æ˜¯è´µï¼ŒAPIä¾¿å®œå¥½å¤š</p><h1 id="æ‹¿åˆ°API-Keyæ€ä¹ˆåŠï¼Ÿ"><a href="#æ‹¿åˆ°API-Keyæ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="æ‹¿åˆ°API Keyæ€ä¹ˆåŠï¼Ÿ"></a>æ‹¿åˆ°API Keyæ€ä¹ˆåŠï¼Ÿ</h1><p><a href="https://github.com/ChatGPTNextWeb/ChatGPT-Next-Web">https://github.com/ChatGPTNextWeb/ChatGPT-Next-Web</a> ä¸€ä¸ªçŸ¥åå¼€æºå‰ç«¯æœåŠ¡ï¼Œæ ¹æ®æ•™ç¨‹éƒ¨ç½²å³å¯</p><h2 id="vercelä¸€é”®éƒ¨ç½²"><a href="#vercelä¸€é”®éƒ¨ç½²" class="headerlink" title="vercelä¸€é”®éƒ¨ç½²"></a>vercelä¸€é”®éƒ¨ç½²</h2><blockquote><p>Vercel æ˜¯ä¸€ä¸ªäº‘æœåŠ¡å¹³å°ï¼Œæ”¯æŒé™æ€ç½‘ç«™å’ŒåŠ¨æ€ç½‘ç«™çš„åº”ç”¨éƒ¨ç½²ã€é¢„è§ˆå’Œä¸Šçº¿ã€‚å¦‚æœä½ ç”¨è¿‡ GitHub Pages ï¼Œé‚£ä¹ˆå¿ƒé‡Œå¯èƒ½ä¸ä¼šå¤ªé™Œç”Ÿï¼Œä½†ä½ ä¹Ÿèƒ½é€šè¿‡ vercel é›†æˆ GitHub åï¼Œåœ¨ GitHub é¡¹ç›®è¿›è¡Œä»£ç æ¨é€ï¼ŒPRåˆå¹¶è‡ªåŠ¨éƒ¨ç½²çš„ç›®çš„ï¼Œä¸”ä½ ä¸éœ€è¦è€ƒè™‘æœåŠ¡å™¨é—®é¢˜ã€‚</p></blockquote><p>ä¸‰ä¸ªå‚æ•°å¿…é¡»é…ç½®ï¼š</p><ul><li>OPENAI_API_KEY&#x3D;ä½ çš„apikey</li><li>CODE&#x3D;your-passwordå¯†ç å¿…é¡»è¦,å¦åˆ™å®¹æ˜“æ¶ˆè€—token</li><li>BASE_URL&#x3D;<a href="https://openrouter.ai/api">https://openrouter.ai/api</a></li></ul><p>Vercelä¼šç»™ä½ è‡ªåŠ¨åˆ†é…åŸŸå</p><p><img src="/img/pic/createweb1.jpg" alt="åˆ›å»ºweb"></p><p><img src="/img/pic/createweb.jpg" alt="åˆ›å»ºweb2"></p><h3 id="dockeræœ¬åœ°éƒ¨ç½²ï¼ˆç§æœ‰ï¼‰"><a href="#dockeræœ¬åœ°éƒ¨ç½²ï¼ˆç§æœ‰ï¼‰" class="headerlink" title="dockeræœ¬åœ°éƒ¨ç½²ï¼ˆç§æœ‰ï¼‰"></a>dockeræœ¬åœ°éƒ¨ç½²ï¼ˆç§æœ‰ï¼‰</h3><figure class="highlight docker"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs docker">docker pull yidadaa/chatgpt-next-web<br><br>docker <span class="hljs-keyword">run</span><span class="language-bash"> -d -p 3000:3000 \</span><br><span class="language-bash">   -e OPENAI_API_KEY=sk-xxxxæ›¿æ¢ä½ çš„apikey \</span><br><span class="language-bash">   -e CODE=your-passwordå¯†ç å¿…é¡»è¦ \</span><br><span class="language-bash">   -e BASE_URL=https://openrouter.ai/api \</span><br><span class="language-bash">   yidadaa/chatgpt-next-web</span><br> <span class="hljs-comment"># è®°ä½ï¼ŒBASE_URLå¿…é¡»æŒ‡å®šæ¢æˆopenrouter.aiçš„api</span><br> <br> <span class="hljs-comment"># å¦‚æœä¸èƒ½è”ç½‘ï¼Œåˆ™æœ‰å¯èƒ½æ˜¯vpnçš„åŸå› ,å¯ä»¥å°è¯•æŒ‡å®šä»£ç†ç«¯å£</span><br> <span class="hljs-comment"># -e PROXY_URL=&quot;http://127.0.0.1:7890&quot;</span><br></code></pre></td></tr></table></figure><h1 id="ç™»å½•å‰ç«¯é¡µé¢ï¼ˆæ‰‹æœºæˆ–è€…ç”µè„‘ï¼‰"><a href="#ç™»å½•å‰ç«¯é¡µé¢ï¼ˆæ‰‹æœºæˆ–è€…ç”µè„‘ï¼‰" class="headerlink" title="ç™»å½•å‰ç«¯é¡µé¢ï¼ˆæ‰‹æœºæˆ–è€…ç”µè„‘ï¼‰"></a>ç™»å½•å‰ç«¯é¡µé¢ï¼ˆæ‰‹æœºæˆ–è€…ç”µè„‘ï¼‰</h1><p>å¦‚æœæ˜¯verceléƒ¨ç½²ï¼Œé‚£vercelä¼šç»™ä½ ä¸€ä¸ªåŸŸå</p><p>å¦‚æœæ˜¯dockeréƒ¨ç½²ï¼Œå°±ç”¨å¯¹åº”çš„ç«¯å£å³å¯</p><p><img src="/img/pic/login2.jpg" alt="ç™»å½•"></p><h1 id="åˆ‡æ¢æ¨¡å‹"><a href="#åˆ‡æ¢æ¨¡å‹" class="headerlink" title="åˆ‡æ¢æ¨¡å‹"></a>åˆ‡æ¢æ¨¡å‹</h1><p><img src="/img/pic/charge.jpg" alt="åˆ‡æ¢æ¨¡å‹"></p><h1 id="æ³¨æ„æ‰£è´¹"><a href="#æ³¨æ„æ‰£è´¹" class="headerlink" title="æ³¨æ„æ‰£è´¹"></a>æ³¨æ„æ‰£è´¹</h1><p>ä½¿ç”¨åå¯ä»¥å»openrouterå¹³å°çœ‹ä½ çš„èŠ±è´¹è¯¦æƒ…</p><blockquote><p>gpt-4,gpt-4o,gpt-4-Turboçš„æ‰£è´¹å‡ ä¹æ˜¯gpt-4o-mini,gtp-3Turboçš„10å€</p></blockquote><p><img src="/img/pic/activity1.jpg" alt="æ‰£è´¹"></p><p><img src="/img/pic/activity2.jpg" alt="æ‰£è´¹2"></p>]]></content>
    
    
    <categories>
      
      <category>other</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç¬”è®°</tag>
      
      <tag>other</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>07-3 Cosmos é’±åŒ…å¼€å‘æµç¨‹</title>
    <link href="/2024/06/10/07-3Cosmos%E9%92%B1%E5%8C%85%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/"/>
    <url>/2024/06/10/07-3Cosmos%E9%92%B1%E5%8C%85%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="Cosmosé’±åŒ…å¼€å‘"><a href="#Cosmosé’±åŒ…å¼€å‘" class="headerlink" title="Cosmosé’±åŒ…å¼€å‘"></a>Cosmosé’±åŒ…å¼€å‘</h1><p>é’±åŒ…çš„äº¤æ˜“é€»è¾‘éƒ½æ˜¯ä¸€æ ·çš„ï¼Œ</p><ul><li><p>ç¬¬ä¸€æ­¥ï¼šç¦»çº¿åœ°å€ç”Ÿæˆ</p></li><li><p>ç¬¬äºŒæ­¥ï¼šæ„å»ºäº¤æ˜“æ¨¡å‹</p></li><li><p>ç¬¬ä¸‰æ­¥ï¼šç”Ÿæˆä¸€ä¸ªæœªç­¾åçš„msgæ¶ˆæ¯</p></li><li><p>ç¬¬å››æ­¥ï¼šå¯¹msgæ¶ˆæ¯è¿›è¡Œç­¾åï¼Œè¿”å›ä¸€ä¸ªå·²ç­¾åçš„æ¶ˆæ¯</p></li><li><p>ç¬¬äº”æ­¥ï¼šå¯¹å·²ç­¾åçš„æ¶ˆæ¯å¸Œè¿›è¡Œå¹¿æ’­</p></li></ul><h2 id="ç¦»çº¿åœ°å€ç”Ÿæˆ"><a href="#ç¦»çº¿åœ°å€ç”Ÿæˆ" class="headerlink" title="ç¦»çº¿åœ°å€ç”Ÿæˆ"></a>ç¦»çº¿åœ°å€ç”Ÿæˆ</h2><p>Cosmosæ”¯æŒä¸¤ç§æ ¼å¼çš„åœ°å€ï¼š</p><p>Edd25519å’ŒSecp256k1</p><p>ä»¥å‰åªæ”¯æŒSecp256k1åæ¥æ‰©å±•æ”¯æŒEdd25519</p><p>bech32æ˜¯ä¸€ç§æ ¼å¼</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> hdwallet<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;crypto/sha256&quot;</span><br><span class="hljs-string">&quot;encoding/hex&quot;</span><br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;github.com/cosmos/cosmos-sdk/types/bech32&quot;</span><br><span class="hljs-string">&quot;github.com/tyler-smith/go-bip32&quot;</span><br><span class="hljs-string">&quot;github.com/tyler-smith/go-bip39&quot;</span><br><span class="hljs-string">&quot;golang.org/x/crypto/ripemd160&quot;</span><br>)<br><br><span class="hljs-comment">// ç”Ÿæˆä¸€ä¸ªä»¥å¤ªåŠçš„é’±åŒ…</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">cosmosWalletPrivate</span><span class="hljs-params">()</span></span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;å¼€å§‹&quot;</span>)<br><span class="hljs-comment">// é¦–å…ˆä½ å¯ä»¥ç”Ÿæˆä¸€ä¸ªéšæœºç†µï¼Œç†µæºåŠ©è®°è¯æ˜¯BIP-39ï¼Œ</span><br><span class="hljs-comment">//entropy, _ := bip39.NewEntropy(128)</span><br><span class="hljs-comment">//fmt.Println(&quot;entroy:&quot;, entropy)</span><br><span class="hljs-comment">// é€šè¿‡ç†µæºç”ŸæˆåŠ©è®°è¯  ==&gt; æ³¨æ„ï¼Œä¸ä¸€å®šè¦æœ‰åŠ©è®°è¯æ‰æœ‰ç§å­ï¼Œåªæ˜¯åŠ©è®°è¯æ–¹ä¾¿å¤‡ä»½ï¼Œå¯ä»¥è½¬æˆç§å­ï¼Œä½ è¦ç›´æ¥ç”±ç§å­ä¹Ÿè¡Œï¼Œä½†ä¸å¥½è®°</span><br><span class="hljs-comment">//mnemonic, _ := bip39.NewMnemonic(entropy)</span><br>mnemonic := <span class="hljs-string">&quot;rural neither robot good glove bracket fee harsh bird iron segment rug&quot;</span><br>fmt.Println(<span class="hljs-string">&quot;mnemonic:&quot;</span>, mnemonic)<br><span class="hljs-comment">// é€šè¿‡åŠ©è®°è¯ç”Ÿæˆç§å­Seed</span><br>seed := bip39.NewSeed(mnemonic, <span class="hljs-string">&quot;&quot;</span>) <span class="hljs-comment">// passwordç›å€¼ä¸è¦åŠ </span><br>fmt.Println(<span class="hljs-string">&quot;seed&quot;</span>, seed)<br><br><span class="hljs-comment">// æ¥ä¸‹æ¥å°±æ˜¯å°†ç§å­æ¢å¤å‡ºä¸»ç§é’¥ masterKey è¿™é‡Œè¿›å…¥åˆ°äº†BIP-32äº† a</span><br>masterKey, _ := bip32.NewMasterKey(seed)<br><span class="hljs-comment">// æ³¨æ„ï¼Œæ­¤æ—¶è¿˜æ˜¯ä¸»ç§é’¥ï¼Œæ¥ä¸‹æ¥è¦æ´¾ç”Ÿå­ç§é’¥ï¼Œæ´¾ç”Ÿå‡ºæ¥çš„å­ç§é’¥æ‰æ˜¯çœŸæ­£çš„â€œç§é’¥â€æ‰èƒ½å¯¹åº”é“¾çš„å…¬é’¥ï¼Œæ‰èƒ½è§£å‹ç¼©å‡ºåœ°å€</span><br>fmt.Println(<span class="hljs-string">&quot;masterKey&quot;</span>, masterKey)<br><br><span class="hljs-comment">// ç°åœ¨è¦æ´¾ç”Ÿå‡ºå¯¹åº”ä»¥å¤ªåŠçš„å­ç§é’¥ï¼Œéµå¾ªBIP-44</span><br><span class="hljs-comment">// æ¥ä¸‹æ¥è¿›å…¥BIP-44 å®Œæˆæ´¾ç”Ÿ,å®Œæˆå¯¹åº”pathå‚æ•° m / purpose&#x27; / coin_type&#x27; / account&#x27; / change / address_index</span><br><span class="hljs-comment">// é€šè¿‡ä¸»ç§é’¥æ´¾ç”Ÿå‡ºå­ç§é’¥,FirstHardenedChild = uint32(0x80000000) æ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œå¯¹åº”å¼ºåŒ–æ´¾ç”ŸèŒƒå›´</span><br>key, _ := masterKey.NewChildKey(bip32.FirstHardenedChild + <span class="hljs-number">44</span>)   <span class="hljs-comment">// purpose&#x27; ï¼š 44 æ˜¯å›ºå®šå€¼ï¼Œå³BIP-44æ ‡å‡†ï¼Œå¼ºåŒ–æ´¾ç”Ÿ</span><br>key, _ = key.NewChildKey(bip32.FirstHardenedChild + <span class="hljs-type">uint32</span>(<span class="hljs-number">118</span>)) <span class="hljs-comment">// coin_type&#x27; ï¼š118æ˜¯cosmosæ ‡è¯†&#x27;ï¼Œ ç»§ç»­å¼ºåŒ–æ´¾ç”Ÿ</span><br>key, _ = key.NewChildKey(bip32.FirstHardenedChild + <span class="hljs-type">uint32</span>(<span class="hljs-number">0</span>))   <span class="hljs-comment">// account&#x27; : 0 æ ‡è®°è´¦æˆ·ç±»å‹ï¼Œä»0å¼€å§‹ï¼Œå¼ºåŒ–æ´¾ç”Ÿ</span><br>key, _ = key.NewChildKey(<span class="hljs-type">uint32</span>(<span class="hljs-number">0</span>))                              <span class="hljs-comment">// change :0 å¤–éƒ¨å¯è§åœ°å€ï¼Œ 1 æ‰¾é›¶åœ°å€ï¼ˆå¤–éƒ¨ä¸å¯è§ï¼‰ï¼Œé€šå¸¸æ˜¯ 0ï¼Œæ™®é€šæ´¾ç”Ÿ</span><br>key, _ = key.NewChildKey(<span class="hljs-type">uint32</span>(<span class="hljs-number">0</span>))                              <span class="hljs-comment">// åœ°å€ç´¢å¼• 0 1 2 3 è¿™æ ·ç´¢å¼•ï¼Œæ™®é€šæ´¾ç”Ÿ</span><br><span class="hljs-comment">// æ´¾ç”Ÿå®Œæ¯•ï¼Œå¯¹åº”çš„path å°±æ˜¯ &quot; m/44&#x27;/118&#x27;/0&#x27;/0/0 &quot;</span><br><br><span class="hljs-comment">// å­ç§é’¥key å·²ç»å‡ºæ¥äº†ï¼Œå…ˆæ‰“å°ç§é’¥ï¼Œkey.Keyå°±æ˜¯ç§é’¥ï¼Œæ³¨æ„è¦è½¬åŒ–è¿›åˆ¶</span><br>cosmosPrivateKey := hex.EncodeToString(key.Key) <span class="hljs-comment">// ç¼–ç æˆå­—ç¬¦ä¸² , è¿™é‡Œæ‰“å°å‡ºæ¥çš„ç§é’¥å°±å¯ä»¥</span><br>fmt.Println(<span class="hljs-string">&quot;privateKey&quot;</span>, cosmosPrivateKey)<br><br>fmt.Println(<span class="hljs-string">&quot;--------------COSMOSåœ¨å…¬é’¥è½¬åœ°å€çš„åœ°æ–¹è¿™é‡Œä¼šæœ‰äº›ä¸åŒ---------------------&quot;</span>)<br><span class="hljs-comment">// è¦å¯¹å…¬é’¥è¿›è¡Œ SHA-256å¤„ç†----&gt; cosmos çš„å…¬é’¥è¦è¿›è¡Œsha256 ç„¶å ripemdå“ˆå¸Œ</span><br>sha256Hasher := sha256.New()            <span class="hljs-comment">// ç›¸å½“äºåœ¨åˆ›å»ºsha256è¿™ä¸ªå¯¹è±¡</span><br>sha256Hasher.Write(key.PublicKey().Key) <span class="hljs-comment">// è¿™é‡Œå°±æ˜¯åœ¨å¯¹å…¬é’¥çš„å­—èŠ‚è¿›è¡Œsha256å“ˆå¸ŒåŠ å¯†</span><br>sha256Hash := sha256Hasher.Sum(<span class="hljs-literal">nil</span>)     <span class="hljs-comment">//</span><br><br><span class="hljs-comment">// ç„¶åå¯¹ SHA-256 å“ˆå¸Œç»“æœè¿›è¡Œ RIPEMD-160 å“ˆå¸ŒåŠ å¯†å¤„ç†</span><br>ripemd160Hasher := ripemd160.New()     <span class="hljs-comment">//  åŒæ · åˆ›å»ºripemd-160è¿™ä¸ªå¯¹è±¡</span><br>ripemd160Hasher.Write(sha256Hash)      <span class="hljs-comment">// è¿™é‡Œæ˜¯åœ¨å¯¹ä¹‹å‰sha256åŠ å¯†åçš„å…¬é’¥å†è¿›è¡ŒRIPEMD-160</span><br>pubKeyHash := ripemd160Hasher.Sum(<span class="hljs-literal">nil</span>) <span class="hljs-comment">//</span><br><br><span class="hljs-comment">// Bech32 ç¼–ç </span><br>bech32Addr, err := bech32.ConvertAndEncode(<span class="hljs-string">&quot;cosmos&quot;</span>, pubKeyHash)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Println(err)<br>&#125;<br>fmt.Println(<span class="hljs-string">&quot;cosmosAddress&quot;</span>, bech32Addr)<br><span class="hljs-comment">// æœ€åæŠŠ cosmosPrivateKey å¯¼å…¥åˆ° å¼€æ™®å‹’é’±åŒ… é‡Œé¢å»éªŒè¯ä¸‹ï¼Œç§é’¥å’Œåœ°å€å¯¹ä¸Šäº†æ²¡</span><br><br>&#125;<br><br></code></pre></td></tr></table></figure><p>Pythonå®ç°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_wallet</span>():<br>    privkey = PrivateKey().serialize()<br>    <span class="hljs-keyword">return</span> &#123;<br>        <span class="hljs-string">&quot;private_key&quot;</span>: privkey,<br>        <span class="hljs-string">&quot;public_key&quot;</span>: privkey_to_pubkey(privkey),<br>        <span class="hljs-string">&quot;address&quot;</span>: privkey_to_address(privkey),<br>    &#125;<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">privkey_to_pubkey</span>(<span class="hljs-params">privkey: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>    privkey_obj = PrivateKey(<span class="hljs-built_in">bytes</span>.fromhex(privkey))<br>    <span class="hljs-keyword">return</span> privkey_obj.pubkey.serialize().<span class="hljs-built_in">hex</span>()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">pubkey_to_address</span>(<span class="hljs-params">pubkey: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>    pubkey_bytes = <span class="hljs-built_in">bytes</span>.fromhex(pubkey)<br>    s = hashlib.new(<span class="hljs-string">&quot;sha256&quot;</span>, pubkey_bytes).digest()<br>    r = hashlib.new(<span class="hljs-string">&quot;ripemd160&quot;</span>, s).digest()<br>    <span class="hljs-keyword">return</span> bech32.bech32_encode(<span class="hljs-string">&quot;cosmos&quot;</span>, bech32.convertbits(r, <span class="hljs-number">8</span>, <span class="hljs-number">5</span>))<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">privkey_to_address</span>(<span class="hljs-params">privkey: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>    pubkey = privkey_to_pubkey(privkey)<br>    <span class="hljs-keyword">return</span> pubkey_to_address(pubkey)<br><br>wallet = generate_wallet()<br><span class="hljs-built_in">print</span>(wallet)<br></code></pre></td></tr></table></figure><h2 id="ç¦»çº¿ç­¾å-goç¼–å†™æ­¥éª¤åŸºäºRPC"><a href="#ç¦»çº¿ç­¾å-goç¼–å†™æ­¥éª¤åŸºäºRPC" class="headerlink" title="ç¦»çº¿ç­¾å goç¼–å†™æ­¥éª¤åŸºäºRPC"></a>ç¦»çº¿ç­¾å goç¼–å†™æ­¥éª¤åŸºäºRPC</h2><h3 id="0-ç¼–å†™protoBuf-æ–‡ä»¶"><a href="#0-ç¼–å†™protoBuf-æ–‡ä»¶" class="headerlink" title="0 ç¼–å†™protoBuf æ–‡ä»¶"></a>0 ç¼–å†™protoBuf æ–‡ä»¶</h3><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs protobuf">syntax = <span class="hljs-string">&quot;proto3&quot;</span>;<br><br><span class="hljs-keyword">package</span> cosmos;<br><span class="hljs-keyword">option</span> go_package = <span class="hljs-string">&quot;github.com/wangxiaowang01/web3learning/hdwallet/cosmos&quot;</span>;<br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;google/protobuf/empty.proto&quot;</span>;<br><br><span class="hljs-keyword">service </span><span class="hljs-title class_">MyService</span> &#123;<br>  <span class="hljs-function"><span class="hljs-keyword">rpc</span> MyMethod (google.protobuf.Empty) <span class="hljs-keyword">returns</span> (MyResponse) </span>&#123;&#125;<br>&#125;<br><br><span class="hljs-keyword">message </span><span class="hljs-title class_">MyResponse</span> &#123;<br>  <span class="hljs-type">string</span> result = <span class="hljs-number">1</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="1-å°†protoBufè½¬æˆ-pb-go"><a href="#1-å°†protoBufè½¬æˆ-pb-go" class="headerlink" title="1 å°†protoBufè½¬æˆ pb.go"></a>1 å°†protoBufè½¬æˆ pb.go</h3><p>æˆ–è€…å®˜æ–¹åº“é‡Œé¢ä¹Ÿæœ‰pb.goæ–‡ä»¶</p><h3 id="2-å»ºç«‹è¿æ¥"><a href="#2-å»ºç«‹è¿æ¥" class="headerlink" title="2 å»ºç«‹è¿æ¥"></a>2 å»ºç«‹è¿æ¥</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// NewClient æ–°å»ºé“¾æ¥ï¼Œç”¨äºåˆ›å»ºä¸€ä¸ª grpc å®¢æˆ·ç«¯</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewClient</span><span class="hljs-params">()</span></span> (grpcClient *grpc.ClientConn, err <span class="hljs-type">error</span>) &#123;<br><span class="hljs-comment">// gRPC æœåŠ¡å™¨çš„åœ°å€</span><br>serverAddress := <span class="hljs-string">&quot;cosmos-grpc.publicnode.com:443&quot;</span><br><span class="hljs-keyword">var</span> opts []grpc.DialOption <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªç©ºçš„optsåˆ‡ç‰‡ï¼Œç”¨äºå­˜å‚¨gRPCå®¢æˆ·ç«¯è¿æ¥é€‰é¡¹ã€‚</span><br><span class="hljs-comment">// è¿™é‡Œçš„appendæ˜¯å¥–é»˜è®¤å‡­è¯æ·»åŠ åˆ°gRPCå®¢æˆ·ç«¯é“¾æ¥é€‰é¡¹ä¸­ï¼Œæ„å‘³ç€å®¢æˆ·ç«¯å¥–ä½¿ç”¨é»˜è®¤çš„å‡­è¯è¿›è¡Œèº«ä»½è®¤è¯</span><br>opts = <span class="hljs-built_in">append</span>(opts, grpc.WithCredentialsBundle(google.NewDefaultCredentials()))<br><br><span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªgRPCå®¢æˆ·ç«¯è¿æ¥ï¼Œä¼ å…¥æœåŠ¡å™¨åœ°å€å’Œè¿™ä¸ªoptsé€‰é¡¹ï¼Œä¹Ÿå³æ˜¯å®¢æˆ·ç«¯å‡­è¯</span><br>grpcConn, err := grpc.NewClient(serverAddress, opts...)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(err)<br>&#125;<br><span class="hljs-comment">//æ¥ä¸‹æ¥ï¼Œä»£ç ä¸­åˆ›å»ºäº†ä¸€ä¸ª typetx.ServiceClient å®¢æˆ·ç«¯å¯¹è±¡ txClientï¼Œç”¨äºä¸æœåŠ¡ç«¯çš„ Service è¿›è¡Œäº¤äº’ã€‚è¿™é‡Œçš„ typetx å¯èƒ½æ˜¯æ ¹æ®æ‚¨çš„ .proto æ–‡ä»¶ç”Ÿæˆçš„ Go ä»£ç ä¸­çš„å‘½åç©ºé—´æˆ–åŒ…åã€‚</span><br><span class="hljs-comment">// è¿™é‡Œæ‰æ˜¯æœ€åçš„åˆ›å»ºé‡Œä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥ï¼Œç”Ÿæˆçš„ä¸€ä¸ªå®¢æˆ·ç«¯ç±»å‹</span><br><span class="hljs-comment">//txClient := typetx.NewServiceClient(grpcConn)</span><br><br><span class="hljs-comment">//ç„¶åï¼Œä»£ç åˆ›å»ºäº†ä¸€ä¸ª typetx.GetBlockWithTxsRequest è¯·æ±‚å¯¹è±¡ reqï¼Œå¹¶è®¾ç½®äº†å…¶ Height å±æ€§ä¸ºè¦æŸ¥è¯¢çš„å—çš„é«˜åº¦ï¼ˆåœ¨è¿™é‡Œæ˜¯ 20802601ï¼‰ã€‚</span><br><span class="hljs-comment">//req := &amp;typetx.GetBlockWithTxsRequest&#123;Height: 20802601&#125; // è¿™é‡Œåº”è¯¥æ˜¯å®šä¹‰ä¸€ä¸ªè¯·æ±‚å¯¹è±¡ï¼Œå°±æ˜¯è¯´ä½ çš„è¯·æ±‚æ˜¯ä»€ä¹ˆ</span><br><span class="hljs-comment">//rep2 := &amp;typetx.GetHeight&#123;&#125;</span><br><span class="hljs-comment">//æœ€åï¼Œä»£ç é€šè¿‡è°ƒç”¨ txClient.GetBlockWithTxs() æ–¹æ³•ï¼Œä¼ å…¥ä¸€ä¸ª context å¯¹è±¡é»˜è®¤ç»„å’Œè¯·æ±‚å¯¹è±¡ reqï¼Œå‘æœåŠ¡ç«¯å‘é€è¯·æ±‚å¹¶è·å–å“åº”ã€‚å“åº”å¯¹è±¡å­˜å‚¨åœ¨ resp å˜é‡ä¸­ï¼Œé”™è¯¯ä¿¡æ¯å­˜å‚¨åœ¨ err å˜é‡ä¸­ã€‚</span><br><span class="hljs-comment">//resp, err := txClient.GetBlockWithTxs(context.Background(), req) // è¿™é‡Œåº”è¯¥å°±æ˜¯å‘é€è¿™ä¸ªè¯·æ±‚å¯¹è±¡å‡ºå»ï¼Œæ¥æ”¶å“åº”</span><br><span class="hljs-comment">//if err != nil &#123;</span><br><span class="hljs-comment">//panic(err)</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//fmt.Println(resp.Txs[0].Body)</span><br><br>bankClient := banktypes.NewQueryClient(grpcConn)<br>bankReq := &amp;banktypes.QueryBalanceRequest&#123;Address: <span class="hljs-string">&quot;cosmos1sphlm2dp2a4v9hy7fzvqznus26g03vgz006ldt&quot;</span>, Denom: <span class="hljs-string">&quot;uatom&quot;</span>&#125;<br>bankResp, err := bankClient.Balance(context.Background(), bankReq)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-built_in">panic</span>(err)<br>&#125;<br>fmt.Println(<span class="hljs-string">&quot;bank str=&quot;</span>, bankResp.String())<br><span class="hljs-keyword">return</span> grpcConn, <span class="hljs-literal">nil</span><br><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="3-ç»„äº¤æ˜“å¹¿æ’­"><a href="#3-ç»„äº¤æ˜“å¹¿æ’­" class="headerlink" title="3 ç»„äº¤æ˜“å¹¿æ’­"></a>3 ç»„äº¤æ˜“å¹¿æ’­</h3><p>è¦å»ºç«‹gRPCè¿æ¥å°±è¦ç¼–protoBuff æ–‡ä»¶è½¬pb.goæ–‡ä»¶</p><p>è¦å»é“¾ä¸Šæ‹¿ç”¨æˆ·ä¿¡æ¯å°±è¦å»ºç«‹è¿æ¥â€”å»ºç«‹gRPC</p><p>ç»„è£…äº¤æ˜“ä¹‹å‰è¦å»é“¾ä¸ŠæŸ¥åˆ°ç”¨æˆ·ä¿¡æ¯ï¼Œè·å–åˆ°Account_number å’Œ sequence gaslimit ç­‰å‚æ•°</p><p><strong>å…ˆç»„è£…äº¤æ˜“-</strong>â€”&gt;<strong>ç”Ÿæˆä¸€ä¸ªæœªç­¾åçš„äº¤æ˜“å“ˆå¸Œ</strong>â€”-&gt;<strong>å¯¹æœªç­¾åäº¤æ˜“è¿›è¡Œç§é’¥ç­¾å</strong>â€”-&gt;<strong>ç­¾ååå¹¿æ’­å‡ºå»</strong></p><p><strong>å‘äº¤æ˜“</strong></p><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br></pre></td><td class="code"><pre><code class="hljs protobuf"><span class="hljs-keyword">package</span> cosmos<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;context&quot;</span><br><span class="hljs-string">&quot;encoding/hex&quot;</span><br><span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-string">&quot;github.com/cosmos/cosmos-sdk/codec/types&quot;</span><br><span class="hljs-string">&quot;github.com/cosmos/cosmos-sdk/crypto/keys/secp256k1&quot;</span><br>sdk <span class="hljs-string">&quot;github.com/cosmos/cosmos-sdk/types&quot;</span><br>typetx <span class="hljs-string">&quot;github.com/cosmos/cosmos-sdk/types/tx&quot;</span><br><span class="hljs-string">&quot;github.com/cosmos/cosmos-sdk/types/tx/signing&quot;</span><br>authtypes <span class="hljs-string">&quot;github.com/cosmos/cosmos-sdk/x/auth/types&quot;</span><br>banktypes <span class="hljs-string">&quot;github.com/cosmos/cosmos-sdk/x/bank/types&quot;</span><br><span class="hljs-string">&quot;github.com/gogo/protobuf/proto&quot;</span><br>)<br><br><span class="hljs-comment">//func NewGrpcClient() (grpcClient *grpc.ClientConn, err error) &#123;</span><br><span class="hljs-comment">//// åˆ›å»ºgrpcè¿æ¥</span><br><span class="hljs-comment">//target := &quot;cosmos-grpc.publicnode.com:443&quot;</span><br><span class="hljs-comment">//var opts []grpc.DialOption</span><br><span class="hljs-comment">//opts = append(opts, grpc.WithCredentialsBundle(google.NewDefaultCredentials()))</span><br><span class="hljs-comment">//grpcConn, err := grpc.NewClient(target, opts...)</span><br><span class="hljs-comment">//if err != nil &#123;</span><br><span class="hljs-comment">//panic(err)</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//txClient := typetx.NewServiceClient(grpcConn)</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//req := &amp;typetx.GetBlockWithTxsRequest&#123;Height: 20758858&#125;</span><br><span class="hljs-comment">//resp, err := txClient.GetBlockWithTxs(context.Background(), req)</span><br><span class="hljs-comment">//if err != nil &#123;</span><br><span class="hljs-comment">//panic(err)</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//fmt.Println(resp.Txs[0].Body)</span><br><span class="hljs-comment">//return grpcConn, nil</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// Import æ ¹æ®åå…­è¿›åˆ¶å­—ç¬¦ä¸²å¯¼å…¥ç§é’¥ã€‚</span><br><span class="hljs-comment">// å‚æ•° privKeyHex æ˜¯ä¸€ä¸ªåå…­è¿›åˆ¶ç¼–ç çš„ç§é’¥å­—ç¬¦ä¸²ã€‚</span><br><span class="hljs-comment">// è¿”å›å€¼æ˜¯ä¸€ä¸ªæŒ‡å‘ secp256k1 ç§é’¥ç»“æ„çš„æŒ‡é’ˆï¼Œä»¥åŠå¯èƒ½çš„é”™è¯¯ã€‚</span><br><span class="hljs-comment">// è¯¥å‡½æ•°çš„ç›®çš„æ˜¯å°†åå…­è¿›åˆ¶è¡¨ç¤ºçš„ç§é’¥è½¬æ¢ä¸º secp256k1 ç§é’¥ç»“æ„ï¼Œä»¥ä¾›åç»­åŠ å¯†æ“ä½œä½¿ç”¨ã€‚</span><br>func Import(privKeyHex <span class="hljs-type">string</span>) (*secp256k1.PrivKey, error) &#123;<br><span class="hljs-comment">// å°†åå…­è¿›åˆ¶å­—ç¬¦ä¸²è§£ç ä¸ºå­—èŠ‚åºåˆ—</span><br>priBytes, err := hex.DecodeString(privKeyHex)<br>if err != nil &#123;<br><br>return nil, err<br>&#125;<br><span class="hljs-comment">// åˆ›å»ºå¹¶è¿”å›ä¸€ä¸ªåŒ…å«è§£ç åå­—èŠ‚åºåˆ—çš„ secp256k1 ç§é’¥ç»“æ„</span><br>return &amp;secp256k1.PrivKey&#123;Key: priBytes&#125;, nil<br>&#125;<br><br><span class="hljs-comment">// transaction ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•åœ¨Cosmos SDKä¸­åˆ›å»ºå’Œå¹¿æ’­ä¸€ä¸ªåŸºæœ¬çš„äº¤æ˜“ã€‚</span><br><span class="hljs-comment">// å®ƒåŒ…æ‹¬ç”Ÿæˆäº¤æ˜“æ¶ˆæ¯ã€æ„å»ºäº¤æ˜“ã€ç­¾åäº¤æ˜“ä»¥åŠæœ€åå¹¿æ’­äº¤æ˜“ã€‚</span><br>func transaction() &#123;<br><br><span class="hljs-comment">// å¯¼å…¥ç§é’¥ï¼Œç”¨äºç”Ÿæˆäº¤æ˜“çš„ç­¾åã€‚ç§é’¥æ˜¯å·²ç»æ´¾ç”Ÿå®Œçš„å­ç§é’¥</span><br>pk, _ := Import(<span class="hljs-string">&quot;9f904a195e9a0b8dc6f3305928c7654f7ac714370c4a5d7f97a4ae2b7e06e4f8&quot;</span>)<br><span class="hljs-comment">// ä»ç§é’¥æ´¾ç”Ÿè´¦æˆ·åœ°å€ã€‚</span><br>var privKeyAccAddr sdk.AccAddress = pk.PubKey().Address().Bytes()<br><br><span class="hljs-comment">// å®šä¹‰äº¤æ˜“çš„æ¥æ”¶æ–¹åœ°å€å’Œè½¬ç§»çš„ä»£å¸æ•°é‡ã€‚</span><br>toAddr := sdk.MustAccAddressFromBech32(<span class="hljs-string">&quot;cosmos1sphlm2dp2a4v9hy7fzvqznus26g03vgz006ldt&quot;</span>)<br>coin := sdk.NewInt64Coin(<span class="hljs-string">&quot;uatom&quot;</span>, <span class="hljs-number">1</span>)<br>amount := sdk.NewCoins(coin)<br><br><span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªè½¬ç§»ä»£å¸çš„æ¶ˆæ¯ã€‚å®šä¹‰msg å®ä¾‹åŒ–msgSend</span><br>msg := banktypes.NewMsgSend(privKeyAccAddr, toAddr, amount)<br><br><span class="hljs-comment">// é€šè¿‡gRPCè¿æ¥åˆ°é“¾çš„æŸ¥è¯¢å®¢æˆ·ç«¯ã€‚</span><br>grpcConn, _ := NewClient()                       <span class="hljs-comment">// ä¼šè¿”å›ä¹‹å‰å®šä¹‰çš„gRPCè¿æ¥</span><br>authClient := authtypes.NewQueryClient(grpcConn) <span class="hljs-comment">// æ–°å»ºå®¢æˆ·ç«¯</span><br><br><span class="hljs-comment">// æŸ¥è¯¢å‘é€æ–¹è´¦æˆ·ä¿¡æ¯ï¼Œä»¥è·å–åºåˆ—å·å’Œè´¦æˆ·å·ï¼Œè¿™äº›éƒ½æ˜¯æ„å»ºäº¤æ˜“å¿…éœ€çš„ã€‚</span><br>fromAddrInfoAny, err := authClient.Account(context.Background(), &amp;authtypes.QueryAccountRequest&#123;Address: privKeyAccAddr.String()&#125;)<br><span class="hljs-comment">// è§£ææŸ¥è¯¢ç»“æœä¸­çš„è´¦æˆ·ä¿¡æ¯ã€‚</span><br>var f authtypes.BaseAccount<br><span class="hljs-comment">//  å®šä¹‰fä¸ºä¸€ä¸ªBaseAccountç»“æ„ä½“ï¼ŒæŠŠfromAddrInfoAnyçš„ç”¨æˆ·çš„ä¿¡æ¯å®ä¾‹åŒ–è¿›å¯¹è±¡fï¼Œè¿™ä¸ªæ—¶å€™få°±æœ‰å¾ˆå¤šå±æ€§äº†</span><br>if err := proto.Unmarshal(fromAddrInfoAny.Account.Value, &amp;f); err != nil &#123;<br>panic(err)<br>&#125;<br><br><span class="hljs-comment">// å®šä¹‰äº¤æ˜“è´¹ç”¨å’Œæ°”ä½“é™åˆ¶ã€‚å®šä¹‰gas fee å’Œ gas limit</span><br>fee := sdk.NewInt64Coin(<span class="hljs-string">&quot;uatom&quot;</span>, <span class="hljs-number">2000</span>)<br>gasLimit := <span class="hljs-type">int64</span>(<span class="hljs-number">100000</span>)<br><br><span class="hljs-comment">// æ„å»ºäº¤æ˜“ï¼ŒåŒ…æ‹¬ç­¾åã€‚</span><br><span class="hljs-comment">// è¿™é‡Œæ˜¯æ„å»ºä¸€ä¸ªå®Œæ•´çš„ç­¾ååçš„è½¬è´¦æ¶ˆæ¯ï¼Œåé¢å¹¿æ’­ç”¨</span><br>txRaw, err := BuildTxV2(<br><span class="hljs-string">&quot;cosmoshub-4&quot;</span>,<br>f.Sequence,<br>f.AccountNumber,<br>pk,<br>fee,<br>gasLimit,<br>[]sdk.Msg&#123;msg&#125;,<br>)<br>if err != nil &#123;<br>panic(err)<br>&#125;<br><br><span class="hljs-comment">// åºåˆ—åŒ–äº¤æ˜“ï¼Œå‡†å¤‡å¹¿æ’­ã€‚</span><br>txBytes, err := proto.Marshal(txRaw)<br>if err != nil &#123;<br>panic(err)<br>&#125;<br><br><span class="hljs-comment">// å¹¿æ’­äº¤æ˜“åˆ°é“¾ä¸Šã€‚</span><br><span class="hljs-comment">// å¹¿æ’­è¿™ç¬”ç­¾ååçš„äº¤æ˜“å‡ºå»</span><br>txClient := typetx.NewServiceClient(grpcConn)<br>req := &amp;typetx.BroadcastTxRequest&#123;<br>TxBytes: txBytes,<br>Mode:    typetx.BroadcastMode_BROADCAST_MODE_SYNC,<br>&#125;<br>txResp, err := txClient.BroadcastTx(context.Background(), req)<br>if err != nil &#123;<br>panic(err)<br>&#125;<br><br><span class="hljs-comment">// æ‰“å°äº¤æ˜“å“åº”ï¼ŒåŒ…æ‹¬äº¤æ˜“çš„å“ˆå¸Œå’ŒçŠ¶æ€ç ã€‚</span><br>fmt.Println(txResp.TxResponse)<br>&#125;<br><br><span class="hljs-comment">// BuildTxV2 æ„å»ºä¸€ç¬”äº¤æ˜“</span><br><span class="hljs-comment">// BuildTxV2 æ ¹æ®ç»™å®šå‚æ•°æ„å»ºäº¤æ˜“v2ç‰ˆæœ¬ã€‚</span><br><span class="hljs-comment">// å‚æ•°:</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//chainId - åŒºå—é“¾IDã€‚</span><br><span class="hljs-comment">//sequence - è´¦æˆ·åºåˆ—å·ã€‚</span><br><span class="hljs-comment">//accountNumber - è´¦æˆ·ç¼–å·ã€‚</span><br><span class="hljs-comment">//privKey - ç§é’¥ï¼Œç”¨äºäº¤æ˜“ç­¾åã€‚</span><br><span class="hljs-comment">//fee - äº¤æ˜“è´¹ç”¨ã€‚</span><br><span class="hljs-comment">//gaslimit - äº¤æ˜“ç‡ƒæ°”é™åˆ¶ã€‚</span><br><span class="hljs-comment">//msgs - äº¤æ˜“æ¶ˆæ¯æ•°ç»„ã€‚</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// è¿”å›:</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//*typetx.TxRaw - æ„å»ºçš„äº¤æ˜“åŸå§‹æ•°æ®ã€‚</span><br><span class="hljs-comment">//error - å¦‚æœæ„å»ºè¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œåˆ™è¿”å›é”™è¯¯ã€‚</span><br>func BuildTxV2(chainId <span class="hljs-type">string</span>, sequence, accountNumber <span class="hljs-type">uint64</span>, privKey *secp256k1.PrivKey, fee sdk.Coin, gaslimit <span class="hljs-type">int64</span>, msgs []sdk.Msg) (*typetx.TxRaw, error) &#123;<br><span class="hljs-comment">// åˆå§‹åŒ–æ¶ˆæ¯æ•°ç»„ï¼Œç”¨äºå­˜å‚¨ä¸åŒç±»å‹çš„æ¶ˆæ¯ã€‚</span><br>txBodyMessage := make([]*types.Any, <span class="hljs-number">0</span>)<br><span class="hljs-comment">// éå†æ¶ˆæ¯æ•°ç»„ï¼Œå°†æ¯ä¸ªæ¶ˆæ¯å°è£…ä¸ºAnyç±»å‹ï¼Œå¹¶æ·»åŠ åˆ°æ¶ˆæ¯æ•°ç»„ä¸­ã€‚</span><br>for i := <span class="hljs-number">0</span>; i &lt; len(msgs); i++ &#123;<br>msgAnyValue, err := types.NewAnyWithValue(msgs[i])<br>if err != nil &#123;<br>return nil, err<br>&#125;<br>txBodyMessage = append(txBodyMessage, msgAnyValue)<br>&#125;<br><span class="hljs-comment">// åˆå§‹åŒ–TxBodyç»“æ„ä½“ï¼Œè®¾ç½®æ¶ˆæ¯æ•°ç»„å’Œå…¶ä»–å¿…è¦å­—æ®µã€‚</span><br><span class="hljs-comment">// å®ä¾‹åŒ–TxBody</span><br>txBody := &amp;typetx.TxBody&#123;<br>Messages:                    txBodyMessage,<br>Memo:                        <span class="hljs-string">&quot;&quot;</span>,<br>TimeoutHeight:               <span class="hljs-number">0</span>,<br>ExtensionOptions:            nil,<br>NonCriticalExtensionOptions: nil,<br>&#125;<br><span class="hljs-comment">// åºåˆ—åŒ–TxBodyä¸ºå­—èŠ‚æµã€‚</span><br>txBodyBytes, err := proto.Marshal(txBody)<br>if err != nil &#123;<br>return nil, err<br>&#125;<br><span class="hljs-comment">// å°†å…¬é’¥å°è£…ä¸ºAnyç±»å‹ã€‚</span><br>pubAny, err := types.NewAnyWithValue(privKey.PubKey())<br>if err != nil &#123;<br>return nil, err<br>&#125;<br><span class="hljs-comment">// åˆå§‹åŒ–AuthInfoç»“æ„ä½“ï¼Œè®¾ç½®å…¬é’¥ã€ç­¾åä¿¡æ¯å’Œäº¤æ˜“è´¹ç”¨ã€‚å®šä¹‰äº¤æ˜“æ¨¡å‹</span><br>authInfo := &amp;typetx.AuthInfo&#123;<br>SignerInfos: []*typetx.SignerInfo&#123;<br>&#123;<br>PublicKey: pubAny,<br>ModeInfo: &amp;typetx.ModeInfo&#123;<br>Sum: &amp;typetx.ModeInfo_Single_&#123;<br>Single: &amp;typetx.ModeInfo_Single&#123;Mode: signing.SignMode_SIGN_MODE_DIRECT&#125;,<br>&#125;,<br>&#125;,<br>Sequence: sequence,<br>&#125;,<br>&#125;,<br>Fee: &amp;typetx.Fee&#123;<br>Amount:   sdk.NewCoins(fee),<br>GasLimit: <span class="hljs-type">uint64</span>(gaslimit),<br>Payer:    <span class="hljs-string">&quot;&quot;</span>,<br>Granter:  <span class="hljs-string">&quot;&quot;</span>,<br>&#125;,<br>&#125;<br><span class="hljs-comment">// åºåˆ—åŒ–AuthInfoä¸ºå­—èŠ‚æµã€‚</span><br><span class="hljs-comment">// å°†è´¦æˆ·ä¿¡æ¯æ¨¡å‹åºåˆ—åŒ–</span><br>txAuthInfoBytes, err := proto.Marshal(authInfo)<br>if err != nil &#123;<br>return nil, err<br>&#125;<br><br><span class="hljs-comment">// åˆå§‹åŒ–SignDocç»“æ„ä½“ï¼ŒåŒ…å«äº¤æ˜“ä½“ã€æˆæƒä¿¡æ¯ã€é“¾IDå’Œè´¦æˆ·åºåˆ—å·ã€‚</span><br>signDoc := &amp;typetx.SignDoc&#123;<br>BodyBytes:     txBodyBytes,<br>AuthInfoBytes: txAuthInfoBytes,<br>ChainId:       chainId,<br>AccountNumber: accountNumber,<br>&#125;<br><span class="hljs-comment">// å¯¹SignDocè¿›è¡Œç­¾åã€‚</span><br><span class="hljs-comment">// ç­¾ååºåˆ—åŒ–</span><br>signatures, err := proto.Marshal(signDoc)<br>if err != nil &#123;<br>return nil, err<br>&#125;<br><span class="hljs-comment">// ä½¿ç”¨ç§é’¥å¯¹ç­¾åæ•°æ®è¿›è¡Œç­¾åã€‚</span><br>sign, err := privKey.Sign(signatures)<br>if err != nil &#123;<br>return nil, err<br>&#125;<br><span class="hljs-comment">// æ„å»ºTxRawç»“æ„ä½“ï¼ŒåŒ…å«äº¤æ˜“ä½“å­—èŠ‚æµã€æˆæƒä¿¡æ¯å­—èŠ‚æµå’Œç­¾åã€‚</span><br><span class="hljs-comment">// æŠŠç­¾ååçš„TxRawè¿”å›å‡ºå» ä¸‹ä¸€æ­¥å†æ˜¯å¹¿æ’­</span><br>return &amp;typetx.TxRaw&#123;<br>BodyBytes:     txBodyBytes,<br>AuthInfoBytes: signDoc.AuthInfoBytes,<br>Signatures:    [][]byte&#123;sign&#125;,<br>&#125;, nil<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ä½¿ç”¨pythonä»£ç å®ç°,æ„å»ºå¾…å¹¿æ’­çš„å·²ç­¾åäº¤æ˜“</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> base64<br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">from</span> secp256k1 <span class="hljs-keyword">import</span> PrivateKey<br><span class="hljs-keyword">from</span> offlinAddre <span class="hljs-keyword">import</span> privkey_to_address, privkey_to_pubkey<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Transaction</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, *, privkey: <span class="hljs-built_in">str</span>, account_num: <span class="hljs-built_in">int</span>, sequence: <span class="hljs-built_in">int</span>, fee: <span class="hljs-built_in">int</span>, gas: <span class="hljs-built_in">int</span>, memo: <span class="hljs-built_in">str</span> = <span class="hljs-string">&quot;&quot;</span>,</span><br><span class="hljs-params">                 chain_id: <span class="hljs-built_in">str</span> = <span class="hljs-string">&quot;cosmoshub-2&quot;</span>, sync_mode=<span class="hljs-string">&quot;sync&quot;</span></span>):<br>        self.privkey = privkey<br>        self.account_num = account_num<br>        self.sequence = sequence<br>        self.fee = fee<br>        self.gas = gas<br>        self.memo = memo<br>        self.chain_id = chain_id<br>        self.sync_mode = sync_mode<br>        self.msgs = []<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add_atom_transfer</span>(<span class="hljs-params">self, recipient: <span class="hljs-built_in">str</span>, amount: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-literal">None</span>:<br>        self.msgs.append(<br>            &#123;<br>                <span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;cosmos-sdk/MsgSend&quot;</span>,<br>                <span class="hljs-string">&quot;value&quot;</span>: &#123;<br>                    <span class="hljs-string">&quot;from_address&quot;</span>: privkey_to_address(self.privkey),<br>                    <span class="hljs-string">&quot;to_address&quot;</span>: recipient,<br>                    <span class="hljs-string">&quot;amount&quot;</span>: [&#123;<span class="hljs-string">&quot;denom&quot;</span>: <span class="hljs-string">&quot;uatom&quot;</span>, <span class="hljs-string">&quot;amount&quot;</span>: <span class="hljs-built_in">str</span>(amount)&#125;],<br>                &#125;,<br>            &#125;<br>        )<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_get_sign_message</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> &#123;<br>            <span class="hljs-string">&quot;chain_id&quot;</span>: self.chain_id,<br>            <span class="hljs-string">&quot;account_number&quot;</span>: <span class="hljs-built_in">str</span>(self.account_num),<br>            <span class="hljs-string">&quot;fee&quot;</span>: &#123;<span class="hljs-string">&quot;gas&quot;</span>: <span class="hljs-built_in">str</span>(self.gas), <span class="hljs-string">&quot;amount&quot;</span>: [&#123;<span class="hljs-string">&quot;amount&quot;</span>: <span class="hljs-built_in">str</span>(self.fee), <span class="hljs-string">&quot;denom&quot;</span>: <span class="hljs-string">&quot;uatom&quot;</span>&#125;]&#125;,<br>            <span class="hljs-string">&quot;memo&quot;</span>: self.memo,<br>            <span class="hljs-string">&quot;sequence&quot;</span>: <span class="hljs-built_in">str</span>(self.sequence),<br>            <span class="hljs-string">&quot;msgs&quot;</span>: self.msgs,<br>        &#125;<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_sign</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">str</span>:<br>        message_str = json.dumps(self._get_sign_message(), separators=(<span class="hljs-string">&quot;,&quot;</span>, <span class="hljs-string">&quot;:&quot;</span>), sort_keys=<span class="hljs-literal">True</span>)<br>        message_bytes = message_str.encode(<span class="hljs-string">&quot;utf-8&quot;</span>)<br>        privkey = PrivateKey(<span class="hljs-built_in">bytes</span>.fromhex(self.privkey))<br>        signature = privkey.ecdsa_sign(message_bytes)<br>        signature_compact = privkey.ecdsa_serialize_compact(signature)<br>        signature_base64_str = base64.b64encode(signature_compact).decode(<span class="hljs-string">&quot;utf-8&quot;</span>)<br>        <span class="hljs-keyword">return</span> signature_base64_str<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_pushable_tx</span>(<span class="hljs-params">self</span>) -&gt; <span class="hljs-built_in">str</span>:<br>        pubkey = privkey_to_pubkey(self.privkey)<br>        base64_pubkey = base64.b64encode(<span class="hljs-built_in">bytes</span>.fromhex(pubkey)).decode(<span class="hljs-string">&quot;utf-8&quot;</span>)<br>        pushable_tx = &#123;<br>            <span class="hljs-string">&quot;tx&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;msg&quot;</span>: self.msgs,<br>                <span class="hljs-string">&quot;fee&quot;</span>: &#123;<br>                    <span class="hljs-string">&quot;gas&quot;</span>: <span class="hljs-built_in">str</span>(self.gas),<br>                    <span class="hljs-string">&quot;amount&quot;</span>: [&#123;<span class="hljs-string">&quot;denom&quot;</span>: <span class="hljs-string">&quot;uatom&quot;</span>, <span class="hljs-string">&quot;amount&quot;</span>: <span class="hljs-built_in">str</span>(self.fee)&#125;],<br>                &#125;,<br>                <span class="hljs-string">&quot;memo&quot;</span>: self.memo,<br>                <span class="hljs-string">&quot;signatures&quot;</span>: [<br>                    &#123;<br>                        <span class="hljs-string">&quot;signature&quot;</span>: self._sign(),<br>                        <span class="hljs-string">&quot;pub_key&quot;</span>: &#123;<span class="hljs-string">&quot;type&quot;</span>: <span class="hljs-string">&quot;tendermint/PubKeySecp256k1&quot;</span>, <span class="hljs-string">&quot;value&quot;</span>: base64_pubkey&#125;,<br>                        <span class="hljs-string">&quot;account_number&quot;</span>: <span class="hljs-built_in">str</span>(self.account_num),<br>                        <span class="hljs-string">&quot;sequence&quot;</span>: <span class="hljs-built_in">str</span>(self.sequence),<br>                    &#125;<br>                ],<br>            &#125;,<br>            <span class="hljs-string">&quot;mode&quot;</span>: self.sync_mode,<br>        &#125;<br>        <span class="hljs-keyword">return</span> json.dumps(pushable_tx, separators=(<span class="hljs-string">&quot;,&quot;</span>, <span class="hljs-string">&quot;:&quot;</span>))<br><br><br>tx = Transaction(<br>    privkey=<span class="hljs-string">&quot;your_private_key&quot;</span>,<br>    account_num=<span class="hljs-number">11335</span>,<br>    sequence=<span class="hljs-number">0</span>,<br>    fee=<span class="hljs-number">1000</span>,<br>    gas=<span class="hljs-number">37000</span>,<br>    memo=<span class="hljs-string">&quot;hello cosmos&quot;</span>,<br>    chain_id=<span class="hljs-string">&quot;cosmoshub-2&quot;</span>,<br>    sync_mode=<span class="hljs-string">&quot;sync&quot;</span>,<br>)<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br><br>    tx.add_atom_transfer(recipient=<span class="hljs-string">&quot;cosmosxxxxxxxx&quot;</span>, amount=<span class="hljs-number">1</span>)<br>    pushable_tx = tx.get_pushable_tx()<br>    <span class="hljs-built_in">print</span>(pushable_tx)<br><br></code></pre></td></tr></table></figure><h2 id="å¼€å‘ä¸­è¦ç”¨åˆ°çš„æ¥å£ï¼ˆHTTPï¼‰"><a href="#å¼€å‘ä¸­è¦ç”¨åˆ°çš„æ¥å£ï¼ˆHTTPï¼‰" class="headerlink" title="å¼€å‘ä¸­è¦ç”¨åˆ°çš„æ¥å£ï¼ˆHTTPï¼‰"></a>å¼€å‘ä¸­è¦ç”¨åˆ°çš„æ¥å£ï¼ˆHTTPï¼‰</h2><p>å»Cosmoså®˜ç½‘</p><p>æ‰¾åˆ°developer  æ‰¾åˆ°Rest API </p><p>cosmos-rest.publicnode</p><p>1 è·å–è´¦æˆ·ä¿¡æ¯ (addresNumber ã€sequence)</p><p>è¯·æ±‚ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl --location &#x27;https://cosmos-rest.publicnode.com/cosmos/auth/v1beta1/account_info/cosmos1z79jxnsw64c20upyfu8rfe89pdsel48kfmzjgu&#x27;<br></code></pre></td></tr></table></figure><p>å“åº”</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;info&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;address&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;cosmos1z79jxnsw64c20upyfu8rfe89pdsel48kfmzjgu&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;pub_key&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;@type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;/cosmos.crypto.secp256k1.PubKey&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;key&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;A26PAcbmjZxcZqsXL/CJgjTHqImZeAJDe85ufR+JFh/B&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;account_number&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2782398&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;sequence&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;1&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>2 è·å–æœ€æ–°å—é«˜</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl --location &#x27;https://cosmos-rest.publicnode.com/cosmos/base/tendermint/v1beta1/blocks/latest<br></code></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;block_id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;hash&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;RRihq+OoBPgRKlT2Pkw76bWYRBtPqQcxzzYG1XiwPaA=&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;part_set_header&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;total&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;hash&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;e2LsR5+z12RKKt7f+bOs0R41yotYUoQXOpI9HJ2x+V4=&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;block&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;header&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;version&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;block&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;11&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;app&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;0&quot;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;chain_id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;cosmoshub-4&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;height&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;20801304&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;time&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;2024-06-10T05:59:32.319047221Z&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;last_block_id&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                <span class="hljs-attr">&quot;hash&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;PpuKAWOd7D3mchFXqm/IZDxW7VH0WGrX11/Kmdg6qlU=&quot;</span><span class="hljs-punctuation">,</span><br>                <span class="hljs-attr">&quot;part_set_header&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">&#123;</span><br>                    <span class="hljs-attr">&quot;total&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span><br>                    <span class="hljs-attr">&quot;hash&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;cbxhE23bFrh1M7ezxSUDki5FO6+hUUYEXXdpQ6Bl4Y0=&quot;</span><br>                <span class="hljs-punctuation">&#125;</span><br>            <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br></code></pre></td></tr></table></figure><p>3 æŸ¥è¯¢æŒ‡å®šå—é«˜å†…çš„äº¤æ˜“</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl --location &#x27;https://cosmos-rest.publicnode.com/cosmos/base/tendermint/v1beta1/blocks/20801304<br></code></pre></td></tr></table></figure><p>æ‹¿åˆ°å¯¹åº”å—é«˜çš„txså³æ˜¯å¯¹å‘€çš„äº¤æ˜“ </p><p>4 æŠŠä½ çš„äº¤æ˜“è§£ç ï¼Œ</p><p>ä½ æŸ¥è¯¢å—é«˜çš„æ—¶å€™è¿”å›çš„äº¤æ˜“æ˜¯base64çš„ï¼Œä½ å¯ä»¥è§£ç å‡ºæ¥</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl --location &#x27;https://cosmos-rest.publicnode.com/cosmos/tx/v1beta1/decode&#x27; \<br>--header &#x27;Content-Type: application/json&#x27; \<br>--data &#x27;&#123;<br>    &quot;tx_bytes&quot;: &quot;CrsBCooBChwvY29zbW9zLmJhbmsudjFiZXRhMS5Nc2dTZW5kEmoKLWNvc21vczE4Y2p3ZWN4Y2c1Mmp6OTVkaHBkZzl1Y3JxM2NjeGYybHV1NjVnNRItY29zbW9zMW1ydHRhOXpjMGRzaDMwdmZkcXZmYW04a3djZ3g2cmdrYW0yam51GgoKBXVhdG9tEgExEixwcnl6bTE4Y2p3ZWN4Y2c1Mmp6OTVkaHBkZzl1Y3JxM2NjeGYybHl2ZG5rOBJnClAKRgofL2Nvc21vcy5jcnlwdG8uc2VjcDI1NmsxLlB1YktleRIjCiECjHhA4pLCWWUbidhR9yMjsBSUnSRHSrCcmuDFcj3ZMp0SBAoCCH8YAxITCg0KBXVhdG9tEgQxNjkyENqQBBpAMRNaVaMWbdUgfpiRkC9LTB93FMWztlsIaTEk82zIMzZdRch9SqKbiEH433Ar9xyPQUrsM40OUWR+rNTRlXggqw==&quot;<br>&#125;&#x27;<br></code></pre></td></tr></table></figure><p>ä½ çš„äº¤æ˜“ç­¾åä¹‹åè¿”å›çš„æ•°æ®æ˜¯base64çš„ï¼Œå¯ä»¥ç›´æ¥å¹¿æ’­å‡ºå»ï¼Œå¹¿æ’­å‡ºå»çš„äº¤æ˜“å“ˆå¸Œ </p><p>5 æ ¹æ® å“ˆå¸Œ æŸ¥è¯¢å¯¹åº”çš„äº¤æ˜“</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">/cosmos/tx/v1beta1/txs/&#123;hash&#125;<br>curl --location &#x27;https://cosmos-rest.publicnode.com/cosmos/tx/v1beta1/txs/&#123;hash&#125;<br></code></pre></td></tr></table></figure><p>6 å¹¿æ’­äº¤æ˜“</p><p>å¹¿æ’­çš„ä¼ å‚æ˜¯ä½ çš„ç­¾åæ„å»ºçš„äº¤æ˜“</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl --location &#x27;https://cosmos-rest.publicnode.com/cosmos/tx/v1beta1/txs&#x27; \<br>--header &#x27;Content-Type: application/json&#x27; \<br>--data &#x27;    &#123;&quot;tx_bytes&quot;:&quot;CpgBCo8BChwvY29zbW9zLmJhbmsudjFiZXRhMS5Nc2dTZW5kEm8KLWNvc21vczF6NzlqeG5zdzY0YzIwdXB5ZnU4cmZlODlwZHNlbDQ4a2ZtempndRItY29zbW9zMWVyNDB3cjN2Nzhhd3h0MDJrNGhxNmV2bDNxanJwZDRma2RtbXEzGg8KBXVhdG9tEgYxMDAwMDASBDEwMTASZwpQCkYKHy9jb3Ntb3MuY3J5cHRvLnNlY3AyNTZrMS5QdWJLZXkSIwohA26PAcbmjZxcZqsXL/CJgjTHqImZeAJDe85ufR+JFh/BEgQKAggBGAESEwoNCgV1YXRvbRIEMTAwMBDj7AUaQP2sdB0DnYNOGSbHWoRbsEexeRbHEDNnyC4rt7EkVLDUde9xRHYNhda5DOd+q+C/n9O7muLaqvHq/FYifanfz+I=&quot;,&quot;mode&quot;:&quot;BROADCAST_MODE_SYNC&quot;&#125;<br>&#x27;<br></code></pre></td></tr></table></figure><h1 id=""><a href="#" class="headerlink" title=""></a></h1><p>ä¸­å¿ƒåŒ–é’±åŒ…ï¼š</p><p>å……å€¼</p><p>æç°</p><p>å½’é›†</p><p>è½¬å†·çƒ­</p><p>æ‰«å—</p><p>å»ä¸­å¿ƒåŒ–é’±åŒ…</p><p>è·å–è´¦æˆ·ä½™é¢</p><p>è·å–äº¤æ˜“è®°å½•</p><p>è·å–ç­¾åå‚æ•°</p>]]></content>
    
    
    <categories>
      
      <category>blockChain</category>
      
    </categories>
    
    
    <tags>
      
      <tag>block</tag>
      
      <tag>æ¦‚å¿µ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>07-2 Ethereum é’±åŒ…å¼€å‘æµç¨‹</title>
    <link href="/2024/05/30/07-2Ethereum%E9%92%B1%E5%8C%85%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/"/>
    <url>/2024/05/30/07-2Ethereum%E9%92%B1%E5%8C%85%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="1-ä»¥å¤ªåŠåŸºç¡€çŸ¥è¯†"><a href="#1-ä»¥å¤ªåŠåŸºç¡€çŸ¥è¯†" class="headerlink" title="1.ä»¥å¤ªåŠåŸºç¡€çŸ¥è¯†"></a>1.ä»¥å¤ªåŠåŸºç¡€çŸ¥è¯†</h1><h3 id="æ™ºèƒ½åˆçº¦ï¼š"><a href="#æ™ºèƒ½åˆçº¦ï¼š" class="headerlink" title="æ™ºèƒ½åˆçº¦ï¼š"></a>æ™ºèƒ½åˆçº¦ï¼š</h3><p>Smart Contracts æ˜¯ä»¥å¤ªåŠæœ€é‡è¦çš„ç‰¹æ€§ä¹‹ä¸€ï¼Œæ™ºèƒ½åˆçº¦è®©ä»¥å¤ªåŠæœ‰æ›´å¤šçš„å¯èƒ½æ€§ï¼Œè®©é“¾ä¸ä»…ä»…æ˜¯é“¾ï¼Œè¿˜å¯ä»¥åšå¾ˆå¤šçš„åº”ç”¨ï¼Œæ™ºèƒ½åˆçº¦æ˜¯ä¸€æ®µå­˜å‚¨åœ¨ä»¥å¤ªåŠåŒºå—é“¾ä¸Šçš„ä»£ç ï¼Œå¯ä»¥è‡ªåŠ¨æ‰§è¡Œåè®®çš„æ¡æ¬¾ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªæ™ºèƒ½åˆçº¦æ¥ç®¡ç†ä¼—ç­¹æ´»åŠ¨ï¼Œå½“ä¼—ç­¹è¾¾åˆ°ç›®æ ‡æ—¶ï¼Œåˆçº¦ä¼šè‡ªåŠ¨å°†èµ„é‡‘è½¬ç»™é¡¹ç›®æ–¹ã€‚</p><h3 id="å•ä½æ¢ç®—"><a href="#å•ä½æ¢ç®—" class="headerlink" title="å•ä½æ¢ç®—"></a>å•ä½æ¢ç®—</h3><p>1 Ether(ETH)&#x3D;1 x 10^3 Finney &#x3D; 1 x 10^6 Szabo &#x3D; 1 x 10^9 Gwei &#x3D; 1 x 10^12 Wei</p><h3 id="ä»¥å¤ªåŠè™šæ‹Ÿæœºï¼ˆEVMï¼‰"><a href="#ä»¥å¤ªåŠè™šæ‹Ÿæœºï¼ˆEVMï¼‰" class="headerlink" title="ä»¥å¤ªåŠè™šæ‹Ÿæœºï¼ˆEVMï¼‰"></a>ä»¥å¤ªåŠè™šæ‹Ÿæœºï¼ˆEVMï¼‰</h3><p>Ethereum Virtual Machine EVM æ˜¯ä»¥å¤ªåŠçš„æ ¸å¿ƒç»„ä»¶ï¼ŒEVMæ˜¯ä¸€ä¸ªå›¾çµå®Œå¤‡çš„è™šæ‹Ÿæœºï¼Œä»–å¯ä»¥æ‰§è¡Œç”¨ä»¥å¤ªåŠè„šæœ¬è¯­è¨€ï¼ˆSolidityï¼‰ç¼–å†™çš„ä»»æ„ä»£ç ã€‚EVMä½¿å¾—æ™ºèƒ½åˆçº¦çš„æ‰§è¡Œå˜å¾—å¯èƒ½ã€‚ä¹Ÿå°±æ˜¯è¯´ä½ å¯ä»¥è‡ªå·±çš„ä»£ç æ”¾åˆ°EVMä¸Šå»æ‰§è¡Œï¼Œ</p><h3 id="Dappsï¼ˆå»ä¸­å¿ƒåŒ–åº”ç”¨ï¼‰"><a href="#Dappsï¼ˆå»ä¸­å¿ƒåŒ–åº”ç”¨ï¼‰" class="headerlink" title="Dappsï¼ˆå»ä¸­å¿ƒåŒ–åº”ç”¨ï¼‰"></a>Dappsï¼ˆå»ä¸­å¿ƒåŒ–åº”ç”¨ï¼‰</h3><p>Decentralized Applications Dapps æ˜¯åŸºäºä»¥å¤ªåŠåŒºå—é“¾å’Œæ™ºèƒ½åˆçº¦æ„å»ºçš„åº”ç”¨ç¨‹åºï¼Œä¸ä¼ ç»Ÿåº”ç”¨ä¸åŒï¼ŒDappsæ²¡æœ‰ä¸­å¤®æœåŠ¡ï¼Œæ•°æ®å’Œåº”ç”¨é€»è¾‘æ˜¯åˆ†å¸ƒå¼çš„ï¼Œè¿™ä½¿å¾—ä»–ä»¬æ›´åŠ é€æ˜å’Œå®‰å…¨ã€‚</p><h3 id="ERCæ ‡å‡†"><a href="#ERCæ ‡å‡†" class="headerlink" title="ERCæ ‡å‡†"></a>ERCæ ‡å‡†</h3><p>ERCæ ‡å‡†æ˜¯ä»¥å¤ªåŠçš„æŠ€æœ¯è§„èŒƒï¼Œç”¨äºåˆ›å»ºä»£å¸å’Œå…¶ä»–åˆçº¦ï¼Œæœ€è‘—åçš„æ˜¯ERC-20æ ‡å‡†ï¼Œä»–å®šä¹‰äº†ä¸€ç§é€šç”¨çš„æ¥å£ï¼Œä½¿å¾—ä»£ç å¯ä»¥åœ¨ä¸åŒçš„DAppä¹‹é—´äº’æ“ä½œã€‚ERC ææ¡ˆä»…ä»…æ˜¯ä»¥å¤ªåŠç¤¾åŒºçš„ä¸€äº›å»ºè®®å’Œè§„èŒƒï¼Œå¹¶æ²¡æœ‰å¼ºåˆ¶æ‰§è¡Œçš„æœºåˆ¶ã€‚å¼€å‘è€…å¯ä»¥é€‰æ‹©æ˜¯å¦éµå¾ªè¿™äº›æ ‡å‡†ï¼Œä½†éµå¾ª ERC æ ‡å‡†é€šå¸¸ä¼šæé«˜æ™ºèƒ½åˆçº¦å’Œä»£å¸çš„äº’æ“ä½œæ€§ï¼Œå¹¶ä½¿å…¶æ›´æ˜“äºä¸å…¶ä»–ä»¥å¤ªåŠåº”ç”¨å’Œå·¥å…·è¿›è¡Œé›†æˆã€‚å¤§å®¶éµå®ˆè¿™ä¸ªæ ‡å‡†ä¹‹åï¼Œæ›´ä¾¿äºä»£å¸çš„æµé€šï¼Œ</p><p>ERC-721æ˜¯å¦ä¸€ç§æ ‡å‡†ï¼Œç”¨äºåˆ›å»ºéåŒè´¨åŒ–ä»£å¸ï¼ˆNFTï¼‰è¿™äº›ä»£ç å…·æœ‰ç‹¬ç‰¹æ€§å’Œä¸å¯äº’æ¢æ€§</p><p>ETH1.0å’ŒETH2.0</p><p>ETH1.0</p><p>å…±è¯†æœºåˆ¶ï¼šå·¥ä½œé‡è¯æ˜ï¼ˆproof of work PoWï¼‰ï¼šETH1.0ä½¿ç”¨çš„æ˜¯PoWå…±è¯†æœºåˆ¶ï¼Œæ—·å·¥é€šè¿‡è§£å†³å¤æ‚çš„æ•°å­¦é—®é¢˜æ¥éªŒè¯äº¤æ˜“å¹¶æ·»åŠ åŒºå—ï¼Œæ·»åŠ åŒºå—çš„æ—·å·¥å¯ä»¥è·å¾—ä»£å¸å¥–åŠ±ï¼Œè§£å†³æ•°å­¦éš¾é¢˜éœ€è¦è€—è´¹å·¨å¤§çš„GPUå»è¿ç®—ï¼Œè¿™ä¸ªå°±æ˜¯ä¼ ç»Ÿæ„ä¹‰ä¸Šçš„â€œæŒ–çŸ¿â€ï¼Œè¿™ä¸ªè¿‡ç¨‹èƒ½è€—éå¸¸é«˜ï¼Œæ•ˆç‡å¾ˆä½ï¼Œä¸”å®¹æ˜“é€ æˆä¸å¹³è¡¡ï¼Œå°±æ˜¯æ‹¥æœ‰æ›´å¤šçš„æ˜¾å¡çš„äººå¯ä»¥æŒ–çš„æ›´å¤šçš„åŒºå—ï¼Œ</p><p>æ€§èƒ½ï¼šååé‡ï¼š ETH1.0æ¯ç§’åªèƒ½å¤„ç†å¤§çº¦15-30ç¬”äº¤æ˜“ï¼Œå­˜åœ¨æ‹“å±•æ€§ç“¶é¢ˆï¼Œå°¤å…¶æ˜¯åœ¨ç½‘ç»œè´Ÿè½½ï¼ˆäº¤æ˜“é‡å¤§ï¼‰çš„é«˜å³°æœŸï¼Œäº¤æ˜“ç¡®è®¤æ—¶é—´å’Œæ‰‹ç»­è´¹ä¼šæ˜¾è‘—å¢åŠ ã€‚</p><p>å®‰å…¨æ€§ï¼šçŸ¿æ± é›†ä¸­åŒ–ï¼šPoWæœºåˆ¶å¯¼è‡´çŸ¿æ± çš„é›†ä¸­åŒ–é—®é¢˜ï¼Œå°‘æ•°å¤§å‹çŸ¿æ± æ§åˆ¶äº†å¤§éƒ¨åˆ†çš„ç®—åŠ›ï¼Œæœ‰æ˜¾å¡çš„äººå°±æœ‰ç®—åŠ›ï¼Œå°±å¯ä»¥æŒ–æ‰åŒºå—ã€‚å¯èƒ½å¸¦æ¥ä¸­å¿ƒåŒ–é£é™©</p><p>æ™ºèƒ½åˆçº¦å’ŒDAppsï¼šETH1.0æ”¯æŒæ™ºèƒ½åˆçº¦å’Œå»ä¸­å¿ƒåŒ–åº”ç”¨ï¼ˆDAppsï¼‰ï¼Œæ¯”å¦‚å»ä¸­å¿ƒåŒ–é‡‘èï¼ˆDeFiï¼‰ã€æ¸¸æˆå’Œä¾›åº”é‡ç®¡ç†</p><p>ETH-2.0</p><ul><li><p>å…±è¯†æœºåˆ¶ï¼š æƒç›Šè¯æ˜ï¼ˆProof of Stake, PoSï¼‰ï¼šETH2.0 ä½¿ç”¨PoSå…±è¯†æœºåˆ¶ï¼ŒéªŒè¯è€…é€šè¿‡è´¨æŠ¼ETHæ¥è·å¾—éªŒè¯åŒºå—çš„æœºä¼šã€‚PoSå¤§å¹…å‡å°‘èƒ½è€—ï¼Œæé«˜äº†æ•ˆç‡å’Œå®‰å…¨æ€§ã€‚æ¯”å¦‚è¯´å…¨ç½‘æœ‰10ä¸ªéªŒè¯è€…ï¼Œæ¯ä¸ªäººè´¨æŠ¼ä¸åŒæ•°é‡çš„ä»£å¸æ¥è·å¾—å‡ºå—çš„<code>æœºä¼š</code>ï¼Œæœ€åå‡ºå—çš„äººä¼šå¥–åŠ±ä»£å¸çš„</p></li><li><p>æ€§èƒ½ï¼š</p><ul><li><p>åˆ†ç‰‡é“¾ï¼ˆSharding chains ï¼‰ï¼šETH2.0å¼•å…¥äº†åˆ†ç‰‡æŠ€æœ¯ï¼Œé€šè¿‡å°†åŒºå—é“¾åˆ†æˆå¤šä¸ªå¹¶è¡Œé“¾ï¼ˆåˆ†ç‰‡ shardï¼‰ï¼Œæ¯ä¸ªåˆ†ç‰‡å¤„ç†ä¸åŒçš„äº¤æ˜“å’Œæ™ºèƒ½åˆçº¦ï¼Œä»è€Œæ˜¾è‘—æé«˜äº†ç½‘ç»œçš„ååé‡å’Œå¤„ç†èƒ½åŠ›</p></li><li><p>ä¿¡æ ‡é“¾ï¼ˆBeacon Chainï¼‰ï¼šETH2.0çš„æ ¸å¿ƒé“¾ï¼Œè´Ÿè´£åè°ƒåˆ†ç‰‡å’ŒéªŒè¯è€…æ´»åŠ¨ï¼Œç¡®ä¿æ•´ä¸ªç½‘ç»œçš„åŒæ­¥å’Œå…±è¯†ï¼Œä¿¡æ ‡é“¾è´Ÿè´£éªŒè¯å’Œç»´æŠ¤ç½‘ç»œçš„å…±è¯†ï¼Œå¹¶å¼•å…¥äº†éªŒè¯è€…è§’è‰²ã€‚ä¿¡æ ‡é“¾é€šè¿‡éšæœºæ€§æœºåˆ¶æ¥é€‰æ‹©éªŒè¯è€…å‚ä¸åŒºå—çš„æè®®å’ŒéªŒè¯ã€‚è¿™ç§éšæœºæ€§ç¡®ä¿äº†å…¬å¹³æ€§å’Œå®‰å…¨æ€§ï¼Œå¹¶é˜²æ­¢æ½œåœ¨çš„æ”»å‡»è¡Œä¸ºã€‚ä¿¡æ ‡é“¾è¿˜å¼•å…¥äº†è½®æ¬¡ï¼ˆEpochï¼‰çš„æ¦‚å¿µï¼Œå°†æ—¶é—´åˆ’åˆ†ä¸ºè¾ƒé•¿çš„å‘¨æœŸï¼Œä»¥ä¾¿è¿›è¡ŒéªŒè¯è€…çš„è½®æ¢å’Œå…±è¯†æœºåˆ¶çš„è°ƒæ•´</p></li></ul></li><li><p>å®‰å…¨æ€§ï¼šå»ä¸­å¿ƒåŒ–å’ŒæŠ—æ”»å‡»æ€§ï¼šPoSæœºåˆ¶ä¸‹ï¼Œæ¶æ„æ”»å‡»è€…éœ€è¦æŒæœ‰å¤§é‡çš„ETHï¼Œæˆæœ¬é«˜æ˜‚ï¼Œä½¿å¾—ç½‘ç»œæ›´å®‰å…¨ï¼Œæ­¤å¤–ï¼Œå‰é¢è¯´çš„ä¿¡æ ‡é“¾é€šè¿‡éšæœºæ€§æœºåˆ¶æ¥é€‰æ‹©éªŒè¯è€…å‚ä¸åŒºå—æè®®ï¼Œæœ‰éšæœºæ€§ï¼Œè¿›ä¸€æ­¥åˆ†æ•£é£é™©ã€‚</p></li><li><p>æ™ºèƒ½åˆçº¦å’ŒDAppsï¼šETH2.0ä¿ç•™äº†å¯¹æ™ºèƒ½åˆçº¦çš„DAppsçš„æ”¯æŒï¼ŒåŒäº‹é€šè¿‡æ›´é«˜çš„ååé‡å’Œæ›´ä½çš„äº¤æ˜“è´¹ç”¨ï¼Œæå‡äº†ç”¨æˆ·ä½“éªŒå’Œåº”ç”¨æ€§èƒ½ã€‚</p></li><li><p>è¿‡æ¸¡è¿‡ç¨‹ï¼šåˆå¹¶ï¼ˆThe Mergeï¼‰ï¼šETH2.0å¹¶ä¸æ˜¯ä»é›¶å¼€å§‹çš„æ–°åŒºå—é“¾ï¼Œè€Œæ˜¯å¯¹ETH1.0çš„å‡çº§è€Œæ¥ï¼Œåˆå¹¶å°†ETH1.0çš„ç°æœ‰é“¾å’ŒETH2.0çš„PoSé“¾ç»“åˆï¼Œå®ç°æ— ç¼è¿‡æ¸¡ã€‚</p></li></ul><p>ä¸»è¦æ”¹è¿›å’Œä¼˜ç‚¹</p><ul><li>èƒ½è€—ï¼šETH2.0é€šè¿‡ PoS æœºåˆ¶å¤§å¹…å‡å°‘äº†èƒ½æºæ¶ˆè€—ï¼Œç›¸æ¯” PoW æœºåˆ¶æ›´ç¯ä¿ï¼ˆé™äº¤æ˜“è´¹äº†ï¼‰</li><li>æ‰©å±•æ€§ï¼šåˆ†ç‰‡æŠ€æœ¯å’Œä¿¡æ ‡é“¾çš„å¼•å…¥æ˜¾è‘—æé«˜äº†ç½‘ç»œçš„æ‰©å±•æ€§å’Œååé‡ï¼ˆå¤§å“¥å¸¦å°å¼Ÿï¼‰</li><li>å»ä¸­å¿ƒåŒ–ï¼šETH2.0é€šè¿‡éšæœºé€‰æ‹©éªŒè¯è€…å’Œç»æµæ¿€åŠ±æœºåˆ¶ï¼Œå¢å¼ºäº†å»ä¸­å¿ƒåŒ–ç¨‹åº¦å’Œå®‰å…¨æ€§ï¼ˆéšæœºéªŒè¯è€…ï¼Œå«ä½ ä»¬æŒ–æŒ–æŒ–çŸ¿ï¼ŒæŒ–ä¸åˆ°äº†å§ï¼‰</li><li>ç»æµæ¨¡å‹ï¼šETH2.0å¼•å…¥äº†æ–°çš„ç»æµæ¨¡å‹ï¼Œé€šè¿‡è´¨æŠ¼å’Œå¥–åŠ±æœºåˆ¶ï¼Œè¿›ä¸€æ­¥æ¿€åŠ±ç½‘ç»œå‚ä¸è€…ï¼Œæé«˜ç½‘ç»œçš„ç¨³å®šæ€§å’Œå®‰å…¨æ€§ï¼ˆéªŒè¯è€…å’ŒæŠµæŠ¼ã€å¥–åŠ±å’Œæƒ©ç½šã€åˆ©æ¯å’Œé€šèƒ€ã€è´¨æŠ¼å’Œè§£ä¹‹ä¸€ï¼Œå‹å¸æœ‰æ”¶ç›Šï¼Œåšæ¶æœ‰æƒ©ç½šï¼‰</li></ul><p>1.3 ETH2.0ä¸­çš„Epoch,Slot,Blockå’ŒBlockçŠ¶æ€</p><p><img src="/img/web3/epoch.jpeg" alt="epoch"></p><ul><li>ETH2.0 æŒ‰ç…§epoch å‡ºå— ï¼ˆä¸€ä¸ªepochä¸€ä¸ªçºªå…ƒï¼‰</li><li>æ¯ä¸€ä¸ªepochæœ‰32ä¸ªslot (slot æ—¶éš™)</li><li>æ¯ä¸€ä¸ªslot å¯ä»¥æ‰¿è½½1ä¸ªå—</li></ul><h3 id="Slotï¼ˆæ—¶éš™ï¼‰"><a href="#Slotï¼ˆæ—¶éš™ï¼‰" class="headerlink" title="Slotï¼ˆæ—¶éš™ï¼‰"></a>Slotï¼ˆæ—¶éš™ï¼‰</h3><ul><li>å®šä¹‰ï¼šSlot æ˜¯ä»¥å¤ªåŠ2.0ä¸­æœ€åŸºæœ¬çš„æ—¶é—´å•ä½ï¼Œæ¯ä¸ªslot éƒ½æœ‰ä¸€ä¸ªæŒ‡å®šçš„æ—¶é—´é•¿åº¦ã€‚åœ¨æ¯ä¸ªslot ä¸­ï¼Œå¯èƒ½ä¼šæœ‰ä¸€ä¸ªåŒºå—è¢«æè®®å¹¶æ·»åŠ åˆ°é“¾ä¸­ã€‚</li><li>æ—¶é—´é•¿åº¦ï¼šä¸€ä¸ªslot çš„é•¿åº¦ä¸º12ç§’ã€‚è¿™æ„å‘³ç€æ¯12ç§’ä¼šæœ‰ä¸€ä¸ªæ–°çš„slotã€‚</li><li>åŠŸèƒ½ï¼šåœ¨æ¯ä¸ªslot ä¸­ï¼Œç½‘ç»œä¸­çš„éªŒè¯è€…å°†æœ‰æœºä¼šæè®®ä¸€ä¸ªæ–°çš„åŒºå—ã€‚è¿™äº›æè®®è€…æ˜¯é€šè¿‡æƒç›Šè¯æ˜ï¼ˆPoSï¼‰éšæœºé€‰æ‹©çš„ã€‚</li><li>blockåœ¨sloté‡Œé¢ï¼Œä½†æ˜¯æ¯ä¸ªsloté‡Œé¢ä¸ä¸€å®šéƒ½æœ‰block</li></ul><h3 id="Epochï¼ˆçºªå…ƒï¼‰"><a href="#Epochï¼ˆçºªå…ƒï¼‰" class="headerlink" title="Epochï¼ˆçºªå…ƒï¼‰"></a>Epochï¼ˆçºªå…ƒï¼‰</h3><ul><li>å®šä¹‰ï¼šEpoch æ˜¯ç”±å¤šä¸ªè¿ç»­çš„slot ç»„æˆçš„æ›´é•¿æ—¶é—´æ®µã€‚åœ¨Eth2.0ä¸­ï¼ŒEpoch ç”¨äºç®¡ç†å’Œç»„ç»‡éªŒè¯è€…çš„æ´»åŠ¨ã€‚</li><li>ç»„æˆï¼šä¸€ä¸ªEpoch ç”± 32ä¸ª slot ç»„æˆã€‚</li><li>æ—¶é—´é•¿åº¦ï¼šç”±äºä¸€ä¸ªslot æ˜¯12ç§’ï¼Œä¸€ä¸ªEpoch çš„æ€»é•¿åº¦å°±æ˜¯12 * 32&#x3D;384ç§’ï¼ˆ6.4åˆ†é’Ÿï¼‰</li><li>åŠŸèƒ½ï¼šEpoch æ˜¯ç”¨æ¥å®ç°å…±è¯†æœºåˆ¶çš„ä¸€éƒ¨åˆ†ã€‚åœ¨æ¯ä¸ªEpoch ç»“æŸæ—¶ï¼Œç½‘ç»œä¼šè¿›è¡ŒçŠ¶æ€å’Œå…±è¯†çš„æ£€æŸ¥å’Œè°ƒæ•´ï¼ŒåŒ…æ‹¬å¯¹éªŒè¯è€…çš„å¥–åŠ±å’Œæƒ©ç½šã€‚</li></ul><h3 id="Blockï¼ˆåŒºå—ï¼‰"><a href="#Blockï¼ˆåŒºå—ï¼‰" class="headerlink" title="Blockï¼ˆåŒºå—ï¼‰"></a>Blockï¼ˆåŒºå—ï¼‰</h3><ul><li>å®šä¹‰ï¼šBlock åŒºå—ä¸€ä¸ªæ˜¯åŒ…å«äº¤æ˜“å’Œå…¶ä»–æ‰€æœ‰ç›¸å…³æ•°æ®çš„è®°å½•å•å…ƒã€‚æ‰€æœ‰çš„æ•°æ®éƒ½ä¼šåŒ…åœ¨è¿™ä¸ªå—ä¸­ï¼Œåœ¨ETH2.0ä¸­ï¼Œæ¯ä¸ª slot å¯èƒ½ä¼šæœ‰ä¸€ä¸ªåŒºå—è¢«æè®®ï¼Œåªæ˜¯æè®®ï¼Œä½†ä¸èƒ½ä¿è¯æ¯ä¸ª slot éƒ½æœ‰åŒºå—çš„ã€‚</li><li>å†…å®¹ï¼šä¸€ä¸ªåŒºå—åŒ…å«<code>åŒºå—å¤´</code>ã€<code>äº¤æ˜“åˆ—è¡¨</code>ã€<code>çŠ¶æ€æ ¹å“ˆå¸Œ</code>ã€<code>ç­¾å</code>ç­‰æ•°æ®ã€‚</li><li>åˆ›å»ºè¿‡ç¨‹ï¼šåœ¨æ¯ä¸ªslot <code>å¼€å§‹</code>æ—¶ï¼Œç½‘ç»œä¼šéšæœºé€‰å‡ºä¸€ä¸ª<code>éªŒè¯è€…</code>æ¥<code>æè®®</code>åŒºå—ã€‚è¯¥éªŒè¯è€…å°†åˆ›å»ºä¸€ä¸ªåŒ…å«æ–°äº¤æ˜“å’Œå…¶ä»–å¿…è¦ä¿¡æ¯çš„åŒºå—ï¼Œå¹¶å¹¿æ’­åˆ°å…¨ç½‘ç»œä¸Šã€‚</li></ul><h3 id="Safe-ï¼ˆå®‰å…¨ï¼‰"><a href="#Safe-ï¼ˆå®‰å…¨ï¼‰" class="headerlink" title="Safe ï¼ˆå®‰å…¨ï¼‰"></a>Safe ï¼ˆå®‰å…¨ï¼‰</h3><p><code>â€œSafeâ€</code>çŠ¶æ€æŒ‡çš„æ˜¯ä¸€ä¸ªåŒºå—å·²ç»è¢«<strong>å¤šæ•°éªŒè¯è€…æ¥å—å’Œè®¤å¯</strong>ï¼Œå¹¶ä¸”ä»–<strong>å¾ˆå¯èƒ½</strong>ä¼šæˆä¸ºæœ€ç»ˆçš„åŒºå—ï¼Œä½†è¿˜<strong>æ²¡æœ‰è¾¾åˆ°</strong>å®Œå…¨æœ€ç»ˆç¡®å®šçš„çŠ¶æ€ã€‚</p><ul><li>æ¡ä»¶ï¼šä¸€ä¸ªåŒºå—åœ¨è¢«è®¤ä¸ºæ˜¯â€œsafeâ€æ—¶ï¼Œæ„å‘³ç€å®ƒå·²ç»æ”¶åˆ°äº†è¶³å¤Ÿå¤šçš„éªŒè¯è€…æŠ•ç¥¨ï¼ˆattestationsï¼‰ï¼Œé€šå¸¸è¶…è¿‡äº†ä¸€ä¸ªç‰¹å®šçš„é˜ˆå€¼ï¼Œä½†è¿˜æ²¡æœ‰è¾¾åˆ°æœ€ç»ˆç¡®å®šçš„æ ‡å‡†ã€‚</li><li>å®‰å…¨æ€§ï¼šåœ¨â€œsafeâ€çŠ¶æ€ä¸‹ï¼ŒåŒºå—çš„å­˜åœ¨æ˜¯ç›¸å¯¹å®‰å…¨çš„ï¼Œä¸å¤ªå¯èƒ½è¢«å›æ»šæˆ–è€…è¢«å¦ä¸€ä¸ªä¸åŒçš„åŒºå—é“¾åˆ†æ”¯æ‰€æ›¿ä»£ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸å¤ªå¯èƒ½æè®®äº†å¦ä¸€ä¸ªåŒºå—ã€‚</li><li>ä½œç”¨ï¼šè¿™ä¸ªçŠ¶æ€ç”¨æ¥æé«˜ç½‘ç»œå¯¹åŒºå—çš„ä¿¡ä»»åº¦ï¼Œå³æ˜¯åœ¨å®ƒè¿˜æ²¡æœ‰è¢«å®Œå…¨æœ€ç»ˆç¡®å®šä¹‹å‰ã€‚å®ƒå¸®åŠ©èŠ‚ç‚¹å’Œç”¨æˆ·åˆ¤æ–­å“ªäº›åŒºå—åœ¨çŸ­æœŸå†…æ˜¯å¯ä¿¡çš„ï¼Œä¸€ä¸ªä¸­é—´çŠ¶æ€</li></ul><p>Finalizedï¼ˆæœ€ç»ˆç¡®å®šï¼‰</p><p>â€œFinalizedâ€çŠ¶æ€æŒ‡çš„æ˜¯ä¸€ä¸ªåŒºå—å·²ç»è¢«æ°¸ä¹…åœ°æ·»åŠ åˆ°åŒºå—é“¾ä¸­ï¼Œå¹¶ä¸”ä¸å¯èƒ½è¢«å›æ»šæˆ–æ›¿ä»£ã€‚è¿™æ˜¯åŒºå—é“¾ä¸­æœ€å¼ºçš„ç¡®è®¤çŠ¶æ€ã€‚</p><ul><li>æ¡ä»¶ï¼šä¸€ä¸ªåŒºå—è¢«è®¤ä¸ºæ˜¯â€œfinalizedâ€æ—¶ï¼Œå¿…é¡»é€šè¿‡äº†ä¸¥æ ¼çš„å…±è¯†éªŒè¯ï¼Œé€šå¸¸éœ€è¦è¶…è¿‡2&#x2F;3çš„éªŒè¯è€…æŠ•ç¥¨åŒæ„ã€‚å…·ä½“æ¥è¯´ä¸¤ä¸ªè”ç³»çš„epochè¢«æœ€ç»ˆç¡®å®šæ—¶ï¼Œæ„å‘³ç€åœ¨è¿™ä¸¤ä¸ªepochä¹‹é—´çš„æ‰€æœ‰åŒºå—éƒ½è¢«æœ€ç»ˆç¡®å®šã€‚</li><li>å®‰å…¨æ€§ï¼šä¸€æ—¦åŒºå—è¾¾åˆ°â€œfinalizedâ€çš„çŠ¶æ€ï¼Œå®ƒå°±ä¸å¯é€†è½¬ï¼Œä¿è¯äº†åŒºå—é“¾çš„æœ€ç»ˆä¸€è‡´æ€§å’Œæ•°æ®çš„æ°¸ä¹…æ€§ã€‚è¿™ç§çŠ¶æ€é˜²æ²»äº†åˆ†å‰å’ŒåŒèŠ±æ”»å‡»çš„å¯èƒ½æ€§ã€‚</li><li>ä½œç”¨ï¼šæœ€ç»ˆç¡®å®šçš„åŒºå—ä¸ºç”¨æˆ·å’Œåº”ç”¨æä¾›äº†æœ€é«˜çº§åˆ«çš„äº¤æ˜“å®‰å…¨æ€§å’Œç½‘ç»œä¿¡ä»»åº¦ã€‚</li></ul><h3 id="1-4-ä»¥å¤ªåŠé’±åŒ…ç¡®è®¤ä½"><a href="#1-4-ä»¥å¤ªåŠé’±åŒ…ç¡®è®¤ä½" class="headerlink" title="1.4 ä»¥å¤ªåŠé’±åŒ…ç¡®è®¤ä½"></a>1.4 ä»¥å¤ªåŠé’±åŒ…ç¡®è®¤ä½</h3><p><img src="/img/web3/finalized.png" alt="finalized"></p><p>æœ€ç»ˆç¡®è®¤ä½ä¹‹å‰çš„äº¤æ˜“ä¼šè¢«å¹¶å…¥ç³»ç»Ÿ</p><h1 id="2-ç¦»çº¿åœ°å€ç”Ÿæˆ"><a href="#2-ç¦»çº¿åœ°å€ç”Ÿæˆ" class="headerlink" title="2.ç¦»çº¿åœ°å€ç”Ÿæˆ"></a>2.ç¦»çº¿åœ°å€ç”Ÿæˆ</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;encoding/hex&quot;</span><br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;github.com/ethereum/go-ethereum/crypto&quot;</span><br><span class="hljs-string">&quot;github.com/tyler-smith/go-bip32&quot;</span><br><span class="hljs-string">&quot;github.com/tyler-smith/go-bip39&quot;</span><br>)<br><br><span class="hljs-comment">// ç”Ÿæˆä¸€ä¸ªä»¥å¤ªåŠçš„é’±åŒ…</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;å¼€å§‹&quot;</span>)<br><span class="hljs-comment">// é¦–å…ˆä½ å¯ä»¥ç”Ÿæˆä¸€ä¸ªéšæœºç†µï¼Œç†µæºåŠ©è®°è¯æ˜¯BIP-39ï¼Œ</span><br>entropy, _ := bip39.NewEntropy(<span class="hljs-number">128</span>)<br>fmt.Println(<span class="hljs-string">&quot;entroy:&quot;</span>, entropy)<br><span class="hljs-comment">// é€šè¿‡ç†µæºç”ŸæˆåŠ©è®°è¯  ==&gt; æ³¨æ„ï¼Œä¸ä¸€å®šè¦æœ‰åŠ©è®°è¯æ‰æœ‰ç§å­ï¼Œåªæ˜¯åŠ©è®°è¯æ–¹ä¾¿å¤‡ä»½ï¼Œå¯ä»¥è½¬æˆç§å­ï¼Œä½ è¦ç›´æ¥ç”±ç§å­ä¹Ÿè¡Œï¼Œä½†ä¸å¥½è®°</span><br>mnemonic, _ := bip39.NewMnemonic(entropy)<br>fmt.Println(<span class="hljs-string">&quot;mnemonic:&quot;</span>, mnemonic)<br><span class="hljs-comment">// é€šè¿‡åŠ©è®°è¯ç”Ÿæˆç§å­Seed</span><br>seed := bip39.NewSeed(mnemonic, <span class="hljs-string">&quot;&quot;</span>) <span class="hljs-comment">// passwordç›å€¼ä¸è¦åŠ </span><br>fmt.Println(<span class="hljs-string">&quot;seed&quot;</span>, seed)<br><br><span class="hljs-comment">// æ¥ä¸‹æ¥å°±æ˜¯å°†ç§å­æ¢å¤å‡ºä¸»ç§é’¥ masterKey è¿™é‡Œè¿›å…¥åˆ°äº†BIP-32äº† a</span><br>masterKey, _ := bip32.NewMasterKey(seed)<br><span class="hljs-comment">// æ³¨æ„ï¼Œæ­¤æ—¶è¿˜æ˜¯ä¸»ç§é’¥ï¼Œæ¥ä¸‹æ¥è¦æ´¾ç”Ÿå­ç§é’¥ï¼Œæ´¾ç”Ÿå‡ºæ¥çš„å­ç§é’¥æ‰æ˜¯çœŸæ­£çš„â€œç§é’¥â€æ‰èƒ½å¯¹åº”é“¾çš„å…¬é’¥ï¼Œæ‰èƒ½è§£å‹ç¼©å‡ºåœ°å€</span><br>fmt.Println(<span class="hljs-string">&quot;masterKey&quot;</span>, masterKey)<br><br><span class="hljs-comment">// ç°åœ¨è¦æ´¾ç”Ÿå‡ºå¯¹åº”ä»¥å¤ªåŠçš„å­ç§é’¥ï¼Œéµå¾ªBIP-44</span><br><span class="hljs-comment">// æ¥ä¸‹æ¥è¿›å…¥BIP-44 å®Œæˆæ´¾ç”Ÿ,å®Œæˆå¯¹åº”pathå‚æ•° m / purpose&#x27; / coin_type&#x27; / account&#x27; / change / address_index</span><br><span class="hljs-comment">// é€šè¿‡ä¸»ç§é’¥æ´¾ç”Ÿå‡ºå­ç§é’¥,FirstHardenedChild = uint32(0x80000000) æ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œå¯¹åº”å¼ºåŒ–æ´¾ç”ŸèŒƒå›´</span><br>key, _ := masterKey.NewChildKey(bip32.FirstHardenedChild + <span class="hljs-number">44</span>)  <span class="hljs-comment">// purpose&#x27; ï¼š 44 æ˜¯å›ºå®šå€¼ï¼Œå³BIP-44æ ‡å‡†ï¼Œå¼ºåŒ–æ´¾ç”Ÿ</span><br>key, _ = key.NewChildKey(bip32.FirstHardenedChild + <span class="hljs-type">uint32</span>(<span class="hljs-number">60</span>)) <span class="hljs-comment">// coin_type&#x27; ï¼š60æ˜¯ä»¥å¤ªåŠæ ‡è¯†&#x27;ï¼Œ ç»§ç»­å¼ºåŒ–æ´¾ç”Ÿ</span><br>key, _ = key.NewChildKey(bip32.FirstHardenedChild + <span class="hljs-type">uint32</span>(<span class="hljs-number">0</span>))  <span class="hljs-comment">// account&#x27; : 0 æ ‡è®°è´¦æˆ·ç±»å‹ï¼Œä»0å¼€å§‹ï¼Œå¼ºåŒ–æ´¾ç”Ÿ</span><br>key, _ = key.NewChildKey(<span class="hljs-type">uint32</span>(<span class="hljs-number">0</span>))                             <span class="hljs-comment">// change :0 å¤–éƒ¨å¯è§åœ°å€ï¼Œ 1 æ‰¾é›¶åœ°å€ï¼ˆå¤–éƒ¨ä¸å¯è§ï¼‰ï¼Œé€šå¸¸æ˜¯ 0ï¼Œæ™®é€šæ´¾ç”Ÿ</span><br>key, _ = key.NewChildKey(<span class="hljs-type">uint32</span>(<span class="hljs-number">0</span>))                             <span class="hljs-comment">// åœ°å€ç´¢å¼• 0 1 2 3 è¿™æ ·ç´¢å¼•ï¼Œæ™®é€šæ´¾ç”Ÿ</span><br><span class="hljs-comment">// æ´¾ç”Ÿå®Œæ¯•ï¼Œå¯¹åº”çš„path å°±æ˜¯ &quot; m/44&#x27;/60&#x27;/0&#x27;/0/0 &quot;</span><br><br><span class="hljs-comment">// å­ç§é’¥key å·²ç»å‡ºæ¥äº†ï¼Œå…ˆæ‰“å°ç§é’¥ï¼Œkey.Keyå°±æ˜¯ç§é’¥ï¼Œæ³¨æ„è¦è½¬åŒ–è¿›åˆ¶</span><br>ethPrivateKey := hex.EncodeToString(key.Key) <span class="hljs-comment">// ç¼–ç æˆå­—ç¬¦ä¸² , è¿™é‡Œæ‰“å°å‡ºæ¥çš„ç§é’¥å°±å¯ä»¥</span><br>fmt.Println(<span class="hljs-string">&quot;privateKey&quot;</span>, ethPrivateKey)<br><span class="hljs-comment">// å­ç§é’¥ key é‡Œé¢å°±åŒ…å«ä»–å¯¹åº”çš„å…¬é’¥å±æ€§ï¼Œæ‹¿å‡ºæ¥å³å¯,å› ä¸ºå…¬é’¥æ˜¯ç§é’¥æ¤­åœ†æ›²çº¿åŠ å¯†å¾—æ¥çš„ç»“æœ</span><br>ethPublicKey := hex.EncodeToString(key.PublicKey().Key) <span class="hljs-comment">// ç¼–ç æˆå­—ç¬¦ä¸²</span><br>fmt.Println(<span class="hljs-string">&quot;ethPublicKey&quot;</span>, ethPublicKey)<br><br><span class="hljs-comment">// ç°åœ¨æ‹¿åˆ°å…¬é’¥äº†ï¼Œå…ˆå¯¹å…¬é’¥è¿›è¡Œå‹ç¼© keccak256 å‹ç¼©æˆ 32 byte</span><br>compressPubKey, _ := crypto.DecompressPubkey(key.PublicKey().Key)<br>fmt.Println(<span class="hljs-string">&quot;compressPubKey&quot;</span>, compressPubKey)<br><span class="hljs-comment">// å‹ç¼©32å­—èŠ‚åå–æœ€å 20 byte å°±æ˜¯åœ°å€äº†</span><br>ethAddre := crypto.PubkeyToAddress(*compressPubKey).Hex() <span class="hljs-comment">// Hexæ˜¯16è¿›åˆ¶è½¬å­—ç¬¦ä¸²</span><br>fmt.Println(<span class="hljs-string">&quot;ethAddre&quot;</span>, ethAddre)                         <span class="hljs-comment">// ethAddre 0x38B59D6D4ef6A4991926Cf04c7c2092a0E86140F</span><br><br><span class="hljs-comment">// æœ€åæŠŠ ethPrivateKey å¯¼å…¥åˆ° metaMask é‡Œé¢å»éªŒè¯ä¸‹ï¼Œç§é’¥å’Œåœ°å€å¯¹ä¸Šäº†æ²¡</span><br>&#125;<br><br></code></pre></td></tr></table></figure><p>ç”¨pythonå†™ä¸€é</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> bip32utils <span class="hljs-keyword">import</span> BIP32Key<br><span class="hljs-keyword">from</span> bip32utils <span class="hljs-keyword">import</span> BIP32_HARDEN<br><span class="hljs-keyword">from</span> bip39 <span class="hljs-keyword">import</span> Mnemonic<br><span class="hljs-keyword">from</span> ethereum.utils <span class="hljs-keyword">import</span> privtoaddr<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">eth_wallet</span>():<br>    <span class="hljs-comment"># ç”ŸæˆåŠ©è®°è¯å’Œç§å­</span><br>    entropy = Mnemonic().generate_entropy(<span class="hljs-number">128</span>)<br>    mnemonic = Mnemonic().to_mnemonic(entropy)<br>    seed = Mnemonic().to_seed(mnemonic)<br><br>    <span class="hljs-comment"># æ´¾ç”Ÿä¸»ç§é’¥</span><br>    bip32_key = BIP32Key.fromEntropy(seed)<br><br>    <span class="hljs-comment"># æ´¾ç”Ÿä»¥å¤ªåŠå­ç§é’¥</span><br>    path = <span class="hljs-string">&quot;m/44&#x27;/60&#x27;/0&#x27;/0/0&quot;</span><br>    key = bip32_key.ChildKey(<br>        BIP32_HARDEN + <span class="hljs-number">44</span><br>    ).ChildKey(<br>        BIP32_HARDEN + <span class="hljs-number">60</span><br>    ).ChildKey(<br>        BIP32_HARDEN + <span class="hljs-number">0</span><br>    ).ChildKey(<br>        <span class="hljs-number">0</span><br>    ).ChildKey(<br>        <span class="hljs-number">0</span><br>    )<br><br>    <span class="hljs-comment"># è·å–ä»¥å¤ªåŠç§é’¥</span><br>    eth_private_key = key.WalletImportFormat()<br><br>    <span class="hljs-comment"># è·å–ä»¥å¤ªåŠåœ°å€</span><br>    eth_address = privtoaddr(key.PrivateKey().to_string()).<span class="hljs-built_in">hex</span>()<br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;åŠ©è®°è¯:&quot;</span>, mnemonic)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç§é’¥:&quot;</span>, eth_private_key)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;åœ°å€:&quot;</span>, eth_address)<br><br>eth_wallet()<br></code></pre></td></tr></table></figure><h1 id="3-ç¦»çº¿äº¤æ˜“ç­¾å"><a href="#3-ç¦»çº¿äº¤æ˜“ç­¾å" class="headerlink" title="3.ç¦»çº¿äº¤æ˜“ç­¾å"></a>3.ç¦»çº¿äº¤æ˜“ç­¾å</h1><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;context&quot;</span><br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;github.com/ethereum/go-ethereum/common&quot;</span><br><span class="hljs-string">&quot;github.com/ethereum/go-ethereum/core/types&quot;</span><br><span class="hljs-string">&quot;github.com/ethereum/go-ethereum/crypto&quot;</span><br><span class="hljs-string">&quot;github.com/ethereum/go-ethereum/ethclient&quot;</span><br><span class="hljs-string">&quot;log&quot;</span><br><span class="hljs-string">&quot;math/big&quot;</span><br>)<br><br><span class="hljs-keyword">var</span> (<br>PrivateKeyStr = <span class="hljs-string">&quot;c535faxxxxxxxxxxxxxxxxxxxxxxxxx&quot;</span>      <span class="hljs-comment">// goç”Ÿæˆçš„è´¦æˆ· å‘é€å‘ç§é’¥</span><br>fromAddrStr   = <span class="hljs-string">&quot;0xa3856a939A623EdBde8f908037d3F33FceBC5408&quot;</span>                            <span class="hljs-comment">// å¯¹åº”goç”Ÿæˆçš„è´¦æˆ· å‘é€æ–¹åœ°å€</span><br>toAddrStr     = <span class="hljs-string">&quot;0x38B59D6D4ef6A4991926Cf04c7c2092a0E86140F&quot;</span>                            <span class="hljs-comment">// æ¥æ”¶æ–¹åœ°å€</span><br>ethUrl        = <span class="hljs-string">&quot;https://eth-sepolia.g.alchemy.com/v2/fzgfj4QuLlNEyn2LrLZsseBAClGdMnyP&quot;</span> <span class="hljs-comment">//API URL</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><br><span class="hljs-comment">// æŠŠç§é’¥ä¸ªåœ°å€è½¬ç ä¸€ä¸‹</span><br>privateKey, _ := crypto.HexToECDSA(PrivateKeyStr)<br>toAddr := common.HexToAddress(toAddrStr)<br><br><span class="hljs-comment">// æ–°å»ºè¿æ¥ï¼Œè¿ä¸Šä»¥å¤ªåŠ</span><br>client, err := ethclient.Dial(ethUrl)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(err)<br>&#125;<br><br><span class="hljs-comment">// Get the balance of an account ç¬¬0æ­¥ï¼šæŸ¥è¯¢è´¦æˆ·ä½™é¢ï¼Œè¦å…ˆç¡®è®¤è‡ªå·±æœ‰æ²¡æœ‰é’±</span><br>fromAddr := common.HexToAddress(fromAddrStr)<br>balance, err := client.BalanceAt(context.Background(), fromAddr, <span class="hljs-literal">nil</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(err)<br>&#125;<br><br>fmt.Printf(<span class="hljs-string">&quot;Account balance: %d\n&quot;</span>, balance) <span class="hljs-comment">// 1008465873901900000</span><br><br><span class="hljs-comment">// Get the latest known block ç¬¬0æ­¥ï¼šè·å–æœ€æ–°å—é«˜ï¼Œåˆ·æ–°</span><br>block, err := client.BlockByNumber(context.Background(), <span class="hljs-literal">nil</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(err)<br>&#125;<br><br>fmt.Printf(<span class="hljs-string">&quot;Latest block: %d\n&quot;</span>, block.Number().Uint64()) <span class="hljs-comment">//6055020</span><br><br><span class="hljs-comment">// ç”Ÿæˆäº¤æ˜“æ•°æ®,è¿™é‡Œæ³¨æ„fromAddrè¦è½¬æˆ account common.Addresså¯¹è±¡</span><br><br><span class="hljs-comment">// ç¬¬ä¸€æ­¥æ‹¿nonceï¼Œè¿™ä¸ªæ‹¿nonceçš„çš„æ–¹æ³•å·²ç»å°è£…å¥½äº†çš„ï¼Œç›´æ¥ç”¨å°±å¯ï¼Œä¹Ÿå¯ä»¥å»ç½‘ç«™ä¸Šcopy urlä¸‹æ¥å‘è¯·æ±‚ï¼Œä¸è¿‡é‚£æ ·ä¸ä¼˜é›…</span><br>nonce, err := client.PendingNonceAt(context.Background(), fromAddr)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(err)<br>&#125;<br>fmt.Printf(<span class="hljs-string">&quot;nonce: %d\n&quot;</span>, nonce)<br><br><span class="hljs-comment">// æ‹¿åˆ°gasPrice ï¼Œä¹Ÿå¯ä»¥ä¸ç”¨æ‹¿ï¼Œç›´æ¥æŒ‡å®šå°±å¯ä»¥</span><br>gasPriceNow, err := client.SuggestGasPrice(context.Background())<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatalf(<span class="hljs-string">&quot;Failed to retrieve gas price: %v&quot;</span>, err)<br>&#125;<br>fmt.Printf(<span class="hljs-string">&quot;gasPriceNow: %d\n&quot;</span>, gasPriceNow)<br><br>gasPrice := big.NewInt(<span class="hljs-number">2000000000</span>)<br>amount := big.NewInt(<span class="hljs-number">1100000000000000</span>)<br>gasLimit := <span class="hljs-type">uint64</span>(<span class="hljs-number">21208</span>)<br><span class="hljs-comment">//gasPrice := big.NewInt(1000)</span><br>data := []<span class="hljs-type">byte</span>(<span class="hljs-string">&quot;Hello, World!&quot;</span>)<br><br><span class="hljs-comment">// ç¬¬äºŒæ­¥ æ„å»ºäº¤æ˜“å¯¹è±¡ ---&gt; ç”Ÿæˆä¸€ä¸ªæœªç­¾åçš„äº¤æ˜“</span><br>tx := types.NewTx(&amp;types.LegacyTx&#123;<br>Nonce:    nonce,<br>To:       &amp;toAddr,<br>Value:    amount,<br>Gas:      gasLimit,<br>GasPrice: gasPrice,<br>Data:     data,<br>&#125;)<br><br><span class="hljs-comment">// ç¬¬ä¸‰æ­¥ å¯¹äº¤æ˜“è¿›è¡Œç­¾åï¼Œç­¾åå‰å…ˆæ‹¿åˆ°é“¾IDï¼Œå³ä½ è¦ä¸Šçš„é“¾</span><br>chainID, err := client.NetworkID(context.Background()) <span class="hljs-comment">// æ‹¿åˆ°é“¾ID</span><br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(err)<br>&#125;<br>signedTx, err := types.SignTx(tx, types.NewEIP155Signer(chainID), privateKey) <span class="hljs-comment">// å¯¹äº¤æ˜“è¿›è¡Œç­¾å</span><br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(err)<br>&#125;<br><br><span class="hljs-comment">// ç¬¬å››æ­¥  å‘é€äº¤æ˜“,è¿™ä¸€æ­¥å°±æ˜¯å¹¿æ’­</span><br>err = client.SendTransaction(context.Background(), signedTx) <span class="hljs-comment">// å¹¿æ’­å‡ºå»</span><br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(err)<br>&#125;<br><br>fmt.Printf(<span class="hljs-string">&quot;è½¬è´¦äº¤æ˜“å·²å‘é€ï¼Œäº¤æ˜“å“ˆå¸Œ\nï¼š%s\n&quot;</span>, signedTx.Hash().Hex())<br><span class="hljs-comment">// ç¬¬ä¸€ç¬”äº¤æ˜“å“ˆå¸Œï¼š0xb4f9ff541c3423e5bbffbb63f78fed2b384cde60b74b9a3838f05eb172c65e90 ï¼Œ ç¬¬ä¸€æ¬¡å‘äº¤æ˜“çš„æ—¶å€™gasPrice èŠ±è´¹çš„æ¯”è¾ƒä½ï¼Œæ‰€ä»¥ç¬¬äºŒæ¬¡æ”¹äº†gasPriceåå†å‘</span><br><span class="hljs-comment">// å‰é¢çš„ä¸€ç›´åœ¨pendingä¸­ æœ‰ç‚¹é—®é¢˜ï¼Œ</span><br><span class="hljs-comment">// ç¬¬äºŒç¬”äº¤æ˜“å“ˆå¸Œï¼šè½¬è´¦äº¤æ˜“å·²å‘é€ï¼Œäº¤æ˜“å“ˆå¸Œï¼š0xd65407692e1f872d47ce1231a80d9afbf0dbcf8336362f78262d4fd872a55c81</span><br><span class="hljs-comment">// ç¬¬ä¸‰ç¬”äº¤æ˜“å“ˆå¸Œï¼šè½¬è´¦äº¤æ˜“å·²å‘é€ï¼Œäº¤æ˜“å“ˆå¸Œï¼š0xcb297210b49a5a3747c27783ab3610b8b287134792e50ccbf6afe86c6c96edfd</span><br><span class="hljs-comment">// ç¬¬å››ç¬”äº¤æ˜“å“ˆå¸Œï¼šè½¬è´¦äº¤æ˜“å·²å‘é€ï¼Œäº¤æ˜“å“ˆå¸Œï¼š0xc922a93fd5a5eabe7819623a65aa6b572e755658f3a9f24e71a64f3d533b1a87</span><br><span class="hljs-comment">// ç¬¬äº”ç¬”äº¤æ˜“å“ˆå¸Œï¼šè½¬è´¦äº¤æ˜“å·²å‘é€ï¼Œäº¤æ˜“å“ˆå¸Œï¼š0x4a8e649836a69d22e2b979c7330f03b97e7017b4a89d27e9c646051725f89a2c</span><br><span class="hljs-comment">// ç¬¬å…­ç¬”äº¤æ˜“å“ˆå¸Œï¼šè½¬è´¦äº¤æ˜“å·²å‘é€ï¼Œäº¤æ˜“å“ˆå¸Œï¼š0xae0b39c8cb2e02f7c647778f4325f0cca6392fe54c8f144a8e4ae58da79484eb</span><br><span class="hljs-comment">// æ˜¾ç¤ºpending ç„¶åè½¬indexingçŠ¶æ€ æœ€åSuccessæˆåŠŸ</span><br><span class="hljs-comment">// pending çŠ¶æ€ï¼š This txn hash was found in our secondary node and should be picked up by our indexer in a short while.</span><br><span class="hljs-comment">// indexing çŠ¶æ€ï¼šThis transaction has been included and will be reflected in a short while.</span><br><br>&#125;<br><br></code></pre></td></tr></table></figure><h1 id="4-ä»¥å¤ªåŠ-RPC-æ¥å£"><a href="#4-ä»¥å¤ªåŠ-RPC-æ¥å£" class="headerlink" title="4.ä»¥å¤ªåŠ RPC æ¥å£"></a>4.ä»¥å¤ªåŠ RPC æ¥å£</h1><p>è¿™é‡Œåœ¨åšçš„å°±æ˜¯æ‰«é“¾ï¼Œé’±åŒ…éƒ½è¦æ‰«é“¾</p><h3 id="4-1-æ£€æŸ¥ç½‘ç»œçš„-RPC-æ¥å£æ˜¯å¦å¯ä»¥"><a href="#4-1-æ£€æŸ¥ç½‘ç»œçš„-RPC-æ¥å£æ˜¯å¦å¯ä»¥" class="headerlink" title="4.1.æ£€æŸ¥ç½‘ç»œçš„ RPC æ¥å£æ˜¯å¦å¯ä»¥"></a>4.1.æ£€æŸ¥ç½‘ç»œçš„ RPC æ¥å£æ˜¯å¦å¯ä»¥</h3><p>å…ˆè°ƒæ¥å£çœ‹ä¸‹é“¾æ˜¯ä¸æ˜¯å¤„äºæ´»è·ƒçš„çŠ¶æ€ï¼Œå¦‚æœæ˜¯æ‰èƒ½ç»§ç»­ä¸‹å»</p><h3 id="4-2-è·å–æœ€æ–°å—é«˜"><a href="#4-2-è·å–æœ€æ–°å—é«˜" class="headerlink" title="4.2.è·å–æœ€æ–°å—é«˜"></a>4.2.è·å–æœ€æ–°å—é«˜</h3><p>è°ƒeth block numberè·å–åˆ°æœ€æ–°çš„å¿«é«˜æ˜¯å¤š æ¯”å¦‚è¯´å½“å‰æ˜¯ç¬¬101ä¸ªå—</p><h3 id="4-3-æ ¹æ®å—é«˜è·å–å—é‡Œé¢çš„ä¿¡æ¯"><a href="#4-3-æ ¹æ®å—é«˜è·å–å—é‡Œé¢çš„ä¿¡æ¯" class="headerlink" title="4.3.æ ¹æ®å—é«˜è·å–å—é‡Œé¢çš„ä¿¡æ¯"></a>4.3.æ ¹æ®å—é«˜è·å–å—é‡Œé¢çš„ä¿¡æ¯</h3><p>ä»æˆ‘ä¹‹å‰ä¸Šä¸€æ¬¡æ‰«åˆ°çš„å—ï¼ˆæ¯”å¦‚è¯´ç¬¬100ï¼‰åˆ°æˆ‘è¿™ä¸€æ¬¡æ‰«åˆ°çš„å—ï¼ˆç¬¬101ï¼‰ä¹‹é—´ï¼Œæ‰«åˆ°äº¤æ˜“å°±ä¸‹ä¸€æ­¥</p><h3 id="4-4-æ ¹æ®äº¤æ˜“-Hash-è·å–äº¤æ˜“è¯¦æƒ…"><a href="#4-4-æ ¹æ®äº¤æ˜“-Hash-è·å–äº¤æ˜“è¯¦æƒ…" class="headerlink" title="4.4.æ ¹æ®äº¤æ˜“ Hash è·å–äº¤æ˜“è¯¦æƒ…"></a>4.4.æ ¹æ®äº¤æ˜“ Hash è·å–äº¤æ˜“è¯¦æƒ…</h3><p>æ‰«åˆ°äº¤æ˜“ä¹‹åå°±è¦å»è§£æäº¤æ˜“ã€‚ç„¶ååˆ¤æ–­from å’Œto çš„åœ°å€æ˜¯ä»€ä¹ˆåœ°å€ï¼Œæ¥åˆ¤æ–­æ˜¯è½¬å‡ºè¿˜æ˜¯è½¬å…¥æ˜¯å½’é›†è¿˜æ˜¯å†·çƒ­äº’è½¬</p><h3 id="4-5-è·å–äº¤æ˜“çŠ¶æ€"><a href="#4-5-è·å–äº¤æ˜“çŠ¶æ€" class="headerlink" title="4.5.è·å–äº¤æ˜“çŠ¶æ€"></a>4.5.è·å–äº¤æ˜“çŠ¶æ€</h3><p>è§£æäº¤æ˜“å°±æ˜¯è·å–äº¤æ˜“çŠ¶æ€æ˜¯æˆåŠŸçš„å—ï¼Œfail è¿˜æ˜¯ success</p><h3 id="4-6-è·å–ç­¾åéœ€è¦çš„å‚æ•°-Nonce"><a href="#4-6-è·å–ç­¾åéœ€è¦çš„å‚æ•°-Nonce" class="headerlink" title="4.6. è·å–ç­¾åéœ€è¦çš„å‚æ•° Nonce"></a>4.6. è·å–ç­¾åéœ€è¦çš„å‚æ•° Nonce</h3><h3 id="4-7-è·å–ç­¾åéœ€è¦çš„å‚æ•°-Gas"><a href="#4-7-è·å–ç­¾åéœ€è¦çš„å‚æ•°-Gas" class="headerlink" title="4.7. è·å–ç­¾åéœ€è¦çš„å‚æ•° Gas"></a>4.7. è·å–ç­¾åéœ€è¦çš„å‚æ•° Gas</h3><ul><li>è¿™é‡Œå…¶å®ä¸è¦ç”¨ä½ è·å–åˆ°çš„å½“å‰gaspriceï¼Œä½ å¯ä»¥è°ƒé«˜ä¸€ç‚¹ï¼Œæ›´å®¹æ˜“è¢«é“¾ä¸Šå¤„ç†</li></ul><h3 id="4-8-å‘é€äº¤æ˜“åˆ°åŒºå—é“¾ç½‘ç»œ"><a href="#4-8-å‘é€äº¤æ˜“åˆ°åŒºå—é“¾ç½‘ç»œ" class="headerlink" title="4.8. å‘é€äº¤æ˜“åˆ°åŒºå—é“¾ç½‘ç»œ"></a>4.8. å‘é€äº¤æ˜“åˆ°åŒºå—é“¾ç½‘ç»œ</h3><ul><li>è¯·æ±‚å‚æ•°</li><li>è¿”å›å€¼</li></ul><p><img src="/img/web3/%E4%BA%A4%E6%98%93%E6%B5%81%E7%A8%8B%E5%9B%BE.png" alt="äº¤æ˜“æµç¨‹"></p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;context&quot;</span><br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;github.com/ethereum/go-ethereum/common&quot;</span><br><span class="hljs-string">&quot;github.com/ethereum/go-ethereum/core/types&quot;</span><br><span class="hljs-string">&quot;github.com/ethereum/go-ethereum/crypto&quot;</span><br><span class="hljs-string">&quot;github.com/ethereum/go-ethereum/ethclient&quot;</span><br><span class="hljs-string">&quot;log&quot;</span><br><span class="hljs-string">&quot;math/big&quot;</span><br>)<br><br><span class="hljs-keyword">var</span> (<br>PrivateKeyStr = <span class="hljs-string">&quot;c535facd6873ca2b3718e3ede4f626ae126c99b4a26b4354da704d8dc78b43c1&quot;</span>      <span class="hljs-comment">// goç”Ÿæˆçš„è´¦æˆ· å‘é€å‘ç§é’¥</span><br>fromAddrStr   = <span class="hljs-string">&quot;0xa3856a939A623EdBde8f908037d3F33FceBC5408&quot;</span>                            <span class="hljs-comment">// å¯¹åº”goç”Ÿæˆçš„è´¦æˆ· å‘é€æ–¹åœ°å€</span><br>toAddrStr     = <span class="hljs-string">&quot;0x38B59D6D4ef6A4991926Cf04c7c2092a0E86140F&quot;</span>                            <span class="hljs-comment">// æ¥æ”¶æ–¹åœ°å€</span><br>ethUrl        = <span class="hljs-string">&quot;https://eth-sepolia.g.alchemy.com/v2/fzgfj4QuLlNEyn2LrLZsseBAClGdMnyP&quot;</span> <span class="hljs-comment">//API URL</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><br><span class="hljs-comment">// æŠŠç§é’¥ä¸ªåœ°å€è½¬ç ä¸€ä¸‹</span><br>privateKey, _ := crypto.HexToECDSA(PrivateKeyStr)<br>toAddr := common.HexToAddress(toAddrStr)<br><br><span class="hljs-comment">// æ–°å»ºè¿æ¥ï¼Œè¿ä¸Šä»¥å¤ªåŠ</span><br>client, err := ethclient.Dial(ethUrl)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(err)<br>&#125;<br><br><span class="hljs-comment">// Get the balance of an account ç¬¬0æ­¥ï¼šæŸ¥è¯¢è´¦æˆ·ä½™é¢ï¼Œè¦å…ˆç¡®è®¤è‡ªå·±æœ‰æ²¡æœ‰é’±</span><br>fromAddr := common.HexToAddress(fromAddrStr)<br>balance, err := client.BalanceAt(context.Background(), fromAddr, <span class="hljs-literal">nil</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(err)<br>&#125;<br><br>fmt.Printf(<span class="hljs-string">&quot;Account balance: %d\n&quot;</span>, balance) <span class="hljs-comment">// 1008465873901900000</span><br><br><span class="hljs-comment">// Get the latest known block ç¬¬0æ­¥ï¼šè·å–æœ€æ–°å—é«˜ï¼Œåˆ·æ–°</span><br>block, err := client.BlockByNumber(context.Background(), <span class="hljs-literal">nil</span>)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(err)<br>&#125;<br><br>fmt.Printf(<span class="hljs-string">&quot;Latest block: %d\n&quot;</span>, block.Number().Uint64()) <span class="hljs-comment">//6055020</span><br><br><span class="hljs-comment">// ç”Ÿæˆäº¤æ˜“æ•°æ®,è¿™é‡Œæ³¨æ„fromAddrè¦è½¬æˆ account common.Addresså¯¹è±¡</span><br><span class="hljs-comment">// ç¬¬ä¸€æ­¥æ‹¿nonceï¼Œè¿™ä¸ªæ‹¿nonceçš„çš„æ–¹æ³•å·²ç»å°è£…å¥½äº†çš„ï¼Œç›´æ¥ç”¨å°±å¯ï¼Œä¹Ÿå¯ä»¥å»ç½‘ç«™ä¸Šcopy urlä¸‹æ¥å‘è¯·æ±‚ï¼Œä¸è¿‡é‚£æ ·ä¸ä¼˜é›…</span><br>nonce, err := client.PendingNonceAt(context.Background(), fromAddr)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(err)<br>&#125;<br>fmt.Printf(<span class="hljs-string">&quot;nonce: %d\n&quot;</span>, nonce)<br><br><span class="hljs-comment">// æ‹¿åˆ°gasPrice ï¼Œä¹Ÿå¯ä»¥ä¸ç”¨æ‹¿ï¼Œç›´æ¥æŒ‡å®šå°±å¯ä»¥</span><br>gasPriceNow, err := client.SuggestGasPrice(context.Background())<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatalf(<span class="hljs-string">&quot;Failed to retrieve gas price: %v&quot;</span>, err)<br>&#125;<br>fmt.Printf(<span class="hljs-string">&quot;gasPriceNow: %d\n&quot;</span>, gasPriceNow)<br><br>gasPrice := big.NewInt(<span class="hljs-number">2000000000</span>)<br>amount := big.NewInt(<span class="hljs-number">1100000000000000</span>)<br>gasLimit := <span class="hljs-type">uint64</span>(<span class="hljs-number">21208</span>)<br><span class="hljs-comment">//gasPrice := big.NewInt(1000)</span><br>data := []<span class="hljs-type">byte</span>(<span class="hljs-string">&quot;Hello, World!&quot;</span>)<br><br><span class="hljs-comment">// ç¬¬äºŒæ­¥ æ„å»ºäº¤æ˜“å¯¹è±¡ ---&gt; ç”Ÿæˆä¸€ä¸ªæœªç­¾åçš„äº¤æ˜“</span><br>tx := types.NewTx(&amp;types.LegacyTx&#123;<br>Nonce:    nonce,<br>To:       &amp;toAddr,<br>Value:    amount,<br>Gas:      gasLimit,<br>GasPrice: gasPrice,<br>Data:     data,<br>&#125;)<br><br><span class="hljs-comment">// ç¬¬ä¸‰æ­¥ å¯¹äº¤æ˜“è¿›è¡Œç­¾åï¼Œç­¾åå‰å…ˆæ‹¿åˆ°é“¾IDï¼Œå³ä½ è¦ä¸Šçš„é“¾</span><br>chainID, err := client.NetworkID(context.Background()) <span class="hljs-comment">// æ‹¿åˆ°é“¾ID</span><br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(err)<br>&#125;<br>signedTx, err := types.SignTx(tx, types.NewEIP155Signer(chainID), privateKey) <span class="hljs-comment">// å¯¹äº¤æ˜“è¿›è¡Œç­¾å</span><br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(err)<br>&#125;<br><br><span class="hljs-comment">// ç¬¬å››æ­¥  å‘é€äº¤æ˜“,è¿™ä¸€æ­¥å°±æ˜¯å¹¿æ’­</span><br>err = client.SendTransaction(context.Background(), signedTx) <span class="hljs-comment">// å¹¿æ’­å‡ºå»</span><br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatal(err)<br>&#125;<br><br>fmt.Printf(<span class="hljs-string">&quot;è½¬è´¦äº¤æ˜“å·²å‘é€ï¼Œäº¤æ˜“å“ˆå¸Œ\nï¼š%s\n&quot;</span>, signedTx.Hash().Hex())<br><span class="hljs-comment">// ç¬¬ä¸ƒç¬”äº¤æ˜“å“ˆå¸Œï¼šè½¬è´¦äº¤æ˜“å·²å‘é€ï¼Œäº¤æ˜“å“ˆå¸Œï¼š0x93afb74b4c4f0bca6c1ccdf4a13fe555f7a8768201804c0e21ec33b50febec46</span><br><span class="hljs-comment">// ç¬¬å…«ç¬”äº¤æ˜“å“ˆå¸Œï¼šè½¬è´¦äº¤æ˜“å·²å‘é€ï¼Œäº¤æ˜“å“ˆå¸Œï¼š</span><br><span class="hljs-comment">// å‰é¢çš„ä¸€ç›´åœ¨pendingä¸­ æœ‰ç‚¹é—®é¢˜ï¼Œ</span><br><span class="hljs-comment">// ç¬¬å…«ç¬”äº¤æ˜“å“ˆå¸Œï¼šè½¬è´¦äº¤æ˜“å·²å‘é€ï¼Œäº¤æ˜“å“ˆå¸Œï¼š0xd65407692e1f872d47ce1231a80d9afbf0dbcf8336362f78262d4fd872a55c81</span><br><span class="hljs-comment">// ç¬¬å…«ç¬”äº¤æ˜“å“ˆå¸Œï¼šè½¬è´¦äº¤æ˜“å·²å‘é€ï¼Œäº¤æ˜“å“ˆå¸Œï¼š0xcb297210b49a5a3747c27783ab3610b8b287134792e50ccbf6afe86c6c96edfd</span><br><span class="hljs-comment">// ç¬¬å…«ç¬”äº¤æ˜“å“ˆå¸Œï¼šè½¬è´¦äº¤æ˜“å·²å‘é€ï¼Œäº¤æ˜“å“ˆå¸Œï¼š0xc922a93fd5a5eabe7819623a65aa6b572e755658f3a9f24e71a64f3d533b1a87</span><br><span class="hljs-comment">// ç¬¬å…«ç¬”äº¤æ˜“å“ˆå¸Œï¼šè½¬è´¦äº¤æ˜“å·²å‘é€ï¼Œäº¤æ˜“å“ˆå¸Œï¼š0x4a8e649836a69d22e2b979c7330f03b97e7017b4a89d27e9c646051725f89a2c</span><br><span class="hljs-comment">// ç¬¬å…«ç¬”äº¤æ˜“å“ˆå¸Œï¼šè½¬è´¦äº¤æ˜“å·²å‘é€ï¼Œäº¤æ˜“å“ˆå¸Œï¼š0xae0b39c8cb2e02f7c647778f4325f0cca6392fe54c8f144a8e4ae58da79484eb</span><br><span class="hljs-comment">// æ˜¾ç¤ºpending ç„¶åè½¬indexingçŠ¶æ€ æœ€åSuccessæˆåŠŸ</span><br><span class="hljs-comment">// pending çŠ¶æ€ï¼š This txn hash was found in our secondary node and should be picked up by our indexer in a short while.</span><br><span class="hljs-comment">// indexing çŠ¶æ€ï¼šThis transaction has been included and will be reflected in a short while.</span><br><br>&#125;<br><br></code></pre></td></tr></table></figure><h3 id="Pythonä»£ç å®ç°"><a href="#Pythonä»£ç å®ç°" class="headerlink" title="Pythonä»£ç å®ç°"></a>Pythonä»£ç å®ç°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> web3 <span class="hljs-keyword">import</span> Web3<br><span class="hljs-keyword">import</span> json<br><br><span class="hljs-comment"># è®¾ç½®è¿æ¥å’Œè´¦æˆ·ä¿¡æ¯</span><br>private_key = <span class="hljs-string">&quot;c535facd68xxxxxxxxxxx26ae126c99bda704d8dc78b43c1&quot;</span>  <span class="hljs-comment"># å‘é€æ–¹ç§é’¥</span><br>from_address = <span class="hljs-string">&quot;0xa3856a9xxxxxxxxe8f90835408&quot;</span>                     <span class="hljs-comment"># å‘é€æ–¹åœ°å€</span><br>to_address = <span class="hljs-string">&quot;0x38B59D6Dxxxxxxxx6Cf04c786140F&quot;</span>                    <span class="hljs-comment"># æ¥æ”¶æ–¹åœ°å€</span><br>eth_url = <span class="hljs-string">&quot;https://eth-sepolia.g.alchemy.com/v2/fzgfj4QuLlNEyn2LrLZsseBAClGdMnyP&quot;</span> <span class="hljs-comment"># API URL</span><br><br><span class="hljs-comment"># è¿æ¥åˆ°ä»¥å¤ªåŠèŠ‚ç‚¹</span><br>web3 = Web3(Web3.HTTPProvider(eth_url))<br><span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> web3.is_connected():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Failed to connect to Ethereum node.&quot;</span>)<br>    exit()<br><br><span class="hljs-comment"># æ£€æŸ¥è´¦æˆ·ä½™é¢</span><br>balance = web3.eth.get_balance(from_address)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Account balance: <span class="hljs-subst">&#123;web3.from_wei(balance, <span class="hljs-string">&#x27;ether&#x27;</span>)&#125;</span> ETH&quot;</span>)<br><br><span class="hljs-comment"># è·å–æœ€æ–°åŒºå—å·</span><br>block = web3.eth.get_block(<span class="hljs-string">&#x27;latest&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Latest block: <span class="hljs-subst">&#123;block.number&#125;</span>&quot;</span>)<br><br><span class="hljs-comment"># è·å–äº¤æ˜“è®¡æ•° (nonce) è¿™ä¸ªæ‰æ˜¯å…³é”®</span><br>nonce = web3.eth.get_transaction_count(from_address)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Nonce: <span class="hljs-subst">&#123;nonce&#125;</span>&quot;</span>)<br><br><span class="hljs-comment"># å»ºè®®çš„ gas ä»·æ ¼ å¯ä»¥ä¸æ¥å—å»ºè®®</span><br>gas_price = web3.eth.gas_price<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Gas price: <span class="hljs-subst">&#123;web3.from_wei(gas_price, <span class="hljs-string">&#x27;gwei&#x27;</span>)&#125;</span> Gwei&quot;</span>)<br><br><span class="hljs-comment"># åˆ›å»ºäº¤æ˜“</span><br>transaction = &#123;<br>    <span class="hljs-string">&#x27;to&#x27;</span>: to_address,<br>    <span class="hljs-comment"># &#x27;value&#x27;: web3.toWei(0.0011, &#x27;ether&#x27;),  # å‘é€çš„ä»¥å¤ªå¸æ•°é‡</span><br>    <span class="hljs-string">&#x27;value&#x27;</span>: <span class="hljs-number">1100000000000000</span>,  <span class="hljs-comment"># å‘é€çš„ä»¥å¤ªå¸æ•°é‡</span><br>    <span class="hljs-string">&#x27;gas&#x27;</span>: <span class="hljs-number">21320</span>,  <span class="hljs-comment"># Gas limit</span><br>    <span class="hljs-string">&#x27;gasPrice&#x27;</span>: <span class="hljs-number">2000000000</span>,  <span class="hljs-comment"># Gas price</span><br>    <span class="hljs-string">&#x27;nonce&#x27;</span>: nonce,<br>    <span class="hljs-string">&#x27;data&#x27;</span>: web3.to_hex(<span class="hljs-string">b&quot;Hello, World! python&quot;</span>),  <span class="hljs-comment"># é™„åŠ çš„æ•°æ®</span><br>    <span class="hljs-string">&#x27;chainId&#x27;</span>: web3.eth.chain_id  <span class="hljs-comment"># é“¾ ID</span><br>&#125;<br><br><span class="hljs-comment"># å¯¹äº¤æ˜“è¿›è¡Œç­¾å</span><br>signed_tx = web3.eth.account.sign_transaction(transaction, private_key)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Transaction hash: <span class="hljs-subst">&#123;signed_tx.<span class="hljs-built_in">hash</span>.<span class="hljs-built_in">hex</span>()&#125;</span>&quot;</span>)<br><br><span class="hljs-comment"># å‘é€äº¤æ˜“</span><br>tx_hash = web3.eth.send_raw_transaction(signed_tx.rawTransaction)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Transaction sent, hash: <span class="hljs-subst">&#123;tx_hash.<span class="hljs-built_in">hex</span>()&#125;</span>&quot;</span>)<br><span class="hljs-comment"># ç¬¬ä¸€ç¬”äº¤æ˜“ï¼š0x22af000c45f51c03e88ea21281ccd571359e653341aef2a7fadbdc96b41eee49</span><br><span class="hljs-comment"># ç¬¬äºŒç¬”äº¤æ˜“ï¼š0xa502a7a7f589555eb0ce9bbd2d48220c860bbd0b7bf33b97819932ac0b092d6e</span><br><span class="hljs-comment"># ç¬¬ä¸‰ç¬”äº¤æ˜“ï¼š0x775b97666b65444f2bb1b2bad852dbb9b56020fdbab513336cdec46bad1c2a36</span><br><br></code></pre></td></tr></table></figure><h1 id="5-ä¸­å¿ƒåŒ–é’±åŒ…"><a href="#5-ä¸­å¿ƒåŒ–é’±åŒ…" class="headerlink" title="5.ä¸­å¿ƒåŒ–é’±åŒ…"></a>5.ä¸­å¿ƒåŒ–é’±åŒ…</h1><h3 id="5-1-ç¦»çº¿åœ°å€ç”Ÿæˆ"><a href="#5-1-ç¦»çº¿åœ°å€ç”Ÿæˆ" class="headerlink" title="5.1 ç¦»çº¿åœ°å€ç”Ÿæˆ"></a>5.1 ç¦»çº¿åœ°å€ç”Ÿæˆ</h3><ul><li><p>è°ƒç”¨ç­¾åæœºç”Ÿæˆå¯†é’¥å¯¹ï¼Œç­¾åæœºåå‡ºå…¬é’¥ï¼Œï¼ˆäº¤æ˜“æ‰€é’±åŒ…ç§é’¥è¢«ç»Ÿä¸€ç®¡æ§ï¼‰</p></li><li><p>æ‹¿åˆ°å…¬é’¥å°±å¯ä»¥ä½¿ç”¨å…¬é’¥å¯¼å‡ºåœ°å€äº†</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>blockChain</category>
      
    </categories>
    
    
    <tags>
      
      <tag>block</tag>
      
      <tag>æ¦‚å¿µ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>07-1 Bitcoin é’±åŒ…å¼€å‘ç®€å•æµç¨‹</title>
    <link href="/2024/05/30/07-1%E6%AF%94%E7%89%B9%E5%B8%81%E9%92%B1%E5%8C%85%E5%BC%80%E5%8F%91%E7%AE%80%E5%8D%95%E6%B5%81%E7%A8%8B/"/>
    <url>/2024/05/30/07-1%E6%AF%94%E7%89%B9%E5%B8%81%E9%92%B1%E5%8C%85%E5%BC%80%E5%8F%91%E7%AE%80%E5%8D%95%E6%B5%81%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<h1 id="1-æ¯”ç‰¹å¸é’±åŒ…å¼€å‘"><a href="#1-æ¯”ç‰¹å¸é’±åŒ…å¼€å‘" class="headerlink" title="1 æ¯”ç‰¹å¸é’±åŒ…å¼€å‘"></a>1 æ¯”ç‰¹å¸é’±åŒ…å¼€å‘</h1><blockquote><p>å› ä¸ºæ˜¯JSä»£ç ï¼Œæ‰€ä»¥ä¼šæœ‰å¾ˆå¤šçœ‹ä¸æ‡‚çš„åœ°æ–¹ï¼Œæ²¡å…³ç³»</p></blockquote><h2 id="1-1-åœ°å€ç”Ÿæˆ"><a href="#1-1-åœ°å€ç”Ÿæˆ" class="headerlink" title="1.1 åœ°å€ç”Ÿæˆ"></a>1.1 åœ°å€ç”Ÿæˆ</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> bitcoin <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;bitcoinjs-lib&#x27;</span>;<br><span class="hljs-keyword">import</span> * <span class="hljs-keyword">as</span> ecc <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;tiny-secp256k1&#x27;</span>;<br><span class="hljs-keyword">const</span> &#123; <span class="hljs-title class_">BIP32Factory</span> &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;bip32&#x27;</span>);<br><span class="hljs-keyword">const</span> bip32 = <span class="hljs-title class_">BIP32Factory</span>(ecc); <span class="hljs-comment">// è¿™é‡Œè¿˜æ˜¯bip32</span><br><br><span class="hljs-comment">// åˆ›å»ºåœ°å€çš„å‡½æ•°ï¼Œå’Œpyæ˜¯ä¸€æ ·çš„æµç¨‹ï¼Œéƒ½æ˜¯è°ƒç”¨bip32é‡Œé¢çš„æ–¹æ³•ï¼Œçœ‹å‡½æ•°è¿”å›</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createAddress</span> (<span class="hljs-attr">params</span>: any): any &#123;<br>  <span class="hljs-keyword">const</span> &#123; seedHex, receiveOrChange, addressIndex, network, method &#125; = params;<br>  <span class="hljs-keyword">const</span> root = bip32.<span class="hljs-title function_">fromSeed</span>(<span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>(seedHex, <span class="hljs-string">&#x27;hex&#x27;</span>));<br>  <span class="hljs-keyword">let</span> path = <span class="hljs-string">&quot;m/44&#x27;/0&#x27;/0&#x27;/0/&quot;</span> + addressIndex + <span class="hljs-string">&#x27;&#x27;</span>;<br>  <span class="hljs-keyword">if</span> (receiveOrChange === <span class="hljs-string">&#x27;1&#x27;</span>) &#123;<br>    path = <span class="hljs-string">&quot;m/44&#x27;/0&#x27;/0&#x27;/1/&quot;</span> + addressIndex + <span class="hljs-string">&#x27;&#x27;</span>;<br>  &#125;<br>  <span class="hljs-keyword">const</span> child = root.<span class="hljs-title function_">derivePath</span>(path);<br>  <span class="hljs-keyword">let</span> <span class="hljs-attr">address</span>: string;<br>  <span class="hljs-keyword">switch</span> (method) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;p2pkh&#x27;</span>:<br>      <span class="hljs-comment">// eslint-disable-next-line no-case-declarations</span><br>      <span class="hljs-keyword">const</span> p2pkhAddress = bitcoin.<span class="hljs-property">payments</span>.<span class="hljs-title function_">p2pkh</span>(&#123;<br>        <span class="hljs-attr">pubkey</span>: child.<span class="hljs-property">publicKey</span>,<br>        <span class="hljs-attr">network</span>: bitcoin.<span class="hljs-property">networks</span>[network]<br>      &#125;);<br>      address = p2pkhAddress.<span class="hljs-property">address</span>;<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;p2wpkh&#x27;</span>:<br>      <span class="hljs-comment">// eslint-disable-next-line no-case-declarations</span><br>      <span class="hljs-keyword">const</span> p2wpkhAddress = bitcoin.<span class="hljs-property">payments</span>.<span class="hljs-title function_">p2wpkh</span>(&#123;<br>        <span class="hljs-attr">pubkey</span>: child.<span class="hljs-property">publicKey</span>,<br>        <span class="hljs-attr">network</span>: bitcoin.<span class="hljs-property">networks</span>[network]<br>      &#125;);<br>      address = p2wpkhAddress.<span class="hljs-property">address</span>;<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;p2sh&#x27;</span>:<br>      <span class="hljs-comment">// eslint-disable-next-line no-case-declarations</span><br>      <span class="hljs-keyword">const</span> p2shAddress = bitcoin.<span class="hljs-property">payments</span>.<span class="hljs-title function_">p2sh</span>(&#123;<br>        <span class="hljs-attr">redeem</span>: bitcoin.<span class="hljs-property">payments</span>.<span class="hljs-title function_">p2wpkh</span>(&#123;<br>          <span class="hljs-attr">pubkey</span>: child.<span class="hljs-property">publicKey</span>,<br>          <span class="hljs-attr">network</span>: bitcoin.<span class="hljs-property">networks</span>[network]<br>        &#125;)<br>      &#125;);<br>      address = p2shAddress.<span class="hljs-property">address</span>;<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-attr">default</span>:<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;This way can not support&#x27;</span>);<br>  &#125;<br><span class="hljs-comment">// çœ‹è¿”å›ï¼Œç§é’¥ã€å…¬é’¥ã€å’Œåœ°å€</span><br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-attr">privateKey</span>: <span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>(child.<span class="hljs-property">privateKey</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-string">&#x27;hex&#x27;</span>),<br>    <span class="hljs-attr">publicKey</span>: <span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>(child.<span class="hljs-property">publicKey</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-string">&#x27;hex&#x27;</span>),<br>    address<br>  &#125;;<br>&#125;<br><span class="hljs-comment">// åˆ›å»ºå¤šé‡ç­¾ååœ°å€</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createMultiSignAddress</span> (<span class="hljs-attr">params</span>: any): string &#123;<br>  <span class="hljs-keyword">const</span> &#123; pubkeys, network, method, threshold &#125; = params;<br>  <span class="hljs-keyword">switch</span> (method) &#123;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;p2pkh&#x27;</span>:<br>      <span class="hljs-keyword">return</span> bitcoin.<span class="hljs-property">payments</span>.<span class="hljs-title function_">p2sh</span>(&#123;<br>        <span class="hljs-attr">redeem</span>: bitcoin.<span class="hljs-property">payments</span>.<span class="hljs-title function_">p2ms</span>(&#123;<br>          <span class="hljs-attr">m</span>: threshold,<br>          <span class="hljs-attr">network</span>: bitcoin.<span class="hljs-property">networks</span>[network],<br>          pubkeys<br>        &#125;)<br>      &#125;).<span class="hljs-property">address</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;p2wpkh&#x27;</span>:<br>      <span class="hljs-keyword">return</span> bitcoin.<span class="hljs-property">payments</span>.<span class="hljs-title function_">p2wsh</span>(&#123;<br>        <span class="hljs-attr">redeem</span>: bitcoin.<span class="hljs-property">payments</span>.<span class="hljs-title function_">p2ms</span>(&#123;<br>          <span class="hljs-attr">m</span>: threshold,<br>          <span class="hljs-attr">network</span>: bitcoin.<span class="hljs-property">networks</span>[network],<br>          pubkeys<br>        &#125;)<br>      &#125;).<span class="hljs-property">address</span>;<br>    <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;p2sh&#x27;</span>:<br>      <span class="hljs-keyword">return</span> bitcoin.<span class="hljs-property">payments</span>.<span class="hljs-title function_">p2sh</span>(&#123;<br>        <span class="hljs-attr">redeem</span>: bitcoin.<span class="hljs-property">payments</span>.<span class="hljs-title function_">p2wsh</span>(&#123;<br>          <span class="hljs-attr">redeem</span>: bitcoin.<span class="hljs-property">payments</span>.<span class="hljs-title function_">p2ms</span>(&#123;<br>            <span class="hljs-attr">m</span>: threshold,<br>            <span class="hljs-attr">network</span>: bitcoin.<span class="hljs-property">networks</span>[network],<br>            pubkeys<br>          &#125;)<br>        &#125;)<br>      &#125;).<span class="hljs-property">address</span>;<br>    <span class="hljs-attr">default</span>:<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;This way can not support&#x27;</span>);<br>      <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;0x00&#x27;</span>;<br>  &#125;<br>&#125;<br><span class="hljs-comment">// åˆ›å»ºSchnorr åœ°å€</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createSchnorrAddress</span> (<span class="hljs-attr">params</span>: any): any &#123;<br>  bitcoin.<span class="hljs-title function_">initEccLib</span>(ecc);<br><br>  <span class="hljs-keyword">const</span> &#123; seedHex, receiveOrChange, addressIndex &#125; = params;<br>  <span class="hljs-keyword">const</span> root = bip32.<span class="hljs-title function_">fromSeed</span>(<span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>(seedHex, <span class="hljs-string">&#x27;hex&#x27;</span>));<br>  <span class="hljs-keyword">let</span> path = <span class="hljs-string">&quot;m/44&#x27;/0&#x27;/0&#x27;/0/&quot;</span> + addressIndex + <span class="hljs-string">&#x27;&#x27;</span>;<br>  <span class="hljs-keyword">if</span> (receiveOrChange === <span class="hljs-string">&#x27;1&#x27;</span>) &#123;<br>    path = <span class="hljs-string">&quot;m/44&#x27;/0&#x27;/0&#x27;/1/&quot;</span> + addressIndex + <span class="hljs-string">&#x27;&#x27;</span>;<br>  &#125;<br>  <span class="hljs-keyword">const</span> childKey = root.<span class="hljs-title function_">derivePath</span>(path);<br>  <span class="hljs-keyword">const</span> privateKey = childKey.<span class="hljs-property">privateKey</span>;<br>  <span class="hljs-keyword">if</span> (!privateKey) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;No private key found&#x27;</span>);<br><br>  <span class="hljs-keyword">const</span> publicKey = childKey.<span class="hljs-property">publicKey</span>;<br><br>  <span class="hljs-keyword">const</span> tweak = bitcoin.<span class="hljs-property">crypto</span>.<span class="hljs-title function_">taggedHash</span>(<span class="hljs-string">&#x27;TapTweak&#x27;</span>, publicKey.<span class="hljs-title function_">slice</span>(<span class="hljs-number">1</span>, <span class="hljs-number">33</span>));<br>  <span class="hljs-keyword">const</span> tweakedPublicKey = <span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>(publicKey);<br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; ++i) &#123;<br>    tweakedPublicKey[<span class="hljs-number">1</span> + i] ^= tweak[i];<br>  &#125;<br><br>  <span class="hljs-keyword">const</span> &#123; address &#125; = bitcoin.<span class="hljs-property">payments</span>.<span class="hljs-title function_">p2tr</span>(&#123;<br>    <span class="hljs-attr">internalPubkey</span>: tweakedPublicKey.<span class="hljs-title function_">slice</span>(<span class="hljs-number">1</span>, <span class="hljs-number">33</span>)<br>  &#125;);<br><span class="hljs-comment">// è¿”å›ç§é’¥ã€å…¬é’¥ã€å’Œåœ°å€</span><br>  <span class="hljs-keyword">return</span> &#123;<br>    <span class="hljs-attr">privateKey</span>: <span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>(childKey.<span class="hljs-property">privateKey</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-string">&#x27;hex&#x27;</span>),<br>    <span class="hljs-attr">publicKey</span>: <span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>(childKey.<span class="hljs-property">publicKey</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-string">&#x27;hex&#x27;</span>),<br>    address<br>  &#125;;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="1-2-ç¦»çº¿ç­¾å"><a href="#1-2-ç¦»çº¿ç­¾å" class="headerlink" title="1.2 ç¦»çº¿ç­¾å"></a>1.2 ç¦»çº¿ç­¾å</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> ecc = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;tiny-secp256k1&#x27;</span>);<br><span class="hljs-keyword">const</span> &#123; <span class="hljs-title class_">BIP32Factory</span> &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;bip32&#x27;</span>);<br><span class="hljs-title class_">BIP32Factory</span>(ecc);<br><span class="hljs-keyword">const</span> bitcoin = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;bitcoinjs-lib&#x27;</span>);<br><span class="hljs-keyword">const</span> bitcore = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;bitcore-lib&#x27;</span>);<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@returns</span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> <span class="hljs-variable">params</span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-comment">// æ„å»ºç­¾åTx</span><br><span class="hljs-comment">// å®ƒæ¥å—ä¸€ä¸ªå‚æ•° paramsï¼Œå…¶ä¸­åŒ…å« privateKeyï¼ˆç§é’¥ï¼‰ã€signObjï¼ˆç­¾åå¯¹è±¡ï¼‰å’Œ networkï¼ˆç½‘ç»œï¼‰ç­‰å±æ€§</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">buildAndSignTx</span> (<span class="hljs-attr">params</span>: &#123; <span class="hljs-attr">privateKey</span>: string; <span class="hljs-attr">signObj</span>: any; <span class="hljs-attr">network</span>: string; &#125;): string &#123;<br>  <span class="hljs-keyword">const</span> &#123; privateKey, signObj, network &#125; = params;<br>  <span class="hljs-keyword">const</span> net = bitcore.<span class="hljs-property">Networks</span>[network];<br>  <span class="hljs-keyword">const</span> inputs = signObj.<span class="hljs-property">inputs</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">input</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> &#123;<br>      <span class="hljs-attr">address</span>: input.<span class="hljs-property">address</span>,<br>      <span class="hljs-attr">txId</span>: input.<span class="hljs-property">txid</span>,<br>      <span class="hljs-attr">outputIndex</span>: input.<span class="hljs-property">vout</span>,<br>      <span class="hljs-comment">// eslint-disable-next-line new-cap</span><br>      <span class="hljs-attr">script</span>: <span class="hljs-keyword">new</span> bitcore.<span class="hljs-property">Script</span>.<span class="hljs-title function_">fromAddress</span>(input.<span class="hljs-property">address</span>).<span class="hljs-title function_">toHex</span>(),<br>      <span class="hljs-attr">satoshis</span>: input.<span class="hljs-property">amount</span><br>    &#125;;<br>  &#125;);<br>  <span class="hljs-keyword">const</span> outputs = signObj.<span class="hljs-property">outputs</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">output</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> &#123;<br>      <span class="hljs-attr">address</span>: output.<span class="hljs-property">address</span>,<br>      <span class="hljs-attr">satoshis</span>: output.<span class="hljs-property">amount</span><br>    &#125;;<br>  &#125;);<br>  <span class="hljs-keyword">const</span> transaction = <span class="hljs-keyword">new</span> bitcore.<span class="hljs-title class_">Transaction</span>(net).<span class="hljs-title function_">from</span>(inputs).<span class="hljs-title function_">to</span>(outputs);<br>  transaction.<span class="hljs-property">version</span> = <span class="hljs-number">2</span>;<br>  transaction.<span class="hljs-title function_">sign</span>(privateKey);<br>  <span class="hljs-comment">// è¿”å›äº¤æ˜“ä¿¡æ¯</span><br>  <span class="hljs-keyword">return</span> transaction.<span class="hljs-title function_">toString</span>();<br>&#125;<br><span class="hljs-comment">// æ„å»ºæœªç­¾åæ¶ˆæ¯å¹¶ä¸”ç­¾å</span><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">buildUnsignTxAndSign</span> (params) &#123;<br>  <span class="hljs-keyword">const</span> &#123; keyPair, signObj, network &#125; = params;<br>  <span class="hljs-keyword">const</span> psbt = <span class="hljs-keyword">new</span> bitcoin.<span class="hljs-title class_">Psbt</span>(&#123; network &#125;);<br>  <span class="hljs-keyword">const</span> inputs = signObj.<span class="hljs-property">inputs</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">input</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> &#123;<br>      <span class="hljs-attr">address</span>: input.<span class="hljs-property">address</span>,<br>      <span class="hljs-attr">txId</span>: input.<span class="hljs-property">txid</span>,<br>      <span class="hljs-attr">outputIndex</span>: input.<span class="hljs-property">vout</span>,<br>      <span class="hljs-comment">// eslint-disable-next-line new-cap</span><br>      <span class="hljs-attr">script</span>: <span class="hljs-keyword">new</span> bitcore.<span class="hljs-property">Script</span>.<span class="hljs-title function_">fromAddress</span>(input.<span class="hljs-property">address</span>).<span class="hljs-title function_">toHex</span>(),<br>      <span class="hljs-attr">satoshis</span>: input.<span class="hljs-property">amount</span><br>    &#125;;<br>  &#125;);<br>  psbt.<span class="hljs-title function_">addInput</span>(inputs);<br><br>  <span class="hljs-keyword">const</span> outputs = signObj.<span class="hljs-property">outputs</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">output</span> =&gt;</span> &#123;<br>    <span class="hljs-keyword">return</span> &#123;<br>      <span class="hljs-attr">address</span>: output.<span class="hljs-property">address</span>,<br>      <span class="hljs-attr">satoshis</span>: output.<span class="hljs-property">amount</span><br>    &#125;;<br>  &#125;);<br>  psbt.<span class="hljs-title function_">addOutput</span>(outputs);<span class="hljs-comment">// ä¼ å…¥è¾“å‡ºä¿¡æ¯</span><br>  psbt.<span class="hljs-title function_">toBase64</span>();<br><br>  psbt.<span class="hljs-title function_">signInput</span>(<span class="hljs-number">0</span>, keyPair);<span class="hljs-comment">// ä¼ å…¥keyPairç­¾å</span><br>  psbt.<span class="hljs-title function_">finalizeAllInputs</span>();<br><br>  <span class="hljs-keyword">const</span> signedTransaction = psbt.<span class="hljs-title function_">extractTransaction</span>().<span class="hljs-title function_">toHex</span>();<br>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;signedTransaction==&#x27;</span>, signedTransaction);<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="1-3-æ‰«é“¾æ¥å£-åˆ†åŸç”Ÿå’ŒRosetta-Api"><a href="#1-3-æ‰«é“¾æ¥å£-åˆ†åŸç”Ÿå’ŒRosetta-Api" class="headerlink" title="1.3 æ‰«é“¾æ¥å£(åˆ†åŸç”Ÿå’ŒRosetta Api)"></a>1.3 æ‰«é“¾æ¥å£(åˆ†åŸç”Ÿå’ŒRosetta Api)</h2><h3 id="1-3-1åŸç”ŸBitcoinæ¥å£ã€åŸç”Ÿï¼Œä¸å¸¸ç”¨ã€‘"><a href="#1-3-1åŸç”ŸBitcoinæ¥å£ã€åŸç”Ÿï¼Œä¸å¸¸ç”¨ã€‘" class="headerlink" title="1.3.1åŸç”ŸBitcoinæ¥å£ã€åŸç”Ÿï¼Œä¸å¸¸ç”¨ã€‘"></a>1.3.1åŸç”ŸBitcoinæ¥å£ã€åŸç”Ÿï¼Œä¸å¸¸ç”¨ã€‘</h3><h4 id="1-3-1-1è·å–æ´»è·ƒçš„æœ€æ–°åŒºå—"><a href="#1-3-1-1è·å–æ´»è·ƒçš„æœ€æ–°åŒºå—" class="headerlink" title="1.3.1.1è·å–æ´»è·ƒçš„æœ€æ–°åŒºå—"></a>1.3.1.1è·å–æ´»è·ƒçš„æœ€æ–°åŒºå—</h4><ul><li>è¯·æ±‚å‚æ•°</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl --data-binary &#x27;&#123;&quot;jsonrpc&quot;: &quot;1.0&quot;, &quot;id&quot;: &quot;curltest&quot;, &quot;method&quot;: &quot;getchaintips&quot;, &quot;params&quot;: []&#125;&#x27; -H &#x27;content-type: text/plain;&#x27; https://thrilling-spring-bush.btc.quiknode.pro/c0d9254cfb049224abd0ece400635e62b791a388/<br></code></pre></td></tr></table></figure><ul><li>è¿”å›å†…å®¹</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs shell">&#123;<br>   &quot;result&quot;:[<br>      &#123;<br>         &quot;height&quot;:845198,<br>         &quot;hash&quot;:&quot;00000000000000000000301d584ec5f1c16e89487c05baf035f01875cb763d75&quot;,<br>         &quot;branchlen&quot;:0,<br>         &quot;status&quot;:&quot;active&quot;<br>      &#125;,<br>      &#123;<br>         &quot;height&quot;:841424,<br>         &quot;hash&quot;:&quot;000000000000000000010998fc2714f8ae10ffb73f1986eecc58f5afc457ee07&quot;,<br>         &quot;branchlen&quot;:1,<br>         &quot;status&quot;:&quot;valid-headers&quot;<br>      &#125;,<br>      &#123;<br>         &quot;height&quot;:838792,<br>         &quot;hash&quot;:&quot;00000000000000000002af7214c8796e102b0e9074a5d469266d7afe5af2f087&quot;,<br>         &quot;branchlen&quot;:1,<br>         &quot;status&quot;:&quot;headers-only&quot;<br>      &#125;,<br>      &#123;<br>         &quot;height&quot;:816358,<br>         &quot;hash&quot;:&quot;00000000000000000001d5f92e2dbbfcbc1e859873117e7983dd574857da5e14&quot;,<br>         &quot;branchlen&quot;:1,<br>         &quot;status&quot;:&quot;valid-headers&quot;<br>      &#125;,<br>      &#123;<br>         &quot;height&quot;:815202,<br>         &quot;hash&quot;:&quot;0000000000000000000093917031004a140b6db5c6adec217f814db98d7f0bde&quot;,<br>         &quot;branchlen&quot;:1,<br>         &quot;status&quot;:&quot;valid-fork&quot;<br>      &#125;,<br>   ],<br>   &quot;error&quot;:null,<br>   &quot;id&quot;:&quot;curltest&quot;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>â€œinvalidâ€ è¯¥åˆ†æ”¯è‡³å°‘åŒ…å«ä¸€ä¸ªæ— æ•ˆå—</li><li>â€œheaders-onlyâ€ å¹¶éè¯¥åˆ†æ”¯çš„æ‰€æœ‰å—éƒ½å¯ç”¨ï¼Œä½† headers æœ‰æ•ˆ</li><li>â€œvalid-headersâ€æ‰€æœ‰å—éƒ½å¯ç”¨äºæ­¤åˆ†æ”¯ï¼Œä½†å®ƒä»¬ä»æœªç»è¿‡å®Œå…¨éªŒè¯</li><li>â€œvalid-forkâ€ è¯¥åˆ†æ”¯ä¸æ˜¯æ´»åŠ¨é“¾çš„ä¸€éƒ¨åˆ†ï¼Œä½†ç»è¿‡å……åˆ†éªŒè¯</li><li>â€œactiveâ€è¿™æ˜¯æ´»è·ƒä¸»é“¾çš„æç¤ºï¼Œè¿™å½“ç„¶æœ‰æ•ˆ</li></ul><h4 id="1-3-1-2-è·å–åŒºå—ä¿¡æ¯"><a href="#1-3-1-2-è·å–åŒºå—ä¿¡æ¯" class="headerlink" title="1.3.1.2 è·å–åŒºå—ä¿¡æ¯"></a>1.3.1.2 è·å–åŒºå—ä¿¡æ¯</h4><ul><li>è¯·æ±‚ç¤ºèŒƒ</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl --data-binary &#x27;&#123;&quot;jsonrpc&quot;: &quot;1.0&quot;, &quot;id&quot;: &quot;curltest&quot;, &quot;method&quot;: &quot;getblockchaininfo&quot;, &quot;params&quot;: []&#125;&#x27; -H &#x27;content-type: text/plain;&#x27; https://thrilling-spring-bush.btc.quiknode.pro/c0d9254cfb049224abd0ece400635e62b791a388/<br></code></pre></td></tr></table></figure><ul><li>è¿”å›å†…å®¹</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs shell">&#123;<br>   &quot;result&quot;:&#123;<br>      &quot;chain&quot;:&quot;main&quot;,<br>      &quot;blocks&quot;:845200,<br>      &quot;headers&quot;:845200,<br>      &quot;bestblockhash&quot;:&quot;000000000000000000027a970865a12b12e4da473011e2033eeca871c957a747&quot;,<br>      &quot;difficulty&quot;:84381461788831.34,<br>      &quot;time&quot;:1716706327,<br>      &quot;mediantime&quot;:1716703878,<br>      &quot;verificationprogress&quot;:0.999998974207445,<br>      &quot;initialblockdownload&quot;:false,<br>      &quot;chainwork&quot;:&quot;00000000000000000000000000000000000000007b695dedb46255cb840f5cb6&quot;,<br>      &quot;size_on_disk&quot;:652535688171,<br>      &quot;pruned&quot;:false,<br>      &quot;warnings&quot;:&quot;&quot;<br>   &#125;,<br>   &quot;error&quot;:null,<br>   &quot;id&quot;:&quot;curltest&quot;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="1-3-1-3-åˆ—å‡ºæœªèŠ±è´¹çš„è¾“å…¥è¾“å‡º"><a href="#1-3-1-3-åˆ—å‡ºæœªèŠ±è´¹çš„è¾“å…¥è¾“å‡º" class="headerlink" title="1.3.1.3 åˆ—å‡ºæœªèŠ±è´¹çš„è¾“å…¥è¾“å‡º"></a>1.3.1.3 <strong>åˆ—å‡ºæœªèŠ±è´¹çš„è¾“å…¥è¾“å‡º</strong></h4><ul><li>è¯·æ±‚ç¤ºèŒƒ</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl --data-binary &#x27;&#123;&quot;jsonrpc&quot;: &quot;1.0&quot;, &quot;id&quot;: &quot;curltest&quot;, &quot;method&quot;: &quot;listunspent&quot;, &quot;params&quot;: [845000, 845200, [] , true, &#123; &quot;minimumAmount&quot;: 0.005 &#125; ]&#125;&#x27; -H &#x27;content-type: text/plain;&#x27;  https://thrilling-spring-bush.btc.quiknode.pro/c0d9254cfb049224abd0ece400635e62b791a388/<br></code></pre></td></tr></table></figure><ul><li>è¿”å›å€¼</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs shell">[                                <br>  &#123;                              <br>    &quot;txid&quot; : &quot;&quot;,             <br>    &quot;vout&quot; : 1,                 <br>    &quot;address&quot; : &quot;str&quot;,           <br>    &quot;label&quot; : &quot;str&quot;,             <br>    &quot;scriptPubKey&quot; : &quot;str&quot;,     <br>    &quot;amount&quot; : 10000,               <br>    &quot;confirmations&quot; : 12,        <br>    &quot;redeemScript&quot; : &quot;hex&quot;,     <br>    &quot;witnessScript&quot; : &quot;str&quot;,    <br>    &quot;spendable&quot; : false,    <br>    &quot;solvable&quot; : false,     <br>    &quot;reused&quot; : false,       <br>    &quot;desc&quot; : &quot;str&quot;,              <br>    &quot;safe&quot; : true                                      <br>  &#125;,&#123;                              <br>    &quot;txid&quot; : &quot;&quot;,             <br>    &quot;vout&quot; : 1,                 <br>    &quot;address&quot; : &quot;str&quot;,           <br>    &quot;label&quot; : &quot;str&quot;,             <br>    &quot;scriptPubKey&quot; : &quot;str&quot;,     <br>    &quot;amount&quot; : 10000,               <br>    &quot;confirmations&quot; : 12,        <br>    &quot;redeemScript&quot; : &quot;hex&quot;,     <br>    &quot;witnessScript&quot; : &quot;str&quot;,    <br>    &quot;spendable&quot; : false,    <br>    &quot;solvable&quot; : false,     <br>    &quot;reused&quot; : false,       <br>    &quot;desc&quot; : &quot;str&quot;,              <br>    &quot;safe&quot; : true                                      <br>  &#125;,<br>]<br></code></pre></td></tr></table></figure><h4 id="1-3-1-4å‘é€äº¤æ˜“åˆ°åŒºå—é“¾ç½‘ç»œ"><a href="#1-3-1-4å‘é€äº¤æ˜“åˆ°åŒºå—é“¾ç½‘ç»œ" class="headerlink" title="1.3.1.4å‘é€äº¤æ˜“åˆ°åŒºå—é“¾ç½‘ç»œ"></a>1.3.1.4<strong>å‘é€äº¤æ˜“åˆ°åŒºå—é“¾ç½‘ç»œ</strong></h4><ul><li>è¯·æ±‚å‚æ•°</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">curl --data-binary &#x27;&#123;&quot;jsonrpc&quot;: &quot;1.0&quot;, &quot;id&quot;: &quot;curltest&quot;, &quot;method&quot;: &quot;sendrawtransaction&quot;, &quot;params&quot;: [&quot;signedhex&quot;]&#125;&#x27; -H &#x27;content-type: text/plain;&#x27; https://thrilling-spring-bush.btc.quiknode.pro/c0d9254cfb049224abd0ece400635e62b791a388/<br></code></pre></td></tr></table></figure><ul><li>è¿”å›å€¼</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">æˆåŠŸè¿”å›äº¤æ˜“ Hash<br></code></pre></td></tr></table></figure><h3 id="1-3-2-Rosetta-Apiã€å¸¸ç”¨ï¼Œæ”¯æŒç”Ÿæ€å¥½ã€‘"><a href="#1-3-2-Rosetta-Apiã€å¸¸ç”¨ï¼Œæ”¯æŒç”Ÿæ€å¥½ã€‘" class="headerlink" title="1.3.2 Rosetta Apiã€å¸¸ç”¨ï¼Œæ”¯æŒç”Ÿæ€å¥½ã€‘"></a>1.3.2 Rosetta Apiã€å¸¸ç”¨ï¼Œæ”¯æŒç”Ÿæ€å¥½ã€‘</h3><p>Bitcoin Rosetta API æ˜¯ç”± Coinbase æå‡ºçš„ Rosetta æ ‡å‡†çš„ä¸€éƒ¨åˆ†ï¼Œæ—¨åœ¨ä¸ºåŒºå—é“¾å’Œé’±åŒ…æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£æ ‡å‡†ã€‚è¿™ä¸ªæ ‡å‡†åŒ–çš„æ¥å£ä½¿å¾—ä¸å„ç§åŒºå—é“¾çš„äº¤äº’æ›´åŠ å®¹æ˜“å’Œä¸€è‡´ï¼Œæ— è®ºæ˜¯å¯¹äº¤æ˜“æ•°æ®çš„è¯»å–è¿˜æ˜¯å†™å…¥ã€‚ç›®å‰å·²ç»æ”¯æŒå¾ˆå¤šé“¾ï¼ŒåŒ…å«æ¯”ç‰¹å¸ï¼Œä»¥å¤ªåŠç­‰ä¸»æµé“¾ï¼Œä¹ŸåŒ…å«åƒ IoTex å’Œ Oasis è¿™æ ·çš„éä¸»æµé“¾ã€‚</p><p><strong>3.2.1.Rosetta API æ¦‚è¿°</strong></p><p>Rosetta API åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š</p><ul><li>Data APIï¼šç”¨äºè¯»å–åŒºå—é“¾æ•°æ®ã€‚</li><li>Construction APIï¼šç”¨äºæ„å»ºå’Œæäº¤äº¤æ˜“ã€‚</li></ul><p><strong>3.2.2. Data API</strong></p><p>Data API æä¾›äº†ä¸€ç»„ç«¯ç‚¹ï¼Œç”¨äºæ£€ç´¢åŒºå—é“¾æ•°æ®ï¼Œå¦‚åŒºå—ã€äº¤æ˜“ã€ä½™é¢ç­‰ã€‚ä¸»è¦ç«¯ç‚¹åŒ…æ‹¬ï¼š</p><ul><li>&#x2F;network&#x2F;listï¼šè¿”å›æ”¯æŒçš„ç½‘ç»œåˆ—è¡¨ã€‚</li><li>&#x2F;network&#x2F;statusï¼šè¿”å›å½“å‰ç½‘ç»œçš„çŠ¶æ€ä¿¡æ¯ã€‚</li><li>&#x2F;network&#x2F;optionsï¼šè¿”å›æ”¯æŒçš„ç½‘ç»œé€‰é¡¹å’Œç‰ˆæœ¬ä¿¡æ¯ã€‚</li><li>&#x2F;blockï¼šè¿”å›æŒ‡å®šåŒºå—çš„æ•°æ®ã€‚</li><li>&#x2F;block&#x2F;transactionï¼šè¿”å›æŒ‡å®šäº¤æ˜“çš„æ•°æ®ã€‚</li><li>&#x2F;account&#x2F;balanceï¼šè¿”å›æŒ‡å®šè´¦æˆ·çš„ä½™é¢ã€‚</li><li>&#x2F;mempoolï¼šè¿”å›å½“å‰æœªç¡®è®¤çš„äº¤æ˜“æ± ã€‚</li><li>&#x2F;mempool&#x2F;transactionï¼šè¿”å›æŒ‡å®šæœªç¡®è®¤äº¤æ˜“çš„æ•°æ®ã€‚</li></ul><p><strong>3.2.3. Construction API</strong></p><p>Construction API æä¾›äº†ä¸€ç»„ç«¯ç‚¹ï¼Œç”¨äºåˆ›å»ºã€ç­¾åå’Œæäº¤äº¤æ˜“ã€‚ä¸»è¦ç«¯ç‚¹åŒ…æ‹¬ï¼š</p><ul><li>&#x2F;construction&#x2F;preprocessï¼šåˆ†æäº¤æ˜“éœ€æ±‚å¹¶è¿”å›äº¤æ˜“æ‰€éœ€çš„å…ƒæ•°æ®ã€‚</li><li>&#x2F;construction&#x2F;metadataï¼šè¿”å›æ„å»ºäº¤æ˜“æ‰€éœ€çš„å…ƒæ•°æ®ã€‚</li><li>&#x2F;construction&#x2F;payloadsï¼šç”Ÿæˆå¾…ç­¾åçš„äº¤æ˜“æœ‰æ•ˆè½½è·ã€‚</li><li>&#x2F;construction&#x2F;parseï¼šè§£æäº¤æ˜“å¹¶è¿”å›å…¶æ“ä½œã€‚</li><li>&#x2F;construction&#x2F;combineï¼šå°†ç­¾åä¸å¾…ç­¾åäº¤æ˜“åˆå¹¶ã€‚</li><li>&#x2F;construction&#x2F;hashï¼šè¿”å›äº¤æ˜“çš„å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆå“ˆå¸Œï¼‰ã€‚</li><li>&#x2F;construction&#x2F;submitï¼šæäº¤ç­¾ååçš„äº¤æ˜“ã€‚</li></ul><p><strong>3.2.4.å¼€å‘ BTC é’±åŒ…ä½¿ç”¨åˆ°çš„ Rosetta Api</strong></p><p>ä¸ºäº†å…·ä½“å®ç° Rosetta APIï¼Œå¼€å‘è€…éœ€è¦éµå¾ª Rosetta æ ‡å‡†å¹¶æ ¹æ®æ¯”ç‰¹å¸åŒºå—é“¾çš„ç‰¹æ€§è¿›è¡Œé€‚é…ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å…·ä½“å®ç°ç»†èŠ‚</p><p>æ•°æ®ç»“æ„ï¼š</p><ul><li>åŒºå—ï¼šåŒ…å«åŒºå—å“ˆå¸Œã€å‰ä¸€ä¸ªåŒºå—å“ˆå¸Œã€åŒºå—é«˜åº¦ã€æ—¶é—´æˆ³ã€äº¤æ˜“åˆ—è¡¨ç­‰ã€‚</li><li>äº¤æ˜“ï¼šåŒ…å«äº¤æ˜“å“ˆå¸Œã€è¾“å…¥è¾“å‡ºåˆ—è¡¨ã€é‡‘é¢ã€åœ°å€ç­‰ã€‚</li><li>è´¦æˆ·ï¼šåŒ…å«è´¦æˆ·åœ°å€å’Œä½™é¢ä¿¡æ¯ã€‚</li></ul><p><strong>ç”¨åˆ°çš„æ¥å£</strong></p><ul><li>&#x2F;network&#x2F;listï¼šè¿”å›æ¯”ç‰¹å¸ä¸»ç½‘å’Œæµ‹è¯•ç½‘ä¿¡æ¯ã€‚</li><li>&#x2F;network&#x2F;statusï¼šè¿”å›å½“å‰æœ€æ–°åŒºå—ã€å·²åŒæ­¥åŒºå—é«˜åº¦ã€åŒºå—é“¾å¤„ç†å™¨çš„çŠ¶æ€ç­‰ã€‚</li><li>&#x2F;block å’Œ &#x2F;block&#x2F;transactionï¼šè¿”å›åŒºå—å’Œäº¤æ˜“çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬äº¤æ˜“çš„è¾“å…¥è¾“å‡ºã€é‡‘é¢ã€åœ°å€ç­‰ã€‚</li><li>&#x2F;account&#x2F;balanceï¼šé€šè¿‡æŸ¥è¯¢æ¯”ç‰¹å¸èŠ‚ç‚¹ï¼Œè¿”å›æŒ‡å®šåœ°å€çš„ä½™é¢ã€‚</li></ul><p><strong>å‘é€äº¤æ˜“åˆ°åŒºå—é“¾ç½‘ç»œ</strong></p><ul><li>&#x2F;construction&#x2F;submitï¼šé€šè¿‡æ¯”ç‰¹å¸èŠ‚ç‚¹æäº¤ç­¾ååçš„äº¤æ˜“ã€‚</li></ul><h2 id="3-3-æ–‡æ¡£èµ„æ–™"><a href="#3-3-æ–‡æ¡£èµ„æ–™" class="headerlink" title="3.3. æ–‡æ¡£èµ„æ–™"></a>3.3. æ–‡æ¡£èµ„æ–™</h2><ul><li><p>æ¯”ç‰¹å¸å¼€å‘æ–‡æ¡£ï¼š</p><p><a href="https://developer.bitcoin.org/reference/rpc/">https://developer.bitcoin.org/reference/rpc/</a></p></li><li><p>Rosetta å¼€å‘æ–‡æ¡£ï¼š</p><p><a href="https://docs.cdp.coinbase.com/rosetta/reference/networklist/">https://docs.cdp.coinbase.com/rosetta/reference/networklist/</a></p></li><li><p>Rosetta å¼€å‘æ–‡æ¡£ï¼š</p><p><a href="https://github.com/coinbase/mesh-ecosystem/blob/master/implementations.md">https://github.com/coinbase/mesh-ecosystem/blob/master/implementations.md</a></p></li><li><p>æµè§ˆå™¨ï¼š</p><p><a href="https://btc.com/zh-CN">https://btc.com/zh-CN</a></p></li></ul><p>2ã€ä»¥å¤ªåŠé’±åŒ…å¼€å‘</p><p>3ã€æ¯”ç‰¹å¸schnorråœ°å€å’Œç­¾åæµç¨‹ç»†åŒ–</p><p>è€Œä¸”ä¸“å±åè¯å¤ªå¤šå•¦ï¼Œä¸€å¥è¯å°±è¹¦å‡ºäº†lucky eap159 eip484 Blake ä¸€å¤§å †ï¼Œä¸ä¸“æ³¨ï¼Œä¸€ä¸‹å­å°±è®©äººæ‡µäº†ï¼ˆä¸»è¦æ˜¯æˆ‘è¿™ç§å¸åœˆå¤–çš„äººï¼‰</p>]]></content>
    
    
    <categories>
      
      <category>blockChain</category>
      
    </categories>
    
    
    <tags>
      
      <tag>block</tag>
      
      <tag>æ¦‚å¿µ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>0601 é’±åŒ…éƒ¨åˆ†å°æ€»ç»“</title>
    <link href="/2024/05/30/061%E9%92%B1%E5%8C%85%E9%83%A8%E5%88%86%E5%B0%8F%E6%80%BB%E7%BB%93/"/>
    <url>/2024/05/30/061%E9%92%B1%E5%8C%85%E9%83%A8%E5%88%86%E5%B0%8F%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<h2 id="1-æè¿°ä¸€ä¸‹äº¤æ˜“æ‰€é’±åŒ…çš„å……å€¼å’Œæç°æµç¨‹"><a href="#1-æè¿°ä¸€ä¸‹äº¤æ˜“æ‰€é’±åŒ…çš„å……å€¼å’Œæç°æµç¨‹" class="headerlink" title="1.æè¿°ä¸€ä¸‹äº¤æ˜“æ‰€é’±åŒ…çš„å……å€¼å’Œæç°æµç¨‹"></a>1.æè¿°ä¸€ä¸‹äº¤æ˜“æ‰€é’±åŒ…çš„å……å€¼å’Œæç°æµç¨‹</h2><h3 id="å……å€¼"><a href="#å……å€¼" class="headerlink" title="å……å€¼"></a>å……å€¼</h3><ul><li>äº¤æ˜“æ‰€ç»™ç”¨æˆ·æä¾›åœ°å€ï¼Œç”¨æˆ·æŠŠé’±è½¬è¿›æ¥</li><li>æ‰«é“¾ï¼šè·å–æœ€æ–°å—é«˜ï¼Œä»ä¸Šä¸€æ¬¡è§£æçš„å—å¼€å§‹åˆ°æœ€æ–°å—é«˜è¿›è¡Œäº¤æ˜“è§£æ</li><li>äº¤æ˜“è§£æå®Œä¹‹åï¼Œå¦‚æœäº¤æ˜“é‡Œé¢ to æ˜¯ç³»ç»Ÿç”¨æˆ·ï¼Œåˆ™æ˜¯å……å€¼ï¼Œè§£æå®Œæˆä¹‹å<strong>ä¸Šè´¦</strong>ï¼Œå¹¶é€šçŸ¥<strong>ä¸šåŠ¡å±‚</strong></li></ul><h3 id="æç°"><a href="#æç°" class="headerlink" title="æç°"></a>æç°</h3><p>1.è·å–ç­¾åå‚æ•°â€“&gt;2.ç¦»çº¿ç­¾åâ€“&gt;3.å¹¿æ’­å‡ºå»â€”&gt;æŠŠäº¤æ˜“å“ˆå¸Œæ›´æ–°æ•°æ®åº“â€”-&gt;æ‰«é“¾è§£æç¡®è®¤æ˜¯å¦å®Œæˆ</p><ul><li>è·å–éœ€è¦çš„ç­¾åå‚æ•°ï¼ˆè¿™é‡Œå°±çœ‹äº†ï¼‰<ul><li>ETHï¼šè·å–ä¸‰ä¸ªï¼šNonce(Number onceçš„ç¼©å†™)ã€gaspriceã€ gaslimite </li><li>BTCï¼šVersionã€Inputã€Outputã€Locktimeã€Sequenceã€Hash Typeè¿™äº›</li><li>Atom ï¼šAccount Numberï¼ˆå”¯ä¸€è´¦æˆ·ç¼–å·ï¼‰ Sequenceï¼ˆé¡ºåºï¼‰fess(æ‰‹ç»­è´¹)</li></ul></li><li>äº¤æ˜“ç¦»çº¿ç­¾åï¼š<ul><li>ç»„ç»‡äº¤æ˜“ï¼Œå…ˆç”Ÿæˆ<strong>å¾…ç­¾å</strong>æ¶ˆæ¯æ‘˜è¦ï¼Œ</li><li>å°†å¾…ç­¾åçš„æ¶ˆæ¯æ‘˜è¦é€’ç»™ç­¾åæœºè¿›è¡Œ<strong>ç­¾å</strong>ï¼Œ</li><li>ç­¾åæœºç­¾åå®Œæˆä¹‹åè¿”å›<strong>ç­¾åä¸²</strong></li></ul></li><li>å¹¿æ’­å‡ºå»ï¼šæ‹¿åˆ°äº†ç¦»çº¿ç­¾ååæ„å»ºå®Œæ•´çš„äº¤æ˜“å¹¶å‘é€åŒºå—é“¾ç½‘ç»œï¼Œå°†ç­¾åæ—¶è®¡ç®—å‡ºæ¥çš„äº¤æ˜“ Hash æˆ–è€…å‘é€äº¤æ˜“æ—¶è¿”å›äº¤æ˜“ Hash æ›´æ–°åˆ°æ•°æ®åº“</li><li>æ‰«é“¾è§£æåˆ°è¿™ç¬”äº¤æ˜“ï¼Œè¯´æ˜æç°æˆåŠŸã€‚</li></ul><h2 id="2-HD-é’±åŒ…åŠ©è®°è¯ç”Ÿæˆçš„æµç¨‹"><a href="#2-HD-é’±åŒ…åŠ©è®°è¯ç”Ÿæˆçš„æµç¨‹" class="headerlink" title="2.HD é’±åŒ…åŠ©è®°è¯ç”Ÿæˆçš„æµç¨‹"></a>2.HD é’±åŒ…åŠ©è®°è¯ç”Ÿæˆçš„æµç¨‹</h2><ul><li>ç¬¬ä¸€æ­¥ï¼šéšæœºç†µç”Ÿæˆ</li><li>ç¬¬äºŒæ­¥ï¼šè®¡ç®—æ ¡éªŒå’Œ</li><li>ç¬¬ä¸‰æ­¥ï¼šç»„åˆç†µå’Œæ ¡éªŒå’Œ</li><li>ç¬¬å››æ­¥ï¼šåˆ†å‰²åŠ©è®°è¯ç´¢å¼•</li><li>ç¬¬äº”æ­¥ï¼šæ˜ å°„ä¸ºåŠ©è®°è¯</li></ul><h2 id="3-åŠ©è®°è¯çš„éªŒè¯è¿‡ç¨‹"><a href="#3-åŠ©è®°è¯çš„éªŒè¯è¿‡ç¨‹" class="headerlink" title="3.åŠ©è®°è¯çš„éªŒè¯è¿‡ç¨‹"></a>3.åŠ©è®°è¯çš„éªŒè¯è¿‡ç¨‹</h2><ul><li>ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥åŠ©è®°è¯æ•°é‡</li><li>ç¬¬äºŒæ­¥ï¼šæ£€æŸ¥åŠ©è®°è¯æ˜¯å¦åœ¨è¯æ±‡è¡¨</li><li>ç¬¬ä¸‰æ­¥ï¼šå°†åŠ©è®°è¯è½¬æ¢æˆç´¢å¼•</li><li>ç¬¬å››æ­¥ï¼šæå–ç§å­çš„æ ¡éªŒå’Œ</li><li>ç¬¬äº”æ­¥ï¼šè®¡ç®—æ ¡éªŒå’Œ</li><li>ç¬¬å…­æ­¥ï¼šéªŒè¯æ ¡éªŒå’Œ</li></ul><h2 id="4-BIP44-è·¯å¾„"><a href="#4-BIP44-è·¯å¾„" class="headerlink" title="4.BIP44 è·¯å¾„"></a>4.BIP44 è·¯å¾„</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">m<span class="hljs-regexp">/44&#x27;/</span>coin_type<span class="hljs-string">&#x27;/account&#x27;</span><span class="hljs-regexp">/change/</span>address_index<br></code></pre></td></tr></table></figure><p>account æ ‡è®°è´¦æˆ·ç±»å‹ï¼Œä¾¿äºåˆ†ç±»ï¼Œé»˜è®¤ä¸º0</p><p>change ï¼š æ¯”ç‰¹å¸ç‰¹æœ‰çš„ï¼Œæ‰¾é›¶åœ°å€å°±æ˜¯1</p><h2 id="5-é—¨é™å…±äº«ç§˜å¯†æ‹†åˆ†è¿‡ç¨‹MPC"><a href="#5-é—¨é™å…±äº«ç§˜å¯†æ‹†åˆ†è¿‡ç¨‹MPC" class="headerlink" title="5.é—¨é™å…±äº«ç§˜å¯†æ‹†åˆ†è¿‡ç¨‹MPC"></a>5.é—¨é™å…±äº«ç§˜å¯†æ‹†åˆ†è¿‡ç¨‹MPC</h2><p>ç§˜å¯†â€”â€“&gt; n ä»½ï¼Œk ä»½å¯æ¢å¤ï¼Œ ä»»æ„ k ä»½æ¢å¤å‡ºè¿™ä¸ªç§˜å¯†ï¼Œåˆ†åˆ«ç”¨é—¨é™å…±äº«ç®—æ³•å’Œé€†é—¨é™å…±äº«ç§˜å¯†ç®—æ³•</p><h2 id="5-MPC-GG20-ç®—æ³•-Keygen-å’Œ-Sign-åˆ†åˆ«éœ€è¦ç»è¿‡å¤šå°‘è½®å…±è¯†"><a href="#5-MPC-GG20-ç®—æ³•-Keygen-å’Œ-Sign-åˆ†åˆ«éœ€è¦ç»è¿‡å¤šå°‘è½®å…±è¯†" class="headerlink" title="5.MPC GG20 ç®—æ³• Keygen å’Œ Sign åˆ†åˆ«éœ€è¦ç»è¿‡å¤šå°‘è½®å…±è¯†"></a>5.MPC GG20 ç®—æ³• Keygen å’Œ Sign åˆ†åˆ«éœ€è¦ç»è¿‡å¤šå°‘è½®å…±è¯†</h2><ul><li>Keygen: 4 è½®</li><li>Sign: 7 è½®</li></ul><h2 id="6-ä¸ºä»€ä¹ˆ-schnorr-æ¯”ç‰¹å¸æ‰‹ç»­è´¹å¯ä»¥é™ä½"><a href="#6-ä¸ºä»€ä¹ˆ-schnorr-æ¯”ç‰¹å¸æ‰‹ç»­è´¹å¯ä»¥é™ä½" class="headerlink" title="6.ä¸ºä»€ä¹ˆ schnorr æ¯”ç‰¹å¸æ‰‹ç»­è´¹å¯ä»¥é™ä½"></a>6.ä¸ºä»€ä¹ˆ schnorr æ¯”ç‰¹å¸æ‰‹ç»­è´¹å¯ä»¥é™ä½</h2><p>schnorr ç­¾åèšåˆæˆä¸€ä¸ªç­¾åï¼Œè¿˜æœ‰çŸ­å¯†é’¥ï¼Œè¿™æ ·ç­¾åçš„æ•°æ®ä¼šæ¯” ECDSA çŸ­å¾ˆå¤šï¼Œæ‰€ä»¥ç›¸å¯¹äº ECDSA ç­¾åçš„äº¤æ˜“ä¼šä¾¿å®œå¾ˆå¤š</p><h2 id="7-ä¸ºä»€ä¹ˆæ¯”ç‰¹å¸æ—©æœŸæ—¶å€™ä¸ç›´æ¥ç”¨-schnorr-ç­¾åç®—æ³•"><a href="#7-ä¸ºä»€ä¹ˆæ¯”ç‰¹å¸æ—©æœŸæ—¶å€™ä¸ç›´æ¥ç”¨-schnorr-ç­¾åç®—æ³•" class="headerlink" title="7. ä¸ºä»€ä¹ˆæ¯”ç‰¹å¸æ—©æœŸæ—¶å€™ä¸ç›´æ¥ç”¨ schnorr ç­¾åç®—æ³•"></a>7. ä¸ºä»€ä¹ˆæ¯”ç‰¹å¸æ—©æœŸæ—¶å€™ä¸ç›´æ¥ç”¨ schnorr ç­¾åç®—æ³•</h2><p>å› ä¸ºå½“æ—¶ schnorr ç®—æ³•åœ¨ä¸“åˆ©æœŸ</p><h2 id="8-ç›¸æ¯”è¾ƒä¹‹ä¸‹-EDDSA-æ€§èƒ½ï¼Œå®‰å…¨æ€§éƒ½ä¼šé«˜ä¸€äº›ï¼Œä¸ºä»€ä¹ˆæ¯”ç‰¹å¸ä»¥å¤ªåŠç”¨äº†-ECDSAï¼Œæ²¡æœ‰ç”¨-EDDSA"><a href="#8-ç›¸æ¯”è¾ƒä¹‹ä¸‹-EDDSA-æ€§èƒ½ï¼Œå®‰å…¨æ€§éƒ½ä¼šé«˜ä¸€äº›ï¼Œä¸ºä»€ä¹ˆæ¯”ç‰¹å¸ä»¥å¤ªåŠç”¨äº†-ECDSAï¼Œæ²¡æœ‰ç”¨-EDDSA" class="headerlink" title="8. ç›¸æ¯”è¾ƒä¹‹ä¸‹ EDDSA æ€§èƒ½ï¼Œå®‰å…¨æ€§éƒ½ä¼šé«˜ä¸€äº›ï¼Œä¸ºä»€ä¹ˆæ¯”ç‰¹å¸ä»¥å¤ªåŠç”¨äº† ECDSAï¼Œæ²¡æœ‰ç”¨ EDDSA"></a>8. ç›¸æ¯”è¾ƒä¹‹ä¸‹ EDDSA æ€§èƒ½ï¼Œå®‰å…¨æ€§éƒ½ä¼šé«˜ä¸€äº›ï¼Œä¸ºä»€ä¹ˆæ¯”ç‰¹å¸ä»¥å¤ªåŠç”¨äº† ECDSAï¼Œæ²¡æœ‰ç”¨ EDDSA</h2><ul><li>ECDSA æ˜¯åŸºäºæ›´æ—©çš„æ ‡å‡†ï¼ˆå¦‚ FIPS 186-4 å’Œ ANSI X9.62ï¼‰å‘å±•çš„ï¼Œå› æ­¤åœ¨å¯†ç å­¦ç•Œå’Œå·¥ä¸šç•Œæœ‰è¾ƒé•¿çš„ä½¿ç”¨å†å²å’Œå¹¿æ³›çš„æ ‡å‡†åŒ–æ”¯æŒã€‚å®ƒè¢«å¤§é‡ç³»ç»Ÿå’Œåè®®ï¼ˆå¦‚ TLS å’Œ Bitcoinï¼‰é‡‡ç”¨ï¼Œå½¢æˆäº†ä¸€ä¸ªåºå¤§çš„ç”Ÿæ€ç³»ç»Ÿã€‚</li><li>è™½ç„¶ EdDSA æœ‰ä¸€äº›ä¼˜åŠ¿ï¼Œå¦‚ä¸å®¹æ˜“å—åˆ°ä¾§ä¿¡é“æ”»å‡»çš„å½±å“ï¼ˆå¦‚æ—¶é—´æ”»å‡»å’Œç¼“å­˜æ”»å‡»ï¼‰ï¼Œä½† ECDSA çš„å®‰å…¨æ€§ä¹Ÿå·²ç»è¿‡å¹¿æ³›çš„ç ”ç©¶å’ŒéªŒè¯ã€‚å¯¹äºå¾ˆå¤šå¼€å‘è€…å’Œä¼ä¸šæ¥è¯´ï¼Œä½¿ç”¨ä¸€ä¸ªå·²è¢«é•¿æœŸéªŒè¯çš„ç®—æ³•æ˜¯æ›´ä¸ºä¿å®ˆå’Œå®‰å…¨çš„é€‰æ‹©ã€‚</li><li>EdDSA é€šå¸¸å…·æœ‰æ›´é«˜çš„ç­¾åé€Ÿåº¦å’Œè¾ƒå¿«çš„éªŒè¯é€Ÿåº¦ï¼Œå°¤å…¶æ˜¯åœ¨å¤§å¤šæ•°è½¯ä»¶å®ç°ä¸­ã€‚ç„¶è€Œï¼Œå¯¹äºå·²ç»é«˜åº¦ä¼˜åŒ–çš„ ECDSA å®ç°ï¼Œæ€§èƒ½å·®å¼‚åœ¨è®¸å¤šåº”ç”¨ä¸­å¯èƒ½å¹¶ä¸æ˜æ˜¾ã€‚</li><li>EdDSA çš„è®¾è®¡æ›´ä¸ºç®€å•ä¸”æ›´ä¸æ˜“å‡ºé”™ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†éšæœºæ•°ç”Ÿæˆç­‰æ–¹é¢ã€‚ç„¶è€Œï¼ŒECDSA ç”±äºä½¿ç”¨å†å²æ›´é•¿ï¼Œå¼€å‘è€…æ›´ä¸ºç†Ÿæ‚‰å…¶ä½¿ç”¨å’Œç®¡ç†ã€‚</li></ul><h2 id="9-ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘é‡Œé¢çš„å……å€¼ï¼Œæç°ï¼Œå½’é›†ï¼Œè½¬å†·ï¼Œå†·è½¬çƒ­å¼€å‘ä¸šåŠ¡æµç¨‹æè¿°"><a href="#9-ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘é‡Œé¢çš„å……å€¼ï¼Œæç°ï¼Œå½’é›†ï¼Œè½¬å†·ï¼Œå†·è½¬çƒ­å¼€å‘ä¸šåŠ¡æµç¨‹æè¿°" class="headerlink" title="9.ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘é‡Œé¢çš„å……å€¼ï¼Œæç°ï¼Œå½’é›†ï¼Œè½¬å†·ï¼Œå†·è½¬çƒ­å¼€å‘ä¸šåŠ¡æµç¨‹æè¿°"></a>9.ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘é‡Œé¢çš„å……å€¼ï¼Œæç°ï¼Œå½’é›†ï¼Œè½¬å†·ï¼Œå†·è½¬çƒ­å¼€å‘ä¸šåŠ¡æµç¨‹æè¿°</h2><p>ğŸ’¡ğŸ’¡æ¥å£è¿”å›çš„ to æ˜¯äº¤æ˜“æ‰€ç³»ç»Ÿé‡Œé¢çš„ç”¨æˆ·åœ°å€ï¼Œè¿™ç¬”äº¤æ˜“ä¸ºå……å€¼äº¤æ˜“ï¼›</p><p> ğŸ’¡ğŸ’¡æ¥å£è¿”å›çš„ from æ˜¯äº¤æ˜“æ‰€ç³»ç»Ÿé‡Œé¢çš„ç”¨æˆ·åœ°å€ï¼Œè¿™ç¬”äº¤æ˜“ä¸ºæç°äº¤æ˜“ï¼› </p><p>ğŸ’¡ğŸ’¡æ¥å£è¿”å›çš„ to æ˜¯äº¤æ˜“æ‰€çš„å½’é›†åœ°å€ï¼Œfrom æ˜¯ç³»ç»Ÿçš„ç”¨æˆ·åœ°å€ï¼Œè¿™ç¬”äº¤æ˜“èµ„é‡‘å½’é›†äº¤æ˜“ï¼› </p><p>ğŸ’¡ğŸ’¡æ¥å£è¿”å›çš„ to åœ°å€æ˜¯å†·é’±åŒ…åœ°å€ï¼Œfrom åœ°å€æ—¶çƒ­é’±åŒ…åœ°å€ï¼Œè¿™ç¬”äº¤æ˜“çƒ­è½¬å†·çš„äº¤æ˜“ã€‚ </p><p>ğŸ’¡ğŸ’¡æ¥å£è¿”å›çš„ from åœ°å€æ˜¯å†·é’±åŒ…åœ°å€ï¼Œto åœ°å€æ—¶çƒ­é’±åŒ…åœ°å€ï¼Œè¿™ç¬”äº¤æ˜“å†·è½¬çƒ­çš„äº¤æ˜“ã€‚</p><h3 id="å……å€¼-1"><a href="#å……å€¼-1" class="headerlink" title="å……å€¼"></a>å……å€¼</h3><p>æ‰«é“¾â€”&gt;è§£æäº¤æ˜“â€“&gt;ç¡®è®¤åœ°å€æ˜¯ç³»ç»Ÿåœ°å€åˆ™åˆ¤æ–­ä¸ºå……å€¼â€”&gt;é€šçŸ¥ä¸šåŠ¡å±‚ï¼ŒæŒä¹…åŒ–å­˜å‚¨</p><ul><li>è·å¾—æœ€æ–°å—é«˜ï¼›æ›´æ–°åˆ°æ•°æ®åº“</li><li>ä»æ•°æ®åº“ä¸­è·å–ä¸Šæ¬¡è§£æäº¤æ˜“çš„å—é«˜åšä¸ºèµ·å§‹å—é«˜ï¼Œæœ€æ–°å—é«˜ä¸ºæˆªæ­¢å—é«˜ï¼Œå¦‚æœæ•°æ®åº“ä¸­æ²¡æœ‰è®°å½•ï¼Œè¯´æ˜éœ€è¦ä»å¤´å¼€å§‹æ‰«ï¼Œèµ·å§‹å—é«˜ä¸º 0ï¼›</li><li>è§£æåŒºå—é‡Œé¢çš„äº¤æ˜“ï¼Œto åœ°å€æ˜¯ç³»ç»Ÿå†…éƒ¨çš„ç”¨æˆ·åœ°å€ï¼Œè¯´æ˜ç”¨æˆ·å……å€¼ï¼Œæ›´æ–°äº¤æ˜“åˆ°æ•°æ®åº“ä¸­ï¼Œå°†äº¤æ˜“çš„çŠ¶æ€è®¾ç½®ä¸ºå¾…ç¡®è®¤ã€‚</li><li>æ‰€åœ¨å—çš„äº¤æ˜“è¿‡äº†ç¡®è®¤ä½ï¼Œå°†äº¤æ˜“çŠ¶æ€æ›´æ–°ä½å……å€¼æˆåŠŸå¹¶é€šçŸ¥ä¸šåŠ¡å±‚ã€‚</li><li>è§£æåˆ°çš„å……å€¼äº¤æ˜“éœ€è¦åœ¨é’±åŒ…çš„æ•°æ®åº“é‡Œé¢ç»´æŠ¤ nonce, å½“ç„¶ä¹Ÿå¯ä»¥ä¸ç»´æŠ¤ï¼Œç­¾åçš„æ—¶å€™å»é“¾ä¸Šè·å–</li></ul><h3 id="æç°-1"><a href="#æç°-1" class="headerlink" title="æç°"></a>æç°</h3><p>1.è·å–ç­¾åå‚æ•°â€”&gt;2.ç¦»çº¿ç­¾åâ€”3.å¹¿æ’­å‡ºå»â€”&gt;4.æ‰«é“¾ç¡®è®¤â€”&gt;5.é€šçŸ¥ä¸šåŠ¡å±‚ï¼ŒæŒä¹…åŒ–å­˜å‚¨</p><ul><li>è·å–ç¦»çº¿ç­¾åéœ€è¦çš„å‚æ•°ï¼Œç»™åˆé€‚çš„æ‰‹ç»­è´¹</li><li>æ„å»ºæœªç­¾åçš„äº¤æ˜“æ¶ˆæ¯æ‘˜è¦ï¼Œå°†æ¶ˆæ¯æ‘˜è¦é€’ç»™ç­¾åæœºç­¾å</li><li>æ„å»ºå®Œæ•´çš„äº¤æ˜“å¹¶è¿›è¡Œåºåˆ—åŒ–</li><li>å‘é€äº¤æ˜“åˆ°åŒºå—é“¾ç½‘ç»œ</li><li>æ‰«é“¾è·å–åˆ°äº¤æ˜“ä¹‹åæ›´æ–°äº¤æ˜“çŠ¶æ€å¹¶ä¸ŠæŠ¥ä¸šåŠ¡å±‚</li></ul><h3 id="å½’é›†"><a href="#å½’é›†" class="headerlink" title="å½’é›†"></a>å½’é›†</h3><p>å½’é›†å°±æ˜¯è½¬è´¦ï¼ŒæŠŠåˆ†æ•£çš„å¸å½’æ‹¢åˆ°å½’é›†åœ°å€ï¼Œ</p><ul><li>å°†ç”¨æˆ·åœ°å€ä¸Šçš„èµ„é‡‘è½¬åˆ°å½’é›†åœ°å€ï¼Œç­¾åæµç¨‹ç±»ä¼¼æç°</li><li>å‘é€äº¤æ˜“åˆ°åŒºå—é“¾ç½‘ç»œ</li><li>æ‰«é“¾è·å–åˆ°äº¤æ˜“ä¹‹åæ›´æ–°äº¤æ˜“çŠ¶æ€</li></ul><h3 id="è½¬å†·"><a href="#è½¬å†·" class="headerlink" title="è½¬å†·"></a>è½¬å†·</h3><ul><li>å°†çƒ­é’±åŒ…åœ°å€ä¸Šçš„èµ„é‡‘è½¬åˆ°å†·é’±åŒ…åœ°å€ï¼Œç­¾åæµç¨‹ç±»ä¼¼æç°</li><li>å‘é€äº¤æ˜“åˆ°åŒºå—é“¾ç½‘ç»œ</li><li>æ‰«é“¾è·å–åˆ°äº¤æ˜“ä¹‹åæ›´æ–°äº¤æ˜“çŠ¶æ€</li></ul><h3 id="å†·è½¬çƒ­"><a href="#å†·è½¬çƒ­" class="headerlink" title="å†·è½¬çƒ­"></a>å†·è½¬çƒ­</h3><ul><li>æ‰‹åŠ¨æ“ä½œè½¬è´¦åˆ°çƒ­é’±åŒ…åœ°å€</li><li>æ‰«é“¾è·å–åˆ°äº¤æ˜“ä¹‹åæ›´æ–°äº¤æ˜“çŠ¶æ€</li></ul><h2 id="10-æœ‰ç”¨è¿‡-rosetta-api-è¯·ç®€å•æè¿°èµ·ä½œç”¨ï¼Œå¹¶ä¸¾å‡ ä¸ªé’±åŒ…å¸¸ç”¨çš„æ¥å£è¯´æ˜"><a href="#10-æœ‰ç”¨è¿‡-rosetta-api-è¯·ç®€å•æè¿°èµ·ä½œç”¨ï¼Œå¹¶ä¸¾å‡ ä¸ªé’±åŒ…å¸¸ç”¨çš„æ¥å£è¯´æ˜" class="headerlink" title="10.æœ‰ç”¨è¿‡ rosetta api, è¯·ç®€å•æè¿°èµ·ä½œç”¨ï¼Œå¹¶ä¸¾å‡ ä¸ªé’±åŒ…å¸¸ç”¨çš„æ¥å£è¯´æ˜"></a>10.æœ‰ç”¨è¿‡ rosetta api, è¯·ç®€å•æè¿°èµ·ä½œç”¨ï¼Œå¹¶ä¸¾å‡ ä¸ªé’±åŒ…å¸¸ç”¨çš„æ¥å£è¯´æ˜</h2><p>Bitcoin Rosetta API æ˜¯ç”± Coinbase æå‡ºçš„ Rosetta æ ‡å‡†çš„ä¸€éƒ¨åˆ†ï¼Œæ—¨åœ¨ä¸ºåŒºå—é“¾å’Œé’±åŒ…æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£æ ‡å‡†ã€‚è¿™ä¸ªæ ‡å‡†åŒ–çš„æ¥å£ä½¿å¾—ä¸å„ç§åŒºå—é“¾çš„äº¤äº’æ›´åŠ å®¹æ˜“å’Œä¸€è‡´ï¼Œæ— è®ºæ˜¯å¯¹äº¤æ˜“æ•°æ®çš„è¯»å–è¿˜æ˜¯å†™å…¥ã€‚ç›®å‰å·²ç»æ”¯æŒå¾ˆå¤šé“¾ï¼ŒåŒ…å«æ¯”ç‰¹å¸ï¼Œä»¥å¤ªåŠç­‰ä¸»æµé“¾ï¼Œä¹ŸåŒ…å«åƒ IoTex å’Œ Oasis è¿™æ ·çš„éä¸»æµé“¾ã€‚</p><h3 id="ç”¨åˆ°çš„æ¥å£"><a href="#ç”¨åˆ°çš„æ¥å£" class="headerlink" title="ç”¨åˆ°çš„æ¥å£"></a>ç”¨åˆ°çš„æ¥å£</h3><p>&#x2F;network&#x2F;listï¼šè¿”å›æ¯”ç‰¹å¸ä¸»ç½‘å’Œæµ‹è¯•ç½‘ä¿¡æ¯ã€‚ &#x2F;network&#x2F;statusï¼šè¿”å›å½“å‰æœ€æ–°åŒºå—ã€å·²åŒæ­¥åŒºå—é«˜åº¦ã€åŒºå—é“¾å¤„ç†å™¨çš„çŠ¶æ€ç­‰ã€‚ &#x2F;block å’Œ &#x2F;block&#x2F;transactionï¼šè¿”å›åŒºå—å’Œäº¤æ˜“çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬äº¤æ˜“çš„è¾“å…¥è¾“å‡ºã€é‡‘é¢ã€åœ°å€ç­‰ã€‚ &#x2F;account&#x2F;balanceï¼šé€šè¿‡æŸ¥è¯¢æ¯”ç‰¹å¸èŠ‚ç‚¹ï¼Œè¿”å›æŒ‡å®šåœ°å€çš„ä½™é¢ã€‚</p><h3 id="å‘é€äº¤æ˜“åˆ°åŒºå—é“¾ç½‘ç»œ"><a href="#å‘é€äº¤æ˜“åˆ°åŒºå—é“¾ç½‘ç»œ" class="headerlink" title="å‘é€äº¤æ˜“åˆ°åŒºå—é“¾ç½‘ç»œ"></a>å‘é€äº¤æ˜“åˆ°åŒºå—é“¾ç½‘ç»œ</h3><p>&#x2F;construction&#x2F;submitï¼šé€šè¿‡æ¯”ç‰¹å¸èŠ‚ç‚¹æäº¤ç­¾ååçš„äº¤æ˜“ã€‚</p><h2 id="11-ETH2-0-çš„-epoch-slot-å’Œ-block-ç®€è¿°"><a href="#11-ETH2-0-çš„-epoch-slot-å’Œ-block-ç®€è¿°" class="headerlink" title="11.ETH2.0 çš„ epoch, slot å’Œ block ç®€è¿°"></a>11.ETH2.0 çš„ epoch, slot å’Œ block ç®€è¿°</h2><h3 id="Slotï¼ˆæ—¶éš™ï¼‰"><a href="#Slotï¼ˆæ—¶éš™ï¼‰" class="headerlink" title="Slotï¼ˆæ—¶éš™ï¼‰"></a>Slotï¼ˆæ—¶éš™ï¼‰</h3><p>å®šä¹‰ï¼šSlot æ˜¯ä»¥å¤ªåŠ2.0ä¸­æœ€åŸºæœ¬çš„æ—¶é—´å•ä½ï¼Œæ¯ä¸ªslotéƒ½æœ‰ä¸€ä¸ªæŒ‡å®šçš„æ—¶é—´é•¿åº¦ã€‚åœ¨æ¯ä¸ª slot ä¸­ï¼Œå¯èƒ½ä¼šæœ‰ä¸€ä¸ªåŒºå—è¢«æè®®å¹¶æ·»åŠ åˆ°é“¾ä¸­ã€‚ æ—¶é—´é•¿åº¦ï¼šä¸€ä¸ª slot çš„é•¿åº¦ä¸º 12 ç§’ã€‚è¿™æ„å‘³ç€æ¯ 12 ç§’ä¼šæœ‰ä¸€ä¸ªæ–°çš„ slotã€‚ åŠŸèƒ½ï¼šåœ¨æ¯ä¸ª slot ä¸­ï¼Œç½‘ç»œä¸­çš„éªŒè¯è€…å°†æœ‰æœºä¼šæè®®ä¸€ä¸ªæ–°çš„åŒºå—ã€‚è¿™äº›æè®®è€…æ˜¯é€šè¿‡æƒç›Šè¯æ˜ï¼ˆPoSï¼‰éšæœºé€‰æ‹©çš„ã€‚</p><h3 id="Epochï¼ˆçºªå…ƒï¼‰"><a href="#Epochï¼ˆçºªå…ƒï¼‰" class="headerlink" title="Epochï¼ˆçºªå…ƒï¼‰"></a>Epochï¼ˆçºªå…ƒï¼‰</h3><p>å®šä¹‰ï¼šEpoch æ˜¯ç”±å¤šä¸ªè¿ç»­çš„slotç»„æˆçš„æ›´é•¿æ—¶é—´æ®µã€‚åœ¨ Eth2.0 ä¸­ï¼ŒEpoch ç”¨äºç®¡ç†å’Œç»„ç»‡éªŒè¯è€…çš„æ´»åŠ¨ã€‚ ç»„æˆï¼šä¸€ä¸ª Epoch ç”± 32 ä¸ª slot ç»„æˆã€‚ æ—¶é—´é•¿åº¦ï¼šç”±äºä¸€ä¸ª slot æ˜¯12ç§’ï¼Œä¸€ä¸ª Epoch çš„æ€»é•¿åº¦æ˜¯ 384 ç§’ï¼ˆå³6.4åˆ†é’Ÿï¼‰ã€‚ åŠŸèƒ½ï¼šEpoch æ˜¯ç”¨æ¥å®ç°å…±è¯†æœºåˆ¶çš„ä¸€éƒ¨åˆ†ã€‚åœ¨æ¯ä¸ª Epoch ç»“æŸæ—¶ï¼Œç½‘ç»œä¼šè¿›è¡ŒçŠ¶æ€å’Œå…±è¯†çš„æ£€æŸ¥å’Œè°ƒæ•´ï¼ŒåŒ…æ‹¬å¯¹éªŒè¯è€…çš„å¥–åŠ±å’Œæƒ©ç½šã€‚</p><h3 id="Blockï¼ˆåŒºå—ï¼‰"><a href="#Blockï¼ˆåŒºå—ï¼‰" class="headerlink" title="Blockï¼ˆåŒºå—ï¼‰"></a>Blockï¼ˆåŒºå—ï¼‰</h3><p>å®šä¹‰ï¼šBlock æ˜¯åŒ…å«äº¤æ˜“å’Œå…¶ä»–ç›¸å…³æ•°æ®çš„è®°å½•å•å…ƒã€‚åœ¨ä»¥å¤ªåŠ2.0ä¸­ï¼Œæ¯ä¸ªslotå¯èƒ½ä¼šæœ‰ä¸€ä¸ªåŒºå—è¢«æè®®ï¼Œä½†ä¸ä¿è¯æ¯ä¸ª slot éƒ½æœ‰åŒºå—ã€‚ å†…å®¹ï¼šä¸€ä¸ªåŒºå—åŒ…å«åŒºå—å¤´ã€äº¤æ˜“åˆ—è¡¨ã€çŠ¶æ€æ ¹å“ˆå¸Œã€ç­¾åç­‰æ•°æ®ã€‚ åˆ›å»ºè¿‡ç¨‹ï¼šåœ¨æ¯ä¸ª slot å¼€å§‹æ—¶ï¼Œç½‘ç»œä¼šéšæœºé€‰å‡ºä¸€ä¸ªéªŒè¯è€…æ¥æè®®åŒºå—ã€‚è¯¥éªŒè¯è€…å°†åˆ›å»ºä¸€ä¸ªåŒ…å«æ–°äº¤æ˜“å’Œå…¶ä»–å¿…è¦ä¿¡æ¯çš„åŒºå—ï¼Œå¹¶å¹¿æ’­åˆ°ç½‘ç»œä¸­ã€‚</p><h2 id="12-ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘ä¸­ä¸ºä»€ä¹ˆéœ€è¦ç¡®è®¤ä½ï¼Œæ‚¨æ€ä¹ˆç†è§£è¿™ä¸ªç¡®è®¤ä½çš„"><a href="#12-ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘ä¸­ä¸ºä»€ä¹ˆéœ€è¦ç¡®è®¤ä½ï¼Œæ‚¨æ€ä¹ˆç†è§£è¿™ä¸ªç¡®è®¤ä½çš„" class="headerlink" title="12.ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘ä¸­ä¸ºä»€ä¹ˆéœ€è¦ç¡®è®¤ä½ï¼Œæ‚¨æ€ä¹ˆç†è§£è¿™ä¸ªç¡®è®¤ä½çš„"></a>12.ä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘ä¸­ä¸ºä»€ä¹ˆéœ€è¦ç¡®è®¤ä½ï¼Œæ‚¨æ€ä¹ˆç†è§£è¿™ä¸ªç¡®è®¤ä½çš„</h2><p>åœ¨ç¡®è®¤ä½è¿‡äº†ä¹‹åäº¤æ˜“å›æ»šçš„éš¾åº¦å¾ˆå¤§ï¼Œæ¯æ¡é“¾ä¸ä¸€æ ·ï¼Œæ ¹æ®å†å²å’Œç»éªŒæ¥å®šï¼Œä»¥å¤ªåŠçš„è¯å¯ä»¥å‚ç…§åŒºå—çŠ¶æ€æ¥åš</p><h2 id="13-ç®€å•æè¿°ä»¥å¤ªåŠäº¤æ˜“ç±»å‹ï¼Œå¹¶è¯´æ˜è¿™ä¸ªäº¤æ˜“ç±»å‹çš„ä½œç”¨"><a href="#13-ç®€å•æè¿°ä»¥å¤ªåŠäº¤æ˜“ç±»å‹ï¼Œå¹¶è¯´æ˜è¿™ä¸ªäº¤æ˜“ç±»å‹çš„ä½œç”¨" class="headerlink" title="13.ç®€å•æè¿°ä»¥å¤ªåŠäº¤æ˜“ç±»å‹ï¼Œå¹¶è¯´æ˜è¿™ä¸ªäº¤æ˜“ç±»å‹çš„ä½œç”¨"></a>13.ç®€å•æè¿°ä»¥å¤ªåŠäº¤æ˜“ç±»å‹ï¼Œå¹¶è¯´æ˜è¿™ä¸ªäº¤æ˜“ç±»å‹çš„ä½œç”¨</h2><ul><li>leagcy: å†å²é—ç•™äº¤æ˜“ç±»å‹ï¼Œç­¾åä½“ä¸º gasLimit å’Œ gasPrice</li><li>Eip1559: BaseFee ç±»å‹</li><li>blob: EIP4844 äº¤æ˜“ç±»å‹</li></ul><h2 id="14-å»ä¸­å¿ƒåŒ–å’Œä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘ä¸­çš„å¼‚åŒç‚¹æœ‰å“ªäº›ï¼Ÿ"><a href="#14-å»ä¸­å¿ƒåŒ–å’Œä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘ä¸­çš„å¼‚åŒç‚¹æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="14.å»ä¸­å¿ƒåŒ–å’Œä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘ä¸­çš„å¼‚åŒç‚¹æœ‰å“ªäº›ï¼Ÿ"></a>14.å»ä¸­å¿ƒåŒ–å’Œä¸­å¿ƒåŒ–é’±åŒ…å¼€å‘ä¸­çš„å¼‚åŒç‚¹æœ‰å“ªäº›ï¼Ÿ</h2><p><strong>1ã€å¯†é’¥ç®¡ç†æ–¹å¼ä¸åŒ</strong></p><p>HD é’±åŒ…ç§é’¥åœ¨æœ¬åœ°è®¾å¤‡ï¼Œç§é’¥ç”¨æˆ·è‡ªå·±æ§åˆ¶ äº¤æ˜“æ‰€é’±åŒ…ä¸­å¿ƒåŒ–æœåŠ¡å™¨(CloadHSM, TEE ç­‰)ï¼Œç§é’¥é¡¹ç›®æ–¹æ§åˆ¶</p><p><strong>2ã€èµ„é‡‘å­˜åœ¨æ–¹å¼ä¸åŒ</strong></p><p>HD èµ„é‡‘åœ¨ç”¨æˆ·é’±åŒ…åœ°å€ äº¤æ˜“æ‰€é’±åŒ…èµ„é‡‘åœ¨äº¤æ˜“æ‰€çƒ­é’±åŒ…æˆ–è€…å†·é’±åŒ…é‡Œé¢</p><p><strong>3ã€ä¸šåŠ¡é€»è¾‘ä¸ä¸€è‡´</strong></p><p>ä¸­å¿ƒåŒ–é’±åŒ…ï¼šå®æ—¶ä¸æ–­æ‰«é“¾æ›´æ–°äº¤æ˜“æ•°æ®å’ŒçŠ¶æ€</p><p> HD é’±åŒ…ï¼šæ ¹æ®ç”¨æˆ·çš„æ“ä½œé€šè¿‡è¯·æ±‚æ¥å£å®ç°ä¸šåŠ¡é€»è¾‘</p><h2 id="15-å‘ç”Ÿç¡¬åˆ†å‰æ—¶ï¼Œåšä¸ºé’±åŒ…çš„å¼€å‘ï¼Œæ‚¨åº”å½“æ€ä¹ˆå»å¤„ç†è¿™ç§çŠ¶å†µï¼Œ-ä»¥-ETHPOW-å’Œ-ETH2-0-åˆ†å‰è¿™ä¸ªè¿‡ç¨‹"><a href="#15-å‘ç”Ÿç¡¬åˆ†å‰æ—¶ï¼Œåšä¸ºé’±åŒ…çš„å¼€å‘ï¼Œæ‚¨åº”å½“æ€ä¹ˆå»å¤„ç†è¿™ç§çŠ¶å†µï¼Œ-ä»¥-ETHPOW-å’Œ-ETH2-0-åˆ†å‰è¿™ä¸ªè¿‡ç¨‹" class="headerlink" title="15.å‘ç”Ÿç¡¬åˆ†å‰æ—¶ï¼Œåšä¸ºé’±åŒ…çš„å¼€å‘ï¼Œæ‚¨åº”å½“æ€ä¹ˆå»å¤„ç†è¿™ç§çŠ¶å†µï¼Œ ä»¥ ETHPOW å’Œ ETH2.0 åˆ†å‰è¿™ä¸ªè¿‡ç¨‹"></a>15.å‘ç”Ÿç¡¬åˆ†å‰æ—¶ï¼Œåšä¸ºé’±åŒ…çš„å¼€å‘ï¼Œæ‚¨åº”å½“æ€ä¹ˆå»å¤„ç†è¿™ç§çŠ¶å†µï¼Œ ä»¥ ETHPOW å’Œ ETH2.0 åˆ†å‰è¿™ä¸ªè¿‡ç¨‹</h2><p>è®¤å¯å…±è¯†æ¯”è¾ƒ</p><h2 id="16-TON-æ”¯æŒåˆçº¦å—ï¼Ÿè‹¥æ”¯æŒï¼Œè¯·è¯´å‡ºå…¶åˆçº¦å¼€å‘è¯­è¨€"><a href="#16-TON-æ”¯æŒåˆçº¦å—ï¼Ÿè‹¥æ”¯æŒï¼Œè¯·è¯´å‡ºå…¶åˆçº¦å¼€å‘è¯­è¨€" class="headerlink" title="16.TON æ”¯æŒåˆçº¦å—ï¼Ÿè‹¥æ”¯æŒï¼Œè¯·è¯´å‡ºå…¶åˆçº¦å¼€å‘è¯­è¨€"></a>16.TON æ”¯æŒåˆçº¦å—ï¼Ÿè‹¥æ”¯æŒï¼Œè¯·è¯´å‡ºå…¶åˆçº¦å¼€å‘è¯­è¨€</h2><h2 id="17-æ¯”ç‰¹å¸çš„åœ°å€æœ‰å“ªäº›æ ¼å¼ï¼Œè¯·è¯´æ˜"><a href="#17-æ¯”ç‰¹å¸çš„åœ°å€æœ‰å“ªäº›æ ¼å¼ï¼Œè¯·è¯´æ˜" class="headerlink" title="17.æ¯”ç‰¹å¸çš„åœ°å€æœ‰å“ªäº›æ ¼å¼ï¼Œè¯·è¯´æ˜"></a>17.æ¯”ç‰¹å¸çš„åœ°å€æœ‰å“ªäº›æ ¼å¼ï¼Œè¯·è¯´æ˜</h2><p>P2SH</p><p>P2WP</p><p>P2PKH</p><p>P2TP</p><h2 id="18-æè¿°ä¸€ä¸‹-UTXO-å’Œè´¦æˆ·æ¨¡å‹çš„åŒºåˆ«"><a href="#18-æè¿°ä¸€ä¸‹-UTXO-å’Œè´¦æˆ·æ¨¡å‹çš„åŒºåˆ«" class="headerlink" title="18.æè¿°ä¸€ä¸‹ UTXO å’Œè´¦æˆ·æ¨¡å‹çš„åŒºåˆ«"></a>18.æè¿°ä¸€ä¸‹ UTXO å’Œè´¦æˆ·æ¨¡å‹çš„åŒºåˆ«</h2><p> UTXOï¼šæœªèŠ±è´¹çš„äº¤æ˜“è¾“å‡º</p><p>åœ¨UTXOæ¨¡å‹ä¸­ï¼Œæ¯ä¸ªäº¤æ˜“è¾“å‡ºéƒ½è¢«è§†ä¸ºæœªä½¿ç”¨çš„äº¤æ˜“è¾“å‡ºï¼ˆUTXOï¼‰ã€‚UXTOä»£è¡¨äº†ä¸€å®šæ•°é‡çš„åŠ å¯†è´§å¸ï¼Œä»–ä»¬è¢«é”å®šåœ¨ä¸€ä¸ªç‰¹å®šçš„åœ°å€ä¸Šï¼Œå¹¶ä¸”åªèƒ½é€šè¿‡ä½¿ç”¨ç§é’¥æ¥è§£é”ã€‚å½“è¿›è¡Œäº¤æ˜“æ—¶ï¼Œéœ€è¦ä½¿ç”¨å…ˆå‰æœªä½¿ç”¨çš„UTXOä½œä¸ºè¾“å…¥ï¼Œå¹¶å°†å…¶æ¶ˆè€—æ‰ï¼ŒåŒäº‹ç”Ÿæˆæ–°çš„UTXOä½œä¸ºè¾“å‡ºã€‚</p><p>è´¦æˆ·æ¨¡å‹ï¼š</p><p>æ¯ä¸ªè´¦æˆ·è¢«è§†ä¸ºåŒ…å«ä½™é¢å’ŒçŠ¶æ€çš„å®ä½“ã€‚ç”¨æˆ·æ‹¥æœ‰ä¸€ä¸ªç§é’¥å¯¹åº”è´¦æˆ·åœ°å€ï¼Œå¯ä»¥ä½¿ç”¨ç§é’¥å¯¹è´¦æˆ·è¿›è¡Œå‰é¢æ¥è¿›è¡Œäº¤æ˜“ã€‚æ¯ä¸ªè´¦æˆ·çš„ä½™é¢å­˜å‚¨åœ¨é“¾ä¸Šï¼Œå½“å‘ç”Ÿäº¤æ˜“æ—¶ï¼Œè´¦æˆ·çš„ä½™é¢ä¼šç›¸åº”åœ°å¢åŠ æˆ–å‡å°‘ã€‚</p><h2 id="20-è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯-EVM-åŒæºé“¾ï¼Œä¸¾ä¾‹è¯´æ˜ä¸€ä¸‹"><a href="#20-è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯-EVM-åŒæºé“¾ï¼Œä¸¾ä¾‹è¯´æ˜ä¸€ä¸‹" class="headerlink" title="20.è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯ EVM åŒæºé“¾ï¼Œä¸¾ä¾‹è¯´æ˜ä¸€ä¸‹"></a>20.è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯ EVM åŒæºé“¾ï¼Œä¸¾ä¾‹è¯´æ˜ä¸€ä¸‹</h2><h2 id="21-ERC721-å’Œ-ERC1155-åŒºåˆ«ä¸è”ç³»"><a href="#21-ERC721-å’Œ-ERC1155-åŒºåˆ«ä¸è”ç³»" class="headerlink" title="21.ERC721 å’Œ ERC1155 åŒºåˆ«ä¸è”ç³»"></a>21.ERC721 å’Œ ERC1155 åŒºåˆ«ä¸è”ç³»</h2><h1 id="ä¸€äº›æ„Ÿæ‚Ÿ"><a href="#ä¸€äº›æ„Ÿæ‚Ÿ" class="headerlink" title="ä¸€äº›æ„Ÿæ‚Ÿ"></a>ä¸€äº›æ„Ÿæ‚Ÿ</h1><p>æœ€æ ¸å¿ƒçš„ä¸æ˜¯æ‰«é“¾ï¼Œä¸æ˜¯è·å–ç”¨æˆ·æ•°æ®ã€äº¤æ˜“æ•°æ®ï¼Œæ¥å£æ¯”è¾ƒç®€å•</p><p>æœ€æ ¸å¿ƒçš„æ°¸è¿œéƒ½æ˜¯ç¦»çº¿åœ°å€çš„ç”Ÿæˆå’Œç­¾åäº¤æ˜“çš„ç”Ÿæˆ</p><h3 id="åŒä¸€å¥—åŠ©è®°è¯åœ¨ä¸åŒçš„é“¾ç”Ÿæˆçš„ç§é’¥ä¸ä¸€æ ·å—ï¼Ÿ"><a href="#åŒä¸€å¥—åŠ©è®°è¯åœ¨ä¸åŒçš„é“¾ç”Ÿæˆçš„ç§é’¥ä¸ä¸€æ ·å—ï¼Ÿ" class="headerlink" title="åŒä¸€å¥—åŠ©è®°è¯åœ¨ä¸åŒçš„é“¾ç”Ÿæˆçš„ç§é’¥ä¸ä¸€æ ·å—ï¼Ÿ"></a>åŒä¸€å¥—åŠ©è®°è¯åœ¨ä¸åŒçš„é“¾ç”Ÿæˆçš„ç§é’¥ä¸ä¸€æ ·å—ï¼Ÿ</h3><p>ä¸ä¸€æ ·</p><p>COSMOSæ”¯æŒçš„åœ°å€ç±»å‹</p><p>ä»¥å‰åªæ”¯æŒSecp256k1åæ¥æ‰©å±•æ”¯æŒEdd25519</p>]]></content>
    
    
    <categories>
      
      <category>blockChain</category>
      
    </categories>
    
    
    <tags>
      
      <tag>block</tag>
      
      <tag>æ¦‚å¿µ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>05-02 Bitcoiné’±åŒ…Schnorråœ°å€ç”Ÿæˆä¸ç­¾å</title>
    <link href="/2024/05/28/05-2Bitcoin%E9%92%B1%E5%8C%85Schnorr%E5%9C%B0%E5%9D%80%E7%94%9F%E6%88%90%E4%B8%8E%E7%AD%BE%E5%90%8D/"/>
    <url>/2024/05/28/05-2Bitcoin%E9%92%B1%E5%8C%85Schnorr%E5%9C%B0%E5%9D%80%E7%94%9F%E6%88%90%E4%B8%8E%E7%AD%BE%E5%90%8D/</url>
    
    <content type="html"><![CDATA[<h1 id="1-Schnorrç­¾å"><a href="#1-Schnorrç­¾å" class="headerlink" title="1.Schnorrç­¾å"></a>1.Schnorrç­¾å</h1><h2 id="1-1-ç­¾åæµç¨‹"><a href="#1-1-ç­¾åæµç¨‹" class="headerlink" title="1.1 ç­¾åæµç¨‹"></a>1.1 ç­¾åæµç¨‹</h2><h3 id="å¯†é’¥ç”Ÿæˆï¼ˆKey-Generationï¼‰"><a href="#å¯†é’¥ç”Ÿæˆï¼ˆKey-Generationï¼‰" class="headerlink" title="å¯†é’¥ç”Ÿæˆï¼ˆKey Generationï¼‰"></a>å¯†é’¥ç”Ÿæˆï¼ˆKey Generationï¼‰</h3><ul><li>ç§é’¥ ğ‘˜<em>k</em> æ˜¯ä¸€ä¸ªéšæœºé€‰æ‹©çš„æ•´æ•°ï¼ŒèŒƒå›´ä¸º [1,ğ‘›âˆ’1]ï¼Œå…¶ä¸­ ğ‘› æ˜¯æ¤­åœ†æ›²çº¿çš„é˜¶ã€‚,</li><li>å…¬é’¥ ğ‘ƒ<em>P</em> æ˜¯é€šè¿‡å°†ç§é’¥ä¹˜ä»¥æ¤­åœ†æ›²çº¿çš„åŸºç‚¹ ğº<em>G</em> å¾—åˆ°çš„ï¼Œå³ ğ‘ƒ&#x3D;ğ‘˜â‹…ğºã€‚</li></ul><h3 id="ç­¾åç”Ÿæˆï¼ˆSignature-Generationï¼‰"><a href="#ç­¾åç”Ÿæˆï¼ˆSignature-Generationï¼‰" class="headerlink" title="ç­¾åç”Ÿæˆï¼ˆSignature Generationï¼‰"></a>ç­¾åç”Ÿæˆï¼ˆSignature Generationï¼‰</h3><p>å‡è®¾æ¶ˆæ¯ä¸º ğ‘šã€‚</p><ul><li>ç”Ÿæˆéšæœºæ•° ğ‘Ÿï¼šé€‰æ‹©ä¸€ä¸ªéšæœºæ•° ğ‘Ÿ<em>r</em> ä½œä¸ºä¸´æ—¶ç§é’¥ï¼ŒèŒƒå›´ä¸º [1,ğ‘›âˆ’1]ã€‚</li><li>è®¡ç®—éäº¤äº’å¼æŒ‘æˆ˜ï¼šè®¡ç®— ğ‘…&#x3D;ğ‘Ÿâ‹…ğºï¼Œå…¶ä¸­ ğº æ˜¯æ¤­åœ†æ›²çº¿çš„åŸºç‚¹ã€‚</li><li>è®¡ç®—å“ˆå¸Œå€¼ï¼šè®¡ç®—å“ˆå¸Œå€¼ ğ‘’ï¼š</li></ul><p>ğ‘’&#x3D;H(ğ‘…âˆ¥ğ‘ƒâˆ¥ğ‘š)</p><ul><li>å…¶ä¸­ H æ˜¯ä¸€ä¸ªå“ˆå¸Œå‡½æ•°ï¼Œå¦‚ SHA-256ï¼Œğ‘…âˆ¥ğ‘ƒâˆ¥ğ‘š è¡¨ç¤º ğ‘…ã€å…¬é’¥ ğ‘ƒ å’Œæ¶ˆæ¯ ğ‘š çš„è¿æ¥ã€‚</li><li>è®¡ç®—ç­¾åï¼šè®¡ç®—ç­¾å ğ‘ ï¼š</li></ul><p>ğ‘ &#x3D;ğ‘Ÿ+ğ‘’â‹…ğ‘˜(modğ‘›)</p><ul><li>å…¶ä¸­ ğ‘˜ æ˜¯ç§é’¥ï¼Œğ‘’ æ˜¯å“ˆå¸Œå€¼ï¼Œğ‘›<em>n</em>æ˜¯æ¤­åœ†æ›²çº¿çš„é˜¶ã€‚</li></ul><p>ç­¾åç”± (ğ‘…,ğ‘ )ç»„æˆã€‚</p><h3 id="ç­¾åéªŒè¯ï¼ˆSignature-Verificationï¼‰"><a href="#ç­¾åéªŒè¯ï¼ˆSignature-Verificationï¼‰" class="headerlink" title="ç­¾åéªŒè¯ï¼ˆSignature Verificationï¼‰"></a>ç­¾åéªŒè¯ï¼ˆSignature Verificationï¼‰</h3><ul><li>è®¡ç®—å“ˆå¸Œå€¼ï¼šé‡æ–°è®¡ç®—å“ˆå¸Œå€¼ ğ‘’ï¼š</li></ul><p>ğ‘’&#x3D;H(ğ‘…âˆ¥ğ‘ƒâˆ¥ğ‘š)</p><ul><li>éªŒè¯ç­‰å¼ï¼šéªŒè¯ä»¥ä¸‹ç­‰å¼æ˜¯å¦æˆç«‹ï¼š</li></ul><p>ğ‘ â‹…ğº&#x3D;ğ‘…+ğ‘’â‹…ğ‘ƒ</p><ul><li>å¦‚æœç­‰å¼æˆç«‹ï¼Œç­¾åæ˜¯æœ‰æ•ˆçš„ï¼›å¦åˆ™æ— æ•ˆ</li></ul><p>çœ‹ä¸æ‡‚æ²¡å…³ç³»ï¼Œæˆ‘ä¹Ÿçœ‹ä¸æ‡‚ï¼Œæœ‰ä¸ªæ¦‚å¿µçŸ¥é“æ˜¯è¿™<strong>ä¸‰ä¸ªæ­¥éª¤</strong>å³å¯</p><h2 id="1-2-ç­¾åç‰¹ç‚¹"><a href="#1-2-ç­¾åç‰¹ç‚¹" class="headerlink" title="1.2 ç­¾åç‰¹ç‚¹"></a>1.2 ç­¾åç‰¹ç‚¹</h2><p><strong>ç®€æ´æ€§</strong></p><ul><li>Schnorrç­¾åç®—æ³•ç»“æ„ç®€å•ï¼Œç­¾åè¿‡ç¨‹å’ŒéªŒè¯è¿‡ç¨‹éƒ½è¾ƒä¸ºç›´è§‚ã€‚</li><li>è¿™ç§ç®€æ´æ€§æœ‰åŠ©äºå®ç°å’Œåˆ†æå®‰å…¨æ€§</li></ul><p><strong>å®‰å…¨æ€§</strong></p><ul><li>ä¸å¯ä¼ªé€ ï¼šåŸºäºç¦»æ•£å¯¹æ•°é—®é¢˜çš„å›°éš¾æ€§ï¼ŒSchnorrç­¾ååœ¨å½“å‰å·²çŸ¥çš„è®¡ç®—èƒ½åŠ›ä¸‹è¢«è®¤ä¸ºæ˜¯å®‰å…¨çš„</li><li>æ¬§å¼è¯æ˜ï¼šæœ‰ä¸¥æ ¼çš„æ¬§å¼å®‰å…¨æ€§è¯æ˜ã€‚</li></ul><p><strong>é«˜æ•ˆæ€§</strong>ï¼š</p><ul><li>è®¡ç®—æ•ˆç‡ï¼šç­¾åç”Ÿæˆå’ŒéªŒè¯çš„è®¡ç®—æ•ˆç‡è¾ƒé«˜ã€‚å°¤å…¶åœ¨æ‰¹é‡ç­¾åéªŒè¯ä¸­ï¼ŒSchnorr ç­¾åå…·æœ‰æ˜¾è‘—çš„æ€§èƒ½ä¼˜åŠ¿ã€‚</li><li>ç­¾åé•¿åº¦ï¼šSchnorr ç­¾åçš„é•¿åº¦è¾ƒçŸ­ï¼Œç›¸æ¯”äº ECDSA ç­¾åï¼ŒSchnorr ç­¾åå ç”¨çš„å­˜å‚¨ç©ºé—´æ›´å°‘ã€‚å› ä¸ºç­¾åè¶ŠçŸ­â€”â€“&gt;æ‰€ä»¥èŠ±è´¹çš„gas feeså°±è¶Šå°‘ï¼Œ</li></ul><p><strong>æ‰©å±•æ€§å’Œå…¼å®¹æ€§</strong></p><p>Schnorr ç­¾åæ”¯æŒå¤šç§æ‰©å±•åŠŸèƒ½ï¼Œå¦‚å¤šé‡ç­¾åï¼ˆMuSigï¼‰å’Œèšåˆç­¾åã€‚è¿™äº›æ‰©å±•åŠŸèƒ½åœ¨å¢å¼ºéšç§æ€§å’Œå¯æ‰©å±•æ€§æ–¹é¢è¡¨ç°å‡ºè‰²ã€‚</p><ul><li>å¤šé‡ç­¾åï¼ˆMuSigï¼‰ï¼šSchnorr ç­¾åå…è®¸å¤šä¸ªç­¾åè€…çš„å…¬é’¥å’Œç­¾åèšåˆä¸ºå•ä¸€çš„å…¬é’¥å’Œç­¾åï¼Œè¿™æ˜¾è‘—æé«˜äº†å¤šé‡ç­¾åçš„æ•ˆç‡å’Œéšç§æ€§ã€‚</li><li>å…¼å®¹æ€§ï¼šSchnorr ç­¾åä¸ç°æœ‰çš„æ¤­åœ†æ›²çº¿åŠ å¯†æ ‡å‡†å…¼å®¹ï¼Œä¾¿äºåœ¨ç°æœ‰ç³»ç»Ÿä¸­å®ç°å’Œéƒ¨ç½²ã€‚</li></ul><h2 id="1-3-ç­¾åç®—æ³•Pythonä»£ç å®ç°"><a href="#1-3-ç­¾åç®—æ³•Pythonä»£ç å®ç°" class="headerlink" title="1.3 ç­¾åç®—æ³•Pythonä»£ç å®ç°"></a>1.3 ç­¾åç®—æ³•Pythonä»£ç å®ç°</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment"># schnorr.py</span><br><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">from</span> ecdsa <span class="hljs-keyword">import</span> SECP256k1, SigningKey, VerifyingKey<br><span class="hljs-keyword">from</span> ecdsa.curves <span class="hljs-keyword">import</span> Curve<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SchnorrSignObj</span>:<br>    curve: Curve<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-comment"># æ¤­åœ†æ›²çº¿å‚æ•°</span><br>        self.curve = SECP256k1 <span class="hljs-comment"># curveå°±æ˜¯æ¤­åœ†æ›²çº¿å¯¹è±¡ï¼ŒSECP256k1å°±æ˜¯å¸¸è§çš„æ¤­åœ†æ›²çº¿</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">schnorr_sign</span>(<span class="hljs-params">self, private_key, message</span>): <span class="hljs-comment"># ç­¾åå‡½æ•°ï¼Œä¼ ç§é’¥å’Œmsg</span><br>        <span class="hljs-comment"># ç”Ÿæˆç§é’¥å’Œå…¬é’¥</span><br>        signing_key = SigningKey.from_string(private_key, curve=self.curve) <span class="hljs-comment"># ä½¿ç”¨ç§é’¥å’Œæ¤­åœ†æ›²çº¿å¯¹è±¡ç”Ÿæˆä¸€ä¸ªç­¾åå¯¹è±¡</span><br>        verifying_key = signing_key.get_verifying_key() <span class="hljs-comment"># ä»ç­¾åç§˜é’¥å¯¹è±¡è·å¾—å…¬é’¥ï¼Œverifying_keyå°±æ˜¯å…¬é’¥ï¼Œè¿”å›ä¸€ä¸ªå…¬é’¥keyå¯ä»¥ç”¨æ¥éªŒè¯ç­¾å</span><br><br>        <span class="hljs-comment"># ç”Ÿæˆéšæœºæ•° r</span><br>        r = SigningKey.generate(curve=self.curve).privkey.secret_multiplier <span class="hljs-comment"># ç”Ÿæˆéšæœºæ•°ä½œä¸ºç­¾åçš„ä¸€éƒ¨åˆ†</span><br>        R = VerifyingKey.from_public_point(r * self.curve.generator, curve=self.curve) <span class="hljs-comment"># ä½¿ç”¨éšæœºæ•°rä¹˜ä»¥æ¤­åœ†æ›²çº¿çš„ç”Ÿæˆå…ƒï¼Œå¾—åˆ°ç­¾åä¸­çš„æŒ‘æˆ˜ç‚¹Rã€‚</span><br><br>        <span class="hljs-comment"># è®¡ç®—å“ˆå¸Œ e</span><br>        e = hashlib.sha256(R.to_string() + verifying_key.to_string() + message).digest() <span class="hljs-comment"># è¿™ä¸ªä¹‹å‰å­¦è¿‡ï¼Œsha256åŠ å¯†è¿”å›å“ˆå¸Œè®¡ç®—ç»“æœçš„äºŒè¿›åˆ¶è¡¨ç¤ºï¼Œä¼ å…¥æŒ‘æˆ˜ç‚¹R+å…¬é’¥+msg</span><br>        e = <span class="hljs-built_in">int</span>.from_bytes(e, <span class="hljs-string">&#x27;big&#x27;</span>) <span class="hljs-comment"># å°†å­—èŠ‚å¯¹è±¡è½¬æˆå¤§æ•´æ•°ï¼Œbigè¡¨ç¤ºå¤§ç«¯å­—èŠ‚æ•°</span><br><br>        <span class="hljs-comment"># è®¡ç®—ç­¾å s</span><br>        s = (r + e * signing_key.privkey.secret_multiplier) % self.curve.order <span class="hljs-comment"># è®¡ç®—ç­¾åä¸­çš„sï¼Œæ ¹æ®Schnorrç­¾åç®—æ³•çš„è®¡ç®—å…¬å¼ï¼Œå°†éšæœºæ•°rå’Œå“ˆå¸Œeä¸ç§é’¥çš„å€æ•°ç›¸åŠ ï¼Œå¹¶å¯¹æ¤­åœ†æ›²çº¿çš„é˜¶æ•°å–æ¨¡ã€‚</span><br>        <span class="hljs-keyword">return</span> R.to_string(), s.to_bytes(<span class="hljs-number">32</span>, <span class="hljs-string">&#x27;big&#x27;</span>) <span class="hljs-comment"># è¿”å›æŒ‘æˆ˜ç‚¹ R çš„å­—ç¬¦ä¸²ï¼Œå’Œç­¾åsçš„32å­—èŠ‚å¤§ç«¯å­—èŠ‚ä¸²è¡¨ç¤ºã€‚</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">schnorr_verify</span>(<span class="hljs-params">self, public_key, message, signature</span>): <span class="hljs-comment"># ç­¾åéªŒè¯ï¼Œä¼ å…¥å…¬é’¥ï¼Œmsgï¼Œ ç­¾åsignature</span><br>        <span class="hljs-comment"># è§£æç­¾å</span><br>        R = VerifyingKey.from_string(signature[<span class="hljs-number">0</span>], curve=self.curve) <span class="hljs-comment"># ä»ç­¾åä¸­è§£ææŒ‘æˆ˜ç‚¹ R ï¼Œä¼ å…¥å¯¹åº”çš„æ¤­åœ†æ›²çº¿å¯¹è±¡</span><br>        s = <span class="hljs-built_in">int</span>.from_bytes(signature[<span class="hljs-number">1</span>], <span class="hljs-string">&#x27;big&#x27;</span>) <span class="hljs-comment"># ä»ç­¾åæ¶ˆæ¯ä¸­è§£æç­¾å så¤§ç«¯å­—èŠ‚ä¸²è¡¨ç¤º</span><br><br>        <span class="hljs-comment"># è®¡ç®—å“ˆå¸Œ e</span><br>        e = hashlib.sha256(signature[<span class="hljs-number">0</span>] + public_key.to_string() + message).digest() <span class="hljs-comment"># sha256åŠ å¯†è¿”å›å“ˆå¸Œè®¡ç®—ç»“æœçš„äºŒè¿›åˆ¶è¡¨ç¤ºï¼Œä¼ å…¥ç­¾å[0] + å…¬é’¥ + msg</span><br>        e = <span class="hljs-built_in">int</span>.from_bytes(e, <span class="hljs-string">&#x27;big&#x27;</span>) <span class="hljs-comment"># å°†å­—èŠ‚å¯¹è±¡è½¬æˆå¤§æ•´æ•°ï¼Œbigè¡¨ç¤ºå¤§ç«¯å­—èŠ‚æ•°</span><br><br>        <span class="hljs-comment"># éªŒè¯ç­¾å</span><br>        sG = VerifyingKey.from_public_point(s * self.curve.generator, curve=self.curve) <span class="hljs-comment"># ä»å…¬é’¥è·å–æŒ‡é’ˆï¼ˆåˆå§‹åŒ–éªŒè¯å…¬é’¥å¯¹è±¡ï¼‰ï¼Œä¼ å…¥å°†ç”Ÿæˆå…ƒä¹˜ä»¥ s å€¼ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„ç‚¹ã€‚self.curveï¼šè¡¨ç¤ºä½¿ç”¨ç›¸åŒçš„æ¤­åœ†æ›²çº¿å¯¹è±¡è¿›è¡Œè®¡ç®—ã€‚</span><br>        <span class="hljs-comment"># Rï¼šæ˜¯æŒ‘æˆ˜ç‚¹ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ¤­åœ†æ›²çº¿ä¸Šçš„ç‚¹ï¼ŒR.pubkey.pointï¼šè¡¨ç¤ºæŒ‘æˆ˜ç‚¹ R çš„å…¬é’¥ç‚¹ã€‚</span><br>        <span class="hljs-comment"># eï¼šæ˜¯å“ˆå¸Œå€¼ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ•´æ•°public_key.pubkey.pointï¼šè¡¨ç¤ºå…¬é’¥çš„ç‚¹ï¼Œ</span><br>        <span class="hljs-comment"># public_key.pubkey.pointï¼šè¡¨ç¤ºå…¬é’¥çš„ç‚¹ã€‚</span><br>        ReP = VerifyingKey.from_public_point(R.pubkey.point + e * public_key.pubkey.point, curve=self.curve) <br>        <span class="hljs-keyword">return</span> sG.to_string() == ReP.to_string() <span class="hljs-comment"># éªŒè¯æ˜¯å¦é€šè¿‡</span><br></code></pre></td></tr></table></figure><p>æµ‹è¯•ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># test_schnorr.py</span><br><span class="hljs-keyword">import</span> schnorr <span class="hljs-keyword">as</span> schnorr<br><span class="hljs-comment"># from schnorr import SchnorrSignObj</span><br><span class="hljs-keyword">from</span> ecdsa <span class="hljs-keyword">import</span> SECP256k1, SigningKey, VerifyingKey<br><br><span class="hljs-comment"># åˆå§‹åŒ–ç±»</span><br>schnorr_test = schnorr.SchnorrSignObj()<br><br><span class="hljs-comment"># äº§ç”Ÿå¯†é’¥å¹¶å¯¹äº¤æ˜“ç­¾å</span><br>private_key = SigningKey.generate(curve=SECP256k1).to_string()<br>message = <span class="hljs-string">b&quot;Hello, Schnorr!2222&quot;</span><br>signature = schnorr_test.schnorr_sign(private_key, message)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Signature:&quot;</span>, signature)<span class="hljs-comment"># æ‰“å°çš„æ˜¯å­—èŠ‚</span><br><br><span class="hljs-comment"># éªŒè¯äº¤æ˜“ç­¾å</span><br>public_key = VerifyingKey.from_string(<br>    SigningKey.from_string(private_key, curve=SECP256k1).get_verifying_key().to_string(), curve=SECP256k1)<br>is_valid = schnorr_test.schnorr_verify(public_key, message, signature)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Signature valid:&quot;</span>, is_valid) <span class="hljs-comment"># Signature valid Ture </span><br><br></code></pre></td></tr></table></figure><h2 id="2-BIP86-åè®®"><a href="#2-BIP86-åè®®" class="headerlink" title="2. BIP86 åè®®"></a>2. BIP86 åè®®</h2><p><strong>2.1 ç»“æ„è·¯å¾„</strong> BIP86 æ˜¯ä¸€ç§ä¸“é—¨ä¸ºç”Ÿæˆ Taproot åœ°å€çš„è·¯å¾„æ ‡å‡†ï¼Œç®€åŒ–å¹¶ä¼˜åŒ–äº†ç”Ÿæˆå•å¯†é’¥ Taproot åœ°å€çš„è¿‡ç¨‹ã€‚BIP86 çš„è·¯å¾„ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">m / 86&#x27; / coin_type&#x27; / account&#x27; / change / address_index<br></code></pre></td></tr></table></figure><ul><li>Purpose: å›ºå®šä¸º 86â€™ï¼Œè¡¨ç¤ºéµå¾ª <strong>BIP86</strong> æ ‡å‡†ã€‚</li><li>Coin Type: å®šä¹‰ç‰¹å®šåŠ å¯†è´§å¸çš„<strong>ç±»å‹</strong>ï¼Œå¦‚ 0â€™ è¡¨ç¤º<strong>æ¯”ç‰¹å¸</strong>ã€‚</li><li>Account: è´¦æˆ·<strong>ç´¢å¼•</strong>ï¼Œå…è®¸é’±åŒ…ç®¡ç†å¤šä¸ªç‹¬ç«‹è´¦æˆ·ã€‚</li><li>Change: 0 è¡¨ç¤ºå¤–éƒ¨é“¾ï¼ˆæ”¶æ¬¾åœ°å€ï¼‰<strong>ï¼Œ1 è¡¨ç¤ºå†…éƒ¨é“¾ï¼ˆæ‰¾é›¶åœ°å€</strong>ï¼‰ã€‚</li><li>Address Index: ç”¨äºç”Ÿæˆå…·ä½“åœ°å€çš„<strong>ç´¢å¼•</strong>ã€‚</li></ul><p><strong>2.2.åœ°å€ç”Ÿæˆæ–¹æ³•</strong></p><p>BIP86 ä½¿ç”¨æ–°çš„è·¯å¾„ç»“æ„ç”Ÿæˆ Taproot åœ°å€ï¼Œé€šè¿‡æ¤­åœ†æ›²çº¿ç®—æ³•æ´¾ç”Ÿå…¬é’¥ï¼Œå¹¶å°†å…¶ç¼–ç ä¸º Bech32 æ ¼å¼çš„åœ°å€ã€‚ç”Ÿæˆçš„ Taproot åœ°å€å…·æœ‰æ›´é«˜çš„éšç§æ€§ã€å®‰å…¨æ€§å’Œæ‰©å±•æ€§ã€‚</p><p><strong>2.3.BIP86 çš„ä¼˜åŠ¿</strong></p><ul><li>ç®€æ´æ€§ï¼šBIP86 æä¾›äº†ä¸€ç§ç®€æ´è€Œç›´è§‚çš„è·¯å¾„ç»“æ„ï¼Œç”¨äºç”Ÿæˆ Taproot åœ°å€ã€‚</li><li>å®‰å…¨æ€§ï¼šBIP86 ä½¿ç”¨æ¤­åœ†æ›²çº¿ç®—æ³•ç”Ÿæˆå…¬é’¥ï¼Œå…·æœ‰ä¸æ¯”ç‰¹å¸çš„ç°æœ‰åœ°å€ç”Ÿæˆæ–¹æ³•ç›¸å½“çš„å®‰å…¨æ€§ã€‚</li><li>å¯æ‰©å±•æ€§ï¼šBIP86 æ”¯æŒä¸åŒçš„å¸ç§å’Œè´¦æˆ·ï¼Œå…·æœ‰è‰¯å¥½çš„å¯æ‰©å±•æ€§ã€‚</li></ul><h2 id="3-BIP44-ä¸-BIP86-çš„åŒºåˆ«ä¸è”ç³»"><a href="#3-BIP44-ä¸-BIP86-çš„åŒºåˆ«ä¸è”ç³»" class="headerlink" title="3. BIP44 ä¸ BIP86 çš„åŒºåˆ«ä¸è”ç³»"></a>3. BIP44 ä¸ BIP86 çš„åŒºåˆ«ä¸è”ç³»</h2><p><strong>3.1.ç”¨é€”ä¸Šçš„åŒºåˆ«</strong></p><ul><li>BIP44: é€šç”¨çš„å¤šå¸ç§ã€å¤šè´¦æˆ·ç®¡ç†ï¼Œé€‚ç”¨äºç”Ÿæˆå¤šç§ç±»å‹çš„åœ°å€ï¼ˆP2PKH, P2SH, P2WPKHï¼‰ã€‚</li><li>BIP86: <strong>ä¸“é—¨</strong>ä¸ºç”Ÿæˆå•å¯†é’¥ Taproot åœ°å€è®¾è®¡ï¼Œç®€åŒ–äº†è·¯å¾„å’Œä½¿ç”¨åœºæ™¯ã€‚</li></ul><p><strong>3.2. è·¯å¾„ç»“æ„åŒºåˆ«</strong></p><ul><li>BIP44: m&#x2F;44â€™&#x2F;coin_typeâ€™&#x2F;accountâ€™&#x2F;change&#x2F;address_indexï¼ŒåŒ…å«<strong>å¤šå¸ç§</strong>ã€å¤šè´¦æˆ·å’Œ<strong>å¤šåœ°å€ç±»å‹</strong>ã€‚</li><li>BIP86: m&#x2F;86â€™&#x2F;coin_typeâ€™&#x2F;accountâ€™&#x2F;change&#x2F;address_indexï¼Œä¸“æ³¨äº<strong>å•å¯†é’¥</strong> Taproot åœ°å€ç”Ÿæˆã€‚</li></ul><p><strong>3.3.å¤æ‚æ€§åŒºåˆ«</strong></p><ul><li>BIP44: é€‚ç”¨äºæ›´å¤æ‚çš„å¤šå¸ç§å’Œå¤šè´¦æˆ·éœ€æ±‚ï¼Œ<strong>è·¯å¾„å±‚æ¬¡æ›´ä¸°å¯Œã€‚</strong></li><li>BIP86: ä¸“æ³¨äºå•ä¸€ç”¨é€”ï¼ˆTaproot åœ°å€ï¼‰ï¼Œ<strong>è·¯å¾„å±‚æ¬¡ç®€åŒ–</strong>ã€‚</li></ul><p><strong>3.4.æ ‡å‡†åŒ–åŒºåˆ«</strong></p><ul><li>BIP44: å¹¿æ³›åº”ç”¨äºå„ç§é’±åŒ…å’ŒåŠ å¯†è´§å¸ç®¡ç†ç³»ç»Ÿï¼Œå·²ç»æˆä¸ºç”Ÿæˆç¡®å®šæ€§é’±åŒ…è·¯å¾„çš„æ ‡å‡†ã€‚</li><li>BIP86: ä¸»è¦ç”¨äºæ¯”ç‰¹å¸çš„ Taproot åœ°å€ç”Ÿæˆï¼Œéšç€ Taproot çš„é‡‡ç”¨è€Œå˜å¾—æ›´åŠ æµè¡Œã€‚</li></ul><p><strong>3.5.æ€»ç»“</strong></p><ul><li>BIP44 é€‚ç”¨äºå¤šç§ç±»å‹åœ°å€ç”Ÿæˆï¼Œé€‚åˆæ›´<strong>å¤æ‚</strong>çš„é’±åŒ…ç®¡ç†éœ€æ±‚ã€‚</li><li>BIP86 ä¸“æ³¨äºç”Ÿæˆæ¯”ç‰¹å¸çš„ Taproot åœ°å€ï¼Œè·¯å¾„<strong>ç®€åŒ–</strong>ï¼Œ<strong>ä¸“é—¨</strong>ä¸º Taproot è®¾è®¡ã€‚</li></ul><p>è¿˜æœ‰BIP84åè®®ï¼Œåè®®å¾ˆå¤š</p><h2 id="4-Taproot-ä¸ºä»€ä¹ˆéœ€è¦-BIP86"><a href="#4-Taproot-ä¸ºä»€ä¹ˆéœ€è¦-BIP86" class="headerlink" title="4.Taproot ä¸ºä»€ä¹ˆéœ€è¦ BIP86"></a>4.Taproot ä¸ºä»€ä¹ˆéœ€è¦ BIP86</h2><p><strong>4.1. ä¸“æ³¨äºå•å¯†é’¥ Taproot åœ°å€</strong> ï¼šBIP86 ä¸“é—¨è®¾è®¡ç”¨äºç”Ÿæˆå•å¯†é’¥ Taproot åœ°å€ã€‚Taproot æ˜¯æ¯”ç‰¹å¸çš„ä¸€é¡¹é‡è¦å‡çº§ï¼Œæ—¨åœ¨æé«˜<strong>éšç§æ€§</strong>ã€<strong>å¯æ‰©å±•æ€§</strong>å’Œæ™ºèƒ½åˆçº¦åŠŸèƒ½ã€‚</p><p><strong>4.2.ç¬¦åˆæ–°æ ‡å‡†å’Œä¼˜åŒ–</strong>ï¼š BIP86 å¼•å…¥äº†ä¸€äº›æ–°çš„ä¼˜åŒ–å’Œæ”¹è¿›ï¼Œä»¥æ”¯æŒæ¯”ç‰¹å¸åè®®çš„æ–°ç‰¹æ€§ï¼Œå¦‚ Taproot å’Œ Schnorr ç­¾åã€‚Taproot å’Œ Schnorr ç­¾åæä¾›äº†æ›´é«˜çš„å®‰å…¨æ€§å’Œæ›´å¥½çš„éšç§ç‰¹æ€§ã€‚BIP86 çš„è®¾è®¡æ˜¯ä¸ºäº†æœ€å¤§é™åº¦åœ°åˆ©ç”¨è¿™äº›æ–°ç‰¹æ€§ã€‚</p><p><strong>4.3.ä¸“æ³¨äºæ¯”ç‰¹å¸å’Œæœªæ¥æ‰©å±•</strong></p><p>BIP44 æ˜¯ä¸€ä¸ªé€šç”¨çš„å¤šå¸ç§å’Œå¤šè´¦æˆ·è·¯å¾„æ ‡å‡†ï¼Œè®¾è®¡ç”¨äºç®¡ç†å„ç§åŠ å¯†è´§å¸çš„åœ°å€ã€‚è¿™ç§é€šç”¨æ€§è™½ç„¶æä¾›äº†å¾ˆå¤§çš„çµæ´»æ€§ï¼Œä½†åœ¨ç‰¹å®šçš„ä¼˜åŒ–å’Œæ–°ç‰¹æ€§æ”¯æŒä¸Šå¯èƒ½ä¸å¦‚ä¸“é—¨è®¾è®¡çš„æ ‡å‡†æœ‰æ•ˆã€‚BIP86 ä¸“é—¨ä¸ºæ¯”ç‰¹å¸è®¾è®¡ï¼Œæ›´å¥½åœ°æ”¯æŒæ¯”ç‰¹å¸çš„æœªæ¥æ‰©å±•å’Œæ”¹è¿›ã€‚</p><p><strong>4.4.ç®€åŒ–è·¯å¾„å’Œæé«˜æ•ˆç‡</strong></p><p>BIP86 è·¯å¾„ç®€åŒ–ï¼Œä¸“æ³¨äºå•ä¸€ç”¨é€”ï¼Œä½¿å…¶æ›´é€‚åˆäºç”Ÿæˆå’Œç®¡ç†æ¯”ç‰¹å¸çš„ Taproot åœ°å€ã€‚è¿™ç§ç®€åŒ–å¯ä»¥å‡å°‘å®ç°å’Œä½¿ç”¨ä¸­çš„å¤æ‚æ€§ï¼Œæé«˜æ•ˆç‡å’Œå®‰å…¨æ€§ã€‚</p><p><strong>4.5.é¿å…æ··æ·†å’Œé”™è¯¯</strong></p><p>BIP86 çš„ä¸“ç”¨è·¯å¾„å‡å°‘äº†ä½¿ç”¨è¿‡ç¨‹ä¸­å¯èƒ½å‡ºç°çš„æ··æ·†å’Œé”™è¯¯ã€‚ç”±äºå®ƒä¸“é—¨è®¾è®¡ç”¨äºæ¯”ç‰¹å¸çš„ Taproot åœ°å€ï¼Œå¼€å‘è€…å’Œç”¨æˆ·ä¸å¿…åœ¨å¤šä¸ªæ ‡å‡†ä¹‹é—´åˆ‡æ¢ï¼Œå‡å°‘äº†å‡ºé”™çš„å¯èƒ½æ€§ã€‚</p><p><strong>4.6.ä»£ç æ¯”è¾ƒ</strong></p><p>BIP44 ä»£ç ç¤ºèŒƒ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_address</span>(<span class="hljs-params">mnemonic</span>):<br>    seed = bip39.phrase_to_seed(mnemonic)<br>    bip32_root_key = BIP32Key.fromEntropy(seed)<br>    path = <span class="hljs-string">&quot;m/44&#x27;/0&#x27;/0&#x27;/0/0&quot;</span><br>    key = bip32_root_key<br>    <span class="hljs-keyword">for</span> level <span class="hljs-keyword">in</span> path.split(<span class="hljs-string">&#x27;/&#x27;</span>)[<span class="hljs-number">1</span>:]:<br>        <span class="hljs-keyword">if</span> level.endswith(<span class="hljs-string">&quot;&#x27;&quot;</span>):<br>            index = BIP32_HARDEN + <span class="hljs-built_in">int</span>(level[:-<span class="hljs-number">1</span>])<br>        <span class="hljs-keyword">else</span>:<br>            index = <span class="hljs-built_in">int</span>(level)<br>        key = key.ChildKey(index)<br>    address = key.Address()<br>    <span class="hljs-keyword">return</span> address<br></code></pre></td></tr></table></figure><p>BIP86 ä»£ç ç¤ºä¾‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> bip39<br><span class="hljs-keyword">import</span> bech32<br><span class="hljs-keyword">from</span> bip32 <span class="hljs-keyword">import</span> BIP32, HARDENED_INDEX<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha256<br><span class="hljs-keyword">from</span> ecdsa <span class="hljs-keyword">import</span> SECP256k1, SigningKey<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_taproot_address</span>(<span class="hljs-params">mnemonic</span>):<br>    seed = bip39.phrase_to_seed(mnemonic)<br>    bip32 = BIP32.from_seed(seed)<br>    path = <span class="hljs-string">&quot;m/86&#x27;/0&#x27;/0&#x27;/0/0&quot;</span><br>    child_key = bip32.get_privkey_from_path(path)<br>    private_key = SigningKey.from_string(child_key, curve=SECP256k1)<br>    public_key = private_key.get_verifying_key().to_string(<span class="hljs-string">&quot;compressed&quot;</span>)<br>    tweak = sha256(<span class="hljs-string">b&#x27;TapTweak&#x27;</span> + public_key[<span class="hljs-number">1</span>:]).digest()<br>    tweaked_pubkey = <span class="hljs-built_in">bytearray</span>(public_key)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>):<br>        tweaked_pubkey[<span class="hljs-number">1</span> + i] ^= tweak[i]<br>    witver = <span class="hljs-number">1</span>  <span class="hljs-comment"># witness version for Taproot</span><br>    witprog = tweaked_pubkey[<span class="hljs-number">1</span>:<span class="hljs-number">33</span>]<br>    address = bech32.encode(<span class="hljs-string">&#x27;bc&#x27;</span>, witver, witprog)<br>    <span class="hljs-keyword">return</span> address<br></code></pre></td></tr></table></figure><h1 id="5-Taproot-æ ¼å¼åœ°å€ç¦»çº¿ç”Ÿæˆ"><a href="#5-Taproot-æ ¼å¼åœ°å€ç¦»çº¿ç”Ÿæˆ" class="headerlink" title="5. Taproot æ ¼å¼åœ°å€ç¦»çº¿ç”Ÿæˆ"></a>5. Taproot æ ¼å¼åœ°å€ç¦»çº¿ç”Ÿæˆ</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> bip39<br><span class="hljs-keyword">import</span> bech32<br><span class="hljs-keyword">from</span> bip32 <span class="hljs-keyword">import</span> BIP32, HARDENED_INDEX<br><span class="hljs-keyword">from</span> hashlib <span class="hljs-keyword">import</span> sha256<br><span class="hljs-keyword">from</span> ecdsa <span class="hljs-keyword">import</span> SECP256k1, SigningKey<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">generate_taproot_address</span>(<span class="hljs-params">mnemonic</span>):<br>    seed = bip39.phrase_to_seed(mnemonic)<br>    bip32 = BIP32.from_seed(seed)<br>    path = <span class="hljs-string">&quot;m/86&#x27;/0&#x27;/0&#x27;/0/0&quot;</span><br>    child_key = bip32.get_privkey_from_path(path)<br>    private_key = SigningKey.from_string(child_key, curve=SECP256k1)<br>    public_key = private_key.get_verifying_key().to_string(<span class="hljs-string">&quot;compressed&quot;</span>)<br>    tweak = sha256(<span class="hljs-string">b&#x27;TapTweak&#x27;</span> + public_key[<span class="hljs-number">1</span>:]).digest()<br>    tweaked_pubkey = <span class="hljs-built_in">bytearray</span>(public_key)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">32</span>):<br>        tweaked_pubkey[<span class="hljs-number">1</span> + i] ^= tweak[i]<br>    witver = <span class="hljs-number">1</span>  <span class="hljs-comment"># witness version for Taproot</span><br>    witprog = tweaked_pubkey[<span class="hljs-number">1</span>:<span class="hljs-number">33</span>]<br>    address = bech32.encode(<span class="hljs-string">&#x27;bc&#x27;</span>, witver, witprog)<br>    <span class="hljs-keyword">return</span> address<br></code></pre></td></tr></table></figure><h1 id="6-ç¦»çº¿ç­¾å"><a href="#6-ç¦»çº¿ç­¾å" class="headerlink" title="6. ç¦»çº¿ç­¾å"></a>6. ç¦»çº¿ç­¾å</h1><ul><li>æ„å»ºäº¤æ˜“: åˆ›å»ºå¹¶å¡«å……äº¤æ˜“è¾“å…¥å’Œè¾“å‡ºã€‚</li><li>ç”Ÿæˆäº¤æ˜“æ‘˜è¦: ä½¿ç”¨äº¤æ˜“æ•°æ®ç”Ÿæˆ Taproot äº¤æ˜“æ‘˜è¦ã€‚</li><li>ç­¾åäº¤æ˜“: ä½¿ç”¨ç§é’¥å¯¹äº¤æ˜“æ‘˜è¦è¿›è¡Œç­¾åã€‚</li><li>æ„å»ºå®Œæ•´äº¤æ˜“: å°†ç­¾åé™„åŠ åˆ°äº¤æ˜“ä¸­å¹¶ç”Ÿæˆæœ€ç»ˆçš„äº¤æ˜“ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">buildAndsignTx</span>(<span class="hljs-params">input_list, output_list, private_key, taproot_pubkey</span>):<br>    tx = Transaction()<br>    <span class="hljs-keyword">for</span> <span class="hljs-built_in">input</span> <span class="hljs-keyword">in</span> input_list:<br>        tx.add_input(<span class="hljs-built_in">input</span>[<span class="hljs-string">&#x27;previous_txid&#x27;</span>], <span class="hljs-built_in">input</span>[<span class="hljs-string">&#x27;index&#x27;</span>])<br>    <span class="hljs-keyword">for</span> output <span class="hljs-keyword">in</span> output_list:<br>        tx.add_output(output[<span class="hljs-string">&quot;address&quot;</span>], output[<span class="hljs-string">&quot;value&quot;</span>])<br>    tx.version = <span class="hljs-number">2</span><br>    tx.locktime = <span class="hljs-number">0</span><br>    sighash = tx.signature_hash()<br>    <br>    tweaked_privkey = taproot_tweak_seckey(private_key, taproot_pubkey)<br>    signature = schnorr.sign(tweaked_privkey, sighash)<br>    <br>    witness = TaprootWitness(taproot_pubkey, signature)<br>    tx.inputs[<span class="hljs-number">0</span>].witness = witness<br><br>    signed_tx = tx.serialize()   <br>     <br>    <span class="hljs-keyword">return</span> signed_tx<br></code></pre></td></tr></table></figure><p>ç¦»çº¿ç­¾åæå‡ºæ¥ï¼ŒåŸºæœ¬äº¤æ˜“å°±OKäº†ï¼Œä¸­å¿ƒåŒ–é’±åŒ…å’Œå»ä¸­å¿ƒåŒ–é’±åŒ…çš„æœ¬è´¨åŒºåˆ«æ˜¯ç§é’¥ç®¡ç†ï¼Œç­¾åæ˜¯ä¸€æ ·çš„ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>blockChain</category>
      
    </categories>
    
    
    <tags>
      
      <tag>block</tag>
      
      <tag>æ¦‚å¿µ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>05 Bitcoiné’±åŒ…ç”Ÿæˆå’Œç­¾å</title>
    <link href="/2024/05/27/05Bitcoin%E9%92%B1%E5%8C%85%E7%94%9F%E6%88%90%E5%92%8C%E7%AD%BE%E5%90%8D/"/>
    <url>/2024/05/27/05Bitcoin%E9%92%B1%E5%8C%85%E7%94%9F%E6%88%90%E5%92%8C%E7%AD%BE%E5%90%8D/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€-Bitcoin-æ¦‚è§ˆ"><a href="#ä¸€-Bitcoin-æ¦‚è§ˆ" class="headerlink" title="ä¸€. Bitcoin æ¦‚è§ˆ"></a>ä¸€. Bitcoin æ¦‚è§ˆ</h1><h2 id="1-1-Bitcoin-ç®€ä»‹"><a href="#1-1-Bitcoin-ç®€ä»‹" class="headerlink" title="1.1 Bitcoin ç®€ä»‹"></a>1.1 Bitcoin ç®€ä»‹</h2><p>æ¯”ç‰¹å¸ï¼ˆBitcoinï¼‰æ˜¯ç”±ä¸€ä¸ªæˆ–ä¸€ç¾¤åŒ–åä¸ºä¸­æœ¬èªï¼ˆSatoshi Nakamotoï¼‰çš„äººåœ¨ 2008 å¹´æå‡ºï¼Œå¹¶äº 2009 å¹´å¼€å§‹å‘å¸ƒçš„å»ä¸­å¿ƒåŒ–æ•°å­—è´§å¸ã€‚å®ƒçš„å‡ºç°æ ‡å¿—ç€ä¸€ç§æ–°å‹é‡‘èä½“ç³»çš„è¯ç”Ÿï¼Œå…·æœ‰ä»¥ä¸‹ä¸»è¦ç‰¹ç‚¹ï¼š</p><p><strong>å»ä¸­å¿ƒåŒ–</strong>ï¼š</p><ul><li>æ¯”ç‰¹å¸ç½‘ç»œæ²¡æœ‰ä¸­å¤®ç®¡ç†æœºæ„æˆ–ä¸­ä»‹æœºæ„ï¼Œå®ƒé€šè¿‡ä¸€ä¸ªç§°ä¸ºåŒºå—é“¾çš„åˆ†å¸ƒå¼è´¦æœ¬æ¥è®°å½•æ‰€æœ‰äº¤æ˜“ã€‚</li><li>åŒºå—é“¾æŠ€æœ¯ç¡®ä¿äº†æ‰€æœ‰å‚ä¸è€…éƒ½å¯ä»¥æŸ¥çœ‹å’ŒéªŒè¯äº¤æ˜“ï¼Œæé«˜äº†é€æ˜åº¦å’Œå®‰å…¨æ€§ã€‚</li></ul><p><strong>æœ‰é™ä¾›åº”</strong>ï¼š</p><ul><li>æ¯”ç‰¹å¸çš„æ€»ä¾›åº”é‡è¢«å›ºå®šåœ¨2100ä¸‡æšï¼Œè¿™é€šè¿‡ä»£ç å†…çš„æœºåˆ¶æ§åˆ¶ã€‚ </li><li>è¿™ä¸€æœºåˆ¶ä½¿æ¯”ç‰¹å¸å…·å¤‡äº†æŠ—é€šèƒ€çš„ç‰¹ç‚¹ã€‚</li></ul><p><strong>ç‚¹å¯¹ç‚¹äº¤æ˜“</strong>ï¼š</p><ul><li>æ¯”ç‰¹å¸å…è®¸ç”¨æˆ·ä¹‹é—´ç›´æ¥è¿›è¡Œäº¤æ˜“ï¼Œä¸éœ€è¦é€šè¿‡é“¶è¡Œæˆ–æ”¯ä»˜å¤„ç†æœºæ„ã€‚ </li><li>è¿™ç§ç‚¹å¯¹ç‚¹äº¤æ˜“å‡å°‘äº†äº¤æ˜“æˆæœ¬å’Œå¤„ç†æ—¶é—´ã€‚</li></ul><p><strong>å®‰å…¨æ€§</strong> ï¼š</p><ul><li>æ¯”ç‰¹å¸ä½¿ç”¨åŠ å¯†æŠ€æœ¯ç¡®ä¿äº¤æ˜“çš„å®‰å…¨æ€§å’Œéšç§æ€§ã€‚ </li><li>æ¯ä¸€ç¬”äº¤æ˜“éƒ½éœ€è¦é€šè¿‡å¤æ‚çš„æ•°å­¦ç®—æ³•è¿›è¡ŒéªŒè¯ï¼Œä»è€Œç¡®ä¿ç³»ç»Ÿçš„å®Œæ•´æ€§ã€‚</li></ul><p><strong>ä¸å¯é€†äº¤æ˜“</strong>ï¼š</p><ul><li>ä¸€æ—¦æ¯”ç‰¹å¸äº¤æ˜“è¢«ç¡®è®¤ï¼Œå®ƒå°±æ— æ³•è¢«æ’¤é”€ã€‚è¿™å‡å°‘äº†æ¬ºè¯ˆçš„é£é™©ï¼Œä½†ä¹Ÿæ„å‘³ç€ç”¨æˆ·éœ€è¦è°¨æ…æ“ä½œã€‚</li></ul><p><strong>æŒ–çŸ¿æœºåˆ¶</strong>ï¼š</p><ul><li>æ–°çš„æ¯”ç‰¹å¸é€šè¿‡ä¸€ä¸ªç§°ä¸ºæŒ–çŸ¿çš„è¿‡ç¨‹äº§ç”Ÿã€‚çŸ¿å·¥ä»¬ä½¿ç”¨è®¡ç®—èƒ½åŠ›æ¥è§£å†³å¤æ‚çš„æ•°å­¦é—®é¢˜ï¼ŒæˆåŠŸè§£å†³é—®é¢˜çš„çŸ¿å·¥å°†è·å¾—æ¯”ç‰¹å¸å¥–åŠ±ã€‚ </li><li>æŒ–çŸ¿ä¸ä»…ç”Ÿæˆæ–°å¸ï¼Œè¿˜ç»´æŠ¤å’Œä¿æŠ¤æ¯”ç‰¹å¸ç½‘ç»œçš„å®‰å…¨ã€‚</li></ul><p><strong>å…¨çƒæµé€š</strong>ï¼š</p><ul><li>æ¯”ç‰¹å¸å¯ä»¥åœ¨å…¨çƒèŒƒå›´å†…è¿›è¡Œäº¤æ˜“ï¼Œä¸å—åœ°åŸŸå’Œå›½ç•Œçš„é™åˆ¶ã€‚ </li><li>å®ƒä¸ºè·¨å›½æ”¯ä»˜æä¾›äº†ä¸€ç§é«˜æ•ˆã€ä½æˆæœ¬çš„æ›¿ä»£æ–¹æ¡ˆã€‚</li></ul><p><strong>éšç§å’ŒåŒ¿åæ€§</strong>ï¼š</p><ul><li>è™½ç„¶æ¯”ç‰¹å¸äº¤æ˜“æ˜¯å…¬å¼€è®°å½•çš„ï¼Œä½†ç”¨æˆ·èº«ä»½æ˜¯åŒ¿åçš„ã€‚äº¤æ˜“æ˜¯é€šè¿‡åœ°å€ï¼ˆç±»ä¼¼äºè´¦å·ï¼‰è¿›è¡Œçš„ï¼Œè€Œä¸æ˜¯é€šè¿‡çœŸå®èº«ä»½ã€‚</li></ul><h2 id="1-2-Bitcoin-çš„å‡çº§æ¬¡æ•°ä»‹ç»"><a href="#1-2-Bitcoin-çš„å‡çº§æ¬¡æ•°ä»‹ç»" class="headerlink" title="1.2.Bitcoin çš„å‡çº§æ¬¡æ•°ä»‹ç»"></a>1.2.Bitcoin çš„å‡çº§æ¬¡æ•°ä»‹ç»</h2><p>æ¯”ç‰¹å¸è‡ª 2009 å¹´å‘å¸ƒä»¥æ¥ï¼Œç»å†äº†å¤šæ¬¡é‡è¦å‡çº§ã€‚è¿™äº›å‡çº§æ—¨åœ¨æé«˜æ¯”ç‰¹å¸ç½‘ç»œçš„å®‰å…¨æ€§ã€æ•ˆç‡å’ŒåŠŸèƒ½æ€§ã€‚</p><p>å¹¶ä¸”æ¯”ç‰¹å¸çš„ Taproot å‡çº§ç»™æ¯”ç‰¹å¸å¸¦æ¥æ›´å¤šçš„å¯èƒ½æ€§ï¼ŒTaproot å‡çº§å¸¦åŠ¨äº† BRC20 å’Œ Bitcoin-Layer2 çš„å‘å±•ï¼Œ</p><p>**P2SHï¼ˆPay-to-Script-Hashï¼‰2012å¹´ **</p><ul><li>BIPï¼ˆBitcoin Improvement Proposalï¼‰ï¼šBIP-0016 </li><li>å†…å®¹ï¼šå…è®¸æ›´å¤æ‚çš„äº¤æ˜“è„šæœ¬ï¼Œæ”¯æŒå¤šé‡ç­¾ååœ°å€ã€‚è¿™ç§å‡çº§ä½¿å¾—æ¯”ç‰¹å¸äº¤æ˜“æ›´åŠ çµæ´»å’Œå®‰å…¨</li></ul><p>**æ¯”ç‰¹å¸æ”¹è¿›ææ¡ˆ BIP 66    2015å¹´ ** </p><ul><li>BIPï¼šBIP-0066 </li><li>å†…å®¹ï¼šè§„èŒƒäº†äº¤æ˜“ä¸­DERæ ¼å¼çš„ç­¾åï¼Œè§£å†³äº†äº¤æ˜“ç­¾åçš„ä¸€è‡´æ€§é—®é¢˜ï¼Œå¢å¼ºäº†ç½‘ç»œçš„å®‰å…¨æ€§ã€‚</li></ul><p>**CheckSequenceVerifyï¼ˆCSVï¼‰2016å¹´ ** ï¼š</p><ul><li><p>BIPï¼šBIP-0112 </p></li><li><p>å†…å®¹ï¼šå¢åŠ äº†ç›¸å¯¹æ—¶é—´é”åŠŸèƒ½ï¼Œä½¿å¾—äº¤æ˜“å¯ä»¥åœ¨æŒ‡å®šçš„æ—¶é—´æˆ–å—é«˜åº¦ä¹‹åæ‰ç”Ÿæ•ˆï¼Œè¿™ä¸ºæ›´å¤æ‚çš„æ”¯ä»˜é€šé“é“ºå¹³äº†é“è·¯ã€‚</p></li></ul><p>**Segregated Witnessï¼ˆSegWitï¼‰2017å¹´ ** </p><ul><li>BIPï¼šBIP-0141, BIP-0143, BIP-0144 </li><li>å†…å®¹ï¼šåˆ†ç¦»äº¤æ˜“ç­¾åæ•°æ®ï¼Œæé«˜äº†åŒºå—çš„æœ‰æ•ˆå®¹é‡ï¼Œå‡å°äº†äº¤æ˜“ä½“ç§¯ï¼Œé™ä½äº†äº¤æ˜“è´¹ç”¨ã€‚è¿˜è§£å†³äº†äº¤æ˜“çš„å¯å¡‘æ€§é—®é¢˜ï¼Œä½¿å¾—é—ªç”µç½‘ç»œç­‰ä¾§é“¾è§£å†³æ–¹æ¡ˆæˆä¸ºå¯èƒ½ã€‚</li></ul><p>**éš”ç¦»è§è¯2xï¼ˆSegWit2xï¼‰2017å¹´ ** </p><ul><li>å†…å®¹ï¼šè¿™æ¬¡å‡çº§æ˜¯å¯¹ SegWit çš„åç»­ææ¡ˆï¼Œæ—¨åœ¨è¿›ä¸€æ­¥å¢åŠ åŒºå—å¤§å°ã€‚ç„¶è€Œï¼Œç”±äºç¤¾åŒºå…±è¯†æœªè¾¾æˆï¼Œè¿™æ¬¡å‡çº§æœ€ç»ˆæœªèƒ½å®ç°ã€‚</li></ul><p>**Taproot 2021å¹´ ** </p><ul><li>BIPï¼šBIP-0340, BIP-0341, BIP-0342 </li><li>å†…å®¹ï¼šå¼•å…¥äº† Schnorr ç­¾åå’Œé»˜å…‹å°”åŒ–æŠ½è±¡è¯­æ³•æ ‘ï¼ˆMASTï¼‰ï¼Œå¢å¼ºäº†éšç§æ€§å’Œæ‰§è¡Œè„šæœ¬éªŒè¯çš„åŠŸèƒ½ï¼Œè¿›ä¸€æ­¥æé«˜äº†äº¤æ˜“çš„çµæ´»æ€§å’Œæ•ˆç‡ã€‚è¿™æ˜¯è‡ª2017å¹´ SegWit ä»¥æ¥æœ€é‡è¦çš„ä¸€æ¬¡å‡çº§ã€‚</li></ul><p>**MASTï¼ˆMerkelized Abstract Syntax Treesï¼‰2021å¹´ ** </p><ul><li><p>BIPï¼šä½œä¸º Taproot çš„ä¸€éƒ¨åˆ† </p></li><li><p>å†…å®¹ï¼šå…è®¸å°†å¤šç§æ¡ä»¶çš„æ™ºèƒ½åˆçº¦åˆå¹¶ä¸ºä¸€ä¸ªï¼Œä½¿å¾—åªæœ‰æ»¡è¶³æ¡ä»¶çš„éƒ¨åˆ†æ‰è¢«å…¬å¼€ï¼Œæé«˜äº†éšç§æ€§å’Œæ•ˆç‡ã€‚</p></li></ul><p><strong>Schnorr Signatures</strong> </p><ul><li>BIPï¼šä½œä¸º Taproot çš„ä¸€éƒ¨åˆ† </li><li>å†…å®¹ï¼šæä¾›äº†ä¸€ç§æ›´é«˜æ•ˆå’Œå®‰å…¨çš„ç­¾åç®—æ³•ï¼Œå…è®¸å¤šé‡ç­¾åèšåˆï¼Œæé«˜äº†äº¤æ˜“çš„éšç§æ€§å’Œå¯æ‰©å±•æ€§ã€‚</li></ul><h2 id="3-UTXO-ä»‹ç»"><a href="#3-UTXO-ä»‹ç»" class="headerlink" title="3.UTXO ä»‹ç»"></a>3.UTXO ä»‹ç»</h2><p>UTXOï¼ˆUnspent Transaction Outputï¼Œ<strong>æœªèŠ±è´¹äº¤æ˜“è¾“å‡º</strong>ï¼‰æ¨¡å‹æ˜¯æ¯”ç‰¹å¸åŠå…¶ä»–ä¸€äº›åŠ å¯†è´§å¸ä½¿ç”¨çš„ä¸€ç§è®°è´¦æ–¹æ³•ã€‚å®ƒä¸è´¦æˆ·æ¨¡å‹ä¸åŒï¼Œé€šè¿‡<strong>è¿½è¸ªæœªèŠ±è´¹</strong>çš„äº¤æ˜“è¾“å‡ºæ¥è®°å½•æ¯ä¸ªåœ°å€çš„<strong>ä½™é¢</strong>ã€‚ä»¥ä¸‹æ˜¯UTXOæ¨¡å‹çš„è¯¦ç»†ä»‹ç»ï¼š</p><h3 id="3-1-æ¨¡å‹è§£è¯´"><a href="#3-1-æ¨¡å‹è§£è¯´" class="headerlink" title="3.1 æ¨¡å‹è§£è¯´"></a>3.1 æ¨¡å‹è§£è¯´</h3><p>è¯´è¯´ä¸€ä¸ªåè¯ï¼Œå«åš Transactionäº¤æ˜“ï¼ŒTransaction å’Œ UTXO æ˜¯ç›¸è¾…ç›¸æˆçš„ï¼Œå…ˆä¸¾ä¾‹ï¼š</p><p>å¼ ä¸‰ï¼šé€šè¿‡æŒ–çŸ¿å¾—åˆ°äº†120ä¸ªæ¯”ç‰¹å¸ï¼Œ</p><p>ç°åœ¨å¼ ä¸‰é¥¿äº†ï¼Œæƒ³è¦èŠ±è´¹2ä¸ªæ¯”ç‰¹å¸å»è´­ä¹°ä¸€ä¸ªé¢åŒ…ï¼ˆå‡è®¾ï¼‰ã€‚</p><p>ç°åœ¨å‡è®¾æå››æ˜¯é¢åŒ…åº—è¥ä¸šä¸»</p><p>å¼ ä¸‰ä»˜ç»™æå››å°†ä¸€æ¬¡æ€§ä»˜ç»™æå›› 120 å—ï¼Œ</p><p>æå››ç»™å¼ ä¸‰æ‰¾é›¶ 118 å—ï¼Œè¿™é‡Œå…¶å®äº§ç”Ÿäº†ä¸¤ç¬”äº¤æ˜“ï¼Œ</p><p>å’±ä»¬å¯ä»¥è¿™æ ·ç†è§£ï¼Œå¼ ä¸‰çš„é’±è¢«åˆ†æˆäº†ä¸¤ä»½ï¼Œå…¶ä¸­ 118 æ‰“ç»™äº†è‡ªå·±ï¼Œå‰©ä¸‹çš„ 2 å—æ‰“ç»™äº†æå››ã€‚</p><p>äº¤æ˜“ä¸äº¤æ˜“ä¹‹é—´ç»„æˆäº†ç½‘çŠ¶å…³ç³»ï¼Œ<strong>1 ä¸ªäº¤æ˜“çš„è¾“å‡ºï¼Œæˆä¸ºäº†ä¸‹ 1 ä¸ªäº¤æ˜“çš„è¾“å…¥ï¼›ä¸‹ 1 ä¸ªäº¤æ˜“çš„è¾“å‡ºï¼Œåˆæˆäº†ä¸‹ä¸‹ 1 ä¸ªäº¤æ˜“çš„è¾“å…¥ã€‚</strong></p><p>æ‰€æœ‰çš„é’±ï¼Œåœ¨è¿™ä¸ªç½‘ç»œä¸­æµåŠ¨ï¼Œæ¯ 1 ç¬”é’±çš„å»å‘ã€æ¥æºï¼Œéƒ½æ˜¯å¯è¿½æº¯çš„ï¼Œè€Œè¿™ä¹Ÿæ˜¯åŒºå—é“¾ç½‘ç»œçš„ä¸€ä¸ªé‡è¦ç‰¹ç‚¹ã€‚</p><p>æ¥ä¸‹æ¥å’±ä»¬ç”¨æ¯”è¾ƒé€šä¿—çš„æ–¹å¼æ¥è¯´æ˜ UTXO å’Œ Transaction åˆ°åº•æ˜¯ä»€ä¹ˆ</p><p>åœ¨ç°å®ç”Ÿæ´»ä¸­ï¼Œä¸€ç¬”è½¬è´¦å¯¹åº”çš„äº‹ä¸€ä¸ªä»˜æ¬¾äººå’Œä¸€ä¸ªæ”¶æ¬¾äººï¼Œ</p><p>è€Œåœ¨æ¯”ç‰¹å¸ä¸­ï¼Œä¸€ç¬”è½¬è´¦å¯¹åº”çš„æ˜¯å¤šä¸ªè½¬è´¦äººå’Œå¤šä¸ªæ”¶æ¬¾äººã€‚</p><p>ç°åœ¨å’±ä»¬ä»”ç»†åˆ†æä¸€ä¸‹ä¸Šé¢çš„è¿™ä¸ªä¾‹å­ï¼Œå¯¹äºå¼ ä¸‰ä¹°é¢åŒ…è¿™ä¸ªæ¡ˆåˆ—</p><ul><li>ä»˜æ¬¾äººï¼šå¼ ä¸‰ 120å—</li><li>æ”¶æ¬¾äººï¼šå¼ ä¸‰ 118å—ï¼Œæå›› 2å—</li></ul><p>å¼ ä¸‰çš„120ï¼Œ<strong>è½¬118å—ç»™è‡ªå·±ï¼Œè½¬2å—ç»™æå››ï¼Œ</strong>å¯¹åº”åˆ°äº¤æ˜“é‡Œé¢ï¼Œå°±æ˜¯è¿™ç¬”äº¤æ˜“æœ‰<strong>1ä¸ªè¾“å…¥ï¼Œ2ä¸ªè¾“å‡º</strong>ï¼</p><p>ä¸‹é¢æ¥ä¸€ä¸ªå¤šè¾“å…¥ï¼Œå¤šè¾“å‡ºçš„æ¡ˆä¾‹</p><p>è€ƒè™‘å¦‚ä¸‹åœºæ™¯ï¼š</p><p>ç”¨æˆ·Aå’Œç”¨æˆ·Bä¹‹é—´å‘ç”Ÿäº†ä¸€ä¸ªäº¤æ˜“T3ï¼ŒA å‘ B è½¬ 100 å…ƒã€‚</p><p> Açš„100å…ƒæ¥è‡ª2ç¬”äº¤æ˜“ï¼šæ¥è‡ªT1ï¼šCå‘Aè½¬çš„80å…ƒ + T2ï¼šDå‘Aè½¬çš„30å…ƒï¼ˆå…±110å…ƒï¼Œä½†Aåªè½¬äº†100å…ƒç»™Bï¼Œ10å…ƒæ‰¾é›¶è¿”å›ç»™Açš„è´¦å·ï¼‰ã€‚ </p><p>åŒç†ï¼ŒCå‘Aè½¬çš„è¿™80å…ƒï¼Œæ¥è‡ªç”¨æˆ·Eã€Fçš„æŸæ¬¡äº¤æ˜“â€¦â€¦ Då‘Aè½¬çš„è¿™30å…ƒï¼Œæ¥è‡ªç”¨æˆ·Eçš„æŸæ¬¡äº¤æ˜“â€¦â€¦</p><p>è¿™ä¸ªäº¤æ˜“å°±æœ‰2ä¸ªè¾“å…¥ï¼Œ2ä¸ªè¾“å‡ºï¼š</p><p> 2ä¸ªè¾“å…¥ï¼ˆä¹Ÿå°±æ˜¯2ä¸ªUTXOï¼‰ï¼š </p><ul><li><p>T1: Cå‘Aè½¬çš„80å…ƒ </p></li><li><p>T2ï¼šDå‘Aè½¬çš„30å…ƒ</p></li></ul><p>2ä¸ªè¾“å‡ºï¼š</p><ul><li>Bï¼š100å…ƒ </li><li>Aï¼š10å…ƒï¼ˆæ‰¾é›¶ï¼‰</li></ul><p>å½“ä½ ç†è§£ä¸Šé¢çš„ä¾‹å­æ—¶ï¼Œæˆ‘ä»¬å†æ¥è¯´ä¸€ä¸‹UTXOï¼Œç†è§£ä¸Šé¢çš„ä¾‹å­å¯¹ä½ ç†è§£UTXOä¼šç‰¹åˆ«æœ‰å¸®åŠ©ã€‚</p><ul><li>æ¯”ç‰¹å¸çš„äº¤æ˜“ä¸­ä¸æ˜¯é€šè¿‡è´¦æˆ·çš„å¢å‡æ¥å®ç°çš„ï¼Œè€Œæ˜¯ä¸€ç¬”ç¬”å…³è”çš„<strong>è¾“å…¥&#x2F;è¾“å‡ºäº¤æ˜“äº‹åŠ¡</strong>ã€‚</li><li>æ¯ä¸€ç¬”çš„äº¤æ˜“éƒ½è¦èŠ±è´¹â€œ<strong>è¾“å…¥</strong>â€ï¼Œç„¶åäº§ç”Ÿâ€œ<strong>è¾“å‡º</strong>â€ï¼Œè¿™ä¸ªäº§ç”Ÿçš„â€œ<strong>è¾“å‡º</strong>â€å°±æ˜¯æ‰€è°“çš„â€œ<strong>æœªèŠ±è´¹è¿‡çš„äº¤æ˜“è¾“å‡º</strong>â€ï¼Œä¹Ÿå°±æ˜¯<strong>UTXO</strong>ã€‚æ¯ä¸€ç¬”äº¤æ˜“äº‹åŠ¡éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ç¼–å·ï¼Œç§°ä¸º<strong>äº¤æ˜“äº‹åŠ¡ID</strong>ï¼Œè¿™æ˜¯é€šè¿‡å“ˆå¸Œç®—æ³•è®¡ç®—è€Œæ¥çš„ï¼Œå½“éœ€è¦<strong>å¼•ç”¨</strong>æŸä¸€ç¬”äº¤æ˜“äº‹åŠ¡ä¸­çš„<strong>â€œè¾“å‡ºâ€</strong>æ—¶ï¼Œä¸»è¦æä¾›<strong>äº¤æ˜“äº‹åŠ¡ID</strong>å’Œæ‰€å¤„<strong>â€œè¾“å‡ºâ€</strong>åˆ—è¡¨ä¸­çš„<strong>åºå·</strong>å°±å¯ä»¥äº†ã€‚</li><li>ç”±äºæ²¡æœ‰è´¦æˆ·çš„æ¦‚å¿µï¼Œå› æ­¤<strong>å½“â€œè¾“å…¥â€éƒ¨åˆ†çš„é‡‘é¢å¤§äºæ‰€éœ€çš„â€œè¾“å‡ºâ€æ—¶</strong>ï¼Œå¿…é¡»ç»™è‡ªå·±<strong>æ‰¾é›¶</strong>ï¼Œè¿™ä¸ªæ‰¾é›¶ä¹Ÿæ˜¯ä½œä¸ºäº¤æ˜“çš„ä¸€éƒ¨åˆ†åŒ…å«åœ¨â€œè¾“å‡ºâ€ä¸­ã€‚</li><li>æ—§çš„ UTXOä¸æ–­æ¶ˆäº¡ï¼Œæ–°çš„UTXOä¸æ–­äº§ç”Ÿã€‚æ‰€æœ‰çš„UTXOï¼Œç»„æˆäº†UTXO Set çš„æ•°æ®åº“ï¼Œå­˜åœ¨äºæ¯ä¸ªèŠ‚ç‚¹</li><li>ä»»ä½•1ç¬” UTXOï¼Œæœ‰ä¸”ä»…å¯èƒ½è¢«1ä¸ªäº¤æ˜“èŠ±è´¹1æ¬¡</li><li>1 ä¸ª UTXOï¼Œå…·æœ‰å¦‚ä¸‹çš„è¡¨è¾¾å½¢å¼ï¼š 1 ä¸ª UTXO &#x3D; 1ä¸ªTransaction ID + Output Index</li></ul><h3 id="2-UTXOæ¨¡å‹çš„åŒºå—é“¾é’±åŒ…ä½™é¢å½¢å¼"><a href="#2-UTXOæ¨¡å‹çš„åŒºå—é“¾é’±åŒ…ä½™é¢å½¢å¼" class="headerlink" title="2. UTXOæ¨¡å‹çš„åŒºå—é“¾é’±åŒ…ä½™é¢å½¢å¼"></a>2. UTXOæ¨¡å‹çš„åŒºå—é“¾é’±åŒ…ä½™é¢å½¢å¼</h3><p>æ·±åˆ»ç†è§£äº†UTXOçš„æ¦‚å¿µï¼Œé’±åŒ…å°±å¾ˆå®¹æ˜“ç†è§£äº†ï¼Œ</p><p>æŸä¸ªäººçš„é’±åŒ…çš„ä½™é¢ &#x3D; å±äºä»–çš„UTXOçš„æ€»å’Œï¼›åœ¨è¿™é‡Œï¼Œä½ ä¼šå‘ç°ä¸€ä¸ªä¸åŒäºç°å®ä¸–ç•Œçš„â€œé“¶è¡Œâ€é‡Œçš„ä¸€ä¸ªæ¦‚å¿µï¼Œåœ¨é“¶è¡Œé‡Œï¼Œä¼šå­˜å‚¨æ¯ä¸ªè´¦å·å‰©ä½™å¤šå°‘é’±ã€‚ä½†è¿™é‡Œï¼Œæˆ‘ä»¬å­˜å‚¨çš„å¹¶ä¸æ˜¯æ¯ä¸ªè´¦å·çš„ä½™é¢ï¼Œè€Œå­˜çš„æ˜¯<strong>1ç¬”ç¬”çš„äº¤æ˜“</strong>ï¼Œä¹Ÿå°±æ˜¯<strong>1 ç¬”ç¬”çš„UTXO</strong>ï¼Œæ¯ä¸ªè´¦æˆ·çš„ä½™é¢æ˜¯é€šè¿‡<strong>UTXOè®¡ç®—</strong>å‡ºæ¥çš„ï¼Œè€Œä¸æ˜¯<strong>ç›´æ¥å­˜å‚¨</strong>ä½™é¢ã€‚</p><h1 id="äºŒ-Bitcoin-é’±åŒ…åœ°å€ç±»å‹"><a href="#äºŒ-Bitcoin-é’±åŒ…åœ°å€ç±»å‹" class="headerlink" title="äºŒ. Bitcoin é’±åŒ…åœ°å€ç±»å‹"></a>äºŒ. Bitcoin é’±åŒ…åœ°å€ç±»å‹</h1><p>Bitcoin é’±åŒ…åœ°å€æœ‰å‡ ç§ä¸åŒçš„ç±»å‹ï¼Œæ¯ç§ç±»å‹éƒ½æœ‰å…¶ç‰¹å®šçš„ç”¨é€”å’Œç‰¹ç‚¹ã€‚ä¸»è¦çš„å‡ ç§ç±»å‹åŒ…æ‹¬ï¼š</p><h4 id="P2PKHï¼ˆPay-to-PubKeyHashï¼‰åœ°å€-ğŸ’¡ğŸ’¡"><a href="#P2PKHï¼ˆPay-to-PubKeyHashï¼‰åœ°å€-ğŸ’¡ğŸ’¡" class="headerlink" title="P2PKHï¼ˆPay-to-PubKeyHashï¼‰åœ°å€ ğŸ’¡ğŸ’¡"></a><strong>P2PKHï¼ˆPay-to-PubKeyHashï¼‰åœ°å€</strong> ğŸ’¡ğŸ’¡</h4><ul><li><strong>ä¼ ç»Ÿçš„ P2PKH</strong> åœ°å€ï¼Œä¹Ÿå«legacyAddr</li><li>æ ¼å¼ï¼šä»¥1å¼€å¤´ï¼Œä¾‹å¦‚ï¼Œ1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNaã€‚ ğŸ’¡ğŸ’¡</li><li>ç‰¹ç‚¹ï¼šè¿™æ˜¯æœ€ä¼ ç»Ÿå’Œæœ€å¸¸è§çš„åœ°å€ç±»å‹ï¼Œå¹¿æ³›ç”¨äºæ¯”ç‰¹å¸çš„æ—©æœŸäº¤æ˜“ã€‚ ğŸ’¡ğŸ’¡</li><li>ä¼˜ç‚¹ï¼šå…¼å®¹æ€§å¥½ï¼Œå‡ ä¹æ‰€æœ‰é’±åŒ…å’Œäº¤æ˜“æ‰€éƒ½æ”¯æŒã€‚ ğŸ’¡ğŸ’¡</li><li>ç¼ºç‚¹ï¼šéšç€æ—¶é—´çš„æ¨ç§»ï¼Œè¿™ç§åœ°å€ç±»å‹çš„ä½¿ç”¨æ•ˆç‡è¾ƒä½ï¼Œäº¤æ˜“è´¹ç”¨å¯èƒ½ä¼šè¾ƒé«˜ã€‚</li></ul><h4 id="P2SHï¼ˆPay-to-Script-Hashï¼‰åœ°å€-ğŸ’¡ğŸ’¡"><a href="#P2SHï¼ˆPay-to-Script-Hashï¼‰åœ°å€-ğŸ’¡ğŸ’¡" class="headerlink" title="P2SHï¼ˆPay-to-Script-Hashï¼‰åœ°å€ ğŸ’¡ğŸ’¡"></a><strong>P2SHï¼ˆPay-to-Script-Hashï¼‰åœ°å€</strong> ğŸ’¡ğŸ’¡</h4><ul><li><strong>éš”ç¦»è§è¯ P2SH</strong></li><li>æ ¼å¼ï¼šä»¥3å¼€å¤´ï¼Œä¾‹å¦‚ï¼Œ3J98t1WpEZ73CNmQviecrnyiWrnqRhWNLyã€‚ ğŸ’¡ğŸ’¡</li><li>ç‰¹ç‚¹ï¼šè¿™ç§åœ°å€å…è®¸æ›´å¤æ‚çš„äº¤æ˜“è„šæœ¬ï¼Œä¾‹å¦‚å¤šé‡ç­¾ååœ°å€ã€‚ ğŸ’¡ğŸ’¡</li><li>ä¼˜ç‚¹ï¼šæ”¯æŒæ›´å¤æ‚çš„äº¤æ˜“å’Œè„šæœ¬ï¼Œå®‰å…¨æ€§æ›´é«˜ã€‚ ğŸ’¡ğŸ’¡</li><li>ç¼ºç‚¹ï¼šåˆ›å»ºå’Œç®¡ç†æ¯”P2PKHåœ°å€æ›´å¤æ‚ã€‚</li></ul><h4 id="Bech32ï¼ˆSegWitï¼‰åœ°å€-ğŸ’¡ğŸ’¡"><a href="#Bech32ï¼ˆSegWitï¼‰åœ°å€-ğŸ’¡ğŸ’¡" class="headerlink" title="Bech32ï¼ˆSegWitï¼‰åœ°å€ ğŸ’¡ğŸ’¡"></a><strong>Bech32ï¼ˆSegWitï¼‰åœ°å€</strong> ğŸ’¡ğŸ’¡</h4><ul><li><p><strong>åŸç”Ÿçš„éš”ç¦»è§è¯ Bech32</strong> </p></li><li><p>æ ¼å¼ï¼šä»¥ bc1 å¼€å¤´ï¼Œä¾‹å¦‚ï¼Œbc1qar0srrr7xfkvy5l643lydnw9re59gtzzwfvenlã€‚ ğŸ’¡ğŸ’¡</p></li><li><p>ç‰¹ç‚¹ï¼šè¿™æ˜¯æ¯”ç‰¹å¸æ”¹è¿›ææ¡ˆBIP-0173ä¸­å¼•å…¥çš„æ–°åœ°å€æ ¼å¼ï¼Œæ—¨åœ¨æé«˜äº¤æ˜“æ•ˆç‡å’Œå‡å°‘è´¹ç”¨ã€‚ ğŸ’¡ğŸ’¡</p></li><li><p>ä¼˜ç‚¹ï¼šäº¤æ˜“è´¹ç”¨æ›´ä½ï¼Œå¤„ç†é€Ÿåº¦æ›´å¿«ï¼Œä¸”æœ‰åŠ©äºå‡å°‘äº¤æ˜“ä½“ç§¯ã€‚ ğŸ’¡ğŸ’¡</p></li><li><p>ç¼ºç‚¹ï¼šå¹¶éæ‰€æœ‰çš„é’±åŒ…å’Œäº¤æ˜“æ‰€éƒ½æ”¯æŒè¿™ç§åœ°å€ç±»å‹ï¼Œå°½ç®¡æ”¯æŒç‡åœ¨é€æ­¥å¢åŠ ã€‚</p></li></ul><p>æ¯ç§åœ°å€ç±»å‹éƒ½æœ‰å…¶ç‰¹å®šçš„åº”ç”¨åœºæ™¯å’Œä¼˜ç¼ºç‚¹ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©åˆé€‚çš„åœ°å€ç±»å‹æ¥å­˜å‚¨å’Œäº¤æ˜“æ¯”ç‰¹å¸</p><h1 id="ä¸‰-Bitcoin-ç¦»çº¿åœ°å€ç”Ÿæˆä»£ç "><a href="#ä¸‰-Bitcoin-ç¦»çº¿åœ°å€ç”Ÿæˆä»£ç " class="headerlink" title="ä¸‰. Bitcoin ç¦»çº¿åœ°å€ç”Ÿæˆä»£ç "></a>ä¸‰. Bitcoin ç¦»çº¿åœ°å€ç”Ÿæˆä»£ç </h1><h2 id="NodeJs-ä»£ç "><a href="#NodeJs-ä»£ç " class="headerlink" title="NodeJs ä»£ç "></a>NodeJs ä»£ç </h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createAddress</span> (<span class="hljs-attr">params</span>: any): any &#123;<br>    <span class="hljs-keyword">const</span> &#123;seedHex, receiveOrChange, addressIndex, network, method &#125; = params<br>    <span class="hljs-keyword">const</span> root = bip32.<span class="hljs-title function_">fromSeed</span>(<span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>(seedHex, <span class="hljs-string">&#x27;hex&#x27;</span>));<br>    <span class="hljs-keyword">let</span> path = <span class="hljs-string">&quot;m/44&#x27;/0&#x27;/0&#x27;/0/&quot;</span> + addressIndex + <span class="hljs-string">&#x27;&#x27;</span>;<br>    <span class="hljs-keyword">if</span> (receiveOrChange === <span class="hljs-string">&#x27;1&#x27;</span>) &#123;<br>        path = <span class="hljs-string">&quot;m/44&#x27;/0&#x27;/0&#x27;/1/&quot;</span> + addressIndex + <span class="hljs-string">&#x27;&#x27;</span>;<br>    &#125;<br>    <span class="hljs-keyword">const</span> child = root.<span class="hljs-title function_">derivePath</span>(path);<br>    <span class="hljs-keyword">let</span> <span class="hljs-attr">address</span>: string<br>    <span class="hljs-keyword">switch</span>(method) &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;p2pkh&quot;</span>:<br>            <span class="hljs-keyword">const</span> p2pkhAddress = bitcoin.<span class="hljs-property">payments</span>.<span class="hljs-title function_">p2pkh</span>(&#123;<br>                <span class="hljs-attr">pubkey</span>: child.<span class="hljs-property">publicKey</span>,<br>                <span class="hljs-attr">network</span>: bitcoin.<span class="hljs-property">networks</span>[network]<br>            &#125;);<br>            address = p2pkhAddress.<span class="hljs-property">address</span><br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;p2wpkh&quot;</span>:<br>            <span class="hljs-keyword">const</span> p2wpkhAddress = bitcoin.<span class="hljs-property">payments</span>.<span class="hljs-title function_">p2wpkh</span>(&#123;<br>                <span class="hljs-attr">pubkey</span>: child.<span class="hljs-property">publicKey</span>,<br>                <span class="hljs-attr">network</span>: bitcoin.<span class="hljs-property">networks</span>[network]<br>            &#125;);<br>            address = p2wpkhAddress.<span class="hljs-property">address</span><br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-keyword">case</span> <span class="hljs-string">&quot;p2sh&quot;</span>:<br>            <span class="hljs-keyword">const</span> p2shAddress = bitcoin.<span class="hljs-property">payments</span>.<span class="hljs-title function_">p2sh</span>(&#123;<br>                <span class="hljs-attr">redeem</span>: bitcoin.<span class="hljs-property">payments</span>.<span class="hljs-title function_">p2wpkh</span>(&#123;<br>                    <span class="hljs-attr">pubkey</span>: child.<span class="hljs-property">publicKey</span>,<br>                    <span class="hljs-attr">network</span>: bitcoin.<span class="hljs-property">networks</span>[network]<br>                &#125;),<br>            &#125;);<br>            address = p2shAddress.<span class="hljs-property">address</span><br>            <span class="hljs-keyword">break</span><br>        <span class="hljs-attr">default</span>:<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;This way can not support&quot;</span>)<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> &#123;<br>        <span class="hljs-attr">privateKey</span>: <span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>(child.<span class="hljs-property">privateKey</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-string">&#x27;hex&#x27;</span>),<br>        <span class="hljs-attr">publicKey</span>: <span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>(child.<span class="hljs-property">publicKey</span>).<span class="hljs-title function_">toString</span>(<span class="hljs-string">&#x27;hex&#x27;</span>),<br>        address<br>    &#125;;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä»£ç ä¸­é€šè¿‡ method æ¥æ§åˆ¶ç”Ÿæˆçš„åœ°å€ç±»åˆ«</p><h1 id="å››-Bitcoin-ç¦»çº¿ç­¾åä»£ç "><a href="#å››-Bitcoin-ç¦»çº¿ç­¾åä»£ç " class="headerlink" title="å››. Bitcoin ç¦»çº¿ç­¾åä»£ç "></a>å››. Bitcoin ç¦»çº¿ç­¾åä»£ç </h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">buildAndSignTx</span> (<span class="hljs-attr">params</span>: &#123; <span class="hljs-attr">privateKey</span>: string; <span class="hljs-attr">signObj</span>: any; <span class="hljs-attr">network</span>: string; &#125;): string &#123;<br>    <span class="hljs-keyword">const</span> &#123; privateKey, signObj, network &#125; = params;<br>    <span class="hljs-keyword">const</span> net = bitcore.<span class="hljs-property">Networks</span>[network];<br>    <span class="hljs-keyword">const</span> inputs = signObj.<span class="hljs-property">inputs</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">input</span> =&gt;</span> &#123;<br>        <span class="hljs-keyword">return</span> &#123;<br>            <span class="hljs-attr">address</span>: input.<span class="hljs-property">address</span>,<br>            <span class="hljs-attr">txId</span>: input.<span class="hljs-property">txid</span>,<br>            <span class="hljs-attr">outputIndex</span>: input.<span class="hljs-property">vout</span>,<br>            <span class="hljs-attr">script</span>: <span class="hljs-keyword">new</span> bitcore.<span class="hljs-property">Script</span>.<span class="hljs-title function_">fromAddress</span>(input.<span class="hljs-property">address</span>).<span class="hljs-title function_">toHex</span>(),<br>            <span class="hljs-attr">satoshis</span>: input.<span class="hljs-property">amount</span><br>        &#125;<br>    &#125;);<br>    <span class="hljs-keyword">const</span> outputs = signObj.<span class="hljs-property">outputs</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">output</span> =&gt;</span> &#123;<br>        <span class="hljs-keyword">return</span> &#123;<br>            <span class="hljs-attr">address</span>: output.<span class="hljs-property">address</span>,<br>            <span class="hljs-attr">satoshis</span>: output.<span class="hljs-property">amount</span><br>        &#125;;<br>    &#125;);<br>    <span class="hljs-keyword">const</span> transaction = <span class="hljs-keyword">new</span> bitcore.<span class="hljs-title class_">Transaction</span>(net).<span class="hljs-title function_">from</span>(inputs).<span class="hljs-title function_">to</span>(outputs);<br>    transaction.<span class="hljs-property">version</span> = <span class="hljs-number">2</span>;<br>    transaction.<span class="hljs-title function_">sign</span>(privateKey);<br>    <span class="hljs-keyword">return</span> transaction.<span class="hljs-title function_">toString</span>();<br>&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>blockChain</category>
      
    </categories>
    
    
    <tags>
      
      <tag>block</tag>
      
      <tag>æ¦‚å¿µ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>04 HDé’±åŒ…åŠ©è®°è¯ç”Ÿæˆä¸éªŒè¯</title>
    <link href="/2024/05/25/04HD%E9%92%B1%E5%8C%85%E5%8A%A9%E8%AE%B0%E8%AF%8D%E7%94%9F%E6%88%90/"/>
    <url>/2024/05/25/04HD%E9%92%B1%E5%8C%85%E5%8A%A9%E8%AE%B0%E8%AF%8D%E7%94%9F%E6%88%90/</url>
    
    <content type="html"><![CDATA[<h1 id="HDé’±åŒ…åŠ©è®°è¯ç”Ÿæˆä¸éªŒè¯"><a href="#HDé’±åŒ…åŠ©è®°è¯ç”Ÿæˆä¸éªŒè¯" class="headerlink" title="HDé’±åŒ…åŠ©è®°è¯ç”Ÿæˆä¸éªŒè¯"></a>HDé’±åŒ…åŠ©è®°è¯ç”Ÿæˆä¸éªŒè¯</h1><h2 id="1-åŠ©è®°è¯ç”ŸæˆåŸç†"><a href="#1-åŠ©è®°è¯ç”ŸæˆåŸç†" class="headerlink" title="1.åŠ©è®°è¯ç”ŸæˆåŸç†"></a>1.åŠ©è®°è¯ç”ŸæˆåŸç†</h2><p><strong>1.1.éšæœºç†µç”Ÿæˆ</strong> é¦–å…ˆç”Ÿæˆä¸€æ®µéšæœº<strong>ç†µ</strong>ï¼ˆEntropyï¼‰ã€‚ç†µçš„é•¿åº¦å¯ä»¥æ˜¯ 128 åˆ° 256 ä½ï¼Œå¹¶ä¸”æ˜¯ 32 çš„å€æ•°ã€‚å¸¸è§çš„ç†µé•¿åº¦æœ‰ 128 ä½ï¼ˆ12 ä¸ªåŠ©è®°è¯ï¼‰å’Œ 256 ä½ï¼ˆ24 ä¸ªåŠ©è®°è¯ï¼‰ã€‚æ¯å¢åŠ 3ä¸ªå•è¯ï¼Œ</p><p>12ä¸ªåŠ©è®°è¯å¯¹åº”128ä½ç†µï¼Œ15ä¸ªå¯¹åº”160ä½ç†µï¼Œ18ä¸ªå¯¹åº”192ï¼Œ21ä¸ªå¯¹åº”224ä½ï¼Œ24ä¸ªå¯¹åº”256ï¼Œ</p><p>æ¯å¢åŠ 3ä¸ªå•è¯ï¼Œå¢åŠ 32ä½ç†µï¼Œ</p><p>éšæœºç†µçš„ç”Ÿæˆ32</p><p><strong>1.2.è®¡ç®—æ ¡éªŒå’Œ</strong> å¯¹ç†µè¿›è¡Œ <strong>SHA-256 å“ˆå¸Œ</strong>è®¡ç®—ï¼Œå¹¶å–å“ˆå¸Œå€¼çš„å‰å‡ ä½ä½œä¸ºæ ¡éªŒå’Œã€‚æ ¡éªŒå’Œçš„<strong>é•¿åº¦</strong>å–å†³äºç†µçš„é•¿åº¦ã€‚&#x3D;ç†µçš„é•¿åº¦ Ã· 32ï¼Œé™¤ä»¥32åå¾—åˆ°çš„å€¼å°±æ˜¯ä»–è¦æ ¡éªŒçš„ä½æ•°</p><p>ä¾‹å¦‚ï¼Œ128 ä½ç†µéœ€è¦ <strong>4 ä½</strong>æ ¡éªŒå’Œï¼ˆå› ä¸º 128 &#x2F; 32 &#x3D; 4ï¼‰ï¼Œ256 ä½ç†µéœ€è¦ 8 ä½æ ¡éªŒå’Œã€‚160&#x2F;32&#x3D;5ï¼Œ192&#x2F;32&#x3D;6ï¼Œ224&#x2F;32&#x3D;7â€¦â€¦</p><p><strong>1.3.ç»„åˆç†µå’Œæ ¡éªŒ</strong> å°†æ ¡éªŒå’Œé™„åŠ åˆ°ç†µçš„<strong>æœ«å°¾</strong>ï¼Œå½¢æˆä¸€ä¸ªæ–°çš„<strong>äºŒè¿›åˆ¶åºåˆ—</strong>ã€‚è¿™ä¸ªåºåˆ—çš„æ€»é•¿åº¦ä¸º (ç†µçš„é•¿åº¦ + æ ¡éªŒå’Œçš„é•¿åº¦)ã€‚</p><p><strong>1.4.åˆ†å‰²ä¸ºåŠ©è®°è¯ç´¢å¼•</strong> å°†ç»„åˆåçš„äºŒè¿›åˆ¶åºåˆ—åˆ†å‰²æˆæ¯ç»„ 11 ä½çš„ç‰‡æ®µï¼Œæ¯ä¸ªç‰‡æ®µè½¬æ¢ä¸ºä¸€ä¸ªæ•°å­—ï¼Œè¿™ä¸ªæ•°å­—ä½œä¸ºåŠ©è®°è¯åˆ—è¡¨ä¸­çš„ç´¢å¼•ã€‚</p><p><strong>1.5.æ˜ å°„ä¸ºåŠ©è®°è¯</strong> ä½¿ç”¨è¿™äº›ç´¢å¼•ä»é¢„å®šä¹‰çš„ <strong>2048 ä¸ª</strong>åŠ©è®°è¯åˆ—è¡¨ï¼ˆ<strong>BIP-39</strong> è¯åº“ï¼‰ä¸­æå–ç›¸åº”çš„åŠ©è®°è¯ã€‚è¿™äº›åŠ©è®°è¯å°±æ˜¯æœ€ç»ˆçš„åŠ©è®°è¯çŸ­è¯­</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ç”ŸæˆåŠ©è®°è¯</span><br><br><span class="hljs-comment"># 1.1.éšæœºç†µç”Ÿæˆ</span><br><span class="hljs-comment"># é¦–å…ˆç”Ÿæˆä¸€æ®µéšæœºç†µï¼ˆEntropyï¼‰ã€‚ç†µçš„é•¿åº¦å¯ä»¥æ˜¯ 128 åˆ° 256 ä½ï¼Œå¹¶ä¸”æ˜¯ 32 çš„å€æ•°ã€‚å¸¸è§çš„ç†µé•¿åº¦æœ‰ 128 ä½ï¼ˆ12 ä¸ªåŠ©è®°è¯ï¼‰å’Œ 256 ä½ï¼ˆ24 ä¸ªåŠ©è®°è¯ï¼‰ã€‚</span><br><br><br><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> bip39<br><br><span class="hljs-comment"># 1.1.éšæœºç†µç”Ÿæˆ</span><br><span class="hljs-comment"># entropy = os.urandom(16) </span><br><span class="hljs-comment"># osæ¨¡å—çš„ç”Ÿæˆ16ä½çš„éšæœºå­—èŠ‚ï¼Œè¿™é‡Œæ˜¯ç”Ÿæˆ128ä½çš„ç†µï¼Œ128ä½çš„ç†µå°±æ˜¯16å­—èŠ‚8ä½ä¸€ä¸ªå­—èŠ‚ï¼Œ128ä½çš„ç†µç”Ÿæˆçš„æ˜¯12ä¸ªåŠ©è®°è¯</span><br><span class="hljs-comment"># åŒç†ï¼Œå¦‚æœæˆ‘ç°åœ¨è¦15ä¸ªè¯çš„åŠ©è®°è¯ï¼Œé‚£å°±æ˜¯å¯¹åº”128+32=160ä½çš„ç†µï¼Œé™¤ä»¥8ä½å­—èŠ‚å°±æ˜¯20ä¸ªå­—èŠ‚ï¼Œ</span><br><span class="hljs-comment"># åŒç†ï¼šå¦‚æœæˆ‘ç°åœ¨è¦18ä¸ªè¯çš„åŠ©è®°è¯ï¼Œé‚£å°±æ˜¯å¯¹åº”çš„160+32=192ä½çš„ç†µï¼Œé™¤ä»¥8ä¸ªå­—èŠ‚å°±æ˜¯24ä¸ªå­—èŠ‚</span><br>entropy = <span class="hljs-string">b&#x27;\xfb\xe50\xc5\x84\xb6\x06&#123;.n\x12\x06SN\xb5\x82&#x27;</span><br><span class="hljs-built_in">print</span>(entropy)<br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">1.2.è®¡ç®—æ ¡éªŒå’Œ</span><br><span class="hljs-string">å¯¹ç†µè¿›è¡Œ SHA-256 å“ˆå¸Œè®¡ç®—ï¼Œå¹¶å–å“ˆå¸Œå€¼çš„å‰å‡ ä½ä½œä¸ºæ ¡éªŒå’Œã€‚sub scrip table</span><br><span class="hljs-string">æ ¡éªŒå’Œçš„é•¿åº¦å–å†³äºç†µçš„é•¿åº¦ã€‚ä¾‹å¦‚ï¼Œ128 ä½ç†µéœ€è¦ 4 ä½æ ¡éªŒå’Œï¼ˆå› ä¸º 128 / 32 = 4ï¼‰ï¼Œ256 ä½ç†µéœ€è¦ 8 ä½æ ¡éªŒå’Œ</span><br><span class="hljs-string">æœ€åæˆªå–å‰4ä½å‡ºæ¥å³å¯</span><br><span class="hljs-string">å¦‚æœæ˜¯128+32=160ä½ç†µï¼Œ160Ã·32=5ä½æ ¡éªŒå’Œï¼Œé‚£å°±è¦æå–å‰5ä½å‡ºæ¥</span><br><span class="hljs-string">å¦‚æœæ˜¯160+32=192ä½ç†µï¼Œ192Ã·32=6ä½æ ¡éªŒå’Œï¼Œé‚£å°±è¦æå–å‰6ä½å‡ºæ¥</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-comment">#é¦–å…ˆï¼Œhashlib.sha256(entropy)åˆ›å»ºä¸€ä¸ªSHA-256å“ˆå¸Œç®—æ³•å¯¹è±¡ï¼Œå¹¶å°†entropyä½œä¸ºè¾“å…¥è¿›è¡Œå“ˆå¸Œè®¡ç®—ã€‚</span><br><span class="hljs-comment"># ç„¶åï¼Œ.digest()æ–¹æ³•è¢«è°ƒç”¨ï¼Œè¿”å›è®¡ç®—å¾—åˆ°çš„å“ˆå¸Œç»“æœçš„äºŒè¿›åˆ¶è¡¨ç¤ºã€‚è¿™ä¸ªäºŒè¿›åˆ¶è¡¨ç¤ºæ˜¯ä¸€ä¸ªå­—èŠ‚æ•°ç»„ï¼ˆbytesï¼‰ï¼Œé•¿åº¦ä¸º32å­—èŠ‚ï¼ˆ256ä½ï¼‰ï¼Œè¡¨ç¤ºSHA-256ç®—æ³•å¯¹è¾“å…¥æ•°æ®çš„å“ˆå¸Œç»“æœã€‚</span><br>hash_bytes = hashlib.sha256(entropy).digest()<br><span class="hljs-built_in">print</span>(hash_bytes) <span class="hljs-comment"># b&#x27;s\xf7\xc9z\x88\xf0\x7f\x0f\xf0`(\xe4\xd6\x92@\xa9?\xa2os~\xbe*\x86\xe7w\x97D\xf8Z&quot;\xb4&#x27;</span><br><span class="hljs-comment"># entropy_sha256[0]è¡¨ç¤ºentropy_sha256çš„ç¬¬ä¸€ä¸ªå­—èŠ‚ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ•´æ•°å€¼ã€‚</span><br><span class="hljs-comment"># bin(entropy_sha256[0])å°†è¯¥æ•´æ•°å€¼è½¬æ¢ä¸ºå¯¹åº”çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼Œè¿”å›çš„å­—ç¬¦ä¸²ä»¥0bå¼€å¤´ï¼Œä¾‹å¦‚0b11001010ã€‚</span><br><span class="hljs-comment"># [2:]æ˜¯å¯¹äºŒè¿›åˆ¶å­—ç¬¦ä¸²è¿›è¡Œåˆ‡ç‰‡æ“ä½œï¼Œå»æ‰å¼€å¤´çš„0bï¼Œä¾‹å¦‚11001010ã€‚</span><br><span class="hljs-comment"># .zfill(8)å°†äºŒè¿›åˆ¶å­—ç¬¦ä¸²å¡«å……åˆ°8ä½ï¼Œä¸è¶³çš„ä½æ•°åœ¨å¼€å¤´è¡¥é›¶ï¼Œä¾‹å¦‚11001010å˜ä¸º11001010ã€‚</span><br><span class="hljs-comment"># [:4]æ˜¯å¯¹äºŒè¿›åˆ¶å­—ç¬¦ä¸²è¿›è¡Œåˆ‡ç‰‡æ“ä½œï¼Œæˆªå–å‰4ä½ï¼Œä¾‹å¦‚11001010å˜ä¸º1100ã€‚</span><br><span class="hljs-comment"># ç»“æœè¢«èµ‹å€¼ç»™å˜é‡entropy_binï¼Œè¡¨ç¤ºå¯¹entropy_sha256çš„ç¬¬ä¸€ä¸ªå­—èŠ‚è¿›è¡Œå¤„ç†åå¾—åˆ°çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼Œé•¿åº¦ä¸º4ä½ã€‚</span><br>checksum_bits = <span class="hljs-built_in">bin</span>(hash_bytes[<span class="hljs-number">0</span>])[<span class="hljs-number">2</span>:].zfill(<span class="hljs-number">8</span>)[:<span class="hljs-number">4</span>]<br><span class="hljs-built_in">print</span>(checksum_bits) <span class="hljs-comment"># 0111</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">1.3.ç»„åˆç†µå’Œæ ¡éªŒ</span><br><span class="hljs-string">å°†æ ¡éªŒå’Œé™„åŠ åˆ°ç†µçš„æœ«å°¾ï¼Œå½¢æˆä¸€ä¸ªæ–°çš„äºŒè¿›åˆ¶åºåˆ—ã€‚è¿™ä¸ªåºåˆ—çš„æ€»é•¿åº¦ä¸º (ç†µçš„é•¿åº¦ + æ ¡éªŒå’Œçš„é•¿åº¦)ã€‚</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-comment"># è¿™é‡Œbin(byte)åçš„[2:]æ˜¯åˆ‡æ‰0bå¼€å¤´ï¼Œzfill(8)æ˜¯å¡«å……ï¼Œå¦‚æœé•¿åº¦æ²¡æœ‰8ä½å°±å¡«å……0</span><br>entropy_bits = <span class="hljs-string">&#x27;&#x27;</span>.join([<span class="hljs-built_in">bin</span>(byte)[<span class="hljs-number">2</span>:].zfill(<span class="hljs-number">8</span>)<br>                       <span class="hljs-keyword">for</span> byte <span class="hljs-keyword">in</span> entropy])  <span class="hljs-comment"># è¿™ä¸€æ­¥æ˜¯ç”Ÿæˆæ ¡éªŒå’Œ</span><br><span class="hljs-built_in">print</span>(entropy_bits) <span class="hljs-comment"># ä¸€å †0101</span><br><span class="hljs-comment"># æŠŠæ ¡éªŒå’Œæ‹¼æ¥åˆ°ç†µçš„æœ«å°¾</span><br>combined_bits = entropy_bits + checksum_bits<br><span class="hljs-built_in">print</span>(combined_bits) <span class="hljs-comment"># ä¸€å †0101</span><br><br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">1.4 åˆ†å‰²ä¸ºåŠ©è®°è¯ç´¢å¼•ï¼Œç­‰ä¸‹å»åŠ©è®°è¯åº“é‡Œé¢é‚£åŠ©è®°è¯</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-comment"># range(0, len(combined_bits), 11)åˆ›å»ºä¸€ä¸ªè¿­ä»£èŒƒå›´ï¼Œä»0å¼€å§‹ï¼Œæ¯æ¬¡å¢åŠ 11ï¼Œç›´åˆ°è¾¾åˆ°combined_bitsçš„é•¿åº¦ä¹‹å‰çš„æœ€å¤§å€¼ã€‚</span><br><span class="hljs-comment"># combined_bits[i:i + 11]æ˜¯å¯¹combined_bitsè¿›è¡Œåˆ‡ç‰‡ï¼Œä»ç´¢å¼•iå¼€å§‹ï¼Œåˆ‡ç‰‡é•¿åº¦ä¸º11ï¼Œå¾—åˆ°ä¸€ä¸ª11ä½çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²ã€‚</span><br><span class="hljs-comment"># int(combined_bits[i:i + 11], 2)å°†åˆ‡ç‰‡å¾—åˆ°çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ä¼ é€’ç»™int()å‡½æ•°ï¼Œå¹¶æŒ‡å®šè¿›åˆ¶ä¸º2ï¼Œå°†äºŒè¿›åˆ¶å­—ç¬¦ä¸²è½¬æ¢ä¸ºå¯¹åº”çš„æ•´æ•°å€¼ã€‚</span><br>indices = [<span class="hljs-built_in">int</span>(combined_bits[i:i + <span class="hljs-number">11</span>], <span class="hljs-number">2</span>)<br>           <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(combined_bits), <span class="hljs-number">11</span>)] <span class="hljs-comment"># 11æ˜¯æ­¥é•¿ï¼Œ[i:i+11]è¡¨ç¤ºå¾€åé¢å–11ä½</span><br><span class="hljs-built_in">print</span>(indices)  <span class="hljs-comment"># è¿™æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œé‡Œé¢æœ‰12ä¸ªæ•°å­—ç´¢å¼•ï¼Œ</span><br><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">1.5 æ˜ å°„ä¸ºåŠ©è®°è¯ï¼Œå°±æ˜¯é€šè¿‡ä¸Šé¢çš„ç´¢å¼•åˆ—è¡¨å»åŠ©è®°è¯åº“é‡Œé¢æ‹¿åˆ°å¯¹åº”çš„åŠ©è®°è¯</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br>wordlist = bip39.INDEX_TO_WORD_TABLE  <span class="hljs-comment"># bip39.INDEX_TO_WORD_TABLE è¿”å›å‡ºæ¥çš„æ˜¯2048ä¸ªåŠ©è®°è¯å•è¯ç»„æˆçš„å…ƒç»„</span><br><br>mnemonic = <span class="hljs-string">&#x27; &#x27;</span>.join(wordlist[index] <span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> indices)<br><span class="hljs-built_in">print</span>(mnemonic)<br></code></pre></td></tr></table></figure><h1 id="äºŒ-åŠ©è®°è¯éªŒè¯è¿‡ç¨‹"><a href="#äºŒ-åŠ©è®°è¯éªŒè¯è¿‡ç¨‹" class="headerlink" title="äºŒ. åŠ©è®°è¯éªŒè¯è¿‡ç¨‹"></a>äºŒ. åŠ©è®°è¯éªŒè¯è¿‡ç¨‹</h1><h2 id="2-1-åŠ©è®°è¯éªŒè¯åŸç†-æˆ–-æµç¨‹"><a href="#2-1-åŠ©è®°è¯éªŒè¯åŸç†-æˆ–-æµç¨‹" class="headerlink" title="2.1 åŠ©è®°è¯éªŒè¯åŸç† æˆ– æµç¨‹"></a>2.1 åŠ©è®°è¯éªŒè¯åŸç† æˆ– æµç¨‹</h2><h3 id="2-1-1-æ£€æŸ¥å•è¯æ•°é‡"><a href="#2-1-1-æ£€æŸ¥å•è¯æ•°é‡" class="headerlink" title="2.1.1 æ£€æŸ¥å•è¯æ•°é‡"></a>2.1.1 æ£€æŸ¥å•è¯æ•°é‡</h3><p> ç¬¬ä¸€æ­¥è‚¯å®šæ˜¯æ£€æŸ¥å•è¯æ•°é‡ï¼Œå› ä¸ºåŠ©è®°è¯çš„å•è¯æ•°é‡é€šå¸¸æ˜¯ 12ã€15ã€18ã€21 æˆ– 24 ä¸ªå•è¯ã€‚å¦‚æœä¸æ˜¯ï¼Œåˆ™ä¸åœ¨è¿™äº›èŒƒå›´å†…ã€‚</p><h3 id="2-2-2-æ£€æŸ¥å•è¯æ˜¯å¦åœ¨è¯è¡¨ä¸­"><a href="#2-2-2-æ£€æŸ¥å•è¯æ˜¯å¦åœ¨è¯è¡¨ä¸­" class="headerlink" title="2.2.2 æ£€æŸ¥å•è¯æ˜¯å¦åœ¨è¯è¡¨ä¸­"></a>2.2.2 æ£€æŸ¥å•è¯æ˜¯å¦åœ¨è¯è¡¨ä¸­</h3><p>ç¬¬äºŒæ­¥æ˜¯æ£€æŸ¥å•è¯æ˜¯å¦éƒ½åœ¨bip39çš„2048ä¸ªå•è¯çš„è¯æ±‡è¡¨ä¸­ï¼Œå¦‚æœä¸æ˜¯åˆ™é”™</p><h3 id="2-2-3-å°†åŠ©è®°è¯è½¬åŒ–ä¸ºä½ä¸²"><a href="#2-2-3-å°†åŠ©è®°è¯è½¬åŒ–ä¸ºä½ä¸²" class="headerlink" title="2.2.3 å°†åŠ©è®°è¯è½¬åŒ–ä¸ºä½ä¸²"></a>2.2.3 å°†åŠ©è®°è¯è½¬åŒ–ä¸ºä½ä¸²</h3><p>å°†æ¯ä¸ªåŠ©è®°è¯çš„å•è¯è½¬æ¢æˆå®ƒåœ¨bip39è¯æ±‡è¡¨ä¸­å¯¹åº”çš„ç´¢å¼•ä½ï¼Œæ¯ä¸ªç´¢å¼•éƒ½è¡¨ç¤ºä¸€ä¸ª11ä½çš„äºŒè¿›åˆ¶æ•°ï¼ˆ0101ç ï¼‰</p><p>å°†æ‰€æœ‰çš„äºŒè¿›åˆ¶æ•°è¿æ¥èµ·æ¥å½¢æˆä¸€ä¸ªä½ä¸²</p><h3 id="2-2-4-æå–ç§å­å’Œæ ¡éªŒå’Œ"><a href="#2-2-4-æå–ç§å­å’Œæ ¡éªŒå’Œ" class="headerlink" title="2.2.4 æå–ç§å­å’Œæ ¡éªŒå’Œ"></a>2.2.4 æå–ç§å­å’Œæ ¡éªŒå’Œ</h3><p>ä½ä¸²çš„é•¿åº¦åº”è¯¥æ˜¯åŠ©è®°è¯å•è¯æ•°ä¹˜ä»¥11ï¼Œä¾‹å¦‚12ä¸ªå•è¯çš„åŠ©è®°è¯å¯¹åº”çš„ä½ä¸²é•¿åº¦ä¸º132ä½ï¼Œä½ä¸²çš„å‰128ä½æ˜¯ç§å­ï¼Œå4ä¸ºæ˜¯æ ¡éªŒå’Œã€‚</p><h3 id="2-2-5-è®¡ç®—æ ¡éªŒå’Œ"><a href="#2-2-5-è®¡ç®—æ ¡éªŒå’Œ" class="headerlink" title="2.2.5 è®¡ç®—æ ¡éªŒå’Œ"></a>2.2.5 è®¡ç®—æ ¡éªŒå’Œ</h3><p>å°†ç§å­é€šè¿‡SHA-256å“ˆå¸Œå‡½æ•°è®¡ç®—å¤„ä¸€ä¸ªå“ˆå¸Œå€¼ï¼Œç„¶åå–å“ˆå¸Œå€¼çš„å‰4ä½ä½œä¸ºè®¡ç®—å¾—åˆ°çš„æ ¡éªŒå’Œã€‚</p><h3 id="2-2-6-éªŒè¯æ ¡éªŒå’Œ"><a href="#2-2-6-éªŒè¯æ ¡éªŒå’Œ" class="headerlink" title="2.2.6 éªŒè¯æ ¡éªŒå’Œ"></a>2.2.6 éªŒè¯æ ¡éªŒå’Œ</h3><p>æ¯”è¾ƒæå–çš„æ ¡éªŒå’Œ å’Œ è®¡ç®—å¾—åˆ°çš„æ ¡éªŒå’Œã€‚å¦‚æœä¸¤è€…åŒ¹é…ï¼Œåˆ™åŠ©è®°è¯æœ‰æ•ˆï¼Œå¦åˆ™æ— æ•ˆ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> bip39<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">validate_mnemonic</span>(<span class="hljs-params">mnemonic, wordlist</span>):<br>    words = mnemonic.split()<br>    <br>    <span class="hljs-comment"># æ£€æŸ¥å•è¯æ•°é‡</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(words) <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> [<span class="hljs-number">12</span>, <span class="hljs-number">15</span>, <span class="hljs-number">18</span>, <span class="hljs-number">21</span>, <span class="hljs-number">24</span>]:<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>    <br>    <span class="hljs-comment"># æ£€æŸ¥å•è¯æ˜¯å¦åœ¨è¯æ±‡è¡¨ä¸­</span><br>    <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> words:<br>        <span class="hljs-keyword">if</span> word <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> wordlist:<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>    <br>    <span class="hljs-comment"># å°†åŠ©è®°è¯è½¬åŒ–æˆä½ä¸²</span><br>    binary_string = <span class="hljs-string">&#x27;&#x27;</span><br>    <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> words:<br>        index = wordlist.index(word)<br>        binary_string += <span class="hljs-built_in">format</span>(index, <span class="hljs-string">&#x27;011b&#x27;</span>) <span class="hljs-comment"># format(index, &#x27;011b&#x27;) çš„å«ä¹‰æ˜¯å°† index æ ¼å¼åŒ–ä¸º 11 ä½çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼Œä¸è¶³ 11 ä½çš„éƒ¨åˆ†åœ¨å‰é¢ç”¨é›¶å¡«å……ã€‚</span><br>    <span class="hljs-built_in">print</span>(binary_string)<br>    <span class="hljs-comment"># æå–ç§å­å’Œæ ¡éªŒå’Œ</span><br>    <span class="hljs-comment"># è®¡ç®—ç§å­éƒ¨åˆ†çš„é•¿åº¦ã€‚æ ¹æ®ç»™å®šçš„å•è¯åˆ—è¡¨ words çš„é•¿åº¦ï¼Œæ¯ä¸ªå•è¯å ç”¨ 11 ä½çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼Œé™¤ä»¥ 3 å–æ•´æ•°éƒ¨åˆ†è¡¨ç¤ºæ ¡éªŒå’Œçš„é•¿åº¦ã€‚é€šè¿‡å‡å»æ ¡éªŒå’Œçš„é•¿åº¦ï¼Œå¾—åˆ°ç§å­éƒ¨åˆ†çš„é•¿åº¦ã€‚</span><br>    seed_bits_length = (<span class="hljs-built_in">len</span>(words) * <span class="hljs-number">11</span>) - (<span class="hljs-built_in">len</span>(words) // <span class="hljs-number">3</span>) <span class="hljs-comment"># </span><br>    <span class="hljs-comment"># ä» binary_string ä¸­æå–ç§å­éƒ¨åˆ†ã€‚ä½¿ç”¨åˆ‡ç‰‡æ“ä½œ [:seed_bits_length]ï¼Œè·å–ä»å¼€å¤´åˆ°ç§å­éƒ¨åˆ†é•¿åº¦çš„å­å­—ç¬¦ä¸²ã€‚</span><br>    seed_bits = binary_string[:seed_bits_length]<br>    <span class="hljs-comment"># ä» binary_string ä¸­æå–æ ¡éªŒå’Œéƒ¨åˆ†ã€‚ä½¿ç”¨åˆ‡ç‰‡æ“ä½œ [seed_bits_length:]ï¼Œè·å–ä»ç§å­éƒ¨åˆ†é•¿åº¦å¼€å§‹åˆ°æœ«å°¾çš„å­å­—ç¬¦ä¸²ã€‚</span><br>    checksum_bits = binary_string[seed_bits_length:]<br>    <br>    <br>    <span class="hljs-comment"># è®¡ç®—æ ¡éªŒå’Œ</span><br>    <span class="hljs-keyword">import</span> hashlib<br>    <span class="hljs-comment"># å°†ç§å­éƒ¨åˆ†çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸² seed_bits è½¬æ¢ä¸ºå­—èŠ‚ä¸²ã€‚</span><br>    <span class="hljs-comment"># é¦–å…ˆï¼Œä½¿ç”¨ int(seed_bits, 2) å°†äºŒè¿›åˆ¶å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´æ•°ã€‚</span><br>    <span class="hljs-comment"># ç„¶åï¼Œä½¿ç”¨ to_bytes(len(seed_bits) // 8, byteorder=&#x27;big&#x27;) å°†æ•´æ•°è½¬æ¢ä¸ºå­—èŠ‚ä¸²ï¼Œ</span><br>    <span class="hljs-comment"># å…¶ä¸­ len(seed_bits) // 8 è¡¨ç¤ºå­—èŠ‚ä¸²çš„é•¿åº¦ï¼Œbyteorder=&#x27;big&#x27; è¡¨ç¤ºä½¿ç”¨å¤§ç«¯å­—èŠ‚åºã€‚</span><br>    seed_bytes = <span class="hljs-built_in">int</span>(seed_bits, <span class="hljs-number">2</span>).to_bytes(<span class="hljs-built_in">len</span>(seed_bits) // <span class="hljs-number">8</span>, byteorder=<span class="hljs-string">&#x27;big&#x27;</span>)<br>    <span class="hljs-comment"># å¯¹ç§å­å­—èŠ‚ä¸² seed_bytes è¿›è¡Œ SHA-256 å“ˆå¸Œè®¡ç®—ï¼Œå¹¶è·å–å“ˆå¸Œç»“æœçš„åå…­è¿›åˆ¶è¡¨ç¤ºã€‚</span><br>    <span class="hljs-comment"># ä½¿ç”¨ hashlib.sha256() åˆ›å»º SHA-256 å“ˆå¸Œç®—æ³•å¯¹è±¡ï¼Œç„¶åè°ƒç”¨ .hexdigest() æ–¹æ³•è·å–å“ˆå¸Œç»“æœçš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²è¡¨ç¤ºã€‚</span><br>    hash_value = hashlib.sha256(seed_bytes).hexdigest()<br>    <span class="hljs-comment"># å°†å“ˆå¸Œç»“æœçš„åå…­è¿›åˆ¶å­—ç¬¦ä¸² hash_value è½¬æ¢ä¸º 256 ä½çš„äºŒè¿›åˆ¶å­—ç¬¦ä¸²ã€‚</span><br>    <span class="hljs-comment"># é¦–å…ˆï¼Œä½¿ç”¨ int(hash_value, 16) å°†åå…­è¿›åˆ¶å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´æ•°ã€‚</span><br>    <span class="hljs-comment"># ç„¶åï¼Œä½¿ç”¨ bin() å°†æ•´æ•°è½¬æ¢ä¸ºäºŒè¿›åˆ¶å­—ç¬¦ä¸²ï¼Œå»æ‰å¼€å¤´çš„ &#x27;0b&#x27;ï¼Œå¹¶ä½¿ç”¨ zfill(256) åœ¨å‰é¢å¡«å……é›¶ï¼Œä½¿å…¶é•¿åº¦è¾¾åˆ° 256 ä½ã€‚</span><br>    hash_bits = <span class="hljs-built_in">bin</span>(<span class="hljs-built_in">int</span>(hash_value, <span class="hljs-number">16</span>))[<span class="hljs-number">2</span>:].zfill(<span class="hljs-number">256</span>)<br>    <span class="hljs-comment"># æå–æ ¡éªŒå’Œéƒ¨åˆ†ã€‚ä½¿ç”¨åˆ‡ç‰‡æ“ä½œ [:len(words) // 3]ï¼Œè·å–ä»äºŒè¿›åˆ¶å­—ç¬¦ä¸² hash_bits çš„å¼€å¤´åˆ°æ ¡éªŒå’Œé•¿åº¦çš„å­å­—ç¬¦ä¸²ã€‚æ ¡éªŒå’Œé•¿åº¦ä¸ºå•è¯åˆ—è¡¨ words çš„é•¿åº¦é™¤ä»¥ 3ã€‚</span><br>    calculated_checksum = hash_bits[:<span class="hljs-built_in">len</span>(words) // <span class="hljs-number">3</span>]<br>    <br>    <span class="hljs-comment"># éªŒè¯æ ¡éªŒå’Œï¼Œåˆ¤æ–­åŠ©è®°è¯è½¬æ¢çš„ä½ä¸²ä¸è®¡ç®—å¾—æ¥çš„æ ¡éªŒå’Œä¸€è‡´</span><br>    <span class="hljs-keyword">return</span> checksum_bits == calculated_checksum<br><br><span class="hljs-comment"># Example usage:</span><br>mnemonic = <span class="hljs-string">&quot;legal winner thank year wave sausage worth useful legal winner thank yellow&quot;</span><br>wordlist = bip39.INDEX_TO_WORD_TABLE  <span class="hljs-comment"># BIP-39 wordlist</span><br>is_valid = validate_mnemonic(mnemonic, wordlist)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Is valid mnemonic:&quot;</span>, is_valid)<br></code></pre></td></tr></table></figure><h1 id="ä¸‰-ç¼–ç è§£ç è¿‡ç¨‹"><a href="#ä¸‰-ç¼–ç è§£ç è¿‡ç¨‹" class="headerlink" title="ä¸‰. ç¼–ç è§£ç è¿‡ç¨‹"></a>ä¸‰. ç¼–ç è§£ç è¿‡ç¨‹</h1><h1 id="å››-è°ƒç”¨-BIP-39-è¯åº“ç”ŸæˆåŠ©è®°è¯"><a href="#å››-è°ƒç”¨-BIP-39-è¯åº“ç”ŸæˆåŠ©è®°è¯" class="headerlink" title="å››. è°ƒç”¨ BIP-39 è¯åº“ç”ŸæˆåŠ©è®°è¯"></a>å››. è°ƒç”¨ BIP-39 è¯åº“ç”ŸæˆåŠ©è®°è¯</h1><h2 id="4-1-ä»£ç å°è£…"><a href="#4-1-ä»£ç å°è£…" class="headerlink" title="4.1 ä»£ç å°è£…"></a>4.1 ä»£ç å°è£…</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Bip39Mnemonic</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">pass</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">createMnemonic</span>(<span class="hljs-params">self, number</span>):<br>        mnemonic = bip39.get_entropy_bits(number)<br>        <span class="hljs-keyword">return</span> mnemonic<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">mnemonicToEntropy</span>(<span class="hljs-params">self,  mnemonic</span>):<br>        decode_words = bip39.decode_phrase( mnemonic)<br>        <span class="hljs-keyword">return</span> decode_words<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">entropyToMnemonic</span>(<span class="hljs-params">self, entropy</span>):<br>        nemonic_entropy = bip39.encode_bytes(entropy)<br>        <span class="hljs-keyword">return</span> nemonic_entropy<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">mnemonicToSeed</span>(<span class="hljs-params">self, mnemonic</span>):<br>        nemonic_to_seed = bip39.phrase_to_seed(mnemonic)<br>        <span class="hljs-keyword">return</span> nemonic_to_seed<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">validateMnemonic</span>(<span class="hljs-params">self, mnemonic</span>):<br>        <span class="hljs-keyword">return</span> bip39.check_phrase(mnemonic)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">generateMnemonic</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-comment"># 1. ç”Ÿæˆ 128 ä½éšæœºç†µ (16 å­—èŠ‚)</span><br>        entropy = os.urandom(<span class="hljs-number">16</span>)<br><br>        <span class="hljs-comment"># 2. è®¡ç®—æ ¡éªŒå’Œ (SHA-256)</span><br>        hash_bytes = hashlib.sha256(entropy).digest()<br>        checksum_bits = <span class="hljs-built_in">bin</span>(hash_bytes[<span class="hljs-number">0</span>])[<span class="hljs-number">2</span>:].zfill(<span class="hljs-number">8</span>)[:<span class="hljs-number">4</span>]  <span class="hljs-comment"># å–å‰ 4 ä½</span><br><br>        <span class="hljs-comment"># 3. ç»„åˆç†µå’Œæ ¡éªŒå’Œ</span><br>        entropy_bits = <span class="hljs-string">&#x27;&#x27;</span>.join([<span class="hljs-built_in">bin</span>(byte)[<span class="hljs-number">2</span>:].zfill(<span class="hljs-number">8</span>) <span class="hljs-keyword">for</span> byte <span class="hljs-keyword">in</span> entropy])<br>        combined_bits = entropy_bits + checksum_bits<br><br>        <span class="hljs-comment"># 4. åˆ†å‰²ä¸ºåŠ©è®°è¯ç´¢å¼•</span><br>        indices = [<span class="hljs-built_in">int</span>(combined_bits[i:i + <span class="hljs-number">11</span>], <span class="hljs-number">2</span>) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(combined_bits), <span class="hljs-number">11</span>)]<br><br>        <span class="hljs-comment"># 5. æ˜ å°„ä¸ºåŠ©è®°è¯</span><br>        wordlist = bip39.INDEX_TO_WORD_TABLE<br>        mnemonic = <span class="hljs-string">&#x27; &#x27;</span>.join([wordlist[index] <span class="hljs-keyword">for</span> index <span class="hljs-keyword">in</span> indices])<br><br>        <span class="hljs-keyword">return</span> mnemonic<br></code></pre></td></tr></table></figure><p>æµ‹è¯•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> bip<br><br><span class="hljs-keyword">import</span> bip<br><br>bip39_mnemonic = bip.Bip39Mnemonic()<br>mnemonic_phrase = bip39_mnemonic.generateMnemonic()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Generated mnemonic phrase: <span class="hljs-subst">&#123;mnemonic_phrase&#125;</span>&quot;</span>)<br><br>mnemonic_12_phrase = bip39_mnemonic.createMnemonic(<span class="hljs-number">12</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;create mnemonic phrase: <span class="hljs-subst">&#123;mnemonic_12_phrase&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure><p>1ã€åŠ©è®°è¯ç”Ÿæˆcodeï¼ŒåŠ å¯†ä¹‹åå­˜å‚¨åœ¨æœ¬åœ°è®¾å¤‡ï¼Œ</p><p>2ã€å¦‚æœè¦å¤‡ä»½æˆ–å¯¼å‡ºåŠ©è®°è¯ï¼Œå°±è¦æŠŠcodeè½¬æˆåŠ©è®°è¯</p><p>3ã€bip39 è¿˜å¯ä»¥ç”¨æ¥éªŒè¯åŠ©è®°è¯æ˜¯å¦æœ‰æ•ˆã€‚</p><p>4ã€åŠ©è®°è¯å˜æˆéšæœºç§å­ï¼Œç„¶åå†å»å¯¼å‡º</p><p>5ã€ç”ŸæˆåŠ©è®°è¯çš„æ–¹æ³•</p><p>bip39â€“</p><h1 id="ç§é’¥å¯¹åº”å…³ç³»"><a href="#ç§é’¥å¯¹åº”å…³ç³»" class="headerlink" title="ç§é’¥å¯¹åº”å…³ç³»"></a>ç§é’¥å¯¹åº”å…³ç³»</h1><p><img src="/img/web3/privkey.png"></p><p>æ¤­åœ†æ›²çº¿æ˜¯ä»€ä¹ˆï¼š</p><p>ä»¥å¤ªåŠå’Œæ¯”ç‰¹å¸ä½¿ç”¨å®Œå…¨ç›¸åŒçš„æ¤­åœ†æ›²çº¿ï¼š<code>secp256k1</code>ï¼Œå…¬é’¥å°±æ˜¯è¿™ä¸ªæ¤­åœ†æ›²çº¿ä¸Šçš„(x, y)åæ ‡ï¼Œxï¼Œy æ•°å€¼é€šè¿‡ç§é’¥å”¯ä¸€ç¡®å®šã€‚</p><p>xã€y å„ 32 å­—èŠ‚ï¼Œæ•…å…¬é’¥ä¸º 64 å­—èŠ‚ã€‚ä½ å¯èƒ½ä¼šçœ‹åˆ° 65 å­—èŠ‚è¡¨ç¤ºçš„å…¬é’¥ï¼Œè¿™æ˜¯ç”± SECG å‘å¸ƒçš„è¡Œä¸šæ ‡å‡†çš„ä¸€ç§åºåˆ—åŒ–ç¼–ç æ–¹å¼ï¼Œåœ¨æœ€å‰é¢åŠ ä¸€ä¸ªå­—èŠ‚çš„å‰ç¼€ï¼Œ04 è¡¨ç¤ºå…¬é’¥ä¸ºéå‹ç¼©æ ¼å¼ï¼Œå³å®Œæ•´å­˜å‚¨äº† x å’Œ y çš„åæ ‡å„ 32 å­—èŠ‚ã€‚</p><p>é€šè¿‡goè¯­è¨€ç”Ÿæˆç§é’¥å’Œå…¬é’¥è¿˜æœ‰åœ°å€</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">import</span> (<br>    <span class="hljs-string">&quot;crypto/elliptic&quot;</span><br>    <span class="hljs-string">&quot;crypto/rand&quot;</span><br>    <span class="hljs-string">&quot;encoding/hex&quot;</span><br><br>    <span class="hljs-string">&quot;github.com/ethereum/go-ethereum/common&quot;</span><br>    <span class="hljs-string">&quot;github.com/ethereum/go-ethereum/crypto&quot;</span><br>    <span class="hljs-string">&quot;github.com/ethereum/go-ethereum/crypto/secp256k1&quot;</span><br>)<br></code></pre></td></tr></table></figure><p>ç”Ÿæˆä¸€ä¸ªæ¤­åœ†æ›²çº¿</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">curve := secp256k1.S256()<br></code></pre></td></tr></table></figure><p>3 ç”Ÿæˆç§é’¥ï¼ˆ32byteï¼‰</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go">b := <span class="hljs-built_in">make</span>([]<span class="hljs-type">byte</span>, curve.Params().N.BitLen()/<span class="hljs-number">8</span>)<br>io.ReadFull(rand.Reader, b)<br>key := <span class="hljs-built_in">new</span>(big.Int).SetBytes(b) <span class="hljs-comment">// keyå°±æ˜¯ç§é’¥</span><br><br><span class="hljs-comment">// æ‰“å°ç§é’¥</span><br>fmt.Println(<span class="hljs-string">&quot;key:&quot;</span>, <span class="hljs-built_in">len</span>(key.Bytes()))<br>fmt.Println(<span class="hljs-string">&quot;key:&quot;</span>, hex.EncodeToString(key.Bytes()))<br></code></pre></td></tr></table></figure><p>4 ç”Ÿæˆå…¬é’¥ï¼šå¯¹ç§é’¥è¿›è¡Œæ¤­åœ†æ›²çº¿åŠ å¯†ï¼Œç”Ÿæˆå…¬é’¥(64byte)</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go">X, Y := curve.ScalarBaseMult(key.Bytes())<br>pubKey := elliptic.Marshal(curve, X, Y)<br><br>fmt.Println(<span class="hljs-string">&quot;pubKey:&quot;</span>, pubKey)<br><br></code></pre></td></tr></table></figure><p>5 ç”Ÿæˆåœ°å€ï¼šå»æ‰å…¬é’¥ç¬¬ä¸€ä¸ªå­—èŠ‚04ï¼Œå†ä½¿ç”¨keccak256ç®—æ³•å‹ç¼©å…¬é’¥ï¼Œæœ€åçš„20byteå°±æ˜¯åœ°å€</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go">compressPubKey := crypto.Keccak256(pubKey[<span class="hljs-number">1</span>:])<br>addr := common.BytesToAddress(compressPubKey[<span class="hljs-number">12</span>:])<br>fmt.Println(<span class="hljs-string">&quot;addr:&quot;</span>, addr.String())<br></code></pre></td></tr></table></figure><p>6 éªŒè¯ç§é’¥å’Œåœ°å€åŒ¹é…</p><p>å°†ç¬¬ 3 æ­¥äº§ç”Ÿçš„ç§é’¥å¯¼å…¥ metamask<br>æŸ¥çœ‹ metamask ç”Ÿæˆçš„åœ°å€ï¼Œå’Œç¬¬ 5 æ­¥è®¡ç®—å‡ºçš„åœ°å€æ˜¯å¦åŒ¹é…</p><p>ä»¥å¤ªåŠé’±åŒ…æœ‰2ç§</p><p>1 éç¡®å®šæ€§é’±åŒ…ï¼Œä¹Ÿå«éšæœºé’±åŒ…ï¼Œæ¯ä¸ªè´¦æˆ·é€šè¿‡ç‹¬ç«‹çš„éšæœºæ•°ç”Ÿæˆå™¨åˆ›å»ºï¼Œä½¿ç”¨keystoreç®¡ç†è´¦æˆ·ï¼Œæ²¡æœ‰åŠ©è®°è¯ï¼Œè¿™é‡Œä¸è¯¦ç»†ä»‹ç»ï¼Œå‚è€ƒé“¾æ¥<a href="https://www.learnblockchain.cn/article/7070">https://www.learnblockchain.cn/article/7070</a></p><p>2 åˆ†å±‚ç¡®å®šæ€§é’±åŒ…ï¼Œä¹Ÿå«<strong>HD Wallet</strong>ï¼Œæ¯ä¸ªè´¦æˆ·é€šè¿‡å›ºå®šçš„ç§å­(seed)æ´¾ç”Ÿï¼Œä½¿ç”¨<code>åŠ©è®°è¯</code>ç®¡ç†æ‰€æœ‰è´¦æˆ·ã€‚ã€è¡Œä¸šæ ‡å‡†äº†ã€‘</p><h1 id="åˆ†å±‚ç¡®å®šæ€§é’±åŒ…ï¼ˆHD-Walletï¼‰"><a href="#åˆ†å±‚ç¡®å®šæ€§é’±åŒ…ï¼ˆHD-Walletï¼‰" class="headerlink" title="åˆ†å±‚ç¡®å®šæ€§é’±åŒ…ï¼ˆHD Walletï¼‰"></a>åˆ†å±‚ç¡®å®šæ€§é’±åŒ…ï¼ˆHD Walletï¼‰</h1><p>é¦–å…ˆçœ‹ä¸€æ®µé…ç½®ä»£ç ï¼Œçœ‹é‡Œé¢çš„å‡ ä¸ªå…³é”®ä¿¡æ¯</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs go">module.exports = &#123;<br>  networks: &#123;<br>    sepolia: &#123;<br>      url: <span class="hljs-string">&quot;...&quot;</span>,<br>      accounts: &#123;<br>        mnemonic: <span class="hljs-string">&quot;test test test test test test test test test test test junk&quot;</span>,<br>        path: <span class="hljs-string">&quot;m/44&#x27;/60&#x27;/0&#x27;/0&quot;</span>,<br>        initialIndex: <span class="hljs-number">0</span>,<br>        count: <span class="hljs-number">20</span>,<br>        passphrase: <span class="hljs-string">&quot;&quot;</span>,<br>      &#125;,<br>    &#125;,<br>  &#125;,<br>&#125;;<br><br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥3ä¸ªé—®é¢˜ï¼š</p><p>1 <code>mnemoic</code>åŠ©è®°è¯å¦‚ä½•èƒ½ç”Ÿæˆè®¸å¤šä¸ªè´¦æˆ·åœ°å€ï¼Ÿ</p><p>2 path : â€œm&#x2F;44â€™&#x2F;60â€™&#x2F;0â€™&#x2F;0â€ éƒ½æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿä¸ºä»€ä¹ˆæœ‰äº›æ•°å­—å³ä¸Šè§’è¿˜æœ‰å°æ’‡å·ï¼Ÿå¦‚ä½•è‡ªå®šä¹‰é…ç½®ä»–ï¼Ÿ</p><p>3 passphrase æ˜¯ä»€ä¹ˆï¼Ÿ æœ‰ä»€ä¹ˆç”¨ï¼Ÿ å’Œmetamask çš„ç™»å½•å¯†ç ä¸€æ ·å—ï¼Ÿ</p><p>åŠ©è®°è¯</p><p>å…ˆå¯¼åŒ…</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">go</span> get github.com/ethereum/<span class="hljs-keyword">go</span>-ethereum/crypto <span class="hljs-comment">// ä»¥å¤ªåŠçš„å®˜æ–¹åº“</span><br><span class="hljs-keyword">go</span> get github.com/tyler-smith/<span class="hljs-keyword">go</span>-bip32 <span class="hljs-comment">// bip32</span><br><span class="hljs-keyword">go</span> get github.com/tyler-smith/<span class="hljs-keyword">go</span>-bip39 <span class="hljs-comment">// bip39</span><br><br></code></pre></td></tr></table></figure><p>å‰é¢è®²çš„æ˜¯BIP-39æå‡ºäº†åŠ©è®°è¯æ ‡å‡†ï¼ŒåŠ©è®°è¯æ˜¯ä¸€ç»„ç›¸å¯¹ä¾¿äºè®°å¿†çš„å•è¯ã€‚åœ¨BIP-39çš„è¯åº“é‡Œé¢</p><p>ä¸ºä»€ä¹ˆæå‡ºåŠ©è®°è¯ï¼Ÿæ˜¯ä¸ºäº†è§£å†³BIP-32ä¸­çš„ç§å­(Seed)éš¾äºè®°å¿†å’Œä¸æ–¹ä¾¿å¤‡ä»½çš„é—®é¢˜ï¼Œ</p><p>æ‰€ä»¥BIP-39ä¸»è¦åŒ…å«äº†2ä¸ªåŠŸèƒ½ï¼šç”±<strong>ç†µæºç”ŸæˆåŠ©è®°è¯</strong>ï¼Œç”±<strong>åŠ©è®°è¯ç”Ÿæˆç§å­</strong>ï¼ˆSeedï¼‰</p><p>æ‰€ä»¥æ˜¯â€“&gt;BIP-39è§£å†³åŠ©è®°è¯â€”&gt;BIP-32 </p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// ç”±ç†µæºç”ŸæˆåŠ©è®°è¯</span><br><span class="hljs-comment">// @å‚æ•° 128 =&gt; 12ä¸ªå•è¯</span><br><span class="hljs-comment">// @å‚æ•° 256 =&gt; 24ä¸ªå•è¯</span><br>entropy, _ := bip39.NewEntropy(<span class="hljs-number">128</span>) <br>mnemonic, _ := bip39.NewMnemonic(entropy) <span class="hljs-comment">// è¿™é‡Œä¹Ÿæ˜¯å‚è€ƒä¸Šé¢çš„æµç¨‹</span><br><span class="hljs-comment">// è¿™ä¸¤è¡Œä»£ç çš„åŸç†å¯ä»¥å‚è€ƒä¸Šé¢çš„ä»£ç çš„æµç¨‹ï¼š ç†µ-&gt;æ ¡éªŒå’Œ-&gt;å»å¤´å»å°¾æ‹¿ç´¢å¼•-&gt;æ ¹æ®ç´¢å¼•åˆ°è¯åº“æ‹¿è¯</span><br>fmt.Println(<span class="hljs-string">&quot;åŠ©è®°è¯ï¼š&quot;</span>, mnemonic)<br><br><span class="hljs-comment">// ç”±åŠ©è®°è¯ç”Ÿæˆç§å­(Seed)</span><br>seed := bip39.NewSeed(mnemonic, <span class="hljs-string">&quot;salt&quot;</span>) <span class="hljs-comment">// é—®é¢˜åœ¨è¿™é‡Œï¼Œ</span><br><span class="hljs-comment">// è¿™é‡Œç”Ÿæˆç§å­çš„æ–¹æ³•é‡Œä¼ äº†åŠ©è®°è¯å’Œç›å€¼è¿›å»å¾—åˆ°ç§å­ kaccak256å‹ç¼©æˆ32byteåå–æœ€å20byte</span><br><br></code></pre></td></tr></table></figure><p>ç”Ÿæˆseedçš„æ—¶å€™ï¼ŒåŠ å…¥ç›å€¼çš„ç›®çš„ä¸€æ˜¯å¢åŠ æš´åŠ›ç ´è§£çš„éš¾åº¦ï¼ŒäºŒæ˜¯ä¿æŠ¤ç§å­ï¼ˆseedï¼‰ï¼Œå°±æ˜¯å³ä½¿åŠ©è®°è¯è¢«ç›—äº†ï¼Œç§å­ä¹Ÿæ˜¯å®‰å…¨çš„ã€‚å¦‚æœè®¾ç½®äº†saltï¼Œè™½ç„¶å¤šäº†ä¸€å±‚ä¿æŠ¤ï¼Œä½†æ˜¯ä¸€æ—¦å¿˜è®°äº†ï¼Œä¹Ÿå°±ä»£è¡¨æ°¸ä¹…ä¸¢å¤±é’±åŒ…äº†ï¼Œæ‰€ä»¥è¦ç»“åˆå®é™…æƒ…å†µå»è€ƒè™‘</p><p>è¿™ä¸ªç›å€¼ä¹Ÿå«å¯†ç å£ä»¤ï¼ˆpassphraseï¼‰,å¼€å¤´çš„hardhaté…ç½®é‡Œçš„passphraseå°±æ˜¯è¿™ä¸ªç›å€¼ï¼Œå’Œmetamaskçš„ç™»å½•å¯†ç å®Œå…¨æ˜¯ä¸¤ä¸ªä¸œè¥¿ã€‚</p><p>æ‰“å°ä¸‹ä¸Šé¢çš„ä»£ç å¾—åˆ°çš„è¾“å‡º</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go">åŠ©è®°è¯ï¼š alarm misery master column coach connect tower govern view then hint author<br>seed [<span class="hljs-number">173</span> <span class="hljs-number">84</span> <span class="hljs-number">238</span> <span class="hljs-number">141</span> <span class="hljs-number">106</span> <span class="hljs-number">78</span> <span class="hljs-number">98</span> <span class="hljs-number">62</span> <span class="hljs-number">46</span> <span class="hljs-number">6</span> <span class="hljs-number">144</span> <span class="hljs-number">59</span> <span class="hljs-number">166</span> <span class="hljs-number">101</span> <span class="hljs-number">230</span> <span class="hljs-number">76</span> <span class="hljs-number">224</span> <span class="hljs-number">82</span> <span class="hljs-number">219</span> <span class="hljs-number">27</span> <span class="hljs-number">19</span> <span class="hljs-number">172</span> <span class="hljs-number">10</span> <span class="hljs-number">148</span> <span class="hljs-number">144</span> <span class="hljs-number">31</span> <span class="hljs-number">24</span> <span class="hljs-number">47</span> <span class="hljs-number">33</span> <span class="hljs-number">105</span> <span class="hljs-number">201</span> <span class="hljs-number">81</span> <span class="hljs-number">182</span> <span class="hljs-number">186</span> <span class="hljs-number">46</span> <span class="hljs-number">36</span> <span class="hljs-number">235</span> <span class="hljs-number">51</span> <span class="hljs-number">91</span> <span class="hljs-number">224</span> <span class="hljs-number">123</span> <span class="hljs-number">175</span> <span class="hljs-number">170</span> <span class="hljs-number">170</span> <span class="hljs-number">111</span> <span class="hljs-number">161</span> <span class="hljs-number">117</span> <span class="hljs-number">98</span> <span class="hljs-number">60</span> <span class="hljs-number">214</span> <span class="hljs-number">91</span> <span class="hljs-number">14</span> <span class="hljs-number">204</span> <span class="hljs-number">120</span> <span class="hljs-number">213</span> <span class="hljs-number">42</span> <span class="hljs-number">250</span> <span class="hljs-number">251</span> <span class="hljs-number">126</span> <span class="hljs-number">131</span> <span class="hljs-number">85</span> <span class="hljs-number">160</span> <span class="hljs-number">213</span> <span class="hljs-number">150</span>]<br><span class="hljs-keyword">type</span>: []<span class="hljs-type">uint8</span><br><br></code></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°ï¼šåŠ©è®°è¯æ˜¯12ä¸ªå•è¯çš„ï¼Œè€ŒSeedæ˜¯ä¸€å †çš„å­—ç¬¦ï¼Œè‚¯å®šæ˜¯åŠ©è®°è¯æ›´æ–¹ä¾¿å¤‡ä»½å’Œæ¢å¤é’±åŒ…</p><h1 id="åˆ†å±‚ç¡®å®šæ€§é’±åŒ…ï¼ˆHD-Walletï¼‰çš„åŸºæœ¬åŸç†"><a href="#åˆ†å±‚ç¡®å®šæ€§é’±åŒ…ï¼ˆHD-Walletï¼‰çš„åŸºæœ¬åŸç†" class="headerlink" title="åˆ†å±‚ç¡®å®šæ€§é’±åŒ…ï¼ˆHD Walletï¼‰çš„åŸºæœ¬åŸç†"></a>åˆ†å±‚ç¡®å®šæ€§é’±åŒ…ï¼ˆHD Walletï¼‰çš„åŸºæœ¬åŸç†</h1><p>ç°åœ¨æˆ‘ä»¬ç”¨ç§å­ç”Ÿäº§ä¸»è´¦æˆ·ç§é’¥ï¼Œè¿™é‡Œæ³¨æ„ï¼Œè¿™é‡Œçš„ç§é’¥è¿˜ä¸èƒ½ç›´æ¥å¯¼å…¥ï¼Œ</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs go">masterKey, _ := bip32.NewMasterKey(seed)<br>fmt.Println(<span class="hljs-string">&quot;masterKey:&quot;</span>, masterKey)<br><span class="hljs-comment">// masterKey: xprv9s21ZrQH143K4LW9szNE7QXNJkpPfFSL8k6CM9zsUb1N3czQhVFUXrZqYox2UDbgS96NrsDL2EwUzS9J6N6PfN4P3d3HNYqge6LYRQVWN6M</span><br><br><span class="hljs-comment">// å¯ä»¥çœ‹ä¸‹NewMasterKeyçš„å†…éƒ¨å®ç°å’Œè¿”å›å†…å®¹</span><br><span class="hljs-comment">// NewMasterKey creates a new master extended key from a seed</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewMasterKey</span><span class="hljs-params">(seed []<span class="hljs-type">byte</span>)</span></span> (*Key, <span class="hljs-type">error</span>) &#123;<br><span class="hljs-comment">// Generate key and chaincode</span><br>hmac := hmac.New(sha512.New, []<span class="hljs-type">byte</span>(<span class="hljs-string">&quot;Bitcoin seed&quot;</span>))<br>_, err := hmac.Write(seed)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err<br>&#125;<br>intermediary := hmac.Sum(<span class="hljs-literal">nil</span>)<br><br><span class="hljs-comment">// Split it into our key and chain code</span><br>keyBytes := intermediary[:<span class="hljs-number">32</span>]<br>chainCode := intermediary[<span class="hljs-number">32</span>:]<br><br><span class="hljs-comment">// Validate key</span><br>err = validatePrivateKey(keyBytes)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err<br>&#125;<br><br><span class="hljs-comment">// Create the key structï¼Œæ³¨æ„è¿™ä¸ªè¿”å›çš„keyç»“æ„ä½“ï¼Œ</span><br>key := &amp;Key&#123;<br>Version:     PrivateWalletVersion,<br>ChainCode:   chainCode,<br>Key:         keyBytes,<br>Depth:       <span class="hljs-number">0x0</span>,<br>ChildNumber: []<span class="hljs-type">byte</span>&#123;<span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>&#125;,<br>FingerPrint: []<span class="hljs-type">byte</span>&#123;<span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>&#125;,<br>IsPrivate:   <span class="hljs-literal">true</span>,<br>&#125;<br><br><span class="hljs-keyword">return</span> key, <span class="hljs-literal">nil</span><br>&#125;<br></code></pre></td></tr></table></figure><p>é¦–å…ˆï¼Œä¸Šé¢çš„ä»ç§å­ç”Ÿæˆä¸»è´¦æˆ·ç§é’¥ç”¨åˆ°çš„å°±æ˜¯<code>BIP-32</code>æ ‡å‡†ã€‚BIP-32æå‡ºäº†<strong>åˆ†å±‚ç¡®å®šæ€§é’±åŒ…ï¼ˆHD Walletï¼‰</strong>çš„æ ‡å‡†ï¼Œå®ƒå…è®¸ä»å•ä¸ªç§å­(Seed)ç”Ÿæˆä¸€ç³»åˆ—ç›¸å…³çš„å¯†é’¥å¯¹ï¼ŒæŠ¥è€ƒä¸€ä¸ªä¸»è´¦æˆ·ç§˜é’¥å’Œæ— çº¿å¤šä¸ªå­è´¦æˆ·ç§˜é’¥ï¼Œä¸åŒçš„å­è´¦æˆ·ä¹‹é—´å…·æœ‰å±‚æ¬¡å…³ç³»ï¼Œå½¢æˆäº†<strong>ä»¥ä¸»è´¦æˆ·ä¸ºæ ¹èŠ‚ç‚¹çš„æ ‘å½¢ç»“æ„</strong>ï¼š</p><p>å›¾ç‰‡</p><p>ç”±å›¾çœ‹å‡ºï¼ŒBIP-39è§£å†³ç†µæºç”ŸæˆåŠ©è®°è¯â€”&gt;åŠ©è®°è¯ç”Ÿæˆç§å­ï¼ˆSeedï¼‰</p><p>ç¬¬äºŒéƒ¨åˆ† BIP-32è¿™éƒ¨åˆ†çš„<strong>åˆ†å±‚ç¡®å®šæ€§é’±åŒ…</strong>ï¼ˆHD Walletï¼‰ï¼Œ</p><ul><li><p><strong>åˆ†å±‚</strong>ï¼šåˆ†å±‚çš„æ„æ€æ˜¯æ ‘å½¢ç»“æ„ï¼Œæ¯ä¸€å²‘éƒ½æœ‰ä¸€ä¸ªåºå·ï¼ˆä»0å¼€å§‹ï¼‰ï¼Œä¸»è´¦æˆ·ç§˜é’¥masteråºå·å°±æ˜¯0ï¼Œä¸€æ¬¡ç±»æ¨ï¼Œè¿™ä¸ªå«åšç´¢å¼•å·ï¼ˆ32ä½ï¼‰</p></li><li><p><strong>ç¡®å®šæ€§</strong>ï¼šå½“é€šè¿‡å•å‘å“ˆå¸Œå‡½æ•°æ´¾ç”Ÿå­å¯†é’¥çš„æ—¶å€™ï¼Œå› ä¸ºå³æƒ³è¦éšæœºï¼Œåˆå¸Œæœ›åŒä¸€ä¸ªçˆ¶ç§˜é’¥æ¯æ¬¡ç”Ÿæˆçš„å­å¯†é’¥éƒ½ç›¸åŒï¼Œäºæ˜¯ï¼Œå¼•å…¥äº†<strong>é“¾ç </strong>æ¥ä¿è¯ç¡®å®šæ€§ï¼Œä½¿å¾—æ¯æ¬¡ç”Ÿæˆå­å¯†é’¥éƒ½æ˜¯ç”± <strong>çˆ¶ç§˜é’¥ + çˆ¶é“¾ç  + ç´¢å¼•å·</strong> ä¸‰ä¸ªä¸€èµ·æ´¾ç”Ÿ<strong>å­å¯†é’¥</strong></p></li><li><p><strong>é’±åŒ…</strong>ï¼šé’±åŒ…å°±å¯¹åº”å¯†é’¥ï¼ˆç§é’¥+å…¬é’¥ï¼‰</p></li></ul><p>é‡ç‚¹ï¼šHD Wallet çš„æ‰€æœ‰è´¦æˆ·éƒ½æ˜¯ç”± <strong>ç§˜é’¥ã€é“¾ç ã€ç´¢å¼•å·ï¼ˆ32ä½ï¼‰</strong>ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆçš„</p><p>æ‰€ä»¥å½“æ´¾ç”Ÿå­å¯†é’¥çš„æ—¶å€™ï¼Œåªæœ‰å•ç‹¬çš„ç§é’¥è¿˜æ˜¯ä¸è¡Œçš„ï¼Œå¿…é¡»æ˜¯<strong>ç§é’¥åŠ ä¸Šé“¾ç </strong>ä¸€èµ·æ‰èƒ½<strong>æ´¾ç”Ÿ</strong>å¯¹åº”ç´¢å¼•çš„å­ç§é’¥ï¼Œå› æ­¤ç§é’¥å’Œé“¾ç æ”¾åœ¨ä¸€èµ·ä¹Ÿå«åš<strong>æ‰©å±•ç§é’¥</strong>ï¼Œä¸ºå•¥ï¼Ÿå› ä¸ºæ˜¯å¯æ‹“å±•çš„ï¼ŒåŒæ ·çš„ï¼Œå…¬é’¥å’Œé“¾ç æ”¾ä¸€èµ·å«åš<strong>æ‰©å±•å…¬é’¥</strong>ï¼Œæ¥ä¸‹é‡Œçœ‹ä¸‹ä¸»è´¦æˆ·<strong>æ‹“å±•ç§é’¥masterKey</strong>æ¥æ´¾ç”Ÿå­è´¦æˆ·ï¼ˆæ³¨æ„å“¦ï¼Œä¸»ç§é’¥+é“¾ç &#x3D;æ‹“å±•ç§é’¥ï¼‰</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// ç”±ä¸»è´¦æˆ·ç§é’¥ç”Ÿæˆå­è´¦æˆ·ç§é’¥</span><br><span class="hljs-comment">// @å‚æ•° ç´¢å¼•å·</span><br>childKey1, _ := masterKey.NewChildKey(<span class="hljs-number">1</span>)<br>fmt.Println(<span class="hljs-string">&quot;childKey1:&quot;</span>, childKey1)<br><br><span class="hljs-comment">// æ´¾ç”Ÿç¬¬äºŒä¸ªå­è´¦æˆ·</span><br>childKey2, _ := masterKey.NewChildKey(<span class="hljs-number">2</span>)<br>fmt.Println(<span class="hljs-string">&quot;childKey2:&quot;</span>, childKey2)<br><span class="hljs-comment">// è¾“å‡ºç»“æœ,å¯ä»¥çœ‹åˆ°å¼€å¤´æ˜¯xprvå¼€å¤´çš„ï¼Œ</span><br><span class="hljs-comment">//childKey1: xprv9vmc7bbX7qbvBfGPKLctPka9JcchdCkwh9NrxPdVjZfGjLyM3RHGsTWwyrXGr86ADJDanyrMKLhJNbuua5fC5tv7XPVF4zBDoQiNYN69rFP</span><br><span class="hljs-comment">// childKey2: xprv9vmc7bbX7qbvEwJfuMa9S1K9F1iuMTeaAaYcbg7NLVGViM6VTbyPecWXiMG37QgKrS4Myz9d9N5QjTmbTgAjFZzsdwGaWuhnBMewz2mFCKd</span><br><br></code></pre></td></tr></table></figure><p>è¿™é‡Œçœ‹ä¸€ä¸‹NewChildKeyæ–¹æ³•å†…éƒ¨é€»è¾‘</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// NewChildKey derives a child key from a given parent as outlined by bip32</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(key *Key)</span></span> NewChildKey(childIdx <span class="hljs-type">uint32</span>) (*Key, <span class="hljs-type">error</span>) &#123;<br><span class="hljs-comment">// Fail early if trying to create hardned child from public key</span><br><span class="hljs-keyword">if</span> !key.IsPrivate &amp;&amp; childIdx &gt;= FirstHardenedChild &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, ErrHardnedChildPublicKey<br>&#125;<br><br>intermediary, err := key.getIntermediary(childIdx) <span class="hljs-comment">// è¿™ä¸ªæ–¹æ³•å†…éƒ¨é€šè¿‡ `çˆ¶å¯†é’¥`+`çˆ¶é“¾ç `+`ç´¢å¼•å·`æ´¾ç”Ÿäº†å­å¯†é’¥</span><br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err<br>&#125;<br><br><span class="hljs-comment">// Create child Key with data common to all both scenarios</span><br>childKey := &amp;Key&#123;<br>ChildNumber: uint32Bytes(childIdx),<br>ChainCode:   intermediary[<span class="hljs-number">32</span>:], <span class="hljs-comment">// ç´¢å¼•å·ï¼Œintermediaryæ•°ç»„å³è¾¹çš„32ä½</span><br>Depth:       key.Depth + <span class="hljs-number">1</span>, <span class="hljs-comment">// è¿™é‡Œå°±æ˜¯é“¾ç </span><br>IsPrivate:   key.IsPrivate,<br>&#125;<br>    ........<br>    childKey.Key = addPrivateKeys(intermediary[:<span class="hljs-number">32</span>], key.Key) <span class="hljs-comment">// å­å¯†é’¥ï¼Œintermediaryæ•°ç»„çš„å·¦è¾¹32ä½</span><br><br><br><span class="hljs-keyword">return</span> childKey, <span class="hljs-literal">nil</span> <span class="hljs-comment">//  è¿”å›å‡ºå»</span><br></code></pre></td></tr></table></figure><p>ä»£ç æ€»ç»“ï¼šæ´¾ç”Ÿå‡ºçš„å­—èŠ‚æ•°ç»„ å·¦è¾¹32å­—èŠ‚æ˜¯ç§˜é’¥ï¼Œå³è¾¹32å­—èŠ‚å°±æ˜¯é“¾ç </p><p>é™¤äº†é€šè¿‡æ‹“å±•ç§é’¥æ´¾ç”Ÿå‡ºå­ç§é’¥ï¼Œè¿˜å¯ä»¥é€šè¿‡æ‹“å±•å…¬é’¥æ´¾ç”Ÿå‡ºå­å…¬é’¥ã€‚ä¸è¿‡éœ€è¦æ³¨æ„çš„æ˜¯ï¼š<strong>å…¬é’¥åªèƒ½æ´¾ç”Ÿå‡ºå­å…¬é’¥ï¼Œæ— æ³•æ´¾ç”Ÿå‡ºå­ç§é’¥</strong>ã€‚ä¸‹é¢éªŒè¯ä¸€ä¸‹</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// ç”¨ä¸»è´¦æˆ·å…¬é’¥ æ´¾ç”Ÿ å­è´¦æˆ·å…¬é’¥ï¼ˆæ²¡æœ‰ç§é’¥ï¼‰</span><br>publicKey := masterKey.PublicKey() <span class="hljs-comment">// è¿™é‡Œæ˜¯æ‹¿åˆ°ä¸»è´¦æˆ·å…¬é’¥ï¼Œå¾…ä¼šä¸‹é¢ä¼šæ´¾ç”Ÿ</span><br>fmt.Println(<span class="hljs-string">&quot;publicKey:&quot;</span>, publicKey)<br><br>PubKeyToChild, _ := publicKey.NewChildKey(<span class="hljs-number">1</span>) <span class="hljs-comment">// é€šè¿‡ä¸»è´¦æˆ·å…¬é’¥æ´¾ç”Ÿå‡ºå­è´¦æˆ·å…¬é’¥</span><br>fmt.Println(<span class="hljs-string">&quot;PubKeyToChild:&quot;</span>, PubKeyToChild)<br><span class="hljs-comment">// è¾“å‡º</span><br><span class="hljs-comment">// publicKey: xpub661MyMwAqRbcEkC8JkXwGBm4jX1FmphgcYjyhnKXbW4QKA1DAX5V1Hp6SoCKev4Gim8AqSYzM7ZCttjsHb7SNSH4ufkgsWGVupS73DLxr7Z</span><br><span class="hljs-comment">// PubKeyToChild: xpub68shoUguHPvUVptKbW1BrWa1eAvX5rVKUEQ8S9e3fPVvr5EVhXkVBbNvKJBFR1TqFrmqRERkELB6tixWjc8VouZz3HZRCq2YZBnoLsEfkdx</span><br><br><span class="hljs-comment">// ç”¨ä¸»è´¦æˆ·ç§é’¥ï¼Œæ´¾ç”Ÿå‡ºå­è´¦æˆ·ç§é’¥ï¼Œå†ç”Ÿäº§å­è´¦æˆ·å…¬é’¥ï¼Œç„¶ååˆ¤æ–­ä¸€ä¸‹æ˜¯å¦ä¸€è‡´</span><br>childKey1, _ := masterKey.NewChildKey(<span class="hljs-number">1</span>) <span class="hljs-comment">// æ´¾ç”Ÿå­è´¦æˆ·1</span><br>publicKey1 := childKey1.PublicKey() <span class="hljs-comment">// ä»å­è´¦æˆ·1çš„ç§˜é’¥æ¢å¤å‡ºå…¬é’¥æ¥ï¼Œ</span><br>fmt.Println(<span class="hljs-string">&quot;publicKey3:&quot;</span>, publicKey1) <span class="hljs-comment">// æ‰“å°ä¸‹è¿™ä¸ªå­è´¦æˆ·1å…¬é’¥</span><br>fmt.Println(bytes.Equal(PubKeyToChild.Key, publicKey1.Key)) <span class="hljs-comment">// è¿”å›çš„tureï¼Œå’Œç­¾åæˆ‘ä»¬ç”Ÿæˆçš„æ˜¯ä¸€æ ·çš„</span><br><span class="hljs-comment">// publicKey3: xpub68shoUguHPvUVptKbW1BrWa1eAvX5rVKUEQ8S9e3fPVvr5EVhXkVBbNvKJBFR1TqFrmqRERkELB6tixWjc8VouZz3HZRCq2YZBnoLsEfkdx</span><br><br></code></pre></td></tr></table></figure><p>é¦–å…ˆå†é‡å¤ä¸€ä¸‹ï¼Œè¦æ˜ç¡®çš„æ˜¯ï¼Œå…¬é’¥åªèƒ½æ´¾ç”Ÿå­å…¬é’¥ï¼Œæ— æ³•æ´¾ç”Ÿå‡ºå­ç§é’¥ï¼Œä½†æ˜¯ç§é’¥ç¡®å¯ä»¥æ¨å‡ºå…¬é’¥</p><p>å°±ä¼šæœ‰<strong>2ç§æ´¾ç”Ÿæ–¹å¼</strong>ï¼š</p><ul><li>1ã€æ‹“å±•å…¬é’¥ï¼ˆå…¬é’¥+é“¾ç ï¼‰çˆ¶å…¬é’¥&#x3D;&#x3D;&gt; å­å…¬é’¥ï¼Œå­ç§é’¥å¦å¤–ç”±çˆ¶ç§é’¥æ´¾ç”Ÿï¼Œä¸å½’å…¬é’¥ç®¡</li><li>2ã€æ‹“å±•ç§é’¥ï¼ˆç§é’¥+é“¾ç ï¼‰çˆ¶ç§é’¥&#x3D;&#x3D;&#x3D;&gt;å­ç§é’¥ &#x3D;&#x3D;&#x3D;&gt; å­å…¬é’¥</li></ul><p>ç¬¬ä¸€ç§æ–¹å¼å¥½å¤„å°±æ˜¯ï¼šå¯ä»¥ç”¨çˆ¶å…¬é’¥æš´éœ²åœ¨å¤–é¢ï¼Œç„¶åå¯ä»¥æ´¾ç”Ÿå‡ºnå¤šä¸ªå­å…¬é’¥ç”¨äºæ¥æ”¶èµ„äº§ï¼Œå› ä¸ºæ²¡æœ‰ç§é’¥ï¼Œæ‰€ä»¥åªèƒ½æ¥æ”¶ï¼Œä¸èƒ½èŠ±è´¹ï¼ˆç­¾åï¼‰æ‰€ä»¥å¾ˆå®‰å…¨ï¼Œä¸æ­¤åŒæ—¶ï¼Œåœ¨å¦ä¸€ä¸ªåœ°æ–¹ç”¨å­ç§é’¥æ¥æ§åˆ¶èµ„äº§ï¼ˆç­¾åï¼‰ï¼Œè¿™æ ·å°±åšåˆ°äº†<strong>å­å…¬é’¥å’Œå­ç§é’¥çš„è§£è€¦</strong>ï¼Œ</p><p>ä½†æ˜¯è¿™æ ·çš„æ´¾ç”Ÿæ–¹å¼æœ‰å¾ˆå¤§çš„å±é™©ï¼Œå°±æ˜¯å¦‚æœæœ‰äººæ‹¿åˆ°äº†è¿™ä¸ªå­ç§é’¥ï¼Œé‚£ä¹ˆåˆ™å¯ä»¥é€šè¿‡å­ç§é’¥+çˆ¶é“¾ç æ¥æ¨å¯¼å‡ºçˆ¶ç§é’¥ï¼Œçˆ¶ç§é’¥æ‹¿åˆ°äº†å°±å¯ä»¥åŠ ä¸Šå…¶ä»–çš„é“¾ç æ¥æ¨å¯¼å…¶ä»–å§Šå¦¹è´¦æˆ·ï¼Œäºæ˜¯å°±å‡ºç°äº†<strong>å¼ºåŒ–æ´¾ç”Ÿï¼ˆHardened derivationï¼‰</strong>å¼ºåŒ–æ´¾ç”Ÿé™åˆ¶äº†çˆ¶å…¬é’¥æ´¾ç”Ÿå‡ºå­å…¬é’¥çš„èƒ½åŠ›ï¼Œåªèƒ½ä½¿ç”¨ç¬¬äºŒç§æ´¾ç”Ÿä¹Ÿå°±æ˜¯ <strong>çˆ¶ç§é’¥&#x3D;&#x3D;&#x3D;&gt;å­ç§é’¥&#x3D;&#x3D;&#x3D;&gt;å­å…¬é’¥</strong></p><blockquote><p>HD Wallet æœ‰è§„å®šï¼š</p><p>ç´¢å¼•å·åœ¨0åˆ°2^32-1(0x0 to 0x7FFFFFFF)ä¹‹é—´åªç”¨äºå¸¸è§„æ´¾ç”Ÿ</p><p>ç´¢å¼•å·åœ¨2^31åˆ°2^32-1(0x80000000 to 0xFFFFFFFF)ä¹‹é—´åªç”¨äºå¼ºåŒ–æ´¾ç”Ÿ</p></blockquote><p>PSï¼š<strong>åœ¨è¡¨ç¤ºä¸­ï¼Œå¼ºåŒ–æ´¾ç”Ÿå¯†é’¥å³ä¸Šè§’æœ‰ä¸€ä¸ªå°æ’‡å·ï¼Œå¦‚ï¼šç´¢å¼•å·ä¸º 0x80000000 å°±è¡¨ç¤ºä¸º 0â€™</strong></p><p>æ¥ä¸‹æ¥å›å¤´å»çœ‹ä¸‹ä¸Šé¢çš„æ´¾ç”Ÿå­å¯†é’¥çš„æºç ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢çš„NewchildKeyæ–¹æ³•ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªåˆ¤æ–­ï¼Œå°±æ˜¯åˆ¤æ–­ä½ çš„å…¥å‚childIdx æ˜¯åœ¨å“ªä¸ªç´¢å¼•èŒƒå›´ï¼Œå¦‚æœæ˜¯åœ¨å¼ºåŒ–æ´¾ç”Ÿçš„ç´¢å¼•èŒƒå›´ï¼Œå°±æ˜¯å¼ºåŒ–æ´¾ç”Ÿï¼Œå°±ä¸å…è®¸å…¬é’¥æ´¾ç”Ÿ</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(key *Key)</span></span> NewChildKey(childIdx <span class="hljs-type">uint32</span>) (*Key, <span class="hljs-type">error</span>) &#123;<br>    <span class="hljs-comment">// Fail early if trying to create hardned child from public key</span><br>    <span class="hljs-comment">// è¿™é‡Œå°±å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœè¿™ä¸ªchildIdx &gt;= FirstHardenedChild å°±ä¼šè¿”å›ç©ºä¸”æŠ›å‡ºé”™è¯¯</span><br>    <span class="hljs-keyword">if</span> !key.IsPrivate &amp;&amp; childIdx &gt;= FirstHardenedChild &#123;<br>       <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, ErrHardnedChildPublicKey<br>    &#125;<br>    .....<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±æ˜¯ç”±å…¬é’¥å»ç”Ÿæˆåœ°å€äº†ï¼Œè¿™é‡Œå°±æ˜¯ç­¾åæåˆ°çš„å‹ç¼©çš„è¿‡ç¨‹ï¼Œè¿™ä¸ªç®€å•ä¸éœ€è¦é¢å¤–ç†è§£ï¼Œ</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// ç”±å…¬é’¥æ¨å‡ºåœ°å€ï¼ˆè§£å‹ç¼©çš„è¿‡ç¨‹ï¼Œå°±æ˜¯è½¬åŒ–ç„¶åå»å¤´å»å°¾çš„ï¼‰</span><br><span class="hljs-comment">// å…ˆè§£å‹ç¼©å…¬é’¥ï¼Œå†å»æ¨åœ°å€</span><br>pubKey1, _ := crypto.DecompressPubkey(PubKeyToChild.Key)<br><span class="hljs-comment">// ç”Ÿæˆå­è´¦æˆ·åœ°å€</span><br>addre1 := crypto.PubkeyToAddress(*pubKey1)<br>fmt.Println(<span class="hljs-string">&quot;addre1:&quot;</span>, addre1)<br></code></pre></td></tr></table></figure><p><strong>ä½†æ˜¯ï¼ä½†æ˜¯ï¼ä½†æ˜¯ï¼</strong> ä½ ç°åœ¨èµ°åˆ°è¿™ä¸€æ­¥ï¼Œè¿˜æ˜¯ä¸å¯ä»¥å¯¼å…¥åˆ°metaMaské’±åŒ…é‡Œé¢çš„ã€‚éœ€è¦ç»§ç»­å¾€ä¸‹èµ°</p><h4 id="åˆ†å±‚ç¡®å®šæ€§é’±åŒ…ï¼ˆHD-Walletï¼‰çš„æ ‡å‡†è·¯å¾„"><a href="#åˆ†å±‚ç¡®å®šæ€§é’±åŒ…ï¼ˆHD-Walletï¼‰çš„æ ‡å‡†è·¯å¾„" class="headerlink" title="åˆ†å±‚ç¡®å®šæ€§é’±åŒ…ï¼ˆHD Walletï¼‰çš„æ ‡å‡†è·¯å¾„"></a>åˆ†å±‚ç¡®å®šæ€§é’±åŒ…ï¼ˆHD Walletï¼‰çš„æ ‡å‡†è·¯å¾„</h4><p>è¿˜è®°å¾—æœ¬æ–‡å¼€å¤´æå‡ºçš„é‚£ä¸ªé—®é¢˜å—ï¼Ÿ</p><p>pathçš„<code>&quot;m/44&#39;/60&#39;/0&#39;/0&quot;</code> éƒ½æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿç°åœ¨ä½ çŸ¥é“äº†ï¼Œå³ä¸Šè§’çš„å°æ’‡å·ä»£è¡¨å¼ºåŒ–æ´¾ç”Ÿï¼Œç°åœ¨æ¥çœ‹å…¶ä»–éƒ¨åˆ†ã€‚</p><p>BIP-44 ç¡®å®šäº† HD é’±åŒ…çš„æ ‡å‡†è·¯å¾„ã€‚ç”±äº HD é’±åŒ…çš„æ ‘çŠ¶ç»“æ„ï¼Œæ¯ä¸€å±‚æœ‰ 40 äº¿ä¸ªå­å¯†é’¥ï¼ˆ20 äº¿ä¸ªå¸¸è§„å­å¯†é’¥å’Œ 20 äº¿ä¸ªå¼ºåŒ–å­å¯†é’¥ï¼‰ï¼Œå±‚æ•°å¯ä»¥æ— é™æ‰©å±•ï¼Œæ²¡æœ‰å°½å¤´ã€‚</p><p>å¯¼è‡´é’±åŒ…é‡Œè´¦æˆ·çš„è·¯å¾„å¯èƒ½æ€§æ˜¯æ— ç©·çš„ï¼Œå‡è®¾ä½ æƒ³ä» metamask æ›´æ¢åˆ°å¦ä¸€ä¸ªä¸åŒçš„é’±åŒ…åº”ç”¨ï¼Œå°±ä¼šå­˜åœ¨å…¼å®¹æ€§é—®é¢˜ã€‚</p><p>äºæ˜¯ä¹ï¼Œ<strong>BIP-44</strong> å®šä¹‰äº†æ ‡å‡†ï¼Œåªè¦éµå¾ªäº†è¿™ä¸ªæ ‡å‡†çš„é’±åŒ…ä¹‹é—´éƒ½æ˜¯å…¼å®¹çš„ã€‚å¥½æ¶ˆæ¯æ˜¯ï¼ŒåŒ…æ‹¬ metamask åœ¨å†…çš„è®¸å¤šé’±åŒ…ï¼Œéƒ½éµå¾ªäº†è¿™ä¸ªæ ‡å‡†ï¼Œç¬¬ä¸‰ä¸ªBIPæ¥äº†ï¼Œç­¾ååŠ©è®°è¯æ˜¯BIP39ï¼Œç§å­æ˜¯BIP32</p><p>BIP-44 æ ‡å‡†çš„é’±åŒ…è·¯å¾„ï¼ˆpathï¼‰å‚æ•°ï¼šm &#x2F; purposeâ€™ &#x2F; coin_typeâ€™ &#x2F;accountâ€™ change &#x2F; address_index</p><ul><li>m ï¼šæ ‡è®°å­è´¦æˆ·éƒ½æ˜¯ä¸»ç§é’¥æ´¾ç”Ÿè€Œæ¥çš„ã€‚</li><li>purposeâ€™ ï¼šæ ‡è®°æ˜¯ BIP-44, å›ºå®šå€¼æ˜¯ 44â€™</li><li>coin_typeâ€™ ï¼šæ ‡è®°è´¦æˆ·ç±»å‹ï¼Œä» 0â€™ å¼€å§‹ï¼Œç”¨äºç»™è´¦æˆ·åˆ†ç±»&#x3D;&#x3D;&#x3D;&gt; <a href="https://github.com/satoshilabs/slips/blob/master/slip-0044.md">å®Œæ•´çš„å¸ç§ç±»å‹</a></li><li>change  ï¼š0 å¤–éƒ¨å¯è§åœ°å€ï¼Œ1 æ‰¾é›¶åœ°å€ï¼ˆå¤–éƒ¨ä¸å¯è§ï¼‰ï¼Œé€šå¸¸é»˜è®¤0</li><li>address_index ï¼šåœ°å€ç´¢å¼•</li></ul><p><strong>æ³¨æ„ï¼šä¸ºäº†ä¿æŠ¤ä¸»ç§é’¥å®‰å…¨ï¼Œæ‰€æœ‰ä¸»ç§é’¥æ´¾ç”Ÿçš„ç¬¬ä¸€çº§è´¦æˆ·ï¼Œéƒ½é‡‡ç”¨å¼ºåŒ–æ´¾ç”Ÿã€‚</strong> </p><p>ä½†æ˜¯ï¼Œä½ å¯ä»¥ä½¿ç”¨<code>m/0</code>ï¼Œ<code>m/1&#39;/0</code>ï¼Œ<code>m/0&#39;/1/2/3</code>è¿™ç§ä»»ä½•è·¯å¾„ä½ éƒ½å¯ä»¥éšä¾¿è¾“å…¥ï¼Œæ´¾ç”Ÿå‡ºæ¥çš„éƒ½æ˜¯æ­£ç¡®çš„è´¦æˆ·ï¼Œåªæ˜¯è¿™äº›ä¸ç¬¦åˆæ ‡å‡†çš„é’±åŒ…ä¸ä¸€å®šèƒ½å…¼å®¹çš„äº†è¿™äº›é“¾ï¼Œä¸”å®‰å…¨æ€§ä¸å¯çŸ¥ï¼Œæ‰€ä»¥ç»Ÿä¸€å‡†ä¿¡è¡Œä¸šæ ‡å‡†ï¼ˆBIP-44ï¼‰</p><h3 id="å®ç°ä¸€ä¸ªä»¥å¤ªåŠçš„é’±åŒ…ï¼ˆä¸€ä¸ªç¬¦åˆBIP-44æ ‡å‡†çš„è·¯å¾„pathï¼‰"><a href="#å®ç°ä¸€ä¸ªä»¥å¤ªåŠçš„é’±åŒ…ï¼ˆä¸€ä¸ªç¬¦åˆBIP-44æ ‡å‡†çš„è·¯å¾„pathï¼‰" class="headerlink" title="å®ç°ä¸€ä¸ªä»¥å¤ªåŠçš„é’±åŒ…ï¼ˆä¸€ä¸ªç¬¦åˆBIP-44æ ‡å‡†çš„è·¯å¾„pathï¼‰"></a>å®ç°ä¸€ä¸ªä»¥å¤ªåŠçš„é’±åŒ…ï¼ˆä¸€ä¸ªç¬¦åˆBIP-44æ ‡å‡†çš„è·¯å¾„pathï¼‰</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// æ‰€ä»¥è¿™ä¸ªmasterKey çš„æ¥æºè¿˜è¦å†å†™ä¸€é</span><br>åŠ©è®°è¯==&gt;ç§å­==&gt; ä¸»ç§é’¥masterKey<br><span class="hljs-comment">// è¿™é‡Œçš„masterKeyæ˜¯ä»€ä¹ˆï¼Ÿæ˜¯ä¸»ç§é’¥ï¼Œç„¶åä¸»ç§é’¥ç»è¿‡å„ç§æ´¾ç”Ÿä¹‹åï¼Œç”Ÿæˆçš„å­ç§é’¥</span><br><span class="hljs-comment">// ä»¥å¤ªåŠçš„å¸ç§ç±»å‹æ˜¯60</span><br><span class="hljs-comment">// FirstHardenedChild = uint32(0x80000000) æ˜¯ä¸€ä¸ªå¸¸é‡</span><br><span class="hljs-comment">// ä»¥è·¯å¾„ï¼ˆpath: &quot;m/44&#x27;/60&#x27;/0&#x27;/0/0&quot;ï¼‰ä¸ºä¾‹</span><br>key, _ := masterKey.NewChildKey(bip32.FirstHardenedChild + <span class="hljs-number">44</span>)  <span class="hljs-comment">// è¿™ä¸€æ­¥æ˜¯åœ¨åšå¼ºåŒ–æ´¾ç”Ÿï¼Œ å¯¹åº” purpose&#x27; 44æ˜¯ç¬¦åˆBIP-44æ ‡å‡†</span><br>key, _ = key.NewChildKey(bip32.FirstHardenedChild + <span class="hljs-type">uint32</span>(<span class="hljs-number">60</span>)) <span class="hljs-comment">// è¿˜æ˜¯å¼ºåŒ–æ´¾ç”Ÿï¼Œå¯¹åº” coin_typeç±»å‹60&#x27;</span><br>key, _ = key.NewChildKey(bip32.FirstHardenedChild + <span class="hljs-type">uint32</span>(<span class="hljs-number">0</span>))  <span class="hljs-comment">// è¿˜æ˜¯å¼ºåŒ–æ´¾ç”Ÿï¼Œå¯¹åº”account</span><br>key, _ = key.NewChildKey(<span class="hljs-type">uint32</span>(<span class="hljs-number">0</span>))                             <span class="hljs-comment">// å¸¸è§„æ´¾ç”Ÿï¼Œå¯¹åº” change</span><br>key, _ = key.NewChildKey(<span class="hljs-type">uint32</span>(<span class="hljs-number">0</span>))                             <span class="hljs-comment">// å¸¸è§„æ´¾ç”Ÿï¼Œå¯¹åº”çš„ address_index</span><br><br><span class="hljs-comment">// pathå·²ç»å®Œæ¯•ï¼Œç”Ÿæˆåœ°å€</span><br>ethPublicKey, _ := crypto.DecompressPubkey(key.PublicKey().Key)<br>fmt.Println(<span class="hljs-string">&quot;ethPublicKey:&quot;</span>, ethPublicKey)<br>ethAddre := crypto.PubkeyToAddress(*ethPublicKey).Hex()<br>fmt.Println(<span class="hljs-string">&quot;ethAddre:&quot;</span>, ethAddre)<br><span class="hljs-comment">// å°è¯•æ‰“å°ä¸€ä¸‹è¿™ä¸ªkeyçš„ç§é’¥ç®—</span><br>fmt.Println(<span class="hljs-string">&quot;key:&quot;</span>, key.Key)                 <span class="hljs-comment">// è¿™ä¸ªæ—¶å€™ä½ ç›´æ¥æ‰“å°Keyæ˜¯åè¿›åˆ¶çš„å­—èŠ‚åˆ‡ç‰‡</span><br>privateKeyHex := hex.EncodeToString(key.Key) <span class="hljs-comment">// è¿™é‡Œåœ¨åšçš„å°±æ˜¯è½¬åŒ–æˆ16è¿›åˆ¶çš„å­—ç¬¦ï¼Œ</span><br>fmt.Println(<span class="hljs-string">&quot;key:&quot;</span>, privateKeyHex)<br></code></pre></td></tr></table></figure><p>æ‰€ä»¥è¿™é‡Œæ€»ç»“ä¸€ä¸‹ï¼ŒåŠ©è®°è¯â€“ç§é’¥â€“å…¬é’¥â€“åœ°å€ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­åšäº†ä»€ä¹ˆï¼Ÿ</p><p><img src="/img/web3/privatekeyprocess.png" alt="privatekeyprocess"></p>]]></content>
    
    
    <categories>
      
      <category>blockChain</category>
      
    </categories>
    
    
    <tags>
      
      <tag>block</tag>
      
      <tag>å®æˆ˜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>03 å¯†ç å­¦</title>
    <link href="/2024/05/23/03%E5%AF%86%E7%A0%81%E5%AD%A6/"/>
    <url>/2024/05/23/03%E5%AF%86%E7%A0%81%E5%AD%A6/</url>
    
    <content type="html"><![CDATA[<h1 id="1-å…¬é’¥å¯†ç å­¦ç†è®º"><a href="#1-å…¬é’¥å¯†ç å­¦ç†è®º" class="headerlink" title="1 å…¬é’¥å¯†ç å­¦ç†è®º"></a>1 å…¬é’¥å¯†ç å­¦ç†è®º</h1><blockquote><p>ä¸¤ç§åŠ å¯†æ–¹å¼ï¼šå¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†</p></blockquote><h2 id="1-1-å¯¹ç§°åŠ å¯†"><a href="#1-1-å¯¹ç§°åŠ å¯†" class="headerlink" title="1.1 å¯¹ç§°åŠ å¯†"></a>1.1 å¯¹ç§°åŠ å¯†</h2><p>åŒºåˆ«ï¼šä¸»è¦åŒºåˆ«å°±æ˜¯å¯†é’¥å¯¹çš„åŒºåˆ«</p><p>å¯¹ç§°åŠ å¯†ï¼ˆå•ç§˜é’¥åŠ å¯†ï¼‰ï¼Œ<strong>åŠ è§£å¯†éƒ½æ˜¯åªæœ‰ä¸€æŠŠkey</strong> ï¼Œä½¿ç”¨ç›¸åŒçš„ç§˜é’¥è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ç‚’ä½œ</p><p>å‘é€æ–¹ä½¿ç”¨å¯†é’¥å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œæ¥æ”¶æ–¹ä½¿ç”¨ç›¸åŒçš„å¯†é’¥å¯¹å¯†æ–‡è¿›è¡Œè§£å¯†ï¼Œä»è€Œè¿˜åŸå‡ºåŸå§‹çš„æ˜æ–‡æ•°æ®ã€‚</p><p>æ¯”è¾ƒæœ‰åçš„æ˜¯ DES 3DES AES TDEA blowful rc245</p><p>å¯¹ç§°åŠ å¯†çš„ç‰¹ç‚¹åŒ…æ‹¬ï¼š</p><ol><li><strong>é€Ÿåº¦å’Œæ•ˆç‡</strong>: å¯¹ç§°åŠ å¯†ä½¿ç”¨ç›¸åŒçš„å¯†é’¥è¿›è¡ŒåŠ å¯†å’Œè§£å¯†ï¼Œå› æ­¤åŠ å¯†å’Œè§£å¯†çš„è¿‡ç¨‹éå¸¸å¿«é€Ÿå’Œé«˜æ•ˆã€‚</li><li><strong>ç®€å•æ€§</strong>: å¯¹ç§°åŠ å¯†ç®—æ³•ç›¸å¯¹ç®€å•ï¼Œå®ç°èµ·æ¥è¾ƒä¸ºå®¹æ˜“ã€‚</li><li><strong>é€‚ç”¨äºå¤§æ•°æ®é‡</strong>: å¯¹ç§°åŠ å¯†é€‚ç”¨äºå¤§æ•°æ®é‡çš„åŠ å¯†å’Œè§£å¯†ï¼Œå› ä¸ºå®ƒçš„å¤„ç†é€Ÿåº¦è¾ƒå¿«ã€‚</li><li><strong>å¯†é’¥ç®¡ç†</strong>: å¯¹ç§°åŠ å¯†éœ€è¦ç¡®ä¿å¯†é’¥çš„å®‰å…¨æ€§ï¼Œå› ä¸ºä»»ä½•æ‹¥æœ‰å¯†é’¥çš„äººéƒ½å¯ä»¥å¯¹æ•°æ®è¿›è¡Œè§£å¯†ã€‚å› æ­¤ï¼Œå¯¹ç§°åŠ å¯†åœ¨å¯†é’¥çš„ç”Ÿæˆã€åˆ†å‘å’Œç®¡ç†æ–¹é¢éœ€è¦ç‰¹åˆ«æ³¨æ„ã€‚</li><li><strong>å¯†é’¥åˆ†å‘</strong>: å¯†é’¥çš„å®‰å…¨åˆ†å‘æ˜¯å¯¹ç§°åŠ å¯†çš„ä¸€ä¸ªæŒ‘æˆ˜ã€‚å‘é€æ–¹å’Œæ¥æ”¶æ–¹å¿…é¡»äº‹å…ˆå…±äº«å¯†é’¥ï¼Œè¿™è¦æ±‚åœ¨å®‰å…¨å¯é çš„é€šä¿¡æ¸ é“ä¸Šè¿›è¡Œå¯†é’¥äº¤æ¢ã€‚</li></ol><h2 id="1-2-éå¯¹ç§°åŠ å¯†"><a href="#1-2-éå¯¹ç§°åŠ å¯†" class="headerlink" title="1.2 éå¯¹ç§°åŠ å¯†"></a>1.2 éå¯¹ç§°åŠ å¯†</h2><p>éå¯¹ç§°åŠ å¯† ï¼ˆå…¬é’¥å¯†ç å­¦ã€<strong>åŒå¯†ç åŠ å¯†</strong>ã€‚ç°åœ¨çš„åŠ å¯†ä½“ç³»ï¼‰ï¼Œ</p><p>åŒç§˜é’¥æ˜¯å“ªä¸¤ä¸ªï¼Ÿï¼š</p><ul><li><p><strong>privatekey</strong> ï¼šç§æœ‰,è¿›è¡ŒåŠ å¯†ï¼ˆä¿—ç§°ç§é’¥ï¼‰ç§é’¥æ˜¯ç”¨äºè§£å¯†çš„å¯†é’¥ï¼Œå¿…é¡»ä¿å¯†ï¼Œå¹¶ä¸”åªæœ‰å¯†é’¥çš„æŒæœ‰è€…å¯ä»¥ä½¿ç”¨ç§é’¥è¿›è¡Œè§£å¯†ã€‚ç§é’¥ç”¨äºè§£å¯†å…¬é’¥åŠ å¯†çš„æ•°æ®ã€‚</p></li><li><p><strong>publickey</strong>ï¼šå…¬å¼€çš„ï¼Œæ‰€æœ‰äººéƒ½çŸ¥é“ï¼Œè¿›è¡Œè§£å¯†ï¼ˆä¿—ç§°å…¬é’¥ï¼‰å…¬é’¥æ˜¯ç”¨äºåŠ å¯†çš„å¯†é’¥ï¼Œå¯ä»¥å…¬å¼€åˆ†äº«ç»™å…¶ä»–äººã€‚ä»»ä½•äººéƒ½å¯ä»¥ä½¿ç”¨å…¬é’¥å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œä½†æ— æ³•ä½¿ç”¨å…¬é’¥è¿›è¡Œè§£å¯†ã€‚</p></li></ul><p>éå¯¹ç§°åŠ å¯†çš„è¿ä½œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li>å‘é€æ–¹ä½¿ç”¨æ¥æ”¶æ–¹çš„å…¬é’¥å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ã€‚</li><li>åŠ å¯†åçš„æ•°æ®é€šè¿‡ä¸å®‰å…¨çš„é€šä¿¡æ¸ é“å‘é€ç»™æ¥æ”¶æ–¹ã€‚</li><li>æ¥æ”¶æ–¹ä½¿ç”¨è‡ªå·±çš„ç§é’¥å¯¹æ”¶åˆ°çš„å¯†æ–‡è¿›è¡Œè§£å¯†ï¼Œå¾—åˆ°åŸå§‹çš„æ˜æ–‡æ•°æ®ã€‚</li></ul><p>éå¯¹ç§°åŠ å¯†çš„ç‰¹ç‚¹åŒ…æ‹¬ï¼š</p><ol><li><strong>å®‰å…¨æ€§</strong>: éå¯¹ç§°åŠ å¯†æä¾›äº†æ›´é«˜çš„å®‰å…¨æ€§ï¼Œå› ä¸ºå…¬é’¥ç”¨äºåŠ å¯†æ•°æ®ï¼Œè€Œç§é’¥ç”¨äºè§£å¯†æ•°æ®ã€‚å³ä½¿å…¬é’¥è¢«å…¬å¼€è·å–ï¼Œä¹Ÿæ— æ³•è½»æ˜“ç ´è§£å¯†æ–‡ï¼Œå› ä¸ºåªæœ‰ç§é’¥æŒæœ‰è€…æ‰èƒ½è§£å¯†æ•°æ®ã€‚</li><li><strong>å¯†é’¥åˆ†å‘</strong>: éå¯¹ç§°åŠ å¯†è§£å†³äº†å¯†é’¥åˆ†å‘çš„é—®é¢˜ã€‚å‘é€æ–¹åªéœ€è·å–æ¥æ”¶æ–¹çš„å…¬é’¥ï¼Œè€Œæ— éœ€å…±äº«ç§é’¥ã€‚è¿™ä½¿å¾—éå¯¹ç§°åŠ å¯†åœ¨ä¿æŠ¤æ•°æ®ä¼ è¾“çš„åŒæ—¶ï¼Œç®€åŒ–äº†å¯†é’¥ç®¡ç†çš„å¤æ‚æ€§ã€‚</li><li><strong>æ•°å­—ç­¾å</strong>: éå¯¹ç§°åŠ å¯†è¿˜å¯ä»¥ç”¨äºæ•°å­—ç­¾åï¼Œå³ä½¿ç”¨ç§é’¥å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œè¯æ˜æ•°æ®çš„å®Œæ•´æ€§å’Œè®¤è¯å‘é€æ–¹èº«ä»½ã€‚æ¥æ”¶æ–¹å¯ä»¥ä½¿ç”¨å‘é€æ–¹çš„å…¬é’¥è¿›è¡ŒéªŒè¯ã€‚</li><li><strong>è®¡ç®—å¤æ‚æ€§</strong>: ç›¸å¯¹äºå¯¹ç§°åŠ å¯†ï¼Œéå¯¹ç§°åŠ å¯†çš„è®¡ç®—å¤æ‚æ€§è¾ƒé«˜ï¼Œå¤„ç†é€Ÿåº¦è¾ƒæ…¢ã€‚å› æ­¤ï¼Œéå¯¹ç§°åŠ å¯†é€šå¸¸ç”¨äºåŠ å¯†å°æ•°æ®é‡æˆ–è€…è¿›è¡Œå¯†é’¥äº¤æ¢ï¼Œè€Œä¸æ˜¯å¯¹å¤§é‡æ•°æ®è¿›è¡ŒåŠ å¯†</li></ol><p>éå¯¹ç§°åŠ å¯†æ¯”è¾ƒæœ‰åçš„æ˜¯ï¼šRSA  ECCï¼ˆæ¤­åœ†æ›²çº¿ï¼‰GPGï¼ˆç”¨è¿‡ï¼ŒåŠ å¯†æ–‡ä»¶ï¼‰</p><p>ECCåˆ†æ”¯ï¼š</p><ul><li>ECDSA  <strong>ç‰¹åˆ«ç®—æ³•Secp256K1</strong>å•¥çš„</li><li>EDDSA <strong>ç‰¹åˆ«ç®—æ³•Ed25519</strong>å•¥çš„</li></ul><h1 id="2-å¯¹ç§°å¯†ç å­¦ç³»åˆ—"><a href="#2-å¯¹ç§°å¯†ç å­¦ç³»åˆ—" class="headerlink" title="2.å¯¹ç§°å¯†ç å­¦ç³»åˆ—"></a>2.å¯¹ç§°å¯†ç å­¦ç³»åˆ—</h1><h2 id="2-1-DES"><a href="#2-1-DES" class="headerlink" title="2.1. DES"></a>2.1. DES</h2><h3 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h3><ol><li>ç§˜é’¥é•¿åº¦ï¼š<strong>56</strong>ä½</li><li>åˆ†ç»„å¯†ç ï¼šå¤„ç†64ä½çš„åˆ†ç»„æ•°æ®</li><li>åŠ å¯†å’Œè§£å¯†éƒ½éœ€è¦åŒä¸€æŠŠç§é’¥</li><li>16è½®åŠ å¯†åŒ…å«ï¼šæ‹“å±•ã€ç½®æ¢ã€Sç›’æ›¿ä»£ã€å†æ¬¡ç½®æ¢ï¼ˆ16è½®åŠ å¯†æµç¨‹å¯ä»¥äº†è§£ä¸‹ï¼‰</li><li>å®‰å…¨æ€§ï¼šå·²è¢«æ”»ç ´ï¼Œå®é™…é¡¹ç›®ä¸ä¼šç”¨ï¼Œ</li><li>å¤æ‚æ€§å’Œé€Ÿåº¦ã€‚</li><li>3DESæ›¿æ¢ï¼Œç›®å‰è¿˜å®‰å…¨</li></ol><p> å®‰å…¨æ€§ï¼šç‰¹åˆ«ç»å…¸ï¼Œä½†å·²è¢«æ”»ç ´</p><h2 id="2-2-3DES"><a href="#2-2-3DES" class="headerlink" title="2.2. 3DES"></a>2.2. 3DES</h2><p>3DESå°±æ˜¯3é‡DESåŠ å¯†ï¼Œç›®å‰ä¹Ÿä¸ç”¨äº†ï¼Œç°åœ¨ä¸»æµéƒ½æ˜¯<strong>AES</strong>ï¼Œ</p><h3 id="ç‰¹ç‚¹-1"><a href="#ç‰¹ç‚¹-1" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h3><ol><li>ç§˜é’¥é•¿åº¦ï¼š56ä½ï¼Œç”±äºå¼•å…¥äº†å¯¹ç§°ç§˜é’¥çš„3æ¬¡åº”ç”¨ï¼Œæ‰€ä»¥å®é™…ç§˜é’¥é•¿åº¦æ˜¯3ä¸ª56ï¼Œ</li><li>åˆ†ç»„å¯†ç ï¼šå¤„ç†64ä½çš„åˆ†ç»„æ•°æ®</li><li>åŠ å¯†å’Œè§£å¯†éƒ½éœ€è¦åŒä¸€æŠŠç§é’¥</li><li>3ä¸ª16è½®åŠ å¯†åŒ…å«ï¼šæ‹“å±•ã€ç½®æ¢ã€Sç›’æ›¿ä»£ã€å†æ¬¡ç½®æ¢ï¼ˆ16è½®åŠ å¯†æµç¨‹å¯ä»¥äº†è§£ä¸‹ï¼‰</li><li>å®‰å…¨æ€§ï¼šæ¯”DESé«˜çš„å¤šï¼Œç›®å‰æ˜¯å®‰å…¨çš„ã€‚</li><li>å¤æ‚æ€§å’Œé€Ÿåº¦æ€§èƒ½ä¼šæœ‰æŸè€—ã€‚</li></ol><h2 id="2-3-AESï¼š"><a href="#2-3-AESï¼š" class="headerlink" title="2.3.AESï¼š"></a>2.3.AESï¼š</h2><h3 id="ç‰¹ç‚¹-2"><a href="#ç‰¹ç‚¹-2" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h3><ol><li>ç§˜é’¥é•¿åº¦ï¼šæ¯”è¾ƒçµæ´»ï¼Œå¯ä»¥æ˜¯128ä½ 192ä½ 256ä½</li><li>åˆ†ç»„å¯†ç ï¼š128ä½çš„åˆ†ç»„å¯†ç ï¼ˆåˆ†ç»„çš„æ„æ€å°±æ˜¯å¦‚æœæ•°æ®å—å¤ªé•¿äº†ï¼Œå°±åªèƒ½æŒ‰ç…§128ä½å»åˆ†ç»„ï¼Œåˆ†å®Œç»„ä¹‹åå†åŠ å¯†ï¼‰</li><li>åŠ å¯†å’Œè§£å¯†éƒ½éœ€è¦åŒä¸€æŠŠç§é’¥</li><li>åŸºäºç½®æ¢å’Œä»£æ¢ç½‘ç»œï¼Œè½®æ•°å–å†³äºç§˜é’¥é•¿åº¦ï¼šAES-128ä½¿ç”¨10è½®åŠ å¯†ï¼ŒAES-192ä½¿ç”¨12è½®åŠ å¯†ï¼ŒAES-256ä½¿ç”¨14è½®åŠ å¯†ã€‚é€šè¿‡å¢åŠ è½®æ•°ï¼ŒAESæä¾›äº†æ›´é«˜çš„å®‰å…¨çº§åˆ«ï¼Œæ¯ä¸€è½®éƒ½æœ‰åˆå§‹è½®ã€ä¸»è¦è½®ã€æœ€ç»ˆè½®ï¼Œä¸»è¦è½®éƒ½æœ‰å››ä¸ªæ­¥éª¤ï¼šå­—èŠ‚æ›¿ä»£ï¼ˆSubBytesï¼‰ã€è¡Œç§»ä½ï¼ˆShiftRowsï¼‰ã€åˆ—æ··æ·†ï¼ˆMixColumnsï¼‰å’Œè½®å¯†é’¥åŠ ï¼ˆAddRoundKeyï¼‰ï¼Œ</li><li>å®‰å…¨æ€§ï¼šç›®å‰æ˜¯å®‰å…¨çš„ï¼Œæ²¡è¢«ç ´è§£</li><li>åº”ç”¨ï¼šæ–‡ä»¶åŠ å¯†è§£å¯†ï¼Œæ•°æ®åŠ å¯†è§£å¯†ï¼Œ</li></ol><h2 id="2-4-DES-ã€3DESã€AES-å¯¹æ¯”"><a href="#2-4-DES-ã€3DESã€AES-å¯¹æ¯”" class="headerlink" title="2.4. DES ã€3DESã€AES å¯¹æ¯”"></a>2.4. DES ã€3DESã€AES å¯¹æ¯”</h2><h3 id="å…±åŒç‚¹ï¼š"><a href="#å…±åŒç‚¹ï¼š" class="headerlink" title="å…±åŒç‚¹ï¼š"></a>å…±åŒç‚¹ï¼š</h3><ol><li>å•ç§˜é’¥å¯¹ç§°åŠ å¯†</li><li>åˆ†ç»„å¯†ç </li><li>éƒ½æœ‰å¤šè½®</li></ol><h3 id="ä¸åŒç‚¹ï¼š"><a href="#ä¸åŒç‚¹ï¼š" class="headerlink" title="ä¸åŒç‚¹ï¼š"></a>ä¸åŒç‚¹ï¼š</h3><ol><li>DESå·²è¢«ç ´è§£</li><li>3DESæ˜¯DESçš„è¡¥å……ï¼Œå®‰å…¨æ€§æœ‰ä¿éšœï¼Œå®é™…åº”ç”¨å°‘ï¼Œ</li><li>DESï¼ˆ64ä½ï¼‰å’ŒAESï¼ˆ128ã€192ã€256ï¼‰ç§˜é’¥é•¿åº¦ä¸ä¸€æ ·ï¼Œ</li><li>AESå®‰å…¨æ€§å¥½ä¸€ç‚¹ï¼Œç›®å‰æš‚æœªè¢«ç ´è§£ã€‚</li></ol><h3 id="åº”ç”¨åœºæ™¯ï¼š"><a href="#åº”ç”¨åœºæ™¯ï¼š" class="headerlink" title="åº”ç”¨åœºæ™¯ï¼š"></a>åº”ç”¨åœºæ™¯ï¼š</h3><p>æ–‡ä»¶æ•°æ®åŠ å¯†ï¼Œæ— æ³•åšç§˜é’¥ç­¾åï¼Œå› ä¸ºæ˜¯å•ç§˜é’¥çš„</p><h1 id="3-éå¯¹ç§°åŠ å¯†ç³»åˆ—"><a href="#3-éå¯¹ç§°åŠ å¯†ç³»åˆ—" class="headerlink" title="3. éå¯¹ç§°åŠ å¯†ç³»åˆ—"></a>3. éå¯¹ç§°åŠ å¯†ç³»åˆ—</h1><h2 id="3-1-æ ¸å¿ƒï¼š"><a href="#3-1-æ ¸å¿ƒï¼š" class="headerlink" title="3.1 æ ¸å¿ƒï¼š"></a>3.1 æ ¸å¿ƒï¼š</h2><p>å…¬é’¥åŠ å¯†ï¼Œç§é’¥è§£å¯†ã€‚</p><p>ä½ è¦å‘ä¸€æ®µè¯ç»™åˆ«äººï¼Œå°±ç”¨åˆ«äººå…¬å¼€çš„å…¬é’¥è¿›è¡ŒåŠ å¯†ï¼ŒåŠ å¯†ä¹‹åä»»ä½•äººéƒ½è§£ä¸å¼€è¿™ä¸ªç§˜å¯†ï¼Œé™¤éæ‹¿åˆ°äº†ç§é’¥æ‰èƒ½è§£å¼€ç§˜å¯†å¾—åˆ°é‡Œé¢çš„å†…å®¹</p><h2 id="3-2-å¸¸ç”¨ï¼š"><a href="#3-2-å¸¸ç”¨ï¼š" class="headerlink" title="3.2 å¸¸ç”¨ï¼š"></a>3.2 å¸¸ç”¨ï¼š</h2><p>å¸¸ç”¨çš„éå¯¹ç§°åŠ å¯†ç®—å‘æœ‰ RSAã€Elgamalã€èƒŒåŒ…ç®—æ³•ã€Rabinã€D-Hã€ECCï¼ˆæ¤­åœ†æ›²çº¿åŠ å¯†ç®—æ³•ï¼‰ç­‰ã€‚</p><p>ECCåˆ†ï¼š</p><ul><li>EDDSA-&gt;ED25519ï¼Œ<strong>åº”ç”¨</strong>ï¼šECDSA åœ¨ TLS&#x2F;SSLã€SSHã€æ•°å­—ç­¾åç­‰é¢†åŸŸå¹¿æ³›åº”ç”¨ã€‚<ul><li>Ed25519 æ˜¯ä¸€ç§åŸºäº Edwards æ›²çº¿çš„æ•°å­—ç­¾åç®—æ³•ï¼Œå®ƒæä¾›äº†é«˜åº¦çš„å®‰å…¨æ€§å’Œæ€§èƒ½ï¼›Ed25519 ä¹Ÿæ˜¯åŠ å¯†è´§å¸ä¸­ä½¿ç”¨æ¯”è¾ƒå¹¿æ³›çš„ç­¾åç®—æ³•ï¼Œå¦‚æ³¢å¡ç­‰é“¾ã€‚ï¼ˆECCå˜ç§ï¼‰</li></ul></li><li>EdDSA-&gt;secp256k1ï¼Œ<strong>åº”ç”¨</strong>ï¼šEdDSA ç”± Daniel J. Bernstein ç­‰äººæå‡ºï¼Œå¹¶ä¸”è¢«åº”ç”¨äºå¯†ç å­¦åè®®ä¸­ï¼Œå¦‚å¯†ç å­¦è´§å¸ã€åŠ å¯†è´§å¸ç­‰ã€‚ï¼ˆECCå˜ç§ï¼Œè¿™ä¸ªæ˜¯è¢«ç”¨çš„æœ€å¤šï¼‰å…¬é’¥å¾ˆå¤šéƒ½æ˜¯02&#x2F;03&#x2F;04å¼€å¤´çš„<ul><li>Secp256k1 æ˜¯ä¸€ç§æ¤­åœ†æ›²çº¿ï¼Œå¸¸ç”¨äºåŠ å¯†è´§å¸é¢†åŸŸï¼Œå¦‚æ¯”ç‰¹å¸å’Œä»¥å¤ªåŠã€‚</li></ul></li></ul><h2 id="3-3-ECCç®—æ³•ï¼š"><a href="#3-3-ECCç®—æ³•ï¼š" class="headerlink" title="3.3 ECCç®—æ³•ï¼š"></a>3.3 ECCç®—æ³•ï¼š</h2><p>**ECC(Elliptic Curve Cryptography)**ï¼šæ¤­åœ†æ›²çº¿å¯†ç å­¦æ˜¯ä¸€ç±»åŸºäºæ¤­åœ†æ›²çº¿æ•°å­¦é—®é¢˜çš„éå¯¹ç§°åŠ å¯†ç®—æ³•ã€‚ç›¸æ¯”äºä¼ ç»Ÿçš„éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼Œå¦‚RSAï¼ŒECCæä¾›äº†ç›¸åŒå®‰å…¨çº§åˆ«ä¸‹æ›´çŸ­çš„å¯†é’¥é•¿åº¦å’Œæ›´é«˜çš„è®¡ç®—æ•ˆç‡ï¼Œå› æ­¤åœ¨èµ„æºå—é™çš„ç¯å¢ƒä¸­å¾—åˆ°å¹¿æ³›åº”ç”¨ã€‚</p><p>å…¬é’¥ç”¨äºåŠ å¯†</p><p>åŸºäºæ¤­åœ†æ›²çº¿-ç¦»æ•£å¯¹æ•°</p><p>ç§˜é’¥é•¿åº¦æ¯”RSAçŸ­ï¼ŒçŸ­ç§˜é’¥ï¼Œ256ä½çš„ECCå®‰å…¨æ€§ç›¸å½“äº3072ä½çš„RSA</p><p>å®‰å…¨é«˜</p><p>æ•ˆç‡é«˜</p><p>åº”ç”¨åœºæ™¯ï¼šæ•°å­—è´§å¸</p><h2 id="3-4-RSAç‰¹ç‚¹ï¼š"><a href="#3-4-RSAç‰¹ç‚¹ï¼š" class="headerlink" title="3.4 RSAç‰¹ç‚¹ï¼š"></a>3.4 RSAç‰¹ç‚¹ï¼š</h2><p><strong>RSAï¼ˆRivest-Shamir-Adleman</strong>ï¼‰æ˜¯æœ€å¸¸ç”¨çš„éå¯¹ç§°åŠ å¯†ç®—æ³•ä¹‹ä¸€ã€‚å®ƒåŸºäºå¤§æ•°åˆ†è§£çš„å›°éš¾æ€§ï¼Œä½¿ç”¨å…¬é’¥è¿›è¡ŒåŠ å¯†ï¼Œç§é’¥è¿›è¡Œè§£å¯†ã€‚RSAå¹¿æ³›åº”ç”¨äºæ•°æ®åŠ å¯†ã€æ•°å­—ç­¾åå’Œå¯†é’¥äº¤æ¢ç­‰é¢†åŸŸã€‚</p><ol><li>å…¬é’¥ç”¨äºåŠ å¯†</li><li>åŸºäºæ•°å­¦éš¾é¢˜ï¼ˆå› æ•°åˆ†è§£å•¥çš„ï¼‰â€“&gt;å®‰å…¨æ€§å¾ˆé«˜</li><li>ç§˜é’¥é•¿åº¦ï¼š1024ï¼Œ2048ï¼Œ4096ï¼Œç§˜é’¥è¶Šé•¿è¶Šå®‰å…¨</li><li>åŠ å¯†è§£å¯†ï¼šå…¬é’¥æ¨¡å¹‚è¿ç®—ï¼Œç§é’¥è§£å¯†</li><li>RSAå‘é€æ–¹ä½¿ç”¨è‡ªå·±çš„ç§é’¥ç­¾åæ¶ˆæ¯ï¼Œæ¥æ”¶æ–¹ç”¨å…¬é’¥éªŒè¯</li><li>æ€§èƒ½ï¼šæ€§èƒ½æ…¢ï¼Œæ‰€ä»¥ä¸€èˆ¬æ˜¯å¯¹å¾ˆå°æ•°æ®åŠ å¯†ï¼Œ</li></ol><p>åº”ç”¨ï¼šæ•°å­—è¯ä¹¦ã€ç­¾åè®¤è¯ï¼Œç‚¹å‡»é‚®ä»¶åŠ å¯†ï¼Œäº¤æ˜“ç­¾åç”¨åˆ°</p><p>åœºæ™¯æ¯”è¾ƒå¤šçš„æ˜¯æ··åˆåŠ å¯†ï¼Œ</p><p>æ‰€è°“æ··åˆåŠ å¯†å°±æ˜¯ä½¿ç”¨åœ¨å®é™…çš„åº”ç”¨ä¸­æŠŠå¯¹ç§°åŠ å¯†å’Œéå¯¹ç§°åŠ å¯†ç»“åˆèµ·æ¥ä½¿ç”¨ã€‚</p><p>æˆ‘ä»¬éƒ½çŸ¥é“éå¯¹ç§°åŠ å¯†ç®—æ³•æ¯”å¯¹ç§°åŠ å¯†ç®—æ³•æ…¢æ•°åƒå€ï¼Œä½†åœ¨ä¿æŠ¤é€šä¿¡å®‰å…¨æ–¹é¢ï¼Œéå¯¹ç§°åŠ å¯†ç®—æ³•å´å…·æœ‰å¯¹ç§°å¯†ç éš¾ä»¥ä¼åŠçš„ä¼˜åŠ¿ã€‚</p><p>æ‰€ä»¥åœ¨å®é™…çš„åº”ç”¨ä¸­ï¼Œéƒ½æ˜¯å¯¹ç§°åŠ å¯†ä¸éå¯¹ç§°åŠ å¯†æ··åˆä½¿ç”¨ã€‚</p><p>å–å…¶ä¼˜åŠ¿ï¼Œå»å…¶ç³Ÿç²•ï¼Œè¾¾åˆ°å®Œç¾ä½¿ç”¨çš„ä¸€ä¸ªç›®çš„ã€‚</p><p>å¯¹ç§°åŠ å¯†æŠ€æœ¯ï¼š</p><p>ä¸€ä¸€å¯¹åº”ï¼ŒåŠ å¯†å’Œè§£å¯†éƒ½æ˜¯ç”¨ä¸€æŠŠé’¥åŒ™ï¼Œæ‰€ä»¥å‘é€è€…å’Œæ¥æ”¶è€…æ‰‹ä¸Šå¿…é¡»åŒæ—¶æŒæœ‰é’¥åŒ™</p><p>ä¼˜ç‚¹ï¼šè¿™ç§ç®—æ³•æ¯”è¾ƒç®€å•ä¸”è®¡ç®—é‡æ¯”è¾ƒå°ï¼Œå¯¹ç½‘ç»œå¼€æ”¾ã€ä»è€Œèƒ½å¤Ÿæ•ˆç‡é«˜åœ°åŠ å¯†ã€‚é€Ÿåº¦æ›´å¿«</p><p>ç¼ºç‚¹ï¼Œä¸èƒ½ä¿è¯åå•†ç§˜é’¥è¿‡ç¨‹çš„å®‰å…¨æ€§ã€‚äºŒæ˜¯æ¯æ¬¡é€šä¿¡éƒ½ä½¿ç”¨å”¯ä¸€ç§˜é’¥ï¼Œç§˜é’¥è¶Šæ¥è¶Šå¤šä¸å¥½ç®¡ç†ã€‚ä¸‰æ˜¯å¯¹ç§°åŠ å¯†ç®—æ³•åªèƒ½å¯¹æ•°æ®è¿›è¡ŒåŠ è§£å¯†ï¼Œä¿è¯æ•°æ®çš„æœºå¯†æ€§ï¼Œä½†æ— æ³•éªŒè¯é€šè®¯åŒæ–¹çš„çœŸå®èº«ä»½ï¼Œä¸èƒ½ç¡®å®šæ•°æ®çš„å®Œæ•´æ€§ã€‚</p><p>éå¯¹ç§°å¯†é’¥åŠ å¯†æŠ€æœ¯ï¼š</p><p>æœ‰å…¬é’¥ç§é’¥ä¸¤æŠŠé’¥åŒ™ï¼Œå…¬é’¥ï¼ˆå…¬å¸ƒäºä¼—ï¼‰ç”¨äºåŠ å¯†æ•°æ®ï¼Œç§é’¥ï¼ˆç§å¯†æŒæœ‰ï¼‰ç”¨äºè§£å¯†æ•°æ®</p><p>ä¼˜ç‚¹ï¼šæ›´å®‰å…¨ï¼Œå¯ä»¥ä¸€å¯¹å¤šä¸ªæ¥æ”¶æ–¹ï¼Œç®€åŒ–ç§˜é’¥ï¼ˆç§˜é’¥å°‘ï¼‰å‘æ”¾ï¼Œæ”¯æŒæ•°å­—ç­¾åã€‚</p><p>ç¼ºç‚¹ï¼šè®¡ç®—è¿‡ç¨‹ç‰¹åˆ«å¤æ‚ï¼Œè¿è¡Œæ•°æ®çš„åŠ å¯†å’Œè§£å¯†é€Ÿåº¦æ¯”è¾ƒæ…¢</p><h2 id="Schnorrå’ŒBLSç®—æ³•ä»‹ç»"><a href="#Schnorrå’ŒBLSç®—æ³•ä»‹ç»" class="headerlink" title="Schnorrå’ŒBLSç®—æ³•ä»‹ç»"></a>Schnorrå’ŒBLSç®—æ³•ä»‹ç»</h2><p>Schnorr ç­¾åå’Œ BLS ç­¾ååœ¨åŒºå—é“¾æŠ€æœ¯ä¸­éƒ½æœ‰ç€é‡è¦çš„åº”ç”¨ã€‚</p><p>å®ƒä»¬å„è‡ªå…·å¤‡ç‹¬ç‰¹çš„ä¼˜åŠ¿ï¼Œä½¿å…¶åœ¨ä¸åŒçš„åŒºå—é“¾åº”ç”¨åœºæ™¯ä¸­å¾—åˆ°å¹¿æ³›ä½¿ç”¨ã€‚</p><h2 id="3-5-Schnorr-ç­¾åç®—æ³•"><a href="#3-5-Schnorr-ç­¾åç®—æ³•" class="headerlink" title="3.5 Schnorr ç­¾åç®—æ³•"></a>3.5 Schnorr ç­¾åç®—æ³•</h2><p>Schnorrç­¾åå¹¿æ³›åº”ç”¨äºåŒºå—é“¾å’ŒåŠ å¯†è´§å¸é¢†åŸŸ</p><h3 id="3-5-1-SchnorråŸºæœ¬æ­¥éª¤"><a href="#3-5-1-SchnorråŸºæœ¬æ­¥éª¤" class="headerlink" title="3.5.1 SchnorråŸºæœ¬æ­¥éª¤"></a>3.5.1 SchnorråŸºæœ¬æ­¥éª¤</h3><p>ä¸‹é¢æ˜¯Schnorrç®—æ³•çš„åŸºæœ¬æ­¥éª¤ï¼š</p><ol><li>å¯†é’¥ç”Ÿæˆï¼š<ul><li>éšæœºé€‰æ‹©ä¸€ä¸ªç§é’¥ï¼ˆç§é’¥æ˜¯ä¸€ä¸ªéšæœºæ•°ï¼‰ã€‚</li><li>ä½¿ç”¨æ¤­åœ†æ›²çº¿ä¸Šçš„ç‚¹ä¹˜æ³•è¿ç®—ç”Ÿæˆå¯¹åº”çš„å…¬é’¥ï¼ˆä¸æ‡‚æ²¡å…³ç³»ï¼‰ã€‚</li></ul></li><li>ç­¾åç”Ÿæˆï¼š<ul><li>é€‰æ‹©ä¸€ä¸ªéšæœºæ•°ä½œä¸ºä¸´æ—¶ç§é’¥ã€‚</li><li>ä½¿ç”¨ä¸´æ—¶ç§é’¥å’Œæ¶ˆæ¯çš„å“ˆå¸Œå€¼è®¡ç®—å‡ºä¸€ä¸ªä¸´æ—¶å…¬é’¥ã€‚ï¼ˆåªéœ€è¦ä¸€æ¬¡å“ˆå¸Œï¼‰</li><li>ä½¿ç”¨ä¸´æ—¶ç§é’¥ã€æ¶ˆæ¯å’Œä¸´æ—¶å…¬é’¥ç­‰å‚æ•°è®¡ç®—å‡ºç­¾åçš„å€¼ã€‚</li></ul></li><li>éªŒè¯ç­¾åï¼š<ul><li>ä½¿ç”¨å…¬é’¥å’Œæ¶ˆæ¯çš„å“ˆå¸Œå€¼é‡å¤è®¡ç®—å‡ºç­¾åçš„å€¼ã€‚</li><li>å°†è®¡ç®—å¾—åˆ°çš„ç­¾åå€¼ä¸åŸå§‹çš„ç­¾åå€¼è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™éªŒè¯é€šè¿‡ã€‚</li></ul></li></ol><h3 id="3-5-1-Schnorrä¼˜ç‚¹"><a href="#3-5-1-Schnorrä¼˜ç‚¹" class="headerlink" title="3.5.1 Schnorrä¼˜ç‚¹"></a><strong>3.5.1 Schnorrä¼˜ç‚¹</strong></h3><ul><li><strong>é«˜æ•ˆæ€§</strong>ï¼šç›¸æ¯”äºå…¶å®ƒç­¾åç®—æ³•ï¼ŒSchnorrç­¾ååœ¨è®¡ç®—ä¸Šæ›´åŠ é«˜æ•ˆï¼Œç‰¹åˆ«æ˜¯åœ¨ç­¾åç”Ÿæˆå’ŒéªŒè¯è¿‡ç¨‹ä¸­ï¼Œè®¡ç®—é‡è¾ƒå°ï¼Œç­¾åå’ŒéªŒè¯çš„é€Ÿåº¦å¿«</li><li><strong>çŸ­ç­¾å</strong>ï¼šSchnorrç­¾åé•¿åº¦è¾ƒçŸ­ï¼Œæœ‰åŠ©äºèŠ‚çœå¸¦å®½å’Œå­˜å‚¨ç©ºé—´ã€‚</li><li><strong>çº¿æ€§æ€§è´¨</strong>ï¼šSchnorrç­¾åå…·æœ‰çº¿æ€§æ€§è´¨ï¼Œè¿™æ„å‘³ç€å¯ä»¥å¯¹å¤šä¸ªç­¾åè¿›è¡Œèšåˆï¼Œä»è€Œå‡å°‘äº¤æ˜“çš„å¤§å°å’ŒéªŒè¯çš„æˆæœ¬ã€‚</li><li><strong>å®‰å…¨æ€§</strong>ï¼šåŸºäºç¦»æ•£å¯¹æ•°é—®é¢˜çš„å®‰å…¨æ€§ï¼Œéš¾ä»¥è¢«ç ´è§£ã€‚</li><li><strong>æŠ—é‡å­è®¡ç®—æ”»å‡»</strong>ï¼šSchnorrç­¾åæ–¹æ¡ˆè¢«è®¤ä¸ºå¯¹é‡å­è®¡ç®—æ”»å‡»æœ‰è¾ƒå¥½çš„æŠµæŠ—æ€§ï¼Œå› æ­¤åœ¨æœªæ¥é‡å­è®¡ç®—æˆä¸ºç°å®æ—¶ï¼ŒSchnorrç­¾åå¯èƒ½ä¼šæˆä¸ºä¸»æµé€‰æ‹©ã€‚</li></ul><h3 id="3-5-2-Schnorråº”ç”¨"><a href="#3-5-2-Schnorråº”ç”¨" class="headerlink" title="3.5.2. Schnorråº”ç”¨"></a><strong>3.5.2. Schnorråº”ç”¨</strong></h3><p>æ¯”ç‰¹å¸çš„Taprootå‡çº§ä¸­ä½¿ç”¨äº†åŸºäºSchnorrç­¾åçš„èšåˆç­¾åæŠ€æœ¯ã€‚æ­¤å¤–ï¼Œè®¸å¤šå¯†ç åè®®å’Œæ ‡å‡†ä¹Ÿé‡‡ç”¨äº†Schnorrç­¾åç®—æ³•ã€‚ç´§å‡‘å‹å’Œçµæ´»æ€§éƒ½å¾ˆé«˜</p><p>æ€»ä¹‹ï¼ŒSchnorrç­¾åç®—æ³•ä»¥å…¶é«˜æ•ˆå’Œå®‰å…¨çš„ç‰¹ç‚¹ï¼Œæˆä¸ºäº†ç°ä»£å¯†ç å­¦ä¸­çš„ä¸€ä¸ªé‡è¦å·¥å…·ï¼Œå°¤å…¶åœ¨å¯¹èµ„æºè¦æ±‚è¾ƒé«˜çš„åº”ç”¨åœºæ™¯ä¸­å…·æœ‰æ˜¾è‘—ä¼˜åŠ¿</p><h2 id="3-6-BLSç®—æ³•"><a href="#3-6-BLSç®—æ³•" class="headerlink" title="3.6 BLSç®—æ³•"></a>3.6 BLSç®—æ³•</h2><p>SchnorréªŒè¯çš„æœ‰ç‚¹BLSéƒ½å…·å¤‡ï¼Œ</p><p>æ”¯æŒæ‰¹é‡éªŒè¯çš„ç‰¹ç‚¹ï¼Œå¯¹å¤šé‡ç­¾åçš„åœºæ™¯æ”¯æŒåº¦ç›¸å½“é«˜</p><p>ä»¥å¤ªåŠå‡çº§åç”¨çš„å¤š</p><p>BLSï¼ˆBoneh-Lynn-Shachamï¼‰ç­¾åç®—æ³•æ˜¯ä¸€ç§åŸºäºåŒçº¿æ€§å¯¹ï¼ˆbilinear pairingï¼‰çš„æ•°å­—ç­¾åæ–¹æ¡ˆ</p><h3 id="3-6-1åŸºæœ¬æ­¥éª¤"><a href="#3-6-1åŸºæœ¬æ­¥éª¤" class="headerlink" title="3.6.1åŸºæœ¬æ­¥éª¤"></a>3.6.1åŸºæœ¬æ­¥éª¤</h3><p>ä»¥ä¸‹æ˜¯BLSç­¾åç®—æ³•çš„åŸºæœ¬æ­¥éª¤ï¼š</p><ol><li>å¯†é’¥ç”Ÿæˆï¼š<ul><li>éšæœºé€‰æ‹©ä¸€ä¸ªç§é’¥ï¼ˆç§é’¥æ˜¯ä¸€ä¸ªéšæœºæ•°ï¼‰ã€‚</li><li>ä½¿ç”¨æ¤­åœ†æ›²çº¿ä¸Šçš„ç‚¹ä¹˜æ³•è¿ç®—ç”Ÿæˆå¯¹åº”çš„å…¬é’¥ã€‚</li></ul></li><li>ç­¾åç”Ÿæˆï¼š<ul><li>å°†æ¶ˆæ¯çš„å“ˆå¸Œå€¼ä½œä¸ºè¾“å…¥ã€‚</li><li>ä½¿ç”¨ç§é’¥å¯¹å“ˆå¸Œå€¼è¿›è¡Œç­¾åï¼Œç”Ÿæˆä¸€ä¸ªç­¾åå€¼ã€‚</li></ul></li><li>éªŒè¯ç­¾åï¼š<ul><li>ä½¿ç”¨å…¬é’¥å’Œæ¶ˆæ¯çš„å“ˆå¸Œå€¼é‡å¤è®¡ç®—å‡ºç­¾åçš„å€¼ã€‚</li><li>å°†è®¡ç®—å¾—åˆ°çš„ç­¾åå€¼ä¸åŸå§‹çš„ç­¾åå€¼è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™éªŒè¯é€šè¿‡ã€‚</li></ul></li></ol><h3 id="3-6-2-ç‰¹ç‚¹å’Œåº”ç”¨"><a href="#3-6-2-ç‰¹ç‚¹å’Œåº”ç”¨" class="headerlink" title="3.6.2 ç‰¹ç‚¹å’Œåº”ç”¨"></a>3.6.2 ç‰¹ç‚¹å’Œåº”ç”¨</h3><ul><li><strong>ç®€æ´æ€§</strong>ï¼šBLSç­¾åéå¸¸ç®€æ´ï¼Œç­¾åçš„å¤§å°å›ºå®šä¸”è¾ƒå°ï¼Œåªæœ‰ä¸€ä¸ªç¾¤å…ƒç´ ã€‚</li><li><strong>æ•ˆç‡</strong>ï¼šç­¾åç”Ÿæˆå’ŒéªŒè¯çš„è®¡ç®—é‡ç›¸å¯¹è¾ƒå°ï¼Œå°¤å…¶æ˜¯åœ¨ç­¾åé•¿åº¦è¾ƒçŸ­çš„æƒ…å†µä¸‹ã€‚</li><li><strong>èšåˆç­¾å</strong>ï¼šBLSç­¾åå…·æœ‰å¤©ç„¶çš„ç­¾åèšåˆï¼ˆaggregate signatureï¼‰ç‰¹æ€§ï¼Œå¤šä¸ªç­¾åå¯ä»¥è¢«èšåˆæˆä¸€ä¸ªç­¾åï¼Œä»è€Œå‡å°‘å­˜å‚¨å’Œä¼ è¾“çš„å¼€é”€ã€‚è¿™åœ¨åŒºå—é“¾å’Œåˆ†å¸ƒå¼ç³»ç»Ÿä¸­å°¤ä¸ºæœ‰ç”¨ã€‚</li><li><strong>å¤šé‡ç­¾å</strong>ï¼šBLSä¹Ÿæ”¯æŒ<strong>å¤šé‡ç­¾å</strong>ï¼ˆmulti-signatureï¼‰ï¼Œå¤šä¸ªç”¨æˆ·å¯ä»¥å…±åŒç­¾ç½²åŒä¸€æ¶ˆæ¯ï¼Œç”Ÿæˆä¸€ä¸ªè”åˆç­¾åã€‚</li></ul><p>ä¸åŒç‚¹ï¼š</p><p><strong>ç­¾åèšåˆ</strong>ï¼š</p><ul><li>BLSç­¾åç®—æ³•ï¼šBLSç­¾åç®—æ³•å¤©ç„¶æ”¯æŒç­¾åçš„èšåˆã€‚å¤šä¸ªBLSç­¾åå¯ä»¥é€šè¿‡ç®€å•çš„æ•°å­¦è¿ç®—åˆå¹¶ä¸ºå•ä¸ªç­¾åï¼Œä»è€Œå‡å°‘ä¼ è¾“å’ŒéªŒè¯çš„å¼€é”€ã€‚</li><li>Schnorrç­¾åç®—æ³•ï¼šSchnorrç­¾åç®—æ³•ä¸ç›´æ¥æ”¯æŒç­¾åçš„èšåˆã€‚è¦å®ç°ç­¾åèšåˆï¼Œéœ€è¦é¢å¤–çš„åè®®æˆ–æ–¹æ¡ˆã€‚</li></ul><h1 id="4-å•å‘æ•£åˆ—å‡½æ•°ç®—æ³•ä»‹ç»ï¼ˆå±äºå¯¹ç§°åŠ å¯†ï¼‰"><a href="#4-å•å‘æ•£åˆ—å‡½æ•°ç®—æ³•ä»‹ç»ï¼ˆå±äºå¯¹ç§°åŠ å¯†ï¼‰" class="headerlink" title="4 å•å‘æ•£åˆ—å‡½æ•°ç®—æ³•ä»‹ç»ï¼ˆå±äºå¯¹ç§°åŠ å¯†ï¼‰"></a>4 å•å‘æ•£åˆ—å‡½æ•°ç®—æ³•ä»‹ç»ï¼ˆå±äºå¯¹ç§°åŠ å¯†ï¼‰</h1><p>MD5ã€SHA-1ã€SHA-2ã€SHA-3ï¼ˆä»¥å¤ªåŠï¼‰ã€blakeã€blake2ï¼ˆç”¨çš„å¤šï¼‰ã€æ³¢èµ›ç™»ï¼ˆç”¨çš„å¤šï¼‰</p><p>å•å‘æ•£åˆ—å‡½æ•°ï¼ˆOne-way hash functionï¼‰æ˜¯ä¸€ç§é‡è¦çš„å¯†ç å­¦å·¥å…·ï¼Œå®ƒå°†<strong>è¾“å…¥æ•°æ®</strong>è½¬æ¢ä¸º<strong>å›ºå®šé•¿åº¦</strong>çš„è¾“å‡ºå€¼ï¼Œç§°ä¸º<strong>å“ˆå¸Œå€¼</strong>ï¼ŒåŒæ—¶å…·å¤‡ä»¥ä¸‹ç‰¹æ€§ï¼š</p><ol><li><strong>å•å‘æ€§</strong>ï¼ˆOne-way propertyï¼‰ï¼šè®¡ç®—ä»å“ˆå¸Œå€¼åˆ°åŸå§‹è¾“å…¥çš„é€†è¿‡ç¨‹æ˜¯å›°éš¾çš„ã€‚å³ç»™å®šå“ˆå¸Œå€¼ï¼Œè®¡ç®—å‡ºåŸå§‹è¾“å…¥æ˜¯å›°éš¾çš„ã€‚</li><li><strong>å›ºå®šè¾“å‡ºé•¿åº¦</strong>ï¼šå•å‘æ•£åˆ—å‡½æ•°ç”Ÿæˆçš„å“ˆå¸Œå€¼å…·æœ‰<strong>å›ºå®š</strong>çš„é•¿åº¦ï¼Œæ— è®ºè¾“å…¥çš„é•¿åº¦å¦‚ä½•ã€‚</li><li><strong>æŠ—ç¢°æ’æ€§</strong>ï¼ˆCollision resistanceï¼‰ï¼šå¾ˆéš¾æ‰¾åˆ°ä¸¤ä¸ªä¸åŒçš„è¾“å…¥ï¼Œå®ƒä»¬ç”Ÿæˆç›¸åŒçš„å“ˆå¸Œå€¼</li></ol><h2 id="4-1-MD5"><a href="#4-1-MD5" class="headerlink" title="4.1 MD5"></a>4.1 MD5</h2><h3 id="4-1-1-MD5ç‰¹ç‚¹"><a href="#4-1-1-MD5ç‰¹ç‚¹" class="headerlink" title="4.1.1 MD5ç‰¹ç‚¹"></a>4.1.1 MD5ç‰¹ç‚¹</h3><p>ä»¥ä¸‹æ˜¯MD5çš„åŸºæœ¬ç‰¹ç‚¹å’Œç‰¹æ€§ï¼š</p><ol><li><strong>å•å‘æ€§</strong>ï¼šMD5æ˜¯ä¸€ç§å•å‘æ•£åˆ—å‡½æ•°ï¼Œæ ¹æ®ç»™å®šè¾“å…¥è®¡ç®—å‡ºå›ºå®šé•¿åº¦çš„å“ˆå¸Œå€¼ï¼Œä½†ä»å“ˆå¸Œå€¼<strong>æ¨å¯¼</strong>å‡ºåŸå§‹è¾“å…¥æ˜¯éå¸¸å›°éš¾çš„ï¼Œè¿™æ˜¯å…¶å•å‘æ€§çš„å…³é”®ç‰¹æ€§ã€‚</li><li><strong>å›ºå®šè¾“å‡ºé•¿åº¦</strong>ï¼šæ— è®ºè¾“å…¥çš„é•¿åº¦å¦‚ä½•ï¼ŒMD5ç”Ÿæˆçš„å“ˆå¸Œå€¼å§‹ç»ˆä¸º128ä½ï¼Œé•¿åº¦å›ºå®šã€‚å®ƒå°†è¾“å…¥æ•°æ®è½¬æ¢ä¸ºä¸€ä¸ª128ä½ï¼ˆ16å­—èŠ‚ï¼‰çš„å“ˆå¸Œå€¼ï¼Œé€šå¸¸è¡¨ç¤ºä¸º32ä¸ªåå…­è¿›åˆ¶æ•°å­—ã€‚</li><li><strong>å¿«é€Ÿè®¡ç®—</strong>ï¼šç›¸å¯¹äºè¾ƒæ–°çš„å“ˆå¸Œå‡½æ•°ï¼Œå¦‚SHA-256ï¼ŒMD5è®¡ç®—é€Ÿåº¦è¾ƒå¿«ï¼Œé€‚ç”¨äºä¸€äº›å¯¹æ€§èƒ½è¦æ±‚è¾ƒé«˜çš„åœºæ™¯ã€‚</li></ol><h3 id="4-1-2-MD5æ­¥éª¤"><a href="#4-1-2-MD5æ­¥éª¤" class="headerlink" title="4.1.2 MD5æ­¥éª¤"></a>4.1.2 MD5æ­¥éª¤</h3><ol><li><strong>å¡«å……æ•°æ®</strong>ï¼šå°†è¾“å…¥æ•°æ®è¿›è¡Œå¡«å……ï¼Œä½¿å…¶é•¿åº¦æ»¡è¶³å¯¹512ä½ï¼ˆ64å­—èŠ‚ï¼‰å—çš„æ•´æ•°å€ã€‚å¡«å……æ–¹å¼æ˜¯åœ¨æ•°æ®æœ«å°¾æ·»åŠ ä¸€ä¸ªâ€1â€æ¯”ç‰¹ï¼Œç„¶åå¡«å……è‹¥å¹²â€0â€æ¯”ç‰¹ï¼Œç›´åˆ°æ»¡è¶³é•¿åº¦è¦æ±‚ã€‚</li><li><strong>åˆå§‹åŒ–çŠ¶æ€</strong>ï¼šå®šä¹‰å››ä¸ª32ä½çš„å¯„å­˜å™¨ï¼ˆAã€Bã€Cã€Dï¼‰ä½œä¸ºMD5çš„å†…éƒ¨çŠ¶æ€ã€‚åˆå§‹æ—¶ï¼Œè¿™äº›å¯„å­˜å™¨åŒ…å«é¢„å®šä¹‰çš„å›ºå®šå€¼ã€‚</li><li><strong>å¤„ç†å—æ•°æ®</strong>ï¼šå°†å¡«å……åçš„æ•°æ®åˆ’åˆ†ä¸º512ä½ï¼ˆ64å­—èŠ‚ï¼‰çš„å—ï¼Œå¹¶å¯¹æ¯ä¸ªå—è¿›è¡Œå¤„ç†ã€‚</li><li><strong>åˆ’åˆ†ä¸ºå­å—</strong>ï¼šå°†æ¯ä¸ª512ä½å—åˆ’åˆ†ä¸º16ä¸ª32ä½çš„å­å—ï¼Œæ¯ä¸ªå­å—å æ®4ä¸ªå­—èŠ‚ã€‚</li><li><strong>åˆå§‹åŒ–å˜é‡</strong>ï¼šå®šä¹‰å››ä¸ª32ä½å˜é‡ï¼ˆAã€Bã€Cã€Dï¼‰ï¼Œå¹¶å°†å…¶åˆå§‹åŒ–ä¸ºåˆå§‹çŠ¶æ€çš„å¯„å­˜å™¨å€¼ã€‚</li><li><strong>å¾ªç¯è¿ç®—</strong>ï¼šé€šè¿‡å››è½®å¾ªç¯ï¼Œå¯¹å­å—è¿›è¡Œä¸€ç³»åˆ—çš„ä½è¿ç®—å’Œéçº¿æ€§å‡½æ•°æ“ä½œï¼Œæ›´æ–°å˜é‡çš„å€¼ã€‚</li><li><strong>è¾“å‡ºç»“æœ</strong>ï¼šç»è¿‡å¾ªç¯è¿ç®—åï¼Œå¾—åˆ°æœ€ç»ˆçš„MD5å“ˆå¸Œå€¼ã€‚å°†å››ä¸ª32ä½å˜é‡æŒ‰ç…§å°ç«¯å­—èŠ‚åºè¿æ¥èµ·æ¥ï¼Œå½¢æˆ128ä½ï¼ˆ16å­—èŠ‚ï¼‰çš„å“ˆå¸Œå€¼ã€‚</li></ol><h3 id="4-1-3-MD5-ç”¨é€”"><a href="#4-1-3-MD5-ç”¨é€”" class="headerlink" title="4.1.3 MD5 ç”¨é€”"></a>4.1.3 MD5 ç”¨é€”</h3><ol><li><strong>ä¸€è‡´æ€§éªŒè¯</strong>ï¼šç½‘ä¸Šä¸‹è½½è¢«äººçš„æ–‡ä»¶ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–‡ä»¶çš„MD5å€¼ï¼Œç„¶åä½ ç”¨å·¥å…·éªŒè¯ä½ ä¸‹è½½çš„æ–‡ä»¶çš„MD5å€¼å’Œåˆ«äººç»™å‡ºçš„è¿™ä¸ªMD5å€¼æ˜¯å¦ä¸€è‡´ï¼Ÿä¸€è‡´å°±è¯´æ˜æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ²¡æœ‰é—®é¢˜ã€‚</li><li><strong>æ•°å­—è¯ä¹¦</strong> ï¼šå¦‚æœæœ‰ä¸€ä¸ªç¬¬ä¸‰æ–¹çš„è®¤è¯æœºæ„ï¼Œç”¨MD5è¿˜å¯ä»¥é˜²æ­¢æ–‡ä»¶ä½œè€…çš„â€œæŠµèµ–â€ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„æ•°å­—ç­¾ååº”ç”¨ã€‚</li><li><strong>å®‰å…¨è®¿é—®è®¤è¯</strong>ï¼šåœ¨Unixç³»ç»Ÿä¸­ç”¨æˆ·çš„å¯†ç æ˜¯ä»¥MD5ï¼ˆæˆ–å…¶å®ƒç±»ä¼¼çš„ç®—æ³•ï¼‰ç»Hashè¿ç®—åå­˜å‚¨åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚å½“ç”¨æˆ·ç™»å½•çš„æ—¶å€™ï¼Œç³»ç»ŸæŠŠç”¨æˆ·è¾“å…¥çš„å¯†ç è¿›è¡ŒMD5 Hashè¿ç®—ï¼Œç„¶åå†å»å’Œä¿å­˜åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„MD5å€¼è¿›è¡Œæ¯”è¾ƒï¼Œè¿›è€Œç¡®å®šè¾“å…¥çš„å¯†ç æ˜¯å¦æ­£ç¡®ã€‚é€šè¿‡è¿™æ ·çš„æ­¥éª¤ï¼Œç³»ç»Ÿåœ¨å¹¶ä¸çŸ¥é“ç”¨æˆ·å¯†ç çš„æ˜ç çš„æƒ…å†µä¸‹å°±å¯ä»¥ç¡®å®šç”¨æˆ·ç™»å½•ç³»ç»Ÿçš„åˆæ³•æ€§ã€‚</li></ol><p>ç„¶è€Œï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒMD5å­˜åœ¨ä»¥ä¸‹ä¸»è¦å®‰å…¨æ€§é—®é¢˜ï¼š</p><ol><li><strong>ç¢°æ’æ”»å‡»</strong>ï¼šMD5å·²ç»è¢«è¯æ˜å¯¹ç¢°æ’æ”»å‡»ä¸å®‰å…¨ã€‚ç¢°æ’æŒ‡çš„æ˜¯æ‰¾åˆ°ä¸¤ä¸ªä¸åŒçš„è¾“å…¥ï¼Œå®ƒä»¬ç”Ÿæˆç›¸åŒçš„MD5å“ˆå¸Œå€¼ã€‚è¿™æ„å‘³ç€æ”»å‡»è€…å¯ä»¥é€šè¿‡æ„é€ ç‰¹å®šçš„è¾“å…¥æ¥ä¼ªé€ æ•°æ®æˆ–ç¯¡æ”¹æ•°æ®ï¼Œä»è€Œç ´åå®Œæ•´æ€§ã€‚</li><li><strong>é¢„æ˜ å°„æ”»å‡»</strong>ï¼šé€šè¿‡é€‰æ‹©ç‰¹å®šçš„è¾“å…¥ï¼Œå¯ä»¥åœ¨è®¡ç®—MD5å“ˆå¸Œå€¼ä¹‹å‰è¿›è¡Œé¢„è®¡ç®—ï¼Œä»è€ŒåŠ é€Ÿç¢°æ’æ”»å‡»çš„å®æ–½ã€‚</li></ol><p>å®‰å…¨æ€§ï¼šå·²è¢«ç ´è§£â€“&gt;ä¸­å›½ç‹å°äº‘</p><h2 id="4-2-SHA-ç³»åˆ—ç®—æ³•"><a href="#4-2-SHA-ç³»åˆ—ç®—æ³•" class="headerlink" title="4.2 SHA ç³»åˆ—ç®—æ³•"></a>4.2 SHA ç³»åˆ—ç®—æ³•</h2><p>å®‰å…¨æ•£åˆ—ç®—æ³•ï¼ˆè‹±è¯­ï¼šSecure Hash Algorithmï¼Œç¼©å†™ä¸ºSHAï¼‰æ˜¯ä¸€ä¸ªå¯†ç æ•£åˆ—å‡½æ•°å®¶æ—ï¼Œèƒ½è®¡ç®—å‡ºä¸€ä¸ªæ•°å­—æ¶ˆæ¯æ‰€å¯¹åº”åˆ°çš„ï¼Œé•¿åº¦å›ºå®šçš„å­—ç¬¦ä¸²ï¼ˆåˆç§°æ¶ˆæ¯æ‘˜è¦ï¼‰çš„ç®—æ³•ã€‚</p><p>ä¸”è‹¥è¾“å…¥çš„æ¶ˆæ¯ä¸åŒï¼Œå®ƒä»¬å¯¹åº”åˆ°ä¸åŒå­—ç¬¦ä¸²çš„æœºç‡å¾ˆé«˜ã€‚SHAå®¶æ—ç®—æ³•åˆ†åˆ«æ˜¯SHA-0ï¼›SHA-1ï¼›SHA-224ã€SHA-256ã€SHA-384ï¼ŒSHA-512å’ŒSHA3ã€‚SHA-224ã€SHA-256ã€SHA-384ï¼ŒSHA-512 æœ‰æ—¶å¹¶ç§°ä¸º SHA-2ï¼Œ SHA3 æ˜¯ç¬¬ä¸‰ä»£å®‰å…¨æ•£åˆ—ç®—æ³•(Secure Hash Algorithm 3)ï¼Œä¹‹å‰åä¸º Keccak ç®—æ³•ï¼Œåœ¨ç¡¬ä»¶å®åšä¸Šé¢ï¼Œè¿™ä¸ªç®—æ³•æ¯”èµ·å…¶ä»–ç®—æ³•æ˜æ˜¾çš„å¿«ä¸Šå¾ˆå¤šï¼Œç›®å‰ SHA-0ï¼ŒSHA-1 å·²è¢«ç ´è§£ã€‚</p><p>sha-256å±äºsha-2å®¶æ—</p><h2 id="4-3-Blake-å’Œ-Blake2ç³»åˆ—ç®—æ³•"><a href="#4-3-Blake-å’Œ-Blake2ç³»åˆ—ç®—æ³•" class="headerlink" title="4.3 Blake å’Œ Blake2ç³»åˆ—ç®—æ³•"></a>4.3 Blake å’Œ Blake2ç³»åˆ—ç®—æ³•</h2><p>BLAKEï¼ˆåŠå…¶åç»­ç‰ˆæœ¬ BLAKE2ï¼‰æ˜¯ä¸€ç§å¿«é€Ÿä¸”å®‰å…¨çš„å“ˆå¸Œç®—æ³•ï¼Œå‚ä¸äº†SHA-3ç«èµ›å¹¶æˆä¸ºäº†SHA-3çš„äº”ä¸ªå†³èµ›é€‰æ‰‹ä¹‹ä¸€ã€‚</p><p>BLAKE2 æ˜¯ä¸€ç§å¿«é€Ÿã€å®‰å…¨çš„å“ˆå¸Œå‡½æ•°ï¼Œæ˜¯å¯¹ BLAKE ç®—æ³•çš„æ”¹è¿›ã€‚BLAKE2 äº 2012 å¹´å‘å¸ƒï¼Œå…¶è®¾è®¡ç›®æ ‡æ˜¯æä¾›æ¯” MD5ã€SHA-1 å’Œ SHA-2 æ›´é«˜çš„å®‰å…¨æ€§å’Œæ›´å¿«çš„é€Ÿåº¦ï¼ŒåŒæ—¶ä¿æŒé«˜åº¦çš„çµæ´»æ€§å’Œç®€ä¾¿æ€§ã€‚</p><h3 id="4-3-1-Blake-ç³»åˆ—ç®—æ³•ç‰¹ç‚¹"><a href="#4-3-1-Blake-ç³»åˆ—ç®—æ³•ç‰¹ç‚¹" class="headerlink" title="4.3.1 Blake ç³»åˆ—ç®—æ³•ç‰¹ç‚¹"></a>4.3.1 Blake ç³»åˆ—ç®—æ³•ç‰¹ç‚¹</h3><ul><li><strong>é«˜æ•ˆæ€§èƒ½</strong>ï¼šBLAKE2 æ¯” SHA-2ï¼ˆå¦‚ SHA-256 å’Œ SHA-512ï¼‰æ›´å¿«ï¼ŒåŒæ—¶åœ¨ç°ä»£ CPU ä¸Šçš„æ€§èƒ½é€šå¸¸ä¼˜äº MD5 å’Œ SHA-1ã€‚BLAKE2 çš„è®¾è®¡å……åˆ†åˆ©ç”¨äº†ç°ä»£å¤„ç†å™¨çš„ç‰¹æ€§ï¼Œä½¿å…¶åœ¨è½¯ä»¶å®ç°ä¸­éå¸¸é«˜æ•ˆã€‚</li><li><strong>é«˜å®‰å…¨æ€§</strong>ï¼šBLAKE2 æä¾›äº†ä¸ SHA-3 ç›¸åª²ç¾çš„å®‰å…¨æ€§ã€‚å®ƒå…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š<ul><li><strong>æŠ—ç¢°æ’æ”»å‡»</strong>ï¼šå¾ˆéš¾æ‰¾åˆ°ä¸¤ä¸ªä¸åŒçš„è¾“å…¥ä½¿å¾—å®ƒä»¬çš„å“ˆå¸Œå€¼ç›¸åŒã€‚</li><li><strong>æŠ—é¢„æ˜ å°„æ”»å‡»</strong>ï¼šå¾ˆéš¾æ‰¾åˆ°ä¸€ä¸ªç»™å®šå“ˆå¸Œå€¼å¯¹åº”çš„åŸå§‹è¾“å…¥ã€‚</li><li><strong>æŠ—ç¬¬äºŒé¢„æ˜ å°„æ”»å‡»</strong>ï¼šå¾ˆéš¾æ‰¾åˆ°ä¸ç»™å®šè¾“å…¥å…·æœ‰ç›¸åŒå“ˆå¸Œå€¼çš„å¦ä¸€ä¸ªè¾“</li></ul></li><li>å¯å˜é•¿åº¦è¾“å‡ºï¼šBLAKE2 å¯ä»¥ç”Ÿæˆä»»æ„é•¿åº¦çš„å“ˆå¸Œå€¼ï¼Œä» 1 æ¯”ç‰¹åˆ° 512 æ¯”ç‰¹ã€‚è¿™ä½¿å¾—å®ƒåœ¨è®¸å¤šåº”ç”¨ä¸­éå¸¸çµæ´»ã€‚ï¼ˆMD6å›ºå®š128ä½ï¼‰</li><li><strong>ç®€å•æ˜“ç”¨</strong>ï¼šBLAKE2 çš„è®¾è®¡å’Œå®ç°éƒ½ç›¸å¯¹ç®€å•ï¼Œè¿™æœ‰åŠ©äºé™ä½å®ç°ä¸­çš„é”™è¯¯é£é™©ã€‚å®ƒè¿˜æä¾›äº†å¤šç§å˜ç§ï¼Œä»¥æ»¡è¶³ä¸åŒéœ€æ±‚ï¼š<ul><li><strong>BLAKE2b</strong>ï¼šé€‚ç”¨äº 64 ä½å¹³å°ï¼Œè¾“å‡ºé•¿åº¦å¯è¾¾ 512 æ¯”ç‰¹ã€‚</li><li><strong>BLAKE2s</strong>ï¼šé€‚ç”¨äº 32 ä½å¹³å°ï¼Œè¾“å‡ºé•¿åº¦å¯è¾¾ 256 æ¯”ç‰¹ã€‚</li></ul></li><li><strong>å†…ç½®ç‰¹æ€§</strong>ï¼šBLAKE2 é›†æˆäº†å¤šç§å¸¸ç”¨åŠŸèƒ½ï¼Œè¿™ä½¿å¾—å®ƒåœ¨è®¸å¤šåº”ç”¨ä¸­æ›´åŠ ä¾¿æ·ï¼š<ul><li><strong>å¯†é’¥å“ˆå¸Œï¼ˆKeyed Hashingï¼‰</strong>ï¼šå¯ä»¥ä½¿ç”¨å¯†é’¥ç”Ÿæˆæ¶ˆæ¯è®¤è¯ç ï¼ˆMACï¼‰ã€‚</li><li><strong>ç›å€¼ï¼ˆSalted Hashingï¼‰</strong>ï¼šå…è®¸ä½¿ç”¨ç›å€¼å¢å¼ºå“ˆå¸Œçš„å®‰å…¨æ€§ã€‚</li><li><strong>ä¸ªæ€§åŒ–ï¼ˆPersonalized Hashingï¼‰</strong>ï¼šå¯ä»¥æ ¹æ®åº”ç”¨éœ€æ±‚å®šåˆ¶å“ˆå¸Œå€¼ã€‚</li></ul></li></ul><h3 id="4-3-2-blake2-åº”ç”¨åœºæ™¯"><a href="#4-3-2-blake2-åº”ç”¨åœºæ™¯" class="headerlink" title="4.3.2 blake2 åº”ç”¨åœºæ™¯"></a>4.3.2 blake2 åº”ç”¨åœºæ™¯</h3><p>ç”±äºå…¶é«˜æ•ˆæ€§å’Œå®‰å…¨æ€§ï¼ŒBLAKE2 è¢«å¹¿æ³›åº”ç”¨äºå„ç§é¢†åŸŸï¼ŒåŒ…æ‹¬ä½†ä¸é™äºï¼š</p><ul><li><strong>å¯†ç å­¦åº”ç”¨</strong>ï¼šå¦‚æ•°å­—ç­¾åã€æ¶ˆæ¯è®¤è¯ç ã€éšæœºæ•°ç”Ÿæˆç­‰ã€‚</li><li><strong>æ•°æ®å®Œæ•´æ€§éªŒè¯</strong>ï¼šå¦‚æ–‡ä»¶æ ¡éªŒã€æ•°æ®å¤‡ä»½éªŒè¯ç­‰ã€‚</li><li><strong>åŒºå—é“¾å’ŒåŠ å¯†è´§å¸</strong>ï¼šBLAKE2 è¢«è®¸å¤šåŒºå—é“¾é¡¹ç›®ç”¨ä½œå“ˆå¸Œå‡½æ•°ã€‚ä»¥å¤ªåŠ</li></ul><h2 id="4-4-Poseidon-ï¼ˆæ³¢èµ›ç™»ï¼‰ç®—æ³•"><a href="#4-4-Poseidon-ï¼ˆæ³¢èµ›ç™»ï¼‰ç®—æ³•" class="headerlink" title="4.4 Poseidon ï¼ˆæ³¢èµ›ç™»ï¼‰ç®—æ³•"></a>4.4 Poseidon ï¼ˆæ³¢èµ›ç™»ï¼‰ç®—æ³•</h2><p>Poseidon æ˜¯ä¸€ç§ç°ä»£åŠ å¯†å“ˆå¸Œå‡½æ•°ï¼Œè®¾è®¡ç”¨äºé›¶çŸ¥è¯†è¯æ˜ï¼ˆZero-Knowledge Proofs, ZKPsï¼‰ç­‰é«˜çº§å¯†ç å­¦åº”ç”¨ã€‚å®ƒç”±ç ”ç©¶äººå‘˜ Benedikt Bunz, Dario Fiore, Iddo Bentov, and Pavel Vasin ç­‰äººè®¾è®¡ã€‚Poseidon çš„è®¾è®¡ç›®æ ‡æ˜¯æä¾›ä¸€ç§é«˜æ•ˆä¸”å®‰å…¨çš„å“ˆå¸Œç®—æ³•ï¼Œç‰¹åˆ«é€‚åˆç”¨äº zk-SNARKs å’Œ zk-STARKs ç­‰ ZKP ç³»ç»Ÿä¸­ã€‚</p><h3 id="4-4-1-Poseidon-ç®—æ³•çš„ç‰¹ç‚¹"><a href="#4-4-1-Poseidon-ç®—æ³•çš„ç‰¹ç‚¹" class="headerlink" title="4.4.1 Poseidon ç®—æ³•çš„ç‰¹ç‚¹"></a>4.4.1 Poseidon ç®—æ³•çš„ç‰¹ç‚¹</h3><ul><li><strong>é’ˆå¯¹é›¶çŸ¥è¯†è¯æ˜ä¼˜åŒ–</strong>ï¼š Poseidon è®¾è®¡æ—¶è€ƒè™‘äº†åœ¨é›¶çŸ¥è¯†è¯æ˜ç³»ç»Ÿä¸­çš„åº”ç”¨ï¼Œä¼˜åŒ–äº†å“ˆå¸Œè®¡ç®—çš„æ•ˆç‡ï¼Œç‰¹åˆ«æ˜¯å‡å°‘äº†ç®—æœ¯ç”µè·¯ä¸­çš„é—¨æ•°é‡ï¼ˆgate countï¼‰ã€‚Zeroâ€”Knowledge </li><li><strong>åŸºäºåŠ å¯†ç»“æ„</strong>ï¼š Poseidon é‡‡ç”¨ Sponge ç»“æ„ï¼Œè¿™ç§ç»“æ„åœ¨å¯†ç å­¦ä¸­å¹¿æ³›åº”ç”¨äºæ„å»ºå“ˆå¸Œå‡½æ•°å’Œä¼ªéšæœºæ•°ç”Ÿæˆå™¨ã€‚Sponge ç»“æ„ç”±ä¸¤ä¸ªä¸»è¦é˜¶æ®µç»„æˆï¼šå¸æ”¶ï¼ˆabsorbï¼‰å’ŒæŒ¤å‡ºï¼ˆsqueezeï¼‰ã€‚</li><li><strong>é«˜æ•ˆæ€§</strong>ï¼š Poseidon çš„è®¾è®¡ç‰¹åˆ«æ³¨é‡è®¡ç®—æ•ˆç‡ï¼Œé€‚åˆåœ¨èµ„æºå—é™çš„ç¯å¢ƒä¸­è¿è¡Œï¼Œæ¯”å¦‚åŒºå—é“¾ä¸­çš„æ™ºèƒ½åˆçº¦æˆ–é›¶çŸ¥è¯†è¯æ˜çš„è¯æ˜ç”Ÿæˆè¿‡ç¨‹ã€‚</li><li><strong>çµæ´»æ€§</strong>ï¼š Poseidon å¯ä»¥æ ¹æ®ä¸åŒçš„åº”ç”¨éœ€æ±‚è¿›è¡Œé…ç½®ï¼Œæ”¯æŒä¸åŒçš„å®‰å…¨å‚æ•°å’Œæ€§èƒ½ä¼˜åŒ–ã€‚</li><li><strong>å®‰å…¨æ€§</strong>ï¼š Poseidon æä¾›äº†è¾ƒé«˜çš„å®‰å…¨æ€§ï¼ŒæŠ—ç¢°æ’æ”»å‡»ã€é¢„æ˜ å°„æ”»å‡»å’Œç¬¬äºŒé¢„æ˜ å°„æ”»å‡»ï¼Œæ»¡è¶³ç°ä»£å¯†ç å­¦çš„å®‰å…¨éœ€æ±‚ã€‚</li></ul><h3 id="4-4-2-Poseidon-çš„æ„é€ "><a href="#4-4-2-Poseidon-çš„æ„é€ " class="headerlink" title="4.4.2 Poseidon çš„æ„é€ "></a>4.4.2 Poseidon çš„æ„é€ </h3><p>Poseidon çš„å…·ä½“å®ç°æ¶‰åŠå¤æ‚çš„æ•°å­¦æ„é€ ï¼ŒåŒ…æ‹¬æœ‰é™åŸŸä¸Šçš„éçº¿æ€§å˜æ¢å’Œçº¿æ€§å±‚çš„ç»„åˆã€‚ä»¥ä¸‹æ˜¯ Poseidon çš„åŸºæœ¬æ„é€ æ¦‚è¿°ï¼š</p><ul><li><strong>çŠ¶æ€åˆå§‹åŒ–</strong>ï¼š Poseidon åˆå§‹åŒ–ä¸€ä¸ªçŠ¶æ€å‘é‡ï¼ŒçŠ¶æ€çš„å¤§å°é€šå¸¸å–å†³äºå®‰å…¨å‚æ•°å’Œå“ˆå¸Œè¾“å‡ºçš„é•¿åº¦ã€‚</li><li><strong>éçº¿æ€§å±‚ï¼ˆS-Boxï¼‰</strong>ï¼š Poseidon åœ¨çŠ¶æ€å‘é‡çš„æ¯ä¸ªå…ƒç´ ä¸Šåº”ç”¨ä¸€ä¸ªéçº¿æ€§å˜æ¢ï¼ˆé€šå¸¸æ˜¯æœ‰é™åŸŸä¸Šçš„å¹‚æ“ä½œï¼‰ï¼Œè¿™ç§å˜æ¢ç§°ä¸º S-Boxã€‚</li><li><strong>çº¿æ€§å±‚</strong>ï¼š Poseidon åº”ç”¨ä¸€ä¸ªçº¿æ€§å˜æ¢ï¼Œå°†çŠ¶æ€å‘é‡çš„å…ƒç´ æ··åˆã€‚é€šå¸¸ï¼Œè¿™ä¸ªçº¿æ€§å˜æ¢æ˜¯é€šè¿‡ä¸€ä¸ªçŸ©é˜µä¹˜æ³•å®ç°çš„ã€‚</li><li><strong>è½®å‡½æ•°ï¼ˆRound Functionï¼‰</strong>ï¼š éçº¿æ€§å±‚å’Œçº¿æ€§å±‚ç»„åˆæˆä¸€ä¸ªè½®å‡½æ•°ã€‚Poseidon å¤šæ¬¡åº”ç”¨è½®å‡½æ•°ï¼Œå°†è¾“å…¥æ•°æ®å……åˆ†æ··åˆï¼Œç¡®ä¿è¾“å‡ºå“ˆå¸Œå€¼çš„å®‰å…¨æ€§ã€‚</li><li><strong>Sponge ç»“æ„</strong>ï¼š Poseidon ä½¿ç”¨ Sponge ç»“æ„å¤„ç†è¾“å…¥æ•°æ®ã€‚é¦–å…ˆåœ¨å¸æ”¶é˜¶æ®µå°†è¾“å…¥æ•°æ®åˆ†å—å¤„ç†å¹¶æ›´æ–°çŠ¶æ€å‘é‡ï¼Œç„¶ååœ¨æŒ¤å‡ºé˜¶æ®µä»çŠ¶æ€å‘é‡ä¸­æå–å“ˆå¸Œå€¼ã€‚</li></ul><h3 id="4-4-3-Poseidon-çš„åº”ç”¨"><a href="#4-4-3-Poseidon-çš„åº”ç”¨" class="headerlink" title="4.4.3 Poseidon çš„åº”ç”¨"></a>4.4.3 Poseidon çš„åº”ç”¨</h3><ul><li><strong>åŒºå—é“¾</strong>ï¼š Poseidon å› å…¶é«˜æ•ˆæ€§å’Œå®‰å…¨æ€§ï¼Œè¢«è®¤ä¸ºæ˜¯åŒºå—é“¾ç³»ç»Ÿä¸­å®ç°é›¶çŸ¥è¯†è¯æ˜çš„ç†æƒ³å“ˆå¸Œå‡½æ•°ã€‚ä¾‹å¦‚ï¼ŒPoseidon å¯ä»¥ç”¨äºç”Ÿæˆ zk-SNARKs å’Œ zk-STARKs ä¸­çš„è¯æ˜å’ŒéªŒè¯è¿‡ç¨‹ã€‚</li><li><strong>éšç§ä¿æŠ¤</strong>ï¼š Poseidon å¯ä»¥ç”¨äºä¿æŠ¤æ•°æ®éšç§ï¼Œé€šè¿‡é›¶çŸ¥è¯†è¯æ˜ç¡®ä¿æ•°æ®çš„å®Œæ•´æ€§å’Œä¿å¯†æ€§è€Œæ— éœ€é€éœ²å®é™…æ•°æ®å†…å®¹ã€‚</li><li><strong>æ™ºèƒ½åˆçº¦</strong>ï¼š Poseidon å¯ä»¥é›†æˆåˆ°åŒºå—é“¾æ™ºèƒ½åˆçº¦ä¸­ï¼Œæä¾›é«˜æ•ˆçš„å“ˆå¸Œè®¡ç®—å’ŒéªŒè¯åŠŸèƒ½ï¼Œå¢å¼ºæ™ºèƒ½åˆçº¦çš„å®‰å…¨æ€§å’Œæ€§èƒ½ã€‚</li></ul><h1 id="5-æ€»ç»“ã€é‡è¦ã€‘"><a href="#5-æ€»ç»“ã€é‡è¦ã€‘" class="headerlink" title="5 æ€»ç»“ã€é‡è¦ã€‘"></a>5 æ€»ç»“ã€é‡è¦ã€‘</h1><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œå“ˆå¸Œç®—æ³• (Hash Algorithm) æ˜¯å°†ä»»æ„é•¿åº¦çš„æ•°æ®æ˜ å°„ä¸ºå›ºå®šé•¿åº¦æ•°æ®çš„ç®—æ³•ï¼Œä¹Ÿç§°ä¸ºæ¶ˆæ¯æ‘˜è¦ã€‚</p><p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå“ˆå¸Œç®—æ³•æœ‰ä¸¤ä¸ªç‰¹ç‚¹, </p><ul><li><p>ä¸€æ˜¯åŸå§‹æ•°æ®çš„ç»†å¾®å˜åŒ–ï¼ˆæ¯”å¦‚ä¸€ä¸ªä½ç¿»è½¬ï¼‰ä¼šå¯¼è‡´ç»“æœäº§ç”Ÿå·¨å¤§å·®è·ï¼›å…¥å˜å‡ºå˜</p></li><li><p>äºŒæ˜¯è¿ç®—è¿‡ç¨‹ä¸å¯é€†ï¼Œç†è®ºä¸Šæ— æ³•ä»ç»“æœè¿˜åŸè¾“å…¥æ•°æ®ã€‚ä¸å¯é€†å‘</p></li></ul><p>å› æ­¤ï¼Œå“ˆå¸Œç®—æ³•ä¸»è¦ç”¨äºæ•°æ®å®Œæ•´æ€§æ ¡éªŒå’ŒåŠ å¯†&#x2F;ç­¾åã€‚</p><p>å“ˆå¸Œç®—æ³•çš„å®‰å…¨æ€§å°±åœ¨äºç¢°æ’éš¾æ˜“åº¦ï¼Œå³å·²çŸ¥ç»“æœï¼Œæ„å»ºå‡ºå…·æœ‰ç›¸åŒç»“æœçš„è¾“å…¥æ•°æ®çš„éš¾æ˜“åº¦ã€‚</p><p>å¸¸è§çš„å“ˆå¸Œç®—æ³•æœ‰ MD5, SHA-1, SHA-2, SHA-3ã€‚</p><p>å…¶ä¸­ MD5 å·²ç»å¯ä»¥åœ¨ 2^21 å¤æ‚åº¦ï¼ˆåœ¨ä¸»æµæ™ºèƒ½æ‰‹æœºä¸Šåªéœ€30ç§’ï¼‰å†…å®Œæˆç¢°æ’ï¼Œ</p><p>è°·æ­Œä¹Ÿäº17å¹´æ—©äº›æ—¶å€™åœ¨ 2^64 å¤æ‚åº¦ï¼ˆçº¦ 110 GPUå¹´çš„è®¡ç®—é‡ï¼‰å†…å®Œæˆäº†ç¬¬ä¸€æ¬¡ SHA-1 ç¢°æ’ã€‚</p><p>è‡³æ­¤ï¼ŒMD5 å’Œ SHA-1 å·²ç»åœ¨å®‰å…¨é¢†åŸŸè¢«åºŸå¼ƒã€‚</p><p>å½“å‰é™¤äº† SHA-2ï¼ŒSHA-3 ä¹‹å¤–ï¼Œè¿˜æœ‰å¦å¤–ä¸€ä¸ªå“ˆå¸Œç®—æ³•ç³»åˆ—å¯ä¾›é€‰æ‹©ï¼Œé‚£å°±æ˜¯ <strong>BLAKEï¼ŒBLAKE2</strong> ç³»åˆ—</p><p>æ¯”å¸¸è§çš„ MD5ï¼ŒSHA-1ï¼ŒSHA-2ï¼ŒSHA-3 <strong>æ›´å¿«</strong>ï¼ŒåŒæ—¶æä¾›ä¸ä½äº SHA-3 çš„<strong>å®‰å…¨æ€§</strong>ã€‚</p><p>å¯¹äºåŒºå—é“¾ä¸­çš„é›¶çŸ¥è¯†è¯æ˜ç³»ç»Ÿï¼Œ<strong>Poseidon</strong> æ˜¯ç›®å‰åº”ç”¨çš„æœ€å¹¿æ³›çš„ç®—æ³•ã€‚</p><h1 id="6-é—¨é™å…±äº«ç§˜å¯†ã€å…¶ä»–ã€‘"><a href="#6-é—¨é™å…±äº«ç§˜å¯†ã€å…¶ä»–ã€‘" class="headerlink" title="6 é—¨é™å…±äº«ç§˜å¯†ã€å…¶ä»–ã€‘"></a>6 é—¨é™å…±äº«ç§˜å¯†ã€å…¶ä»–ã€‘</h1><p>é—¨é™ç§˜å¯†å…±äº«ï¼ˆThreshold Secret Sharingï¼‰æ˜¯ä¸€ç§å¯†ç å­¦æŠ€æœ¯ï¼Œ</p><p>ç”¨äºå°†ä¸€ä¸ªç§˜å¯†ä¿¡æ¯åˆ†å‰²æˆå¤šä¸ªéƒ¨åˆ†ï¼Œåˆ†å‘ç»™å¤šä¸ªå‚ä¸è€…ï¼Œåœ¨æ»¡è¶³ä¸€å®šé—¨é™æ¡ä»¶æ—¶æ‰èƒ½æ¢å¤å‡ºåŸå§‹ç§˜å¯†ã€‚</p><p>è¿™ç§æ–¹æ¡ˆæä¾›äº†åˆ†æ•£åŒ–çš„å®‰å…¨æ€§ï¼Œå³ä¸ä¾èµ–äºä»»ä½•å•ä¸ªå‚ä¸è€…çš„ä¿¡ä»»ï¼Œåªæœ‰åœ¨å¤šä¸ªå‚ä¸è€…åˆä½œçš„æƒ…å†µä¸‹æ‰èƒ½è·å–ç§˜å¯†ã€‚</p><p>ä»¥ä¸‹æ˜¯é—¨é™ç§˜å¯†å…±äº«æ–¹æ¡ˆçš„åŸºæœ¬åŸç†ï¼š</p><ol><li><strong>ç§˜å¯†åˆ†å‰²</strong>ï¼šå°†åŸå§‹ç§˜å¯†ä¿¡æ¯åˆ†å‰²æˆå¤šä¸ªéƒ¨åˆ†ï¼Œæ¯ä¸ªéƒ¨åˆ†ç§°ä¸ºå…±äº«ï¼ˆShareï¼‰ã€‚é€šå¸¸ä½¿ç”¨Shamirâ€™s Secret Sharingç®—æ³•æˆ–å…¶ä»–ç±»ä¼¼çš„æ–¹æ³•è¿›è¡Œåˆ†å‰²ã€‚è¿™äº›å…±äº«è¢«åˆ†å‘ç»™ä¸åŒçš„å‚ä¸è€…ï¼Œæ¯ä¸ªå‚ä¸è€…æŒæœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå…±äº«ã€‚</li><li><strong>é—¨é™æ¡ä»¶</strong>ï¼šæŒ‡å®šä¸€ä¸ªé—¨é™å€¼ï¼ˆThresholdï¼‰ï¼Œéœ€è¦è¾¾åˆ°è¯¥é—¨é™å€¼æ‰èƒ½é‡æ„ç§˜å¯†ã€‚ä¾‹å¦‚ï¼Œå°†é—¨é™å€¼è®¾ç½®ä¸º3ï¼Œæ„å‘³ç€è‡³å°‘éœ€è¦3ä¸ªæˆ–æ›´å¤šçš„å‚ä¸è€…åˆä½œæ‰èƒ½æ¢å¤ç§˜å¯†ã€‚</li><li><strong>ç§˜å¯†æ¢å¤</strong>ï¼šå½“å‚ä¸è€…åˆä½œæ—¶ï¼Œä»–ä»¬å¯ä»¥å°†å„è‡ªçš„å…±äº«åˆå¹¶ï¼Œé€šè¿‡ä¸€å®šçš„è®¡ç®—æ–¹æ³•æ¢å¤å‡ºåŸå§‹ç§˜å¯†ã€‚æ¢å¤ç§˜å¯†çš„è®¡ç®—é€šå¸¸ä½¿ç”¨æ’å€¼ç®—æ³•æˆ–å…¶ä»–æ¢å¤ç®—æ³•ï¼Œæ ¹æ®æ”¶é›†åˆ°çš„å…±äº«è¿›è¡Œè®¡ç®—ã€‚</li></ol><p>é—¨é™ç§˜å¯†å…±äº«æ–¹æ¡ˆçš„ä¼˜åŠ¿åœ¨äºåˆ†æ•£åŒ–çš„å®‰å…¨æ€§ï¼Œå³æ²¡æœ‰å•ç‚¹æ•…éšœæˆ–å•ä¸ªå‚ä¸è€…èƒ½å¤Ÿè·å–å®Œæ•´çš„ç§˜å¯†ã€‚å³ä½¿éƒ¨åˆ†å‚ä¸è€…å—åˆ°æ”»å‡»æˆ–æ³„éœ²ï¼Œåªè¦é—¨é™æ¡ä»¶å¾—åˆ°æ»¡è¶³ï¼Œç§˜å¯†ä»ç„¶æ˜¯å®‰å…¨çš„ã€‚è¿™ç§æ–¹æ¡ˆåœ¨è®¸å¤šé¢†åŸŸä¸­æœ‰å¹¿æ³›åº”ç”¨ï¼Œå¦‚å¤šæ–¹èº«ä»½éªŒè¯ã€å®‰å…¨å¤šæ–¹è®¡ç®—ã€å¯†ç å­¦ç­‰ã€‚</p><h2 id="6-1-äº‘ç«¯å¯å¹²æ‰°æŠ—ç§˜é’¥ä¸¢å¤±çš„æ–¹æ¡ˆï¼ˆSeekåšçš„ï¼‰"><a href="#6-1-äº‘ç«¯å¯å¹²æ‰°æŠ—ç§˜é’¥ä¸¢å¤±çš„æ–¹æ¡ˆï¼ˆSeekåšçš„ï¼‰" class="headerlink" title="6.1 äº‘ç«¯å¯å¹²æ‰°æŠ—ç§˜é’¥ä¸¢å¤±çš„æ–¹æ¡ˆï¼ˆSeekåšçš„ï¼‰"></a>6.1 äº‘ç«¯å¯å¹²æ‰°æŠ—ç§˜é’¥ä¸¢å¤±çš„æ–¹æ¡ˆï¼ˆSeekåšçš„ï¼‰</h2><p><img src="/img/web3/%E4%BA%91%E7%AB%AF%E5%8F%AF%E5%B9%B2%E6%89%B0%E6%8A%97%E7%A7%98%E9%92%A5%E4%B8%A2%E5%A4%B1%E7%9A%84%E6%96%B9%E6%A1%88.jpg" alt="äº‘ç«¯å¯å¹²æ‰°æŠ—ç§˜é’¥ä¸¢å¤±çš„æ–¹æ¡ˆ"></p><p>å®ç°é€»è¾‘</p><p>ç”¨åˆ°äº†é—¨é™å…±äº«ç§˜å¯†ã€å¼‚æˆ–ç®—æ³•</p><p>ç°åœ¨æœ‰ä¸€ä¸ªäº‘ç«¯æœåŠ¡cloud-server</p><p>æœ¬åœ°é’±åŒ…é‡Œé¢çš„SDKé‡Œé¢æœ‰ä¸€ä¸ªç§˜å¯†ï¼ˆæˆ–è€…ç§é’¥ï¼‰ï¼Œæˆ‘ç°åœ¨ç›®çš„æ˜¯æˆ‘ä¸¢äº†è¿™ä¸ªç§˜é’¥æˆ‘èƒ½æ‰¾å›æ¥ï¼Œä½†æˆ‘åˆæ€•ä½ ä»¬ä½œæ¶ï¼Œæˆ‘å°±è®¾è®¡äº†ä¸€ä¸ªè¿™ä¸ªæ–¹æ¡ˆã€‚</p><p>é¦–å…ˆæˆ‘æœ¬åœ°ç”Ÿæˆä¸€ä¸ªå¤§éšæœºæ•°random numberï¼Œ</p><p>æˆ‘ç°åœ¨æ‹¿æˆ‘çš„è¿™ä¸ªç§˜å¯†+random numberåšä¸€æ¬¡å¼‚æˆ–ç®—æ³•å¾—åˆ°ä¸€ä¸ªvalue </p><p>ç„¶åæŠŠè¿™ä¸ªrandom numberé€šè¿‡APIä¸Šä¼ åˆ°äº‘ç«¯å»ï¼ˆåŠ å¯†åä¸Šä¼ çš„ï¼ŒåŠ å¯†æ–¹å¼æš‚ä¸ç®¡ï¼‰</p><p>ç„¶åå°†è¿™ä¸ªvalue å»è¿›è¡Œé—¨é™å…±äº«ç§˜å¯†æ‹†åˆ†æˆnä¸ªsharnds ,å‡è®¾n&#x3D;6,k&#x3D;3</p><p>å‡è®¾å…¶ä»–ä¸¢å¤±äº†ï¼Œåªå¾—åˆ°3ä¸ªï¼ŒæŠŠè¿™3ä¸ªè¿›è¡Œé€†é—¨é™è§£å¯†ï¼Œå¯ä»¥å¾—åˆ°è¿™ä¸ªvalueï¼Œ</p><p>æ‹¿åˆ°valueä¹‹åï¼Œå†å»è¯·æ±‚äº‘ç«¯ï¼ŒæŠŠè¿™ä¸ªrandom numberæ‹¿ä¸‹æ¥ï¼Œ</p><p>è¿™ä¸ªæ—¶å€™æ‰‹ä¸Šå°±æœ‰value + random number è¿›è¡Œä¸€æ¬¡é€†å¼‚æˆ–è¿ç®—å¾—åˆ°ä½ çš„ç§˜é’¥</p>]]></content>
    
    
    <categories>
      
      <category>blockChain</category>
      
    </categories>
    
    
    <tags>
      
      <tag>block</tag>
      
      <tag>æ¦‚å¿µ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>02 é’±åŒ…</title>
    <link href="/2024/05/19/02%E9%92%B1%E5%8C%85/"/>
    <url>/2024/05/19/02%E9%92%B1%E5%8C%85/</url>
    
    <content type="html"><![CDATA[<h1 id="é’±åŒ…"><a href="#é’±åŒ…" class="headerlink" title="é’±åŒ…"></a>é’±åŒ…</h1><h1 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1.æ¦‚è¿°"></a>1.æ¦‚è¿°</h1><p>é’±åŒ…æ€ä¹ˆåˆ†ç±»ï¼Ÿæœ¬è´¨æ˜¯ç§é’¥çš„ç®¡ç†æ–¹å¼çš„ä¸åŒæ¥åŒºåˆ†çš„</p><h1 id="2-é’±åŒ…åˆ†ç±»"><a href="#2-é’±åŒ…åˆ†ç±»" class="headerlink" title="2. é’±åŒ…åˆ†ç±»"></a>2. é’±åŒ…åˆ†ç±»</h1><ul><li><strong>ä¸­å¿ƒåŒ–é’±åŒ…</strong>ï¼šé’±åŒ…ç§é’¥ä¸€èˆ¬ç®¡ç†åœ¨<strong>ä¸­å¿ƒåŒ–æœåŠ¡å™¨</strong>ä¸Šï¼Œä»£è¡¨é¡¹ç›®ä¸ºäº¤æ˜“æ‰€é’±åŒ…ï¼›ä¾‹å¦‚ Binance äº¤æ˜“æ‰€é’±åŒ…ï¼Œokx äº¤æ˜“æ‰€é’±åŒ…å’Œ bybit äº¤æ˜“æ‰€é’±åŒ…ç­‰1ã€‚</li><li><strong>å»ä¸­å¿ƒåŒ–é’±åŒ…</strong>(ç¡®å®šæ€§åˆ†å±‚é’±åŒ…)ï¼šé’±åŒ…ç§é’¥ä¸€èˆ¬ç®¡ç†åœ¨<strong>ç”¨æˆ·</strong>çš„è®¾å¤‡ä¸Šï¼Œä»£è¡¨é¡¹ç›®ä¸º TP, ImToken, MetaMask ç­‰ï¼›</li><li><strong>ç¡¬ä»¶é’±åŒ…</strong>ï¼šé’±åŒ…ç§é’¥ç®¡ç†åœ¨ç¦»çº¿çš„<strong>ç¡¬ä»¶</strong>è®¾å¤‡ä¸Šï¼Œä»£è¡¨é¡¹ç›® ledger, onekey ç­‰ã€‚</li><li><strong>äº¤æ˜“æ‰€ Web3 é’±åŒ…</strong>ï¼šä¸€èˆ¬çš„äº¤æ˜“æ‰€ Web3 é’±åŒ…é›†æˆäº†ï¼Œ<strong>ä¸­å¿ƒåŒ–é’±åŒ…</strong>ï¼Œ<strong>å»ä¸­å¿ƒåŒ–é’±åŒ…</strong>(ç¡®å®šæ€§åˆ†å±‚é’±åŒ…)å’Œ<strong>ç¡¬ä»¶é’±åŒ…</strong>çš„åŠŸèƒ½ã€‚</li><li><strong>æ‰˜ç®¡é’±åŒ…</strong>ï¼šæ‰˜ç®¡åœ¨ç¬¬ä¸‰æ–¹æœåŠ¡çš„é’±åŒ…ï¼Œä¸€èˆ¬ä¸º MPC ç®—æ³•ï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ‰ä¸€ä¸ªå¯†é’¥ç‰‡ï¼Œç½‘ç»œä¸­æ²¡æœ‰å®Œæ•´çš„ç§é’¥å‡ºç°è¿‡, N-M çš„ç­¾åæ–¹å¼ï¼Œæ€»èŠ‚ç‚¹ä¸º N ä¸ªï¼ŒM ä¸ªèŠ‚ç‚¹ç­¾åäº¤æ˜“å³æœ‰æ•ˆã€‚éšç§ä¿æŠ¤ã€åˆ†å¸ƒå¼è®¡ç®—ã€å®‰å…¨æ€§2</li></ul><blockquote><p>MPCï¼ˆSecure Multiparty Computationï¼‰ç®—æ³•æ˜¯ä¸€ç§åŠ å¯†å’Œéšç§ä¿æŠ¤æŠ€æœ¯ï¼Œç”¨äºåœ¨å¤šä¸ªå‚ä¸æ–¹ä¹‹é—´è¿›è¡Œè®¡ç®—ï¼ŒåŒæ—¶ä¿æŒå„æ–¹è¾“å…¥çš„éšç§æ€§ã€‚MPC å…è®¸å¤šä¸ªå‚ä¸æ–¹åœ¨ä¸å…¬å¼€å½¼æ­¤è¾“å…¥ä¿¡æ¯çš„æƒ…å†µä¸‹æ‰§è¡Œè®¡ç®—ï¼Œå¹¶è·å¾—è®¡ç®—ç»“æœã€‚</p></blockquote><ul><li><strong>å¤šç­¾é’±åŒ…</strong>ï¼šEVM é“¾ä¸€èˆ¬ä½¿ç”¨ gnosis safe å¤šç­¾ï¼Œå…¶ä»–ä½¿ç”¨ä¼ ç»Ÿå¯†ç å­¦æ–¹å¼å¤šç­¾</li></ul><blockquote><p>å¤šç­¾é’±åŒ…ï¼ˆMultisignature Walletï¼‰ï¼Œä¹Ÿè¢«ç§°ä¸ºå¤šé‡ç­¾åé’±åŒ…ï¼Œæ˜¯ä¸€ç§åŠ å¼ºå®‰å…¨æ€§çš„åŠ å¯†è´§å¸é’±åŒ…ã€‚ä¸ä¼ ç»Ÿçš„å•ç­¾åé’±åŒ…ä¸åŒï¼Œå¤šç­¾é’±åŒ…è¦æ±‚å¤šä¸ªå¯†é’¥æŒæœ‰äººå…±åŒå‚ä¸æ‰¹å‡†äº¤æ˜“ï¼Œä»¥ä¾¿è¿›è¡Œèµ„é‡‘çš„è½¬ç§»æˆ–æ“ä½œã€‚</p><p>å¤šä¸ªå¯†é’¥æŒæœ‰äººï¼šå¤šç­¾é’±åŒ…æ¶‰åŠå¤šä¸ªå¯†é’¥ï¼Œé€šå¸¸æ˜¯ç”±ä¸åŒçš„ä¸ªä½“ã€ç»„ç»‡æˆ–è®¾å¤‡æ§åˆ¶ã€‚è¿™äº›å¯†é’¥æŒæœ‰äººè¢«ç§°ä¸ºå…±åŒç­¾åè€…ï¼ˆcosignersï¼‰ï¼Œå¹¶ä¸”éœ€è¦è¾¾æˆå…±è¯†æ‰èƒ½æ‰§è¡Œäº¤æ˜“.</p><p>ç­¾åé˜ˆå€¼ï¼šå¤šç­¾é’±åŒ…é€šè¿‡è®¾ç½®ç­¾åé˜ˆå€¼ï¼ˆSignature Thresholdï¼‰æ¥ç¡®å®šéœ€è¦å¤šå°‘ä¸ªå…±åŒç­¾åè€…æ‰¹å‡†äº¤æ˜“ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª2-of-3çš„å¤šç­¾é’±åŒ…éœ€è¦è‡³å°‘ä¸¤ä¸ªå…±åŒç­¾åè€…çš„æ‰¹å‡†æ‰èƒ½æ‰§è¡Œäº¤æ˜“ã€‚</p></blockquote><ul><li><strong>MPCé’±åŒ…</strong>ï¼šé‡‡ç”¨ç§˜å¯†å…±äº«æŠ€æœ¯æ¥ç®¡ç†å’Œç”ŸæˆåŠ å¯†è´§å¸ç§é’¥çš„é’±åŒ…ã€‚</li><li><strong>ç¤¾äº¤æ¢å¤é’±åŒ…</strong>: å¯†é’¥åˆ†ç‰‡å¤‡ä»½æ¢å¤ï¼Œå®ˆæŠ¤è€…æ¢å¤ï¼Œ</li><li>EVM é“¾ AA é’±åŒ…ï¼šERC4337 åè®®ç‹¬æœ‰ç‰¹æ€§ï¼Œæä¾›è´¦æˆ·æŠ½è±¡åŠŸèƒ½ï¼Œå®ç°æ™ºèƒ½åˆçº¦çº§åˆ«çš„é’±åŒ…æœåŠ¡ã€‚</li></ul><blockquote><p>åŒºåˆ«åœ¨äºç§é’¥æ”¾åœ¨å“ªé‡Œï¼Ÿ</p></blockquote><blockquote><p>äº¤æ˜“æ‰€é’±åŒ…ç§é’¥æ˜¯åœ¨äº¤æ˜“æ‰€æ‰‹ä¸Šï¼Œå»ä¸­å¿ƒåŒ–é’±åŒ…ç§é’¥æ˜¯åœ¨è‡ªå·±çš„æ‰‹ä¸Š</p></blockquote><blockquote><p>åŠ©è®°è¯ï¼šå¯¹åº”ä¸€ä¸ªrootkeyï¼Œä¸€ä¸ªrootkeyå¯ä»¥å¯¼å‡ºä¸€ä¸ªä¸€ä¸ªçš„childkeyï¼Œchildkeyå°±ä¼šå¯¹åº”ä¸€ä¸ªpubkeyï¼Œpubkeyä¼šå¯¹åº”ç”Ÿæˆä¸€ä¸ªåœ°å€BTP44åè®®</p></blockquote><h1 id="3-ä¸­å¿ƒåŒ–é’±åŒ…"><a href="#3-ä¸­å¿ƒåŒ–é’±åŒ…" class="headerlink" title="3.ä¸­å¿ƒåŒ–é’±åŒ…"></a>3.ä¸­å¿ƒåŒ–é’±åŒ…</h1><p>ä¸»è¦åŠŸèƒ½æ˜¯æ‰¹é‡åœ°å€ç”Ÿæˆã€å……å€¼ã€æç°ã€å½’é›†ã€è½¬å†·ã€å†·è½¬çƒ­ã€å›æ»šã€é’±åŒ…é£æ§ã€é’±åŒ…å¯¹è´¦å™¨</p><h2 id="3-1-ä¸­å¿ƒåŒ–é’±åŒ…æ¶æ„å›¾"><a href="#3-1-ä¸­å¿ƒåŒ–é’±åŒ…æ¶æ„å›¾" class="headerlink" title="3.1. ä¸­å¿ƒåŒ–é’±åŒ…æ¶æ„å›¾"></a>3.1. ä¸­å¿ƒåŒ–é’±åŒ…æ¶æ„å›¾</h2><p><img src="/img/web3/wallet1.png" alt="wallte1"></p><p>äº¤æ˜“æ‰€ç§é’¥ç®¡ç†æ–¹å¼ï¼šä¸€èˆ¬ç®¡ç†åœ¨ä¸€ä¸‹4ç§æ–¹å¼</p><p>Tee ç¯å¢ƒï¼ŒTeeæ˜¯ä¸€ä¸ªå®‰å…¨å¯æ‰§è¡Œç¯å¢ƒï¼ŒTee ç¯å¢ƒè™½ç„¶æ˜¯ä¸€ä¸ªå®‰å…¨çš„æ‰§è¡Œç¯å¢ƒï¼Œä½†æ˜¯ç§é’¥ä¹Ÿæ˜¯åŠ å¯†ä¹‹åå­˜å‚¨åœ¨è¿™ä¸ªç¯å¢ƒçš„æ•°æ®åº“æˆ–è€…æ–‡ä»¶é‡Œé¢ï¼Œæ¯æ¬¡ç­¾åä¹Ÿè¦åœ¨è¿™ä¸ªç¯å¢ƒä¸­è§£å¯†ç§é’¥è¿›è¡Œç­¾åï¼Œç§é’¥æš´éœ²çš„é£é™©ä¹Ÿå¾ˆå¤§ï¼Œå›¢é˜Ÿæˆå‘˜æƒ³æ‹¿åˆ°ç§é’¥ä¹Ÿå¾ˆå®¹æ˜“ï¼Œåªéœ€è¦ç­¾åå‰ä¼ äººç§é’¥æ˜¯æ‰“ä¸€ä¸ªæ—¥å¿—å°±è¡Œã€‚</p><p>cloud HSMï¼šä¸€ç§äº‘ç«¯ç®¡ç†æ–¹å¼,æœ€å®‰å…¨å’Œæœ€ä¸“ä¸šçš„åšæ³•æ˜¯ä½¿ç”¨ cloadHSM æˆ–è€…å¤šèŠ‚ç‚¹å¤‡ä»½çš„å°å‹ç­¾åæœºï¼Œç§é’¥ä¸ä¼šç¦»å¼€è®¾å¤‡ï¼Œéœ€è¦ç­¾åçš„æ—¶å€™ï¼Œä¼ å…¥å¾…ç­¾åçš„æŠ¥æ–‡ï¼ŒcloadHSM æˆ–è€…å°å‹ç­¾åæœºç­¾åç»“æŸä¹‹åè¿”å›ç­¾åæŠ¥æ–‡ï¼Œç„¶åæ•´ç†ç­¾åäº¤æ˜“æŠ¥æ–‡å‘é€åˆ°åŒºå—é“¾ç½‘ç»œã€‚</p><p>KMSï¼šå¾ˆå°‘ç”¨äº†</p><p>å°å‹æœº:</p><p>ä¸ç®¡æ˜¯ä½¿ç”¨æ•°æ®åº“ã€æ•°æ®æ–‡ä»¶ã€ KMSã€TEEï¼Œè¿˜æ˜¯ CloadHSMï¼Œå®‰å…¨çº§åˆ«ä¹Ÿæ˜¯ç›¸å¯¹çš„ï¼Œæœ‰ä¸€å¥è¯è¯´å¾—å¥½: â€œ<strong>å¤–è´¼æ˜“æŒ¡ï¼Œå®¶è´¼éš¾é˜²</strong>â€œï¼Œè¿™å¥è¯ç”¨åœ¨é’±åŒ…ç®¡ç†ä¸ŠçœŸçš„æ˜¯å¤ªæ­£ç¡®äº†ã€‚ä¸ç®¡ç”¨ä»€ä¹ˆæ–¹æ¡ˆï¼Œå³ä½¿æ˜¯ CloadHSM æˆ–è€…å°å‹æœºæ–¹æ¡ˆï¼Œâ€å®¶è´¼ä¹Ÿæ˜¯å¾ˆéš¾é˜²â€ï¼Œå®¶è´¼å®Œå…¨å¯ä»¥æ¨¡æ‹Ÿä¸€ç¬”åˆæ³•çš„äº¤æ˜“è®© CloadHSM æˆ–å°å‹æœºæ–¹æ¡ˆç­¾åï¼Œç„¶åæŠŠé’±ç›—èµ°ã€‚ä¸ºäº†é˜²æ­¢å®¶è´¼ï¼Œæ­£å¸¸çš„äº¤æ˜“æ‰€é’±åŒ…éƒ½è¦åšé“¾è·¯é£æ§ä½“ç³»ã€‚</p><p>ä»ä¸Šé¢çš„æ¶æ„å›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå¯¹äºäº¤æ˜“æ‰€é’±åŒ…æ¥è¯´ï¼Œé€šå¸¸æœ‰è¿™äº›ä¸šåŠ¡æµç¨‹</p><ul><li>æ‰¹é‡åœ°å€ç”Ÿæˆ</li><li>å……å€¼</li><li>æç°</li><li>å½’é›†</li><li>çƒ­è½¬å†·</li><li>å†·è½¬çƒ­</li><li>é“¾è·¯é£æ§</li></ul><p>å¾ˆå¤šå…¬å¸é’±åŒ…å¼€å‘ï¼Œä¸€èˆ¬å°±æ˜¯ä¸€ä¸ªäººè´Ÿè´£æ•´æ¡é“¾é’±åŒ…çš„è°ƒç ”(ç¦»çº¿åœ°å€ç”Ÿæˆï¼Œç¦»çº¿äº¤æ˜“ç­¾åå’Œæ‰«å—å‡ºå…¥é‡‘)ï¼Œå¼€å‘ï¼ˆå«å……å€¼ï¼Œæç°ï¼Œå½’é›†ï¼Œçƒ­è½¬å†·ç­‰åŠŸèƒ½å¼€å‘ï¼Œç”šè‡³å«é“¾è·¯é£æ§çš„ä¸€éƒ¨åˆ†ä»£ç ï¼‰å’Œæµ‹è¯•ã€‚å½“ç„¶ï¼Œä¹Ÿæœ‰çš„å…¬å¸åˆ†ä¸ºä¸‰åˆ°å››å›¢é˜Ÿï¼Œè°ƒç ”å’Œç¦»çº¿ç­¾æ˜¯ä¸€ä¸ªå›¢é˜Ÿï¼Œæ‰«é“¾å‡ºå…¥é‡‘ï¼Œå½’é›†å’Œè½¬å†·ç­‰åŠŸèƒ½æ˜¯ä¸€ä¸ªå›¢é˜Ÿï¼Œé“¾è·¯é£æ§æ˜¯ä¸€ä¸ªå›¢é˜Ÿï¼Œæµ‹è¯•æ˜¯ä¸€ä¸ªå›¢é˜Ÿã€‚ä¸ç®¡æ€ä¹ˆåˆ†ï¼Œè¿ç»´å’Œå¼€å‘æ˜¯éš”ç¦»çš„ï¼Œè¿™æ ·åšæ‰èƒ½åšå¤§é™åº¦åšåˆ°äººä¸ºé£æ§ã€‚</p><p>æ€»ç»“ä¸€ä¸‹ï¼š</p><ol><li><strong>ç§é’¥å­˜å‚¨</strong>ï¼šä¸­å¿ƒåŒ–é’±åŒ…çš„ç§é’¥é€šå¸¸å­˜å‚¨åœ¨ä¸­å¿ƒæœåŠ¡å™¨ä¸Šï¼Œç”±æœåŠ¡æä¾›è€…ç®¡ç†ã€‚ç”¨æˆ·ä¸ç›´æ¥æ§åˆ¶ç§é’¥ï¼Œè€Œæ˜¯é€šè¿‡è´¦æˆ·å’Œå¯†ç æ¥è®¿é—®è‡ªå·±çš„èµ„äº§ã€‚</li><li><strong>åŠ å¯†æŠ€æœ¯</strong>ï¼šä¸ºäº†ä¿æŠ¤ç§é’¥ï¼Œä¸­å¿ƒåŒ–é’±åŒ…æœåŠ¡æä¾›è€…ä¼šé‡‡ç”¨å„ç§åŠ å¯†æŠ€æœ¯ï¼Œå¦‚DESåŠ å¯†ã€AESåŠ å¯†ç­‰ï¼Œå°†ç§é’¥åŠ å¯†åå­˜å‚¨ã€‚</li><li><strong>ç­¾åæœºåˆ¶</strong>ï¼šå½“ç”¨æˆ·å‘èµ·äº¤æ˜“æ—¶ï¼Œé’±åŒ…æœåŠ¡ä¼šè§£å¯†ç§é’¥ï¼Œä½¿ç”¨ç§é’¥å¯¹äº¤æ˜“è¿›è¡Œç­¾åï¼Œç„¶åå°†ç­¾ååçš„äº¤æ˜“å‘é€åˆ°åŒºå—é“¾ç½‘ç»œã€‚</li></ol><h2 id="3-2-ä¸­å¿ƒåŒ–é’±åŒ…ä¸šåŠ¡ç»†èŠ‚æµç¨‹"><a href="#3-2-ä¸­å¿ƒåŒ–é’±åŒ…ä¸šåŠ¡ç»†èŠ‚æµç¨‹" class="headerlink" title="3.2. ä¸­å¿ƒåŒ–é’±åŒ…ä¸šåŠ¡ç»†èŠ‚æµç¨‹"></a>3.2. ä¸­å¿ƒåŒ–é’±åŒ…ä¸šåŠ¡ç»†èŠ‚æµç¨‹</h2><ul><li>æ‰¹é‡åœ°å€ç”Ÿæˆï¼šäº¤æ˜“æ‰€é’±åŒ…ä¸ºäº†æ€§èƒ½å’Œå¿«é€Ÿå“åº”ç”¨æˆ·ï¼Œæ‰€æœ‰äº¤æ˜“æ‰€é’±åŒ…éƒ½ä¼šæœ‰ä¸€ä¸ªåœ°å€æ± ï¼Œåœ°å€æ± é‡Œé¢æ¯æ¬¡ç”Ÿæˆæˆåƒä¸Šä¸‡çš„åœ°å€ï¼Œå½“ç”¨æˆ·æ³¨å†Œåˆ°äº¤æ˜“æ‰€çš„æ—¶ç›´æ¥ç»™ç”¨æˆ·<strong>åˆ†é…</strong>åœ°å€ï¼Œè€Œä¸æ˜¯å»<strong>ç”Ÿæˆ</strong>ï¼›å½“åœ°å€æ± é‡Œé¢çš„åœ°å€å°‘äºä¸€å®šæ•°é‡æ—¶å°±ä¼šå»æ–°ç”Ÿæˆä¸€æ‰¹ã€‚æ‰¹é‡åœ°å€ç”Ÿæˆï¼šäº¤æ˜“æ‰€ä¸€æ¬¡ä¼šç”Ÿæˆ10Wä¸ªåœ°å€ï¼Œåœ°å€å¯¹åº”çš„ç§é’¥ä¼šå­˜åˆ°äº¤æ˜“æ‰€çš„ä¸­å¿ƒåŒ–çš„æ•°æ®åº“é‡Œé¢å»ï¼Œå½“æœ‰ç”¨æˆ·åœ¨äº¤æ˜“æ‰€æ³¨å†Œæ—¶ï¼Œä¼šå»ç»™ç”¨æˆ·åˆ†é…ä¸€ä¸ªåœ°å€ã€‚åœ°å€ç”Ÿæˆï¼šç”Ÿæˆprivkeyâ€”-pubkeyâ€”addressï¼Œ</li></ul><p><img src="/img/web3/batch.png" alt="batch"></p><ul><li>å……å€¼ï¼šé’±åŒ…æœ‰ä¸ªç¨‹åºï¼Œä¸€ç›´åœ¨æ‰«é“¾(scan block ),parse to(è§£æäº¤æ˜“)ï¼Œç„¶åå‘ç°toåœ°å€å¦‚æœæ˜¯äº¤æ˜“æ‰€ç³»ç»Ÿä¸­åœ°å€ï¼ˆäº¤æ˜“æ‰€åœ°å€åˆ†ç”¨æˆ·åœ°å€å’Œç³»ç»Ÿåœ°å€ï¼‰å¦‚æœå‘ç°æ˜¯ç”¨æˆ·åœ°å€ï¼Œå°±è®¤å®šè¿™æ˜¯ä¸€ç¬”å……å€¼ï¼Œé‚£äº¤æ˜“æ‰€å°±ä¼šç»™ç”¨æˆ·ä¸Šè´¦ï¼ˆå…¥é‡‘ï¼‰ï¼Œä¸Šè´¦ä¹‹åæŠŠé€šçŸ¥ç»™åˆ°äº¤æ˜“æ‰€å¯¹ç«¯ï¼ˆäº¤æ˜“æ‰€ä¸šåŠ¡å±‚ï¼‰ï¼Œå……å€¼ï¼šæ‰«é“¾æœåŠ¡æ‰«åŒºå—é“¾ï¼Œè§£æåŒºå—é‡Œé¢çš„äº¤æ˜“æ•°æ®ï¼Œå½“äº¤æ˜“æ•°æ®é‡Œé¢çš„ to åœ°å€æ˜¯ç³»ç»Ÿé‡Œçš„ç”¨æˆ·åœ°å€æ—¶ï¼Œå°±è¯´æ˜æœ‰ç”¨æˆ·å……å€¼ï¼›å……å€¼è¿™ä¸ªè¿‡ç¨‹é™¤äº†é’±åŒ…å……å€¼æ‰«å—ä¹‹å¤–ï¼Œè¿˜ä¼šå’Œé£æ§ä¸€èµ·è”åˆï¼Œåªæœ‰é£æ§ç³»ç»Ÿå’Œé’±åŒ…éƒ½è®¤å¯è¿™ç¬”äº¤æ˜“ï¼Œæ‰ä¼šé€šçŸ¥ä¸šåŠ¡å±‚ï¼›è§£æçš„æ—¶å€™éœ€è¦æ³¨æ„æœ‰äººæ„é€ æ¶æ„äº¤æ˜“ï¼Œæœ‰çš„é“¾æ˜¯å¯ä»¥æ„é€ äº¤æ˜“æ”»å‡»çš„ã€‚</li></ul><p><img src="/img/web3/top-up.png" alt="top-up"></p><ul><li>æç°:  å½“ä¸šåŠ¡å±‚å‘èµ·ä¸€ç¬”æäº¤äº¤æ˜“ï¼Œä¸šåŠ¡å±‚çš„äº¤æ˜“ä¼šè¿›å…¥åˆ°ä¸šåŠ¡å±‚æ•°æ®åº“ï¼Œä¸šåŠ¡å±‚æ‰«åº“ä¹‹åæä¸€ç¬”äº¤æ˜“åˆ°é’±åŒ…â€“&gt;é’±åŒ…å¯¹è¿™ä¸ªäº¤æ˜“è¿›è¡Œç­¾åï¼Œå»è¯·æ±‚å¯¹åº”çš„Cloud HSMæˆ–è€…TEEç¯å¢ƒçš„ç§é’¥æˆ–è€…å°å‹æœºé‡Œé¢çš„ç§é’¥è¿›è¡Œç­¾å-&gt;ç­¾åå›æ¥äº†ä¹‹åå†ç»„ç»‡äº†ä¹‹åæŠŠäº¤æ˜“å‘é€åˆ°åŒºå—é“¾ç½‘ç»œä¸Šã€‚è¿™ç¬”äº¤æ˜“çš„fromåœ°å€å‡ºæ¥çš„åœ°å€ä¸ä¸€å®šæ˜¯ä½ çš„åœ°å€ï¼Œè€Œæ˜¯äº¤æ˜“æ‰€çš„å½’é›†åœ°å€ï¼Œè¿™ä¸ªæ—¶å€™ä½ çš„syne blockæ‰«å—çš„æœºåˆ¶è¿˜ä¼šä¸åœåœ°æ‰«å—ï¼Œæ‰«å—è§£æTxï¼Œè§£æTxå‡ºæ¥ä¹‹åå‘ç°æˆ‘ä»¬çš„fromåœ°å€å’Œæˆ‘ä»¬çš„ç³»ç»Ÿåœ°å€æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘ä»¬å°±è®¤å®šä¸ºè¿™ç¬”äº¤æ˜“æ˜¯ä¸€ç¬”æç°äº¤æ˜“ï¼Œç„¶åæç°æˆåŠŸï¼Œå†é€šçŸ¥äº¤æ˜“å±‚æˆåŠŸäº†ï¼Œç„¶åå‘Šè¯‰ç”¨æˆ·ä½ æç°æˆåŠŸäº†ã€‚<ul><li>å®¢æˆ·ç«¯ç”¨æˆ·è¾“å…¥è¦æç°çš„åœ°å€ï¼Œé‡‘é¢ï¼Œé“¾ï¼›è¿™äº›æ•°æ®å°†è¿›å…¥äº¤æ˜“æ‰€ä¸šåŠ¡å±‚ï¼Œä¸šåŠ¡å±‚æäº¤æ•°æ®ç»™é’±åŒ…ï¼Œå¹¶å»ºç«‹ç­¾åå‚æ•°é£æ§ï¼›é’±åŒ…æ‹¿åˆ°äº¤æ˜“æ•°æ®ä¹‹åå…ˆéªŒè¯æ˜¯å¦èƒ½è¿‡é£æ§ï¼Œæ²¡æœ‰é—®é¢˜çš„å»é“¾ä¸Šè·å–ç­¾åå‚æ•°ï¼Œç»„ç»‡äº¤æ˜“ä¹‹åç”Ÿæˆå¾…ç­¾åçš„äº¤æ˜“æŠ¥æ–‡ï¼Œå°†äº¤æ˜“æŠ¥æ–‡é€’ç»™ç­¾åæœºï¼Œç­¾åæœºç­¾åä¹‹åè¿”å›ç­¾åçš„äº¤æ˜“æŠ¥æ–‡ï¼Œé’±åŒ…æœåŠ¡ç»„ç»‡äº¤æ˜“ä¹‹åå‘é€åˆ°åŒºå—é“¾ç½‘ç»œã€‚äº¤æ˜“å‘é€å®Œæˆä¹‹åï¼Œæ‰«é“¾æœåŠ¡æ‰«åˆ°è¿™ç¬”äº¤æ˜“ä¹‹åï¼ŒéªŒè¯é£æ§ï¼Œé€šè¿‡ä¹‹åé€šçŸ¥ä¸šåŠ¡å±‚æç°æˆåŠŸï¼Œä¸ŠæŠ¥äº¤æ˜“ Hash ç­‰ä¿¡æ¯ã€‚</li></ul></li></ul><p><img src="/img/web3/withdraw.png" alt="withdraw"></p><ul><li><p>å½’é›†ï¼šå½’é›†åŠŸèƒ½æ˜¯æŠŠç”¨æˆ·åœ°å€é‡Œé¢çš„èµ„é‡‘å…¨éƒ¨å½’é›†åˆ°ä¸€ä¸ªè§„æ•´åœ°å€é‡Œé¢å»ï¼Œå½’é›†æ˜¯ä¸€ä¸ªæ‰¹é‡è½¬è´¦çš„è¿‡ç¨‹ï¼Œå’Œæç°çš„é€»è¾‘æ¯”è¾ƒç±»ä¼¼ï¼Œå°±æ˜¯ä¸šåŠ¡ç±»åˆ«ä¸ä¸€æ ·ï¼Œè¿™é‡Œå°±ä¸å†ç”»æµç¨‹å›¾äº†ï¼Œå½’é›†çš„æ˜¯åœ¨çƒ­é’±åŒ…åœ°å€ï¼ˆè”ç½‘åœ°å€ï¼‰ï¼Œ</p></li><li><p>çƒ­è½¬å†·ï¼šå°†å½’é›†åœ°å€é‡Œé¢çš„èµ„é‡‘è½¬åˆ°ä¸€ä¸ªå†·é’±åŒ…ï¼Œå½’é›†æ˜¯ä¸€ä¸ªå•ç¬”è½¬è´¦çš„è¿‡ç¨‹ï¼Œå’Œæç°çš„é€»è¾‘æ¯”è¾ƒç±»ä¼¼ï¼Œå°±æ˜¯ä¸šåŠ¡ç±»åˆ«ä¸ä¸€æ ·ï¼Œè¿™é‡Œå°±ä¸å†ç”»æµç¨‹å›¾äº†ã€‚</p></li><li><p>å†·è½¬çƒ­ï¼šä»å†·é’±åŒ…å°†èµ„é‡‘è½¬åˆ°çƒ­é’±åŒ…ï¼Œæ‰‹åŠ¨æ“ä½œçš„è¿‡ç¨‹</p></li><li><p>é’±åŒ…é£æ§ï¼š</p><ul><li>ä¸šåŠ¡å±‚ï¼Œä¸ç®¡ç”¨æˆ·å……å€¼è¿˜æ˜¯æç°ï¼Œéƒ½æ˜¯ä¸šåŠ¡å±‚ï¼Œä¸šåŠ¡å±‚ä½œæ¶æ€ä¹ˆåŠï¼Ÿ<ul><li>ä¸šåŠ¡åœ¨æ‰«é“¾ï¼Œä¸æ˜¯è¯´è‡ªå·±æ‰«é“¾æˆåŠŸäº†ä¹‹åå°±å……å€¼æˆåŠŸäº†ï¼Œé£æ§å±‚ä¹Ÿåœ¨æ‰«é“¾ï¼Œé£æ§æ‰«åˆ°é’±åŒ…æ²¡é’±ä¹Ÿä¸è¡Œï¼Œåªæœ‰è¿™ä¸¤ä¸ªå±‚çš„æ•°æ®å¯¹åˆ°äº†æ‰ä¼šå……å€¼æˆåŠŸã€‚</li></ul></li><li>é’±åŒ…å±‚ï¼šé’±åŒ…å±‚ä½œæ¶ï¼šæ¯”å¦‚ä½ çš„ç§é’¥åœ¨å…¬å¸é«˜ç®¡é‡Œé¢ï¼Œä»–ä¹±è½¬é’±ï¼Œä¸šåŠ¡å±‚è®¤ä¸è®¤ï¼Ÿ ä¹Ÿä¸è®¤çš„ï¼Œä¹Ÿè¦é£æ§å±‚æ‰«é“¾+ä¸šåŠ¡å±‚æ‰«é“¾ï¼ŒåŒé‡è®¤è¯ä¹‹åï¼Œæ‰èƒ½é‡ç½®ï¼Œå’Œä¸šåŠ¡å±‚åŒæ ·çš„é“ç†ã€‚</li><li>é’±åŒ…å±‚ä¸€èˆ¬æŒæ¡åœ¨é’±åŒ…æ ¸å¿ƒLederæ‰‹ä¸Šï¼Œè¿™ä¸ªè§’è‰²ä¸€èˆ¬éƒ½æ˜¯è€æ¿æ ¸å¿ƒäººå‘˜æ‹…ä»»ï¼Œå› ä¸ºé£æ§å¯èƒ½å‡ºé—®é¢˜åœäº†ä¸€ä¼šå„¿ï¼Œæˆ–è€…æ‰‹åŠ¨åœæ‰è¿™ä¸ªé£æ§ï¼Œåœ¨è¿™ä¸ªä¸€ç¬é—´ï¼Œé’±åŒ…å±‚ä½œæ¶ï¼ŒLederæŠŠé’±è½¬å‡ºå»äº†ã€‚</li></ul></li><li><p>äº¤æ˜“å›æ»šï¼šäº¤æ˜“å›æ»šæ˜¯æŒ‡åŒºå—é“¾ç½‘ç»œçš„åŒºå—å›æ»šæˆ–è€…é‡ç»„ï¼Œéœ€è¦å°†é’±åŒ…ç³»ç»Ÿä¸­çš„äº¤æ˜“å¤„ç†æ‰çš„è¿‡ç¨‹ï¼Œæ¯”æ–¹è¯´ï¼šç°åœ¨æœ‰ä¸€æ¡é“¾åŒºå—ä¸€ä¸‹ä» 1000 ä¸ªå—å›æ»šåˆ° 500 ä¸ªå—ï¼Œé‚£ä¹ˆé’±åŒ…ç³»ç»Ÿé‡Œé¢å­˜å‚¨çš„ 500-1000 ä¸ªå—çš„äº¤æ˜“å°±æ˜¯æ— æ•ˆäº¤æ˜“äº†ï¼Œéœ€è¦å¤„ç†åœ¨è¿™ä¸ªå—èŒƒå›´çš„æ‰€ç”¨ç”¨æˆ·çš„äº¤æ˜“ã€‚</p></li></ul><p><img src="/img/web3/rollback.png" alt="rollback"></p><ul><li>å¯¹è´¦ç³»ç»Ÿ: é’±åŒ…ç³»ç»Ÿä¸ä¸šåŠ¡å±‚å¯¹è´¦ï¼Œé’±åŒ…ç³»ç»Ÿå®æ—¶èµ„äº§è´Ÿå€ºè¡¨ç­‰ã€‚åŸåˆ™ä¸Šæ¯åŠå¤©æˆ–ä¸€å¤©éƒ½è¦å¯¹ä¸€æ¬¡è´¦ã€</li></ul><p>æ¦‚æ‹¬<strong>æ€»ç»“</strong>ï¼š</p><ol><li><strong>æ‰¹é‡åœ°å€ç”Ÿæˆ</strong>ï¼šä¸ºäº†æé«˜æ€§èƒ½å’Œå“åº”é€Ÿåº¦ï¼Œä¸­å¿ƒåŒ–é’±åŒ…ä¼šé¢„å…ˆç”Ÿæˆå¤§é‡çš„åœ°å€ï¼Œå­˜æ”¾åœ¨åœ°å€æ± ä¸­ï¼Œç”¨æˆ·æ³¨å†Œæ—¶ç›´æ¥åˆ†é…åœ°å€ã€‚</li><li><strong>å……å€¼</strong>ï¼šç”¨æˆ·å‘é’±åŒ…åœ°å€å‘é€åŠ å¯†è´§å¸ï¼Œé’±åŒ…æœåŠ¡é€šè¿‡æ‰«æåŒºå—é“¾æ¥ç¡®è®¤äº¤æ˜“ï¼Œå¹¶æ›´æ–°ç”¨æˆ·çš„è´¦æˆ·ä½™é¢ã€‚</li><li><strong>æç°</strong>ï¼šç”¨æˆ·æäº¤æç°è¯·æ±‚ï¼Œé’±åŒ…æœåŠ¡éªŒè¯è¯·æ±‚åï¼Œä½¿ç”¨ç§é’¥ç­¾åäº¤æ˜“ï¼Œå¹¶å°†åŠ å¯†è´§å¸å‘é€åˆ°ç”¨æˆ·æŒ‡å®šçš„åœ°å€ã€‚</li><li><strong>å½’é›†</strong>ï¼šå°†åˆ†æ•£åœ¨å¤šä¸ªåœ°å€ä¸­çš„èµ„é‡‘å½’é›†åˆ°ä¸€ä¸ªæˆ–å‡ ä¸ªåœ°å€ä¸­ï¼Œä»¥ä¾¿äºç®¡ç†å’Œä½¿ç”¨ã€‚</li><li><strong>çƒ­è½¬å†·</strong>ï¼šå°†çƒ­é’±åŒ…ä¸­çš„èµ„é‡‘è½¬ç§»åˆ°å†·é’±åŒ…ä¸­ï¼Œä»¥æé«˜å®‰å…¨æ€§ã€‚</li><li><strong>å†·è½¬çƒ­</strong>ï¼šä»å†·é’±åŒ…ä¸­è½¬ç§»èµ„é‡‘åˆ°çƒ­é’±åŒ…ï¼Œä»¥ä¾¿ç”¨æˆ·è¿›è¡Œäº¤æ˜“ã€‚</li><li><strong>é“¾è·¯é£æ§</strong>ï¼šå®æ–½é£é™©æ§åˆ¶æªæ–½ï¼Œç¡®ä¿äº¤æ˜“çš„å®‰å…¨æ€§ï¼Œé˜²æ­¢æ¬ºè¯ˆå’Œéæ³•æ´»åŠ¨ã€‚</li></ol><h2 id="3-3-å®‰å…¨æ€§"><a href="#3-3-å®‰å…¨æ€§" class="headerlink" title="3.3 å®‰å…¨æ€§"></a>3.3 å®‰å…¨æ€§</h2><ul><li><strong>å†…éƒ¨é£é™©</strong>ï¼šç”±äºç§é’¥ç”±ä¸­å¿ƒåŒ–æœåŠ¡ç®¡ç†ï¼Œå­˜åœ¨å†…éƒ¨äººå‘˜æ»¥ç”¨æƒé™çš„é£é™©ã€‚</li><li><strong>å¤–éƒ¨æ”»å‡»</strong>ï¼šä¸­å¿ƒåŒ–é’±åŒ…å¯èƒ½æˆä¸ºé»‘å®¢æ”»å‡»çš„ç›®æ ‡ï¼Œä¸€æ—¦è¢«æ”»ç ´ï¼Œç”¨æˆ·èµ„äº§å°†é¢ä¸´å·¨å¤§é£é™©ã€‚</li><li><strong>åˆè§„æ€§</strong>ï¼šä¸­å¿ƒåŒ–é’±åŒ…é€šå¸¸éœ€è¦éµå®ˆä¸¥æ ¼çš„ç›‘ç®¡è¦æ±‚ï¼ŒåŒ…æ‹¬KYCï¼ˆäº†è§£ä½ çš„å®¢æˆ·ï¼‰å’ŒAMLï¼ˆåæ´—é’±ï¼‰æ”¿ç­–ã€‚</li></ul><h2 id="3-4-ç”¨æˆ·ä½“éªŒ"><a href="#3-4-ç”¨æˆ·ä½“éªŒ" class="headerlink" title="3.4 ç”¨æˆ·ä½“éªŒ"></a>3.4 ç”¨æˆ·ä½“éªŒ</h2><ul><li><strong>ä¾¿æ·æ€§</strong>ï¼šç”¨æˆ·ä¸éœ€è¦ç®¡ç†ç§é’¥ï¼Œåªéœ€è®°ä½è´¦æˆ·å’Œå¯†ç ï¼Œä½¿ç”¨èµ·æ¥ç›¸å¯¹ç®€å•ã€‚</li><li><strong>æœåŠ¡ä¾èµ–</strong>ï¼šç”¨æˆ·çš„èµ„äº§å®‰å…¨å’ŒæœåŠ¡å¯ç”¨æ€§é«˜åº¦ä¾èµ–äºä¸­å¿ƒåŒ–é’±åŒ…çš„è¿è¥çŠ¶å†µã€‚</li></ul><h2 id="3-5-ä¼˜åŠ¿ä¸åŠ£åŠ¿"><a href="#3-5-ä¼˜åŠ¿ä¸åŠ£åŠ¿" class="headerlink" title="3.5 ä¼˜åŠ¿ä¸åŠ£åŠ¿"></a>3.5 ä¼˜åŠ¿ä¸åŠ£åŠ¿</h2><ul><li><strong>ä¼˜åŠ¿</strong>ï¼šæ“ä½œç®€ä¾¿ï¼Œé€‚åˆæ–°æ‰‹ç”¨æˆ·ï¼›äº¤æ˜“é€Ÿåº¦å¿«ï¼ŒæœåŠ¡å“åº”åŠæ—¶ã€‚</li><li><strong>åŠ£åŠ¿</strong>ï¼šç”¨æˆ·å¯¹èµ„äº§çš„æ§åˆ¶æƒè¾ƒä½ï¼›å­˜åœ¨ä¸­å¿ƒåŒ–æœåŠ¡çš„é£é™©ï¼Œå¦‚å†…éƒ¨æ¬ºè¯ˆã€é»‘å®¢æ”»å‡»ç­‰ã€‚</li></ul><h1 id="4-å»ä¸­å¿ƒåŒ–é’±åŒ…-HD-é’±åŒ…"><a href="#4-å»ä¸­å¿ƒåŒ–é’±åŒ…-HD-é’±åŒ…" class="headerlink" title="4. å»ä¸­å¿ƒåŒ–é’±åŒ…(HD é’±åŒ…)"></a>4. å»ä¸­å¿ƒåŒ–é’±åŒ…(HD é’±åŒ…)</h1><h2 id="4-1-å»ä¸­å¿ƒåŒ–é’±åŒ…æ¶æ„å›¾"><a href="#4-1-å»ä¸­å¿ƒåŒ–é’±åŒ…æ¶æ„å›¾" class="headerlink" title="4.1. å»ä¸­å¿ƒåŒ–é’±åŒ…æ¶æ„å›¾"></a>4.1. å»ä¸­å¿ƒåŒ–é’±åŒ…æ¶æ„å›¾</h2><p><img src="/img/web3/hdwallet.png" alt="hdwallet"></p><p>å»ä¸­å¿ƒåŒ–é’±åŒ…çš„ç§é’¥æ˜¯ç®¡ç†åœ¨ç”¨æˆ·è®¾å¤‡ä¸­çš„ï¼Œé™¤äº†ç”¨æˆ·æœ¬äººå’Œç‰›é€¼çš„é»‘å®¢ï¼Œæ²¡æœ‰äººæ¥è§¦å¾—åˆ°ã€‚ä¸€èˆ¬çš„å»ä¸­å¿ƒåŒ–é’±åŒ…éƒ½æ˜¯ç¡®å®šæ€§åˆ†å±‚é’±åŒ…ï¼›å…ˆç”ŸæˆåŠ©è®°è¯ï¼ŒåŠ©è®°è¯å¯¼å‡ºä¸»ç§é’¥ï¼Œä¸»ç§é’¥æ‰©å±•å­ç§é’¥å’Œå…¬é’¥çš„æ–¹å¼ï¼Œå…¬é’¥å†å¯¼å‡ºåœ°å€ã€‚</p><p>å»ä¸­å¿ƒåŒ–é’±åŒ…çš„ç§é’¥ä¸€èˆ¬æ˜¯åŠ å¯†ä¹‹åå­˜å‚¨åœ¨æœ¬åœ°è®¾å¤‡ sqlite æˆ–è€…æ•°æ®æ–‡ä»¶é‡Œé¢ï¼Œå½“è¦ç­¾åäº¤æ˜“çš„æ—¶å€™ï¼Œéœ€è¦ç”¨æˆ·è¾“å…¥å¯†ç è§£å¯†ç§é’¥ä¹‹åå†ç­¾åã€‚</p><p>å»ä¸­å¿ƒåŒ–é’±åŒ…æ¯”è¾ƒå‡ºåçš„æœ‰ Tpï¼ŒImTokenï¼ŒMetaMask ç­‰ï¼Œæˆ‘ä»¬é¡¹ç›®å®æˆ˜ä¸­å°†ä¼šå¸¦å¤§å®¶ç”¨ RN å¼€å‘ä¸€æ¬¾ç±»ä¼¼ TP çš„é’±åŒ…ã€‚</p><h2 id="4-2-å»ä¸­å¿ƒåŒ–é’±åŒ…ç»†èŠ‚ä¸šåŠ¡æµç¨‹"><a href="#4-2-å»ä¸­å¿ƒåŒ–é’±åŒ…ç»†èŠ‚ä¸šåŠ¡æµç¨‹" class="headerlink" title="4.2.å»ä¸­å¿ƒåŒ–é’±åŒ…ç»†èŠ‚ä¸šåŠ¡æµç¨‹"></a>4.2.å»ä¸­å¿ƒåŒ–é’±åŒ…ç»†èŠ‚ä¸šåŠ¡æµç¨‹</h2><ul><li><p>ç¦»çº¿åœ°å€ç”Ÿæˆ</p><ul><li>åŠ©è®°è¯ä¼šç¼–ç åŠ é’±åŒ…å¯†ç ï¼Œä¸€èˆ¬ç”¨sqlitleæˆ–è€…wallet.dataæ–‡ä»¶</li><li>åœ°å€ç”Ÿæˆè¿‡ç¨‹ï¼šchilldkeyä¼šæœ‰pubkeyå’Œprikeyï¼Œpubkeyä¼šç”Ÿæˆaddressï¼Œè¿™ä¸ªæ˜¯ç¦»çº¿çš„</li></ul></li><li><p>æ”¶æ¬¾ï¼šæŸ¥è¯¢æœ¬åœ°è®¾å¤‡æ•°æ®åº“æŠŠåœ°å€å±•ç¤ºåˆ°ç•Œé¢ä¸Šã€‚</p></li><li><p>æŸ¥è¯¢ä½™é¢ï¼š</p><ul><li><p>BTCæ˜¯UTXOæ¨¡å‹ï¼Œé“¾ä¸Šæ²¡æœ‰rpcå¯ä»¥è·å¾—ä½™é¢ï¼Œéœ€è¦electumXè·å–</p><p>ETHï¼šeth get balances ethå…·å¤‡è´¦æˆ·æ¨¡å‹</p></li></ul></li></ul><p><img src="/img/web3/%E7%94%A8%E6%88%B7%E6%9F%A5%E8%AF%A2%E4%BD%99%E9%A2%9D%E6%B5%81%E7%A8%8B.jpg" alt="ç”¨æˆ·æŸ¥è¯¢ä½™é¢æµç¨‹"></p><ul><li>è½¬è´¦<ul><li>ç¬¬ä¸€æ­¥ï¼šæ£€æµ‹ä½™é¢æ˜¯å¦è¶³å¤Ÿ</li><li>ç¬¬äºŒæ­¥ï¼šè¯·æ±‚ç­¾åå‚æ•°ï¼š<ul><li>ETHï¼šè·å–ä¸‰ä¸ªï¼šNonce(Number onceçš„ç¼©å†™)ã€gaspriceã€ gaslimite </li><li>BTCï¼šVersionã€Inputã€Outputã€Locktimeã€Sequenceã€Hash Typeè¿™äº›</li><li>Atom ï¼šAccount Numberï¼ˆå”¯ä¸€è´¦æˆ·ç¼–å·ï¼‰ Sequenceï¼ˆé¡ºåºï¼‰fess(æ‰‹ç»­è´¹)</li></ul></li><li>ç¬¬ä¸‰æ­¥ï¼šç»„è£…äº¤æ˜“ï¼Œç»„è£…å®Œä¹‹åç”Ÿæˆä¸€ä¸ª32ä½çš„ä»£ç­¾åçš„MsgHash</li><li>ç¬¬å››æ­¥ï¼šç­¾åï¼Œç”¨å‰é¢çš„Msghashå’Œæœ¬åœ°çš„privkeyåšä¸€æ¬¡signç­¾åï¼Œç­¾åå®Œæˆä¹‹åå°±ä¼šå¾—åˆ°å·²ç»å®Œæˆç­¾åçš„<strong>æŠ¥æ–‡</strong>ï¼Œè¿™ä¸ªæŠ¥æ–‡å’Œpubkeyç»„ç»‡å®Œæ•´çš„äº¤æ˜“ã€‚</li><li>ç¬¬äº”æ­¥ï¼šå¹¿æ’­å‡ºå»ï¼šä¸Šé¢çš„å®Œæ•´çš„äº¤æ˜“è°ƒé“¾ä¸Šçš„æ¥å£å¹¿æ’­å‡ºå»ï¼Œå«æ³•ä¸åŒï¼šSendRawTransactionã€PushTxã€SendTx ã€Broadcast</li></ul></li></ul><p><img src="/img/web3/%E7%A6%BB%E7%BA%BF%E7%AD%BE%E5%90%8D%E6%B5%81%E7%A8%8B%E5%9B%BE.jpg" alt="ç¦»çº¿ç­¾åæµç¨‹å›¾"></p><ul><li><p>è½¬è´¦è®°å½•ï¼šæ ¹æ®åœ°å€æŸ¥è¯¢äº¤æ˜“è®°å½•å’Œæ ¹æ® Hash æŸ¥è¯¢äº¤æ˜“è¯¦æƒ…,è¿™ç¬”è½¬è´¦æ˜¯è°è½¬ç»™è°çš„</p></li><li><p>é—ªå…‘ï¼šé’±åŒ…é‡Œé¢çš„é—ªå…‘ä¸€èˆ¬å¯¹æ¥ 1inch æˆ–è€…å…¶ä»–çš„ aggrator å®ç°å…‘æ¢åŠŸèƒ½</p></li><li><p>Dapp æµè§ˆå™¨ï¼šDapp æµè§ˆå™¨æ˜¯æŒ‡ Dapp å¯ä»¥åœ¨é‡Œé¢è¿è¡Œï¼Œèƒ½å¤Ÿæ­£å¸¸çš„å’Œé’±åŒ…è¿›è¡Œäº¤äº’ï¼Œæœ‰ä»¥ä¸‹å‡ ç§ä¸»æµçš„å®ç°æ–¹å¼ Web View ä¸­åŒ…è£¹ Dapp, é€šè¿‡ Js æ³¨å…¥ Windows å¯¹è±¡çš„æ–¹å¼é€šä¿¡ï¼Œä¸€èˆ¬é’±åŒ…å¼€å‘ç›´æ¥ä½¿ç”¨è¿™ç§æ–¹å¼ Websocket è¿›è¡Œ Dapp å’Œé’±åŒ…ä¹‹é—´çš„é€šä¿¡</p></li></ul><blockquote><p>ä¹Ÿç§°ä¸ºéæ‰˜ç®¡é’±åŒ…ï¼Œå®ƒå…è®¸ç”¨æˆ·å®Œå…¨æ§åˆ¶è‡ªå·±çš„ç§é’¥å’Œèµ„é‡‘ï¼Œè€Œä¸éœ€è¦ä¾èµ–äºç¬¬ä¸‰æ–¹æœåŠ¡</p></blockquote><h2 id="4-3-æ ¸å¿ƒæ€»ç»“ç‚¹"><a href="#4-3-æ ¸å¿ƒæ€»ç»“ç‚¹" class="headerlink" title="4.3 æ ¸å¿ƒæ€»ç»“ç‚¹"></a>4.3 æ ¸å¿ƒæ€»ç»“ç‚¹</h2><ol><li><strong>ç§é’¥æ§åˆ¶</strong>ï¼šç”¨æˆ·å®Œå…¨æ§åˆ¶è‡ªå·±çš„ç§é’¥ï¼Œè¿™æ˜¯è®¿é—®å’Œè½¬ç§»åŠ å¯†è´§å¸çš„å…³é”®ã€‚</li><li><strong>éæ‰˜ç®¡</strong>ï¼šæ²¡æœ‰ä¸­å¿ƒåŒ–çš„å®ä½“æŒæœ‰ç”¨æˆ·çš„èµ„äº§æˆ–ç§é’¥ï¼Œç”¨æˆ·å¯¹è‡ªå·±çš„èµ„äº§æœ‰å®Œå…¨çš„æ§åˆ¶æƒã€‚</li><li><strong>ç¡®å®šæ€§åˆ†å±‚é’±åŒ…ï¼ˆHD Walletï¼‰</strong>ï¼šæ”¯æŒåˆ†å±‚ç¡®å®šæ€§é’±åŒ…ç»“æ„ï¼Œå¯ä»¥ä»ä¸€ä¸ªä¸»ç§å­ï¼ˆé€šå¸¸æ˜¯åŠ©è®°è¯ï¼‰ç”Ÿæˆå¤šä¸ªåœ°å€ã€‚</li></ol><h2 id="4-4-æ¶æ„å’Œå·¥ä½œåŸç†"><a href="#4-4-æ¶æ„å’Œå·¥ä½œåŸç†" class="headerlink" title="4.4 æ¶æ„å’Œå·¥ä½œåŸç†"></a>4.4 æ¶æ„å’Œå·¥ä½œåŸç†</h2><ol><li><strong>æœ¬åœ°å­˜å‚¨</strong>ï¼šç§é’¥é€šå¸¸å­˜å‚¨åœ¨ç”¨æˆ·çš„è®¾å¤‡ä¸Šï¼Œå¦‚ç”µè„‘ã€æ‰‹æœºæˆ–ä¸“ç”¨ç¡¬ä»¶è®¾å¤‡ã€‚</li><li><strong>åŠ å¯†ä¿æŠ¤</strong>ï¼šç§é’¥åœ¨æœ¬åœ°ä»¥åŠ å¯†å½¢å¼å­˜å‚¨ï¼Œéœ€è¦ç”¨æˆ·è®¾ç½®çš„å¯†ç æˆ–PINç æ¥è§£é”ã€‚</li><li><strong>ç­¾åäº¤æ˜“</strong>ï¼šç”¨æˆ·å‘èµ·äº¤æ˜“æ—¶ï¼Œäº¤æ˜“ä¼šåœ¨æœ¬åœ°è®¾å¤‡ä¸Šä½¿ç”¨ç§é’¥ç­¾åï¼Œç„¶åå¹¿æ’­åˆ°åŒºå—é“¾ç½‘ç»œã€‚</li></ol><h2 id="4-5-ç±»å‹"><a href="#4-5-ç±»å‹" class="headerlink" title="4.5 ç±»å‹"></a>4.5 ç±»å‹</h2><ol><li><strong>è½¯ä»¶é’±åŒ…</strong>ï¼šå®‰è£…åœ¨ç”¨æˆ·è®¾å¤‡ä¸Šçš„åº”ç”¨ç¨‹åºï¼Œå¦‚MetaMaskã€Keplrç­‰ã€‚</li><li><strong>ç¡¬ä»¶é’±åŒ…</strong>ï¼šä¸“é—¨çš„ç¡¬ä»¶è®¾å¤‡ï¼Œå¦‚Ledgerå’ŒTrezorï¼Œå®ƒä»¬åœ¨è®¾å¤‡å†…éƒ¨å®‰å…¨åœ°å­˜å‚¨ç§é’¥ã€‚</li><li><strong>çº¸é’±åŒ…</strong>ï¼šå°†ç§é’¥å’Œåœ°å€æ‰“å°åœ¨çº¸ä¸Šï¼Œæ˜¯ä¸€ç§å†·å­˜å‚¨æ–¹å¼ï¼Œä½†æ˜“å—ç‰©ç†æŸå®³ã€‚</li></ol><h2 id="4-6-å®‰å…¨æ€§"><a href="#4-6-å®‰å…¨æ€§" class="headerlink" title="4.6 å®‰å…¨æ€§"></a>4.6 å®‰å…¨æ€§</h2><ol><li><strong>ç§é’¥å®‰å…¨</strong>ï¼šç§é’¥çš„å®‰å…¨æ€§å®Œå…¨å–å†³äºç”¨æˆ·ï¼Œéœ€è¦å¦¥å–„ä¿ç®¡ã€‚</li><li><strong>åŠ å¯†ä¿æŠ¤</strong>ï¼šç§é’¥åœ¨æœ¬åœ°åŠ å¯†å­˜å‚¨ï¼Œå¢åŠ äº†å®‰å…¨æ€§ã€‚</li><li><strong>å¤šç­¾å</strong>ï¼šæ”¯æŒå¤šç­¾åé’±åŒ…ï¼Œéœ€è¦å¤šä¸ªç§é’¥å…±åŒç­¾åæ‰èƒ½è¿›è¡Œäº¤æ˜“ï¼Œæé«˜äº†å®‰å…¨æ€§ã€‚</li></ol><h2 id="4-7-ç”¨æˆ·ä½“éªŒ"><a href="#4-7-ç”¨æˆ·ä½“éªŒ" class="headerlink" title="4.7 ç”¨æˆ·ä½“éªŒ"></a>4.7 ç”¨æˆ·ä½“éªŒ</h2><ol><li><strong>æ§åˆ¶æƒ</strong>ï¼šç”¨æˆ·å¯¹è‡ªå·±çš„èµ„äº§æœ‰å®Œå…¨çš„æ§åˆ¶æƒã€‚</li><li><strong>éšç§æ€§</strong>ï¼šäº¤æ˜“å’Œä½™é¢ä¿¡æ¯ä¸éœ€è¦ä¸ä»»ä½•ä¸­å¿ƒåŒ–å®ä½“å…±äº«ã€‚</li><li><strong>æŠ€æœ¯é—¨æ§›</strong>ï¼šç›¸å¯¹äºä¸­å¿ƒåŒ–é’±åŒ…ï¼Œå»ä¸­å¿ƒåŒ–é’±åŒ…å¯èƒ½éœ€è¦ç”¨æˆ·å…·å¤‡ä¸€å®šçš„æŠ€æœ¯çŸ¥è¯†ã€‚</li></ol><h2 id="4-8ä¼˜åŠ¿ä¸åŠ£åŠ¿"><a href="#4-8ä¼˜åŠ¿ä¸åŠ£åŠ¿" class="headerlink" title="4.8ä¼˜åŠ¿ä¸åŠ£åŠ¿"></a>4.8ä¼˜åŠ¿ä¸åŠ£åŠ¿</h2><ul><li><strong>ä¼˜åŠ¿</strong>ï¼šç”¨æˆ·å®Œå…¨æ§åˆ¶è‡ªå·±çš„èµ„äº§ï¼›æé«˜äº†å®‰å…¨æ€§å’Œéšç§æ€§ï¼›æ”¯æŒå¤šç§åŒºå—é“¾èµ„äº§ã€‚</li><li><strong>åŠ£åŠ¿</strong>ï¼šç”¨æˆ·éœ€è¦è‡ªå·±ç®¡ç†ç§é’¥ï¼Œå¢åŠ äº†è´£ä»»ï¼›å¯èƒ½éœ€è¦æ›´é«˜çš„æŠ€æœ¯çŸ¥è¯†ï¼›äº¤æ˜“é€Ÿåº¦å¯èƒ½è¾ƒæ…¢ã€‚</li></ul><h1 id="5-ç¡¬ä»¶é’±åŒ…"><a href="#5-ç¡¬ä»¶é’±åŒ…" class="headerlink" title="5. ç¡¬ä»¶é’±åŒ…"></a>5. ç¡¬ä»¶é’±åŒ…</h1><h2 id="5-1-ç¡¬ä»¶é’±åŒ…æ¶æ„å›¾"><a href="#5-1-ç¡¬ä»¶é’±åŒ…æ¶æ„å›¾" class="headerlink" title="5.1. ç¡¬ä»¶é’±åŒ…æ¶æ„å›¾"></a>5.1. ç¡¬ä»¶é’±åŒ…æ¶æ„å›¾</h2><p><img src="/img/web3/hardware.png" alt="hardware"></p><p>ç¡¬ä»¶é’±åŒ…ä¸»è¦æ˜¯æŠŠç§é’¥ç®¡ç†åœ¨ç¦»çº¿çš„ç¡¬ä»¶è®¾å¤‡ä¸­ï¼ˆå¯ä»¥æ˜¯ä¸€ä¸ªç±»ä¼¼Uéçš„ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€éƒ¨æ‰‹æœºæˆ–ä¸€å°ç”µè„‘ï¼‰ï¼Œåœ¨ç¡¬ä»¶è®¾å¤‡ä¸­é›†æˆé’±åŒ…ç­¾åç®—æ³•ï¼Œä¸€èˆ¬ä½¿ç”¨è“ç‰™ï¼ŒNFC æˆ–è€…ä¸²å£é€šä¿¡è¿›è¡Œé€šä¿¡ã€‚</p><p>ç¡¬ä»¶é’±åŒ…ä¸€èˆ¬æœ‰ä»¥ä¸‹å‡ ä¸ªä¸šåŠ¡æµç¨‹ï¼š</p><ul><li>åœ°å€ç”Ÿæˆï¼šç¡¬ä»¶ä¸­é›†æˆ BIPï¼Œç”ŸæˆåŠ©è®°è¯å’Œå¯†é’¥å¯¹ï¼Œä½¿ç”¨å…¬é’¥å¯¼å‡ºé’±åŒ…åœ°å€ï¼›</li><li>ç¦»çº¿ç­¾åï¼šç»„ç»‡äº¤æ˜“ç”Ÿæˆ 32 ä½çš„ Msg Hash, å°†ç­¾åæ¶ˆæ¯æ‘˜è¦ä¼ ç»™ç¡¬ä»¶ï¼Œç¡¬ä»¶ç­¾åä¹‹åè¿”å›ï¼Œç»„ç»‡äº¤æ˜“å‘é€åˆ°åŒºå—é“¾ç½‘ç»œã€‚</li></ul><p>5.2. ç¡¬ä»¶é’±åŒ…ç»†èŠ‚ä¸šåŠ¡æµç¨‹</p><p>ç¡¬ä»¶é’±åŒ…å’Œå»ä¸­å¿ƒåŒ–é’±åŒ…ç›¸æ¯”ï¼Œæœ€ä¸ç›¸åŒæ˜¯ç§æœ‰çš„ç®¡ç†æ–¹å¼ï¼Œç¡¬ä»¶é’±åŒ…ç§é’¥å’ŒåŠ©è®°è¯ç®¡ç†åœ¨ç¡¬ä»¶ä¸­ï¼Œä¸‹é¢ç¦»çº¿åœ°å€ç”Ÿæˆå’Œç¦»çº¿ç­¾åä¸ºä¾‹è¯´æ˜ï¼š</p><ul><li>ç¦»çº¿åœ°å€ç”Ÿæˆï¼šå‘ä¸åœ°å€ç”Ÿæˆçš„æŒ‡ä»¤ç»™ç¡¬ä»¶ï¼Œç¡¬ä»¶ä¼šç”ŸæˆåŠ©è®°è¯å’Œç§é’¥ç­‰ä¿¡æ¯ï¼Œå¹¶å°†ç§é’¥å’ŒåŠ©è®°è¯ç¼–ç åŠ å¯†ä¹‹åå­˜å‚¨åœ¨ç¡¬ä»¶ä¸­ï¼Œåå‡ºå…¬é’¥åŒ™ï¼Œé’±åŒ…ç•Œé¢ç«¯ç”¨å…¬é’¥åŒ™ç”Ÿæˆåœ°å€ã€‚</li><li>ç¦»çº¿ç­¾åï¼šç”¨æˆ·ç«¯ç»„ç»‡ç¼–ç äº¤æ˜“æŠ¥æ–‡ï¼Œå‘é€ç»™ç¡¬ä»¶ç­¾åï¼Œç­¾åå›æ¥çš„äº¤æ˜“æŠ¥æ–‡å†æ¬¡ç»„ç»‡ï¼Œç„¶åå‘é€åˆ°åŒºå—é“¾ç½‘ç»œã€‚</li></ul><p>ç§˜é’¥ç®¡ç†æ–¹å¼</p><p>ä½ æœ‰ä¸€ä¸ªç¡¬ä»¶ï¼Œç¡¬ä»¶é‡Œé¢æœ‰ç­¾åèŠ¯ç‰‡ï¼Œè¿˜æœ‰å­˜å‚¨ã€é€šä¿¡</p><p>é€šä¿¡ä¸»è¦æ˜¯NFCã€è“ç‰™ã€ä¸²å£é€šä¿¡ã€æ¥è¿›è¡Œäº¤æ˜“çš„æŠ¥æ–‡ä¼ è¾“å»é€šä¿¡</p><p>æ¯”å¦‚ä½ ç°åœ¨è¦ç­¾åä¸€ç¬”ETHçš„äº¤æ˜“ï¼Œä½ æ˜¯è¦æŠŠETHçš„æ•´ä¸ªäº¤æ˜“ç»„ç»‡äº†ä¹‹åå†ç”Ÿæˆä¸€ä¸ª32ä½çš„å“ˆå¸Œæ¶ˆæ¯ä¼ ç»™ä½ çš„ç¡¬ä»¶ï¼Œä½ çš„ç¡¬ä»¶è¿›è¡Œç­¾åï¼Œç­¾å®Œåå›æ¥äº†ä¹‹åä½ å†ç»„ç»‡æŠ¥æ–‡å»ç»„ç»‡æˆå®Œæ•´çš„é¢äº¤æ˜“ï¼Œç„¶åå†å‘å¸ƒåˆ°å¯¹åº”çš„ETHçš„ç½‘ç»œä¸Š</p><p>ç­¾åï¼šäº¤æ˜“çš„ç­¾åï¼Œç›®å‰é›†æˆçš„ç­¾åç®—æ³•æœ‰å‡ ç§ï¼šED2559ã€Secp256k1 r1 bls Schnorr</p><p>ç­¾åä¹Ÿåˆ†æˆå‡ ä¸ªæ­¥éª¤ï¼Œä¸€ä¸ªæ˜¯keyingç”Ÿæˆç§˜é’¥ï¼ŒæŠŠç§˜é’¥ç”Ÿæˆä¹‹åï¼Œç§é’¥æ˜¯åœ¨åŠ å¯†èŠ¯ç‰‡é‡Œé¢ï¼Œç„¶åå›åå‡ºå…¬é’¥æ¥-ã€‹å…¬é’¥æ¨å¯¼å‡ºåœ°å€ï¼Œç„¶åä½ çš„åœ°å€å°±å¯ä»¥æ¥å—äº¤æ˜“äº†ï¼Œä½ è¦ç­¾åçš„æ—¶å€™ï¼Œä½ æ•´ä¸ªäº¤æ˜“æŠ¥æ–‡ç»„ç»‡å¥½äº†ï¼Œé€šä¿¡ä¸¢ç»™ç­¾åèŠ¯ç‰‡ï¼Œé€šä¿¡å®Œäº†ä¹‹åå†ç»™ä½ åå‡ºå‡ºå»ï¼Œ</p><blockquote><p>æä¾›é«˜å®‰å…¨æ€§çš„åŠ å¯†è´§å¸å­˜å‚¨è§£å†³æ–¹æ¡ˆä¸“é—¨è®¾è®¡çš„ç‰©ç†è®¾å¤‡ï¼Œç”¨äºç”Ÿæˆã€å­˜å‚¨å’Œç®¡ç†ç§é’¥</p></blockquote><h2 id="5-3-æ ¸å¿ƒç‰¹ç‚¹"><a href="#5-3-æ ¸å¿ƒç‰¹ç‚¹" class="headerlink" title="5.3 æ ¸å¿ƒç‰¹ç‚¹"></a>5.3 æ ¸å¿ƒç‰¹ç‚¹</h2><ol><li><strong>ç¦»çº¿å­˜å‚¨</strong>ï¼šç¡¬ä»¶é’±åŒ…å°†<strong>ç§é’¥</strong>å­˜å‚¨åœ¨è®¾å¤‡çš„å†…éƒ¨ï¼Œä¸äº’è”ç½‘éš”ç¦»ï¼Œå‡å°‘äº†åœ¨çº¿ç½‘ç»œé»‘å®¢çš„æ”»å‡»é£é™©</li><li><strong>å†·å­˜å‚¨</strong>ï¼šç¡¬ä»¶é’±åŒ…é€šå¸¸ä¸è¿æ¥åˆ°ç½‘ç»œï¼Œåªæœ‰åœ¨éœ€è¦æ—¶ä¸æ˜¯è¢«äº¤äº’ã€‚å†·ä¹Ÿå¯ä»¥ç†è§£ä¸ºè¿è¡Œçš„æ—¶å€™å†å˜åŒ–ï¼Œ</li><li><strong>ç§é’¥ç”Ÿæˆ</strong>ï¼šç§é’¥åœ¨è®¾å¤‡çš„å†…éƒ¨ç”Ÿæˆï¼Œç¡®ä¿äº†ç§é’¥çš„éšæœºæ€§å’Œå®‰å…¨æ€§ã€‚</li><li><strong>ç”¨æˆ·æ§åˆ¶</strong>ï¼šç”¨æˆ·å®Œå…¨æ§åˆ¶ä»¥ç¡¬ä»¶é’±åŒ…ä¸­çš„ç§é’¥ï¼Œæ²¡æœ‰ç¬¬ä¸‰æ–¹ä»‹å…¥ã€‚</li></ol><h2 id="5-4-ç¡¬ä»¶é’±åŒ…æ¶æ„å’Œå·¥ä½œåŸç†"><a href="#5-4-ç¡¬ä»¶é’±åŒ…æ¶æ„å’Œå·¥ä½œåŸç†" class="headerlink" title="5.4 ç¡¬ä»¶é’±åŒ…æ¶æ„å’Œå·¥ä½œåŸç†"></a>5.4 ç¡¬ä»¶é’±åŒ…æ¶æ„å’Œå·¥ä½œåŸç†</h2><ol><li><strong>åµŒå…¥å¼ç³»ç»Ÿ</strong>ï¼šç¡¬ä»¶é’±åŒ…é€šå¸¸åŸºäºåµŒå…¥å¼ç³»ç»Ÿï¼Œæœ‰é™çš„ç¡¬ä»¶èµ„æºï¼Œä¸“æ³¨äºå®‰å…¨åŠŸèƒ½</li><li><strong>å®‰å…¨å…ƒä»¶</strong>ï¼šå®ç”¨ä¸“é—¨çš„å®‰å…¨åŸä»¶ï¼ˆå¦‚å®‰å…¨å¤„ç†å™¨æˆ–åŠ å¯†ååŒå¤„ç†å™¨ï¼‰æ¥ä¿æŠ¤ç§é’¥ã€‚</li><li><strong>ç”¨æˆ·ç•Œé¢</strong>ï¼šå¯èƒ½ä¼šé…æœ‰å°å±å¹•æˆ–æŒ‰é’®æ¥ä¾›ç”¨æˆ·ä½¿ç”¨ï¼ˆå°†å†›ä»¤ã€ç½‘é“¶Uç›¾ï¼‰</li><li><strong>é€šä¿¡æ¥å£</strong>ï¼šé€šè¿‡USBã€è“ç‰™ã€NFCç­‰æ¥å£ä¸ç”¨æˆ·è®¾å¤‡é€šä¿¡</li></ol><h2 id="5-5-ä¸»è¦åŠŸèƒ½"><a href="#5-5-ä¸»è¦åŠŸèƒ½" class="headerlink" title="5.5 ä¸»è¦åŠŸèƒ½"></a>5.5 ä¸»è¦åŠŸèƒ½</h2><ol><li><strong>åœ°å€ç”Ÿæˆ</strong>ï¼šç¡¬ä»¶é’±åŒ…å¯ä»¥ç”Ÿæˆå¤šä¸ªåœ°å€ï¼Œé€šå¸¸éµå¾ªBIP32ã€BIP39ç­‰æ ‡å‡†ã€‚</li><li><strong>äº¤æ˜“ç­¾å</strong>ï¼šç¡¬ä»¶é’±åŒ…åœ¨è®¾å¤‡å†…éƒ¨å¯¹äº¤æ˜“è¿›è¡Œå‰é¢ï¼Œç¡®ä¿ç§é’¥ä¸ä¼šæš´éœ²ç»™ç”¨æˆ·è®¾å¤‡ã€‚</li><li><strong>å¤‡ä»½ä¸æ¢å¤</strong>ï¼šæ”¯æŒåŠ©è®°è¯æˆ–è€…ç§å­çŸ­è¯­å¤‡ä»½ï¼Œè¿è¡Œç”¨æˆ·æ¢å¤é’±åŒ…</li><li><strong>å¤šç­¾åæ”¯æŒ</strong>ï¼šä¸€äº›ç¡¬ä»¶é’±åŒ…æ”¯æŒå¤šç­¾åäº¤æ˜“ï¼Œå¢åŠ äº¤æ˜“çš„å®‰å…¨æ€§</li></ol><blockquote><p>BIP32å’ŒBIP39æ˜¯ä¸¤ä¸ªä¸åŠ å¯†è´§å¸é’±åŒ…ç›¸å…³çš„è¡Œä¸šæ ‡å‡†ã€‚</p><ol><li>BIP32ï¼ˆHierarchical Deterministic Walletsï¼‰æ˜¯ä¸€ç§æ ‡å‡†ï¼Œè§„å®šäº†ä»ä¸€ä¸ªä¸»ç§é’¥ï¼ˆMaster Private Keyï¼‰ç”Ÿæˆä¸€ç³»åˆ—ç›¸å…³çš„å­ç§é’¥å’Œå¯¹åº”çš„å…¬é’¥çš„æ–¹æ³•ã€‚å®ƒä½¿ç”¨ç¡®å®šæ€§çš„æ–¹å¼ç”Ÿæˆåœ°å€ï¼Œè¿™æ„å‘³ç€å¯ä»¥ä»ä¸€ä¸ªä¸»ç§é’¥æ´¾ç”Ÿå‡ºä¸€ç³»åˆ—çš„å­ç§é’¥å’Œå¯¹åº”çš„åœ°å€ï¼Œè€Œä¸å¿…ä¸ºæ¯ä¸ªåœ°å€å•ç‹¬åˆ›å»ºå’Œå¤‡ä»½ç§é’¥ã€‚è¿™ç§å±‚æ¬¡ç»“æ„çš„é’±åŒ…å¯ä»¥æ›´æ–¹ä¾¿åœ°ç®¡ç†å’Œå¤‡ä»½å¤šä¸ªåœ°å€ã€‚</li><li>BIP39ï¼ˆMnemonic Code for Generating Deterministic Keysï¼‰æ˜¯å¦ä¸€ä¸ªæ ‡å‡†ï¼Œå®šä¹‰äº†ä¸€ç§åŠ©è®°è¯æˆ–ç§å­çŸ­è¯­çš„ç”Ÿæˆæ–¹æ³•ã€‚åŠ©è®°è¯æ˜¯ä¸€ç»„æ˜“äºè®°å¿†å’Œä¹¦å†™çš„å•è¯ï¼Œé€šå¸¸ç”±12ã€15ã€18ã€21æˆ–24ä¸ªå•è¯ç»„æˆã€‚é€šè¿‡ä»ä¸€ä¸ªå›ºå®šçš„è¯æ±‡è¡¨ä¸­é€‰æ‹©è¿™äº›å•è¯ï¼Œå¯ä»¥ç”Ÿæˆä¸€ä¸ªç§å­ï¼Œè¯¥ç§å­å¯ä»¥ç”¨äºç”Ÿæˆé’±åŒ…çš„ç§é’¥å’Œå…¬é’¥ã€‚åŠ©è®°è¯æä¾›äº†ä¸€ç§æ›´æ–¹ä¾¿å’Œæ˜“äºå¤‡ä»½çš„æ–¹å¼æ¥ç®¡ç†å’Œæ¢å¤é’±åŒ…ï¼Œè€Œä¸éœ€è¦ç›´æ¥å¤„ç†å’Œå¤‡ä»½ç§é’¥ã€‚</li></ol><p>è¿™äº›æ ‡å‡†çš„ä½¿ç”¨å¯ä»¥æé«˜åŠ å¯†è´§å¸é’±åŒ…çš„å®‰å…¨æ€§å’Œä¾¿åˆ©æ€§ã€‚BIP32å…è®¸ä»ä¸€ä¸ªä¸»ç§é’¥ç”Ÿæˆå¤šä¸ªåœ°å€ï¼Œç®€åŒ–äº†é’±åŒ…ç®¡ç†è¿‡ç¨‹ï¼Œå¹¶å‡å°‘äº†ç§é’¥çš„æš´éœ²ã€‚BIP39çš„åŠ©è®°è¯æä¾›äº†ä¸€ç§ç”¨æˆ·å‹å¥½çš„å¤‡ä»½å’Œæ¢å¤æœºåˆ¶ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿé€šè¿‡è®°ä½ä¸€ç»„å•è¯æ¥æ¢å¤æ•´ä¸ªé’±åŒ…ã€‚</p></blockquote><h2 id="5-6-æ“ä½œæµç¨‹"><a href="#5-6-æ“ä½œæµç¨‹" class="headerlink" title="5.6 æ“ä½œæµç¨‹"></a>5.6 æ“ä½œæµç¨‹</h2><ol><li><strong>åˆå§‹åŒ–</strong>ï¼šç”¨æˆ·è®¾ç½®ç¡¬ä»¶é’±åŒ…ï¼Œç”Ÿæˆæ–°çš„ç§å­çŸ­è¯­ï¼Œå¹¶å¦¥å–„ä¿å­˜ã€‚</li><li><strong>æ¥æ”¶èµ„é‡‘</strong>ï¼šç”¨æˆ·é€šè¿‡ç¡¬ä»¶é’±åŒ…æä¾›çš„å…¬é’¥åœ°å€æ¥æ”¶èµ„é‡‘ã€‚</li><li><strong>å‘é€äº¤æ˜“</strong>ï¼š<ol><li>ç”¨æˆ·åœ¨è®¡ç®—æœºæˆ–è€…æ‰‹æœºä¸Šåˆ›å»ºäº¤æ˜“è¯·æ±‚</li><li>å°†äº¤æ˜“è¯¦æƒ…ä¼ è¾“åˆ°ç¡¬ä»¶é’±åŒ…ã€‚</li><li>ç¡¬ä»¶é’±åŒ…æ˜¾ç¤ºäº¤æ˜“ä¿¡æ¯ï¼Œç”¨æˆ·ç¡®è®¤æ— è¯¯åï¼Œé€šè¿‡æŒ‰é’®ç¡®è®¤ç­¾åã€‚</li><li>ç¡¬ä»¶é’±åŒ…å¯¹äº¤æ˜“è¿›è¡Œç­¾åï¼Œå¹¶å°†ç­¾ååçš„äº¤æ˜“è¿”å›ç»™ç”¨æˆ·è®¾å¤‡ã€‚</li><li>ç”¨æˆ·å°†ç­¾ååçš„äº¤æ˜“å¹¿æ’­åˆ°åŒºå—é“¾ç½‘ç»œã€‚</li></ol></li><li><strong>å¤‡ä»½ä¸æ¢å¤</strong>ï¼šåœ¨éœ€è¦æ—¶ï¼Œç”¨æˆ·å¯ä»¥ä½¿ç”¨ç§å­çŸ­è¯­æ¢å¤é’±åŒ…ã€‚</li></ol><h2 id="5-7-å®‰å…¨æ€§"><a href="#5-7-å®‰å…¨æ€§" class="headerlink" title="5.7 å®‰å…¨æ€§"></a>5.7 å®‰å…¨æ€§</h2><ol><li><strong>æŠµå¾¡ç½‘ç»œæ”»å‡»</strong>ï¼šç”±äºç§é’¥ä¸æ¥è§¦ç½‘ç»œï¼Œç¡¬ä»¶é’±åŒ…å¯ä»¥æœ‰æ•ˆçš„æŠµå¾¡ç½‘ç»œæ”»å‡»</li><li>ç‰©ç†å®‰å…¨ï¼šç¡¬ä»¶é’±åŒ…çš„ç‰©ç†å®‰å…¨æ€§å–å†³äºå…¶æ„å»ºè´¨é‡å’Œç”¨æˆ·å¦‚ä½•ä¿ç®¡è®¾å¤‡</li><li><strong>æŠ—èƒè¿«åŠŸèƒ½</strong>ï¼šä¸€äº›ç¡¬ä»¶é’±åŒ…æä¾›è™šå‡çš„PINç æˆ–åŠ©è®°è¯ï¼Œä»¥é˜²æ­¢åœ¨èƒè¿«æƒ…å†µä¸‹æ³„éœ²çœŸå®ä¿¡æ¯ã€‚</li></ol><h2 id="5-8-ç”¨æˆ·ä½“éªŒ"><a href="#5-8-ç”¨æˆ·ä½“éªŒ" class="headerlink" title="5.8 ç”¨æˆ·ä½“éªŒ"></a>5.8 ç”¨æˆ·ä½“éªŒ</h2><ol><li><strong>é«˜å®‰å…¨æ€§</strong>ï¼šæœªç”¨æˆ·æä¾›é“¶è¡Œçº§åˆ«çš„èµ„äº§ä¿æŠ¤</li><li>æ˜“ç”¨æ€§ï¼š å°½ç®¡è®¾ç½®äº†å®‰å…¨æªæ–½ï¼Œä½†å¤§å¤šæ•°ç¡¬ä»¶é’±åŒ…çš„è®¾è®¡éƒ½æ˜¯å‹å¥½ç”¨æˆ·çš„</li><li><strong>ä½¿ç”¨æˆæœ¬</strong>ï¼šç¡¬ä»¶é’±åŒ…éœ€è¦æ‰¾å¯¹åº”å‚å®¶è´­ä¹°ï¼Œå­˜åœ¨æˆæœ¬ï¼Œæ®è¯´è´µçš„å¥½å‡ ä¸‡U</li></ol><h2 id="5-9ä¼˜åŠ¿ä¸åŠ£åŠ¿"><a href="#5-9ä¼˜åŠ¿ä¸åŠ£åŠ¿" class="headerlink" title="5.9ä¼˜åŠ¿ä¸åŠ£åŠ¿"></a>5.9ä¼˜åŠ¿ä¸åŠ£åŠ¿</h2><ul><li><strong>ä¼˜åŠ¿</strong>ï¼šæé«˜çš„å®‰å…¨æ€§ï¼›ç§é’¥ä¸è§¦ç½‘ï¼›æ”¯æŒå¤šç§åŠ å¯†è´§å¸ï¼›æ˜“äºä½¿ç”¨ã€‚</li><li><strong>åŠ£åŠ¿</strong>ï¼šéœ€è¦è´­ä¹°ç¡¬ä»¶è®¾å¤‡ï¼›äº¤æ˜“æ—¶éœ€è¦ç‰©ç†è®¾å¤‡ï¼›å¯èƒ½å­˜åœ¨è®¾å¤‡æŸåæˆ–ä¸¢å¤±çš„é£é™©ã€‚</li></ul><h1 id="6-äº¤æ˜“æ‰€Web3é’±åŒ…"><a href="#6-äº¤æ˜“æ‰€Web3é’±åŒ…" class="headerlink" title="6.äº¤æ˜“æ‰€Web3é’±åŒ…"></a>6.äº¤æ˜“æ‰€Web3é’±åŒ…</h1><h2 id="6-1-æ ¸å¿ƒç‰¹ç‚¹"><a href="#6-1-æ ¸å¿ƒç‰¹ç‚¹" class="headerlink" title="6.1 æ ¸å¿ƒç‰¹ç‚¹"></a>6.1 æ ¸å¿ƒç‰¹ç‚¹</h2><ol><li><strong>é›†æˆæ€§</strong>ï¼šä½œä¸ºäº¤æ˜“æ‰€å¹³å°çš„ä¸€éƒ¨åˆ†ï¼Œç”¨æˆ·å¯ä»¥ç›´æ¥åœ¨äº¤æ˜“æ‰€å†…è¿›è¡Œèµ„äº§çš„å­˜å‚¨ã€è½¬è´¦å’Œäº¤æ˜“ã€‚</li><li><strong>å¤šåŠŸèƒ½</strong>ï¼šé™¤äº†åŸºæœ¬çš„é’±åŒ…åŠŸèƒ½ï¼Œè¿˜å¯èƒ½æä¾›å»ä¸­å¿ƒåŒ–åº”ç”¨ï¼ˆDAppï¼‰çš„äº¤äº’ã€ä»£å¸äº¤æ¢ã€å€Ÿè´·ç­‰é«˜çº§åŠŸèƒ½ã€‚</li><li><strong>ç”¨æˆ·ç•Œé¢</strong>ï¼šæä¾›ç”¨æˆ·å‹å¥½çš„ç•Œé¢ï¼Œä¾¿äºç”¨æˆ·ç®¡ç†å’Œä½¿ç”¨å…¶åŠ å¯†èµ„äº§ã€‚</li></ol><h2 id="6-2æ¶æ„å’Œå·¥ä½œåŸç†"><a href="#6-2æ¶æ„å’Œå·¥ä½œåŸç†" class="headerlink" title="6.2æ¶æ„å’Œå·¥ä½œåŸç†"></a>6.2æ¶æ„å’Œå·¥ä½œåŸç†</h2><ol><li><strong>ä¸­å¿ƒåŒ–ç®¡ç†</strong>ï¼šç”¨æˆ·çš„ç§é’¥ç”±äº¤æ˜“æ‰€ç®¡ç†ï¼Œè¿™ä¸ä¸­å¿ƒåŒ–é’±åŒ…ç›¸ä¼¼ï¼Œä¾¿äºäº¤æ˜“æ‰€è¿›è¡Œå¿«é€Ÿçš„äº¤æ˜“å¤„ç†ã€‚</li><li><strong>å»ä¸­å¿ƒåŒ–äº¤äº’</strong>ï¼šæ”¯æŒä¸åŒºå—é“¾ä¸Šçš„æ™ºèƒ½åˆçº¦å’ŒDAppçš„äº¤äº’ï¼Œå…è®¸ç”¨æˆ·è¿›è¡Œå»ä¸­å¿ƒåŒ–çš„äº¤æ˜“å’Œæ“ä½œã€‚</li><li><strong>çƒ­é’±åŒ…ä¸å†·é’±åŒ…</strong>ï¼šç»“åˆçƒ­é’±åŒ…ï¼ˆåœ¨çº¿é’±åŒ…ï¼‰å’Œå†·é’±åŒ…ï¼ˆç¦»çº¿é’±åŒ…ï¼‰çš„ä½¿ç”¨ï¼Œä»¥æä¾›å®‰å…¨æ€§å’Œä¾¿æ·æ€§çš„å¹³è¡¡ã€‚</li></ol><h2 id="6-3-ä¸»è¦åŠŸèƒ½"><a href="#6-3-ä¸»è¦åŠŸèƒ½" class="headerlink" title="6.3 ä¸»è¦åŠŸèƒ½"></a>6.3 ä¸»è¦åŠŸèƒ½</h2><ol><li><strong>èµ„äº§ç®¡ç†</strong>ï¼šç”¨æˆ·å¯ä»¥åœ¨é’±åŒ…ä¸­æŸ¥çœ‹å’Œç®¡ç†è‡ªå·±çš„åŠ å¯†è´§å¸èµ„äº§ã€‚</li><li><strong>äº¤æ˜“æ‰§è¡Œ</strong>ï¼šç”¨æˆ·å¯ä»¥ç›´æ¥åœ¨é’±åŒ…ç•Œé¢ä¸Šæ‰§è¡Œä¹°å–è®¢å•ã€‚</li><li><strong>æ™ºèƒ½åˆçº¦äº¤äº’</strong>ï¼šæ”¯æŒä¸æ™ºèƒ½åˆçº¦çš„äº¤äº’ï¼Œä½¿ç”¨æˆ·èƒ½å¤Ÿå‚ä¸åˆ°å»ä¸­å¿ƒåŒ–é‡‘èï¼ˆDeFiï¼‰é¡¹ç›®ä¸­ã€‚</li><li><strong>ä»£å¸æ”¶å‘</strong>ï¼šç”¨æˆ·å¯ä»¥å‘é€å’Œæ¥æ”¶å„ç§åŠ å¯†è´§å¸ä»£å¸ã€‚</li><li><strong>å¤šç­¾æ”¯æŒ</strong>ï¼šå¯èƒ½æ”¯æŒå¤šç­¾åé’±åŒ…åŠŸèƒ½ï¼Œå¢åŠ äº¤æ˜“çš„å®‰å…¨æ€§ã€‚</li></ol><h2 id="6-4-æ“ä½œæµç¨‹"><a href="#6-4-æ“ä½œæµç¨‹" class="headerlink" title="6.4 æ“ä½œæµç¨‹"></a>6.4 æ“ä½œæµç¨‹</h2><ol><li><strong>è´¦æˆ·åˆ›å»º</strong>ï¼šç”¨æˆ·åœ¨äº¤æ˜“æ‰€æ³¨å†Œè´¦æˆ·ï¼Œå¹¶åˆ›å»ºWeb3é’±åŒ…ã€‚</li><li><strong>ç§é’¥ç®¡ç†</strong>ï¼šç§é’¥ç”±äº¤æ˜“æ‰€å®‰å…¨åœ°ç®¡ç†ï¼Œç”¨æˆ·é€šè¿‡è´¦æˆ·éªŒè¯æ¥è®¿é—®é’±åŒ…åŠŸèƒ½ã€‚</li><li><strong>èµ„é‡‘å­˜å…¥</strong>ï¼šç”¨æˆ·å¯ä»¥é€šè¿‡è½¬è´¦å°†åŠ å¯†è´§å¸å­˜å…¥äº¤æ˜“æ‰€é’±åŒ…ã€‚</li><li><strong>äº¤æ˜“å’ŒæŠ•èµ„</strong>ï¼šç”¨æˆ·åˆ©ç”¨é’±åŒ…å†…çš„èµ„é‡‘è¿›è¡Œå¸‚åœºäº¤æ˜“æˆ–å‚ä¸DeFié¡¹ç›®ã€‚</li><li><strong>èµ„é‡‘æå–</strong>ï¼šç”¨æˆ·å¯ä»¥å°†èµ„é‡‘ä»é’±åŒ…æå–åˆ°ä¸ªäººåœ°å€æˆ–å…¶ä»–é’±åŒ…ã€‚</li></ol><h2 id="6-5-å®‰å…¨æ€§"><a href="#6-5-å®‰å…¨æ€§" class="headerlink" title="6.5 å®‰å…¨æ€§"></a>6.5 å®‰å…¨æ€§</h2><ol><li><strong>ä¸­å¿ƒåŒ–é£é™©</strong>ï¼šç”±äºç§é’¥ç”±äº¤æ˜“æ‰€ç®¡ç†ï¼Œç”¨æˆ·éœ€è¦ä¿¡ä»»äº¤æ˜“æ‰€çš„å®‰å…¨æ€§å’Œä¿¡èª‰ã€‚</li><li><strong>å¤šé‡ç­¾å</strong>ï¼šä¸€äº›äº¤æ˜“æ‰€å¯èƒ½æä¾›å¤šé‡ç­¾åä¿æŠ¤ï¼Œå¢åŠ äº¤æ˜“çš„å®‰å…¨æ€§ã€‚</li><li><strong>å†·å­˜å‚¨</strong>ï¼šäº¤æ˜“æ‰€é€šå¸¸ä¼šå°†å¤§éƒ¨åˆ†èµ„äº§å­˜å‚¨åœ¨å†·é’±åŒ…ä¸­ï¼Œä»¥æŠµå¾¡ç½‘ç»œæ”»å‡»ã€‚</li></ol><h2 id="6-6-ç”¨æˆ·ä½“éªŒ"><a href="#6-6-ç”¨æˆ·ä½“éªŒ" class="headerlink" title="6.6 ç”¨æˆ·ä½“éªŒ"></a>6.6 ç”¨æˆ·ä½“éªŒ</h2><ol><li><strong>ä¾¿æ·æ€§</strong>ï¼šç”¨æˆ·å¯ä»¥åœ¨ä¸€ä¸ªå¹³å°ä¸Šå®Œæˆäº¤æ˜“å’Œèµ„äº§ç®¡ç†ï¼Œæ— éœ€åœ¨å¤šä¸ªé’±åŒ…é—´è½¬ç§»èµ„é‡‘ã€‚</li><li><strong>åŠŸèƒ½ä¸°å¯Œ</strong>ï¼šæä¾›å¤šç§é‡‘èåŠŸèƒ½ï¼Œæ»¡è¶³ç”¨æˆ·çš„ä¸åŒéœ€æ±‚ã€‚</li><li><strong>å®‰å…¨æ€§</strong>ï¼šè™½ç„¶ä¸å¦‚ç¡¬ä»¶é’±åŒ…å®‰å…¨ï¼Œä½†é€šè¿‡å¤šé‡ç­¾åå’Œå†·å­˜å‚¨ç­‰æªæ–½æé«˜äº†å®‰å…¨æ€§ã€‚</li></ol><h2 id="6-7-ä¼˜åŠ¿ä¸åŠ£åŠ¿"><a href="#6-7-ä¼˜åŠ¿ä¸åŠ£åŠ¿" class="headerlink" title="6.7 ä¼˜åŠ¿ä¸åŠ£åŠ¿"></a>6.7 ä¼˜åŠ¿ä¸åŠ£åŠ¿</h2><ul><li><strong>ä¼˜åŠ¿</strong>ï¼šæ“ä½œä¾¿æ·ï¼ŒåŠŸèƒ½é›†æˆï¼›ç”¨æˆ·ç•Œé¢å‹å¥½ï¼›å¿«é€Ÿäº¤æ˜“æ‰§è¡Œã€‚</li><li><strong>åŠ£åŠ¿</strong>ï¼šä¸­å¿ƒåŒ–ç®¡ç†å¯èƒ½å¸¦æ¥å®‰å…¨é£é™©ï¼›ç”¨æˆ·å¯¹èµ„äº§çš„æ§åˆ¶æƒè¾ƒä½ã€‚</li></ul><h1 id="7-æ‰˜ç®¡é’±åŒ…"><a href="#7-æ‰˜ç®¡é’±åŒ…" class="headerlink" title="7. æ‰˜ç®¡é’±åŒ…"></a>7. æ‰˜ç®¡é’±åŒ…</h1><h2 id="7-1æ‰˜ç®¡é’±åŒ…æ¶æ„å›¾"><a href="#7-1æ‰˜ç®¡é’±åŒ…æ¶æ„å›¾" class="headerlink" title="7.1æ‰˜ç®¡é’±åŒ…æ¶æ„å›¾"></a>7.1æ‰˜ç®¡é’±åŒ…æ¶æ„å›¾</h2><p><img src="/img/web3/mpc.png" alt="mpc"></p><h2 id="7-2-æ‰˜ç®¡é’±åŒ…ä¸šåŠ¡æµç¨‹"><a href="#7-2-æ‰˜ç®¡é’±åŒ…ä¸šåŠ¡æµç¨‹" class="headerlink" title="7.2. æ‰˜ç®¡é’±åŒ…ä¸šåŠ¡æµç¨‹"></a>7.2. æ‰˜ç®¡é’±åŒ…ä¸šåŠ¡æµç¨‹</h2><p>æ‰˜ç®¡é’±åŒ…å’Œå…¶ä¸­å¿ƒåŒ–é’±åŒ…ç›¸æ¯”ï¼Œä¸ç›¸åŒçš„åœ°æ–¹ä¹Ÿæ˜¯å¯†é’¥çš„ç®¡ç†æ–¹å¼ï¼Œåœ¨æ‰˜ç®¡ç³»ç»Ÿä¸­ï¼Œä¸€èˆ¬ä½¿ç”¨ <strong>MPC ç½‘ç»œ</strong>ï¼Œä¸€å…±æœ‰ M ä¸ªèŠ‚ç‚¹ï¼Œå…¶ä¸­ <strong>N èŠ‚ç‚¹ç­¾åäº¤æ˜“</strong>å°±æœ‰æ•ˆã€‚æ¯ä¸ªèŠ‚ç‚¹æŒæ¡ä¸€ä¸ªå¯†é’¥ç‰‡ï¼Œåœ¨æ•´ä¸ªç½‘ç»œä¸­æ²¡æœ‰å‡ºç°è¿‡å®Œæ•´çš„å¯†é’¥ï¼›ä¸‹é¢ä¹Ÿåœ°å€ç”Ÿæˆå’Œäº¤æ˜“ç­¾åä¸ºä¾‹è¯´æ˜</p><ul><li>åœ°å€ç”Ÿæˆï¼šä¸šåŠ¡ç«¯å‘å‡º Keygen æŒ‡ä»¤ï¼ŒMPC ç½‘ç»œç»è¿‡å¤šè½®å…±è¯†ä¹‹åå„è‡ªäº§ç”Ÿå¯†é’¥ç‰‡ï¼Œå¹¶åå‡ºèšåˆå…¬é’¥ï¼Œä¸šåŠ¡ç«¯ä½¿ç”¨å…¬é’¥å¯¼å‡ºåœ°å€ã€‚</li><li>ç¦»çº¿ç­¾åï¼šä¸šåŠ¡ç«¯å‘å‡º Sign æŒ‡ä»¤, å¹¶æºå¸¦å¾…ç­¾åçš„äº¤æ˜“æŠ¥æ–‡åˆ° MPC ç½‘ç»œï¼ŒMPC ç½‘ç»œç»è¿‡å¤šè½®ç­¾åæˆå…¬å…±ï¼Œè¿”å›ç­¾åä¸²ç»™ä¸šåŠ¡ç«¯ï¼Œä¸šåŠ¡ç«¯å°†äº¤æ˜“å‘é€åˆ°åŒºå—é“¾ç½‘ç»œã€‚</li><li>æŠŠé’¥åŒ™åˆ†å¸ƒåœ¨å„ä¸ªèŠ‚ç‚¹ä¸Šï¼Œé›†é½ä¸ƒé¾™ç å°±å¯ä»¥å¬å”¤ç¥é¾™</li></ul><h2 id="7-3-æ ¸å¿ƒç‰¹ç‚¹"><a href="#7-3-æ ¸å¿ƒç‰¹ç‚¹" class="headerlink" title="7.3 æ ¸å¿ƒç‰¹ç‚¹"></a>7.3 æ ¸å¿ƒç‰¹ç‚¹</h2><ol><li><strong>ç¬¬ä¸‰æ–¹ç®¡ç†</strong>ï¼šç§é’¥ç”±ç¬¬ä¸‰æ–¹æœºæ„ç®¡ç†ï¼Œè€Œä¸æ˜¯ç”¨æˆ·ç›´æ¥æ§åˆ¶ã€‚</li><li><strong>å®‰å…¨æ€§é«˜</strong>ï¼šé€šè¿‡ä¸“ä¸šçš„å®‰å…¨æªæ–½å’Œåè®®æ¥ä¿æŠ¤ç§é’¥ï¼Œé€‚ç”¨äºå­˜å‚¨å¤§é‡èµ„äº§ã€‚</li><li><strong>åˆè§„æ€§</strong>ï¼šæ‰˜ç®¡é’±åŒ…æœåŠ¡çš„æä¾›å•†é€šå¸¸è¦éµå®ˆå½“åœ°çš„ä¸¥æ ¼ç›‘ç®¡è¦æ±‚ï¼ŒåŒ…æ‹¬KYCï¼ˆäº†è§£ä½ çš„ç”¨æˆ·ï¼‰å’ŒAMLï¼ˆåæ´—é’±ï¼‰æ”¿ç­–</li></ol><h2 id="7-4-å·¥ä½œåŸç†"><a href="#7-4-å·¥ä½œåŸç†" class="headerlink" title="7.4 å·¥ä½œåŸç†"></a>7.4 å·¥ä½œåŸç†</h2><ol><li><strong>å¤šç­¾åæŠ€æœ¯</strong>ï¼šæ‰˜ç®¡é’±åŒ…é€šå¸¸é‡‡ç”¨å¤šç­¾åæŠ€æœ¯ï¼Œå³éœ€è¦<strong>å¤šä¸ªç­¾åè€…</strong>ä¸­çš„ä¸€å®šæ•°é‡<strong>åŒæ„</strong>åæ‰èƒ½æˆæƒäº¤æ˜“ã€‚</li><li><strong>åˆ†å±‚ç¡®å®šæ€§é’±åŒ…ç»“æ„</strong>ï¼šæ”¯æŒåˆ†å±‚ç¡®å®šæ€§é’±åŒ…ï¼ˆHD Wallet ï¼‰ï¼Œå¯ä»¥ä»ä¸€ä¸ªç§å­çŸ­è¯­ç”Ÿæˆå¤šä¸ªåœ°å€ã€‚</li><li><strong>å†·å­˜å‚¨</strong>ï¼šç§é’¥å­˜å‚¨åœ¨ç¦»çº¿ç¯å¢ƒä¸­ï¼Œå¦‚ç¡¬ä»¶å®‰å…¨æ¨¡å—ï¼ˆHSMï¼‰æˆ–å†·åº“ï¼Œä»¥æé«˜å®‰å…¨æ€§</li></ol><h2 id="7-5-ä¸»è¦åŠŸèƒ½"><a href="#7-5-ä¸»è¦åŠŸèƒ½" class="headerlink" title="7.5 ä¸»è¦åŠŸèƒ½"></a>7.5 ä¸»è¦åŠŸèƒ½</h2><ol><li><strong>èµ„äº§ä¿ç®¡</strong>ï¼šä¸ºç”¨æˆ·æä¾›åŠ å¯†è´§å¸èµ„äº§çš„ä¿ç®¡æœåŠ¡ã€‚</li><li><strong>äº¤æ˜“æ‰§è¡Œ</strong>ï¼šç”¨æˆ·å¯ä»¥<strong>å‘èµ·äº¤æ˜“</strong>è¯·æ±‚ï¼Œç”±<strong>æ‰˜ç®¡æœåŠ¡æ‰§è¡Œ</strong>å®é™…çš„äº¤æ˜“</li><li><strong>å®¡è®¡å’ŒæŠ¥å‘Š</strong>ï¼šæä¾›èµ„äº§å®¡è®¡å’Œäº¤æ˜“æŠ¥å‘ŠæœåŠ¡ï¼Œæœ‰åŠ©äºåˆè§„æ€§å’Œé€æ˜åº¦ã€‚</li><li><strong>é£é™©ç®¡ç†</strong>ï¼šé€šè¿‡ä¸“ä¸šçš„é£æ§æªæ–½ï¼Œå¸®åŠ©ç”¨æˆ·ç®¡ç†èµ„äº§é£é™©ã€‚</li></ol><h2 id="7-6-æ“ä½œæµç¨‹"><a href="#7-6-æ“ä½œæµç¨‹" class="headerlink" title="7.6 æ“ä½œæµç¨‹"></a>7.6 æ“ä½œæµç¨‹</h2><ol><li><strong>æ³¨å†Œå’ŒéªŒè¯</strong>ï¼šç”¨æˆ·åœ¨æ‰˜ç®¡æœåŠ¡æä¾›å•†å¤„æ³¨å†Œè´¦æˆ·ï¼Œå¹¶å®Œæˆå¿…è¦çš„èº«ä»½éªŒè¯ã€‚</li><li><strong>èµ„äº§å­˜å…¥</strong>ï¼šç”¨æˆ·å°†åŠ å¯†è´§å¸å‘é€åˆ°æ‰˜ç®¡é’±åŒ…æä¾›çš„åœ°å€ã€‚</li><li><strong>äº¤æ˜“è¯·æ±‚</strong>ï¼šç”¨æˆ·é€šè¿‡æ‰˜ç®¡æœåŠ¡çš„ç”¨æˆ·ç•Œé¢æˆ–APIå‘èµ·äº¤æ˜“è¯·æ±‚ã€‚</li><li><strong>äº¤æ˜“æ‰§è¡Œ</strong>ï¼šæ‰˜ç®¡æœåŠ¡åœ¨éªŒè¯ç”¨æˆ·è¯·æ±‚åï¼Œæ‰§è¡Œäº¤æ˜“å¹¶å°†ç»“æœé€šçŸ¥ç”¨æˆ·ã€‚</li><li><strong>èµ„äº§æå–</strong>ï¼šç”¨æˆ·å¯ä»¥è¯·æ±‚å°†èµ„äº§ä»æ‰˜ç®¡é’±åŒ…æå–åˆ°æŒ‡å®šåœ°å€ã€‚</li></ol><h2 id="7-7-å®‰å…¨æ€§"><a href="#7-7-å®‰å…¨æ€§" class="headerlink" title="7.7 å®‰å…¨æ€§"></a>7.7 å®‰å…¨æ€§</h2><ol><li><strong>ä¸“ä¸šå®‰å…¨æªæ–½</strong>ï¼šæ‰˜ç®¡æœåŠ¡æä¾›å•†é‡‡ç”¨é«˜çº§çš„å®‰å…¨æŠ€æœ¯å’Œåè®®ï¼Œå¦‚SSLåŠ å¯†ã€å¤šå› ç´ è®¤è¯ç­‰ã€‚</li><li><strong>ä¿é™©</strong>ï¼šä¸€äº›æ‰˜ç®¡æœåŠ¡ä¸ºå­˜å‚¨çš„èµ„äº§æä¾›ä¿é™©ï¼Œä»¥è¦†ç›–æ½œåœ¨çš„å®‰å…¨äº‹ä»¶é€ æˆçš„æŸå¤±ã€‚</li><li><strong>åˆè§„æ€§</strong>ï¼šéµå¾ªç›‘ç®¡è¦æ±‚ï¼Œå®šæœŸè¿›è¡Œå®‰å…¨å®¡è®¡å’Œåˆè§„æ£€æŸ¥ã€‚</li></ol><h2 id="7-8-ç”¨æˆ·ä½“éªŒ"><a href="#7-8-ç”¨æˆ·ä½“éªŒ" class="headerlink" title="7.8 ç”¨æˆ·ä½“éªŒ"></a>7.8 ç”¨æˆ·ä½“éªŒ</h2><ol><li><strong>é«˜å®‰å…¨æ€§</strong>ï¼šä¸ºç”¨æˆ·æä¾›é“¶è¡Œçº§åˆ«çš„èµ„äº§ä¿æŠ¤ã€‚</li><li><strong>ä¸“ä¸šæœåŠ¡</strong>ï¼šæä¾›ä¸“ä¸šçš„èµ„äº§ç®¡ç†å’Œäº¤æ˜“æ‰§è¡ŒæœåŠ¡ã€‚</li><li><strong>ç›‘ç®¡åˆè§„</strong>ï¼šå¸®åŠ©ç”¨æˆ·æ»¡è¶³ç›‘ç®¡è¦æ±‚ï¼Œé™ä½åˆè§„é£é™©ã€‚</li></ol><h2 id="7-9-ä¼˜åŠ¿ä¸åŠ£åŠ¿"><a href="#7-9-ä¼˜åŠ¿ä¸åŠ£åŠ¿" class="headerlink" title="7.9 ä¼˜åŠ¿ä¸åŠ£åŠ¿"></a>7.9 ä¼˜åŠ¿ä¸åŠ£åŠ¿</h2><ul><li><strong>ä¼˜åŠ¿</strong>ï¼šæä¾›é«˜å®‰å…¨æ€§çš„èµ„äº§ä¿ç®¡ï¼›ä¸“ä¸šçš„ç®¡ç†å’ŒæœåŠ¡ï¼›å¸®åŠ©ç”¨æˆ·æ»¡è¶³ç›‘ç®¡è¦æ±‚ã€‚</li><li><strong>åŠ£åŠ¿</strong>ï¼šç”¨æˆ·éœ€è¦æ”¯ä»˜æœåŠ¡è´¹ç”¨ï¼›å¯¹èµ„äº§çš„æ§åˆ¶æƒè¾ƒä½ï¼›éœ€è¦ä¿¡ä»»ç¬¬ä¸‰æ–¹æœºæ„çš„ä¿¡èª‰å’Œå®‰å…¨æ€§ã€‚</li></ul><h1 id="8-å¤šç­¾é’±åŒ…"><a href="#8-å¤šç­¾é’±åŒ…" class="headerlink" title="8. å¤šç­¾é’±åŒ…"></a>8. å¤šç­¾é’±åŒ…</h1><p>å¤šç­¾é’±åŒ…æœ‰ç‚¹åƒ MPC é’±åŒ…çš„å·¥ä½œæœºåˆ¶ï¼Œä½†åˆå®Œå…¨ä¸ä¸€æ ·ã€‚ å¤šç­¾é’±åŒ…çš„å·¥ä½œæœºåˆ¶æ¶‰åŠå¤šä¸ªå¯†é’¥å’Œ M-of-N ç­¾åçš„æ¦‚å¿µã€‚åœ¨ M-of-N è®¾ç½®ä¸­ï¼Œåªæœ‰ N ä¸ªå¯†é’¥ä¸­çš„ M ä¸ªå¯¹äº¤æ˜“è¿›è¡Œäº†ç­¾åï¼Œæ‰èƒ½æˆæƒè¯¥äº¤æ˜“ã€‚ä¾‹å¦‚ï¼Œåœ¨ 2-of-3 å¤šç­¾é’±åŒ…ä¸­ï¼Œå­˜åœ¨ä¸‰ä¸ªç§é’¥ï¼Œè‡³å°‘éœ€è¦ä¸¤ä¸ªç§é’¥æ‰èƒ½æˆæƒäº¤æ˜“ã€‚</p><p>å…³äº gnosis safe å¤šç­¾é’±åŒ…ï¼Œåœ¨é’±åŒ…ç« èŠ‚æˆ‘ä»¬ä¸æ·±å…¥è®²è§£ï¼Œå°†ä¼šåœ¨åé¢çš„åˆçº¦è¯¾ç¨‹ä¸­æ·±å…¥è®²è§£ã€‚</p><p>åŒºåˆ«æ˜¯ å¤šç­¾æ˜¯å¤šä¸ªç§é’¥<br>mpc æ˜¯ä¸€ä¸ªç§é’¥å¤šä¸ªåˆ†ç‰‡</p><h2 id="8-1-æ ¸å¿ƒç‰¹ç‚¹"><a href="#8-1-æ ¸å¿ƒç‰¹ç‚¹" class="headerlink" title="8.1 æ ¸å¿ƒç‰¹ç‚¹"></a>8.1 æ ¸å¿ƒç‰¹ç‚¹</h2><ol><li><strong>å¤šé‡ç­¾å</strong>ï¼šäº¤æ˜“éœ€è¦<strong>å¤šä¸ªç§é’¥</strong>ä¸­çš„è‡³<strong>å°‘Mä¸ª</strong>ç­¾åæ‰èƒ½è¢«æˆæƒã€‚</li><li><strong>æé«˜å®‰å…¨æ€§</strong>ï¼šå‡å°‘äº†<strong>å•ç‚¹æ•…éšœ</strong>çš„é£é™©ï¼Œå³ä½¿éƒ¨åˆ†ç§é’¥<strong>æ³„éœ²</strong>ï¼Œèµ„äº§ä»ç„¶å®‰å…¨ã€‚</li><li><strong>çµæ´»æ€§</strong>ï¼šç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦è®¾ç½®<strong>Må’ŒN</strong>çš„å€¼ï¼Œä»¥åŠå“ªäº›ç§é’¥å‚ä¸ç­¾åã€‚</li></ol><h2 id="8-2-æ¶æ„å’Œå·¥ä½œåŸç†"><a href="#8-2-æ¶æ„å’Œå·¥ä½œåŸç†" class="headerlink" title="8.2 æ¶æ„å’Œå·¥ä½œåŸç†"></a>8.2 æ¶æ„å’Œå·¥ä½œåŸç†</h2><ol><li><strong>ç§é’¥ç”Ÿæˆ</strong>ï¼šæ¯ä¸ªå‚ä¸æ–¹ç”Ÿæˆè‡ªå·±çš„<strong>ç§é’¥</strong>ï¼Œå¹¶ä¿ç•™å¥½ã€‚</li><li><strong>å…¬é’¥ç»„åˆ</strong>ï¼šæ‰€æœ‰å‚ä¸æ–¹çš„<strong>å…¬é’¥</strong>è¢«<strong>ç»„åˆ</strong>åœ¨ä¸€èµ·ï¼Œç”¨äºç”Ÿæˆé’±åŒ…<strong>åœ°å€</strong>ã€‚</li><li><strong>äº¤æ˜“ç­¾ç½²</strong>ï¼šå½“éœ€è¦å‘èµ·äº¤æ˜“æ—¶ï¼Œå¿…é¡»æ”¶é›†åˆ°è¶³å¤Ÿçš„ç­¾å<strong>ï¼ˆè‡³å°‘Mä¸ªï¼‰</strong>æ‰èƒ½è¿›è¡Œã€‚</li><li><strong>æ™ºèƒ½åˆçº¦æ”¯æŒ</strong>ï¼šå¤šç­¾é’±åŒ…é€šå¸¸åŸºäº<strong>æ™ºèƒ½åˆçº¦</strong>å®ç°ï¼Œç‰¹åˆ«æ˜¯åœ¨<strong>ä»¥å¤ªåŠ</strong>ç­‰æ”¯æŒæ™ºèƒ½åˆçº¦çš„ä¸Šã€‚</li></ol><h2 id="8-3-ä¸»è¦åŠŸèƒ½"><a href="#8-3-ä¸»è¦åŠŸèƒ½" class="headerlink" title="8.3 ä¸»è¦åŠŸèƒ½"></a>8.3 ä¸»è¦åŠŸèƒ½</h2><ol><li><strong>èµ„äº§å…±äº«ç®¡ç†</strong>ï¼šå¤šä¸ªç”¨æˆ·å¯ä»¥<strong>å…±åŒç®¡ç†</strong>é’±åŒ…ä¸­çš„èµ„äº§ã€‚</li><li><strong>äº¤æ˜“æˆæƒ</strong>ï¼šäº¤æ˜“éœ€è¦<strong>å¤šä¸ªç­¾å</strong>ï¼Œå¢åŠ äº†äº¤æ˜“çš„<strong>å®‰å…¨æ€§</strong>ã€‚</li><li><strong>æƒé™åˆ†é…</strong>ï¼šå¯ä»¥æ ¹æ®éœ€è¦åˆ†é…ä¸åŒçš„<strong>æƒé™</strong>ç»™ä¸åŒçš„<strong>ç§é’¥æŒæœ‰è€…</strong>ã€‚</li><li><strong>å®¡è®¡å’Œè¿½è¸ª</strong>ï¼šæ‰€æœ‰äº¤æ˜“éƒ½éœ€è¦å¤šä¸ªç­¾åï¼Œæ˜“äºå®¡è®¡å’Œè¿½è¸ªã€‚</li></ol><h2 id="8-4-æ“ä½œæµç¨‹"><a href="#8-4-æ“ä½œæµç¨‹" class="headerlink" title="8.4 æ“ä½œæµç¨‹"></a>8.4 æ“ä½œæµç¨‹</h2><ol><li><strong>åˆ›å»ºé’±åŒ…</strong>ï¼šåˆ›å»ºå¤šç­¾é’±åŒ…æ—¶ï¼Œéœ€è¦ç¡®å®š<strong>Må’ŒN</strong>çš„å€¼ï¼Œä»¥åŠå‚ä¸æ–¹çš„<strong>å…¬é’¥</strong>ã€‚</li><li><strong>ç”Ÿæˆç§é’¥</strong>ï¼šæ¯ä¸ªå‚ä¸æ–¹ç”Ÿæˆè‡ªå·±çš„<strong>ç§é’¥</strong>ï¼Œå¹¶å¦¥å–„ä¿ç®¡ã€‚</li><li><strong>å‘èµ·äº¤æ˜“</strong>ï¼šä¸€ä¸ªå‚ä¸æ–¹å‘èµ·äº¤æ˜“è¯·æ±‚ï¼Œä½†äº¤æ˜“å°šæœª<strong>æœ€ç»ˆæˆæƒ</strong>ã€‚</li><li><strong>æ”¶é›†ç­¾å</strong>ï¼šäº¤æ˜“è¯·æ±‚è¢«å‘é€ç»™å…¶ä»–å‚ä¸æ–¹ï¼Œä»–ä»¬ç”¨è‡ªå·±çš„ç§é’¥<strong>ç­¾ç½²</strong>äº¤æ˜“ã€‚</li><li><strong>äº¤æ˜“æ‰§è¡Œ</strong>ï¼šæ”¶é›†åˆ°è¶³å¤Ÿçš„ç­¾ååï¼Œäº¤æ˜“è¢«<strong>å¹¿æ’­</strong>åˆ°åŒºå—é“¾ç½‘ç»œå¹¶æ‰§è¡Œã€‚</li></ol><h2 id="8-5-å®‰å…¨æ€§"><a href="#8-5-å®‰å…¨æ€§" class="headerlink" title="8.5 å®‰å…¨æ€§"></a>8.5 å®‰å…¨æ€§</h2><ol><li><strong>æŠ—èƒè¿«</strong>ï¼šå³ä½¿<strong>ä¸€ä¸ªç§é’¥æŒæœ‰è€…å—åˆ°èƒè¿«</strong>ï¼Œä¹Ÿæ— æ³•å•ç‹¬æˆæƒäº¤æ˜“ã€‚</li><li><strong>æŠ—æ”»å‡»</strong>ï¼šéœ€è¦<strong>å¤šä¸ªç­¾å</strong>æ‰èƒ½äº¤æ˜“ï¼Œå¢åŠ äº†æ”»å‡»è€…ç›—å–èµ„äº§çš„<strong>éš¾åº¦</strong>ã€‚</li><li><strong>ç§é’¥åˆ†æ•£</strong>ï¼šç§é’¥<strong>åˆ†æ•£</strong>åœ¨å¤šä¸ªå‚ä¸æ–¹æ‰‹ä¸­ï¼Œ<strong>å‡å°‘</strong>äº†ç§é’¥é›†ä¸­æ³„éœ²çš„é£é™©ã€‚</li></ol><h2 id="8-6-ç”¨æˆ·ä½“éªŒ"><a href="#8-6-ç”¨æˆ·ä½“éªŒ" class="headerlink" title="8.6 ç”¨æˆ·ä½“éªŒ"></a>8.6 ç”¨æˆ·ä½“éªŒ</h2><ol><li><strong>å®‰å…¨æ€§é«˜</strong>ï¼šé€‚åˆéœ€è¦<strong>é«˜å®‰å…¨çº§åˆ«</strong>çš„ç”¨æˆ·å’Œ<strong>ç»„ç»‡</strong>ã€‚</li><li><strong>æ“ä½œå¤æ‚æ€§</strong>ï¼šç›¸æ¯”äºå•ç­¾åé’±åŒ…ï¼Œå¤šç­¾é’±åŒ…çš„æ“ä½œæ›´ä¸ºå¤æ‚ã€‚</li><li><strong>åä½œéœ€æ±‚</strong>ï¼šéœ€è¦å‚ä¸æ–¹ä¹‹é—´çš„åä½œæ¥ç­¾ç½²å’Œæ‰§è¡Œäº¤æ˜“ã€‚</li></ol><h2 id="8-7-ä¼˜åŠ¿ä¸åŠ£åŠ¿"><a href="#8-7-ä¼˜åŠ¿ä¸åŠ£åŠ¿" class="headerlink" title="8.7 ä¼˜åŠ¿ä¸åŠ£åŠ¿"></a>8.7 ä¼˜åŠ¿ä¸åŠ£åŠ¿</h2><ul><li><strong>ä¼˜åŠ¿</strong>ï¼šæé«˜äº†å®‰å…¨æ€§å’ŒæŠ—é£é™©èƒ½åŠ›ï¼›é€‚åˆå…±åŒç®¡ç†èµ„äº§ï¼›æ˜“äº<strong>å®¡è®¡</strong>å’Œ<strong>è¿½è¸ª</strong>ã€‚</li><li><strong>åŠ£åŠ¿</strong>ï¼šæ“ä½œè¿‡ç¨‹å¯èƒ½è¾ƒä¸ºç¹çï¼›éœ€è¦å¤šä¸ªå‚ä¸æ–¹çš„åä½œï¼›å¯èƒ½å­˜åœ¨<strong>åè°ƒ</strong>å›°éš¾ã€‚</li></ul><h1 id="9-MPCé’±åŒ…"><a href="#9-MPCé’±åŒ…" class="headerlink" title="9.MPCé’±åŒ…"></a>9.MPCé’±åŒ…</h1><blockquote><p>ï¼ˆMPCï¼ŒMulti-Party Computationï¼‰ï¼Œä¸€ä¸ªå®Œæ•´çš„ç§é’¥è¢«åˆ†å‰²å¤šä¸ªéƒ¨åˆ†ï¼Œæ¯ä¸ªéƒ¨åˆ†ç”±ä¸åŒçš„å‚ä¸æ–¹æŒæœ‰ã€‚</p></blockquote><h2 id="9-1-æ ¸å¿ƒç‰¹ç‚¹"><a href="#9-1-æ ¸å¿ƒç‰¹ç‚¹" class="headerlink" title="9.1 æ ¸å¿ƒç‰¹ç‚¹"></a>9.1 æ ¸å¿ƒç‰¹ç‚¹</h2><ol><li><strong>å»ä¸­å¿ƒåŒ–æ§åˆ¶</strong>ï¼šç§é’¥ä»¥<strong>åˆ†å‰²</strong>çš„å½¢å¼å­˜åœ¨ï¼Œæ²¡æœ‰<strong>å•ä¸€å®ä½“</strong>èƒ½å¤Ÿå•ç‹¬æ§åˆ¶ç§é’¥ã€‚</li><li><strong>å¢å¼ºå®‰å…¨æ€§</strong>ï¼šç§é’¥çš„æ¯ä¸ªéƒ¨åˆ†å•ç‹¬ä¸å…·æœ‰<strong>ä»·å€¼</strong>ï¼Œåªæœ‰ç»„åˆä¸€<strong>å®šæ•°é‡</strong>çš„éƒ¨åˆ†æ‰èƒ½<strong>æ¢å¤ç§é’¥</strong>ã€‚</li><li><strong>å¤šæ–¹æˆæƒ</strong>ï¼šéœ€è¦<strong>å¤šä¸ªå‚ä¸è€…</strong>çš„ä»½é¢å…±åŒåä½œæ‰èƒ½<strong>æˆæƒ</strong>å’Œ<strong>ç­¾ç½²</strong>äº¤æ˜“ã€‚</li></ol><h2 id="9-2-æ¶æ„å’Œå·¥ä½œåŸç†"><a href="#9-2-æ¶æ„å’Œå·¥ä½œåŸç†" class="headerlink" title="9.2 æ¶æ„å’Œå·¥ä½œåŸç†"></a>9.2 æ¶æ„å’Œå·¥ä½œåŸç†</h2><ol><li><strong>ç§˜å¯†åˆ†å‰²</strong>ï¼šç§é’¥é€šè¿‡<strong>ç§˜å¯†å…±äº«ç®—æ³•</strong>è¢«åˆ†å‰²æˆå¤šä¸ªä»½é¢ï¼Œæ¯ä¸ª<strong>ä»½é¢</strong>åŒ…å«<strong>ç§é’¥</strong>çš„ä¸€éƒ¨åˆ†ä¿¡æ¯ã€‚</li><li><strong>ä»½é¢åˆ†å¸ƒ</strong>ï¼šè¿™äº›ä»½é¢è¢«<strong>åˆ†å‘</strong>ç»™ä¸åŒçš„å‚ä¸è€…ï¼Œå¯ä»¥æ˜¯ä¸åŒçš„ä¸ªäººã€æœåŠ¡å™¨æˆ–åœ°ç†ä½ç½®ã€‚</li><li><strong>é˜ˆå€¼è®¾ç½®</strong>ï¼šè®¾ç½®ä¸€ä¸ª<strong>é˜ˆå€¼</strong>ï¼ˆé€šå¸¸æ˜¯<strong>Nä¸ªä¸­çš„Mä¸ª</strong>ï¼‰ï¼Œåªæœ‰æ”¶é›†åˆ°<strong>Mä¸ªä»½é¢æ—¶æ‰èƒ½æ¢å¤ç§é’¥</strong>ã€‚</li><li><strong>äº¤æ˜“ç­¾ç½²</strong>ï¼šå½“éœ€è¦ç­¾ç½²äº¤æ˜“æ—¶ï¼Œæ‰€æœ‰å‚ä¸è€…å¿…é¡»<strong>åä½œ</strong>ï¼Œæä¾›ä»–ä»¬çš„ä»½é¢ä»¥ç”Ÿæˆç­¾åã€‚</li></ol><h2 id="9-3-ä¸»è¦åŠŸèƒ½"><a href="#9-3-ä¸»è¦åŠŸèƒ½" class="headerlink" title="9.3 ä¸»è¦åŠŸèƒ½"></a>9.3 ä¸»è¦åŠŸèƒ½</h2><ol><li><strong>èµ„äº§ä¿æŠ¤</strong>ï¼šå³ä½¿éƒ¨åˆ†ä»½é¢<strong>ä¸¢å¤±</strong>æˆ–è¢«ç›—ï¼Œåªè¦æ²¡æœ‰è¾¾åˆ°<strong>é˜ˆå€¼</strong>ï¼Œèµ„äº§ä»ç„¶å®‰å…¨ã€‚</li><li><strong>æŠ—èƒè¿«</strong>ï¼šå•ä¸ªå‚ä¸è€…æ— æ³•è¢«<strong>èƒè¿«</strong>é€éœ²ç§é’¥ä¿¡æ¯ï¼Œå› ä¸ºä»–ä»¬ä¸æ‹¥æœ‰<strong>å®Œæ•´</strong>çš„ç§é’¥ã€‚</li><li><strong>å®¹é”™æ€§</strong>ï¼šå³ä½¿ä¸€äº›ä»½é¢ä¸¢å¤±æˆ–æŸåï¼Œåªè¦æœ‰è¶³å¤Ÿçš„ä»½é¢ï¼Œç§é’¥ä»ç„¶å¯ä»¥è¢«<strong>æ¢å¤</strong>ã€‚</li><li><strong>å®¡è®¡å’Œåˆè§„</strong>ï¼šæ‰€æœ‰äº¤æ˜“éƒ½éœ€è¦å¤šä¸ªç­¾åï¼Œä¾¿äºå®¡è®¡å’Œæ»¡è¶³åˆè§„è¦æ±‚ã€‚</li></ol><h2 id="9-4-æ“ä½œæµç¨‹"><a href="#9-4-æ“ä½œæµç¨‹" class="headerlink" title="9.4 æ“ä½œæµç¨‹"></a>9.4 æ“ä½œæµç¨‹</h2><ol><li><strong>åˆå§‹åŒ–é’±åŒ…</strong>ï¼šåˆ›å»ºMPCé’±åŒ…æ—¶ï¼Œç§é’¥è¢«<strong>åˆ†å‰²</strong>æˆå¤šä¸ªä»½é¢ï¼Œå¹¶åˆ†é…ç»™ä¸åŒçš„å‚ä¸è€…ã€‚</li><li><strong>ä»½é¢å­˜å‚¨</strong>ï¼šæ¯ä¸ªå‚ä¸è€…å®‰å…¨åœ°å­˜å‚¨ä»–ä»¬çš„ä»½é¢ï¼Œå¯èƒ½ä½¿ç”¨ç¡¬ä»¶**å®‰å…¨æ¨¡å—(**HSM)æˆ–å…¶ä»–å®‰å…¨æªæ–½ã€‚</li><li><strong>äº¤æ˜“è¯·æ±‚</strong>ï¼šç”¨æˆ·å‘èµ·äº¤æ˜“è¯·æ±‚ï¼Œéœ€è¦å¤šä¸ªä»½é¢æ¥<strong>æˆæƒ</strong>ã€‚</li><li><strong>ä»½é¢æ”¶é›†</strong>ï¼šåè°ƒè€…æˆ–æ™ºèƒ½åˆçº¦æ”¶é›†è¶³å¤Ÿçš„ä»½é¢ä»¥<strong>é‡æ„</strong>ç§é’¥ã€‚</li><li><strong>ç­¾åäº¤æ˜“</strong>ï¼šä½¿ç”¨<strong>é‡æ„</strong>çš„ç§é’¥å¯¹äº¤æ˜“è¿›è¡Œ<strong>ç­¾å</strong>ã€‚</li><li><strong>æ‰§è¡Œäº¤æ˜“</strong>ï¼šå°†ç­¾ååçš„<strong>äº¤æ˜“</strong>å¹¿æ’­åˆ°åŒºå—é“¾ç½‘ç»œã€‚</li></ol><h2 id="9-5-å®‰å…¨æ€§"><a href="#9-5-å®‰å…¨æ€§" class="headerlink" title="9.5 å®‰å…¨æ€§"></a>9.5 å®‰å…¨æ€§</h2><ol><li><strong>æŠ—ç›—å–</strong>ï¼šæ²¡æœ‰å•ä¸€å®ä½“æ‹¥æœ‰<strong>å®Œæ•´</strong>çš„ç§é’¥ï¼Œå¢åŠ äº†<strong>ç›—å–</strong>èµ„äº§çš„éš¾åº¦ã€‚</li><li><strong>æŠ—å†…éƒ¨æ¬ºè¯ˆ</strong>ï¼šéœ€è¦å¤šä¸ªå‚ä¸è€…çš„åä½œæ‰èƒ½è¿›è¡Œ<strong>äº¤æ˜“</strong>ï¼Œå‡å°‘äº†<strong>å†…éƒ¨æ¬ºè¯ˆ</strong>çš„é£é™©ã€‚</li><li><strong>æŠ—èƒè¿«</strong>ï¼šå•ä¸ªå‚ä¸è€…å³ä½¿åœ¨èƒè¿«ä¸‹ä¹Ÿ<strong>æ— æ³•æ³„éœ²</strong>å®Œæ•´ç§é’¥ã€‚</li></ol><h2 id="9-6-ç”¨æˆ·ä½“éªŒ"><a href="#9-6-ç”¨æˆ·ä½“éªŒ" class="headerlink" title="9.6 ç”¨æˆ·ä½“éªŒ"></a>9.6 ç”¨æˆ·ä½“éªŒ</h2><ol><li><strong>é«˜å®‰å…¨æ€§</strong>ï¼šç”¨æˆ·å¯ä»¥æ”¾å¿ƒåœ°ä¿ç®¡èµ„äº§ï¼Œå› ä¸ºç§é’¥çš„<strong>å®‰å…¨æ€§</strong>å¾—åˆ°äº†æ˜¾è‘—æå‡ã€‚</li><li><strong>æ“ä½œå¤æ‚æ€§</strong>ï¼šç›¸æ¯”äºä¼ ç»Ÿé’±åŒ…ï¼ŒMPCé’±åŒ…çš„æ“ä½œå¯èƒ½æ›´åŠ å¤æ‚ï¼Œ<strong>éœ€è¦åè°ƒå¤šä¸ª</strong>å‚ä¸è€…ã€‚</li><li><strong>ä¿¡ä»»å’Œåä½œ</strong>ï¼šéœ€è¦åœ¨å‚ä¸è€…ä¹‹é—´å»ºç«‹ä¿¡ä»»å’Œ<strong>åä½œ</strong>æœºåˆ¶ã€‚</li></ol><h2 id="9-7-ä¼˜åŠ¿ä¸åŠ£åŠ¿"><a href="#9-7-ä¼˜åŠ¿ä¸åŠ£åŠ¿" class="headerlink" title="9.7 ä¼˜åŠ¿ä¸åŠ£åŠ¿"></a>9.7 ä¼˜åŠ¿ä¸åŠ£åŠ¿</h2><ul><li><strong>ä¼˜åŠ¿</strong>ï¼šæä¾›äº†æé«˜çš„<strong>å®‰å…¨æ€§</strong>ï¼›é€‚åˆéœ€è¦ä¸¥æ ¼<strong>åˆè§„</strong>çš„åœºåˆï¼›å¢å¼ºäº†å¯¹èµ„äº§çš„ä¿æŠ¤ã€‚</li><li><strong>åŠ£åŠ¿</strong>ï¼šæ“ä½œè¿‡ç¨‹å¯èƒ½è¾ƒä¸ºå¤æ‚ï¼›éœ€è¦å¤šä¸ªå‚ä¸è€…çš„<strong>åä½œ</strong>ï¼›å¯èƒ½æ¶‰åŠè¾ƒé«˜çš„åè°ƒæˆæœ¬ã€‚</li></ul><h1 id="10-ç¤¾äº¤æ¢å¤é’±åŒ…-2ç§æ¢å¤æ–¹å¼"><a href="#10-ç¤¾äº¤æ¢å¤é’±åŒ…-2ç§æ¢å¤æ–¹å¼" class="headerlink" title="10. ç¤¾äº¤æ¢å¤é’±åŒ…(2ç§æ¢å¤æ–¹å¼)"></a>10. ç¤¾äº¤æ¢å¤é’±åŒ…(2ç§æ¢å¤æ–¹å¼)</h1><p>ç¤¾äº¤æ¢å¤é’±åŒ…ç°åœ¨æ˜¯å±äºä¸æµè¡Œé˜¶æ®µï¼Œå…¶ä½¿ç”¨é—¨æ§›ç¨å¾®é«˜äº†ä¸€äº›ï¼Œè€Œä¸”ç°æœ‰çš„ç¤¾äº¤æ¢å¤çš„æŠ€æœ¯è§£å†³æ–¹æ¡ˆä¸å¤Ÿå®Œç¾ï¼Œè¿™ä¹Ÿæ˜¯ç¤¾äº¤æ¢å¤é’±åŒ…ç›´åˆ°ä»Šå¤©ä¸ºæ­¢åšå¾—ä¸å¤ªå¥½çš„åŸå› ã€‚</p><h2 id="10-1-å®ˆæŠ¤è€…æ¢å¤"><a href="#10-1-å®ˆæŠ¤è€…æ¢å¤" class="headerlink" title="10-1 å®ˆæŠ¤è€…æ¢å¤"></a>10-1 å®ˆæŠ¤è€…æ¢å¤</h2><p>å®ˆæŠ¤è€…æ¢å¤æ˜¯ä½¿ç”¨åˆçº¦çš„æ–¹å¼æ¥å®ç°çš„ï¼Œç”¨æˆ·çš„é’±åŒ…æ˜¯ä¸€ä¸ªåˆçº¦é’±åŒ…ï¼Œç”±ä¸€ä¸ª EOA åœ°å€æ§åˆ¶ï¼›ç”¨æˆ·å¯ä»¥ç»™è¿™ä¸ªé’±åŒ…è®¾ç½® <strong>N ä¸ªå®ˆæŠ¤è€…</strong>ï¼Œå½“ç”¨æˆ·çš„ç§é’¥<strong>ä¸¢å¤±</strong>æ—¶ï¼Œå¯ä»¥è®©è¿™äº›å®ˆæŠ¤è€…<strong>è”åˆç­¾å</strong>ä¸€ä¸ªäº¤æ˜“æ›¿æ¢è¿™ä¸ªåˆçº¦é’±åŒ…çš„ <strong>owner</strong>ã€‚</p><p><img src="/img/web3/protector.png" alt="protector"></p><p>åœ¨å®ˆæŠ¤è€…æ¢å¤æœºåˆ¶ä¸­ï¼Œç”¨æˆ·å¯ä»¥æŒ‡å®šä¸€ç»„<strong>ä¿¡ä»»</strong>çš„è”ç³»äººï¼ˆ<strong>å®ˆæŠ¤è€…</strong>ï¼‰ï¼Œä»–ä»¬å¯ä»¥åœ¨ç”¨æˆ·<strong>ä¸¢å¤±</strong>ç§é’¥æ—¶å¸®åŠ©æ¢å¤é’±åŒ…ã€‚è¿™ä¸ªè¿‡ç¨‹é€šå¸¸æ¶‰åŠä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li><strong>è®¾ç½®å®ˆæŠ¤è€…</strong>ï¼šç”¨æˆ·åœ¨é’±åŒ…ä¸­è®¾ç½®<strong>ä¸€ç»„</strong>ä¿¡ä»»çš„è”ç³»äººï¼ˆå®ˆæŠ¤è€…ï¼‰ï¼Œé€šå¸¸éœ€è¦ä»–ä»¬çš„<strong>å…¬é’¥</strong>æˆ–é’±åŒ…åœ°å€ã€‚</li><li><strong>ç§é’¥ä¸¢å¤±</strong>ï¼šå½“ç”¨æˆ·<strong>ä¸¢å¤±</strong>äº†å¯¹é’±åŒ…çš„è®¿é—®æƒé™ï¼Œä¾‹å¦‚<strong>å¿˜è®°</strong>äº†å¯†ç æˆ–<strong>ä¸¢å¤±</strong>äº†ç¡¬ä»¶é’±åŒ…ã€‚</li><li><strong>è¯·æ±‚æ¢å¤</strong>ï¼šç”¨æˆ·å‘å®ˆæŠ¤è€…å‘å‡º<strong>å¸®åŠ©æ¢å¤</strong>çš„è¯·æ±‚ã€‚</li><li><strong>å¤šç­¾åäº¤æ˜“</strong>ï¼šå®ˆæŠ¤è€…<strong>ä»¬</strong>éœ€è¦æŒ‰ç…§é¢„è®¾çš„è§„åˆ™ï¼ˆä¾‹å¦‚ï¼Œéœ€è¦ä¸€å®šæ•°é‡çš„å®ˆæŠ¤è€…åŒæ„ï¼‰ç­¾ç½²ä¸€ä¸ªç‰¹æ®Šçš„å¤šç­¾åäº¤æ˜“ï¼Œä»¥<strong>è¯æ˜</strong>ä»–ä»¬çš„èº«ä»½å’ŒåŒæ„æ¢å¤æ“ä½œã€‚</li><li><strong>æ¢å¤é’±åŒ…</strong>ï¼šä¸€æ—¦æ”¶é›†åˆ°<strong>è¶³å¤Ÿ</strong>æ•°é‡çš„ç­¾åï¼Œå°±å¯ä»¥é€šè¿‡æ™ºèƒ½åˆçº¦æˆ–å…¶ä»–æœºåˆ¶æ¥æ¢å¤é’±åŒ…çš„è®¿é—®æƒé™ã€‚</li></ol><h2 id="10-2-å¯†é’¥åˆ†ç‰‡æ¢å¤"><a href="#10-2-å¯†é’¥åˆ†ç‰‡æ¢å¤" class="headerlink" title="10-2. å¯†é’¥åˆ†ç‰‡æ¢å¤"></a>10-2. å¯†é’¥åˆ†ç‰‡æ¢å¤</h2><p>å¯†é’¥åˆ†ç‰‡ç¤¾äº¤æ¢å¤é’±åŒ…æ˜¯ä½¿ç”¨<strong>é—¨é™ç§˜å¯†</strong>å…±äº«çš„å¯†ç å­¦æŠ€æœ¯æ–¹æ¡ˆå¯¹é’±åŒ…çš„åŠ©è®°è¯æˆ–ç§é’¥è¿›è¡Œåˆ‡ç‰‡å¤‡ä»½ç®¡ç†ï¼Œå½“ç”¨æˆ·çš„åŠ©è®°è¯æˆ–ç§é’¥ä¸¢å¤±ï¼Œå¯ä»¥å‘èµ·ç¤¾äº¤æ¢å¤çš„æ–¹å¼è¿›è¡ŒåŠ©è®°è¯å’Œç§é’¥çš„æ¢å¤ï¼Œåœ¨å¯†é’¥åˆ†ç‰‡ç¤¾äº¤æ¢å¤é’±åŒ…ä¸­ï¼Œå¯ä»¥å°†åŠ©è®°è¯å’Œç§é’¥å±è”½ï¼Œä¸åœ¨éœ€è¦ç”¨æˆ·è‡ªå·±å»å¤‡ä»½åŠ©è®°è¯å’Œç§é’¥ï¼Œè€Œæ˜¯é€šè¿‡ç¤¾äº¤çš„æ–¹å¼è¿›è¡ŒåŠ©è®°è¯å’Œç§é’¥çš„å¤‡ä»½ã€‚</p><blockquote><p>é—¨é™ç§˜å¯†ï¼ˆThreshold Secretï¼‰æ˜¯ä¸€ç§å¯†ç å­¦æŠ€æœ¯ï¼Œç”¨äºå°†ç§˜å¯†ä¿¡æ¯åˆ†å‰²æˆå¤šä¸ªéƒ¨åˆ†ï¼Œå¹¶æŒ‡å®šä¸€ä¸ªé—¨é™å€¼ã€‚åªæœ‰è¾¾åˆ°æˆ–è¶…è¿‡é—¨é™å€¼çš„éƒ¨åˆ†æ‰èƒ½åˆå¹¶ï¼Œä»è€Œé‡æ–°æ„å»ºåŸå§‹çš„ç§˜å¯†ä¿¡æ¯ã€‚å‰é¢çš„MPCå’Œå¤šç­¾éƒ½ç®—æ˜¯é—¨é™ç§˜å¯†</p></blockquote><p><img src="/img/web3/Threshold.png" alt="Threshold"></p><p>åœ¨å¯†é’¥åˆ†ç‰‡é’±åŒ…ä¸­ï¼Œæˆ‘ä»¬æ•´ä¸ªç¤¾äº¤æ¢å¤çš„æµç¨‹å¦‚ä¸‹ï¼š</p><ul><li>ç”¨æˆ·çš„ç§é’¥æˆ–è€…åŠ©è®°è¯å’Œä¸€ä¸ªå¤§éšæœºæ•°åšä¸€æ¬¡å¼‚æˆ–ç®—æ³•ï¼ˆå¼‚æˆ–ç®—æ³•æ˜¯ä¸€ç§é€»è¾‘è¿ç®—ï¼Œä¸¤ä¸ªæ¯”å¯¹ï¼Œå¦‚æœç›¸åŒå°±è¿”å›0ï¼Œå¦åˆ™è¿”å›1ï¼‰ï¼Œå¾—åˆ°ä¸€ä¸ªæ–°çš„ç§˜å¯†å€¼ï¼Œæˆ‘ä»¬æŠŠå¤§éšæœºæ•°å«åš head, ç§˜å¯†å€¼å«åš bodyï¼Œhead åŠ å¯†ä¹‹åä¸Šä¼ åˆ° savour wallet äº‘ç«¯ï¼ˆå¹³å°ï¼‰ã€‚</li><li>å°† body åšé—¨é™å…±äº«ç§˜å¯†ç®—æ³•ï¼ˆå‰é¢è¯´çš„å…±äº«ï¼‰ï¼Œæ‹†åˆ†æˆ N ä»½ shadowï¼ˆç¿»è¯‘è¿‡æ¥æ˜¯â€™å½±â€™çš„æ„æ€ï¼‰, è®¾ç½® K ä»½å¯ä»¥æ¢å¤ body</li><li>shadow-1 åŠ å¯†ä¹‹åå­˜å‚¨åœ¨æœ¬åœ°ï¼Œä½¿ç”¨ AES åŠ å¯†ï¼Œå¯†ç Hashä¹‹ååšä¸ºåŠ å¯† Keyï¼Œ</li><li>shadow-2 åŠ å¯†ä¹‹åå­˜å‚¨åˆ°savour wallet äº‘ç«¯ï¼Œä½¿ç”¨ AES åŠ å¯†ï¼Œå¯†ç å’Œè®¾å¤‡ ID åšä¸ºåŠ å¯† Key</li><li>shadow-3 â€¦ n åŠ å¯†ä¹‹åå­˜å‚¨åˆ°å¯†é’¥æŸœå’Œç¤¾äº¤åœˆçš„å¥½å‹ï¼Œåæ­£å°±æ˜¯å„ç§å­˜å‚¨</li><li>åŠ©è®°è¯æˆ–è€…ç§é’¥ä¸¢å¤±å‘èµ·æ¢å¤ï¼Œè·å–å¯†é’¥æŸœé‡Œé¢æˆ–è€…å¥½å‹å¤„çš„ k - 2 ä»½ç§é’¥ï¼Œå†è·å–äº‘ç«¯çš„ shadow-2 å’Œ headerã€‚</li><li>é€†é—¨é™å…±äº«ç§˜å¯†ç®—æ³•é€šè¿‡ K ä»½ shadow æ¢å¤å‡º body</li><li>body å’Œ head åšé€†å¼‚æˆ–ç®—æ³•å¾—åˆ°åŠ©è®°è¯å’Œç§é’¥ã€‚ å…³äºå¯†é’¥æŸœï¼š å¯†ç æŸœæ˜¯ä¸€ä¸ªå¯†é’¥æ‰˜ç®¡æœåŠ¡ï¼Œç”¨æˆ·å¯ä»¥è‡ªè¡Œè¿è¡Œå¯†é’¥æŸœæœåŠ¡å­˜å‚¨è‡ªå·±çš„å¯†é’¥ shadowï¼Œä¹Ÿå¯ä»¥å°†å¯†é’¥ shadow åŠ å¯†ä¹‹åä¿å­˜åˆ°æˆ‘ä»¬å®˜æ–¹å¯†é’¥æŸœï¼Œå¯†é’¥æŸœå¯¹æ¥çš„æ˜¯å„å¤§åŒºå—é“¾å­˜å‚¨å¹³å°ï¼Œæˆ‘ä»¬å°†æŠŠå¯†é’¥è¿›è¡Œæ·±å±‚æ¬¡åŠ å¯†ä¹‹åæŠŠå¯†é’¥ä¸Šä¼ åˆ°å„å¤§åŒºå—é“¾å­˜å‚¨å¹³å°ï¼Œå³ä½¿æœ‰ä¸€å¤©å¯†é’¥æŸœä¸è¿è¡Œäº†ï¼Œç”¨æˆ·ä¹Ÿå¯ä»¥ä»å„å¤§åŒºå—é“¾å­˜å‚¨å¹³å°è·å–åˆ°è‡ªå·±åŠ å¯†çš„å¯†é’¥åˆ†ç‰‡ï¼Œæ ¹æ®åŠ å¯†è§„åˆ™è¿›è¡Œè§£å¯†å°±å¯ä»¥å¾—åˆ°æ˜æ–‡çš„å¯†é’¥ shadowï¼ŒåŒæ—¶æ ¹æ®ä¸Šé¢çš„è®¾è®¡å›¾ç”¨æˆ·è¿˜å¯ä»¥é€šè¿‡éšç§ç¤¾äº¤çš„æ–¹å¼å¤‡ä»½è‡ªå·±çš„å¯†é’¥ shadow</li></ul><p>ç§é’¥åˆ†ç‰‡æ¢å¤æœºåˆ¶åˆ™æ˜¯ä¸€ç§åŸºäºç§˜å¯†<strong>å…±äº«</strong>ç®—æ³•çš„æ–¹æ³•ï¼Œå®ƒå°†ç§é’¥<strong>åˆ†å‰²</strong>æˆå¤šä¸ªéƒ¨åˆ†ï¼ˆåˆ†ç‰‡ï¼‰ï¼Œå¹¶å°†è¿™äº›åˆ†ç‰‡<strong>åˆ†æ•£å­˜å‚¨</strong>åœ¨ä¸åŒçš„åœ°ç‚¹æˆ–äººé‚£é‡Œã€‚ä»¥ä¸‹æ˜¯ç§é’¥åˆ†ç‰‡æ¢å¤çš„ä¸€èˆ¬æ­¥éª¤ï¼š</p><ol><li><strong>ç§é’¥åˆ†ç‰‡</strong>ï¼šç”¨æˆ·çš„ç§é’¥è¢«<strong>åˆ†å‰²</strong>æˆå¤šä¸ªåˆ†ç‰‡ï¼Œæ¯ä¸ªåˆ†ç‰‡éƒ½é€šè¿‡<strong>æŸç§åŠ å¯†</strong>æ–¹æ³•è¿›è¡Œ<strong>ä¿</strong>æŠ¤ã€‚</li><li><strong>åˆ†ç‰‡å­˜å‚¨</strong>ï¼šè¿™äº›åˆ†ç‰‡å¯ä»¥å­˜å‚¨åœ¨ç”¨æˆ·çš„å¤šä¸ªè®¾å¤‡ä¸Šã€äº‘ç«¯æœåŠ¡ã€æˆ–è€…äº¤ç»™<strong>ä¿¡ä»»</strong>çš„æœ‹å‹ä¿ç®¡ã€‚</li><li><strong>åˆ†ç‰‡æ¢å¤</strong>ï¼šå½“ç”¨æˆ·éœ€è¦æ¢å¤ç§é’¥æ—¶ï¼Œä»–ä»¬<strong>éœ€è¦æ”¶é›†ä¸€å®šæ•°é‡</strong>çš„åˆ†ç‰‡ï¼ˆæ ¹æ®è®¾å®šçš„é˜ˆå€¼ï¼Œä¾‹å¦‚5ä¸ªåˆ†ç‰‡ä¸­çš„3ä¸ªï¼‰ã€‚</li><li><strong>é‡ç»„ç§é’¥</strong>ï¼šæ”¶é›†åˆ°<strong>è¶³å¤Ÿ</strong>çš„åˆ†ç‰‡åï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ä¸€ä¸ªè§£å¯†è¿‡ç¨‹é‡ç»„åŸå§‹çš„ç§é’¥ã€‚</li><li><strong>è®¿é—®é’±åŒ…</strong>ï¼šä¸€æ—¦ç§é’¥è¢«<strong>é‡ç»„</strong>ï¼Œç”¨æˆ·å°±å¯ä»¥é‡æ–°è®¿é—®ä»–ä»¬çš„é’±åŒ…ã€‚</li></ol><h1 id="11-EVM-é“¾-AA-é’±åŒ…"><a href="#11-EVM-é“¾-AA-é’±åŒ…" class="headerlink" title="11. EVM é“¾ AA é’±åŒ…"></a>11. EVM é“¾ AA é’±åŒ…</h1><p>EIP4337 è´¦æˆ·æŠ½è±¡é’±åŒ…ä¸ä»…ä»…æ˜¯æ™®é€šçš„é’±åŒ…ï¼Œå®ƒä»¬æœ¬èº«å°±æ˜¯æ™ºèƒ½åˆçº¦, ä¸»è¦æœ‰å®‰å…¨æ€§é«˜ï¼Œgas ä»£ä»˜ç­‰ç‰¹ç‚¹ï¼Œç›®å‰å¾ˆå¤šå…¬å¸å’Œé¡¹ç›®æ–¹éƒ½å·²ç»æˆ–è€…æ­£åœ¨é›†æˆè´¦æˆ·æŠ½è±¡é’±åŒ…ï¼Œä½†æ˜¯ AA é’±åŒ…ç›®å‰ä¸æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„èµ›é“ï¼Œå®é™…åº”ç”¨çš„å…¬å¸å¹¶ä¸å¤šã€‚â€”â€“EVMé“¾AAé’±åŒ…å¯ä»¥ç†è§£ä¸ºå°±æ˜¯åªèƒ½åˆçº¦é’±åŒ…</p><h2 id="11-1-æ ¸å¿ƒç‰¹ç‚¹"><a href="#11-1-æ ¸å¿ƒç‰¹ç‚¹" class="headerlink" title="11.1 æ ¸å¿ƒç‰¹ç‚¹"></a>11.1 æ ¸å¿ƒç‰¹ç‚¹</h2><ol><li><strong>æ™ºèƒ½åˆçº¦é’±åŒ…</strong>ï¼šAAé’±åŒ…æœ¬èº«å°±æ˜¯éƒ¨ç½²åœ¨åŒºå—é“¾ä¸Šçš„<strong>æ™ºèƒ½åˆçº¦</strong>ã€‚</li><li><strong>å†…ç½®å®‰å…¨æ€§</strong>ï¼šé€šè¿‡æ™ºèƒ½åˆçº¦çš„ä»£ç å¯ä»¥å®æ–½å¤æ‚çš„å®‰å…¨ç­–ç•¥ã€‚</li><li><strong>Gasä»£ä»˜</strong>ï¼šå…è®¸ç”¨æˆ·åœ¨æ‰§è¡Œäº¤æ˜“æ—¶ç”±ç¬¬ä¸‰æ–¹ä»£ä»˜<strong>Gasè´¹ç”¨</strong>ã€‚</li></ol><h2 id="11-2-æ¶æ„å’Œå·¥ä½œåŸç†"><a href="#11-2-æ¶æ„å’Œå·¥ä½œåŸç†" class="headerlink" title="11.2 æ¶æ„å’Œå·¥ä½œåŸç†"></a>11.2 æ¶æ„å’Œå·¥ä½œåŸç†</h2><ol><li><strong>è´¦æˆ·æŠ½è±¡</strong>ï¼šä¸ä¼ ç»Ÿé’±åŒ…ä¸åŒï¼ŒAAé’±åŒ…å°†è´¦æˆ·å’Œäº¤æ˜“çš„å‘é€è€…<strong>æŠ½è±¡</strong>åŒ–ï¼Œå…è®¸æ›´<strong>çµæ´»</strong>çš„äº¤æ˜“å‘èµ·å’Œç­¾åæ–¹å¼ã€‚</li><li><strong>äº¤æ˜“æ„é€ </strong>ï¼šäº¤æ˜“çš„æ„é€ å¯ä»¥åœ¨é“¾ä¸Šå®Œæˆï¼Œç”¨æˆ·æˆ–ç¬¬ä¸‰æ–¹å¯ä»¥ä»£è¡¨AAé’±åŒ…æ„é€ äº¤æ˜“ã€‚</li><li><strong>ç­¾åæœºåˆ¶</strong>ï¼šAAé’±åŒ…å¯ä»¥ä½¿ç”¨<strong>å¤šç§ç­¾å</strong>æœºåˆ¶ï¼ŒåŒ…æ‹¬ä½†ä¸é™äºä¼ ç»Ÿçš„ECDSAç­¾åã€‚</li></ol><h2 id="11-3-ä¸»è¦åŠŸèƒ½"><a href="#11-3-ä¸»è¦åŠŸèƒ½" class="headerlink" title="11.3 ä¸»è¦åŠŸèƒ½"></a>11.3 ä¸»è¦åŠŸèƒ½</h2><ol><li><strong>ä»£ä»˜äº¤æ˜“</strong>ï¼šæ”¯æŒGas<strong>ä»£ä»˜</strong>åŠŸèƒ½ï¼Œå…è®¸ç¬¬ä¸‰æ–¹æ”¯ä»˜äº¤æ˜“è´¹ç”¨ã€‚</li><li><strong>è‡ªå®šä¹‰äº¤æ˜“</strong>ï¼šç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰äº¤æ˜“å±æ€§ï¼Œå¦‚nonceã€gasé™åˆ¶ç­‰ã€‚</li><li><strong>å¤šç­¾äº¤æ˜“</strong>ï¼šå¯ä»¥é›†æˆ<strong>å¤šç­¾å</strong>æœºåˆ¶ï¼Œæé«˜äº¤æ˜“çš„å®‰å…¨æ€§ã€‚</li><li><strong>æ™ºèƒ½åˆçº¦äº¤äº’</strong>ï¼šä½œä¸ºæ™ºèƒ½åˆçº¦ï¼ŒAAé’±åŒ…<strong>å¯ä»¥ä¸å…¶ä»–æ™ºèƒ½åˆçº¦</strong>è¿›è¡Œäº¤äº’ã€‚</li></ol><h2 id="11-4-æ“ä½œæµç¨‹"><a href="#11-4-æ“ä½œæµç¨‹" class="headerlink" title="11.4 æ“ä½œæµç¨‹"></a>11.4 æ“ä½œæµç¨‹</h2><ol><li><strong>éƒ¨ç½²é’±åŒ…</strong>ï¼šåœ¨ä»¥å¤ªåŠé“¾ä¸Šéƒ¨ç½²AAé’±åŒ…æ™ºèƒ½åˆçº¦ã€‚</li><li><strong>èµ„é‡‘å­˜å…¥</strong>ï¼šç”¨æˆ·å°†èµ„é‡‘å­˜å…¥AAé’±åŒ…åˆçº¦åœ°å€ã€‚</li><li><strong>äº¤æ˜“æ„é€ </strong>ï¼šç”¨æˆ·æˆ–ç¬¬ä¸‰æ–¹æ„é€ äº¤æ˜“ï¼ŒåŒ…æ‹¬ç¡®å®šæ¥æ”¶è€…ã€é‡‘é¢å’Œæ•°æ®ã€‚</li><li><strong>äº¤æ˜“ç­¾å</strong>ï¼šæ ¹æ®AAé’±åŒ…çš„é…ç½®ï¼Œå¯èƒ½éœ€è¦ç”¨æˆ·æˆ–å…¶ä»–å‚ä¸æ–¹çš„ç­¾åã€‚</li><li><strong>äº¤æ˜“æ‰§è¡Œ</strong>ï¼šå°†æ„é€ å¥½çš„äº¤æ˜“å‘é€åˆ°åŒºå—é“¾ç½‘ç»œï¼Œç”±ç½‘ç»œä¸­çš„èŠ‚ç‚¹éªŒè¯å’Œæ‰§è¡Œã€‚</li></ol><h2 id="11-5-å®‰å…¨æ€§"><a href="#11-5-å®‰å…¨æ€§" class="headerlink" title="11.5 å®‰å…¨æ€§"></a>11.5 å®‰å…¨æ€§</h2><ol><li><strong>æ™ºèƒ½åˆçº¦å®‰å…¨</strong>ï¼šå®‰å…¨æ€§ä¾èµ–äºæ™ºèƒ½åˆçº¦ä»£ç çš„<strong>å¥å£®æ€§</strong>ï¼Œéœ€è¦ç»è¿‡ä¸¥æ ¼çš„å®‰å…¨å®¡è®¡ã€‚</li><li><strong>å¤šç­¾æ”¯æŒ</strong>ï¼šå¦‚æœé›†æˆå¤šç­¾åæœºåˆ¶ï¼Œå¯ä»¥å¢åŠ äº¤æ˜“çš„å®‰å…¨æ€§ã€‚</li><li><strong>è‡ªå®šä¹‰å®‰å…¨ç­–ç•¥</strong>ï¼šå¯ä»¥é€šè¿‡æ™ºèƒ½åˆçº¦å®ç°è‡ªå®šä¹‰çš„å®‰å…¨ç­–ç•¥å’Œæ£€æŸ¥ã€‚</li></ol><h2 id="11-6-ç”¨æˆ·ä½“éªŒ"><a href="#11-6-ç”¨æˆ·ä½“éªŒ" class="headerlink" title="11.6 ç”¨æˆ·ä½“éªŒ"></a>11.6 ç”¨æˆ·ä½“éªŒ</h2><ol><li><strong>çµæ´»æ€§</strong>ï¼šæä¾›äº†é«˜åº¦çµæ´»çš„äº¤æ˜“æ„é€ å’Œç­¾åæ–¹å¼ã€‚</li><li><strong>é™ä½æˆæœ¬</strong>ï¼šé€šè¿‡Gasä»£ä»˜åŠŸèƒ½ï¼Œå¯ä»¥é™ä½ç”¨æˆ·çš„äº¤æ˜“æˆæœ¬ã€‚</li><li><strong>å¤æ‚æ€§</strong>ï¼šç›¸æ¯”äºä¼ ç»Ÿé’±åŒ…ï¼ŒAAé’±åŒ…çš„è®¾ç½®å’Œä½¿ç”¨å¯èƒ½æ›´å¤æ‚ã€‚</li></ol><h2 id="11-7-ä¼˜åŠ¿ä¸åŠ£åŠ¿"><a href="#11-7-ä¼˜åŠ¿ä¸åŠ£åŠ¿" class="headerlink" title="11.7 ä¼˜åŠ¿ä¸åŠ£åŠ¿"></a>11.7 ä¼˜åŠ¿ä¸åŠ£åŠ¿</h2><ul><li><strong>ä¼˜åŠ¿</strong>ï¼šæä¾›æ›´é«˜çš„å®‰å…¨æ€§ï¼›æ”¯æŒGasä»£ä»˜ï¼›å…è®¸çµæ´»çš„äº¤æ˜“æ„é€ å’Œç­¾åæ–¹å¼ã€‚</li><li><strong>åŠ£åŠ¿</strong>ï¼šéœ€è¦ç”¨æˆ·ç†è§£æ™ºèƒ½åˆçº¦çš„æ¦‚å¿µï¼›å¯èƒ½å­˜åœ¨æ™ºèƒ½åˆçº¦å®‰å…¨é£é™©ã€‚</li></ul><p>AA é’±åŒ…å’Œ  gnosis safe å¤šç­¾é’±åŒ…ä¸€æ ·ï¼Œå¾ˆå¤šéƒ½æ˜¯æ™ºèƒ½åˆçº¦ï¼Œæ•…è€Œæˆ‘ä¹Ÿåœ¨æ™ºèƒ½åˆçº¦ç« èŠ‚ä¸­ä»”ç»†è®²è§£å®ƒï¼Œ è¿™é‡Œä¸åœ¨åšè¿‡å¤šçš„èµ˜è¿°ã€‚</p><p>å¦‚æœæœ‰å…´è¶£ï¼Œæ›´å¤šè¯¦æƒ…å¯ä»¥å‚é˜…ï¼š</p><p><a href="https://eips.ethereum.org/EIPS/eip-4337">https://eips.ethereum.org/EIPS/eip-4337</a></p><h1 id="12æ€»ç»“"><a href="#12æ€»ç»“" class="headerlink" title="12æ€»ç»“"></a>12æ€»ç»“</h1><p>å¯¹äºé’±åŒ…æ¥è¯´ï¼Œå¤§å®¶éœ€è¦æ›´å¥½çš„æŒæ¡<strong>äº¤æ˜“æ‰€é’±åŒ…</strong>ï¼Œ<strong>å»ä¸­å¿ƒåŒ–é’±åŒ…</strong>ï¼Œ<strong>ç¡¬ä»¶é’±åŒ…</strong>å’Œ <strong>MPC æ‰˜ç®¡é’±åŒ…</strong>ï¼Œç›®å‰è¿™å››ç§é’±åŒ…<code>åº”ç”¨æœ€å¹¿æ³›</code>ï¼Œ<code>å·¥ä½œå²—ä½æœ€å¤š</code>ã€‚å…³äº gnosis safe å¤šç­¾é’±åŒ…,  AA é’±åŒ…ç­‰ï¼Œ<strong>äº†è§£</strong>å³å¯ä»¥ï¼Œéœ€è¦ä½¿ç”¨çš„æ—¶å€™å†å­¦ä¹ å°±è¡Œäº†ã€‚è¯è™½ç„¶è¿™æ ·è¯´ï¼Œä½†æ˜¯å…³äº gnosis safe å¤šç­¾é’±åŒ…å’Œ AA é’±åŒ…ï¼Œæˆ‘ä»¬åœ¨æ™ºèƒ½åˆçº¦é˜¶æ®µçš„è¯¾ç¨‹ä¸­ä¹Ÿä¼šç»™å¤§å®¶è¯¦ç»†è®²è§£ã€‚</p><p>å€¼å¾—ä¸€è¯´çš„æ˜¯ï¼Œæ•´ä¸ªé’±åŒ…è¯¾ç¨‹ä½¿ç”¨æ€»-åˆ†-æ€»çš„å½¢åŠ¿é“ºå¼€ï¼Œå…ˆæ•´ä½“ç†è§£é’±åŒ…çš„ç±»åˆ«ï¼Œæ¶æ„ä»¥åŠå„æ¨¡å—çš„å®ç°é€»è¾‘ï¼Œç„¶åå†æ·±å…¥è®²è§£é’±åŒ…çš„çŸ¥è¯†ç»†èŠ‚ï¼Œæœ€åé€šè¿‡é¡¹ç›®å®æˆ˜çš„å½¢åŠ¿æ”¶å›åˆ°è¿™ç¯‡æ–‡ç« ã€‚å½“ç„¶ï¼Œæ•´ä¸ªé’±åŒ…è¯¾ç¨‹ä¹Ÿæ˜¯æ ¹æ®è¿™ç¯‡æ–‡ç« å±•å¼€çš„ï¼Œè¿™ç¯‡æ–‡ç« çš„å†…å®¹ä¹Ÿæ˜¯æˆ‘ä»¬é’±åŒ…è¯¾ç¨‹ç¬¬ä¸€èŠ‚è¯¾çš„å†…å®¹ï¼Œå¸Œæœ›å¤§å®¶æœ‰æ—¶é—´å¥½å¥½é˜…è¯»ï¼Œæ·±å…¥ä½“ä¼šã€‚</p><h1 id="13-æ‹“å±•ã€ä¸web3æ— å…³ã€‘"><a href="#13-æ‹“å±•ã€ä¸web3æ— å…³ã€‘" class="headerlink" title="13 æ‹“å±•ã€ä¸web3æ— å…³ã€‘"></a>13 æ‹“å±•ã€ä¸web3æ— å…³ã€‘</h1><p>åŸåˆ™ä¸Šä¸šåŠ¡å±‚å°±æ˜¯äº¤æ˜“æ‰€ä¸ç”¨æˆ·ç›¸å…³çš„ä¸šåŠ¡ï¼Œ</p><p>é’±åŒ…å±‚å’Œä¸šåŠ¡å±‚ä¹‹é—´æœ‰é€šçŸ¥ä¸šåŠ¡ï¼Œæœ‰ç»Ÿä¸€çš„é€šçŸ¥APIï¼Œé€šè®¯ç”¨gRPC</p><p>RestAPIã€gRPCã€RPCã€webSocketAPIã€GraphQLè¯¥æ€ä¹ˆé€‰ç”¨ï¼Ÿ</p><p>RestAPIï¼šå°±æ˜¯å¾®æœåŠ¡æ¯”è¾ƒå¸¸ç”¨é‚£ä¸€å¥—</p><p>ä¸ºä»€ä¹ˆå†…éƒ¨ç³»ç»Ÿç”¨gRPCé€šè®¯ï¼Ÿâ€“&gt; å¿«ä¸”å®‰å…¨</p><p>å½“æ¶‰åŠåˆ°ä¸åŒçš„é€šä¿¡åè®®å’ŒAPIï¼Œä»¥ä¸‹æ˜¯å¯¹æ¯ç§é€šä¿¡æ–¹å¼çš„ç®€è¦ä»‹ç»ï¼š</p><ol><li>REST APIï¼ˆRepresentational State Transfer APIï¼‰ï¼š<ul><li>è¿™ä¸ªæ¯”è¾ƒå¤šäº†ï¼Œå¾®æœåŠ¡çš„å“ªå¥—å°±æ˜¯ï¼Œè¯·æ±‚å“åº”ä¹‹ç±»çš„</li><li>REST API æ˜¯ä¸€ç§åŸºäº HTTP åè®®çš„é€šä¿¡æ–¹å¼ï¼Œç”¨äºåœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´ä¼ è¾“æ•°æ®ã€‚</li><li>å®¢æˆ·ç«¯é€šè¿‡å‘é€ä¸åŒçš„ HTTP æ–¹æ³•ï¼ˆå¦‚ GETã€POSTã€PUTã€DELETEï¼‰è¯·æ±‚æ¥æ“ä½œå’Œè·å–èµ„æºã€‚</li><li>REST API ä½¿ç”¨ç»Ÿä¸€çš„èµ„æºæ ‡è¯†ç¬¦ï¼ˆURLï¼‰æ¥è¡¨ç¤ºä¸åŒçš„èµ„æºï¼Œå¹¶ä½¿ç”¨ HTTP çŠ¶æ€ç æ¥è¡¨ç¤ºæ“ä½œç»“æœã€‚</li></ul></li><li>gRPCï¼š<ul><li>gRPC æ˜¯ä¸€ç§é«˜æ€§èƒ½çš„è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼ˆRPCï¼‰æ¡†æ¶ï¼Œä½¿ç”¨ Protocol Buffersï¼ˆprotobufï¼‰ä½œä¸ºæ¥å£å®šä¹‰è¯­è¨€ï¼ˆIDLï¼‰å’Œæ•°æ®åºåˆ—åŒ–æœºåˆ¶ã€‚</li><li>gRPC æ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ï¼Œå¹¶ä½¿ç”¨åŸºäº HTTP&#x2F;2 çš„ä¼ è¾“åè®®ï¼Œæä¾›äº†åŒå‘æµå¼é€šä¿¡ã€æµå¼ä¼ è¾“å’Œé«˜æ•ˆçš„åºåˆ—åŒ–ã€‚</li><li>å®ƒå¯ä»¥ç”¨äºæ„å»ºåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œä»¥ä¾¿ä¸åŒçš„æœåŠ¡ä¹‹é—´è¿›è¡Œè·¨ç½‘ç»œçš„é€šä¿¡å’Œè°ƒç”¨ã€‚</li></ul></li><li>RPCï¼ˆRemote Procedure Callï¼‰ï¼š<ul><li>RPC æ˜¯ä¸€ç§é€šä¿¡åè®®ï¼Œç”¨äºå®ç°ä¸åŒè®¡ç®—æœºèŠ‚ç‚¹ä¹‹é—´çš„è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ã€‚</li><li>å®¢æˆ·ç«¯é€šè¿‡è°ƒç”¨è¿œç¨‹çš„è¿‡ç¨‹ï¼ˆå‡½æ•°ï¼‰æ¥è¯·æ±‚æ‰§è¡Œç‰¹å®šçš„æ“ä½œï¼Œç„¶åä»è¿œç¨‹æœåŠ¡ç«¯è·å–ç»“æœã€‚</li><li>RPC æä¾›äº†ä¸€ç§é€æ˜çš„è¿œç¨‹è°ƒç”¨æœºåˆ¶ï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥åƒè°ƒç”¨æœ¬åœ°å‡½æ•°ä¸€æ ·è°ƒç”¨è¿œç¨‹å‡½æ•°ã€‚</li></ul></li><li>WebSocket APIï¼š<ul><li>å»ºç«‹è¿æ¥ä¹‹åï¼Œä¼šä¸€ç›´é€šè®¯ï¼Œæ¯”å¦‚è¯´Kçº¿å›¾ï¼Œå°±ä¸€ç›´åœ¨æ¥æ”¶æ•°æ®</li><li>WebSocket æ˜¯ä¸€ç§åœ¨å•ä¸ª TCP è¿æ¥ä¸Šå®ç°å…¨åŒå·¥é€šä¿¡çš„åè®®ã€‚</li><li>WebSocket API å…è®¸å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´å»ºç«‹æŒä¹…æ€§çš„è¿æ¥ï¼Œå®ç°å®æ—¶æ•°æ®ä¼ è¾“å’ŒåŒå‘é€šä¿¡ã€‚</li><li>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥é€šè¿‡ WebSocket è¿æ¥è¿›è¡Œå®æ—¶çš„æ¶ˆæ¯ä¼ é€’ï¼Œä¸éœ€è¦æ¯æ¬¡è¯·æ±‚éƒ½å»ºç«‹æ–°çš„è¿æ¥ã€‚</li></ul></li><li>GraphQLï¼š<ul><li>GraphQL æ˜¯ä¸€ç§ç”¨äºæ„å»º API çš„æŸ¥è¯¢è¯­è¨€å’Œè¿è¡Œæ—¶ã€‚ </li><li>å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡å®šä¹‰è‡ªå·±æ‰€éœ€çš„æŸ¥è¯¢ç»“æ„æ¥ç²¾ç¡®è·å–æ•°æ®ï¼Œé¿å…äº†è¿‡åº¦è·å–æˆ–å¤šæ¬¡è¯·æ±‚çš„é—®é¢˜ã€‚</li><li>GraphQL æä¾›äº†å¼ºç±»å‹çš„æ•°æ®éªŒè¯å’Œå®¢æˆ·ç«¯é©±åŠ¨çš„æ•°æ®è·å–æ–¹å¼ï¼Œä½¿å¾—å®¢æˆ·ç«¯å¯ä»¥æ›´çµæ´»åœ°è·å–æ•°æ®ã€‚</li></ul></li></ol><p>è¿™äº›é€šä¿¡æ–¹å¼åœ¨ä¸åŒçš„åº”ç”¨åœºæ™¯ä¸­æœ‰å„è‡ªçš„ä¼˜åŠ¿å’Œé€‚ç”¨æ€§ã€‚é€‰æ‹©åˆé€‚çš„é€šä¿¡æ–¹å¼å–å†³äºç³»ç»Ÿéœ€æ±‚ã€æ€§èƒ½è¦æ±‚ã€æ•°æ®ä¼ è¾“æ–¹å¼ç­‰å› ç´ ã€‚</p><p>æœ‰çŠ¶æ€ï¼ˆStatefulï¼‰å’Œæ— çŠ¶æ€ï¼ˆStatelessï¼‰æ˜¯ä¸è®¡ç®—æœºç³»ç»Ÿæˆ–åº”ç”¨ç¨‹åºçš„çŠ¶æ€ç®¡ç†ç›¸å…³çš„æ¦‚å¿µã€‚</p><p>æœ‰çŠ¶æ€ï¼ˆStatefulï¼‰æŒ‡çš„æ˜¯ç³»ç»Ÿæˆ–åº”ç”¨ç¨‹åºåœ¨å¤„ç†è¯·æ±‚æˆ–äº¤äº’æ—¶ï¼Œä¼šè®°å½•å’Œä¿å­˜ç›¸å…³çš„çŠ¶æ€ä¿¡æ¯ã€‚è¿™æ„å‘³ç€ç³»ç»Ÿåœ¨ä¸åŒçš„è¯·æ±‚ä¹‹é—´ä¼šä¿ç•™å¹¶ä½¿ç”¨ä¹‹å‰çš„çŠ¶æ€æ•°æ®ã€‚æœ‰çŠ¶æ€ç³»ç»Ÿä¼šç»´æŠ¤ä¸€ä¸ªä¼šè¯çŠ¶æ€ï¼Œä»¥ä¾¿è·Ÿè¸ªç”¨æˆ·çš„æ“ä½œå’Œæ•°æ®ã€‚ä¾‹å¦‚ï¼Œä¼ ç»Ÿçš„ Web åº”ç”¨ç¨‹åºé€šå¸¸ä½¿ç”¨ä¼šè¯æ¥è·Ÿè¸ªç”¨æˆ·ç™»å½•çŠ¶æ€å’Œè´­ç‰©è½¦å†…å®¹ã€‚webSocketå°±æ˜¯æœ‰çŠ¶æ€çš„é€šè®¯</p><p>æ— çŠ¶æ€ï¼ˆStatelessï¼‰æŒ‡çš„æ˜¯ç³»ç»Ÿæˆ–åº”ç”¨ç¨‹åºåœ¨å¤„ç†è¯·æ±‚æˆ–äº¤äº’æ—¶ï¼Œä¸ä¼šå­˜å‚¨ä»»ä½•ç›¸å…³çš„çŠ¶æ€ä¿¡æ¯ã€‚æ¯ä¸ªè¯·æ±‚éƒ½æ˜¯ç‹¬ç«‹çš„ï¼ŒæœåŠ¡å™¨ä¸ä¼šä¿æŒå®¢æˆ·ç«¯çš„çŠ¶æ€ä¿¡æ¯ã€‚æœåŠ¡å™¨ä»…æ ¹æ®æ¯ä¸ªè¯·æ±‚çš„æ•°æ®è¿›è¡Œå¤„ç†ï¼Œå¹¶è¿”å›ç›¸åº”çš„ç»“æœã€‚æ— çŠ¶æ€ç³»ç»Ÿæ›´åŠ ç®€å•å’Œå¯ä¼¸ç¼©ï¼Œå› ä¸ºå®ƒä»¬ä¸éœ€è¦ç»´æŠ¤å’ŒåŒæ­¥çŠ¶æ€ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼ŒREST API æ˜¯ä¸€ç§æ— çŠ¶æ€çš„é€šä¿¡æ–¹å¼ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½åŒ…å«è¶³å¤Ÿçš„ä¿¡æ¯æ¥è¿›è¡Œå¤„ç†ï¼ŒæœåŠ¡å™¨ä¸éœ€è¦ä¿æŒå®¢æˆ·ç«¯çš„çŠ¶æ€ã€‚gRPCå’ŒREST APIå°±æ˜¯æ— çŠ¶æ€çš„é€šè®¯</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go">boil basket mountain fruit tissue burst april legal increase spice original apple<br><br><span class="hljs-number">0xa3856a939A623EdBde8f908037d3F33FceBC5408</span><br>c535facd6873ca2b3718e3ede4f626ae126c99b4a26b4354da704d8dc78b43c1<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>blockChain</category>
      
    </categories>
    
    
    <tags>
      
      <tag>block</tag>
      
      <tag>æ¦‚å¿µ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>02 æ¢è®¨äº‹åŠ¡ä¸€è‡´æ€§</title>
    <link href="/2024/05/18/02%E6%8E%A2%E8%AE%A8%E4%BA%8B%E5%8A%A1%E4%B8%80%E8%87%B4%E6%80%A7/"/>
    <url>/2024/05/18/02%E6%8E%A2%E8%AE%A8%E4%BA%8B%E5%8A%A1%E4%B8%80%E8%87%B4%E6%80%A7/</url>
    
    <content type="html"><![CDATA[<h2 id="1-äº‹åŠ¡çš„ACIDç‰¹æ€§"><a href="#1-äº‹åŠ¡çš„ACIDç‰¹æ€§" class="headerlink" title="1.äº‹åŠ¡çš„ACIDç‰¹æ€§"></a>1.äº‹åŠ¡çš„ACIDç‰¹æ€§</h2><p>åœ¨æ•°æ®åº“ä¸­ï¼Œâ€œäº‹åŠ¡â€æ˜¯ç”±å¤šä¸ªæ“ä½œæ„æˆçš„åºåˆ—ã€‚å¹¿ä¹‰ä¸Šçš„äº‹åŠ¡ä¸€è‡´æ€§å…·åŒ–åˆ°äº†åŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§å’ŒæŒä¹…æ€§è¿™4ä¸ªæ–¹é¢ã€‚</p><ol><li><code>åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼š</code>æŒ‡äº‹åŠ¡æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„æ“ä½œå•å…ƒï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡ŒæˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥å›æ»šã€‚å¦‚æœäº‹åŠ¡ä¸­çš„ä»»ä½•ä¸€ä¸ªæ“ä½œå¤±è´¥ï¼Œæ•´ä¸ªäº‹åŠ¡å°†å›æ»šåˆ°æœ€åˆçš„çŠ¶æ€ã€‚</li><li><code>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼š</code>æŒ‡äº‹åŠ¡å°†æ•°æ®åº“ä»ä¸€ä¸ªä¸€è‡´çŠ¶æ€è½¬å˜ä¸ºå¦ä¸€ä¸ªä¸€è‡´çŠ¶æ€ã€‚åœ¨äº‹åŠ¡å¼€å§‹å’Œç»“æŸæ—¶ï¼Œæ•°æ®åº“å¿…é¡»æ»¡è¶³é¢„å®šä¹‰çš„ä¸€è‡´æ€§è§„åˆ™ï¼Œä»¥ä¿æŒæ•°æ®çš„æœ‰æ•ˆæ€§å’Œå®Œæ•´æ€§ã€‚</li><li><code>éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼š</code>æŒ‡æ¯ä¸ªäº‹åŠ¡çš„æ‰§è¡Œåº”è¯¥ä¸å…¶ä»–äº‹åŠ¡çš„æ‰§è¡Œç›¸äº’éš”ç¦»ï¼Œä»¥é˜²æ­¢å½¼æ­¤å¹²æ‰°ã€‚éš”ç¦»çº§åˆ«å®šä¹‰äº†äº‹åŠ¡ä¹‹é—´çš„éš”ç¦»ç¨‹åº¦ï¼ŒåŒ…æ‹¬å·²æäº¤è¯»ã€å¯é‡å¤è¯»ã€å¿«ç…§éš”ç¦»å’Œå¯ä¸²è¡ŒåŒ–ã€‚</li><li><code>æŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼š</code>æŒ‡ä¸€æ—¦äº‹åŠ¡æäº¤ï¼Œå…¶ç»“æœå°±åº”è¯¥æ°¸ä¹…ä¿å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œå³ä½¿ç³»ç»Ÿå‘ç”Ÿæ•…éšœä¹Ÿä¸ä¼šä¸¢å¤±ã€‚æ•°æ®åº“é€šè¿‡å°†äº‹åŠ¡æ—¥å¿—æŒä¹…åŒ–åˆ°ç£ç›˜æ¥å®ç°æŒä¹…æ€§ã€‚</li></ol><h3 id="1-1-åŸå­æ€§å’Œä¸€è‡´æ€§çš„å·®å¼‚"><a href="#1-1-åŸå­æ€§å’Œä¸€è‡´æ€§çš„å·®å¼‚" class="headerlink" title="1.1 åŸå­æ€§å’Œä¸€è‡´æ€§çš„å·®å¼‚"></a>1.1 åŸå­æ€§å’Œä¸€è‡´æ€§çš„å·®å¼‚</h3><p><code>åŸå­æ€§</code>å…³æ³¨äº‹åŠ¡å†…éƒ¨çŠ¶æ€ï¼Œè¦ä¸å…¨éƒ¨æˆåŠŸï¼Œè¦ä¸å…¨éƒ¨å¤±è´¥</p><p><code>ä¸€è‡´æ€§</code>å…³æ³¨æ•°æ®å¯è§æ€§ï¼Œä¸­é—´çŠ¶æ€çš„æ•°æ®å¯¹å¤–ä¸å¯è§ï¼Œåªæœ‰æœ€åˆçŠ¶æ€å’Œæœ€ç»ˆçŠ¶æ€çš„æ•°æ®å¯¹å¤–å¯è§</p><h3 id="1-2-æŒä¹…æ€§æ ¸å¿ƒæ€æƒ³å³åº”å¯¹ç³»ç»Ÿæ•…éšœ"><a href="#1-2-æŒä¹…æ€§æ ¸å¿ƒæ€æƒ³å³åº”å¯¹ç³»ç»Ÿæ•…éšœ" class="headerlink" title="1.2 æŒä¹…æ€§æ ¸å¿ƒæ€æƒ³å³åº”å¯¹ç³»ç»Ÿæ•…éšœ"></a>1.2 æŒä¹…æ€§æ ¸å¿ƒæ€æƒ³å³åº”å¯¹ç³»ç»Ÿæ•…éšœ</h3><blockquote><p>ç›®çš„éƒ½æ˜¯ä¿è¯åœ¨æœ¬åœ°èŠ‚ç‚¹ä¹‹å¤–ï¼Œè‡³å°‘æœ‰ä¸€ä»½å®Œæ•´çš„æ—¥å¿—å¯ç”¨äºæ•°æ®æ¢å¤ã€‚</p></blockquote><p><strong>å­˜å‚¨ç¡¬ä»¶æ— æŸã€å¯æ¢å¤æ•…éšœï¼š</strong> ä¸»è¦ä¾æ‰˜äºé¢„å†™æ—¥å¿—ï¼ˆWrite Ahead Log, WALï¼‰ä¿è¯ç¬¬ä¸€æ—¶é—´å­˜å‚¨æ•°æ®ã€‚WALé‡‡ç”¨é¡ºåºå†™å…¥çš„æ–¹å¼ï¼Œå¯ä»¥ä¿è¯æ•°æ®åº“çš„ä½å»¶æ—¶å“åº”ã€‚</p><p><strong>å­˜å‚¨ç¡¬ä»¶æŸåã€ä¸å¯æ¢å¤çš„æ•…éšœï¼š</strong> éœ€è¦ç”¨åˆ°æ—¥å¿—å¤åˆ¶æŠ€æœ¯ï¼Œå°†æœ¬åœ°æ—¥å¿—åŠæ—¶åŒæ­¥åˆ°å…¶ä»–èŠ‚ç‚¹ã€‚</p><ul><li>å•ä½“æ•°æ®åº“è‡ªå¸¦çš„åŒæ­¥æˆ–åŠåŒæ­¥çš„æ–¹å¼ï¼Œå…¶ä¸­åŠåŒæ­¥æ–¹å¼å…·æœ‰ä¸€å®šçš„å®¹é”™èƒ½åŠ›</li><li>æ—¥å¿—å­˜å‚¨åˆ°å…±äº«å­˜å‚¨ç³»ç»Ÿä¸Šï¼Œåè€…ä¼šé€šè¿‡å†—ä½™å­˜å‚¨ä¿è¯æ—¥å¿—çš„å®‰å…¨æ€§</li><li>åŸºäºPaxos&#x2F;Raftçš„å…±è¯†ç®—æ³•åŒæ­¥æ—¥å¿—æ•°æ®ï¼Œåœ¨åˆ†å¸ƒå¼æ•°æ®åº“ä¸­è¢«å¹¿æ³›ä½¿ç”¨</li></ul><h3 id="1-3-éš”ç¦»æ€§åˆ†ä¸ºå¤šä¸ªéš”ç¦»çº§åˆ«"><a href="#1-3-éš”ç¦»æ€§åˆ†ä¸ºå¤šä¸ªéš”ç¦»çº§åˆ«" class="headerlink" title="1.3 éš”ç¦»æ€§åˆ†ä¸ºå¤šä¸ªéš”ç¦»çº§åˆ«"></a>1.3 éš”ç¦»æ€§åˆ†ä¸ºå¤šä¸ªéš”ç¦»çº§åˆ«</h3><blockquote><p>è¾ƒä½çš„éš”ç¦»çº§åˆ«å°±æ˜¯åœ¨æ­£ç¡®æ€§ä¸Šåšå¦¥åï¼Œå°†ä¸€äº›å¼‚å¸¸ç°è±¡äº¤ç»™åº”ç”¨ç³»ç»Ÿçš„å¼€å‘äººå‘˜å»è§£å†³ï¼Œä»è€Œè·å¾—æ›´å¥½çš„æ€§èƒ½ã€‚</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>blockChain</category>
      
    </categories>
    
    
    <tags>
      
      <tag>block</tag>
      
      <tag>æ¦‚å¿µ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>01 åˆ†å¸ƒå¼åŸºç¡€ç†è®º</title>
    <link href="/2024/05/17/01%E5%88%86%E5%B8%83%E5%BC%8F%E5%9F%BA%E7%A1%80%E7%90%86%E8%AE%BA/"/>
    <url>/2024/05/17/01%E5%88%86%E5%B8%83%E5%BC%8F%E5%9F%BA%E7%A1%80%E7%90%86%E8%AE%BA/</url>
    
    <content type="html"><![CDATA[<h1 id="1-åˆ†å¸ƒå¼ç†è®ºåŸºç¡€"><a href="#1-åˆ†å¸ƒå¼ç†è®ºåŸºç¡€" class="headerlink" title="1.åˆ†å¸ƒå¼ç†è®ºåŸºç¡€"></a>1.åˆ†å¸ƒå¼ç†è®ºåŸºç¡€</h1><h2 id="1-1-CAPç†è®ºæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸºçŸ³"><a href="#1-1-CAPç†è®ºæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸºçŸ³" class="headerlink" title="1.1 CAPç†è®ºæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸºçŸ³"></a>1.1 CAPç†è®ºæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿçš„åŸºçŸ³</h2><h3 id="Consistency-ä¸€è‡´æ€§"><a href="#Consistency-ä¸€è‡´æ€§" class="headerlink" title="Consistency(ä¸€è‡´æ€§):"></a>Consistency(ä¸€è‡´æ€§):</h3><p>â€œall nodes see the same data at the same timeâ€ï¼Œå³æ›´æ–°æ“ä½œæˆåŠŸå¹¶è¿”å›å®¢æˆ·ç«¯ï¼Œæ‰€æœ‰èŠ‚ç‚¹åœ¨åŒä¸€æ—¶é—´çš„æ•°æ®å®Œå…¨ä¸€è‡´ï¼Œä¸€è‡´æ€§çš„é—®é¢˜åœ¨å¹¶å‘ç³»ç»Ÿä¸­ä¸å¯é¿å…ã€‚ï¼ˆæ‰€æœ‰çš„èŠ‚ç‚¹åœ¨åŒä¸€æ—¶åˆ»çœ‹åˆ°çš„æ•°æ®æ˜¯ç›¸åŒçš„ï¼‰</p><p>å¯¹äºå®¢æˆ·ç«¯ï¼Œä¸€è‡´æ€§æŒ‡çš„æ˜¯å¹¶å‘è®¿é—®æ—¶æ›´æ–°è¿‡çš„æ•°æ®å¦‚ä½•è·å–</p><p>å¯¹äºæœåŠ¡ç«¯ï¼Œåˆ™æ˜¯æ›´æ–°å¦‚ä½•å¤åˆ¶åˆ†å¸ƒåˆ°æ•´ä¸ªç³»ç»Ÿï¼Œä»¥ä¿è¯æ•°æ®ä¸€è‡´ã€‚</p><h3 id="Availability-å¯ç”¨æ€§"><a href="#Availability-å¯ç”¨æ€§" class="headerlink" title="Availability (å¯ç”¨æ€§):"></a>Availability (å¯ç”¨æ€§):</h3><p>â€œReads and writes always succeedâ€ï¼Œå³æœåŠ¡ä¸€ç›´å¯ç”¨ï¼Œè€Œä¸”æ˜¯æ­£å¸¸å“åº”æ—¶é—´ã€‚è‰¯å¥½çš„å¯ç”¨æ€§æ˜¯æŒ‡ç³»ç»Ÿèƒ½å¤Ÿå¾ˆå¥½çš„ä¸ºç”¨æˆ·æœåŠ¡ï¼Œä¸å‡ºç°ç”¨æˆ·æ“ä½œå¤±è´¥æˆ–è€…è®¿é—®è¶…æ—¶ç­‰ç”¨æˆ·ä½“éªŒä¸å¥½çš„æƒ…å†µã€‚ï¼ˆå¯ç”¨å˜›ï¼Œå°±æ˜¯æ€»æ˜¯èƒ½æˆåŠŸï¼‰</p><h3 id="Partition-Tolerance-åˆ†åŒºå®¹é”™æ€§"><a href="#Partition-Tolerance-åˆ†åŒºå®¹é”™æ€§" class="headerlink" title="Partition Tolerance (åˆ†åŒºå®¹é”™æ€§):"></a><strong>Partition Tolerance (åˆ†åŒºå®¹é”™æ€§):</strong></h3><p>å³åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é‡åˆ°æŸèŠ‚ç‚¹æˆ–ç½‘ç»œåˆ†åŒºæ•…éšœçš„æ—¶å€™ï¼Œä»ç„¶èƒ½å¤Ÿå¯¹å¤–æä¾›æ»¡è¶³ä¸€è‡´æ€§å’Œå¯ç”¨æ€§çš„æœåŠ¡ã€‚</p><p>æ¯”å¦‚ç°åœ¨çš„åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æœ‰æŸä¸€ä¸ªæˆ–è€…å‡ ä¸ªæœºå™¨å®•æ‰äº†ï¼Œå…¶ä»–å‰©ä¸‹çš„æœºå™¨è¿˜èƒ½å¤Ÿæ­£å¸¸è¿è½¬æ»¡è¶³ç³»ç»Ÿéœ€æ±‚ï¼Œå¯¹äºç”¨æˆ·è€Œè¨€å¹¶æ²¡æœ‰ä»€ä¹ˆä½“éªŒä¸Šçš„å½±å“ï¼Œï¼ˆåˆ«äººå‡ºé—®é¢˜äº†è·Ÿä½ ä¸å½±å“ï¼‰</p><h3 id="1-2-ä¸‰è€…åªèƒ½å–å…¶äºŒ"><a href="#1-2-ä¸‰è€…åªèƒ½å–å…¶äºŒ" class="headerlink" title="1.2 ä¸‰è€…åªèƒ½å–å…¶äºŒ"></a>1.2 ä¸‰è€…åªèƒ½å–å…¶äºŒ</h3><ul><li><strong>CA without Pï¼š</strong> å¦‚æœä¸è¦æ±‚Pï¼ˆä¸å…è®¸åˆ†åŒºï¼‰ï¼Œåˆ™ä¿ç•™Cï¼ˆå¼ºä¸€è‡´æ€§ï¼‰å’ŒAï¼ˆå¯ç”¨æ€§ï¼‰ï¼Œä½†æ”¾å¼ƒPçš„åŒæ—¶ä¹Ÿå°±æ„å‘³ç€æ”¾å¼ƒäº†ç³»ç»Ÿçš„æ‰©å±•æ€§ï¼Œä¹Ÿå°±æ˜¯åˆ†å¸ƒå¼èŠ‚ç‚¹å—é™ï¼Œè¿™æ˜¯æœ‰è¿èƒŒåˆ†å¸ƒå¼ç³»ç»Ÿçš„è®¾è®¡åˆè¡·ã€‚</li><li><strong>CP without Aï¼š</strong> å¦‚æœä¸è¦æ±‚Aï¼ˆå¯ç”¨ï¼‰ï¼Œå¼ºè°ƒå„æœåŠ¡ä¹‹é—´æ•°æ®<code>å¼ºä¸€è‡´æ€§</code>ï¼Œè€ŒPï¼ˆåˆ†åŒºï¼‰ä¼šå¯¼è‡´åŒæ­¥æ—¶é—´æ— é™å»¶é•¿(ç­‰å¾…æ•°æ®åŒæ­¥å®Œæ‰èƒ½æ­£å¸¸è®¿é—®æœåŠ¡)ï¼Œä¸€æ—¦å‘ç”Ÿç½‘ç»œæ•…éšœæˆ–è€…æ¶ˆæ¯ä¸¢å¤±ç­‰æƒ…å†µï¼Œå°±è¦ç‰ºç‰²ç”¨æˆ·çš„ä½“éªŒã€‚</li><li><strong>AP wihtout Cï¼š</strong> è¦é«˜å¯ç”¨å¹¶å…è®¸åˆ†åŒºï¼Œåˆ™éœ€æ”¾å¼ƒä¸€è‡´æ€§ã€‚ä¸€æ—¦åˆ†åŒºå‘ç”Ÿï¼ŒèŠ‚ç‚¹ä¹‹é—´å¯èƒ½ä¼šå¤±å»è”ç³»ï¼Œä¸ºäº†é«˜å¯ç”¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹åªèƒ½ç”¨æœ¬åœ°æ•°æ®æä¾›æœåŠ¡ï¼Œè¿™æ ·ä¼šå¯¼è‡´å…¨å±€æ•°æ®çš„ä¸ä¸€è‡´æ€§ã€‚</li></ul><p>æ²¡æœ‰å®Œç¾çš„åˆ†å¸ƒå¼ï¼Œè¦çœ‹ä½ ä¸ºäº†ä»€ä¹ˆè€Œå»ç‰ºç‰²ä»€ä¹ˆï¼Ÿä½ è¦åˆ†åŒºé‚£å¯èƒ½ä¼šé€ æˆæ•°æ®ä¸ä¸€è‡´çš„å¯èƒ½æ€§ï¼Œä½ è¦ä½ è¦å¼ºä¸€è‡´å’Œé«˜å¯ç”¨ï¼Œé‚£å°±è¦ç‰ºç‰²åˆ†åŒºçš„é«˜æ‹“å±•æ€§ã€‚æ²¡æœ‰å®Œç¾çš„ç³»ç»Ÿï¼Œ</p><h3 id="1-3-BASEç†è®ºï¼ˆä¸€ç§å¦¥åï¼‰"><a href="#1-3-BASEç†è®ºï¼ˆä¸€ç§å¦¥åï¼‰" class="headerlink" title="1.3 BASEç†è®ºï¼ˆä¸€ç§å¦¥åï¼‰"></a>1.3 BASEç†è®ºï¼ˆä¸€ç§å¦¥åï¼‰</h3><p>BASEæ˜¯Basically Availableï¼ˆåŸºæœ¬å¯ç”¨ï¼‰ã€Soft stateï¼ˆè½¯çŠ¶æ€ï¼‰å’Œ Eventually consistentï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰ä¸‰ä¸ªçŸ­è¯­çš„ç¼©å†™</p><p>BASEæ˜¯å¯¹CAPä¸­ä¸€è‡´æ€§å’Œå¯ç”¨æ€§æƒè¡¡çš„ç»“æœï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯ï¼š<strong>å³ä½¿æ— æ³•åšåˆ°å¼ºä¸€è‡´æ€§ï¼Œé‡‡ç”¨é€‚å½“çš„æ–¹å¼ä½¿ç³»ç»Ÿè¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§</strong>ã€‚</p><p><strong>Basically Available:</strong> <strong>åŸºæœ¬å¯ç”¨</strong>æ˜¯æŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°ä¸å¯é¢„çŸ¥æ•…éšœçš„æ—¶å€™ï¼Œ<strong>å…è®¸æŸå¤±</strong>éƒ¨åˆ†å¯ç”¨æ€§ï¼Œä½†ä¸ç­‰ä»·äºç³»ç»Ÿä¸å¯ç”¨ã€‚ç³»ç»Ÿæœ€ç»ˆæ˜¯å¯ç”¨çš„</p><ul><li><strong>ç§’æ€</strong>çš„åœºæ™¯ä¸‹ç”¨æˆ·æ•°é‡æš´å¢ï¼Œä¸ºä¿æŠ¤ç³»ç»Ÿç¨³å®šæ€§ï¼Œæœ‰éƒ¨åˆ†ç”¨æˆ·å¯èƒ½è¢«å¼•å¯¼è‡³ä¸€ä¸ªé™çº§é¡µé¢</li></ul><p><strong>Soft state:</strong> å…è®¸ç³»ç»Ÿä¸­çš„æ•°æ®å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œå¹¶è®¤ä¸ºä¸­é—´çŠ¶æ€ä¸ä¼šå½±å“ç³»ç»Ÿæ•´ä½“å¯ç”¨æ€§ï¼Œå³å…è®¸ç³»ç»Ÿåœ¨ä¸ç”¨èŠ‚ç‚¹ä¹‹é—´æ•°æ®åŒæ­¥å­˜åœ¨å»¶æ—¶ï¼ˆåŠ ä¸­é—´çŠ¶æ€ï¼Œæ¯”å¦‚è¯´æ”¯ä»˜ä¸­ï¼‰ä¸¾ä¸ªä¾‹å­ï¼šå†œä¸šé“¶è¡Œå‘å·¥å•†é“¶è¡Œè½¬è´¦ï¼Œä¼šæœ‰ä¸€ä¸ª5ç§’å·¦å³å»¶è¿Ÿåˆ°è´¦ï¼Œè¿™å°±æ˜¯ä¸­é—´çŠ¶æ€ã€‚</p><p><strong>Eventually consistent:</strong> å¼ºè°ƒæ‰€æœ‰çš„æ•°æ®å‰¯æœ¬åœ¨ç»è¿‡ä¸€æ®µæ—¶é—´åŒæ­¥åï¼Œæœ€ç»ˆèƒ½å¤Ÿè¾¾æˆä¸€è‡´çš„çŠ¶æ€ã€‚æœ€ç»ˆä¿è¯ä¸€è‡´ï¼Œè€Œä¸æ˜¯å®æ—¶ä¿è¯ç³»ç»Ÿä¸€è‡´æ€§ã€‚</p><p>BASEç†è®ºé¢å‘çš„æ˜¯å¤§å‹é«˜å¯ç”¨å¯æ‰©å±•çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå’Œä¼ ç»Ÿçš„äº‹ç‰©ACIDç‰¹æ€§æ˜¯ç›¸åçš„ï¼Œå®ƒå®Œå…¨ä¸åŒäºACIDçš„å¼ºä¸€è‡´æ€§æ¨¡å‹ï¼Œè€Œæ˜¯é€šè¿‡ç‰ºç‰²å¼ºä¸€è‡´æ€§æ¥è·å¾—å¯ç”¨æ€§ï¼Œå¹¶å…è®¸æ•°æ®åœ¨ä¸€æ®µæ—¶é—´å†…æ˜¯ä¸ä¸€è‡´çš„ï¼Œä½†æœ€ç»ˆè¾¾åˆ°ä¸€è‡´çŠ¶æ€ã€‚ä½†åŒæ—¶ï¼Œåœ¨å®é™…çš„åˆ†å¸ƒå¼åœºæ™¯ä¸­ï¼Œä¸åŒä¸šåŠ¡å•å…ƒå’Œç»„ä»¶å¯¹æ•°æ®ä¸€è‡´æ€§çš„è¦æ±‚æ˜¯ä¸åŒçš„ï¼Œå› æ­¤åœ¨å…·ä½“çš„åˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„è®¾è®¡è¿‡ç¨‹ä¸­ï¼ŒACIDç‰¹æ€§å’ŒBASEç†è®ºå¾€å¾€åˆä¼šç»“åˆåœ¨ä¸€èµ·ã€‚</p><h2 id="2-åŒºå—é“¾ä¸å¯èƒ½ä¸‰è§’"><a href="#2-åŒºå—é“¾ä¸å¯èƒ½ä¸‰è§’" class="headerlink" title="2.åŒºå—é“¾ä¸å¯èƒ½ä¸‰è§’"></a>2.åŒºå—é“¾ä¸å¯èƒ½ä¸‰è§’</h2><p>åŒºå—é“¾é€šå¸¸åœ¨<code>å®‰å…¨æ€§</code>ã€<code>å»ä¸­å¿ƒåŒ–</code>å’Œ<code>å¯æ‰©å±•æ€§</code>ä¹‹é—´è¿›è¡Œæƒè¡¡ï¼š</p><ul><li>æ¯”ç‰¹å¸ï¼šé‡ç‚¹æ”¾åœ¨<code>å®‰å…¨æ€§</code>å’Œ<code>å»ä¸­å¿ƒåŒ–</code>ä¸Šï¼Œå› æ­¤å¯¼è‡´æ¯”ç‰¹å¸çš„<code>å¯æ‰©å±•æ€§</code>å—é™ï¼Œå› ä¸ºæ¯”ç‰¹å¸çš„åŒºå—å¤§å°å’ŒåŒºå—æ—¶é—´è®¾å®šé™åˆ¶äº†å®ƒçš„äº¤æ˜“å¤„ç†èƒ½åŠ›ã€‚åœ¨éœ€æ±‚é«˜çš„æ—¶å€™å°±ä¼šå¯¼è‡´äº¤æ˜“å»¶è¿Ÿå’Œæ‰‹ç»­è´¹ä¸Šæ¶¨ï¼ˆå‡å¦‚ä¸€ä¸ªåŒºå—æ—¶é—´æ˜¯5ç§’ï¼Œåœ¨è¿™ä¸ªåŒºå—æ—¶é—´å†…å®ƒçš„äº¤æ˜“å¤„ç†èƒ½åŠ›æ˜¯æœ‰é™çš„ï¼Œå¤ªå¤šäº¤æ˜“è¦å¤„ç†çš„æ—¶å€™ï¼Œå°±ä¼šå½±å“å…¶å¤„ç†æ—¶é—´ï¼Œå’Œæ‰‹ç»­è´¹ä¸Šæ¶¨ï¼‰ã€‚</li><li>ä»¥å¤ªåŠï¼šé‡ç‚¹ä¹Ÿæ”¾åœ¨<code>å®‰å…¨æ€§</code>å’Œ<code>å»ä¸­å¿ƒåŒ–</code>ä¸Šï¼Œå¹¶ä½œä¸ºæ™ºèƒ½åˆçº¦å¹³å°ï¼Œå®ƒéœ€è¦ç¡®ä¿ç”¨æˆ·çš„èµ„äº§å’Œåè®®æ˜¯å®‰å…¨çš„ã€‚å› æ­¤ä»¥å¤ªåŠçš„<code>å¯æ‰©å±•æ€§</code>è¾ƒå·®ï¼Œå°¤å…¶å½“DeFiå’ŒNFTçš„åº”ç”¨é‡å¢å¤§æ—¶ï¼Œäº¤æ˜“å»¶è¿Ÿä¸è´¹ç”¨ä¸Šæ¶¨çš„é—®é¢˜å°¤å…¶çªå‡ºã€‚</li><li>Solanaï¼šä¸»è¦å…³æ³¨<code>å¯æ‰©å±•æ€§</code>å› æ­¤åœ¨å¤„ç†é€Ÿåº¦å’Œååé‡ä¸Šéƒ½éå¸¸é«˜æ•ˆï¼Œä¸ºäº†è¾¾åˆ°è¿™æ ·çš„æ€§èƒ½ï¼Œåœ¨ç½‘ç»œçš„ä¸­å¿ƒåŒ–ç¨‹åº¦ä½œå‡ºäº†ä¸€äº›å¦¥åï¼Œä¾‹å¦‚é™åˆ¶éªŒè¯è€…çš„æ•°é‡ã€‚</li></ul><h2 id="3-æ¦‚ç‡æœ€ç»ˆæ€§å’Œé€å—æœ€ç»ˆæ€§"><a href="#3-æ¦‚ç‡æœ€ç»ˆæ€§å’Œé€å—æœ€ç»ˆæ€§" class="headerlink" title="3.æ¦‚ç‡æœ€ç»ˆæ€§å’Œé€å—æœ€ç»ˆæ€§"></a>3.æ¦‚ç‡æœ€ç»ˆæ€§å’Œé€å—æœ€ç»ˆæ€§</h2><p><code>æ¦‚ç‡æœ€ç»ˆæ€§ï¼š</code>åœ¨æ¯”ç‰¹å¸ç½‘ç»œä¸­ï¼Œç”±äºé‡‡ç”¨äº†Proof-of-Workï¼ˆå·¥ä½œé‡è¯æ˜ï¼‰çš„å…±è¯†ç®—æ³•ã€‚å°½ç®¡ä¸€ä¸ªåŒºå—è¢«æ·»åŠ åˆ°åŒºå—é“¾ä¸Šï¼Œä½†ä»ç„¶å­˜åœ¨ä¸€å®šçš„æ¦‚ç‡ï¼ˆå°½ç®¡å¾ˆå°ï¼‰åœ¨åç»­çš„åŒºå—ä¸­è¢«å¦ä¸€ä¸ªç«äº‰è€…çš„åŒºå—æ‰€å–ä»£ã€‚å› æ­¤ï¼Œå¯¹äºæ¯”ç‰¹å¸ç½‘ç»œæ¥è¯´ï¼Œä¸€ä¸ªæœ€æ–°çš„åŒºå—åœ¨ä¸€æ®µæ—¶é—´åå¯ä»¥è¢«è®¤ä¸ºå…·æœ‰<code>æ¦‚ç‡æœ€ç»ˆæ€§</code>ï¼Œå³éšç€æ›´å¤šçš„åŒºå—è¢«æ·»åŠ åˆ°åŒºå—é“¾ä¸Šï¼Œè¯¥åŒºå—è¢«æ›¿ä»£çš„æ¦‚ç‡ä¼šé€æ¸å‡å°ã€‚</p><p><code>é€å—æœ€ç»ˆæ€§ï¼š</code>å¯¹äºCosmosç½‘ç»œï¼Œå®ƒé‡‡ç”¨äº†Tendermintå…±è¯†ç®—æ³•ï¼Œè¯¥ç®—æ³•é€šè¿‡éªŒè¯äººçš„æŠ•ç¥¨æ¥ç¡®å®šä¸‹ä¸€ä¸ªåŒºå—çš„ç”Ÿæˆè€…ã€‚ä¸€æ—¦åœ¨Cosmosç½‘ç»œä¸­çš„ä¸€ä¸ªåŒºå—è¢«éªŒè¯äººæˆåŠŸç”Ÿæˆå¹¶å¹¿æ’­å‡ºå»ï¼Œå®ƒè¢«è®¤ä¸ºæ˜¯æœ€ç»ˆçš„ç»“æœï¼Œä¸ä¼šè¢«åç»­çš„åŒºå—æ›¿ä»£ã€‚å› æ­¤ï¼Œå¯ä»¥è¯´Cosmosç½‘ç»œå…·æœ‰é€å—æœ€ç»ˆæ€§ï¼Œå³ä¸€æ—¦ä¸€ä¸ªåŒºå—åœ¨ç½‘ç»œä¸­è¢«éªŒè¯äººç¡®è®¤ï¼Œå®ƒå°±æˆä¸ºæœ€ç»ˆçš„ç»“æœã€‚</p>]]></content>
    
    
    <categories>
      
      <category>blockChain</category>
      
    </categories>
    
    
    <tags>
      
      <tag>block</tag>
      
      <tag>æ¦‚å¿µ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>00 åŒºå—é“¾åŸºç¡€çŸ¥è¯†</title>
    <link href="/2024/05/16/00%E5%8C%BA%E5%9D%97%E9%93%BE%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
    <url>/2024/05/16/00%E5%8C%BA%E5%9D%97%E9%93%BE%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/</url>
    
    <content type="html"><![CDATA[<blockquote><p>å¯¹äºä¸€äº›è¯æ±‡æ¦‚å¿µçš„è®²è§£</p></blockquote><h1 id="1-ä»€ä¹ˆæ˜¯åŒºå—é“¾ï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯åŒºå—é“¾ï¼Ÿ" class="headerlink" title="1. ä»€ä¹ˆæ˜¯åŒºå—é“¾ï¼Ÿ"></a>1. ä»€ä¹ˆæ˜¯åŒºå—é“¾ï¼Ÿ</h1><p>åŒºå—é“¾æ˜¯ä¸€ç§<code>åˆ†å¸ƒå¼</code>çš„ã€å»<code>ä¸­å¿ƒåŒ–</code>çš„æ•°å­—è´¦æœ¬æŠ€æœ¯ï¼Œç”¨äºè®°å½•å’ŒéªŒè¯äº¤æ˜“çš„æ•°æ®ã€‚</p><p>åŒºå—é“¾çš„æ ¸å¿ƒæ¦‚å¿µæ˜¯å°†äº¤æ˜“çš„æ•°æ®è®°å½•åœ¨ä¸€ä¸ªè¢«ç§°ä¸ºâ€œåŒºå—â€çš„æ•°æ®ç»“æ„ä¸­ï¼Œ</p><p>å¹¶é€šè¿‡<code>åŠ å¯†</code>å’Œ<code>å…±è¯†ç®—æ³•</code>ä¿è¯æ•°æ®çš„<code>å®‰å…¨æ€§</code>å’Œ <code>ä¸€è‡´æ€§</code></p><p>æ¯ä¸ªåŒºå—åŒ…å«äº†ä¸€æ‰¹äº¤æ˜“çš„ä¿¡æ¯ï¼Œä»¥åŠä¸ä¹‹å‰åŒºå—çš„é“¾æ¥ï¼Œå½¢æˆäº†ä¸€ä¸ªé“¾å¼ç»“æ„</p><blockquote><p>é“¾ï¼šä¸²èµ·æ¥äº†æ‰æ˜¯é“¾</p></blockquote><h1 id="2-åŒºå—é“¾æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ"><a href="#2-åŒºå—é“¾æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ" class="headerlink" title="2. åŒºå—é“¾æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ"></a>2. åŒºå—é“¾æœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿ</h1><p>åœ¨åŒºå—é“¾ä¸­ï¼Œå‚ä¸è€…é€šè¿‡ç½‘ç»œå…±äº«å’Œç»´æŠ¤è¿™ä¸ªè´¦æœ¬çš„å‰¯æœ¬ï¼Œè€Œä¸æ˜¯ä¾èµ–äºä¸­å¤®æœºæ„æ¥éªŒè¯äº¤æ˜“ã€‚è¿™ç§å»ä¸­å¿ƒåŒ–çš„ç‰¹æ€§ä½¿å¾—åŒºå—é“¾å…·æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ol><li><code>é€æ˜æ€§</code>ï¼šåŒºå—é“¾ä¸­çš„äº¤æ˜“å’Œæ•°æ®æ˜¯å…¬å¼€å¯è§çš„ï¼Œä»»ä½•äººéƒ½å¯ä»¥æŸ¥çœ‹è´¦æœ¬çš„å‰¯æœ¬ã€‚è¿™æä¾›äº†ä¸€ç§é€æ˜çš„æ–¹å¼æ¥éªŒè¯äº¤æ˜“å’Œç›‘ç£ç³»ç»Ÿçš„è¿ä½œã€‚</li><li><code>å®‰å…¨æ€§</code>ï¼šåŒºå—é“¾ä½¿ç”¨å¯†ç å­¦æŠ€æœ¯å¯¹æ•°æ®è¿›è¡ŒåŠ å¯†å’ŒéªŒè¯ï¼Œä»è€Œç¡®ä¿æ•°æ®çš„å®‰å…¨æ€§å’Œå®Œæ•´æ€§ã€‚ç”±äºæ•°æ®å­˜å‚¨åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šï¼Œç¯¡æ”¹æ•°æ®å˜å¾—éå¸¸å›°éš¾ã€‚</li><li><code>å»ä¸­å¿ƒåŒ–</code>ï¼šåŒºå—é“¾æ²¡æœ‰ä¸­å¤®æœºæ„æˆ–æ§åˆ¶æƒï¼Œå‚ä¸è€…é€šè¿‡å…±è¯†ç®—æ³•æ¥è¾¾æˆå¯¹è´¦æœ¬çš„ä¸€è‡´è®¤å¯ã€‚è¿™ä½¿å¾—åŒºå—é“¾å…·æœ‰æ›´é«˜çš„å¯ä¿¡åº¦å’ŒæŠ—æ”»å‡»èƒ½åŠ›ã€‚</li><li><code>ä¸å¯ç¯¡æ”¹æ€§</code>ï¼šä¸€æ—¦æ•°æ®è¢«è®°å½•åœ¨åŒºå—é“¾ä¸Šï¼Œç”±äºæ¯ä¸ªåŒºå—éƒ½åŒ…å«äº†å‰ä¸€ä¸ªåŒºå—çš„å“ˆå¸Œå€¼ï¼Œä»»ä½•å¯¹æ•°æ®çš„ç¯¡æ”¹éƒ½å°†è¢«å…¶ä»–èŠ‚ç‚¹æ£€æµ‹åˆ°ã€‚</li></ol><h2 id="3-åŒºå—é“¾çš„è¿ä½œæ–¹å¼"><a href="#3-åŒºå—é“¾çš„è¿ä½œæ–¹å¼" class="headerlink" title="3.åŒºå—é“¾çš„è¿ä½œæ–¹å¼"></a>3.åŒºå—é“¾çš„è¿ä½œæ–¹å¼</h2><h3 id="3-1-å“ˆå¸Œå‡½æ•°"><a href="#3-1-å“ˆå¸Œå‡½æ•°" class="headerlink" title="3.1 å“ˆå¸Œå‡½æ•°"></a>3.1 å“ˆå¸Œå‡½æ•°</h3><p>ç†æƒ³çš„åŠ å¯†å“ˆå¸Œå‡½æ•°å…·å¤‡5ä¸ªä¸»è¦å±æ€§ï¼š</p><ol><li><strong>ç¡®å®šæ€§ï¼š</strong>ç›¸åŒçš„æ¶ˆæ¯æ€»æ˜¯äº§ç”Ÿç›¸åŒçš„å“ˆå¸Œå€¼ã€‚</li><li><strong>å¿«é€Ÿï¼š</strong>å¿«é€Ÿè®¡ç®—ä»»ä½•ç»™å®šæ¶ˆæ¯çš„å“ˆå¸Œå€¼ã€‚</li><li><strong>æŠµæŠ—æ€§ï¼š</strong>é™¤éå°è¯•æ‰€æœ‰å¯èƒ½çš„æ¶ˆæ¯ï¼Œå¦åˆ™ä»å…¶å“ˆå¸Œå€¼ç”Ÿæˆæ¶ˆæ¯æ˜¯ä¸å¯è¡Œçš„ã€‚â€”æ— æ³•è¿”è§£</li><li><strong>ä¸ç›¸å…³ï¼š</strong>å¯¹æ¶ˆæ¯çš„å¾®å°æ›´æ”¹ä¼šæå¤§åœ°æ”¹å˜å“ˆå¸Œå€¼ï¼Œä»¥è‡³äºæ–°å€¼ä¸æ—§å€¼æ²¡æœ‰å…³ç³»ã€‚â€“åŸå§‹æ¶ˆæ¯æ”¹1ä¸ªå­—å“ˆå¸Œå¤§æ”¹</li><li><strong>æŠ—ç¢°æ’ï¼š</strong>ä¸å¯èƒ½æ‰¾åˆ°å…·æœ‰ç›¸åŒå“ˆå¸Œå€¼çš„ä¸¤ä¸ªä¸åŒæ¶ˆæ¯ã€‚â€”æ¯ä¸€ä¸ªéƒ½æ˜¯å”¯ä¸€çš„</li></ol><h3 id="3-2-åŒºå—ã€é“¾"><a href="#3-2-åŒºå—ã€é“¾" class="headerlink" title="3.2 åŒºå—ã€é“¾"></a>3.2 åŒºå—ã€é“¾</h3><ul><li>æœ‰æ•ˆåŒºå—æ˜¯ä¸€ç»„æœ‰åºçš„<strong>äº¤æ˜“</strong>ã€‚</li><li>æ¯ä¸ªå—éƒ½åŒ…å«å‰ä¸€ä¸ªå—çš„<strong>å“ˆå¸Œå€¼ã€‚</strong>â€”æŒ‰é¡ºåºæ’çš„</li><li>åŒºå—çš„å“ˆå¸Œå€¼å…·æœ‰<strong>æ˜“è¯æ˜éš¾ä¼ªé€ ã€‚</strong></li></ul><p><img src="/img/chain/image-03.png" alt="image1"></p><h2 id="4-äº¤æ˜“çš„è¿ä½œæ–¹å¼"><a href="#4-äº¤æ˜“çš„è¿ä½œæ–¹å¼" class="headerlink" title="4.äº¤æ˜“çš„è¿ä½œæ–¹å¼"></a>4.äº¤æ˜“çš„è¿ä½œæ–¹å¼</h2><h3 id="4-1-åŠ å¯†é’±åŒ…"><a href="#4-1-åŠ å¯†é’±åŒ…" class="headerlink" title="4.1 åŠ å¯†é’±åŒ…"></a>4.1 åŠ å¯†é’±åŒ…</h3><blockquote><p>é’±åŒ…å¹¶ä¸å­˜å‚¨åŠ å¯†èµ„äº§ï¼Œä»–ä»¬åªå­˜å‚¨ç§é’¥</p></blockquote><p>å…ˆç†è§£ä¸‰ä¸ªé‡è¦æ¦‚å¿µï¼š</p><ul><li>ç§é’¥ã€å…¬é’¥ã€åœ°å€ï¼šå…¬ç§é’¥é€šè¿‡<code>éå¯¹ç§°åŠ å¯†</code>ç”Ÿæˆï¼Œå…¬é’¥ç”¨äºåˆ†å‘ï¼Œç§é’¥ç”¨äºä¸ªäººä¿ç•™ï¼Œåœ°å€é€šè¿‡å…¬é’¥æ¨å¯¼</li><li>åŠ å¯†ä¸è§£å¯†ï¼šæ¶ˆæ¯ä¼ é€’é€šè¿‡å…¬é’¥åŠ å¯†ã€ç§é’¥è§£å¯†</li><li>ç­¾åä¸éªŒè¯ï¼šäº¤æ˜“ä¿¡æ¯é€šè¿‡ç§é’¥ç­¾åã€å…¬é’¥éªŒè¯ç­¾å</li></ul><p><img src="/img/chain/image-0401.png" alt="image-0401"></p><h3 id="4-2-ä»¥BTCä¸ºä¾‹ï¼Œè®²è§£ä¸€ç¬”äº¤æ˜“æµç¨‹"><a href="#4-2-ä»¥BTCä¸ºä¾‹ï¼Œè®²è§£ä¸€ç¬”äº¤æ˜“æµç¨‹" class="headerlink" title="4.2 ä»¥BTCä¸ºä¾‹ï¼Œè®²è§£ä¸€ç¬”äº¤æ˜“æµç¨‹"></a>4.2 ä»¥BTCä¸ºä¾‹ï¼Œè®²è§£ä¸€ç¬”äº¤æ˜“æµç¨‹</h3><blockquote><p>ç”¨æˆ·Bè½¬è´¦ 1 bitcoin åˆ°ç”¨æˆ· A</p></blockquote><p><img src="/img/chain/image-0402.png" alt="image-0402"></p><ol><li>ç”¨æˆ·Bä½¿ç”¨è‡ªå·±çš„ç§é’¥ç­¾åå®Œæˆäº¤æ˜“ä¿¡æ¯ã€ç¡®è®¤ç”¨æˆ·Bæœ‰è¶³å¤Ÿçš„ä»£å¸ã€‘</li><li>å°†äº¤æ˜“ä¿¡æ¯å‘é€è‡³èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹ä½¿ç”¨å…¬é’¥éªŒè¯äº¤æ˜“ä¿¡æ¯ï¼Œå¹¶å­˜å‚¨åœ¨<code>å†…å­˜æ± </code>ä¸­ã€‚</li><li>èŠ‚ç‚¹å°†äº¤æ˜“åˆ†ç»„åœ¨åŒºå—ä¸­ï¼Œå¹¶å¹¿æ’­åˆ°å…¶ä»–èŠ‚ç‚¹ã€‚</li><li>å…±è¯†æˆåŠŸå¹¶å‡ºå—åï¼Œç”¨æˆ·Aæ‰èƒ½è·å–åˆ°1 bitcoinã€‚</li></ol><h2 id="5-å…±è¯†"><a href="#5-å…±è¯†" class="headerlink" title="5.å…±è¯†"></a>5.å…±è¯†</h2><h3 id="5-1-å·¥ä½œé‡è¯æ˜ï¼ˆPoWï¼‰"><a href="#5-1-å·¥ä½œé‡è¯æ˜ï¼ˆPoWï¼‰" class="headerlink" title="5.1 å·¥ä½œé‡è¯æ˜ï¼ˆPoWï¼‰"></a>5.1 å·¥ä½œé‡è¯æ˜ï¼ˆPoWï¼‰</h3><blockquote><p>å»ä¸­å¿ƒåŒ–ç¨‹åº¦é«˜ï¼Œæ¶ˆè€—èµ„æºé«˜<br>åœ¨ PoW å…±è¯†ä¸­ï¼Œç”¨æˆ·å¿…é¡»å®Œæˆä»»æ„éš¾åº¦çš„ä»»åŠ¡ï¼Œå½“ä¸å—ä¸­çš„æœ‰åºäº¤æ˜“ç»“åˆæ—¶ï¼Œä¼šäº§ç”Ÿç¬¦åˆç‰¹å®šæ ‡å‡†çš„å“ˆå¸Œå‡½æ•°ç»“æœã€‚</p></blockquote><ol><li>ç§°ä¸ºâ€œçŸ¿å·¥â€çš„èŠ‚ç‚¹é€šè¿‡æš´åŠ›ç«äº‰æ¥è§£å†³æ•°å­¦é—®é¢˜ï¼ˆæ‰¾åˆ°ç‰¹å®šè§„åˆ™çš„å“ˆå¸Œå€¼ï¼‰â€”-å¤§å®¶ä¸€èµ·æŒ–å‘€æŒ–</li><li>ç¬¬ä¸€ä¸ªè§£å†³é—®é¢˜çš„çŸ¿å·¥å¯ä»¥åˆ›å»ºä¸€ä¸ªåŒºå—â€”â€“ç¬¬ä¸€ä¸ªæŒ–åˆ°äº†å“¦</li><li>å…¶ä»–èŠ‚ç‚¹æ£€æŸ¥è¯¥å—æ˜¯å¦æœ‰æ•ˆã€‚å¦‚æœæ˜¯ï¼ŒçŸ¿å·¥å°†è·å¾—åŠ å¯†è´§å¸å¥–åŠ±ã€‚å¦‚æœä¸æ˜¯ï¼ŒçŸ¿å·¥å°±æµªè´¹äº†æ—¶é—´å’Œç²¾åŠ›ã€‚</li><li>æ‰€æœ‰çš„èŠ‚ç‚¹éƒ½å°†æ–°å—æ·»åŠ åˆ°å…¶åŒºå—é“¾å‰¯æœ¬ä¸­ã€‚â€”-</li></ol><h3 id="5-2-è‚¡æƒè¯æ˜-PoS"><a href="#5-2-è‚¡æƒè¯æ˜-PoS" class="headerlink" title="5.2 è‚¡æƒè¯æ˜ (PoS)"></a>5.2 è‚¡æƒè¯æ˜ (PoS)</h3><blockquote><p>å»ä¸­å¿ƒåŒ–çš„ä¸€ç§å¦¥åæ–¹æ¡ˆï¼Œæ›´åƒé€‰æ‹©ä»£è¡¨äººå‚ä¸ç½‘ç»œï¼Œç›¸æ¯”å·¥ä½œé‡è¯æ˜å¤§å¤§é™ä½èµ„æºæ¶ˆè€—</p></blockquote><ol><li>ç§°ä¸ºéªŒè¯è€…èŠ‚ç‚¹ä¼šæŠµæŠ¼ä¸€äº›åŠ å¯†è´§å¸ã€‚æŠ•å…¥ä¸€å®šæ•°é‡çš„åŠ å¯†è´§å¸æ¥å‚ä¸å’Œåˆ†é…å‡ºå—å¥–åŠ±ã€‚</li><li>éªŒè¯è€…èŠ‚ç‚¹æ‰€å çš„æƒé‡è¶Šé«˜æ›´æœ‰å¯èƒ½è¢«é€‰æ‹©æ¥å¤„ç†äº¤æ˜“å¹¶åˆ›å»ºåŒºå—ã€‚</li><li>å…¶ä»–éªŒè¯è€…èŠ‚ç‚¹æ£€æŸ¥è¯¥å—æ˜¯å¦æœ‰æ•ˆã€‚å¦‚æœæ˜¯ï¼Œæ‰€æœ‰å‚ä¸çš„éªŒè¯è€…éƒ½ä¼šèµšå–æ”¶ç›Šã€‚å¦‚æœä¸æ˜¯ï¼Œåˆ›å»ºè¯¥å—çš„éªŒè¯è€…å¯èƒ½ä¼šå¤±å»å…¶æƒç›Šæˆ–è€…è·å¾—æƒ©ç½šã€‚</li></ol><p>è¿˜æœ‰å…¶ä»–å…±è¯†ç®—æ³•å°†åç»­ä»‹ç»ï¼Œæ¯”å¦‚ï¼šæƒå¨è¯æ˜ã€å§”æ‰˜æƒç›Šè¯æ˜ç­‰</p><h1 id="å»¶ä¼¸ï¼š-Cosmosçš„å…±è¯†æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿï¼š"><a href="#å»¶ä¼¸ï¼š-Cosmosçš„å…±è¯†æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿï¼š" class="headerlink" title="å»¶ä¼¸ï¼š Cosmosçš„å…±è¯†æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿï¼š"></a>å»¶ä¼¸ï¼š Cosmosçš„å…±è¯†æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿï¼š</h1><p>Cosmos æ˜¯ä¸€ä¸ªå¼€æ”¾çš„åŒºå—é“¾ç”Ÿæ€ç³»ç»Ÿï¼Œå®ƒé‡‡ç”¨äº†ä¸€ç§å…·æœ‰æ‰©å±•æ€§å’Œäº’è”æ€§çš„å…±è¯†æœºåˆ¶ï¼Œç§°ä¸º <strong>Tendermint</strong> å…±è¯†ã€‚</p><p><strong>Tendermint</strong> å…±è¯†æ˜¯ä¸€ç§åŸºäº<strong>æƒç›Šè¯æ˜</strong>ï¼ˆProof-of-Stake, PoSï¼‰çš„å…±è¯†ç®—æ³•ã€‚å®ƒçš„è®¾è®¡ç›®æ ‡æ˜¯å®ç°é«˜ååé‡ã€å¿«é€Ÿç¡®è®¤å’Œè‰¯å¥½çš„å®‰å…¨æ€§ã€‚ä»¥ä¸‹æ˜¯ Tendermint å…±è¯†çš„ä¸»è¦ç‰¹ç‚¹ï¼š</p><ol><li>æƒç›Šè¯æ˜ï¼ˆProof-of-Stakeï¼‰ï¼šTendermint ä½¿ç”¨æƒç›Šè¯æ˜ä½œä¸ºå…±è¯†æœºåˆ¶ï¼Œå‚ä¸å…±è¯†çš„èŠ‚ç‚¹éœ€è¦é”å®šä¸€å®šæ•°é‡çš„ä»£å¸ä½œä¸ºæƒç›Šã€‚è¿™äº›æƒç›Šä»£å¸ç”¨äºç¡®å®šèŠ‚ç‚¹åœ¨å…±è¯†è¿‡ç¨‹ä¸­çš„æŠ•ç¥¨æƒé‡ã€‚</li><li>BFT å…±è¯†ç®—æ³•ï¼šTendermint åŸºäºæ‹œå åº­å®¹é”™ï¼ˆByzantine Fault Tolerance, BFTï¼‰ç®—æ³•å®ç°å…±è¯†ã€‚å®ƒä½¿ç”¨äº†ä¸€ç§ç§°ä¸º â€œTendermint Coreâ€ çš„å…±è¯†å¼•æ“ï¼Œè¯¥å¼•æ“é€šè¿‡èŠ‚ç‚¹ä¹‹é—´çš„ç›¸äº’é€šä¿¡æ¥è¾¾æˆå…±è¯†ã€‚</li><li>è½®æ¬¡åˆ¶ï¼ˆRound-Robinï¼‰ï¼šåœ¨ Tendermint ä¸­ï¼ŒèŠ‚ç‚¹æŒ‰ç…§è½®æ¬¡åˆ¶è¿›è¡Œå…±è¯†è¿‡ç¨‹ã€‚æ¯ä¸ªè½®æ¬¡ä¸­ï¼Œä¸€ä¸ªèŠ‚ç‚¹è¢«é€‰ä¸ºæè®®è€…ï¼ˆProposerï¼‰ï¼Œè´Ÿè´£æè®®ä¸€ä¸ªåŒºå—ã€‚å…¶ä»–èŠ‚ç‚¹å°†æ ¹æ®æè®®è€…çš„åŒºå—è¿›è¡ŒæŠ•ç¥¨ï¼Œè¾¾æˆå…±è¯†ã€‚æ¯ä¸ªè½®æ¬¡åï¼Œæè®®è€…ä¼šè½®æ¢åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚</li><li>å¿«é€Ÿæœ€ç»ˆæ€§ï¼ˆFast Finalityï¼‰ï¼šTendermint å…·æœ‰å¿«é€Ÿæœ€ç»ˆæ€§çš„ç‰¹ç‚¹ï¼Œä¸€æ—¦ä¸€ä¸ªåŒºå—è¢«å¤§å¤šæ•°èŠ‚ç‚¹ç¡®è®¤ï¼Œå®ƒå°±è¢«è§†ä¸ºæœ€ç»ˆçš„å¹¶ä¸”ä¸å¯é€†çš„ã€‚è¿™æ„å‘³ç€ç¡®è®¤çš„åŒºå—åœ¨æ•´ä¸ªç½‘ç»œä¸­è¢«å¹¿æ³›æ¥å—ï¼Œæé«˜äº†äº¤æ˜“çš„å®‰å…¨æ€§å’Œç¡®å®šæ€§ã€‚</li></ol><p>Tendermint å…±è¯†æœºåˆ¶åœ¨ Cosmos ç”Ÿæ€ç³»ç»Ÿä¸­è¢«ç”¨äºè¿æ¥å¤šä¸ªç‹¬ç«‹çš„åŒºå—é“¾ï¼ˆç§°ä¸º â€œåŒºå—é“¾é—´é€šä¿¡â€ï¼ŒInter-Blockchain Communication, IBCï¼‰ï¼Œå®ç°è·¨é“¾äº’æ“ä½œæ€§ã€‚å®ƒæä¾›äº†ä¸€ä¸ªå®‰å…¨ä¸”é«˜æ•ˆçš„å…±è¯†ç®—æ³•ï¼Œä½¿å¾— Cosmos ç½‘ç»œä¸­çš„ä¸åŒåŒºå—é“¾èƒ½å¤Ÿè¿›è¡Œå¯é çš„äº¤äº’å’Œæ•°æ®ä¼ è¾“ã€‚</p><h1 id="åŒºå—é“¾åŸºç¡€ï¼š"><a href="#åŒºå—é“¾åŸºç¡€ï¼š" class="headerlink" title="åŒºå—é“¾åŸºç¡€ï¼š"></a>åŒºå—é“¾åŸºç¡€ï¼š</h1><p>å¯†ç å­¦ã€åˆ†å¸ƒå¼å­˜å‚¨ã€æ™ºèƒ½åˆçº¦ã€å…±è¯†ç®—æ³•</p><h2 id="åŒºå—"><a href="#åŒºå—" class="headerlink" title="åŒºå—"></a>åŒºå—</h2><p>æ¯ä¸ªåŒºå—éƒ½å­˜å‚¨å¹¿æ’­æ•°æ®</p><p>åŒºå—é“¾å°±æ˜¯æ¯ä¸ªåŒºå—è¿èµ·æ¥å½¢æˆä¸€ä¸ªé“¾æ¡</p><h2 id="ç‰¹ç‚¹ï¼šå»ä¸­å¿ƒåŒ–"><a href="#ç‰¹ç‚¹ï¼šå»ä¸­å¿ƒåŒ–" class="headerlink" title="ç‰¹ç‚¹ï¼šå»ä¸­å¿ƒåŒ–"></a>ç‰¹ç‚¹ï¼šå»ä¸­å¿ƒåŒ–</h2><p>ä¸­å¿ƒåŒ–æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>æŠŠä¸­å¿ƒåŒ–å»æ‰ï¼Œè®©å…¨ç½‘äººäººå‚ä¸ï¼Œæ•°æ®ç»´æŠ¤</p><h2 id="è¿è¡ŒåŸç†"><a href="#è¿è¡ŒåŸç†" class="headerlink" title="è¿è¡ŒåŸç†"></a>è¿è¡ŒåŸç†</h2><p>äººäººéƒ½å‚ä¸è®°è´¦çš„å¤§è´¦æœ¬ï¼Œæ‹†åˆ†åˆ°æ¯ä¸ªäººçš„å°è´¦æœ¬</p><p>å¤§éƒ¨ä»½çš„äººè®¤ä¸ºçœŸæ˜¯å¯é çš„æ—¶å€™ï¼Œå°±å¯ä»¥ç¡®è®¤è¿™ä¸ªåŒºå—</p><p>å¤§å®¶å…±åŒè®°è´¦-äº’ç›¸éªŒè¯-å¤§å®¶ç¡®è®¤</p><h2 id="æŒ–çŸ¿"><a href="#æŒ–çŸ¿" class="headerlink" title="æŒ–çŸ¿"></a>æŒ–çŸ¿</h2><p>æ˜¯ä¸€ç§å¥–åŠ±è¡Œä¸ºï¼Œ</p><p>é¼“åŠ±å¤§å®¶å…±åŒç»´æŠ¤å…¨ç½‘æ•°æ®â€“&gt;ä¹Ÿå°±æ˜¯åŒºå—é“¾æ•°æ®</p><p>èƒ½æŠŠæ•°æ®å¤„ç†çš„æœ€å¿«æœ€å¥½ï¼Œè°å°±å¯ä»¥è·å¾—btcå¥–åŠ±</p><h3 id="æŒ–çŸ¿åŸç†"><a href="#æŒ–çŸ¿åŸç†" class="headerlink" title="æŒ–çŸ¿åŸç†"></a>æŒ–çŸ¿åŸç†</h3><p>çŸ¿å·¥é‚£ä¹ˆå¤šï¼Œå–è°çš„å‘¢ï¼Ÿæ‰€æœ‰å‚ä¸çš„çŸ¿å·¥æ‰“åŒ…çš„æ•°æ®å¿…é¡»åŠ å…¥ä¸€ä¸ª<strong>å“ˆå¸Œå€¼</strong>ï¼Œè¿™ä¸ªå“ˆå¸Œå€¼å¿…é¡»æ»¡è¶³ä¸€å®šçš„æ¡ä»¶ï¼Œè°èƒ½å…ˆè®¡ç®—å‡ºè¿™ä¸ªå“ˆå¸Œå€¼å¹¶ä¸”å¹¿æ’­ç»™å…¶ä»–çš„çŸ¿å·¥ç¡®è®¤ï¼Œä¸”å¤§éƒ¨ä»½çš„äººè®¤ä¸ºæ²¡é—®é¢˜ï¼Œè°å°±å¯ä»¥è·å¾—è®°å½•æ•°æ®çš„æƒåˆ©ä»¥åŠå¤§éƒ¨ä»½åŒºå—é“¾ç»™çš„å¥–åŠ±</p><p>åŒç†ï¼ŒçŸ¿å·¥æŒ–çŸ¿ä¸ä»…ä»…æ˜¯ä¸ºäº†å¾—åˆ°æ¯”ç‰¹å¸å¥–åŠ±ï¼Œå› ä¸ºè¿™æ˜¯ç»´æŠ¤æ•´ä¸ªç½‘ç»œçš„é‡è¦ç¯èŠ‚ã€‚</p><p>æŒ–çŸ¿çš„äººè¶Šå¤šï¼Œå‚ä¸æ•°æ®ç¡®è®¤çš„äººå°±è¶Šå¤šï¼Œæˆ‘ä»¬çš„æ•°æ®ä¹Ÿå°±è¶Šå®‰å…¨</p><h1 id="åˆ†å‰"><a href="#åˆ†å‰" class="headerlink" title="åˆ†å‰"></a>åˆ†å‰</h1><p>åˆ†å‰å…¶å®æ˜¯å‡çº§ï¼Œå½“ç‰ˆæœ¬å‡çº§çš„æ—¶å€™ï¼Œä¼šæœ‰ä¸¤ä¸ªåˆ†å‰ï¼Œä¸€ä¸ªè€çš„ä¸€ä¸ªæ–°çš„ï¼Œè€é“¾ä¸Šçš„çŸ¿å·¥å®Œæˆå‡çº§åˆ‡æ¢åˆ°æ–°é“¾åï¼Œè¿™å°±å«åš<strong>è½¯åˆ†å‰</strong>ï¼Œå½“çŸ¿å·¥ä¸èƒ½è¾¾æˆå…±è¯†çš„æ—¶å€™ï¼Œå°±ä¼šåˆ†æˆäº†2æ¡é“¾ï¼Œå¤§å®¶äº’ä¸å…¼å®¹å„è‡ªç©å„è‡ªçš„ï¼Œè¿™å°±å«åš<strong>ç¡¬åˆ†å‰</strong></p><p>æƒ³è±¡ä¸€ä¸‹ï¼Œä½ é€ é“¾ä¸€æ¡é“¾ã€‚ç°åœ¨çŸ¿å·¥ä»¬æŠŠä½ çš„é“¾å‡çº§äº†ï¼Œç„¶åè”åˆèµ·æ¥è¾¾æˆå…±è¯†è¦å¾€ä»–ä»¬å‡çº§çš„æ–¹å‘å»èµ°ï¼Œé‚£ä½ çš„é“¾è¿˜æ˜¯ä½ çš„å—ï¼Ÿ</p><h1 id="åˆ†ç±»"><a href="#åˆ†ç±»" class="headerlink" title="åˆ†ç±»"></a>åˆ†ç±»</h1><p>å…¬æœ‰é“¾ï¼šå…¬å¹³å…¬æ­£å…¬å¼€ï¼Œ</p><p>ç§æœ‰é“¾ï¼šä¸ªäººæˆ–è€…å…¬å¸çš„å†…éƒ¨ä½¿ç”¨çš„é“¾ï¼Œå¤–é¢çš„äººä¸å¯ä»¥å‚ä¸åˆ°é“¾çš„å…±è¯†ï¼Œ</p><p>è”ç›Ÿé“¾ï¼šå¤šä¼ä¸šè”åˆï¼Œä¼ä¸šæˆ–ç»„ç»‡æ–¹é¢çš„åº”ç”¨</p><h1 id="æ ¸å¿ƒæŠ€æœ¯"><a href="#æ ¸å¿ƒæŠ€æœ¯" class="headerlink" title="æ ¸å¿ƒæŠ€æœ¯"></a>æ ¸å¿ƒæŠ€æœ¯</h1><p>å¯†ç å­¦ã€åˆ†å¸ƒå¼å­˜å‚¨ã€æ™ºèƒ½åˆçº¦ã€å…±è¯†ç®—æ³•</p><p>åˆ†å¸ƒå¼å­˜å‚¨ï¼š</p><h1 id="äº¤æ˜“æ‰€"><a href="#äº¤æ˜“æ‰€" class="headerlink" title="äº¤æ˜“æ‰€"></a>äº¤æ˜“æ‰€</h1><p>å¸å®‰ã€ </p><p>okxã€</p><p>Gateio  bitget wallet  </p><p>coinbase  </p>]]></content>
    
    
    <categories>
      
      <category>blockChain</category>
      
    </categories>
    
    
    <tags>
      
      <tag>block</tag>
      
      <tag>æ¦‚å¿µ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>rustå­¦ä¹ è®°å½•</title>
    <link href="/2024/05/11/rust%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
    <url>/2024/05/11/rust%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<h1 id="è®°å½•ä¸€ä¸‹Rustçš„å­¦ä¹ å†ç¨‹"><a href="#è®°å½•ä¸€ä¸‹Rustçš„å­¦ä¹ å†ç¨‹" class="headerlink" title="è®°å½•ä¸€ä¸‹Rustçš„å­¦ä¹ å†ç¨‹"></a>è®°å½•ä¸€ä¸‹Rustçš„å­¦ä¹ å†ç¨‹</h1><h1 id="ç¬¬ä¸€ç« ï¼šå®‰è£…å’Œhello-world"><a href="#ç¬¬ä¸€ç« ï¼šå®‰è£…å’Œhello-world" class="headerlink" title="ç¬¬ä¸€ç« ï¼šå®‰è£…å’Œhello world"></a>ç¬¬ä¸€ç« ï¼šå®‰è£…å’Œhello world</h1><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">curl https://sh.rustup.rs -sSf | sh</span><br></code></pre></td></tr></table></figure><p>è¿™æ¡å‘½ä»¤ä¼šä¸‹è½½å¹¶æ‰§è¡Œä¸€ä¸ªè„šæœ¬æ¥å®‰è£…rustupå·¥å…·ï¼Œè¿›è€Œå®‰è£…æœ€æ–°çš„Rustç¨³å®šç‰ˆæœ¬ã€‚è¯¥è„šæœ¬å¯èƒ½ä¼šåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è¯·æ±‚è¾“å…¥ä½ çš„å¯†ç ã€‚ä¸€æ—¦å®‰è£…æˆåŠŸï¼Œä½ å°†èƒ½å¤Ÿçœ‹åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„è¾“å‡º</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">Rust is installed now. Great!<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„å®‰è£…è¿‡ç¨‹ä¼šè‡ªåŠ¨å°†Rustå·¥å…·é“¾æ·»åŠ åˆ°ç¯å¢ƒå˜é‡PATHä¸­ï¼Œå¹¶åœ¨ä¸‹ä¸€æ¬¡ç™»å½•ç»ˆç«¯æ—¶ç”Ÿæ•ˆã€‚å‡å¦‚ä½ æƒ³è¦ç«‹å³å¼€å§‹ä½¿ç”¨Rustè€Œä¸ç”¨é‡æ–°å¯åŠ¨ç»ˆç«¯ï¼Œé‚£ä¹ˆä½ å¯ä»¥åœ¨ç»ˆç«¯ä¸­è¿è¡Œå¦‚ä¸‹æ‰€ç¤ºçš„å‘½ä»¤æ¥è®©é…ç½®ç«‹å³ç”Ÿæ•ˆï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">source</span> <span class="hljs-variable">$HOME</span>/.cargo/env</span><br></code></pre></td></tr></table></figure><p>æˆ–è€…ï¼Œä½ ä¹Ÿå¯ä»¥å‘ï½&#x2F;.bash_profile æ–‡ä»¶ä¸­æ·»åŠ ä¸‹é¢çš„è¯­å¥ï¼Œæ‰‹åŠ¨å°†Rustæ·»åŠ åˆ°ç¯å¢ƒå˜é‡PATHä¸­ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">export</span> PATH=<span class="hljs-string">&quot;<span class="hljs-variable">$HOME</span>/.cargo/bin:<span class="hljs-variable">$PATH</span></span></span><br></code></pre></td></tr></table></figure><h2 id="Hello-world"><a href="#Hello-world" class="headerlink" title="Hello , world"></a>Hello , world</h2><p>åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹</p><p>å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹æ¥å­˜å‚¨ç¼–å†™çš„Rustä»£ç ã€‚é€šå¸¸è€Œè¨€ï¼ŒRustä¸ä¼šé™åˆ¶æˆ‘ä»¬å­˜å‚¨ä»£ç çš„ä½ç½®ï¼Œä½†æ˜¯é’ˆå¯¹æœ¬ä¹¦ä¸­çš„å„ç§ç»ƒä¹ å’Œé¡¹ç›®ï¼Œæˆ‘ä»¬å»ºè®®ä½ åˆ›å»ºä¸€ä¸ªå¯ä»¥é›†åˆæ‰€æœ‰é¡¹ç›®çš„æ ¹æ–‡ä»¶å¤¹ï¼Œç„¶åå°†æœ¬ä¹¦ä¸­æ‰€æœ‰çš„é¡¹ç›®æ”¾åœ¨é‡Œé¢ã€‚</p><p>ç°åœ¨ï¼Œä½ å¯ä»¥æ‰“å¼€ç»ˆç«¯å¹¶è¾“å…¥ç›¸åº”å‘½ä»¤ï¼Œæ¥åˆ›å»ºæˆ‘ä»¬çš„æ–‡ä»¶å¤¹åŠç¬¬ä¸€ä¸ªâ€œHello, world!â€é¡¹ç›®äº†ã€‚</p><p>å¯¹äºLinuxç³»ç»Ÿã€macOSç³»ç»Ÿï¼Œä»¥åŠWindowsç³»ç»Ÿçš„PowerShellç»ˆç«¯æ¥è¯´ï¼Œè¾“å…¥çš„å‘½ä»¤å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">mkdir</span> ï½/projects</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cd</span> ï½/projects</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">mkdir</span> hello_world</span><br>Hello, World!<br>ç°åœ¨ï¼Œä½ åº”è¯¥å·²ç»æˆåŠŸå®‰è£…å¥½äº†Rustã€‚è®©æˆ‘ä»¬éµä»ä¼ ç»Ÿï¼Œä»ç¼–å†™ä¸€ä¸ªå¯ä»¥æ‰“å°å‡ºâ€œHello, world!â€çš„å°ç¨‹åºå¼€å§‹æ­£å¼çš„å­¦ä¹ æ—…ç¨‹ã€‚<br><br>æ³¨æ„<br>æœ¬ä¹¦å‡å®šä½ å·²ç»ç†Ÿæ‚‰äº†åŸºæœ¬çš„ç»ˆç«¯æ“ä½œä¸å¸¸ç”¨å‘½ä»¤ã€‚å¼€å‘Rustç¨‹åºå¹¶ä¸ä¼šå¯¹ä½ æ‰€ä½¿ç”¨çš„ç¼–è¾‘å·¥å…·æœ‰ä»»ä½•çš„è¦æ±‚ï¼Œå¦‚æœä½ å–œæ¬¢ä½¿ç”¨æŸä¸ªIDEï¼ˆIntegrated Development Environmentï¼Œé›†æˆå¼€å‘ç¯å¢ƒï¼‰ï¼Œé‚£ä¹ˆå°±ç”¨ä½ å–œæ¬¢çš„IDEå¥½äº†ã€‚è®¸å¤šå¸¸ç”¨çš„IDEéƒ½å·²ç»é’ˆå¯¹Rustå®ç°äº†æŸç§ç¨‹åº¦ä¸Šçš„æ”¯æŒï¼Œä½ å¯ä»¥é€šè¿‡ç›¸åº”çš„IDEæ–‡æ¡£æ¥äº†è§£æ›´å¤šçš„ç»†èŠ‚ã€‚å€¼å¾—é«˜å…´çš„æ˜¯ï¼ŒRustå¼€å‘å›¢é˜Ÿåœ¨é›†ä¸­ç²¾åŠ›æä¾›æµç•…ã€èˆ’é€‚çš„IDEæ”¯æŒï¼Œä¸æ–­ä¼˜åŒ–ç¼–ç ä½“éªŒï¼<br><br>åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹<br>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹æ¥å­˜å‚¨ç¼–å†™çš„Rustä»£ç ã€‚é€šå¸¸è€Œè¨€ï¼ŒRustä¸ä¼šé™åˆ¶æˆ‘ä»¬å­˜å‚¨ä»£ç çš„ä½ç½®ï¼Œä½†æ˜¯é’ˆå¯¹æœ¬ä¹¦ä¸­çš„å„ç§ç»ƒä¹ å’Œé¡¹ç›®ï¼Œæˆ‘ä»¬å»ºè®®ä½ åˆ›å»ºä¸€ä¸ªå¯ä»¥é›†åˆæ‰€æœ‰é¡¹ç›®çš„æ ¹æ–‡ä»¶å¤¹ï¼Œç„¶åå°†æœ¬ä¹¦ä¸­æ‰€æœ‰çš„é¡¹ç›®æ”¾åœ¨é‡Œé¢ã€‚<br><br>ç°åœ¨ï¼Œä½ å¯ä»¥æ‰“å¼€ç»ˆç«¯å¹¶è¾“å…¥ç›¸åº”å‘½ä»¤ï¼Œæ¥åˆ›å»ºæˆ‘ä»¬çš„æ–‡ä»¶å¤¹åŠç¬¬ä¸€ä¸ªâ€œHello, world!â€é¡¹ç›®äº†ã€‚<br><br>å¯¹äºLinuxç³»ç»Ÿã€macOSç³»ç»Ÿï¼Œä»¥åŠWindowsç³»ç»Ÿçš„PowerShellç»ˆç«¯æ¥è¯´ï¼Œè¾“å…¥çš„å‘½ä»¤å¦‚ä¸‹æ‰€ç¤ºï¼š<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">mkdir</span> ï½/projects</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cd</span> ï½/projects</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">mkdir</span> hello_world</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash"><span class="hljs-built_in">cd</span> hello_world</span><br><br>å¯¹äºWindowsç³»ç»Ÿçš„CMDç»ˆç«¯ï¼Œè¾“å…¥çš„å‘½ä»¤å¦‚ä¸‹æ‰€ç¤ºï¼š<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">&gt; </span><span class="language-bash"><span class="hljs-built_in">mkdir</span> <span class="hljs-string">&quot;%USERPROFILE%\projects&quot;</span></span><br><span class="hljs-meta prompt_">&gt; </span><span class="language-bash"><span class="hljs-built_in">cd</span> /d <span class="hljs-string">&quot;%USERPROFILE%\projects&quot;</span></span><br><span class="hljs-meta prompt_">&gt; </span><span class="language-bash"><span class="hljs-built_in">mkdir</span> hello_world</span><br><span class="hljs-meta prompt_">&gt; </span><span class="language-bash"><span class="hljs-built_in">cd</span> hello_world</span><br></code></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œä½ å¯ä»¥æ‰“å¼€åˆšåˆšåˆ›å»ºçš„<em>main.rs</em> æ–‡ä»¶ï¼Œå¹¶é”®å…¥ç¤ºä¾‹1-1ä¸­çš„ä»£ç ã€‚</p><p>main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() &#123;<br>    <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;Hello, world!&quot;</span>);<br>&#125;<br><span class="hljs-comment">// è¿™éƒ¨åˆ†ä»£ç å®šä¹‰äº†Rustä¸­çš„ä¸€ä¸ªå‡½æ•°ã€‚è¿™é‡Œçš„mainå‡½æ•°ä¼šæ¯”è¾ƒç‰¹æ®Šï¼šå½“ä½ è¿è¡Œä¸€ä¸ªå¯æ‰§è¡ŒRustç¨‹åºçš„æ—¶å€™ï¼Œæ‰€æœ‰çš„ä»£ç éƒ½ä¼šä»è¿™ä¸ªå…¥å£å‡½æ•°å¼€å§‹è¿è¡Œã€‚è¿™æ®µä»£ç çš„ç¬¬ä¸€è¡Œå£°æ˜äº†ä¸€ä¸ªåä¸ºmainçš„ã€æ²¡æœ‰ä»»ä½•å‚æ•°å’Œè¿”å›å€¼çš„å‡½æ•°ã€‚å¦‚æœæŸå¤©ä½ éœ€è¦ç»™å‡½æ•°å£°æ˜å‚æ•°çš„è¯ï¼Œé‚£ä¹ˆå°±å¿…é¡»æŠŠå®ƒä»¬æ”¾ç½®åœ¨åœ†æ‹¬å·()ä¸­ã€‚</span><br><span class="hljs-comment">// é¦–å…ˆï¼Œæ ‡å‡†Rusté£æ ¼ä½¿ç”¨4ä¸ªç©ºæ ¼è€Œä¸æ˜¯Tabæ¥å®ç°ç¼©è¿›</span><br><span class="hljs-comment">// æœ€åï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªåˆ†å·ï¼ˆ;ã€€ï¼‰ä½œä¸ºè¿™ä¸€è¡Œçš„ç»“å°¾ï¼Œå®ƒè¡¨æ˜å½“å‰çš„è¡¨è¾¾å¼å·²ç»ç»“æŸï¼Œè€Œä¸‹ä¸€ä¸ªè¡¨è¾¾å¼å°†è¦å¼€å§‹ã€‚å¤§éƒ¨åˆ†çš„Rustä»£ç è¡Œéƒ½ä¼šä»¥åˆ†å·æ¥ç»“å°¾ã€‚</span><br></code></pre></td></tr></table></figure><h3 id="ç¼–è¯‘ä¸è¿è¡Œæ˜¯ä¸¤ä¸ªä¸åŒçš„æ­¥éª¤"><a href="#ç¼–è¯‘ä¸è¿è¡Œæ˜¯ä¸¤ä¸ªä¸åŒçš„æ­¥éª¤" class="headerlink" title="ç¼–è¯‘ä¸è¿è¡Œæ˜¯ä¸¤ä¸ªä¸åŒçš„æ­¥éª¤"></a>ç¼–è¯‘ä¸è¿è¡Œæ˜¯ä¸¤ä¸ªä¸åŒçš„æ­¥éª¤</h3><p>ä½ åº”è¯¥å·²ç»è¿è¡Œè¿‡åˆšåˆšç¼–å†™çš„ç¨‹åºäº†ï¼Œè®©æˆ‘ä»¬æ¥è¯¦ç»†åœ°è®¨è®ºä¸€ä¸‹è¿™ä¸ªè¿‡ç¨‹ä¸­çš„æ¯ä¸€ä¸ªæ­¥éª¤ã€‚</p><p>åœ¨è¿è¡Œä¸€æ®µRustç¨‹åºä¹‹å‰ï¼Œä½ å¿…é¡»è¾“å…¥rustcå‘½ä»¤åŠé™„å¸¦çš„æºæ–‡ä»¶åå‚æ•°æ¥ç¼–è¯‘å®ƒï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">rustc main.rs</span><br></code></pre></td></tr></table></figure><p>ç¼–è¯‘å®Œä¹‹åæˆ‘ä»¬lsçœ‹ä¸€ä¸‹ç¼–è¯‘å‡ºæ¥äº†ä»€ä¹ˆä¸œè¥¿</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">main.exe # Windowsç³»ç»Ÿä¸‹çš„main.exe<br>main.pdb # å¦‚æœä½ ä½¿ç”¨çš„æ˜¯Windowsç³»ç»Ÿï¼Œé‚£ä¹ˆä½ è¿˜ä¼šçœ‹åˆ°ä¸€ä¸ªé™„å¸¦è°ƒè¯•ä¿¡æ¯ã€ä»¥.pdb ä¸ºåç¼€çš„æ–‡ä»¶<br>main.rs # ä»¥.rs ä¸ºåç¼€çš„æºä»£ç æ–‡ä»¶<br></code></pre></td></tr></table></figure><p>å‡å¦‚ä½ æ›´åŠ ç†Ÿæ‚‰æŸç§ç±»ä¼¼äºRubyã€Pythonæˆ–JavaScriptä¹‹ç±»çš„åŠ¨æ€è¯­è¨€ï¼Œä½ å¯èƒ½è¿˜ä¸å¤ªä¹ æƒ¯åœ¨è¿è¡Œä¹‹å‰éœ€è¦å…ˆè¿›è¡Œç¼–è¯‘ã€‚Rustæ˜¯ä¸€ç§é¢„ç¼–è¯‘è¯­è¨€ï¼Œè¿™æ„å‘³ç€å½“ä½ ç¼–è¯‘å®ŒRustç¨‹åºä¹‹åï¼Œä¾¿å¯ä»¥å°†å¯æ‰§è¡Œæ–‡ä»¶äº¤ä»˜äºå…¶ä»–äººï¼Œå¹¶è¿è¡Œåœ¨æ²¡æœ‰å®‰è£…Rustçš„ç¯å¢ƒä¸­ã€‚è€Œå¦‚æœä½ äº¤ä»˜ç»™å…¶ä»–äººçš„æ˜¯ä¸€ä»½.rb ã€.py æˆ–.js æ–‡ä»¶ï¼Œé‚£ä¹ˆä»–ä»¬å°±å¿…é¡»è¦æ‹¥æœ‰å¯¹åº”çš„Rubyã€Pythonæˆ–JavaScriptå®ç°æ¥æ‰§è¡Œç¨‹åºã€‚å½“ç„¶ï¼Œè¿™äº›è¯­è¨€åªéœ€è¦ç”¨ç®€å•çš„ä¸€å¥å‘½ä»¤å°±å¯ä»¥å®Œæˆç¨‹åºçš„ç¼–è¯‘å’Œè¿è¡Œã€‚è¿™ä¹Ÿç®—æ˜¯è¯­è¨€è®¾è®¡ä¸Šçš„æƒè¡¡ä¸å–èˆå§</p><h2 id="hello-cargo"><a href="#hello-cargo" class="headerlink" title="hello cargo"></a>hello cargo</h2><p>æ˜¯å•¥ï¼š</p><p>æ˜¯Rustçš„åŒ…ç®¡ç†å™¨ï¼Œå®ƒå¯ä»¥å¤„ç†ä¼—å¤šè¯¸å¦‚æ„å»ºä»£ç ã€ä¸‹è½½ç¼–è¯‘ä¾èµ–åº“ç­‰çç¢ä½†é‡è¦çš„ä»»åŠ¡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">cargo --version</span><br>cargo 1.77.2 (e52e36006 2024-03-26)<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨Cargoåˆ›å»ºä¸€ä¸ªé¡¹ç›®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">cargo new hello_cargo</span><br></code></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬è¿›å…¥<em>hello_cargo</em> æ–‡ä»¶å¤¹ï¼Œä½ å¯ä»¥çœ‹åˆ°Cargoåˆšåˆšç”Ÿæˆçš„ä¸¤ä¸ªæ–‡ä»¶ä¸ä¸€ä¸ªç›®å½•ï¼šä¸€ä¸ªåä¸º<em>Cargo.toml</em> çš„æ–‡ä»¶ï¼Œä»¥åŠä¸€ä¸ªåä¸º<em>main.rs</em> çš„æºä»£ç æ–‡ä»¶ï¼Œè¯¥æºä»£ç æ–‡ä»¶è¢«æ”¾ç½®åœ¨<em>src</em> ç›®å½•ä¸‹ã€‚ä¸æ­¤åŒæ—¶ï¼ŒCargoè¿˜ä¼šåˆå§‹åŒ–ä¸€ä¸ªæ–°çš„Gitä»“åº“å¹¶ç”Ÿæˆé»˜è®¤çš„.<em>gitignore</em> æ–‡ä»¶ã€‚</p><p><em>Cargo.toml</em> ä¸­çš„å†…å®¹å¦‚ç¤ºä¾‹1-2æ‰€ç¤ºï¼Œä½ å¯ä»¥ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€å®ƒã€‚</p><p>tomlå°±æ˜¯é…ç½®æ–‡ä»¶æ ¼å¼</p><p>Cargo.toml</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs toml"><span class="hljs-section">[package]</span> <span class="hljs-comment"># é¦–è¡Œæ–‡æœ¬ä¸­çš„[package]æ˜¯ä¸€ä¸ªåŒºåŸŸæ ‡ç­¾ï¼Œå®ƒè¡¨æ˜æ¥ä¸‹æ¥çš„è¯­å¥ä¼šè¢«ç”¨äºé…ç½®å½“å‰çš„ç¨‹åºåŒ…ã€‚éšç€æˆ‘ä»¬åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­å¢åŠ æ›´å¤šçš„ä¿¡æ¯ï¼Œä½ è¿˜ä¼šè§è¯†åˆ°æ›´å¤šå…¶ä»–çš„åŒºåŸŸ ï¼ˆsectionï¼‰</span><br><span class="hljs-attr">name</span> = <span class="hljs-string">&quot;hello_cargo&quot;</span> <span class="hljs-comment"># é¡¹ç›®åç§°</span><br><span class="hljs-attr">version</span> = <span class="hljs-string">&quot;0.1.0&quot;</span> <span class="hljs-comment"># ç‰ˆæœ¬</span><br><span class="hljs-attr">edition</span> = <span class="hljs-string">&quot;2021&quot;</span> <span class="hljs-comment"># æ—¥æœŸ</span><br><br><span class="hljs-comment"># See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html</span><br><br><span class="hljs-section">[dependencies]</span><br></code></pre></td></tr></table></figure><p>åŒæ ·æŒ‰ç…§æƒ¯ä¾‹ï¼ŒCargoä¼šé»˜è®¤æŠŠæ‰€æœ‰çš„æºä»£ç æ–‡ä»¶ä¿å­˜åˆ°src ç›®å½•ä¸‹ï¼Œè€Œé¡¹ç›®æ ¹ç›®å½•åªè¢«ç”¨æ¥å­˜æ”¾è¯¸å¦‚READMEæ–‡æ¡£ã€è®¸å¯å£°æ˜ã€é…ç½®æ–‡ä»¶ç­‰ä¸æºä»£ç æ— å…³çš„æ–‡ä»¶ã€‚ä½¿ç”¨Cargoå¯ä»¥å¸®åŠ©ä½ åˆç†å¹¶ä¸€è‡´åœ°ç»„ç»‡è‡ªå·±çš„é¡¹ç›®æ–‡ä»¶ï¼Œä»è€Œä½¿ä¸€åˆ‡äº•äº•æœ‰æ¡ã€‚</p><h3 id="ä½¿ç”¨Cargoæ„å»ºå’Œè¿è¡Œé¡¹ç›®"><a href="#ä½¿ç”¨Cargoæ„å»ºå’Œè¿è¡Œé¡¹ç›®" class="headerlink" title="ä½¿ç”¨Cargoæ„å»ºå’Œè¿è¡Œé¡¹ç›®"></a>ä½¿ç”¨Cargoæ„å»ºå’Œè¿è¡Œé¡¹ç›®</h3><p>é‚£ä¹ˆä½¿ç”¨Cargoæ¥æ„å»ºå’Œè¿è¡Œé¡¹ç›®ä¸æ‰‹åŠ¨ä½¿ç”¨rustcç›¸æ¯”åˆæœ‰å“ªäº›å¼‚åŒå‘¢ï¼Ÿåœ¨å½“å‰çš„<em>hello_cargo</em> é¡¹ç›®ç›®å½•ä¸‹ï¼ŒCargoå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤æ¥å®Œæˆæ„å»ºä»»åŠ¡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">cargo build</span><br>   Compiling hello_cargo v0.1.0 (file:///projects/hello_cargo)<br>    Finished dev [unoptimized + debuginfo] target(s) in 2.85 secs<br></code></pre></td></tr></table></figure><p>ä¸ä¹‹å‰ä¸åŒï¼Œè¿™ä¸ªå‘½ä»¤ä¼šå°†å¯æ‰§è¡Œç¨‹åºç”Ÿæˆåœ¨è·¯å¾„<em>target&#x2F;debug&#x2F;hello_ cargo</em> ï¼ˆæˆ–è€…Windowsç³»ç»Ÿä¸‹çš„<em>target\debug\hello_cargo.exe</em> ï¼‰ä¸‹ã€‚ä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹æ‰€ç¤ºçš„å‘½ä»¤è¿è¡Œè¿™ä¸ªå¯æ‰§è¡Œç¨‹åºè¯•è¯•çœ‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">./target/debug/hello_cargo <span class="hljs-comment"># or .\target\debug\hello_cargo.exe on Windows</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å¦‚æœæ˜¯linuxå°±ç›´æ¥è¿è¡Œè¿™ä¸ªäºŒè¿›åˆ¶ï¼Œå¦‚æœæ˜¯winå°±è¿è¡Œexe</span><br>Hello, world!<br></code></pre></td></tr></table></figure><p>ä¸€åˆ‡æ­£å¸¸çš„è¯ï¼ŒHello, world! åº”è¯¥èƒ½å¤Ÿè¢«æ‰“å°åˆ°ç»ˆç«¯ä¸Šã€‚é¦–æ¬¡ä½¿ç”¨å‘½ä»¤cargo buildæ„å»ºçš„æ—¶å€™ï¼Œå®ƒè¿˜ä¼šåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸ºCargo.lock çš„æ–°æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶è®°å½•äº†å½“å‰é¡¹ç›®æ‰€æœ‰ä¾èµ–åº“çš„å…·ä½“ç‰ˆæœ¬å·ã€‚ç”±äºå½“å‰çš„é¡¹ç›®ä¸å­˜åœ¨ä»»ä½•ä¾èµ–ï¼Œæ‰€ä»¥è¿™ä¸ªæ–‡ä»¶ä¸­è¿˜æ²¡æœ‰å¤ªå¤šä¸œè¥¿ã€‚ä½ æœ€å¥½ä¸è¦æ‰‹åŠ¨ç¼–è¾‘å…¶ä¸­çš„å†…å®¹ï¼ŒCargoå¯ä»¥å¸®åŠ©ä½ è‡ªåŠ¨ç»´æŠ¤å®ƒã€‚</p><p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥ç®€å•çš„ä½¿ç”¨cargo run å‘½ä»¤æ¥ä¸€æ¬¡å®Œæˆç¼–è¯‘å’Œè¿è¡Œä»»åŠ¡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">cargo run</span><br>    Finished dev [unoptimized + debuginfo] target(s) in 0.02s<br>     Running `target/debug/hello_cargo`<br>Hello, world!<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæ²¡æœ‰çœ‹åˆ°ç¼–è¯‘hello_cargoçš„ç›¸å…³ä¿¡æ¯ï¼Œå› ä¸ºcargoå‘ç°æºç å¹¶æ²¡æœ‰è¢«ä¿®æ”¹ï¼Œæ‰€ä»¥å°±ç›´æ¥è¿è¡Œäº†æ‰€ç”Ÿæˆçš„äºŒè¿›åˆ¶ï¼Œæˆ‘ä»¬ç°åœ¨ä¿®æ”¹ä¸€ä¸‹æºä»£ç å†è¯•è¯•run</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">cargo run</span><br>   Compiling hello_cargo v0.1.0 (/home/wang/code/rustStudy/hello/hello_cargo)<br>    Finished dev [unoptimized + debuginfo] target(s) in 0.13s # è¿™é‡Œå°±æ˜¯åœ¨é‡æ–°ç¼–è¯‘<br>     Running `target/debug/hello_cargo`<br>Hello, world!, test cargo run<br></code></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€ä¸ªå‘½ä»¤ï¼Œcargo check ï¼Œè¿™ä¸ªå‘½ä»¤å¯ä»¥å¿«é€Ÿæ£€æŸ¥å½“å‰çš„ä»£ç æ˜¯å¦å¯ä»¥é€šè¿‡ç¼–è¯‘ï¼Œè€Œä¸éœ€è¦èŠ±è´¹EAIçš„æ—¶é—´å»çœŸæ­£ç”Ÿæˆå¯æ‰§è¡Œç¨‹åº</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">cargo check</span><br>    Finished dev [unoptimized + debuginfo] target(s) in 0.00s<br></code></pre></td></tr></table></figure><p>æ€»ç»“ï¼š</p><p>cargo new project_name åˆ›å»ºä¸€ä¸ªCargoé¡¹ç›®ç›®å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">src --æ”¾é¡¹ç›®ä»£ç çš„ source çš„ç¼©å†™<br>target --ç›®æ ‡ï¼Œä¹Ÿå°±æ˜¯æ”¾æ„å»ºå®Œçš„ä¸œè¥¿çš„ç›®å½•<br>Cargo.lock è¿™ä¸ªæ–‡ä»¶è®°å½•äº†å½“å‰é¡¹ç›®æ‰€æœ‰ä¾èµ–åº“çš„å…·ä½“ç‰ˆæœ¬å·<br>Cargo.toml å­˜æ”¾Cargoçš„é…ç½®ä¿¡æ¯ï¼Œ<br>.gitignore gité…ç½®ä¿¡æ¯ï¼Œè¿™ä¸ªé‡Œé¢ç›®å‰çš„å†…å®¹æ˜¯/targetï¼Œè¡¨ç¤ºtargetè¿™ä¸ªç›®å½•ä¸ä¼šä¸Šä¼ åˆ°gitä¸Šå»<br></code></pre></td></tr></table></figure><p>é€šè¿‡cargo build å’Œcargo check æ¥æ„å»ºä¸€ä¸ªé¡¹ç›®</p><p>é€šè¿‡cargo run æ¥æ„å»ºå¹¶ä¸”è¿è¡Œè¿™ä¸ªé¡¹ç›®ï¼Œ</p><p>æ„å»ºæ‰€äº§ç”Ÿçš„ç»“æœä¼šè¢«Cargo å­˜å‚¨åœ¨<em>target&#x2F;debug</em>ç›®å½•ä¸‹é¢ï¼Œè€Œéä»£ç æ‰€å¤„åœ¨çš„ä½ç½®ï¼Œ</p><p>Cargoå¦ä¸€ä¸ªä¼˜åŠ¿æ˜¯ä¸åŒºåˆ†æ“ä½œç³»ç»Ÿï¼ˆLinux\MacOS\Windowsï¼‰ï¼Œåœ¨ä»»ä½•æ“ä½œç³»ç»Ÿä¸‹éƒ½æ˜¯ä¸€æ ·çš„å‘½ä»¤</p><h3 id="ä»¥Releaseæ¨¡å¼è¿›è¡Œæ„å»º"><a href="#ä»¥Releaseæ¨¡å¼è¿›è¡Œæ„å»º" class="headerlink" title="ä»¥Releaseæ¨¡å¼è¿›è¡Œæ„å»º"></a>ä»¥Releaseæ¨¡å¼è¿›è¡Œæ„å»º</h3><p>å½“å‡†å¤‡å¥½å‘å¸ƒè‡ªå·±çš„é¡¹ç›®æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨å‘½ä»¤cargo build â€“releaseåœ¨ä¼˜åŒ–æ¨¡å¼ä¸‹æ„å»ºå¹¶ç”Ÿæˆå¯æ‰§è¡Œç¨‹åºã€‚å®ƒç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶ä¼šè¢«æ”¾ç½®åœ¨<em>target&#x2F;release</em> ç›®å½•ä¸‹ï¼Œè€Œä¸æ˜¯ä¹‹å‰çš„<em>target&#x2F;debug</em> ç›®å½•ä¸‹ã€‚è¿™ç§æ¨¡å¼ä¼šä»¥æ›´é•¿çš„ç¼–è¯‘æ—¶é—´ä¸ºä»£ä»·æ¥ä¼˜åŒ–ä»£ç ï¼Œä»è€Œä½¿ä»£ç æ‹¥æœ‰æ›´å¥½çš„è¿è¡Œæ—¶æ€§èƒ½ã€‚</p><h1 id="ç¬¬äºŒç« -ç¼–å†™ä¸€ä¸ªçŒœæ•°æ¸¸æˆ"><a href="#ç¬¬äºŒç« -ç¼–å†™ä¸€ä¸ªçŒœæ•°æ¸¸æˆ" class="headerlink" title="ç¬¬äºŒç«  ç¼–å†™ä¸€ä¸ªçŒœæ•°æ¸¸æˆ"></a>ç¬¬äºŒç«  ç¼–å†™ä¸€ä¸ªçŒœæ•°æ¸¸æˆ</h1><h1 id="ç¬¬ä¸‰ç« -é€šç”¨ç¼–ç¨‹æ¦‚å¿µ"><a href="#ç¬¬ä¸‰ç« -é€šç”¨ç¼–ç¨‹æ¦‚å¿µ" class="headerlink" title="ç¬¬ä¸‰ç«  é€šç”¨ç¼–ç¨‹æ¦‚å¿µ"></a>ç¬¬ä¸‰ç«  é€šç”¨ç¼–ç¨‹æ¦‚å¿µ</h1><p>src&#x2F;main.rs</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">use</span> std::io;<br><br><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() &#123;<br>    <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;Guess the number!&quot;</span>);<br><br>    <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;Please input your guess.&quot;</span>);<br><br>    <span class="hljs-keyword">let</span> <span class="hljs-keyword">mut </span><span class="hljs-variable">guess</span> = <span class="hljs-type">String</span>::<span class="hljs-title function_ invoke__">new</span>();<br><br>    io::<span class="hljs-title function_ invoke__">stdin</span>().<span class="hljs-title function_ invoke__">read_line</span>(&amp;<span class="hljs-keyword">mut</span> guess)<br>        .<span class="hljs-title function_ invoke__">expect</span>(<span class="hljs-string">&quot;Failed to read line&quot;</span>);<br><br>    <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;You guessed: &#123;&#125;&quot;</span>, guess);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å˜é‡ä¸å¯å˜æ€§ï¼š"><a href="#å˜é‡ä¸å¯å˜æ€§ï¼š" class="headerlink" title="å˜é‡ä¸å¯å˜æ€§ï¼š"></a>å˜é‡ä¸å¯å˜æ€§ï¼š</h3><p>Rustä¸­çš„å˜é‡é»˜è®¤æ˜¯ä¸å¯å˜çš„ã€‚Rustè¯­è¨€æä¾›è¿™ä¸€æ¦‚å¿µæ˜¯ä¸ºäº†èƒ½å¤Ÿè®©ä½ å®‰å…¨ä¸”æ–¹ä¾¿åœ°å†™å‡ºå¤æ‚ã€ç”šè‡³æ˜¯å¹¶è¡Œçš„ä»£ç ã€‚</p><p>ä»£ç ï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() &#123;<br>    <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;Hello, world!, test cargo run&quot;</span>);<br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">x</span> = <span class="hljs-number">5</span>; <span class="hljs-comment">// å¦‚æœè¦å¯¹å˜é‡è¿›è¡ŒäºŒæ¬¡èµ‹å€¼ï¼Œå°±è¦ä½¿ç”¨let mut x = 5;</span><br>    <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;x is &#123;&#125;&quot;</span>,x);<br>    x = <span class="hljs-number">6</span>;<br>    <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;x is &#123;&#125;&quot;</span>,x);<br>&#125;<br><span class="hljs-comment">// è¿™é‡Œè¿è¡Œä¼šæŠ¥é”™ï¼Œçœ‹æŠ¥é”™æç¤º</span><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">$ cargo run</span><br><span class="hljs-comment">   Compiling hello_cargo v0.1.0 (/home/wang/code/rustStudy/hello/hello_cargo)</span><br><span class="hljs-comment">error[E0384]: cannot assign twice to immutable variable `x`</span><br><span class="hljs-comment"> --&gt; src/main.rs:5:5</span><br><span class="hljs-comment">  |</span><br><span class="hljs-comment">3 |     let x = 5;</span><br><span class="hljs-comment">  |         -</span><br><span class="hljs-comment">  |         |</span><br><span class="hljs-comment">  |         first assignment to `x`  ç¬¬ä¸€ä¸ªä»»åŠ¡x</span><br><span class="hljs-comment">  |         help: consider making this binding mutable: `mut x` xæ˜¯ä¸€ä¸ªä¸å˜çš„ç±»å‹</span><br><span class="hljs-comment">4 |     println!(&quot;x is &#123;&#125;&quot;,x);</span><br><span class="hljs-comment">5 |     x = 6;</span><br><span class="hljs-comment">  |     ^^^^^ cannot assign twice to immutable variable ä¸å¯ä»¥å¯¹ä¸å˜ç±»å‹å˜é‡è¿›è¡ŒäºŒæ¬¡èµ‹å€¼</span><br><span class="hljs-comment"></span><br><span class="hljs-comment">For more information about this error, try `rustc --explain E0384`.</span><br><span class="hljs-comment">error: could not compile `hello_cargo` (bin &quot;hello_cargo&quot;) due to 1 previous error</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦å®šä¹‰å¯å˜å˜é‡ï¼Œå°±å¿…é¡»<code>let mut x = 5;</code></p><p>é™¤äº†é¿å…å‡ºç°bugï¼Œè®¾è®¡ä¸€ä¸ªå˜é‡çš„å¯å˜æ€§è¿˜éœ€è¦è€ƒé‡è®¸å¤šå› ç´ ã€‚ä¾‹å¦‚å½“ä½ åœ¨ä½¿ç”¨æŸäº›é‡å‹æ•°æ®ç»“æ„æ—¶ï¼Œé€‚å½“åœ°ä½¿ç”¨å¯å˜æ€§å»ä¿®æ”¹ä¸€ä¸ªå®ä¾‹ï¼Œå¯èƒ½æ¯”èµ‹å€¼å’Œé‡æ–°è¿”å›ä¸€ä¸ªæ–°åˆ†é…çš„å®ä¾‹è¦æ›´æœ‰æ•ˆç‡ï¼›è€Œå½“æ•°æ®ç»“æ„è¾ƒä¸ºè½»é‡çš„æ—¶å€™ï¼Œé‡‡ç”¨æ›´åå‘å‡½æ•°å¼çš„é£æ ¼ï¼Œé€šè¿‡åˆ›å»ºæ–°å˜é‡æ¥è¿›è¡Œèµ‹å€¼ï¼Œå¯èƒ½ä¼šä½¿ä»£ç æ›´åŠ æ˜“äºç†è§£ã€‚åœ¨ç±»ä¼¼è¿™æ ·çš„æƒ…å½¢ä¸‹ï¼Œä¸ºäº†å¯è¯»æ€§è€ŒæŸå¤±å°‘è®¸çš„æ€§èƒ½ä¹Ÿè®¸æ˜¯å€¼å¾—çš„ã€‚</p><h3 id="å¸¸é‡"><a href="#å¸¸é‡" class="headerlink" title="å¸¸é‡"></a>å¸¸é‡</h3><p>ä¸ä¸å¯å˜å˜é‡ç±»ä¼¼ï¼Œ<strong>å¸¸é‡</strong>ï¼ˆconstantï¼‰æ˜¯ç»‘å®šåˆ°ä¸€ä¸ªå¸¸é‡åä¸”ä¸å…è®¸æ›´æ”¹çš„å€¼ï¼Œä½†æ˜¯å¸¸é‡å’Œå˜é‡ä¹‹é—´æ˜¯æœ‰å·®å¼‚çš„</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-meta">#![allow(unused)]</span><br><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() &#123;<br>    <span class="hljs-keyword">const</span> THREE_HOURS_IN_SECONDS: <span class="hljs-type">u32</span> = <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * <span class="hljs-number">3</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="é®è”½"><a href="#é®è”½" class="headerlink" title="é®è”½"></a>é®è”½</h3><p>ä½ å¯ä»¥å£°æ˜å’Œå‰é¢å˜é‡å…·æœ‰ç›¸åŒåç§°çš„æ–°å˜é‡ã€‚è¿™ä¸ªæ˜¯ç¬¬ä¸€ä¸ªå˜é‡è¢«ç¬¬äºŒä¸ªå˜é‡<strong>é®è”½</strong>ï¼ˆ<em>shadow</em>ï¼‰</p><p>é®è”½å’Œå°†å˜é‡æ ‡è®°ä¸º <code>mut</code> çš„æ–¹å¼ä¸åŒï¼Œå› ä¸ºé™¤éæˆ‘ä»¬å†æ¬¡ä½¿ç”¨ <code>let</code> å…³é”®å­—ï¼Œå¦åˆ™è‹¥æ˜¯æˆ‘ä»¬ä¸å°å¿ƒå°è¯•é‡æ–°èµ‹å€¼ç»™è¿™ä¸ªå˜é‡ï¼Œæˆ‘ä»¬å°†å¾—åˆ°ä¸€ä¸ªç¼–è¯‘é”™è¯¯ã€‚é€šè¿‡ä½¿ç”¨ <code>let</code>ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ä¸€ä¸ªå€¼è¿›è¡Œä¸€äº›è½¬æ¢ï¼Œä½†åœ¨è¿™äº›è½¬æ¢å®Œæˆåï¼Œå˜é‡å°†æ˜¯ä¸å¯å˜çš„ã€‚</p><p><code>mut</code> å’Œé®è”½ä¹‹é—´çš„å¦ä¸€ä¸ªåŒºåˆ«æ˜¯ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨å†æ¬¡ä½¿ç”¨ <code>let</code> å…³é”®å­—æ—¶æœ‰æ•ˆåœ°åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å˜é‡ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ”¹å˜å€¼çš„ç±»å‹ï¼Œä½†é‡å¤ä½¿ç”¨ç›¸åŒçš„åç§°ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬ç¨‹åºè¦æ±‚ç”¨æˆ·è¾“å…¥ç©ºæ ¼å­—ç¬¦æ¥æ˜¾ç¤ºä»–ä»¬æƒ³è¦çš„ç©ºæ ¼æ•°ç›®ï¼Œä½†æˆ‘ä»¬å®é™…ä¸Šæƒ³è¦å°†è¯¥è¾“å…¥å­˜å‚¨ä¸ºä¸€ä¸ªæ•°å­—ï¼š</p><h3 id="å˜é‡"><a href="#å˜é‡" class="headerlink" title="å˜é‡"></a>å˜é‡</h3><p>Rustæ˜¯ä¸€ç§é™æ€ç±»å‹ï¼ˆstatically typedï¼‰çš„è¯­è¨€ï¼Œæ„å‘³ç€å®ƒå¿…é¡»åœ¨ç¼–è¯‘æœŸé—´å°±è¦çŸ¥é“æ‰€æœ‰å˜é‡çš„ç±»å‹ï¼Œã€</p><h3 id="æ•´å‹"><a href="#æ•´å‹" class="headerlink" title="æ•´å‹"></a>æ•´å‹</h3><p>è¡¨ 3-1: Rust ä¸­çš„æ•´å‹</p><table><thead><tr><th>é•¿åº¦</th><th>æœ‰ç¬¦å·ç±»å‹</th><th>æ— ç¬¦å·ç±»å‹</th></tr></thead><tbody><tr><td>8 ä½</td><td><code>i8</code></td><td><code>u8</code></td></tr><tr><td>16 ä½</td><td><code>i16</code></td><td><code>u16</code></td></tr><tr><td>32 ä½</td><td><code>i32</code></td><td><code>u32</code></td></tr><tr><td>64 ä½</td><td><code>i64</code></td><td><code>u64</code></td></tr><tr><td>128 ä½</td><td><code>i128</code></td><td><code>u128</code></td></tr><tr><td>arch</td><td><code>isize</code></td><td><code>usize</code></td></tr></tbody></table><p><strong>æœ‰ç¬¦å·</strong>å’Œ<strong>æ— ç¬¦å·</strong>è¡¨ç¤ºæ•°å­—èƒ½å¦å–è´Ÿæ•°</p><p>æ¯ä¸ªæœ‰ç¬¦å·ç±»å‹è§„å®šçš„æ•°å­—èŒƒå›´æ˜¯ -(2^(n - 1) ~ 2^(n - 1) - 1ï¼Œå…¶ä¸­ <code>n</code> æ˜¯è¯¥å®šä¹‰å½¢å¼çš„ä½é•¿åº¦ã€‚æ‰€ä»¥ <code>i8</code> å¯å­˜å‚¨æ•°å­—èŒƒå›´æ˜¯ -(2^7) ~ 2^7 - 1ï¼Œå³ -128 ~ 127ã€‚</p><p>æ— ç¬¦å·ç±»å‹å¯ä»¥å­˜å‚¨çš„æ•°å­—èŒƒå›´æ˜¯ 0 ~( 2^n )- 1ï¼Œæ‰€ä»¥ <code>u8</code> èƒ½å¤Ÿå­˜å‚¨çš„æ•°å­—ä¸º 0 ~ 2^(8 - 1)ï¼Œå³ 0 ~ 255ã€‚</p><p>æ­¤å¤–ï¼Œ<code>isize</code> å’Œ <code>usize</code> ç±»å‹å–å†³äºç¨‹åºè¿è¡Œçš„è®¡ç®—æœºä½“ç³»ç»“æ„ï¼Œåœ¨è¡¨ä¸­è¡¨ç¤ºä¸ºâ€œarchâ€ï¼šè‹¥ä½¿ç”¨ 64 ä½æ¶æ„ç³»ç»Ÿåˆ™ä¸º 64 ä½ï¼Œè‹¥ä½¿ç”¨ 32 ä½æ¶æ„ç³»ç»Ÿåˆ™ä¸º 32 ä½ã€‚</p><p>æ³¨æ„ï¼Œå¯èƒ½å±äºå¤šç§æ•°å­—ç±»å‹çš„æ•°å­—å­—é¢é‡å…è®¸ä½¿ç”¨ç±»å‹åç¼€æ¥æŒ‡å®šç±»å‹ï¼Œä¾‹å¦‚ <code>57u8</code>ã€‚æ•°å­—å­—é¢é‡è¿˜å¯ä»¥ä½¿ç”¨ <code>_</code> ä½œä¸ºå¯è§†åˆ†éš”ç¬¦ä»¥æ–¹ä¾¿è¯»æ•°ï¼Œå¦‚ <code>1_000</code>ï¼Œæ­¤å€¼å’Œ <code>1000</code> ç›¸åŒã€‚</p><p>è¡¨ 3-2: Rust çš„æ•´å‹å­—é¢é‡</p><table><thead><tr><th>æ•°å­—å­—é¢é‡</th><th>ç¤ºä¾‹</th></tr></thead><tbody><tr><td>åè¿›åˆ¶</td><td><code>98_222</code></td></tr><tr><td>åå…­è¿›åˆ¶</td><td><code>0xff</code></td></tr><tr><td>å…«è¿›åˆ¶</td><td><code>0o77</code></td></tr><tr><td>äºŒè¿›åˆ¶</td><td><code>0b1111_0000</code></td></tr><tr><td>å­—èŠ‚ (ä»…é™äº <code>u8</code>)</td><td><code>b&#39;A&#39;</code></td></tr></tbody></table><p>é‚£ä¹ˆè¯¥ä½¿ç”¨å“ªç§ç±»å‹çš„æ•´å‹å‘¢ï¼Ÿå¦‚æœä¸ç¡®å®šï¼ŒRust çš„é»˜è®¤å½¢å¼é€šå¸¸æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œæ•´å‹é»˜è®¤æ˜¯ <code>i32</code>ã€‚<code>isize</code> å’Œ <code>usize</code> çš„ä¸»è¦åº”ç”¨åœºæ™¯æ˜¯ç”¨ä½œæŸäº›é›†åˆçš„ç´¢å¼•ã€‚</p><p>i32 å°±æ˜¯ -2^31~2^31-1</p><h3 id="æ•´å‹æº¢å‡º"><a href="#æ•´å‹æº¢å‡º" class="headerlink" title="æ•´å‹æº¢å‡º"></a>æ•´å‹æº¢å‡º</h3><p>æ¯”æ–¹è¯´æœ‰ä¸€ä¸ª<code>u8</code> ,å­˜æ”¾åŒºé—´æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯0<del>(2^8)-1&#x3D;0</del>255</p><p>å¦‚æœå½“ä½ å°†å…¶ä¿®æ”¹ä¸ºèŒƒå›´ä¹‹å¤–çš„å€¼ï¼Œæ¯”å¦‚è¯´256ï¼Œåˆ™ä¼šå‘ç”Ÿ<strong>æ•´å‹æº¢å‡ºï¼ˆinteger overflowï¼‰</strong>,è¿™ä¼šå¯¼è‡´ä¸¤ç§è¡Œä¸ºçš„å…¶ä¸­ä¸€ç§ï¼š</p><p>1ã€å½“åœ¨è°ƒè¯•ï¼ˆdebugï¼‰æ¨¡å¼ç¼–è¯‘æ—¶ï¼ŒRust ä¼šæ£€æŸ¥æ•´å‹æº¢å‡ºï¼Œè‹¥å­˜åœ¨è¿™äº›é—®é¢˜åˆ™ä½¿ç¨‹åºåœ¨ç¼–è¯‘æ—¶ <em>panic</em>ã€‚Rust ä½¿ç”¨ panic è¿™ä¸ªæœ¯è¯­æ¥è¡¨æ˜ç¨‹åºå› é”™è¯¯è€Œé€€å‡ºã€‚ç¬¬ 9 ç«  [â€œ<code>panic!</code> ä¸ä¸å¯æ¢å¤çš„é”™è¯¯â€](file:&#x2F;&#x2F;&#x2F;opt&#x2F;Koodo Reader&#x2F;resources&#x2F;app.asar&#x2F;build&#x2F;ch09-01-unrecoverable-errors-with-panic.xhtml)ä¼šè¯¦ç»†ä»‹ç» panicã€‚</p><p>2ã€åœ¨å½“ä½¿ç”¨ <code>--release</code> å‚æ•°è¿›è¡Œå‘å¸ƒï¼ˆreleaseï¼‰æ¨¡å¼æ„å»ºæ—¶ï¼ŒRust <strong>ä¸</strong>æ£€æµ‹ä¼šå¯¼è‡´ panic çš„æ•´å‹æº¢å‡ºã€‚ç›¸åå½“æ£€æµ‹åˆ°æ•´å‹æº¢å‡ºæ—¶ï¼ŒRust ä¼šè¿›è¡Œä¸€ç§è¢«ç§°ä¸ºäºŒè¿›åˆ¶è¡¥ç åŒ…è£¹ï¼ˆ<em>twoâ€™s complement wrapping</em>ï¼‰çš„æ“ä½œã€‚ç®€è€Œè¨€ä¹‹ï¼Œå¤§äºè¯¥ç±»å‹æœ€å¤§å€¼çš„æ•°å€¼ä¼šè¢«â€œåŒ…è£¹â€æˆè¯¥ç±»å‹èƒ½å¤Ÿæ”¯æŒçš„å¯¹åº”æ•°å­—çš„æœ€å°å€¼ã€‚æ¯”å¦‚åœ¨ <code>u8</code> çš„æƒ…å†µä¸‹ï¼Œ256 å˜æˆ 0ï¼Œ257 å˜æˆ 1ï¼Œä¾æ­¤ç±»æ¨ã€‚ç¨‹åºä¸ä¼š panicï¼Œä½†æ˜¯è¯¥å˜é‡çš„å€¼å¯èƒ½ä¸æ˜¯ä½ æœŸæœ›çš„å€¼ã€‚ä¾èµ–æ•´å‹æº¢å‡ºåŒ…è£¹çš„è¡Œä¸ºä¸æ˜¯ä¸€ç§æ­£ç¡®çš„åšæ³•ã€‚</p><h3 id="æµ®ç‚¹å‹"><a href="#æµ®ç‚¹å‹" class="headerlink" title="æµ®ç‚¹å‹"></a>æµ®ç‚¹å‹</h3><p>æµ®ç‚¹æ•°æ˜¯å¸¦æœ‰å°æ•°ç‚¹çš„æ•°å­—ï¼ŒRustä¸­æœ‰ä¸¤ç§ï¼š</p><p><code>f32</code>ç±»å‹æ˜¯å•ç²¾åº¦æµ®ç‚¹å‹</p><p><code>f64</code>ä¸ºåŒç²¾åº¦æµ®ç‚¹å‹ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() &#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">x</span> = <span class="hljs-number">2.0</span>; <span class="hljs-comment">// f64</span><br><br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">y</span>: <span class="hljs-type">f32</span> = <span class="hljs-number">3.0</span>; <span class="hljs-comment">// f32</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="æ•°å­—è¿ç®—"><a href="#æ•°å­—è¿ç®—" class="headerlink" title="æ•°å­—è¿ç®—"></a>æ•°å­—è¿ç®—</h3><p>Rust çš„æ‰€æœ‰æ•°å­—ç±»å‹éƒ½æ”¯æŒåŸºæœ¬æ•°å­¦è¿ç®—ï¼šåŠ æ³•ã€å‡æ³•ã€ä¹˜æ³•ã€é™¤æ³•å’Œå–æ¨¡è¿ç®—ã€‚æ•´æ•°é™¤æ³•ä¼šå‘ä¸‹å–æ•´ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs rust"><br><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() &#123;<br>    <span class="hljs-comment">// addition</span><br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">sum</span> = <span class="hljs-number">5</span> + <span class="hljs-number">10</span>;<br><br>    <span class="hljs-comment">// subtraction</span><br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">difference</span> = <span class="hljs-number">95.5</span> - <span class="hljs-number">4.3</span>;<br><br>    <span class="hljs-comment">// multiplication</span><br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">product</span> = <span class="hljs-number">4</span> * <span class="hljs-number">30</span>;<br><br>    <span class="hljs-comment">// division</span><br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">quotient</span> = <span class="hljs-number">56.7</span> / <span class="hljs-number">32.2</span>;<br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">floored</span> = <span class="hljs-number">2</span> / <span class="hljs-number">3</span>; <span class="hljs-comment">// Results in 0</span><br><br>    <span class="hljs-comment">// remainder</span><br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">remainder</span> = <span class="hljs-number">43</span> % <span class="hljs-number">5</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å¸ƒå°”ç±»å‹"><a href="#å¸ƒå°”ç±»å‹" class="headerlink" title="å¸ƒå°”ç±»å‹"></a>å¸ƒå°”ç±»å‹</h3><p>å’Œå¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€ä¸€æ ·ï¼ŒRust ä¸­çš„å¸ƒå°”ç±»å‹ä¹Ÿæœ‰ä¸¤ä¸ªå¯èƒ½çš„å€¼ï¼š<code>true</code> å’Œ <code>false</code>ã€‚å¸ƒå°”å€¼çš„å¤§å°ä¸º 1 ä¸ªå­—èŠ‚ã€‚Rust ä¸­çš„å¸ƒå°”ç±»å‹ä½¿ç”¨ <code>bool</code> å£°æ˜ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs rust"><br><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() &#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">t</span> = <span class="hljs-literal">true</span>;<br><br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">f</span>: <span class="hljs-type">bool</span> = <span class="hljs-literal">false</span>; <span class="hljs-comment">// with explicit type annotation</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="å­—ç¬¦ç±»å‹"><a href="#å­—ç¬¦ç±»å‹" class="headerlink" title="å­—ç¬¦ç±»å‹"></a>å­—ç¬¦ç±»å‹</h3><p>Rust çš„ <code>char</code>ï¼ˆå­—ç¬¦ï¼‰ç±»å‹æ˜¯è¯¥è¯­è¨€æœ€åŸºæœ¬çš„å­—æ¯ç±»å‹ï¼Œ</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() &#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">c</span> = <span class="hljs-string">&#x27;z&#x27;</span>;<br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">z</span> = <span class="hljs-string">&#x27;â„¤&#x27;</span>;<br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">heart_eyed_cat</span> = &#x27;ğŸ˜»&#x27;;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œæˆ‘ä»¬å£°æ˜çš„ <code>char</code> å­—é¢é‡é‡‡ç”¨å•å¼•å·æ‹¬èµ·æ¥ï¼Œè¿™ä¸å­—ç¬¦ä¸²å­—é¢é‡ä¸åŒï¼Œå­—ç¬¦ä¸²å­—é¢é‡æ˜¯ç”¨åŒå¼•å·æ‹¬èµ·æ¥ã€‚</p><p>Rust çš„å­—ç¬¦ç±»å‹å¤§å°ä¸º 4 ä¸ªå­—èŠ‚ï¼Œè¡¨ç¤ºçš„æ˜¯ä¸€ä¸ª Unicode æ ‡é‡å€¼ï¼Œè¿™æ„å‘³ç€å®ƒå¯ä»¥è¡¨ç¤ºçš„è¿œè¿œä¸æ­¢æ˜¯ ASCIIã€‚</p><p>æ ‡éŸ³å­—æ¯ï¼Œä¸­æ–‡&#x2F;æ—¥æ–‡&#x2F;éŸ©æ–‡çš„æ–‡å­—ï¼Œemojiï¼Œè¿˜æœ‰é›¶å®½ç©ºæ ¼(zero width space)åœ¨ Rust ä¸­éƒ½æ˜¯åˆæ³•çš„å­—ç¬¦ç±»å‹ã€‚</p><p>Unicode å€¼çš„èŒƒå›´ä¸º <code>U+0000</code> ~ <code>U+D7FF</code> å’Œ <code>U+E000</code>~&#96;U+10FFFF&#96;ã€‚</p><p>ä¸è¿‡â€œå­—ç¬¦â€å¹¶ä¸æ˜¯ Unicode ä¸­çš„ä¸€ä¸ªæ¦‚å¿µï¼Œæ‰€ä»¥äººåœ¨ç›´è§‰ä¸Šå¯¹â€œå­—ç¬¦â€çš„ç†è§£å’Œ Rust çš„å­—ç¬¦æ¦‚å¿µå¹¶ä¸ä¸€è‡´ã€‚</p><h3 id="å¤åˆç±»å‹"><a href="#å¤åˆç±»å‹" class="headerlink" title="å¤åˆç±»å‹"></a>å¤åˆç±»å‹</h3><p><strong>å¤åˆç±»å‹</strong>ï¼ˆ<em>compound type</em>ï¼‰å¯ä»¥å°†å¤šä¸ªå€¼ç»„åˆæˆä¸€ä¸ªç±»å‹ã€‚Rust æœ‰ä¸¤ç§åŸºæœ¬çš„å¤åˆç±»å‹ï¼šå…ƒç»„ï¼ˆtupleï¼‰å’Œæ•°ç»„ï¼ˆarrayï¼‰</p><h3 id="å…ƒç»„ç±»å‹"><a href="#å…ƒç»„ç±»å‹" class="headerlink" title="å…ƒç»„ç±»å‹"></a>å…ƒç»„ç±»å‹</h3><p>å…ƒç»„æ˜¯å°†å¤šç§ç±»å‹çš„å¤šä¸ªå€¼ç»„åˆåˆ°ä¸€ä¸ªå¤åˆç±»å‹ä¸­çš„ä¸€ç§åŸºæœ¬æ–¹å¼ã€‚å…ƒç»„çš„é•¿åº¦æ˜¯å›ºå®šçš„ï¼šå£°æ˜åï¼Œå®ƒä»¬å°±æ— æ³•å¢é•¿æˆ–ç¼©å°ã€‚</p><p>æˆ‘ä»¬é€šè¿‡åœ¨å°æ‹¬å·å†…å†™å…¥ä»¥é€—å·åˆ†éš”çš„å€¼åˆ—è¡¨æ¥åˆ›å»ºä¸€ä¸ªå…ƒç»„ã€‚</p><p>å…ƒç»„ä¸­çš„æ¯ä¸ªä½ç½®éƒ½æœ‰ä¸€ä¸ªç±»å‹ï¼Œå¹¶ä¸”å…ƒç»„ä¸­ä¸åŒå€¼çš„ç±»å‹ä¸è¦æ±‚æ˜¯ç›¸åŒçš„ã€‚</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() &#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">tup</span>: (<span class="hljs-type">i32</span>, <span class="hljs-type">f64</span>, <span class="hljs-type">u8</span>) = (<span class="hljs-number">500</span>, <span class="hljs-number">6.4</span>, <span class="hljs-number">1</span>);<span class="hljs-comment">//å˜é‡ `tup` ç»‘å®šåˆ°æ•´ä¸ªå…ƒç»„ï¼Œ</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å› ä¸ºå…ƒç»„è¢«è®¤ä½œæ˜¯å•ä¸ªå¤åˆå…ƒç´ ã€‚ æƒ³ä»å…ƒç»„ä¸­è·å–ä¸ªåˆ«å€¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¨¡å¼åŒ¹é…æ¥<strong>è§£æ„</strong>ï¼ˆdestructureï¼‰å…ƒç»„çš„ä¸€ä¸ªå€¼ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() &#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">tup</span> = (<span class="hljs-number">500</span>, <span class="hljs-number">6.4</span>, <span class="hljs-number">1</span>); <span class="hljs-comment">//å˜é‡ `tup` ç»‘å®šåˆ°æ•´ä¸ªå…ƒç»„ï¼Œ</span><br><br>    <span class="hljs-keyword">let</span> (x, y, z) = tup; <span class="hljs-comment">// ç”¨å¯¹åº”çš„3ä¸ªå˜é‡å»æ¥æ”¶å®ƒ,</span><br><br>    <span class="hljs-built_in">println!</span>(<span class="hljs-string">&quot;The value of y is: &#123;&#125;&quot;</span>, y);<br>    <span class="hljs-comment">// è¿™é‡Œæ³¨æ„æŠ¥é”™æé†’ä½ xå’Œzæ˜¯æœªä½¿ç”¨çš„å˜é‡ï¼Œå‰é¢åŠ _å°±å¯ä»¥</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å°†è¿™ä¸ªå…ƒç»„åˆ†è§£æˆä¸‰ä¸ªå•ç‹¬çš„å˜é‡xã€yã€zï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºè§£æ„</p><p>é™¤äº†é€šè¿‡æ¨¡å¼åŒ¹é…è¿›è¡Œç»“æ„å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡ä½¿ç”¨ä¸€ä¸ªå¥ç‚¹ï¼ˆ.ï¼‰è¿ä¸Šè¦è®¿é—®çš„å€¼çš„<strong>ç´¢å¼•</strong>æ¥ç›´æ¥è®¿é—®å…ƒç»„å…ƒç´ ï¼ˆç±»ä¼¼Pythonä¸‹æ ‡ç´¢å¼•å–å€¼ï¼‰ï¼Œä»£ç ç¤ºä¾‹:</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() &#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">x</span>: (<span class="hljs-type">i32</span>, <span class="hljs-type">f64</span>, <span class="hljs-type">u8</span>) = (<span class="hljs-number">500</span>, <span class="hljs-number">6.4</span>, <span class="hljs-number">1</span>);<br><br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">five_hundred</span> = x.<span class="hljs-number">0</span>; <span class="hljs-comment">// ä¸‹æ ‡ç´¢å¼•ä¸º 0 çš„å€¼</span><br><br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">six_point_four</span> = x.<span class="hljs-number">1</span>;<br><br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">one</span> = x.<span class="hljs-number">2</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ²¡æœ‰ä»»ä½•å€¼çš„å…ƒç»„<code>()</code>æ˜¯ä¸€ç§ç‰¹ä¿—çš„ç±»å‹ï¼Œåªæœ‰ä¸€ä¸ªå€¼ï¼Œä¹Ÿå¯ä»¥å†™æˆ<code>()</code>ã€‚è¯¥ç±»å‹è¢«ç§°ä¸º<strong>å•å…ƒç±»å‹ï¼ˆunit typeï¼‰</strong>ï¼Œè¯¥å€¼ä¹Ÿè¢«ç§°ä¸º<strong>å•å…ƒå€¼ï¼ˆunit valueï¼‰</strong>ã€‚å¦‚æœè¡¨è¾¾å¼ä¸è¿”å›ä»»ä½•å…¶ä»–å€¼ï¼Œå°±éšå¼åœ°è¿”å›å•å…ƒå€¼ã€‚</p><h3 id="æ•°ç»„ç±»å‹"><a href="#æ•°ç»„ç±»å‹" class="headerlink" title="æ•°ç»„ç±»å‹"></a>æ•°ç»„ç±»å‹</h3><p>æ•°ç»„ï¼šå°†å¤šä¸ªå€¼ç»„åˆåœ¨ä¸€èµ·çš„å¦ä¸€ç§æ–¹å¼å°±æ˜¯<strong>æ•°ç»„ï¼ˆarrayï¼‰</strong>ã€‚ä¸å…ƒç»„ä¸åŒï¼Œæ•°ç»„å†…çš„æ¯ä¸ªå…ƒç´ å¿…é¡»æ˜¯<strong>åŒæ ·ç±»å‹</strong>çš„å…ƒç´ ï¼Œ</p><p>é•¿åº¦ï¼šRustè¯­è¨€çš„æ•°ç»„æ˜¯å›ºå®šé•¿åº¦çš„ã€‚</p><p>è¡¨è¾¾å½¢å¼ï¼šæ–¹æ‹¬å·å†…é€—å·åˆ†éš”</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">let</span> <span class="hljs-variable">a</span>  = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>];<br></code></pre></td></tr></table></figure><p>ç‰¹ç‚¹ï¼š</p><ul><li><p>å½“ä½ å¸Œæœ›å°†æ•°æ®åˆ†é…åˆ°<strong>æ ˆï¼ˆstackï¼‰</strong>è€Œä¸æ˜¯<strong>å †ï¼ˆheapï¼‰</strong>æ—¶ï¼Œæˆ–è€…å¸Œæœ›ç¡®ä¿å§‹ç»ˆå…·æœ‰å›ºå®šæ•°é‡çš„å…ƒç´ æ—¶ï¼Œæ•°ç»„å°±ç‰¹åˆ«æœ‰ç”¨ã€‚</p></li><li><p>ä½†å®ƒä¸åƒ<strong>vector</strong>ï¼ˆä¸­æ–‡ç¿»è¯‘ä¸ºâ€œå‘é‡â€ï¼ŒRustä¸­çš„æ„ä¹‰ä¸ºâ€œåŠ¨æ€æ•°æ®ã€å¯å˜æ•°ç»„â€ï¼‰ç±»å‹é‚£ä¹ˆçµæ´»ã€‚</p></li><li><p>vector ç±»å‹ç±»ä¼¼äºæ ‡å‡†åº“ä¸­æä¾›çš„é›†åˆç±»å‹ï¼Œå…¶å¤§å°<strong>å…è®¸</strong>å¢é•¿æˆ–ç¼©å°ã€‚</p></li><li><p>å¦‚æœä¸ç¡®å®šæ˜¯ä½¿ç”¨æ•°ç»„è¿˜æ˜¯ vectorï¼Œé‚£å°±åº”è¯¥ä½¿ç”¨ä¸€ä¸ª vectorã€‚</p></li><li><p>ä¸è¿‡å½“ä½ æ˜ç¡®å…ƒç´ æ•°é‡ä¸éœ€è¦æ”¹å˜æ—¶ï¼Œæ•°ç»„ä¼šæ›´æœ‰ç”¨ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ åœ¨ç¨‹åºä¸­ä½¿ç”¨æœˆä»½çš„åç§°ï¼Œä½ å¾ˆå¯èƒ½å¸Œæœ›ä½¿ç”¨çš„æ˜¯æ•°ç»„è€Œä¸æ˜¯ vectorï¼Œå› ä¸ºä½ çŸ¥é“å®ƒå§‹ç»ˆåŒ…å« 12 ä¸ªå…ƒç´ ï¼š</p></li></ul><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-meta">#![allow(unused)]</span><br><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() &#123;<br><span class="hljs-keyword">let</span> <span class="hljs-variable">months</span> = [<span class="hljs-string">&quot;January&quot;</span>, <span class="hljs-string">&quot;February&quot;</span>, <span class="hljs-string">&quot;March&quot;</span>, <span class="hljs-string">&quot;April&quot;</span>, <span class="hljs-string">&quot;May&quot;</span>, <span class="hljs-string">&quot;June&quot;</span>, <span class="hljs-string">&quot;July&quot;</span>,<br>              <span class="hljs-string">&quot;August&quot;</span>, <span class="hljs-string">&quot;September&quot;</span>, <span class="hljs-string">&quot;October&quot;</span>, <span class="hljs-string">&quot;November&quot;</span>, <span class="hljs-string">&quot;December&quot;</span>];<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨æ–¹æ‹¬å·ç¼–å†™æ•°ç»„çš„ç±»å‹ï¼Œå…¶ä¸­åŒ…å«æ¯ä¸ªå…ƒç´ çš„ç±»å‹ã€åˆ†å·ï¼Œç„¶åæ˜¯æ•°ç»„ä¸­çš„å…ƒç´ æ•°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-meta">#![allow(unused)]</span><br><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() &#123;<br><span class="hljs-keyword">let</span> <span class="hljs-variable">a</span>: [<span class="hljs-type">i32</span>; <span class="hljs-number">5</span>] = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]; <span class="hljs-comment">// i32æ•´å‹ï¼Œ5ä¸ªå…ƒç´ </span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä»¥è¿™ç§æ–¹å¼ç¼–å†™æ•°ç»„çš„ç±»å‹çœ‹èµ·æ¥ç±»ä¼¼äºåˆå§‹åŒ–æ•°ç»„çš„å¦ä¸€ç§è¯­æ³•ï¼šå¦‚æœè¦ä¸ºæ¯ä¸ªå…ƒç´ åˆ›å»ºåŒ…å«ç›¸åŒå€¼çš„æ•°ç»„ï¼Œå¯ä»¥æŒ‡å®šåˆå§‹å€¼ï¼Œåè·Ÿåˆ†å·ï¼Œç„¶ååœ¨æ–¹æ‹¬å·ä¸­æŒ‡å®šæ•°ç»„çš„é•¿åº¦ï¼Œ</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() &#123;<br><span class="hljs-keyword">let</span> <span class="hljs-variable">a</span> = [<span class="hljs-number">3</span>; <span class="hljs-number">5</span>]; <span class="hljs-comment">// 5ä¸ª3 ç­‰äº [3,3,3,3,3]</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="è®¿é—®æ•°ç»„å†…å…ƒç´ "><a href="#è®¿é—®æ•°ç»„å†…å…ƒç´ " class="headerlink" title="è®¿é—®æ•°ç»„å†…å…ƒç´ "></a>è®¿é—®æ•°ç»„å†…å…ƒç´ </h3><p>æ•°ç»„æ˜¯å¯ä»¥åœ¨æ ˆä¸Šåˆ†é…çš„å·²çŸ¥å›ºå®šå¤§å°çš„å•ä¸ªå†…å­˜å—ã€‚å¯ä»¥ä½¿ç”¨ç´¢å¼•è®¿é—®æ•°ç»„çš„å…ƒç´ ï¼Œ</p><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs rust"><span class="hljs-keyword">fn</span> <span class="hljs-title function_">main</span>() &#123;<br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">a</span> = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];<br><br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">first</span> = a[<span class="hljs-number">0</span>]; <span class="hljs-comment">// è·å–ç¬¬ä¸€ä¸ªå€¼</span><br>    <span class="hljs-keyword">let</span> <span class="hljs-variable">second</span> = a[<span class="hljs-number">1</span>];<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å‡½æ•°"><a href="#å‡½æ•°" class="headerlink" title="å‡½æ•°"></a>å‡½æ•°</h2>]]></content>
    
    
    <categories>
      
      <category>rust</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç¬”è®°</tag>
      
      <tag>rust</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pythonåº“ä¹‹locust</title>
    <link href="/2024/05/07/691python%E5%BA%93%E5%AD%A6%E4%B9%A0%E4%B9%8Blocust/"/>
    <url>/2024/05/07/691python%E5%BA%93%E5%AD%A6%E4%B9%A0%E4%B9%8Blocust/</url>
    
    <content type="html"><![CDATA[<h1 id="locust-åº“ç®€ä»‹"><a href="#locust-åº“ç®€ä»‹" class="headerlink" title="locust åº“ç®€ä»‹"></a>locust åº“ç®€ä»‹</h1><h2 id="å®‰è£…ï¼š"><a href="#å®‰è£…ï¼š" class="headerlink" title="å®‰è£…ï¼š"></a>å®‰è£…ï¼š</h2><p>1ã€pythonç‰ˆæœ¬å¤§äº3.9 </p><p>2ã€å®‰è£…åŒ…ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">pip install locust</span><br></code></pre></td></tr></table></figure><p>3ã€éªŒè¯ç‰ˆæœ¬</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">locust -V</span><br>locust 2.27.0 from /usr/local/lib/python3.10/site-packages/locust (python 3.10.6)<br></code></pre></td></tr></table></figure><h2 id="ç¬¬ä¸€ä¸ªæµ‹è¯•"><a href="#ç¬¬ä¸€ä¸ªæµ‹è¯•" class="headerlink" title="ç¬¬ä¸€ä¸ªæµ‹è¯•"></a>ç¬¬ä¸€ä¸ªæµ‹è¯•</h2><p>Locust æµ‹è¯•æœ¬è´¨ä¸Šåªæ˜¯ä¸€ä¸ªå‘ä½ è¦æµ‹è¯•çš„ç³»ç»Ÿå‘å‡ºè¯·æ±‚çš„ Python ç¨‹åºã€‚</p><p>è¿™ä½¿å¾—å®ƒéå¸¸çµæ´»ï¼Œç‰¹åˆ«æ“…é•¿å®ç°å¤æ‚çš„ç”¨æˆ·æµç¨‹ã€‚ä½†å®ƒä¹Ÿå¯ä»¥åšç®€å•çš„æµ‹è¯•ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ä»è¿™é‡Œå¼€å§‹ï¼š</p>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®°ä¸€æ¬¡å› ä¸ºåœ¨é¡¹ç›®ä¸­ä½¿ç”¨ç›¸å¯¹è·¯å¾„å¼•å‘çš„è¡€æ¡ˆ</title>
    <link href="/2024/04/10/vscodeError/"/>
    <url>/2024/04/10/vscodeError/</url>
    
    <content type="html"><![CDATA[<h1 id="è®°ä¸€æ¬¡å› ä¸ºåœ¨é¡¹ç›®ä¸­ä½¿ç”¨ç›¸å¯¹è·¯å¾„å¼•å‘çš„è¡€æ¡ˆ"><a href="#è®°ä¸€æ¬¡å› ä¸ºåœ¨é¡¹ç›®ä¸­ä½¿ç”¨ç›¸å¯¹è·¯å¾„å¼•å‘çš„è¡€æ¡ˆ" class="headerlink" title="è®°ä¸€æ¬¡å› ä¸ºåœ¨é¡¹ç›®ä¸­ä½¿ç”¨ç›¸å¯¹è·¯å¾„å¼•å‘çš„è¡€æ¡ˆ"></a>è®°ä¸€æ¬¡å› ä¸ºåœ¨é¡¹ç›®ä¸­ä½¿ç”¨ç›¸å¯¹è·¯å¾„å¼•å‘çš„è¡€æ¡ˆ</h1><p>å› ä¸ºåœ¨é¡¹ç›®ä¸­éšæ‰‹å†™äº†ä¸€ä¸ªwith open ç›¸å¯¹è·¯å¾„ </p><p>åŸä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># with open(&quot;./test_fixed_new.yml&quot;, &#x27;r&#x27;) as data:</span><br><span class="hljs-comment">#     test_fixed_new = yaml.safe_load(data)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_study</span>():<br>    <span class="hljs-built_in">print</span>(test_fixed_new)<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨pycharm æ—¶æ²¡äº‹ï¼Œæµ‹è¯•ç”¨ä¾‹æ—è¾¹çš„ç®­å¤´ä¹Ÿå‡ºæ¥äº†ï¼Œè¿è¡Œä¹Ÿæ²¡æœ‰é—®é¢˜</p><p><img src="/../img/other/error11.png" alt="error11"></p><p>vs code æ²¡æœ‰ â€‹â€‹</p><p><img src="/../img/other/no1.png" alt="nill"></p><p>â€œæµ‹è¯•â€æ’ä»¶é‡Œé¢ä¹Ÿè¿˜æ˜¯å•¥éƒ½æ²¡â€‹â€‹â€‹</p><p><img src="/../img/other/error1.png" alt="error1"></p><p>ç„¶åæ¥ä¸‹æ¥å°±æ˜¯å„ç§æŠ¥é”™ â€‹â€‹</p><p><img src="/../img/other/error2.png" alt="error2"></p><p>æŠ¥é”™â€‹â€‹â€‹â€‹â€‹â€‹</p><p><img src="/../img/other/error3.png" alt="error3"></p><p>æŠ¥é”™ï¼</p><p><img src="/../img/other/error4.png" alt="error4"></p><p>è¿˜æ˜¯æŠ¥é”™</p><p><img src="/../img/other/error5.png" alt="error5"></p><p>å„ç§æŠ¥é”™</p><p><img src="/../img/other/error6.png" alt="error6"></p><p>ç½‘ä¸Šå„ç§æœç´¢æŸ¥æ‰¾ â€“ã€‹æ²¡ç”¨</p><p><img src="/../img/other/baidu.png" alt="baidu"></p><p>å®åœ¨æ²¡æ³•ï¼Œæ€ç»´å±€é™äº†ï¼Œâ€‹â€‹â€‹â€‹â€‹â€‹</p><hr><p>è¯·å¤§ä½¬å‡ºé©¬å¸®å¿™çœ‹ä¸€ä¸‹:</p><p>åˆ†ä¸¤æ­¥è§£å†³:</p><p>ç¬¬ä¸€æ­¥ï¼Œåœ¨<code>pytest.ini</code>é…ç½®æ–‡ä»¶é‡ŒåŠ <code>-s</code></p><p>pycharmä¸éœ€è¦æ‰‹åŠ¨åœ¨<code>pytest.ini</code>é‡ŒåŠ <code>-s</code>æ˜¯ä¸å½±å“è¿è¡Œçš„</p><p>vscode å¿…é¡»è¦åŠ </p><p><img src="/../img/other/s.png" alt="s"></p><p>å‡ºæ¥é¸Ÿ</p><p><img src="/../img/other/success1.png" alt="s"></p><p>è¿˜æ˜¯æœ‰ä¸¤ä¸ªæŠ¥é”™ï¼Œç»§ç»­è§£å†³</p><p>æ‰¾ä¸åˆ°æ–‡ä»¶ </p><p><img src="/../img/other/error8.png" alt="error8"></p><p>ç»§ç»­æ‰¾ä¸åˆ°æ–‡ä»¶</p><p><img src="/../img/other/error9.png" alt="error9"></p><p>è·¯å¾„æ”¹ä¸€ä¸‹ï¼Œä¸è¦ç”¨ç›¸å¯¹è·¯å¾„ â€“ã€‹å®Œäº‹å„¿ OKäº†</p><p><img src="/../img/other/success3.png" alt="success3"></p><p>ä¿®æ”¹åä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># åŸæ¥çš„</span><br><span class="hljs-comment"># with open(&quot;./test_fixed_new.yml&quot;, &#x27;r&#x27;) as data:</span><br><span class="hljs-comment">#     test_fixed_new = yaml.safe_load(data)</span><br><br><br><span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path<br><br><span class="hljs-comment"># ç°åœ¨çš„</span><br>current_dir = Path.cwd()  <span class="hljs-comment"># è·å–å½“å‰é¡¹ç›®çš„æ ¹ç›®å½•current working directoryå·¥ä½œç›®å½•</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;current_dir=<span class="hljs-subst">&#123;current_dir&#125;</span>&quot;</span>)<br>file_path = current_dir / <span class="hljs-string">&quot;cases&quot;</span> / <span class="hljs-string">&quot;fixed&quot;</span> / <span class="hljs-string">&quot;test_fixed_new.yml&quot;</span>  <span class="hljs-comment"># æ‹¼æ¥æ–‡ä»¶ç›®å½•</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">as</span> data:<br>    test_fixed_new = yaml.safe_load(data)<br>    <span class="hljs-built_in">print</span>(test_fixed_new)<br><br></code></pre></td></tr></table></figure><p>ç»“æŸâ€‹â€‹</p><p><img src="/../img/spacex-OHOU-5UVIYQ-unsplash.jpg" alt="NICE"></p>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç¬”è®°</tag>
      
      <tag>other</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€pythonã€‘è¿›é˜¶ä¹‹å¹¶å‘ç¼–ç¨‹ï¼ˆä¸ƒï¼‰</title>
    <link href="/2024/03/20/607python%E8%BF%9B%E9%98%B6%E4%B9%8B%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%83%EF%BC%89/"/>
    <url>/2024/03/20/607python%E8%BF%9B%E9%98%B6%E4%B9%8B%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%EF%BC%88%E4%B8%83%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="7-å¹¶å‘ç¼–ç¨‹"><a href="#7-å¹¶å‘ç¼–ç¨‹" class="headerlink" title="7 å¹¶å‘ç¼–ç¨‹"></a>7 å¹¶å‘ç¼–ç¨‹</h1><p>å¹¶å‘ç¼–ç¨‹çš„ç›®çš„ï¼šæé«˜ç¨‹åºå¤„ç†ä»»åŠ¡ï¼Œå¤„ç†è¯·æ±‚çš„é€Ÿåº¦&#x2F;èƒ½åŠ›ã€‚</p><p>å¹¶å‘ç¼–ç¨‹çš„æ–¹å¼ï¼š</p><ul><li>å¤šè¿›ç¨‹</li><li>å¤šçº¿ç¨‹</li><li>åç¨‹</li></ul><h2 id="7-1-å¼€å¯å¤šè¿›ç¨‹çš„ä¸¤ç§æ–¹å¼"><a href="#7-1-å¼€å¯å¤šè¿›ç¨‹çš„ä¸¤ç§æ–¹å¼" class="headerlink" title="7-1 å¼€å¯å¤šè¿›ç¨‹çš„ä¸¤ç§æ–¹å¼"></a>7-1 å¼€å¯å¤šè¿›ç¨‹çš„ä¸¤ç§æ–¹å¼</h2><ul><li><p>ç¨‹åºä»…ä»…åªæ˜¯ä¸€å †ä»£ç è€Œå·²ï¼Œè€Œè¿›ç¨‹æŒ‡çš„æ˜¯ç¨‹åºçš„è¿è¡Œè¿‡ç¨‹ã€‚</p></li><li><p>éœ€è¦å¼ºè°ƒçš„æ˜¯ï¼š<strong>åŒä¸€ä¸ªç¨‹åºæ‰§è¡Œä¸¤æ¬¡ï¼Œé‚£å°±æ˜¯ä¸¤ä¸ªè¿›ç¨‹</strong></p></li></ul><p>æ–¹å¼1ï¼šProcess</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Process<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">func</span>(<span class="hljs-params">name</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;name&#125;</span> is start&#x27;</span>)<br>    time.sleep(<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;name&#125;</span> is done&#x27;</span>)<br><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹, windowsä¸‹åªèƒ½ä½¿ç”¨è¿™ç§æ–¹å¼ï¼Œå¦åˆ™æŠ¥é”™</span><br>    p = Process(target=func, args=(<span class="hljs-string">&#x27;jack&#x27;</span>,))<br>    <span class="hljs-comment"># å¼€å¯å­è¿›ç¨‹</span><br>    p.start()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ä¸»è¿›ç¨‹ç»“æŸ&#x27;</span>)<br></code></pre></td></tr></table></figure><p>æ–¹å¼2ï¼šç»§æ‰¿Processï¼Œ é‡å†™æ–¹æ³•run</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Process<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">func</span>(<span class="hljs-params">name</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;name&#125;</span> is start&#x27;</span>)<br>    time.sleep(<span class="hljs-number">2</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;name&#125;</span> is done&#x27;</span>)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyProcess</span>(<span class="hljs-title class_ inherited__">Process</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name</span>):<br>        <span class="hljs-built_in">super</span>().__init__()<br>        self.name = name<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self</span>):  <span class="hljs-comment"># startä¼šè‡ªåŠ¨è°ƒç”¨run</span><br>        func(self.name)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    p = MyProcess(<span class="hljs-string">&quot;jack&quot;</span>)<br>    p.start()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ä¸»è¿›ç¨‹ç»“æŸ&#x27;</span>)<br></code></pre></td></tr></table></figure><h2 id="7-2-ä¸»è¿›ç¨‹ç­‰å¾…å­è¿›ç¨‹ç»“æŸ"><a href="#7-2-ä¸»è¿›ç¨‹ç­‰å¾…å­è¿›ç¨‹ç»“æŸ" class="headerlink" title="7-2 ä¸»è¿›ç¨‹ç­‰å¾…å­è¿›ç¨‹ç»“æŸ"></a>7-2 ä¸»è¿›ç¨‹ç­‰å¾…å­è¿›ç¨‹ç»“æŸ</h2><p>ç¤ºä¾‹1ï¼šä½¿ç”¨<code>join()</code>ä¼˜é›…çš„ç­‰å¾…å­è¿›ç¨‹ç»“æŸï¼Œä¸è¦ä½¿ç”¨<code>time.sleep</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Process<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">func</span>(<span class="hljs-params">name</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;name&#125;</span> is start&#x27;</span>)<br>    time.sleep(<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;name&#125;</span> is done&#x27;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    p = Process(target=func, args=[<span class="hljs-string">&#x27;jack&#x27;</span>])<br>    p.start()<br>    p.join(timeout=<span class="hljs-number">1</span>)        <span class="hljs-comment"># time.sleep(10)</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ä¸»è¿›ç¨‹ç»“æŸ&#x27;</span>)<br>    <br>    <br>    <span class="hljs-comment"># p.join(timeout=1)timeoutè®¾ç½®ç­‰å¾…æ—¶é—´</span><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹2ï¼šç­‰å¾…å¤šä¸ªå­è¿›ç¨‹ï¼Œä½¿ç”¨ä¸å½“é€ æˆä¸²è¡Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Process<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">func</span>(<span class="hljs-params">name</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;name&#125;</span> is start&#x27;</span>)<br>    time.sleep(<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;name&#125;</span> is done&#x27;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>        p = Process(target=func, args=[<span class="hljs-built_in">str</span>(i)])<br>        p.start()<br>        p.join()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ä¸»è¿›ç¨‹ç»“æŸ&#x27;</span>)<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹3ï¼šç¤ºä¾‹2ä¼˜åŒ–ç‰ˆ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    ps = []<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<br>        p = Process(target=func, args=[<span class="hljs-built_in">str</span>(i)])<br>        p.start()<br>        ps.append(p)<br>        <br>    <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> ps:<br>        p.join()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ä¸»è¿›ç¨‹ç»“æŸ&#x27;</span>)<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹4ï¼šç­‰å¾…æ€»è€—æ—¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Process<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">func</span>(<span class="hljs-params">i</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;i&#125;</span> is start&#x27;</span>)<br>    time.sleep(i)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;i&#125;</span> is done&#x27;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    ps = []<br>    start = time.time()<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">4</span>):<br>        p = Process(target=func, args=[i])<br>        p.start()<br>        ps.append(p)<br><br>    <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> ps:<br>        p.join()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ä¸»è¿›ç¨‹ç»“æŸ&#x27;</span>)<br>    <span class="hljs-built_in">print</span>(time.time() - start)<span class="hljs-comment"># ~3s</span><br></code></pre></td></tr></table></figure><h2 id="7-3-å®ˆæŠ¤è¿›ç¨‹"><a href="#7-3-å®ˆæŠ¤è¿›ç¨‹" class="headerlink" title="7-3 å®ˆæŠ¤è¿›ç¨‹"></a>7-3 å®ˆæŠ¤è¿›ç¨‹</h2><p><strong>ä¸»è¿›ç¨‹å°†ä¸€ä¸ªå­è¿›ç¨‹è®¾ç½®ä¸ºå®ˆæŠ¤è¿›ç¨‹ï¼Œå®ˆæŠ¤è¿›ç¨‹å°±ä¼šåœ¨ä¸»è¿›ç¨‹ç»“æŸæ—¶éšä¹‹ç»“æŸä¸å†è¿è¡Œ</strong>ã€‚</p><ul><li><strong>å®ˆæŠ¤è¿›ç¨‹å†…æ— æ³•å†å¼€å¯å­è¿›ç¨‹</strong>ï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸ï¼šAssertionError: daemonic processes are not allowed to have children</li><li><strong>åœ¨å¼€å¯å­è¿›ç¨‹ä¹‹å‰å°†å…¶è®¾ç½®ä¸ºå®ˆæŠ¤è¿›ç¨‹</strong></li><li><strong>ä¸»è¿›ç¨‹ä»£ç è¿è¡Œç»“æŸï¼Œå®ˆæŠ¤è¿›ç¨‹éšå³ç»ˆæ­¢</strong>ï¼Œä¸å—åˆ«çš„å­è¿›ç¨‹çš„å½±å“ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Process<br><span class="hljs-keyword">import</span> time<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">task</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;i am coming&#x27;</span>)<br>    time.sleep(<span class="hljs-number">2</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;i am backing&#x27;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    p = Process(target=task)<br>    p.daemon = <span class="hljs-literal">True</span><span class="hljs-comment"># p.start()ä¹‹å‰å°†å­è¿›ç¨‹è®¾ç½®ä¸ºå®ˆæŠ¤è¿›ç¨‹ï¼Œé™ªç€ä¸»è¿›ç¨‹ä¸€å—ç»“æŸã€‚</span><br>    p.start()<br>    time.sleep(<span class="hljs-number">0.1</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;i am master&#x27;</span>)<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹2ï¼šå„å­è¿›ç¨‹ç›¸äº’ç‹¬ç«‹ï¼Œä¸ä¼šå› ä¸ºä¸€ä¸ªå­è¿›ç¨‹è®¾ç½®ä¸ºå®ˆæŠ¤è¿›ç¨‹è€Œå½±å“å¦ä¸€ä¸ª</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Process<br><span class="hljs-keyword">import</span> time<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">task</span>(<span class="hljs-params">i</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;i&#125;</span> am coming&#x27;</span>)<br>    time.sleep(i)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;i&#125;</span> am backing&#x27;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">4</span>):<br>        p = Process(target=task, args=[i])<br>        <span class="hljs-keyword">if</span> i == <span class="hljs-number">3</span>:<span class="hljs-comment"># ç¼–å·ä¸º3çš„å­è¿›ç¨‹è®¾ç½®ä¸ºå®ˆæŠ¤è¿›ç¨‹ï¼Œå½“ä¸»è¿›ç¨‹æ‰§è¡Œç»“æŸåå°±è¢«å›æ”¶äº†</span><br>            p.daemon = <span class="hljs-literal">True</span><br>        p.start()<br><br>    time.sleep(<span class="hljs-number">2</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;master&#x27;</span>)<br></code></pre></td></tr></table></figure><h2 id="7-4-è¿›ç¨‹éš”ç¦»å†…å­˜ç©ºé—´"><a href="#7-4-è¿›ç¨‹éš”ç¦»å†…å­˜ç©ºé—´" class="headerlink" title="7-4 è¿›ç¨‹éš”ç¦»å†…å­˜ç©ºé—´"></a>7-4 è¿›ç¨‹éš”ç¦»å†…å­˜ç©ºé—´</h2><p><strong>è¿›ç¨‹ä¹‹é—´å†…å­˜ç©ºé—´æ˜¯éš”ç¦»çš„ï¼Œå³è¿›ç¨‹jé—´æ•°æ®æ˜¯éš”ç¦»çš„ï¼Œäº’ä¸å½±å“</strong>ã€‚</p><p>å› ä¸ºè¿™æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„åç§°ç©ºé—´ã€‚å­è¿›ç¨‹æœ‰å…¶è‡ªå·±çš„åç§°ç©ºé—´ï¼Œåªæ˜¯ä¿®æ”¹å…¶åç§°ç©ºé—´å†…å…¨å±€å˜é‡çš„å€¼ï¼Œè€Œä¸å½±å“çˆ¶è¿›ç¨‹è‡ªå·±åç§°ç©ºé—´å…¨å±€å˜é‡çš„å€¼ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Process<br><br>money = <span class="hljs-number">100</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">task</span>():<br>    <span class="hljs-keyword">global</span> money<br>    money = <span class="hljs-number">666</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;å­&#x27;</span>, money)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    p = Process(target=task)<br>    p.start()<br>    p.join()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ä¸»&#x27;</span>, money)<br></code></pre></td></tr></table></figure><h2 id="7-5-äº’æ–¥é”"><a href="#7-5-äº’æ–¥é”" class="headerlink" title="7-5 äº’æ–¥é”"></a>7-5 äº’æ–¥é”</h2><p>è¿›ç¨‹ä¹‹é—´æ•°æ®ä¸å…±äº«ï¼Œä½†æ˜¯å…±äº«åŒä¸€å¥—æ–‡ä»¶ç³»ç»Ÿï¼Œæ‰€ä»¥è®¿é—®åŒä¸€ä¸ªæ–‡ä»¶ï¼Œæˆ–åŒä¸€ä¸ªæ‰“å°ç»ˆç«¯ï¼Œæ˜¯æœ‰é—®é¢˜çš„ã€‚</p><p>ç¤ºä¾‹1ï¼šè¿›ç¨‹ä¸å…±äº«æ•°æ®å¯¼è‡´çš„æ•°æ®æ··ä¹±é—®é¢˜ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Process, Lock<br><span class="hljs-keyword">import</span> json, time, random<br><br><br><span class="hljs-comment"># æŸ¥ç¥¨</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">search</span>(<span class="hljs-params">i</span>):<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        dic = json.load(f)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ç”¨æˆ·%sæŸ¥è¯¢ä½™ç¥¨ï¼š%s&#x27;</span> % (i, dic.get(<span class="hljs-string">&#x27;ticket_num&#x27;</span>)))<br>    <span class="hljs-keyword">return</span> dic<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">buy</span>(<span class="hljs-params">i</span>):<br>    dic = search(i)<span class="hljs-comment"># å…ˆæŸ¥ç¥¨</span><br><span class="hljs-comment"># å†ä¹°ç¥¨</span><br>    time.sleep(random.randint(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>))<br>    <span class="hljs-keyword">if</span> dic.get(<span class="hljs-string">&#x27;ticket_num&#x27;</span>) &gt; <span class="hljs-number">0</span>:<br>        dic[<span class="hljs-string">&#x27;ticket_num&#x27;</span>] -= <span class="hljs-number">1</span><br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>            json.dump(dic, f)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ç”¨æˆ·%sä¹°ç¥¨æˆåŠŸ&#x27;</span> % i)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ç”¨æˆ·%sä¹°ç¥¨å¤±è´¥&#x27;</span> % i)<br><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">11</span>):<br>        p = Process(target=buy, args=[i])<br>        p.start()<br></code></pre></td></tr></table></figure><p>å…±äº«å¸¦æ¥çš„æ˜¯ç«äº‰ï¼Œç«äº‰å¸¦æ¥çš„ç»“æœå°±æ˜¯é”™ä¹±ã€‚æ§åˆ¶çš„æ–¹å¼å°±æ˜¯åŠ é”å¤„ç†ï¼Œå³æ¯ä¸ªè¿›ç¨‹ä¾æ¬¡ä½¿ç”¨èµ„æºã€‚</p><p>ç¤ºä¾‹2ï¼šäº’æ–¥é”ï¼Œä¿è¯æ•°æ®å®‰å…¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> multiprocessing <span class="hljs-keyword">import</span> Process, Lock<br><span class="hljs-keyword">import</span> json, time, random<br><br><br><span class="hljs-comment"># æŸ¥ç¥¨</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">search</span>(<span class="hljs-params">i</span>):<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        dic = json.load(f)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ç”¨æˆ·%sæŸ¥è¯¢ä½™ç¥¨ï¼š%s&#x27;</span> % (i, dic.get(<span class="hljs-string">&#x27;ticket_num&#x27;</span>)))<br><br><br><span class="hljs-comment"># ä¹°ç¥¨  1.å…ˆæŸ¥ 2.å†ä¹°</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">buy</span>(<span class="hljs-params">i, mutex</span>):<br>    search(i)<br>    mutex.acquire()  <span class="hljs-comment"># æŠ¢é”, ç»™ä¹°ç¥¨ç¯èŠ‚åŠ é”å¤„ç†</span><br>    time.sleep(random.randint(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>))<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-string">&#x27;r&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>        dic = json.load(f)<br>        ticket_num = dic[<span class="hljs-string">&quot;ticket_num&quot;</span>]<br>    <span class="hljs-keyword">if</span> ticket_num &gt; <span class="hljs-number">0</span>:<br>        dic[<span class="hljs-string">&#x27;ticket_num&#x27;</span>] -= <span class="hljs-number">1</span><br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf8&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>            json.dump(dic, f)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ç”¨æˆ·%sä¹°ç¥¨æˆåŠŸ&#x27;</span> % i)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ç”¨æˆ·%sä¹°ç¥¨å¤±è´¥&#x27;</span> % i)<br>    mutex.release()  <span class="hljs-comment"># é‡Šæ”¾é”</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    <span class="hljs-comment"># åœ¨ä¸»è¿›ç¨‹ä¸­ç”Ÿæˆä¸€æŠŠé” è®©æ‰€æœ‰çš„å­è¿›ç¨‹æŠ¢ è°å…ˆæŠ¢åˆ°è°å…ˆä¹°ç¥¨</span><br>    mutex = Lock()<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">11</span>):<br>        p = Process(target=buy, args=[i, mutex])<br>        p.start()<br></code></pre></td></tr></table></figure><p>åŠ é”å¤„ç†çš„ç»“æœå°±æ˜¯ï¼š<strong>å°†å¹¶å‘å˜æˆä¸²è¡Œï¼Œç‰ºç‰²æ•ˆç‡ï¼Œä¿è¯æ•°æ®çš„å®‰å…¨</strong></p><h2 id="7-6-å¤šçº¿ç¨‹"><a href="#7-6-å¤šçº¿ç¨‹" class="headerlink" title="7-6 å¤šçº¿ç¨‹"></a>7-6 å¤šçº¿ç¨‹</h2><p>åŸºç¡€çŸ¥è¯†ï¼š</p><ul><li>ä¸€ä¸ªç¨‹åºçš„è¿è¡Œè¿‡ç¨‹æ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œ<strong>æ¯ä¸ªè¿›ç¨‹è‡ªå¸¦ä¸€ä¸ªæ§åˆ¶çº¿ç¨‹</strong>ã€‚</li><li><strong>è¿›ç¨‹æ˜¯ä¸€ä¸ªèµ„æºå•ä½ï¼Œçº¿ç¨‹æ˜¯å…·ä½“çš„æ‰§è¡Œå•ä½</strong>ã€‚</li><li>è¿›ç¨‹ç›¸å½“äºä¸€ä¸ªè½¦é—´ï¼Œçº¿ç¨‹ç›¸å½“äºè½¦é—´å†…çš„æµæ°´çº¿ï¼Œè½¦é—´å†…å¯ä»¥æœ‰å¤šæ¡æµæ°´çº¿ï¼Œå³ä¸€ä¸ªè¿›ç¨‹å†…å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹ã€‚</li><li>å¤šçº¿ç¨‹ä¹‹é—´å…±äº«æ•°æ®èµ„æºï¼Œç›¸å½“äºä¸€ä¸ªè½¦é—´å†…æœ‰å¤šæ¡æµæ°´çº¿ï¼Œéƒ½å…±ç”¨ä¸€ä¸ªè½¦é—´çš„èµ„æºã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">è¿›ç¨‹: èµ„æºå•ä½(èµ·ä¸€ä¸ªè¿›ç¨‹æ˜¯åœ¨å†…å­˜ç©ºé—´ä¸­å¼€è¾Ÿä¸€å—ç‹¬ç«‹çš„ç©ºé—´)<br>çº¿ç¨‹: æ‰§è¡Œå•ä½(çœŸæ­£è¢«å¹²æ´»çš„æ˜¯è¿›ç¨‹é‡Œé¢çš„çº¿ç¨‹ï¼Œçº¿ç¨‹åœ¨æ‰§è¡Œä¸­æ‰€éœ€è¦ä½¿ç”¨åˆ°çš„èµ„æºéƒ½æ‰¾æ‰€åœ¨çš„è¿›ç¨‹ç´¢è¦)<br><br><span class="hljs-comment"># å¼€è¿›éœ€è¦å¼€å†…å­˜ç©ºé—´ï¼Œç¨‹èµ„æºæ¶ˆè€—å¤§</span><br><span class="hljs-comment"># å¼€çº¿ç¨‹æ— éœ€å†æ¬¡ç”³è¯·å†…å­˜ç©ºé—´æ“ä½œï¼Œæ¶ˆè€—å°</span><br><span class="hljs-comment"># å¼€çº¿ç¨‹çš„å¼€é”€è¦è¿œè¿œçš„å°äºè¿›ç¨‹çš„å¼€é”€ã€‚åŒä¸€ä¸ªè¿›ç¨‹ä¸‹çš„å¤šä¸ªçº¿ç¨‹æ•°æ®æ˜¯å…±äº«çš„</span><br></code></pre></td></tr></table></figure><p>ä¸ºä»€ä¹ˆä½¿ç”¨å¤šçº¿ç¨‹ï¼šå¦‚æœå¤šä¸ªä»»åŠ¡å…±ç”¨ä¸€å—åœ°å€ç©ºé—´ï¼Œé‚£ä¹ˆå¿…é¡»åœ¨ä¸€ä¸ªè¿›ç¨‹å†…å¼€å¯å¤šä¸ªçº¿ç¨‹ã€‚</p><p>ç¤ºä¾‹ï¼šå¼€çº¿ç¨‹çš„ä¸¤ç§æ–¹å¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> threading <span class="hljs-keyword">import</span> Thread<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">task</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;æˆ‘æ˜¯å­çº¿ç¨‹&#x27;</span>)<br><br><br><span class="hljs-comment"># æ–¹å¼1ï¼šç›´æ¥ä½¿ç”¨Threadå®ä¾‹åŒ–çº¿ç¨‹å¯¹è±¡</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    t = Thread(target=task)<br>    t.start()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;æˆ‘æ˜¯ä¸»çº¿ç¨‹&#x27;</span>)<br><br><br><span class="hljs-comment"># æ–¹å¼2ï¼šç»§æ‰¿Theradï¼Œè‡ªå®šè‡ªå·±çš„çº¿ç¨‹ç±»ï¼Œé‡å†™runæ–¹æ³•</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyThread</span>(<span class="hljs-title class_ inherited__">Thread</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">self</span>):<br>        task()<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    t = MyThread()<br>    t.start()<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;æˆ‘æ˜¯ä¸»çº¿ç¨‹&#x27;</span>)<br></code></pre></td></tr></table></figure><h2 id="7-7-çº¿ç¨‹å…±äº«å†…å­˜ç©ºé—´"><a href="#7-7-çº¿ç¨‹å…±äº«å†…å­˜ç©ºé—´" class="headerlink" title="7-7 çº¿ç¨‹å…±äº«å†…å­˜ç©ºé—´"></a>7-7 çº¿ç¨‹å…±äº«å†…å­˜ç©ºé—´</h2><blockquote><p>è¡¥å……ï¼šçº¿ç¨‹çš„çŸ¥è¯†ç‚¹å’Œè¿›ç¨‹çš„çŸ¥è¯†ç‚¹ç±»ä¼¼ï¼Œå¯ä»¥ä¸¾ä¸€åä¸‰çš„å­¦ä¹ ã€‚</p></blockquote><p><strong>åŒä¸€ä¸ªè¿›ç¨‹ä¸‹çš„å¤šä¸ªçº¿ç¨‹æ˜¯å…±äº«å½“å‰è¿›ç¨‹ä¸‹çš„æ•°æ®èµ„æºçš„</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> threading <span class="hljs-keyword">import</span> Thread<br><br>n = <span class="hljs-number">100</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">func</span>():<br>    <span class="hljs-keyword">global</span> n<br>    n = <span class="hljs-number">200</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;å­çº¿ç¨‹:&#x27;</span>, n)<span class="hljs-comment"># 110</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    t = Thread(target=func)<br>    t.start()<br>    <span class="hljs-comment"># t.join()</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ä¸»çº¿ç¨‹:&#x27;</span>, n)<br></code></pre></td></tr></table></figure><h2 id="7-8-GIL"><a href="#7-8-GIL" class="headerlink" title="7-8 GIL"></a>7-8 GIL</h2><p>å…¨å±€è§£é‡Šå™¨é”ï¼ˆGILï¼Œ Global Interpreter Lockï¼‰ã€‚</p><p>ç»“è®ºï¼š<strong>åœ¨Cpythonè§£é‡Šå™¨ä¸­ï¼ŒåŒä¸€ä¸ªè¿›ç¨‹ä¸‹å¼€å¯çš„å¤šçº¿ç¨‹ï¼ŒåŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œæ— æ³•åˆ©ç”¨å¤šæ ¸ä¼˜åŠ¿</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ç¨‹åºçš„ä»£ç éœ€è¦äº¤ç»™è§£é‡Šå™¨æ‰§è¡Œï¼Œå› æ­¤è¯¥è¿›ç¨‹å†…çš„æ¯ä¸ªçº¿ç¨‹éƒ½éœ€è¦å°†å…±äº«çš„ä»£ç äº¤ç»™è§£é‡Šå™¨æ‰§è¡Œï¼Œè¿™å°±æœ‰äº†ç«äº‰ã€‚</span><br><span class="hljs-comment"># åƒåœ¾å›æ”¶æœºåˆ¶GCä¹Ÿæ˜¯å½“å‰è¿›ç¨‹å†…çš„ä¸€ä¸ªå¹²æ´»çš„çº¿ç¨‹ï¼ŒGCä¼šå’Œå½“å‰è¿›ç¨‹å†…å…¶ä»–çº¿ç¨‹æœ‰æŠ¢ä»£ç æ•°æ®çš„ç«äº‰ï¼Œå› æ­¤æœ‰äº†GILã€‚</span><br><span class="hljs-comment"># GILä¿è¯è¿›ç¨‹å†…åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹åœ¨è¿è¡Œï¼Œè¿™æ ·åšæ˜¯ä¸ºäº†ä¿è¯å†…å­˜ç®¡ç†ï¼ˆåƒåœ¾å›æ”¶æœºåˆ¶GCï¼‰çš„è¿è¡Œã€‚</span><br></code></pre></td></tr></table></figure><p>æ€»ç»“ï¼š</p><ul><li><strong>GILä¸æ˜¯pythonè¯­è¨€çš„ç‰¹æ€§ï¼Œå®ƒæ˜¯Cpythonè§£é‡Šå™¨å¼•ç”¨çš„ä¸€ä¸ªæ¦‚å¿µã€‚</strong></li><li><strong>GILæœ¬è´¨æ˜¯ä¸€æŠŠäº’æ–¥é”ï¼Œæ˜¯å°†çº¿ç¨‹ä»å¹¶å‘å˜ä¸ºä¸²è¡Œï¼Œç‰ºç‰²æ•ˆç‡ä¿è¯æ•°æ®å®‰å…¨ã€‚</strong></li><li><strong>ä¿æŠ¤ä¸åŒçš„æ•°æ®è¦åŠ ä¸åŒçš„äº’æ–¥é”ï¼ŒGILä¿æŠ¤çš„æ˜¯è§£é‡Šå™¨çº§åˆ«çš„æ•°æ®å®‰å…¨ã€‚</strong></li></ul><p><img src="/img/python/image-20220514173429195.png" alt="image-20220514173429195"></p><p>é¦–å…ˆæ˜ç¡®ï¼š<strong>pythonå¤šçº¿ç¨‹æ— æ³•åˆ©ç”¨è®¡ç®—æœºçš„å¤šæ ¸ä¼˜åŠ¿</strong>ã€‚</p><p>ä½†æ˜¯pythonå¤šçº¿ç¨‹å¯ä»¥å®ç°å¹¶å‘çš„ï¼Œä¸”ä¸æ˜¯æ‰€æœ‰çš„åœºåˆéƒ½è¦ä½¿ç”¨å¤šæ ¸çš„ã€‚</p><p>åœºåˆï¼š</p><ul><li><strong>å¯¹äºè®¡ç®—å¯†é›†å‹ï¼Œå¤šè¿›ç¨‹ä¼˜äºå¤šçº¿ç¨‹</strong>ï¼ˆå¤šè¿›ç¨‹çš„å¹¶è¡Œè®¡ç®—ä¼˜åŠ¿çªå‡ºäº†ï¼‰</li><li><strong>å¯¹äºIOå¯†é›†å‹ï¼Œå¤šçº¿ç¨‹ä¼˜äºå¤šè¿›ç¨‹</strong>ï¼ˆå¼€è¿›ç¨‹çš„å¼€é”€å¤§ç¼ºé™·æ”¾å¤§äº†ï¼‰</li></ul><p>ç»“è®ºï¼š<strong>pythonå¤šçº¿ç¨‹æ— æ³•ä½¿ç”¨å¤šæ ¸ä¼˜åŠ¿ï¼Œä¸ç­‰äºå¤šçº¿ç¨‹ä¸€æ— æ˜¯å¤„</strong>ã€‚</p><h2 id="7-9-è¿›ç¨‹æ± å’Œçº¿ç¨‹æ± "><a href="#7-9-è¿›ç¨‹æ± å’Œçº¿ç¨‹æ± " class="headerlink" title="7-9 è¿›ç¨‹æ± å’Œçº¿ç¨‹æ± "></a>7-9 è¿›ç¨‹æ± å’Œçº¿ç¨‹æ± </h2><p>åŸºç¡€çŸ¥è¯†ï¼š</p><ul><li>æ— è®ºæ˜¯å¼€è¿›ç¨‹è¿˜æ˜¯å¼€çº¿ç¨‹ï¼Œéƒ½éœ€è¦æ¶ˆè€—èµ„æºï¼Œåªä¸è¿‡å¼€çº¿ç¨‹çš„æ¯”å¼€è¿›ç¨‹çš„æ¶ˆè€—æ›´å°‘ã€‚</li><li>ä¸å¯èƒ½æ— é™åˆ¶çš„å¼€è¿›ç¨‹æˆ–çº¿ç¨‹ï¼Œå› ä¸ºè®¡ç®—æœºç¡¬ä»¶çš„èµ„æºæ˜¯æœ‰é™çš„ã€‚</li><li>ä¸ºäº†ä¿è¯æœåŠ¡å™¨ä¸€å®šçš„å¤„ç†èƒ½åŠ›ï¼Œåªèƒ½é‡‡å–<code>æ± </code>çš„æ¦‚å¿µã€‚</li><li>æ± ï¼šå°±æ˜¯é™åˆ¶å¼€è¿›ç¨‹æˆ–å¼€çº¿ç¨‹çš„æ•°é‡ï¼Œæ¯”å¦‚å¼€å¤šçº¿ç¨‹ï¼Œé™åˆ¶æœ€å¤šå¼€10ä¸ªçº¿ç¨‹ï¼Œé‚£è¿™ä¸ªçº¿ç¨‹æ± çš„å¤§å°å°±æ˜¯10ï¼Œä¹Ÿå°±æ˜¯è¯´æœ€å¤šåªæœ‰10ä¸ªçº¿ç¨‹åœ¨å¹²æ´»ã€‚</li></ul><p>ç¤ºä¾‹1ï¼šçº¿ç¨‹æ± å’Œè¿›ç¨‹æ± çš„åŸºæœ¬ä½¿ç”¨ï¼ˆéƒ½æ˜¯ä½¿ç”¨concurrent.futuresæ¨¡å—ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> concurrent.futures <span class="hljs-keyword">import</span> ThreadPoolExecutor<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> random<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">task</span>(<span class="hljs-params">n</span>):  <span class="hljs-comment"># å¤„ç†ä»»åŠ¡çš„å‡½æ•°</span><br>    time.sleep(random.randint(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>))<br>    <span class="hljs-built_in">print</span>(n ** <span class="hljs-number">2</span>)<br><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    pool = ThreadPoolExecutor(<span class="hljs-number">5</span>)<span class="hljs-comment"># å¼€ä¸€ä¸ªå¤§å°æ˜¯5çš„çº¿ç¨‹æ± </span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>):<br>        pool.submit(task, i)<span class="hljs-comment"># æäº¤ä»»åŠ¡å’Œä»»åŠ¡éœ€è¦çš„å‚æ•°</span><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹2ï¼šå¢åŠ å›è°ƒå‡½æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> concurrent.futures <span class="hljs-keyword">import</span> ThreadPoolExecutor<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> random<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">task</span>(<span class="hljs-params">n</span>):  <span class="hljs-comment"># å¤„ç†ä»»åŠ¡çš„å‡½æ•°</span><br>    time.sleep(random.randint(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>))<br>    <span class="hljs-keyword">return</span> n ** <span class="hljs-number">2</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">call_back</span>(<span class="hljs-params">future</span>):<span class="hljs-comment"># éœ€è¦å®šä¹‰ä¸€ä¸ªå½¢å‚ï¼Œè¿™ä¸ªå½¢å‚æ˜¯futureï¼Œé€šè¿‡future.result()è·å–ä»»åŠ¡æ‰§è¡Œè¿”å›å€¼ã€‚</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;call_back&gt;&gt;&gt;:&#x27;</span>, future.result())<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    pool = ThreadPoolExecutor(<span class="hljs-number">5</span>)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>):<br>        pool.submit(task, i).add_done_callback(call_back)<br>        <span class="hljs-comment"># ç»™ä»»åŠ¡ç»‘å®šå›è°ƒå‡½æ•°ï¼Œä»»åŠ¡ç»“æŸåè‡ªåŠ¨è°ƒç”¨å›è°ƒå‡½æ•°ï¼Œå¹¶å°†futureå¯¹è±¡å½“å®å‚ä¼ ç»™å›è°ƒå‡½æ•°ã€‚</span><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹3ï¼šmapå‡½æ•°å¿«é€Ÿè·å–ç»“æœ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> concurrent.futures <span class="hljs-keyword">import</span> ThreadPoolExecutor<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> random<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">task</span>(<span class="hljs-params">n</span>):  <span class="hljs-comment"># å¤„ç†ä»»åŠ¡çš„å‡½æ•°</span><br>    time.sleep(random.randint(<span class="hljs-number">1</span>, <span class="hljs-number">5</span>))<br>    <span class="hljs-keyword">return</span> n ** <span class="hljs-number">2</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    pool = ThreadPoolExecutor(<span class="hljs-number">5</span>)<br>    rets = pool.<span class="hljs-built_in">map</span>(task, <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>))<br>    <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> rets:<br>        <span class="hljs-built_in">print</span>(r)<br><span class="hljs-comment"># mapç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä»»åŠ¡ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è¿­ä»£å™¨ï¼Œè¿­ä»£å™¨çš„æ¯ä¸ªå…ƒç´ ä¾æ¬¡ä¼ ç»™ä»»åŠ¡å½“å®å‚</span><br><span class="hljs-comment"># mapè¿”å›ä¸€ä¸ªç”Ÿæˆå™¨ï¼Œå¯ä»¥ç›´æ¥è·å–æ¯ä¸ªä»»åŠ¡çš„ç»“æœ</span><br></code></pre></td></tr></table></figure><p><strong>æ€»ç»“</strong>ï¼š</p><ul><li>æ± å­ä¸€æ—¦é€ å‡ºæ¥åï¼Œå›ºå®šäº†çº¿ç¨‹æˆ–è¿›ç¨‹ ï¼Œä¸ä¼šå†å˜æ›´ï¼Œæ‰€æœ‰çš„ä»»åŠ¡éƒ½æ˜¯è¿™äº›è¿›ç¨‹æˆ–çº¿ç¨‹å¤„ç†ã€‚</li><li><strong>è¿™äº›è¿›ç¨‹æˆ–çº¿ç¨‹ä¸ä¼šå†å‡ºç°é‡å¤åˆ›å»ºå’Œé”€æ¯çš„è¿‡ç¨‹ã€‚</strong></li><li><strong>ä»»åŠ¡çš„æäº¤æ˜¯å¼‚æ­¥çš„ï¼Œå¼‚æ­¥æäº¤ä»»åŠ¡çš„è¿”å›ç»“æœ åº”è¯¥é€šè¿‡å›è°ƒæœºåˆ¶æ¥è·å–ã€‚</strong></li><li><strong>å›è°ƒæœºåˆ¶å°±ç›¸å½“äºï¼ŒæŠŠä»»åŠ¡äº¤ç»™ä¸€ä¸ªå‘˜å·¥å®Œæˆï¼Œå®ƒå®Œæˆåä¸»åŠ¨æ‰¾ä½ æ±‡æŠ¥å®Œæˆç»“æœã€‚</strong></li></ul><h2 id="7-10-åç¨‹ã€ä¼ªã€‘"><a href="#7-10-åç¨‹ã€ä¼ªã€‘" class="headerlink" title="7-10 åç¨‹ã€ä¼ªã€‘"></a>7-10 åç¨‹ã€ä¼ªã€‘</h2><p>åç¨‹æ˜¯å•çº¿ç¨‹ä¸‹çš„å¹¶å‘ï¼Œ<strong>åç¨‹æ˜¯ä¸€ç§ç”¨æˆ·æ€çš„è½»é‡çº§çº¿ç¨‹ï¼Œå³åç¨‹æ˜¯ç”±ç”¨æˆ·ç¨‹åºè‡ªå·±æ§åˆ¶è°ƒåº¦çš„ã€‚</strong></p><p>åç¨‹çš„åˆ‡æ¢å¼€é”€æ›´å°ï¼Œå±äºç¨‹åºçº§åˆ«çš„åˆ‡æ¢ï¼Œæ“ä½œç³»ç»Ÿå®Œå…¨æ„ŸçŸ¥ä¸åˆ°ï¼Œå› è€Œæ›´åŠ è½»é‡çº§ï¼›<strong>å•çº¿ç¨‹å†…å°±å¯ä»¥å®ç°å¹¶å‘çš„æ•ˆæœï¼Œæœ€å¤§é™åº¦åœ°åˆ©ç”¨cpu</strong></p><p>ç¤ºä¾‹1ï¼šåŸºäºyieldå®ç°ä»£ç å—åˆ‡æ¢</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">f1</span>():<br>    <span class="hljs-keyword">yield</span> <span class="hljs-number">1</span><br>    <span class="hljs-keyword">yield</span> <span class="hljs-keyword">from</span> f2()<br>    <span class="hljs-keyword">yield</span> <span class="hljs-number">2</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">f2</span>():<br>    <span class="hljs-keyword">yield</span> <span class="hljs-number">3</span><br>    <span class="hljs-keyword">yield</span> <span class="hljs-number">4</span><br><br><br>generator = f1()<span class="hljs-comment"># f1()æ˜¯ç”Ÿæˆå™¨</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> generator:<br>    <span class="hljs-built_in">print</span>(i)<span class="hljs-comment"># ä¾æ¬¡æ‰“å°ï¼š1 3 4 2</span><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹2ï¼šä½¿ç”¨asyncioå®ç°åç¨‹ã€å®˜æ–¹æ¨èã€‘</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">f1</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">2</span>)<span class="hljs-comment"># ç­‰ å¯ä»¥ç­‰å¾…çš„å¯¹è±¡</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-number">2</span>)<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">f2</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-number">3</span>)<br>    <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">2</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-number">4</span>)<br><br><br>tasks = [<br>    asyncio.ensure_future(f1()),<br>    asyncio.ensure_future(f2())<br>]<br><br>loop = asyncio.get_event_loop()<br>loop.run_until_complete(asyncio.wait(tasks))<br></code></pre></td></tr></table></figure><p>ä¸¥æ ¼æ¥è¯´ï¼Œå…¶å®Pythonå¹¶æ²¡æœ‰åç¨‹ï¼Œæ˜¯ä¸€ç§ä¼ªåç¨‹ï¼Œå› ä¸ºpythonçš„åç¨‹åªæ˜¯ä¸€ç§å¼‚æ­¥ç¼–ç æ€æƒ³ï¼Œè€Œæ²¡æœ‰ä¸€ä¸ªå®Œæ•´ç”Ÿå‘½å‘¨æœŸ</p>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€pythonã€‘è¿›é˜¶ä¹‹å…ƒç±»ï¼ˆå…­ï¼‰</title>
    <link href="/2024/03/20/606python%E8%BF%9B%E9%98%B6%E4%B9%8B%E5%85%83%E7%B1%BB%EF%BC%88%E5%85%AD%EF%BC%89/"/>
    <url>/2024/03/20/606python%E8%BF%9B%E9%98%B6%E4%B9%8B%E5%85%83%E7%B1%BB%EF%BC%88%E5%85%AD%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="å…ƒç±»ã€æ·±å…¥ç†è§£Pythonã€‘"><a href="#å…ƒç±»ã€æ·±å…¥ç†è§£Pythonã€‘" class="headerlink" title="å…ƒç±»ã€æ·±å…¥ç†è§£Pythonã€‘"></a>å…ƒç±»ã€æ·±å…¥ç†è§£Pythonã€‘</h1><h2 id="6-1-ç±»ä¹Ÿæ˜¯å¯¹è±¡"><a href="#6-1-ç±»ä¹Ÿæ˜¯å¯¹è±¡" class="headerlink" title="6.1 ç±»ä¹Ÿæ˜¯å¯¹è±¡"></a>6.1 ç±»ä¹Ÿæ˜¯å¯¹è±¡</h2><ul><li>å…ƒç±»æ˜¯ä»€ä¹ˆï¼Ÿè¦å…ˆäº†è§£ç±»æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>Pythonæ˜¯ä¸€åˆ‡çš†å¯¹è±¡ï¼Œå“ªæ€•ä½ å®šä¹‰ä¸€ä¸ªå˜é‡ï¼Œå®ƒä¹Ÿæ˜¯å¯¹è±¡ï¼Œé‚£ç±»æ˜¯ä»€ä¹ˆï¼Ÿ ç±»å¯ä»¥æƒ³è±¡æˆæ˜¯å¯¹è±¡çš„æ¨¡ç‰ˆï¼Œæ˜¯ç±»å®šä¹‰äº†å¯¹è±¡ï¼Œå¯¹è±¡æ˜¯ç±»å®ä¾‹åŒ–çš„äº§ç‰©ï¼Œ</li><li>é‚£ç±»æ˜¯å¯¹è±¡çš„æ¨¡æ¿ï¼Œä»€ä¹ˆæ˜¯ç±»çš„ç±»ï¼ˆæ¨¡ç‰ˆï¼‰å‘¢ï¼Ÿ</li><li>å…ƒç±»å°±æ˜¯ç±»çš„ç±»ï¼ˆæ¨¡ç‰ˆï¼‰é»˜è®¤å…ƒç±»type</li><li>ä½ å¯ä»¥è‡ªå®šä¹‰è¿™ä¸ªå…ƒç±»æ¥å®ç°æœ‰åŒºåˆ«äºç±»çš„ç±»</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age</span>):<br>        self.name = name<br>        self.age = age<br><br><br>stu = Student(<span class="hljs-string">&quot;jack&quot;</span>, <span class="hljs-number">18</span>)<span class="hljs-comment"># Studentå®ä¾‹åŒ–å¾—åˆ°å¯¹è±¡ stu</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(stu))    <span class="hljs-comment"># type()å‡½æ•°å¯ä»¥å¾—åˆ° stuè¿™ä¸ªå¯¹è±¡çš„ç±»æ˜¯Student </span><br><span class="hljs-built_in">print</span>(stu.__class__)<span class="hljs-comment"># ç±»ä¼¼çš„æ–¹å¼ å¾—åˆ° stuè¿™ä¸ªå¯¹è±¡çš„ç±»æ˜¯Student </span><br><br><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(Student))<span class="hljs-comment"># ç±»ä¼¼çš„ é€šè¿‡type()çš„æ–¹å¼å¾—åˆ°Studentçš„ç±»å‹æ˜¯ type</span><br><span class="hljs-built_in">print</span>(Student.__class__)<span class="hljs-comment"># ç±»ä¼¼çš„é€šè¿‡ __class__ å¾—åˆ°Studentçš„ç±»æ˜¯ type</span><br><br><br><span class="hljs-comment"># äºæ˜¯å¾—åˆ°ç»“è®º ç±»ä¹Ÿæ˜¯å¯¹è±¡ï¼Œç±»çš„ç±»æ˜¯type, å³typeå®ä¾‹åŒ–å¾—åˆ°çš„å¯¹è±¡æ˜¯ç±»</span><br></code></pre></td></tr></table></figure><h2 id="6-2-classæœºåˆ¶"><a href="#6-2-classæœºåˆ¶" class="headerlink" title="6.2 classæœºåˆ¶"></a>6.2 classæœºåˆ¶</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age</span>):<br>        self.name = name<br>        self.age = age<br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">talk</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;hello&#x27;</span>)<br>        <br><span class="hljs-comment"># ç±»çš„ä¸‰å¤§ç‰¹å¾ï¼š</span><br>- ç±»åï¼šStudent<br>- åŸºç±»ä»¬ï¼š<span class="hljs-built_in">object</span>,<br>- åç§°ç©ºé—´ï¼šå°±æ˜¯ç±»ä¸‹é¢å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ï¼Œæ„æˆçš„ä¸€ä¸ªå­—å…¸ keyæ˜¯å±æ€§/æ–¹æ³•åå­—ç¬¦ä¸²ï¼Œvalueæ˜¯å±æ€§/æ–¹æ³•æœ¬èº«<br></code></pre></td></tr></table></figure><p>classæ˜¯pythonçš„ä¸€ä¸ªå…³é”®å­—ï¼Œç›®çš„æ˜¯ç”¨æ¥åˆ›å»ºç±»ï¼Œé‚£è¿™ä¸ªå…³é”®å­—çš„èƒŒåæ˜¯ä»€ä¹ˆé€»è¾‘å‘¢ï¼Ÿ</p><ul><li>ç¬¬ä¸€æ­¥ï¼š<strong>è·å–ç±»å</strong> class_name &#x3D; Student</li><li>ç¬¬äºŒæ­¥ï¼š <strong>è·å–åŸºç±»ä»¬ï¼š</strong> class_bases&#x3D;(object,)</li><li>ç¬¬ä¸‰æ­¥ï¼š<strong>è·å–ç±»çš„åç§°ç©ºé—´ï¼š</strong> class_dict &#x3D; {â€œâ€“initâ€“â€ ï¼šâ€“initâ€“,â€â€“talkâ€“â€:talk}</li><li>ç¬¬å››æ­¥ï¼š<strong>è°ƒç”¨å…ƒç±»typeå®ä¾‹åŒ–äº§ç”ŸStudentç±»è¿™ä¸ªå¯¹è±¡</strong></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age</span>):<br>    self.name = name<br>    self.age = age<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">talk</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;hello&#x27;</span>)<br><br><br>class_name = <span class="hljs-string">&quot;Student&quot;</span><br>class_bases = (<span class="hljs-built_in">object</span>, )<br>class_dict = &#123;<span class="hljs-string">&quot;__init__&quot;</span>: __init__, <span class="hljs-string">&quot;talk&quot;</span>: talk&#125;  <span class="hljs-comment">#  å­—å…¸</span><br><br><br>Student = <span class="hljs-built_in">type</span>(class_name, class_bases, class_dict)  <span class="hljs-comment"># è‡ªå®šä¹‰äº†å…ƒç±»ä¿¡æ¯ï¼ŒStudentæ˜¯å®ä¾‹åŒ–å¯¹è±¡</span><br><br>stu = Student(<span class="hljs-string">&quot;jack&quot;</span>, <span class="hljs-number">18</span>)<br><span class="hljs-built_in">print</span>(stu.talk())<br></code></pre></td></tr></table></figure><ul><li>ä½†æ˜¯å¦‚æœæŒ‰ç…§è¿™å››æ­¥èµ°å°±æ¯”è¾ƒç¹çï¼Œæ‰€ä»¥æ­£å¸¸æ˜¯ç”¨pythonçš„å…³é”®å­—class æ¥å®šä¹‰ç±»çš„</li></ul><h2 id="6-3-è‡ªå®šä¹‰å…ƒç±»"><a href="#6-3-è‡ªå®šä¹‰å…ƒç±»" class="headerlink" title="6.3 è‡ªå®šä¹‰å…ƒç±»"></a>6.3 è‡ªå®šä¹‰å…ƒç±»</h2><p>ä¸Šé¢æˆ‘ä»¬çŸ¥é“äº†classçš„åŸç†ï¼Œé‚£æˆ‘ä»¬è‡ªå®šä¹‰å…ƒç±»ï¼Œå°±æ˜¯åœ¨åšç¬¬å››æ­¥çš„è‡ªå®šä¹‰ï¼Œå³ä½¿ç”¨ä¸åŒçš„å…ƒç±»å®ä¾‹åŒ–è¿™ä¸ªå¯¹è±¡ï¼Œç›®çš„æ˜¯ä¸ºäº†æŒ‰ç…§éœ€æ±‚æ§åˆ¶ç±»çš„å®šä¹‰å’Œè°ƒç”¨</p><p>metaclass&#x3D;typeå°±æ˜¯è®©ä»–æŒ‡å‘typeå…ƒç±»ï¼Œè¿™æ˜¯æ‰€æœ‰ç±»çš„åŸºçŸ³</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>(metaclass=<span class="hljs-built_in">type</span>):<span class="hljs-comment"># classæœºåˆ¶é»˜è®¤çš„å…ƒç±»æ˜¯typeï¼šæˆ‘ä»¬å¯ä»¥ä¿®æ”¹metaclasså‚æ•°æ¥é€‰æ‹©è‡ªå®šä¹‰å…ƒç±»</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age</span>):<br>        self.name = name<br>        self.age = age<br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">talk</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;hello&#x27;</span>)<br></code></pre></td></tr></table></figure><ul><li>typeæ˜¯ä¸€åˆ‡ç±»çš„åŸºçŸ³ï¼Œæ‰€ä»¥æˆ‘ä»¬è‡ªå®šä¹‰çš„å…ƒç±»ï¼Œä¹Ÿå¿…é¡»ç»§æ‰¿è‡ª<code>type</code></li><li>è‡ªå®šä¹‰çš„å…ƒç±»ç»§æ‰¿typeçš„ç›®çš„æ˜¯ä½¿ç”¨typeçš„å¤§éƒ¨åˆ†åŠŸèƒ½ï¼Œæˆ‘ä»¬åªå®šåˆ¶ï¼ˆé‡å†™æ–¹æ³•ï¼‰æˆ‘ä»¬éœ€è¦çš„é‚£ä¸€éƒ¨åˆ†åŠŸèƒ½</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Mymeta</span>(<span class="hljs-title class_ inherited__">type</span>):<span class="hljs-comment"># åªæœ‰ç»§æ‰¿äº†typeçš„ç±»æ‰èƒ½ä½œä¸ºå…ƒç±»ä½¿ç”¨</span><br>    <span class="hljs-comment"># åœ¨è¿™ä¸ªé‡Œé¢å»é‡å†™typeçš„æ–¹æ³•å»è‡ªå®šä¹‰è‡ªå·±çš„å…ƒç±»</span><br>    <span class="hljs-keyword">pass</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>(metaclass=Mymeta):<span class="hljs-comment"># ä½¿ç”¨Mytemaå…ƒç±»ï¼Œå³Mymeta(class_name, class_bases, class_dict)</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age</span>):<br>        self.name = name<br>        self.age = age<br>        <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">talk</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;hello&#x27;</span>)<br></code></pre></td></tr></table></figure><h2 id="6-4-è‡ªå®šä¹‰å…ƒç±»æ§åˆ¶ç±»çš„å®šä¹‰"><a href="#6-4-è‡ªå®šä¹‰å…ƒç±»æ§åˆ¶ç±»çš„å®šä¹‰" class="headerlink" title="6.4 è‡ªå®šä¹‰å…ƒç±»æ§åˆ¶ç±»çš„å®šä¹‰"></a>6.4 è‡ªå®šä¹‰å…ƒç±»æ§åˆ¶ç±»çš„å®šä¹‰</h2><p>è‡ªå®šä¹‰å…ƒç±»å®šåˆ¶ç±»çš„æ—¶å€™ï¼Œéœ€è¦å†è‡ªå®šä¹‰çš„å…ƒç±»ä¸­å®ç°init()æ–¹æ³•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Mymeta</span>(<span class="hljs-title class_ inherited__">type</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, class_name, class_bases, class_dict</span>):<br><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> class_name.istitle():<span class="hljs-comment"># è‡ªå®šåˆ¶éœ€æ±‚ istitle()ç”¨äºæ£€æŸ¥å­—ç¬¦ä¸²çš„é¦–å­—æ¯æ˜¯å¦å¤§å†™ï¼Œå¦‚æœå¤§å†™å°±æ˜¯Tureï¼Œå¦åˆ™Flase</span><br>            <span class="hljs-keyword">raise</span> NameError(<span class="hljs-string">&#x27;ç±»åé¦–å­—æ¯å¿…é¡»å¤§å†™&#x27;</span>)<br> <br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> self.__doc__:  <span class="hljs-comment"># # å¦‚æœç±»çš„__doc__å±æ€§æ˜¯ç©ºï¼Œå°±æŠ›å‡ºå¼‚å¸¸ docå°±æ˜¯æ³¨é‡Šé‚£é‡Œ</span><br>            <span class="hljs-keyword">raise</span> TypeError(<span class="hljs-string">&#x27;ç±»å¿…é¡»è¦æœ‰æ–‡æ¡£æ³¨é‡Š&#x27;</span>)<br><br>        <span class="hljs-built_in">super</span>().__init__(class_name, class_bases, class_dict)<br><br><br><span class="hljs-comment"># People = Mymeta(class_name, class_bases, class_dict),</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">People</span>(<span class="hljs-built_in">object</span>, metaclass=Mymeta):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    deox</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    x = <span class="hljs-number">10</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">f</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">pass</span><br><br><br><br><span class="hljs-built_in">print</span>(People.__dict__)<br></code></pre></td></tr></table></figure><h2 id="6-5å®ä¾‹åŒ–å¯¹è±¡çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#6-5å®ä¾‹åŒ–å¯¹è±¡çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="6.5å®ä¾‹åŒ–å¯¹è±¡çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ"></a>6.5å®ä¾‹åŒ–å¯¹è±¡çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>å›é¡¾ä¸€ä¸‹ï¼Œå®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ </p><ul><li><strong>ç¬¬ä¸€ä»¶äº‹ï¼šåˆ›å»ºäº†ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œâ€“newâ€“æ–¹æ³•</strong></li><li><strong>ç¬¬äºŒä»¶äº‹ï¼šåˆå§‹åŒ–äº†è¿™ä¸ªç©ºå¯¹è±¡  â€“initâ€“</strong></li><li><strong>æœ€åï¼šè¿”å›åˆå§‹åŒ–å®Œæˆçš„å¯¹è±¡</strong><ul><li>newï¼ˆï¼‰åˆ›å»ºç©ºå¯¹è±¡ï¼Œä¸”è¿”å›è¿™ä¸ªç©ºå¯¹è±¡</li><li>init() æ¥æ”¶äº†è¿™ä¸ªç©ºå¯¹è±¡ï¼Œå¹¶å®Œæˆäº†åˆå§‹åŒ–è¯¥å¯¹è±¡</li><li>æœ€åï¼Œè¿”å›åˆå§‹åŒ–å®Œæˆçš„å¯¹è±¡ã€‚</li></ul></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age</span>):<br>    self.name = name <br>stu = Student(<span class="hljs-string">&#x27;jack&#x27;</span>, <span class="hljs-number">18</span>)<br><br></code></pre></td></tr></table></figure><p>æ•´ä¸ªä¸‰æ­¥æµç¨‹ï¼Œæ˜¯ç”±ç±»çš„ç±»ï¼Œå³å…ƒç±»ä¸­çš„â€“callâ€“()æ–¹æ³•ç®¡ç†çš„ï¼ˆå®šä¹‰.ç±»() ï¼‰ï¼Œå› ä¸ºå®ä¾‹åŒ–å¯¹è±¡ï¼Œç±»åŠ æ‹¬å·ï¼Œå³ç±»çš„è°ƒç”¨ã€‚ç±»è¢«å½“ä¸€ä¸ªå¯¹è±¡çœ‹å¾…æ—¶ï¼Œç›´æ¥ä»¥ç±»æ–¹æ³•è°ƒç”¨ï¼Œå°±ä¼šè§¦å‘å®ƒçš„â€“callâ€“()å‡½æ•°çš„æ‰§è¡Œï¼Œå³å®ä¾‹åŒ–å¯¹è±¡æ—¶ï¼Œå‡ºå‘äº†å…ƒç±»çš„â€“callâ€“()å‡½æ•°</p><p>åœ¨å…ƒç±»â€“callâ€“()å†…å®ç°å®ä¾‹åŒ–çš„ä¸‰ä»¶äº‹ã€‚</p><p>å½“æˆ‘ä»¬é»˜è®¤ä½¿ç”¨çš„æ˜¯typeå…ƒç±»æ—¶ï¼Œæƒ³è¦<strong>å®šåˆ¶å®ä¾‹åŒ–çš„è¿™ä¸ªè¿‡ç¨‹ä¸­</strong>çš„éœ€æ±‚æ˜¯æ— æ³•å®ç°çš„ï¼Œå› ä¸ºæˆ‘ä»¬æ— æ³•ä¿®æ”¹å†…ç½®å…ƒç±»typeçš„â€“callâ€“æ–¹æ³•ã€‚</p><p>å½“æˆ‘ä»¬ä½¿ç”¨è‡ªå®šä¹‰å…ƒç±»çš„æ—¶å€™ï¼Œå°±å¯ä»¥å®ç°<strong>å®ä¾‹åŒ–è¿‡ç¨‹éœ€æ±‚çš„è‡ªå®šä¹‰</strong>ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥é‡å†™è‡ªå®šä¹‰å…ƒç±»çš„â€“callâ€“æ–¹æ³•ï¼Œä»è€Œå®ç°è‡ªå®šä¹‰å®ä¾‹åŒ–éœ€æ±‚</p><h2 id="6-6-è‡ªå®šä¹‰å…ƒç±»æ§åˆ¶ç±»çš„è°ƒç”¨"><a href="#6-6-è‡ªå®šä¹‰å…ƒç±»æ§åˆ¶ç±»çš„è°ƒç”¨" class="headerlink" title="6.6 è‡ªå®šä¹‰å…ƒç±»æ§åˆ¶ç±»çš„è°ƒç”¨"></a>6.6 è‡ªå®šä¹‰å…ƒç±»æ§åˆ¶ç±»çš„è°ƒç”¨</h2><p>ç±»çš„è°ƒç”¨ï¼š å°±æ˜¯ç±»åŠ æ‹¬å·ï¼Œä¹Ÿå°±æ˜¯å®ä¾‹åŒ–å¯¹è±¡</p><p><strong>ä½ å®ä¾‹åŒ–ä¸€ä¸ªç±»çš„å¯¹è±¡æ—¶ï¼Œå®é™…ä¸Šä¼šè°ƒç”¨ç±»çš„ <code>__call__</code> æ–¹æ³•ï¼ˆå¦‚æœå®šä¹‰äº†çš„è¯ï¼‰ã€‚è¿™ç§è¡Œä¸ºä½¿å¾—ç±»çš„å®ä¾‹å¯ä»¥åƒå‡½æ•°ä¸€æ ·è¢«è°ƒç”¨ã€‚</strong></p><p>æ§åˆ¶ç±»çš„è°ƒç”¨å°±æ˜¯æ§åˆ¶å¯¹è±¡çš„é¢å®ä¾‹åŒ–è¿‡ç¨‹ã€‚ç±»çš„è°ƒç”¨å°±ä¼šè§¦å‘å…ƒç±»çš„<code>__call__</code> æ–¹æ³•æ‰§è¡Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Mymeta</span>(<span class="hljs-title class_ inherited__">type</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__call__</span>(<span class="hljs-params">cls, *args, **kwargs</span>):<br>        <span class="hljs-comment"># ç¬¬ä¸€æ­¥: è°ƒç”¨Studentä¸‹é¢çš„__new__åˆ›å»ºä¸€ä¸ªç©ºå¯¹è±¡, æ— åˆ™ä½¿ç”¨ç±»(type)çš„__new__</span><br>        obj = cls.__new__(cls, *args, **kwargs)<br>        <span class="hljs-comment"># ç¬¬äºŒæ­¥ï¼šè°ƒç”¨Studentä¸‹é¢çš„__init__åˆå§‹åŒ–å¯¹è±¡</span><br>        cls.__init__(obj, *args, **kwargs)        <span class="hljs-comment"># ç­‰ä»·äºï¼š obj.__init__(*args, **kwargs)</span><br>        <span class="hljs-comment"># ç¬¬ä¸‰æ­¥ï¼šè¿”å›å¯¹è±¡</span><br>        <span class="hljs-keyword">return</span> obj<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>(<span class="hljs-built_in">object</span>, metaclass=Mymeta):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age</span>):<br>        self.name = name<br>        self.age = age<br><br><br>jack = Student(<span class="hljs-string">&#x27;jack&#x27;</span>, <span class="hljs-number">18</span>)   <span class="hljs-comment"># People.__call__(&#x27;jack&#x27;, 18)</span><br></code></pre></td></tr></table></figure><h2 id="6-7-é€šè¿‡newå®ç°å•ä¾‹æ¨¡å¼"><a href="#6-7-é€šè¿‡newå®ç°å•ä¾‹æ¨¡å¼" class="headerlink" title="6.7 é€šè¿‡newå®ç°å•ä¾‹æ¨¡å¼"></a>6.7 é€šè¿‡newå®ç°å•ä¾‹æ¨¡å¼</h2><p>å›é¡¾ä¸€ä¸‹å•ä¾‹æ¨¡å¼ï¼š</p><ul><li>ä¸€ä¸ªç±»åªå®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡çš„ä¸€ç§ç¼–ç¨‹æ€ç»´ï¼Œå°±æ˜¯å•ä¾‹æ¨¡å¼</li><li>æ€ä¹ˆå®ç°ï¼š é€šè¿‡è‡ªå®šä¹‰â€“newâ€“()é­”æ³•æ–¹æ³•å®ç°ï¼Œåˆ¤æ–­ç±»çš„å®ä¾‹åŒ–å¯¹è±¡æ˜¯å¦å·²ç»æœ‰äº†ï¼Œæœ‰äº†å°±ç›´æ¥è¿”å›è¿™ä¸ªå®ä¾‹åŒ–å¯¹è±¡ï¼Œæ²¡æœ‰å°±å¯ä»¥newä¸€ä¸ªå®ä¾‹åŒ–å¹¶ä¿å­˜è¿”å›ã€‚çœ‹çœ‹å¯¹è±¡</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>():<br>    _instance = <span class="hljs-literal">None</span> <span class="hljs-comment"># é»˜è®¤ç±»çš„å±æ€§_instanceæ˜¯ç©º</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__new__</span>(<span class="hljs-params">cls,*args, **kwargs</span>):<br>        self.name = name<br>        self.age = age<br>        <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__new__</span>(<span class="hljs-params">cls,*args, **kwargs</span>):  <br>        <span class="hljs-keyword">if</span> cls._instance:  <span class="hljs-comment"># åˆ¤æ–­ï¼Œå¦‚æœcls._instance is Tureå°±æ˜¯æŒ‡åˆ¤æ–­ä»–æ˜¯å¦æœ‰å®ä¾‹</span><br>            <span class="hljs-keyword">return</span> cls._instance <span class="hljs-comment"># å¦‚æœæœ‰å°±ç›´æ¥è¿”å›è¿™ä¸ªå®ä¾‹</span><br>        <span class="hljs-keyword">else</span>:<br>            cls._instance = <span class="hljs-built_in">super</span>().__new__(cls)    <span class="hljs-comment"># å¦‚æœæ²¡æœ‰ï¼Œå°±æ–°å»ºä¸€ä¸ªå®ä¾‹åŒ–å¯¹è±¡</span><br>            <span class="hljs-keyword">return</span> cls._instance   <span class="hljs-comment"># å¹¶ä¸”è¿”å›</span><br>        <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__new__</span>(<span class="hljs-params">cls, *agrs, **kwagrs</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> cls._instance:<br>            cls._instances = <span class="hljs-built_in">super</span>().__new__(cls)  <span class="hljs-comment"># å¦‚æœæ²¡æœ‰ï¼Œå°±æ–°å»ºä¸€ä¸ª</span><br>        <span class="hljs-keyword">return</span> cls.instances  <span class="hljs-comment"># ä¸ç®¡æœ‰æ²¡æœ‰å®ä¾‹åŒ–å¯¹è±¡ï¼Œéƒ½è¿”å›è¿™ä¸ªå¯¹è±¡ï¼Œ å¦‚æœæœ‰å°±ç›´æ¥è¿”å›</span><br><br></code></pre></td></tr></table></figure><h2 id="6-8-é€šè¿‡å…ƒç±»æ¥å®ç°å•ä¾‹æ¨¡å¼ã€é‡ç‚¹ã€‘"><a href="#6-8-é€šè¿‡å…ƒç±»æ¥å®ç°å•ä¾‹æ¨¡å¼ã€é‡ç‚¹ã€‘" class="headerlink" title="6.8 é€šè¿‡å…ƒç±»æ¥å®ç°å•ä¾‹æ¨¡å¼ã€é‡ç‚¹ã€‘"></a>6.8 é€šè¿‡å…ƒç±»æ¥å®ç°å•ä¾‹æ¨¡å¼ã€é‡ç‚¹ã€‘</h2><p>æ€è·¯æ˜¯ä»€ä¹ˆï¼Ÿ</p><ul><li>é¦–å…ˆï¼Œè¿™ä¸ªå®ç°çš„ç‚¹åœ¨å“ªé‡Œï¼Ÿåœ¨ç±»çš„å®šä¹‰é˜¶æ®µå°±ç¡®ä¿ç±»çš„å®ä¾‹åŒ–è¡Œä¸ºç¬¦åˆå•ä¾‹æ¨¡å¼ï¼Œ</li><li>å‘ä½ å•ä¾‹æ¨¡å¼ï¼Œæ˜¯åœ¨å®šä¹‰ç±»çš„æ—¶å€™åšåˆ¤æ–­ï¼Œé€šè¿‡ç±»çš„â€“newâ€“()æ–¹æ³•é‡Œé¢å»åšåˆ¤æ–­ï¼Œå¦‚æœè¿™ä¸ªç±»æœ‰å®ä¾‹åŒ–å¯¹è±¡ï¼Œå°±è¿”å›è¿™ä¸ªå¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰å°±æ–°å»ºä¸€ä¸ªå¯¹è±¡è¿”å›ï¼Œ<ul><li>è¿™é‡Œæ’ä¸€å¥ï¼Œå®ä¾‹åŒ–çš„è¿‡ç¨‹å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ1ã€â€“newâ€“æ–°å»ºä¸€ä¸ªç©ºå¯¹è±¡ä¸”è¿”å›å‡ºå»ç»™â€“initâ€“ 2ã€â€“initâ€“æ¥æ”¶è¿™ä¸ªç©ºå¯¹è±¡ï¼Œè¿›è¡Œåˆå§‹åŒ–ï¼Œå°±æ˜¯slef.name&#x3D;nameï¼Œ3ã€å°†è¿™ä¸ªåˆå§‹åŒ–è¿‡çš„å¯¹è±¡è¿”å›å»ã€‚å°±æ˜¯è°ƒç”¨ç±»çš„â€˜çˆ¸çˆ¸â€™â€™å…ƒç±»çš„â€“callâ€“æ–¹æ³•ï¼Œâ€“callâ€“å°±æ˜¯.ç±»()æŠŠç±»å½“æ–¹æ³•ç”¨çš„æ–¹æ³•</li></ul></li><li>å¥½çš„ï¼Œç°åœ¨æˆ‘ä»¬çŸ¥é“äº†å®ä¾‹åŒ–è¿‡ç¨‹ï¼Œé‚£æˆ‘ä»¬é™¤äº†å¯ä»¥åœ¨newæ–¹æ³•è¿™é‡Œåšåˆ¤æ–­ï¼Œè¿˜å¯ä»¥åœ¨å®šä¹‰ç±»çš„â€˜â€˜çˆ¸çˆ¸â€™â€™å…ƒç±»çš„æ—¶å€™å»åšåˆ¤æ–­</li><li>å› ä¸ºä½ åœ¨å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œå°±æ˜¯è°ƒç”¨äº†ç±»çš„â€˜â€˜çˆ¸çˆ¸â€™â€™å…ƒç±»çš„â€“callâ€“æ–¹æ³•å»å®ä¾‹åŒ–çš„ï¼ˆâ€“callâ€“æŠŠç±»å½“æ–¹æ³•ç”¨ï¼‰</li><li>å¥½ï¼Œç°åœ¨æˆ‘ä»¬çŸ¥é“äº†è¦å»è‡ªå®šä¹‰å…ƒç±»çš„â€“callâ€“æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯åœ¨è°ƒç”¨â€“callâ€“çš„æ—¶å€™å»åšåˆ¤æ–­ï¼Œåˆ¤æ–­è¿™ä¸ªç±»æœ‰æ²¡æœ‰å®ä¾‹åŒ–å¯¹è±¡ï¼Œå¦‚æœæœ‰å°±ç›´æ¥è¿”å›è¿™ä¸ªå¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰å°±æ–°å»ºä¸€ä¸ªå¯¹è±¡ç„¶åå†è¿”å›è¿™ä¸ªå¯¹è±¡ã€‚</li><li>å¥½æˆ‘ç°åœ¨è¦å†è‡ªå®šä¹‰çš„åŸæ¥ä¸Šé¢å»åšåˆ¤æ–­æ˜¯å§ï¼Œé‚£æ€ä¹ˆè‡ªå®šä¹‰å…ƒç±»ï¼Ÿä¸”çœ‹ä»£ç </li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Mymeta</span>(<span class="hljs-title class_ inherited__">type</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">cls, name,bases,dic</span>):<br>        <span class="hljs-built_in">super</span>().__init__(name,bases,dic)<br>        cls._instance = <span class="hljs-literal">None</span>   <span class="hljs-comment"># å°†è®°å½•ç±»çš„å®ä¾‹åŒ–å¯¹è±¡çš„æ•°æ®å±æ€§æ”¾åœ¨å…ƒç±»ä¸­è‡ªåŠ¨å®šä¹‰äº† è¿™é‡Œå’Œä¹‹å‰å®šä¹‰ç±»çš„æ—¶å€™æ˜¯ä¸€ä¸ªæ„æ€</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__call__</span>(<span class="hljs-params">cls,*args, **kwargs</span>):  <span class="hljs-comment"># æ­¤callä¼šåœ¨ç±»è¢«è°ƒç”¨ï¼ˆå³å®ä¾‹åŒ–æ—¶å‡ºå‘ï¼‰</span><br>        <span class="hljs-keyword">if</span> cls._instance:  <span class="hljs-comment"># åˆ¤æ–­ç±»æœ‰æ²¡æœ‰å®ä¾‹åŒ–å¯¹è±¡</span><br>            <span class="hljs-keyword">return</span> cls._instance <span class="hljs-comment"># å¦‚æœæœ‰å°±è¿”å›è¿™ä¸ªå®ä¾‹åŒ–å¯¹è±¡å•Š</span><br>        <span class="hljs-keyword">else</span>:  <span class="hljs-comment"># å¦‚æœæ²¡æœ‰</span><br>            obj = cls.__new__(cls, *args, **kwargs) <span class="hljs-comment"># é‚£å°±æ§åˆ¶ç±»é€ ä¸€ä¸ªç©ºå¯¹è±¡å¹¶å®Œæˆåˆå§‹åŒ–</span><br>            obj.__init__(*args,**kwargs) <span class="hljs-comment">#  é‚£å°±æ§åˆ¶ç±»é€ ä¸€ä¸ªç©ºå¯¹è±¡å¹¶å®Œæˆåˆå§‹åŒ–</span><br>            cls._instance = obj <span class="hljs-comment"># ä¿å­˜è¿™ä¸ªå¯¹è±¡ï¼Œé‚£clsçš„_instanceæ˜¯è¿™ä¸ªå¯¹è±¡ï¼Œä¸‹ä¸€æ¬¡å†å®ä¾‹åŒ–çš„æ—¶å€™å°±ç›´æ¥è¿”å›è€Œä¸ç”¨å†é€ å¯¹è±¡</span><br>            <span class="hljs-keyword">return</span> obj <span class="hljs-comment"># è¿”å›è¿™ä¸ªå¯¹è±¡</span><br>        <br>        <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>(metaclass=Mymeta):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self,name,age</span>):<br>        self.name=name<br>        self.age=age<br>        <br>        <br>stu1 = Student(<span class="hljs-string">&quot;jone&quot;</span>,<span class="hljs-number">18</span>)<br>stu2 = Student(<span class="hljs-string">&#x27;xiaoming&#x27;</span>,<span class="hljs-number">19</span>)<br><span class="hljs-built_in">print</span>(stu1 <span class="hljs-keyword">is</span> stu2)<br><span class="hljs-built_in">print</span>(stu1.__dict__,stu2.__dict__)<br></code></pre></td></tr></table></figure><p>åŸç†è§£è¯»ï¼šç±»å®šä¹‰æ—¶ä¼šè°ƒç”¨å…ƒç±»ä¸‹é¢çš„â€“initâ€“(),ç±»è°ƒç”¨ï¼ˆå®ä¾‹åŒ–å¯¹è±¡ï¼‰æ—¶ä¼šè§¦å‘å…ƒç±»ä¸‹çš„â€“callâ€“æ–¹æ³•</p><p>ç±»åœ¨å®šä¹‰æ—¶ï¼Œç»™ç±»æ–°å¢ä¸€ä¸ªç©ºçš„æ•°æ®å±æ€§ï¼Œ</p><p>ç¬¬ä¸€æ¬¡å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œå®ä¾‹åŒ–ä¹‹åå°±ä¼šå°†è¿™ä¸ªå¯¹è±¡èµ‹å€¼ç»™ç±»çš„æ•°æ®å±æ€§ï¼› # æ‰€ä»¥ç¬¬ä¸€æ¬¡å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œå°±è·å¾—äº†è¿™ä¸ªå±æ€§</p><p>ç¬¬äºŒæ¬¡å†å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œç›´æ¥è¿”å›ç±»çš„è¿™ä¸ªæ•°æ®å±æ€§</p><p>å’Œè‡ªå®šç±»çš„æ—¶å€™å•ä¾‹ä¸åŒçš„æ˜¯ï¼Œç±»çš„è¿™1ä¸ªæ•°æ®å±æ€§æ˜¯æ”¾åœ¨å…ƒç±»ä¸­è‡ªåŠ¨å®šä¹‰çš„ï¼Œè€Œä¸æ˜¯åœ¨ç±»ä¸­æ˜¾ç¤ºçš„å®šä¹‰çš„</p><p>ç±»è°ƒç”¨æ—¶ï¼Œå‡ºå‘å…ƒç±»â€“callâ€“æ–¹æ³•åˆ¤æ–­æ˜¯å¦æœ‰å®ä¾‹åŒ–å¯¹è±¡ï¼Œè€Œä¸æ˜¯åœ¨ç±»çš„ç»‘å®šæ–¹æ³•ä¸­åšåˆ¤æ–­ã€‚</p><p>æœ€åæˆ‘è¯´ä¸€å¥ï¼Œå…¶å®ä¸¤ä¸ªçš„åŸç†æ˜¯ä¸€æ ·çš„ï¼Œ</p><ul><li>ä½ ä½¿ç”¨å®šä¹‰ç±»çš„æ–¹å¼ï¼šä½ åœ¨ç±»ä¸­åšäº†åˆ¤æ–­ï¼Œå…¶å®å°±æ˜¯ä½ æ˜¯åœ¨å®ä¾‹åŒ–å¯¹è±¡çš„â€˜â€˜çˆ¸çˆ¸â€™â€™å®šä¹‰ç±»ä¸­çš„â€“newâ€“ä¹Ÿå°±æ˜¯æ–°å»ºå¯¹è±¡çš„æ—¶å€™åšçš„åˆ¤æ–­ï¼Œ</li><li>ä½ ä½¿ç”¨è‡ªå®šä¹‰å…ƒç±»çš„æ–¹å¼ï¼Œä¹Ÿå°±æ˜¯ä½ åœ¨å®šä¹‰ç±»çš„â€˜â€˜çˆ¸çˆ¸â€™â€™å…ƒç±»çš„â€“callâ€“æ–¹æ³•åšçš„åˆ¤æ–­ï¼Œå› ä¸ºç±»å®ä¾‹åŒ–å¯¹è±¡å°±æ˜¯è°ƒç”¨çš„å…ƒç±»çš„â€“callâ€“æ–¹æ³•</li><li><strong>é‚£äºŒè€…çš„åŒºåˆ«ï¼Ÿ</strong><ul><li>ä½ å…¨å±€åªæœ‰ä¸€ä¸ªç±»çš„å•ä¾‹ï¼Œé‚£ä½ å°±åœ¨å®šä¹‰ç±»çš„æ—¶å€™åšä¸‹åˆ¤æ–­å°±å¥½ï¼Œé‚£å¦‚æœä½ çš„ç¨‹åºè¦å®šä¹‰å¥½å‡ ä¸ªåªèƒ½å•ä¾‹çš„ç±»çš„ï¼Ÿä¸å¯èƒ½æ¯ä¸ªç±»ä½ éƒ½å»é‡å†™â€“newâ€“æ–¹æ³•å§ï¼Ÿ è¿™ä¸ªæ—¶å€™ä½ å°±å¯ä»¥é‡å†™ï¼ˆè‡ªå®šä¹‰ï¼‰å…ƒç±»å»å®ç°å‘€ï¼Œã€‚è¿™æ ·ä½ æ¯ä¸ªå®šä¹‰ç±»åªéœ€è¦ç»§æ‰¿è‡ªå®šä¹‰å…ƒç±»å°±è¡Œã€‚</li></ul></li></ul><p>æ‹“å±•ä¸€ä¸‹ï¼Œåœºæ™¯ï¼š</p><ol><li><strong>éªŒè¯å’Œæ•°æ®å¤„ç†ï¼š</strong> ä½ å¯ä»¥é€šè¿‡è‡ªå®šä¹‰å…ƒç±»æ¥éªŒè¯ç±»çš„å±æ€§å’Œæ–¹æ³•æ˜¯å¦ç¬¦åˆæŸäº›è§„åˆ™ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ªå…ƒç±»ï¼Œç¡®ä¿æ‰€æœ‰çš„å±æ€§éƒ½æ˜¯ç‰¹å®šç±»å‹ï¼Œæˆ–è€…å±æ€§çš„å€¼æ»¡è¶³æŸäº›æ¡ä»¶ã€‚</li><li><strong>æ—¥å¿—å’Œè°ƒè¯•ï¼š è‡ªå®šä¹‰å…ƒç±»å¯ä»¥ç”¨æ¥è‡ªåŠ¨æ·»åŠ æ—¥å¿—ã€è·Ÿè¸ªæˆ–è°ƒè¯•ä¿¡æ¯åˆ°ç±»çš„æ–¹æ³•ä¸­ï¼Œä»è€Œå¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£ä»£ç çš„æ‰§è¡Œè¿‡ç¨‹ã€‚</strong></li><li><strong>ORMï¼ˆå¯¹è±¡å…³ç³»æ˜ å°„ï¼‰ï¼š</strong> è‡ªå®šä¹‰å…ƒç±»å¯ä»¥ç”¨äºåˆ›å»º ORM æ¡†æ¶ä¸­çš„æ•°æ®åº“æ¨¡å‹ï¼Œå°† Python ç±»æ˜ å°„åˆ°æ•°æ®åº“è¡¨ï¼Œä»è€Œå®ç°æ•°æ®çš„å­˜å‚¨å’Œæ£€ç´¢ã€‚</li><li><strong>API å®šä¹‰ï¼š</strong> é€šè¿‡è‡ªå®šä¹‰å…ƒç±»ï¼Œä½ å¯ä»¥åˆ›å»ºé¢†åŸŸç‰¹å®šè¯­è¨€ï¼ˆDSLï¼‰çš„ç±»ï¼Œä»è€Œæä¾›æ›´é«˜çº§åˆ«çš„ API æ¥å£ï¼Œä»¥é€‚åº”ç‰¹å®šçš„ä¸šåŠ¡éœ€æ±‚ã€‚</li><li><strong>ä¾èµ–æ³¨å…¥ï¼š</strong> è‡ªå®šä¹‰å…ƒç±»å¯ä»¥ç”¨äºè‡ªåŠ¨æ³¨å…¥ä¾èµ–é¡¹ï¼Œä»è€Œç®€åŒ–ç±»çš„æ„é€ è¿‡ç¨‹ã€‚</li><li><strong>å•å…ƒæµ‹è¯•è¾…åŠ©ï¼š</strong> è‡ªå®šä¹‰å…ƒç±»å¯ä»¥ç”¨äºåœ¨æµ‹è¯•ä¸­è‡ªåŠ¨ç”Ÿæˆ Mock å¯¹è±¡ï¼Œå¸®åŠ©è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚</li><li><strong>å®ç°å±æ€§è®¿é—®æ§åˆ¶ï¼š</strong> é€šè¿‡è‡ªå®šä¹‰å…ƒç±»ï¼Œä½ å¯ä»¥æ§åˆ¶ç±»çš„å±æ€§è®¿é—®æƒé™ï¼Œä»è€Œå®ç°å…¬å¼€ã€ç§æœ‰å’Œå—ä¿æŠ¤çš„å±æ€§ã€‚</li><li><strong>æ’ä»¶ç³»ç»Ÿï¼š</strong> è‡ªå®šä¹‰å…ƒç±»å¯ä»¥ç”¨äºåˆ›å»ºå¯æ’æ‹”çš„æ’ä»¶ç³»ç»Ÿï¼Œå…è®¸ä½ åŠ¨æ€åœ°æ‰©å±•ç±»çš„åŠŸèƒ½ã€‚</li></ol><p><strong>æ—¥å¿—å’Œè°ƒè¯•ï¼š</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DebugMeta</span>(<span class="hljs-title class_ inherited__">type</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__new__</span>(<span class="hljs-params">cls, name, bases, cls_dict</span>):<br>        <span class="hljs-keyword">for</span> attr_name, attr_value <span class="hljs-keyword">in</span> cls_dict.items():<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">callable</span>(attr_value):  <span class="hljs-comment"># æ£€æŸ¥å±æ€§æ˜¯å¦æ˜¯å¯è°ƒç”¨çš„ï¼ˆæ–¹æ³•ï¼‰</span><br>                cls_dict[attr_name] = cls.debug_decorator(attr_value)  <span class="hljs-comment"># ä½¿ç”¨è£…é¥°å™¨æ›¿æ¢æ–¹æ³•</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">super</span>().__new__(cls, name, bases, cls_dict)<br><br><span class="hljs-meta">    @staticmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">debug_decorator</span>(<span class="hljs-params">func</span>):<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>(<span class="hljs-params">*args, **kwargs</span>):<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Calling <span class="hljs-subst">&#123;func.__name__&#125;</span> with args: <span class="hljs-subst">&#123;args&#125;</span>, kwargs: <span class="hljs-subst">&#123;kwargs&#125;</span>&quot;</span>)<br>            result = func(*args, **kwargs)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;func.__name__&#125;</span> returned: <span class="hljs-subst">&#123;result&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">return</span> result<br>        <span class="hljs-keyword">return</span> wrapper<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DebugClass</span>(metaclass=DebugMeta):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">self, a, b</span>):<br>        <span class="hljs-keyword">return</span> a + b<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">subtract</span>(<span class="hljs-params">self, a, b</span>):<br>        <span class="hljs-keyword">return</span> a - b<br><br><span class="hljs-comment"># ä½¿ç”¨</span><br>debug_instance = DebugClass()<br>result = debug_instance.add(<span class="hljs-number">5</span>, <span class="hljs-number">3</span>)<br><span class="hljs-built_in">print</span>(result)<br><br></code></pre></td></tr></table></figure><ul><li>è‡ªå®šä¹‰å…ƒç±»çš„newæ–¹æ³•ï¼Œ<ul><li>è‡ªå®šä¹‰ä¸€ä¸ªè£…é¥°å™¨ï¼Œå°±æ˜¯è¢«è£…é¥°çš„æ–¹æ³•è¿è¡Œå‰æ‰“å°æ–¹æ³•åç§°å’Œå…¥å‚ä¹‹ç±»çš„ï¼Œæ–¹æ³•ç»“æŸçš„æ—¶å€™æ‰“å°ä¸€ä¸‹returnå€¼</li><li>åœ¨newæ–¹æ³•é‡Œå†™ï¼Œéå†ååˆ¤æ–­ç±»çš„å±æ€§æ˜¯å¦å¯è°ƒç”¨ if callable(å±æ€§å):å¦‚æœå¯ä»¥è°ƒç”¨å°±ä½¿ç”¨è£…é¥°å™¨è£…é¥°ä¸€ä¸‹è¿™ä¸ªæ–¹æ³• æ‰“å°æ—¥å¿—</li><li>ç„¶åå†å®šä¹‰ç±»çš„æ—¶å€™ç»§æ‰¿è¿™ä¸ªè‡ªå®šä¹‰å…ƒç±»ã€‚</li></ul></li></ul><p><strong>éªŒè¯å’Œæ•°æ®å¤„ç†</strong></p><ul><li>å°±æ˜¯è‡ªå®šä¹‰å…ƒç±»newæ–¹æ³•ï¼Œåœ¨é‡Œé¢åšåˆ¤æ–­ï¼Œå¦‚æœç±»ä½ å®šä¹‰çš„ç±»çš„å±æ€§ç¬¦åˆæŸä¸ªè¦æ±‚ï¼Œå°±æ²¡äº‹ï¼Œå¦‚æœä¸å¦‚ä½•å¯¹åº”çš„è¦æ±‚ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸æŠ¥é”™</li><li>ç„¶åä½ åœ¨å®šä¹‰ç±»çš„æ—¶å€™ï¼ŒæŒ‡å®šå…ƒç±»</li></ul>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€pythonã€‘è¿›é˜¶ä¹‹é­”æ³•æ–¹æ³•ï¼ˆäº”ï¼‰</title>
    <link href="/2024/03/18/605python%E8%BF%9B%E9%98%B6%E4%B9%8B%E9%AD%94%E6%B3%95%E6%96%B9%E6%B3%95%EF%BC%88%E4%BA%94%EF%BC%89/"/>
    <url>/2024/03/18/605python%E8%BF%9B%E9%98%B6%E4%B9%8B%E9%AD%94%E6%B3%95%E6%96%B9%E6%B3%95%EF%BC%88%E4%BA%94%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="5-é­”æ³•æ–¹æ³•"><a href="#5-é­”æ³•æ–¹æ³•" class="headerlink" title="5 é­”æ³•æ–¹æ³•"></a>5 é­”æ³•æ–¹æ³•</h1><h2 id="5-1init-å’Œ-del-ã€é‡ç‚¹ã€‘"><a href="#5-1init-å’Œ-del-ã€é‡ç‚¹ã€‘" class="headerlink" title="5-1init å’Œ del ã€é‡ç‚¹ã€‘"></a>5-1init å’Œ del ã€é‡ç‚¹ã€‘</h2><ul><li>ä¸ºä»€ä¹ˆå«é­”æ³•æ–¹æ³•ï¼Ÿ åªæœ‰åœ¨æŸç§æ¡ä»¶ä¸‹æ‰è§¦å‘ï¼Œå°±åƒé­”æ³•ä¸€æ ·</li><li><code> __init__</code> ï¼šå½“ä½ å®šä¹‰çš„ç±»ï¼Œè¢«å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œè‡ªåŠ¨æ‰§è¡Œï¼Œç»™å¯¹è±¡åˆå§‹åŒ–å±æ€§ï¼Œè¿™ä¸ªæ–¹æ³•é‡Œé¢æ”¾self.xxxå±æ€§&#x3D;xxx<br>ç„¶åè¿™ä¸ªxxxç”±initæ–¹æ³•å…¥å‚ï¼Œæ‰€ä»¥ä½ åœ¨å®ä¾‹åŒ–å¯¹è±¡çš„æ—¶å€™ï¼Œå°±éœ€è¦ä¼ è¿™ä¸ªå‚æ•°è¿›å»ï¼Œè¿™ä¸ªå‚æ•°å°±æ˜¯å¯¹è±¡çš„å±æ€§</li><li>è¿™ä¸ª<code> __init__</code> é»˜è®¤æ˜¯è¿”å›Noneçš„ï¼Œé»˜è®¤ä¸å†™</li><li>è¿™é‡Œè¦è¯´ä¸€ä¸‹<code>__del__</code>ææ„æ–¹æ³•ï¼Œå½“å¯¹è±¡è¢«å›æ”¶çš„æ—¶å€™å‡ºå‘æ‰§è¡Œ(ç¨‹åºç»“æŸã€å¯¹è±¡å¼•ç”¨æŠ€æœ¯ä¸º0ç§°ä¸ºåƒåœ¾æ—¶)<br>è¿™é‡Œè¦å›æƒ³ä¸‹pythonçš„åƒåœ¾å›æ”¶æœºåˆ¶çš„ä¸€ç§â€œå¼•ç”¨è®¡æ•°â€ï¼Œå°±æ˜¯å½“å¼•ç”¨è®¡æ•°ä¸º0çš„æ—¶å€™ï¼Œä¼šè¢«å®šä¹‰ä¸ºåƒåœ¾ï¼Œä¼šè¢«å›æ”¶</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;init...&quot;</span>)<br>        self.name = name<br>        self.age = age<br>        <span class="hljs-keyword">return</span><br>        <span class="hljs-comment"># return 123# æ³¨æ„ï¼šæ–¹æ³•å¿…é¡»è¿”å›Noneï¼Œé»˜è®¤ä¸å†™returnè¯­å¥</span><br>        <br><span class="hljs-comment"># ææ„</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age</span>):<br>        self.name = name<br>        self.age = age<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__del__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;del...&quot;</span>)<br><br><br>stu1 = Student(<span class="hljs-string">&quot;jack&quot;</span>, <span class="hljs-number">19</span>)<br><span class="hljs-keyword">del</span> stu1<span class="hljs-comment"># è§¦å‘æ‰§è¡Œ __del__</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">foo</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;----- å‡½æ•°å†…&quot;</span>)<br>    stu2 = Student(<span class="hljs-string">&quot;jack&quot;</span>, <span class="hljs-number">19</span>)<br>    <span class="hljs-built_in">print</span>(stu2.__dict__)<br><br><br>foo()<span class="hljs-comment"># fooå‡½æ•°æ‰§è¡Œç»“æŸï¼Œè§¦å‘æ‰§è¡Œ __del__</span><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼šæ‰§è¡Œç¨‹åºï¼ŒçŒœä¸€çŒœæ‰“å°ç»“æœã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Foo</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__del__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;æ‰§è¡Œæˆ‘å•¦&#x27;</span>)<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;-------&gt;&#x27;</span>)<br></code></pre></td></tr></table></figure><h2 id="5-2-newæ–¹æ³•ã€é‡ç‚¹ã€‘"><a href="#5-2-newæ–¹æ³•ã€é‡ç‚¹ã€‘" class="headerlink" title="5-2 newæ–¹æ³•ã€é‡ç‚¹ã€‘"></a>5-2 newæ–¹æ³•ã€é‡ç‚¹ã€‘</h2><ul><li>å½“ç±»è¢«è°ƒç”¨å®ä¾‹åŒ–å¯¹è±¡æ—¶ç¬¬ä¸€ä¸ªè¢«å¤„ç½šçš„å‡½æ•°ï¼Œç”¨æ¥å®ä¾‹åŒ–å¹¶è¿”å›ä¸€ä¸ªç©ºå¯¹è±¡</li><li><code>__new__</code>æ–¹æ³•åœ¨initæ–¹æ³•å‰æ‰§è¡Œï¼Œ<code>__new__</code>å‡½æ•°ä¼šæ–°å»ºä¸€ä¸ªç©ºå¯¹è±¡ï¼Œç„¶åè¿™ä¸ªç©ºå¯¹è±¡ä¼šäº¤ç»™<code>__init__</code>å‡½æ•°åˆå§‹åŒ–ã€‚è¿™ä¸ªæ–¹æ³•ç»“æŸçš„æ—¶å€™ï¼ŒæŠŠè¿™ä¸ªç©ºå¯¹è±¡returnå‡ºå»</li><li>è¿™é‡Œè¯´è¯´å®ä¾‹åŒ–å¯¹è±¡èƒŒåå‘ç”Ÿçš„ä¸‰ä»¶äº‹ï¼š<ul><li>1ã€<code>__new__</code>å‡½æ•°å…ˆä¼šæ–°å»ºä¸€ä¸ªç©ºå¯¹è±¡ï¼Œç„¶åè¿”å›å‡ºå»ï¼›ç»™<code>__init__</code>å‡½æ•°</li><li>2ã€è¯¥ç©ºå¯¹è±¡æ‰§è¡Œ<code>__init__</code>å‡½æ•°ï¼Œå°±åˆå§‹åŒ–äº†å¯¹è±¡çš„å±æ€§ï¼›</li><li>3ã€è¿”å›åˆå§‹åŒ–å®Œæˆåçš„å¯¹è±¡ï¼Œå³å®ä¾‹åŒ–åçš„å¯¹è±¡ã€‚</li></ul></li><li><code>__new__</code>é­”æ³•æ–¹æ³•çš„ä¸€äº›åº”ç”¨åœºæ™¯ï¼š<ul><li><strong>å®ç°å•ä¾‹æ¨¡å¼</strong>ï¼ˆSingletonï¼‰:ä½¿ç”¨<code>__new__</code>æ–¹æ³•æ¥ç¡®ä¿åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶åœ¨éœ€è¦æ—¶è¿”å›åŒä¸€ä¸ªå®ä¾‹ã€‚è¿™ä¸ªå¯ä»¥åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ç¡®ä¿åªæœ‰ä¸€ä¸ªå…¨å±€å®ä¾‹ï¼Œ</li><li>å®šåˆ¶ä¸å¯å˜ç±»å‹ï¼šå¦‚æœä½ å¸Œæœ›åˆ›å»ºä»¥æ¶æä¸å¯å˜çš„è‡ªå®šä¹‰å¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡åœ¨<code>__new__</code>æ–¹æ³•ä¸­é‡å†™å¯¹è±¡åˆ›å»ºçš„é€»è¾‘æ¥å®ç°ï¼ˆä¸äº†è§£ï¼‰</li><li>ç»§æ‰¿ä¸å¯å˜ç±»å‹ï¼šå½“ç»§æ‰¿pythonå†…ç½®çš„ä¸å¯å˜ç±»å‹ï¼ˆå¦‚å…ƒç»„ã€å­—ç¬¦ä¸²ï¼‰æ—¶ï¼Œä½ å¯ä»¥é€šè¿‡é‡å†™<code>__new__</code>æ–¹æ³•æ¥åˆ›å»ºå®šåˆ¶è¿‡ç¨‹ï¼ˆä¸äº†è§£ï¼‰</li><li>å®šåˆ¶å…ƒç±»ï¼ˆMetaclassï¼‰ï¼šåœ¨å…ƒç±»ä¸­å¯ä»¥é‡å†™<code>__new__</code>æ–¹æ³•ï¼Œç”¨äºæ§åˆ¶ç±»çš„åˆ›å»ºå’Œå®ä¾‹åŒ–è¿‡ç¨‹ã€‚ï¼ˆä¸äº†è§£ï¼Œè¿™ä¸ªå¯ä»¥äº†è§£ä¸€ä¸‹ï¼‰</li><li>å¯¹è±¡æ± ç®¡ç†ï¼šåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ å¯èƒ½éœ€è¦ä½¿ç”¨å¯¹è±¡æ± æ¥é‡ç”¨å·²æœ‰çš„å¯¹è±¡å®ä¾‹ï¼Œå¯ä»¥é€šè¿‡newæ–¹æ³•æ¥å®ç°å¯¹è±¡æ± çš„ç®¡ç†ã€‚ï¼ˆä¸äº†è§£ï¼Œè¿™ä¸ªå¯ä»¥äº†è§£ä¸€ä¸‹ï¼‰</li></ul></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å•ä¾‹æ¨¡å¼</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span>:<br>  _instance = <span class="hljs-literal">None</span><br><br>  <span class="hljs-keyword">def</span> <span class="hljs-title function_">__new__</span>(<span class="hljs-params">cls</span>):<br>    <span class="hljs-keyword">if</span> cls._instance <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>      cls._instance = <span class="hljs-built_in">super</span>().__new__(cls)<br>    <span class="hljs-keyword">return</span> cls._instance<br><br><br><span class="hljs-comment"># åˆ›å»º Singleton ç±»çš„å®ä¾‹</span><br>obj1 = Singleton()  <span class="hljs-comment"># 1622254056400</span><br>obj2 = Singleton()  <span class="hljs-comment"># 1622254056400</span><br><br><span class="hljs-built_in">print</span>(obj1 <span class="hljs-keyword">is</span> obj2)  <span class="hljs-comment"># è¾“å‡ºï¼šTrueï¼Œå› ä¸º obj1 å’Œ obj2 å¼•ç”¨åŒä¸€ä¸ªå®ä¾‹</span><br><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># äº†è§£new æ–¹æ³•</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>:<br>  <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;init:&quot;</span>, <span class="hljs-built_in">id</span>(self))  <span class="hljs-comment"># new: 2176264649120</span><br>    self.name = name<br>    self.age = age<br><br>  <span class="hljs-keyword">def</span> <span class="hljs-title function_">__new__</span>(<span class="hljs-params">cls, *args, **kwargs</span>):<br>    obj = <span class="hljs-built_in">object</span>.__new__(cls)  <span class="hljs-comment"># init: 2176264649120</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;new:&quot;</span>, <span class="hljs-built_in">id</span>(obj))<br>    <span class="hljs-keyword">return</span> obj<br><br><br>stu1 = Student(<span class="hljs-string">&quot;jack&quot;</span>, <span class="hljs-number">19</span>)<br></code></pre></td></tr></table></figure><h2 id="5-3-callã€é‡ç‚¹ã€‘"><a href="#5-3-callã€é‡ç‚¹ã€‘" class="headerlink" title="5.3 callã€é‡ç‚¹ã€‘"></a>5.3 callã€é‡ç‚¹ã€‘</h2><ul><li>ç±»ä¸­çš„<code>__call__</code>åœ¨å¯¹è±¡è¢«è°ƒç”¨æ—¶å‡ºå‘ã€‚å°±æ˜¯å½“å¯¹è±¡åŠ æ‹¬å·è¢«è°ƒç”¨æ—¶è§¦å‘</li><li>å¯¹è±¡æˆ–è€…å˜é‡ï¼Œåªæœ‰å®ç°äº†<code>__call__</code>æ–¹æ³•ï¼Œæ‰æ˜¯å¯è°ƒç”¨å¯¹è±¡ï¼Œæ‰å¯ä»¥è¢«æ‰§è¡Œï¼Œå¦åˆ™å°±ä¼šæŠ¥é”™ï¼Œ<code> object is not callable</code></li><li>å®šä¹‰äº†<code>__call__</code>åï¼Œä½ å®ä¾‹åŒ–çš„å¯¹è±¡å¯ä»¥åƒå‡½æ•°ä¸€æ ·è¢«è°ƒç”¨ï¼Œ</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CallableClass</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, value</span>):<br>        self.value = value<br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__call__</span>(<span class="hljs-params">self, x</span>):<br>        <span class="hljs-keyword">return</span> self.value * x<br><br><span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªå¯è°ƒç”¨çš„å¯¹è±¡</span><br>callable_obj = CallableClass(<span class="hljs-number">5</span>)<br><br><span class="hljs-comment"># è°ƒç”¨å¯¹è±¡ï¼Œå°±åƒè°ƒç”¨å‡½æ•°ä¸€æ ·</span><br>result = callable_obj(<span class="hljs-number">10</span>)<br><span class="hljs-built_in">print</span>(result)  <span class="hljs-comment"># è¾“å‡ºï¼š50</span><br><br></code></pre></td></tr></table></figure><p>æ€»ç»“å°±æ˜¯ï¼Œå¯ä»¥æŠŠç±»å½“æ–¹æ³•ç›´æ¥è°ƒç”¨</p><p>åœºæ™¯å‘¢ï¼Ÿ</p><ul><li>å½“ä½ å¸Œæœ›æŸä¸ªå¯¹è±¡èƒ½åƒå‡½æ•°ä¸€æ ·è°ƒç”¨ä¸”è·å¾—è¿”å›å€¼æ—¶</li><li><code>__call__</code>æ–¹æ³•å¹¶ç»“åˆwithè¯­å¥å’Œ<code>__enter__</code>å’Œ<code>__exit__</code>æ–¹æ³•ã€‚å®ç°ä¸Šä¸‹æ–‡ç®¡ç†</li><li><code>__call__</code>å®ç°è£…é¥°å™¨</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDecorator</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, func</span>):<br>        self.func = func <span class="hljs-comment"># å‡½æ•°ä½œä¸ºå…¥å‚ï¼Œä¼ è¿›æ¥ä½œä¸ºå±æ€§</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__call__</span>(<span class="hljs-params">self, *args, **kwargs</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Before function is called&quot;</span>) <span class="hljs-comment"># è°ƒç”¨å±æ€§</span><br>        result = self.func(*args, **kwargs) <span class="hljs-comment"># è¿™æ˜¯è¢«è£…é¥°çš„æ–¹æ³•</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;After function is called&quot;</span>)<br>        <span class="hljs-keyword">return</span> result<br><br><span class="hljs-meta">@MyDecorator </span><span class="hljs-comment"># @çš„æœ¬è´¨å°±æ˜¯åœ¨åš MyDecoratorï¼ˆmy_functionï¼‰</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">my_function</span>(<span class="hljs-params">x, y</span>):<br>    <span class="hljs-keyword">return</span> x + y<br><br>result = my_function(<span class="hljs-number">3</span>, <span class="hljs-number">5</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Result:&quot;</span>, result)<br>Before function <span class="hljs-keyword">is</span> called<br>After function <span class="hljs-keyword">is</span> called<br>Result: <span class="hljs-number">8</span><br><br></code></pre></td></tr></table></figure><ul><li><strong>è£…é¥°å™¨å®ç°ï¼Œä¸¤ç§æ–¹å¼</strong><ul><li><strong>ç¬¬ä¸€ä¸ªæ˜¯å¸¸è§„çš„ï¼Œé—­åŒ…ï¼ŒåµŒå¥—å‡½æ•°</strong></li><li><strong>ç¬¬äºŒä¸ªå°±æ˜¯å®šä¹‰å¸¦<code>__call__</code>çš„ç±»ã€‚è®²å‡½æ•°ä½œä¸º<code>__init__</code>å…¥å‚ä¼ è¿›æ¥</strong></li></ul></li></ul><h2 id="5-4-strå’Œrepr"><a href="#5-4-strå’Œrepr" class="headerlink" title="5.4 strå’Œrepr"></a>5.4 strå’Œrepr</h2><ul><li><code>__str__</code>ï¼šå½“å¯¹è±¡è¢«è®¿é—®æ‰“å°æ—¶è§¦å‘æ‰§è¡Œï¼Œä»–å¿…é¡»æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„è¿”å›å€¼</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age</span>):<br>        self.name = name<br>        self.age = age<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__str__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;Person(name=<span class="hljs-subst">&#123;self.name&#125;</span>, age=<span class="hljs-subst">&#123;self.age&#125;</span>)&quot;</span><br><br>person = Person(<span class="hljs-string">&quot;Alice&quot;</span>, <span class="hljs-number">30</span>)<br><span class="hljs-built_in">print</span>(person)  <span class="hljs-comment"># Output: Person(name=Alice, age=30)</span><br><br>sut = Student(<span class="hljs-string">&quot;name&quot;</span>,<span class="hljs-string">&quot;age&quot;</span>)<br><span class="hljs-built_in">print</span>(sut) <span class="hljs-comment"># è¿™ä¸ªæ—¶å€™æ‰“å°å‡ºæ¥çš„å†…å®¹ï¼Œå°±æ˜¯stræ–¹æ³•returnå‡ºæ¥çš„å†…å®¹</span><br></code></pre></td></tr></table></figure><p>å¥½è¿™ä¸ªæˆ‘çŸ¥é“äº†ï¼Œé‚£åº”ç”¨çš„åœºæ™¯å‘¢ï¼Ÿ</p><ul><li><p>æ€»ä¹‹ï¼Œ<code>__str__</code> é­”æ³•æ–¹æ³•é€‚ç”¨äºéœ€è¦è‡ªå®šä¹‰å¯¹è±¡çš„å¯è¯»æ€§ã€ç”¨æˆ·å‹å¥½æ€§å’Œè°ƒè¯•ä¿¡æ¯çš„æƒ…å†µã€‚å®ƒä½¿ä½ èƒ½å¤Ÿä»¥æ›´æœ‰æ„ä¹‰çš„æ–¹å¼å‘ˆç°å¯¹è±¡ï¼Œå¹¶æä¾›æœ‰å…³å¯¹è±¡çŠ¶æ€å’Œå±æ€§çš„é‡è¦ä¿¡æ¯ã€‚</p></li><li><p>reprï¼Œæœ¬è´¨å’Œsrtä¸€æ ·ï¼Œéƒ½æ˜¯å¯¹è±¡è¢«æ‰“å°æ—¶æ˜¾ç¤ºçš„å†…å®¹ï¼Œä½†æ˜¯</p></li><li><p><strong>ä¸<code>__str__</code>çš„åŒºåˆ«ï¼š</strong> <code>__str__</code> åº”è¯¥è¿”å›æ›´å‹å¥½ã€æ˜“è¯»çš„å­—ç¬¦ä¸²ï¼Œè€Œ <code>__repr__</code> åˆ™åº”è¯¥è¿”å›æ›´è¯¦ç»†ã€å¯å¤åˆ¶çš„å­—ç¬¦ä¸²ï¼Œé€šå¸¸åŒ…å«è¶³å¤Ÿçš„ä¿¡æ¯æ¥é‡æ–°åˆ›å»ºå¯¹è±¡ã€‚</p></li></ul><h2 id="5-5-æ¯”è¾ƒç³»åˆ—-eq-nq-it"><a href="#5-5-æ¯”è¾ƒç³»åˆ—-eq-nq-it" class="headerlink" title="5.5 æ¯”è¾ƒç³»åˆ— eq nq it"></a>5.5 æ¯”è¾ƒç³»åˆ— eq nq it</h2><p>ä¸¤ä¸ªå¯¹è±¡æ˜¯å¯ä»¥æ¯”è¾ƒçš„ï¼Œä½†æ˜¯æ¯”è¾ƒçš„ç»“æœå¯èƒ½ä¸æ˜¯æˆ‘ä»¬é¢„æœŸçš„ï¼Œæ­¤æ—¶å¯ä»¥é‡å†™æ¯”è¾ƒç³»åˆ—çš„é­”æ³•æ–¹æ³•ï¼Œå®ç°è‡ªå®šä¹‰æ¯”è¾ƒé€»è¾‘</p><ul><li>eq<ul><li><code>__eq__</code> æ–¹æ³•æ˜¯ Python ä¸­çš„ä¸€ä¸ªé­”æ³•æ–¹æ³•ï¼Œç”¨äºå®šä¹‰å¯¹è±¡çš„ç›¸ç­‰æ€§æ¯”è¾ƒæ“ä½œã€‚å½“ä½ åœ¨è‡ªå®šä¹‰ç±»ä¸­å®ç°äº† <code>__eq__</code><br>æ–¹æ³•æ—¶ï¼Œä½ å¯ä»¥è‡ªå®šä¹‰å¯¹è±¡ä¹‹é—´çš„ç›¸ç­‰æ€§åˆ¤æ–­è§„åˆ™</li></ul></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age</span>):<br>        self.name = name<br>        self.age = age<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__eq__</span>(<span class="hljs-params">self, other</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(other, Person):<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;eqè¢«æ‰§è¡Œäº†&quot;</span>)  <span class="hljs-comment"># åªæœ‰å½“ä½ åœ¨åˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•æ‰ä¼šè¢«è§¦å‘</span><br>            <span class="hljs-keyword">return</span> self.name == other.name <span class="hljs-keyword">and</span> self.age == other.age<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br><br><br>person1 = Person(<span class="hljs-string">&quot;Alice&quot;</span>, <span class="hljs-number">25</span>)<br>person2 = Person(<span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-number">30</span>)<br>person3 = Person(<span class="hljs-string">&quot;Alice&quot;</span>, <span class="hljs-number">25</span>)<br><span class="hljs-comment"># print(person1.name)</span><br><span class="hljs-built_in">print</span>(person1 == person2)  <span class="hljs-comment"># Falseï¼Œæ ¹æ® __eq__ æ–¹æ³•çš„å®šä¹‰ï¼Œperson1 å’Œ person2 ä¸ç›¸ç­‰</span><br><span class="hljs-built_in">print</span>(person1 == person3)  <span class="hljs-comment"># Trueï¼Œæ ¹æ® __eq__ æ–¹æ³•çš„å®šä¹‰ï¼Œperson1 å’Œ person3 ç›¸ç­‰</span><br><span class="hljs-comment"># eqè¢«æ‰§è¡Œäº†</span><br><span class="hljs-comment"># False</span><br><span class="hljs-comment"># eqè¢«æ‰§è¡Œäº†</span><br><span class="hljs-comment"># True</span><br></code></pre></td></tr></table></figure><ul><li>åŒæ ·çš„é“ç†ï¼Œå…¶ä»–æ¯”è¾ƒç³»åˆ—çš„æ”¾å•Š</li><li>nqï¼Œå®ç°çš„æ˜¯æ˜¯å¤Ÿä¸ç›¸ç­‰çš„é€»è¾‘ã€‚å¦‚æœæ²¡æœ‰å®ç°ï¼Œåˆ™é»˜è®¤æ˜¯eqçš„ç»“æœå–åã€‚</li><li>è¯¥ç³»åˆ—å…¶ä»–é­”æ³•æ–¹æ³•ï¼š<code>__lt__ã€__gt__ã€__le__ã€__ge__</code>åˆ†åˆ«è¡¨ç¤ºå°äºã€å¤§äºã€å°äºç­‰äºå’Œå¤§äºç­‰äºã€‚</li></ul><h2 id="5-6-attrç³»åˆ—-ã€äº†è§£ã€‘"><a href="#5-6-attrç³»åˆ—-ã€äº†è§£ã€‘" class="headerlink" title="5.6 attrç³»åˆ— ã€äº†è§£ã€‘"></a>5.6 attrç³»åˆ— ã€äº†è§£ã€‘</h2><ul><li>è¿™ä¸ªç³»åˆ—å°±å’Œä¹‹å‰å­¦ä¹ åå°„çš„æ—¶å€™æ˜¯ä¸€æ ·çš„é“ç†</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>:<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name</span>):<br>        self.name = name<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getattr__</span>(<span class="hljs-params">self, item</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;è°ƒç”¨ä¸å­˜åœ¨çš„å±æ€§ä¼šè§¦å‘æˆ‘&#x27;</span>)<br>        <span class="hljs-keyword">return</span> self.__dict__.get(item) <span class="hljs-comment"># </span><br>        <span class="hljs-comment"># return self.item      # ä¸èƒ½ä½¿ç”¨ï¼Œä¼šé€ æˆé€’å½’ã€‚</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__setattr__</span>(<span class="hljs-params">self, key, value</span>): <br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;è®¾ç½®ä¿®æ”¹å¯¹è±¡å±æ€§æ—¶è§¦å‘æˆ‘&#x27;</span>) <span class="hljs-comment"># è¿™ä¸ªåœ¨å®ä¾‹åŒ–å¯¹è±¡çš„æ—¶å€™ä¼šè¢«è§¦å‘ï¼Œå¯ä»¥æœ‰å…¶ä»–ç”¨å¤„</span><br>        self.__dict__[key] = value<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__delattr__</span>(<span class="hljs-params">self, item</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;åˆ é™¤å¯¹è±¡å±æ€§æ—¶è§¦å‘æˆ‘&#x27;</span>)<br>        self.__dict__.pop(item)<br><br><br>p = Person(<span class="hljs-string">&#x27;jack&#x27;</span>)      <span class="hljs-comment"># è§¦å‘__setattr__</span><br>p.name = <span class="hljs-string">&#x27;mack&#x27;</span>         <span class="hljs-comment"># è§¦å‘__setattr__</span><br><span class="hljs-built_in">print</span>(p.age)            <span class="hljs-comment"># è§¦å‘__getattr__</span><br>p.age = <span class="hljs-number">18</span>              <span class="hljs-comment"># è§¦å‘__setattr__</span><br><span class="hljs-built_in">print</span>(p.age)            <br><span class="hljs-keyword">del</span> p.age               <span class="hljs-comment"># __delattr__</span><br></code></pre></td></tr></table></figure><ul><li>ç¤ºä¾‹äºŒï¼Œè®©å­—å…¸ï¼Œå®ç°åƒå¯¹è±¡ä¸€æ ·çš„ç‚¹æ“ä½œ</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDict</span>(<span class="hljs-title class_ inherited__">dict</span>):<br>    abc = <span class="hljs-string">&quot;abc&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getattr__</span>(<span class="hljs-params">self, item</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å­—å…¸å¯¹è±¡é€šè¿‡ç‚¹è®¿é—®ä¸å­˜åœ¨çš„å±æ€§æ—¶è§¦å‘&quot;</span>)<br>        <span class="hljs-keyword">return</span> self.get(item)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__setattr__</span>(<span class="hljs-params">self, key, value</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">isinstance</span>(value, <span class="hljs-built_in">str</span>):<br>            <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&#x27;å€¼å¿…é¡»æ˜¯å­—ç¬¦ä¸²ç±»å‹&#x27;</span>)<br>        self[key] = value<br><br><br>d = MyDict(&#123;<span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;jack&#x27;</span>&#125;)<br><span class="hljs-built_in">print</span>(d.name)               <span class="hljs-comment"># è§¦å‘ __getattr__</span><br><span class="hljs-built_in">print</span>(d.abc)                <span class="hljs-comment"># æ²¡æœ‰è§¦å‘ __getattr__</span><br></code></pre></td></tr></table></figure><h2 id="5-7-itemç³»åˆ—-ï¼Œå’Œatträ¸€æ ·ç”¨ã€é‡ç‚¹ã€‘"><a href="#5-7-itemç³»åˆ—-ï¼Œå’Œatträ¸€æ ·ç”¨ã€é‡ç‚¹ã€‘" class="headerlink" title="5.7 itemç³»åˆ— ï¼Œå’Œatträ¸€æ ·ç”¨ã€é‡ç‚¹ã€‘"></a>5.7 itemç³»åˆ— ï¼Œå’Œatträ¸€æ ·ç”¨ã€é‡ç‚¹ã€‘</h2><p>å®ç°æ™®é€šå¯¹è±¡åƒå­—å…¸ä¸€æ ·é€šè¿‡ [ ] æ“ä½œ å’Œatträ¸€æ ·ç†è§£</p><p>item:é¡¹ç›®</p><p>attr: attributeï¼š å±æ€§çš„è‹±æ–‡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>(<span class="hljs-title class_ inherited__">object</span>):<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name</span>):<br>        self.name = name<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__setitem__</span>(<span class="hljs-params">self, key, value</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[]è®¾ç½®å€¼æ—¶è§¦å‘&quot;</span>)<br>        <span class="hljs-built_in">setattr</span>(self, key, value)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getitem__</span>(<span class="hljs-params">self, item</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;[]å–å€¼æ—¶è§¦å‘&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">getattr</span>(self, item)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__delitem__</span>(<span class="hljs-params">self, key</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;del p[key]æ—¶è§¦å‘&quot;</span>, key)<br><br><br>p = Person(<span class="hljs-string">&#x27;jack&#x27;</span>)<br>p[<span class="hljs-string">&#x27;name&#x27;</span>] = <span class="hljs-string">&#x27;mack&#x27;</span> <span class="hljs-comment"># éœ€è¦__setitem__æ‰å¯ä»¥</span><br><span class="hljs-built_in">print</span>(p[<span class="hljs-string">&#x27;name&#x27;</span>])             <span class="hljs-comment"># éœ€è¦__getitem__æ‰å¯ä»¥</span><br><span class="hljs-built_in">print</span>(p.__dict__)<br><br><span class="hljs-keyword">del</span> p[<span class="hljs-string">&quot;name&quot;</span>]<span class="hljs-comment"># éœ€è¦__delitem__æ‰å¯ä»¥</span><br></code></pre></td></tr></table></figure><h2 id="5-8-enterå’Œexitã€äº†è§£ã€‘"><a href="#5-8-enterå’Œexitã€äº†è§£ã€‘" class="headerlink" title="5.8 enterå’Œexitã€äº†è§£ã€‘"></a>5.8 enterå’Œexitã€äº†è§£ã€‘</h2><ul><li><code>ä¸Šä¸‹æ–‡ç®¡ç†å™¨</code>ï¼š<ul><li>æ‰§è¡Œä»£ç å—å‰åçš„æ“ä½œï¼Œ</li><li>æ–‡ä»¶ä¹Ÿæ˜¯ä»£ç å—</li></ul></li><li>with ï¼šé¡ºç€<ul><li>é¡ºç€ä¸Šä¸‹æ–‡ç®¡ç†å™¨</li></ul></li><li>with open(file , modeæ“ä½œæ¨¡å¼)  modeå°±æ˜¯rè¯»å–å’Œwå†™å…¥çš„æ¨¡å¼é€‰æ‹©<ul><li>è¿™é‡Œçš„with openä¸­çš„open( )å‡½æ•°æ‰€è¿”å›å‡ºæ¥çš„å¯¹è±¡å°±æ˜¯ä¸€ä¸ªä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œè¿™ä¸ªå¯¹è±¡å®ç°äº†enteræ–¹æ³•å’Œexitæ–¹æ³• ç”¨äºå¯¹æ–‡ä»¶çš„è‡ªåŠ¨æ‰“å¼€å’Œå…³é—­ï¼Œ</li><li>å¦‚æœæ²¡æœ‰openï¼Œé‚£æˆ‘ä»¬çš„ä»£ç åº”è¯¥æ˜¯æ€ä¹ˆå†™çš„ï¼Ÿ<ul><li>å°±åƒæ•°æ®åº“ä¸€æ ·</li><li>file &#x3D; open ( â€˜fileâ€™ , mode )</li><li>file.write(â€œhello,worldâ€)</li><li>file.close( )</li><li>ä½†æ˜¯è¿™æ ·å†™ä¸å¥½çœ‹å¾ˆéº»çƒ¦ï¼Œwith open å°±è‡ªåŠ¨å¸®æˆ‘ä»¬å®ç°äº†æ‰“å¼€å’Œå†™å…¥å’Œå…³é—­çš„æ“ä½œ</li></ul></li></ul></li><li>å¥½ï¼Œè¯´åˆ°è¿™é‡Œï¼Œå°±èƒ½ç†è§£enterå’Œexitäº†</li><li>è¿™ä¸ªä»£ç é‡Œçš„MyOpenå°±æ˜¯æˆ‘ä»¬çš„è‡ªå·±å®šä¹‰çš„ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œè¿™ä¸ªç±»æ‰€è¿”å›å‡ºæ¥çš„å¯¹è±¡å°±æ˜¯ä¸€ä¸ªä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œå®ç°äº†enterå’Œexitæ–¹æ³•æ‰“å¼€å’Œå…³é—­</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyOpen</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, file_name: <span class="hljs-built_in">str</span>, mode=<span class="hljs-string">&quot;r&quot;</span></span>):<br>        self.file = <span class="hljs-built_in">open</span>(file_name, mode)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__enter__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è¿›å…¥withè¯­å¥å—æ—¶è§¦å‘&quot;</span>)<br>        <span class="hljs-keyword">return</span> self.file        <span class="hljs-comment"># è¿”å›å€¼èµ‹å€¼ç»™ asåé¢çš„æ¥æ”¶å€¼</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__exit__</span>(<span class="hljs-params">self, exc_type, exc_val, exc_tb</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;é€€å‡ºwithè¯­å¥å—æ—¶è§¦å‘ï¼Œä¸è®ºwithè¯­å¥å—å†…æ˜¯å¤Ÿæœ‰å¼‚å¸¸æŠ¥é”™ï¼Œ__exit__éƒ½ä¼šè¢«æ‰§è¡Œ&quot;</span>)<br>        self.file.close()<br><br><br>        <br><span class="hljs-keyword">with</span> MyOpen(<span class="hljs-string">&quot;text.txt&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    f.write(<span class="hljs-string">&quot;hello world&quot;</span>)<br></code></pre></td></tr></table></figure><h2 id="5-9-iterå’Œnextã€é‡ç‚¹ã€‘"><a href="#5-9-iterå’Œnextã€é‡ç‚¹ã€‘" class="headerlink" title="5.9 iterå’Œnextã€é‡ç‚¹ã€‘"></a>5.9 iterå’Œnextã€é‡ç‚¹ã€‘</h2><p>è§åçŸ¥æ„ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•æ˜¯å®ç°è¿­ä»£å™¨åŠŸèƒ½çš„ï¼Œæ¯”å¦‚å®ç°ä¸€ä¸ªrange</p><p>è¿™æ ·æˆ‘ä»¬å°±çŸ¥é“äº†rangeåŸç†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æ™®é€šrange</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):<br>    <span class="hljs-built_in">print</span>(i)<br></code></pre></td></tr></table></figure><ul><li>é€šè¿‡è‡ªå·±å®šä¹‰è¿™ä¸¤ä¸ªé­”æ³•æ–¹æ³•å®ç°è‡ªå·±çš„range</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyRange</span>():<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self,total: <span class="hljs-built_in">int</span>,step: <span class="hljs-built_in">int</span>=<span class="hljs-number">1</span></span>):<br>        self.count = <span class="hljs-number">0</span>  <span class="hljs-comment"># è¿™é‡Œéƒ½æ˜¯å®šä¹‰å±æ€§</span><br>        self.total = total<br>        self.step = step <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__iter__</span>(<span class="hljs-params">self</span>):  <span class="hljs-comment"># </span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;1111&quot;</span>)<br>        <span class="hljs-keyword">return</span> self  <span class="hljs-comment"># forå¾ªç¯ç¬¬ä¸€ä¸ªè¿›å…¥æ—¶æ‰§è¡Œä¸€æ¬¡ï¼Œéœ€è¦è¿”å›ä¸€ä¸ªå®ç°äº†__next__çš„è¿­ä»£å™¨å¯¹è±¡</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__next__</span>(<span class="hljs-params">self</span>):<br>        time.sleep(<span class="hljs-number">0.5</span>)<br>        self.count += self.step <span class="hljs-comment"># æ²¡æ¬¡è¿è¡ŒåŠ 1æˆ–è€…è‡ªå®šä¹‰çš„æ•°</span><br>        <span class="hljs-keyword">if</span> self.count == self.total:<br>            reise StopIteration <span class="hljs-comment"># å¦‚æœcountè®¡æ•°ç­‰äºtotalæ€»æ•°æ—¶å¼•å‘è¿­ä»£å¼‚å¸¸ï¼Œä¸æ˜¯æŠ›å‡ºï¼Œè¿™ä¸ªè¿­ä»£å¼‚å¸¸è¡¨ç¤ºè¿­ä»£ç»“æŸ</span><br>        <span class="hljs-keyword">return</span> self.count <br>    <br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> MyRange(<span class="hljs-number">10</span>,<span class="hljs-number">2</span>):<br>    <span class="hljs-built_in">print</span>(i)<br></code></pre></td></tr></table></figure><ul><li>æ€»ç»“ä¸€ä¸‹ï¼Œ</li><li>iter å½“ä¸€ä¸ªç±»ï¼Œå®šä¹‰äº†iteré­”æ³•æ–¹æ³•ï¼Œè¿™ä¸ªç±»çš„å®ä¾‹ï¼Œå°±è¢«è®¤ä¸ºæ˜¯å¯è¿­ä»£çš„ï¼ˆiterable)<ul><li>iteræ–¹æ³•åº”è¿”å›ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡ï¼Œå¯ä»¥æ˜¯selfï¼Œä¹Ÿå¯ä»¥æ˜¯å¦ä¸€ä¸ªå®ç°äº†nextæ–¹æ³•çš„å¯¹è±¡</li></ul></li><li>next æ–¹æ³•ï¼šè¿™ä¸ªæ–¹æ³•ç”¨äºè·å–è¿­ä»£ä¸­çš„ä¸‹ä¸€ä¸ªå€¼ã€‚<ul><li>å¦‚æœæ²¡æœ‰æ›´å¤šçš„å€¼å¯è¿­ä»£ï¼Œåº”è¯¥è¦å¼•å‘StopIterationå¼‚å¸¸ï¼Œè¡¨ç¤ºè¿­ä»£ç»“æŸ</li></ul></li></ul><p>åœ¨ Python ä¸­ï¼Œè¿­ä»£å™¨ï¼ˆIteratorï¼‰å’Œç”Ÿæˆå™¨ï¼ˆGeneratorï¼‰æ˜¯ç”¨äºå¤„ç†å¯è¿­ä»£å¯¹è±¡çš„é‡è¦æ¦‚å¿µã€‚å®ƒä»¬æä¾›äº†ä¸€ç§æœ‰æ•ˆçš„æ–¹å¼æ¥é€ä¸ªè®¿é—®å’Œå¤„ç†å¤§å‹æ•°æ®é›†æˆ–æ— é™åºåˆ—ï¼ŒåŒæ—¶èŠ‚çœå†…å­˜å’Œæé«˜æ€§èƒ½ã€‚</p><p><strong>è¿­ä»£å™¨ï¼ˆIteratorï¼‰</strong>æ˜¯ä¸€ä¸ªå®ç°äº†è¿­ä»£åè®®çš„å¯¹è±¡ã€‚å®ƒå…·æœ‰ä¸¤ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼š</p><ol><li><code>__iter__()</code> æ–¹æ³•ï¼šè¿”å›è¿­ä»£å™¨å¯¹è±¡è‡ªèº«ã€‚ç”¨äºæ”¯æŒè¿­ä»£åè®®ï¼Œä½¿è¿­ä»£å™¨å¯ä»¥åœ¨ <code>for</code> å¾ªç¯ç­‰ä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨ã€‚</li><li><code>__next__()</code> æ–¹æ³•ï¼šè¿”å›è¿­ä»£å™¨çš„ä¸‹ä¸€ä¸ªå…ƒç´ ã€‚å¦‚æœæ²¡æœ‰æ›´å¤šå…ƒç´ å¯ä¾›è¿­ä»£ï¼ŒæŠ›å‡º <code>StopIteration</code> å¼‚å¸¸ã€‚</li></ol><p>è¿­ä»£å™¨çš„å·¥ä½œåŸç†æ˜¯é€šè¿‡è¿­ä»£åè®®æ¥é€ä¸ªè¿”å›å…ƒç´ ï¼Œåªåœ¨éœ€è¦æ—¶ç”Ÿæˆå’Œæä¾›æ•°æ®ï¼Œä»è€Œé¿å…ä¸€æ¬¡æ€§åŠ è½½å’Œå¤„ç†æ•´ä¸ªæ•°æ®é›†æˆ–åºåˆ—ã€‚</p><p><strong>ç”Ÿæˆå™¨ï¼ˆGeneratorï¼‰</strong>æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„è¿­ä»£å™¨ï¼Œå¯ä»¥ä½¿ç”¨å‡½æ•°å’Œ <code>yield</code> è¯­å¥æ¥åˆ›å»ºã€‚ç”Ÿæˆå™¨å‡½æ•°åœ¨è¢«è°ƒç”¨æ—¶è¿”å›ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡ï¼Œå®ƒå¯ä»¥è¢«è¿­ä»£ï¼Œæ¯æ¬¡è¿­ä»£éƒ½ä¼šæ‰§è¡Œå‡½æ•°ä½“ä¸­çš„ä»£ç ï¼Œç›´åˆ°é‡åˆ° <code>yield</code> è¯­å¥ã€‚</p><p>ç”Ÿæˆå™¨çš„ä¼˜ç‚¹åœ¨äºå®ƒä»¬çš„å®šä¹‰æ›´ç®€æ´ï¼Œå¹¶ä¸”å®ƒä»¬ä»¥æƒ°æ€§çš„æ–¹å¼ç”Ÿæˆæ•°æ®ï¼Œåªåœ¨éœ€è¦æ—¶æ‰ç”Ÿæˆå’Œæä¾›æ•°æ®ã€‚è¿™ä½¿å¾—ç”Ÿæˆå™¨éå¸¸é€‚ç”¨äºå¤„ç†å¤§å‹æ•°æ®é›†æˆ–æ— é™åºåˆ—ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥é€æ­¥ç”Ÿæˆæ•°æ®ï¼Œè€Œä¸ä¼šä¸€æ¬¡æ€§å ç”¨å¤§é‡å†…å­˜ã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå±•ç¤ºäº†è¿­ä»£å™¨å’Œç”Ÿæˆå™¨çš„ä½¿ç”¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># è¿­ä»£å™¨ç¤ºä¾‹</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyIterator</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, data</span>):<br>        self.data = data<br>        self.index = <span class="hljs-number">0</span><br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__iter__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> self<br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__next__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">if</span> self.index &gt;= <span class="hljs-built_in">len</span>(self.data):<br>            <span class="hljs-keyword">raise</span> StopIteration<br>        value = self.data[self.index]<br>        self.index += <span class="hljs-number">1</span><br>        <span class="hljs-keyword">return</span> value<br><br><span class="hljs-comment"># ä½¿ç”¨è¿­ä»£å™¨</span><br>my_iterator = MyIterator([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>])<br><span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> my_iterator:<br>    <span class="hljs-built_in">print</span>(num)<br><br><span class="hljs-comment"># ç”Ÿæˆå™¨ç¤ºä¾‹</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">my_generator</span>(<span class="hljs-params">data</span>):<br>    <span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> data:<br>        <span class="hljs-keyword">yield</span> num<br><br><span class="hljs-comment"># ä½¿ç”¨ç”Ÿæˆå™¨</span><br>my_generator = my_generator([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>])<br><span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> my_generator:<br>    <span class="hljs-built_in">print</span>(num)<br></code></pre></td></tr></table></figure><h2 id="5-10å…¶ä»–é­”æ³•æ–¹æ³•"><a href="#5-10å…¶ä»–é­”æ³•æ–¹æ³•" class="headerlink" title="5.10å…¶ä»–é­”æ³•æ–¹æ³•"></a>5.10å…¶ä»–é­”æ³•æ–¹æ³•</h2><h3 id="getattributeç³»åˆ—-attributeå°±æ˜¯å±æ€§çš„æ„æ€"><a href="#getattributeç³»åˆ—-attributeå°±æ˜¯å±æ€§çš„æ„æ€" class="headerlink" title="getattributeç³»åˆ— attributeå°±æ˜¯å±æ€§çš„æ„æ€"></a>getattributeç³»åˆ— attributeå°±æ˜¯å±æ€§çš„æ„æ€</h3><ul><li>è°ƒç”¨å¯¹è±¡ä¸å­˜åœ¨çš„å±æ€§çš„æ—¶å€™ï¼Œä¼šè®¿é—®getattr</li><li>è®¿é—®å¯¹è±¡çš„å±æ€§ä¸ç®¡å­˜åœ¨ä¸å­˜åœ¨éƒ½ä¼šè§¦å‘getattributeæ–¹æ³•</li><li>é™¤égetattributeæŠ›å‡ºAttributeErrorå¼‚å¸¸æ‰ä¼šè§¦å‘getattr</li><li>æ‰€ä»¥å½“ä½ è®¿é—®å¯¹è±¡çš„å±æ€§ä¸ç®¡å­˜åœ¨ä¸å­˜åœ¨éƒ½ä¼šè§¦å‘getattributeå¼‚å¸¸</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Foo</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self,x</span>):<br>        self.x = x<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getattr__</span>(<span class="hljs-params">self, item</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;æ‰§è¡Œçš„æ˜¯æˆ‘&#x27;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__getattribute__</span>(<span class="hljs-params">self, item</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ä¸ç®¡æ˜¯å¦å­˜åœ¨,æˆ‘éƒ½ä¼šæ‰§è¡Œ&#x27;</span>)<br>        <span class="hljs-keyword">raise</span> AttributeError(<span class="hljs-string">&#x27;å“ˆå“ˆ&#x27;</span>)<br><br><br>f1=Foo(<span class="hljs-number">10</span>)<br><br>f1.x<br>f1.y<br></code></pre></td></tr></table></figure><h3 id="moduleã€classã€name"><a href="#moduleã€classã€name" class="headerlink" title="moduleã€classã€name"></a>moduleã€classã€name</h3><ul><li><code>__module__</code>ï¼šæ¨¡å—ï¼Œè¡¨ç¤ºå½“å‰é”™çˆ±æ—©çš„å¯¹è±¡åœ¨å“ªä¸ªæ¨¡å—</li><li><code>__class__</code>ï¼šç±» è¡¨ç¤ºå½“å‰æ“ä½œå¯¹è±¡çš„ç±»æ˜¯ä»€ä¹ˆ</li><li><h2 id="name-ï¼š-è¡¨ç¤ºå½“å‰å¯¹è±¡çš„åå­—æ˜¯ä»€ä¹ˆ"><a href="#name-ï¼š-è¡¨ç¤ºå½“å‰å¯¹è±¡çš„åå­—æ˜¯ä»€ä¹ˆ" class="headerlink" title="__name__ï¼š è¡¨ç¤ºå½“å‰å¯¹è±¡çš„åå­—æ˜¯ä»€ä¹ˆ"></a><code>__name__</code>ï¼š è¡¨ç¤ºå½“å‰å¯¹è±¡çš„åå­—æ˜¯ä»€ä¹ˆ</h2></li></ul><h3 id="slotã€all"><a href="#slotã€all" class="headerlink" title="slotã€all"></a>slotã€all</h3><ul><li><code>__slot__</code>ï¼šæ§åˆ¶å¯¹è±¡åœ¨å®ä¾‹åŒ–åå¯ä»¥æŒæ”¯æŒå“ªäº›å±æ€§</li><li>æ˜¯ä¸€ä¸ªç”¨äºé™åˆ¶å¯¹è±¡å±æ€§çš„ç‰¹æ®Šå±æ€§ï¼Œå®ƒæ˜¯ä¸€ç§ç”¨äºä¼˜åŒ–å†…å­˜å ç”¨å’Œå±æ€§è®¿é—®é€Ÿåº¦çš„æœºåˆ¶ã€‚é€šè¿‡åœ¨ç±»ä¸­å®šä¹‰ <code>__slots__</code><br>å±æ€§ï¼Œä½ å¯ä»¥æŒ‡å®šä¸€ä¸ªå±æ€§åç§°çš„åˆ—è¡¨ï¼Œä»è€Œé™åˆ¶ç±»çš„å®ä¾‹åªèƒ½å…·æœ‰æŒ‡å®šåˆ—è¡¨ä¸­çš„å±æ€§ã€‚</li><li>allï¼š</li><li>åœ¨æ¨¡å—æ–‡ä»¶ä¸­è®¾ç½® <code>__all__</code> å˜é‡ï¼Œå½“å…¶å®ƒæ–‡ä»¶ä»¥â€œfrom æ¨¡å—å import *â€çš„å½¢å¼å¯¼å…¥è¯¥æ¨¡å—æ—¶ï¼Œè¯¥æ–‡ä»¶ä¸­åªèƒ½ä½¿ç”¨ <code>__all__</code><br>åˆ—è¡¨ä¸­æŒ‡å®šçš„æˆå‘˜ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># tools.py</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a: <span class="hljs-built_in">int</span>, b: <span class="hljs-built_in">int</span></span>):<br>    <span class="hljs-keyword">return</span> a + b<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">mul</span>(<span class="hljs-params">a: <span class="hljs-built_in">int</span>, b: <span class="hljs-built_in">int</span></span>):<br>    <span class="hljs-keyword">return</span> a * b<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">xsum</span>(<span class="hljs-params">nums: <span class="hljs-built_in">list</span></span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">sum</span>(nums)<br><br><br>__all__ = [<span class="hljs-string">&quot;add&quot;</span>, <span class="hljs-string">&quot;mul&quot;</span>]<br></code></pre></td></tr></table></figure><ul><li>ç¬¬å››ç»„ï¼šasyncioå¼‚æ­¥ç³»åˆ—çš„é­”æ³•å‡½æ•°ï¼ˆäº†è§£ï¼‰</li></ul>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€pythonã€‘è¿›é˜¶ä¹‹é¢ç›¸å¯¹è±¡ï¼ˆå››ï¼‰ã€é‡ç‚¹ã€‘</title>
    <link href="/2024/03/18/604python%E8%BF%9B%E9%98%B6%E4%B9%8B%E9%9D%A2%E7%9B%B8%E5%AF%B9%E8%B1%A1%EF%BC%88%E5%9B%9B%EF%BC%89/"/>
    <url>/2024/03/18/604python%E8%BF%9B%E9%98%B6%E4%B9%8B%E9%9D%A2%E7%9B%B8%E5%AF%B9%E8%B1%A1%EF%BC%88%E5%9B%9B%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="4-é¢ç›¸å¯¹è±¡ã€é‡ä¸­ä¹‹ä¸­ã€‘"><a href="#4-é¢ç›¸å¯¹è±¡ã€é‡ä¸­ä¹‹ä¸­ã€‘" class="headerlink" title="4 é¢ç›¸å¯¹è±¡ã€é‡ä¸­ä¹‹ä¸­ã€‘"></a>4 é¢ç›¸å¯¹è±¡ã€é‡ä¸­ä¹‹ä¸­ã€‘</h1><p>é¢å‘å¯¹è±¡ä¸æ˜¯ä»€ä¹ˆè¯­æ³•å…³é”®å­—ï¼Œä¹Ÿä¸æ˜¯ä»€ä¹ˆå‡½æ•°æ–¹æ³•ï¼Œ</p><p><strong>è€Œæ˜¯ä¸€ç§æ€æƒ³ï¼Œå…·å¤‡è¿™ç§æ€æƒ³ï¼Œæ‰èƒ½å†™Pythonï¼Œ</strong></p><p><strong>æ¢è¨€ä¹‹ï¼š</strong></p><p><strong>å¦‚æœä¸å…·å¤‡è¿™ç§æ€æƒ³ï¼Œå°±å†™ä¸å¥½Python !!!</strong></p><p><strong>å¦‚æœä¸å…·å¤‡è¿™ç§æ€æƒ³ï¼Œå°±å†™ä¸å¥½Python !!!</strong></p><p><strong>å¦‚æœä¸å…·å¤‡è¿™ç§æ€æƒ³ï¼Œå°±å†™ä¸å¥½Python !!!</strong></p><p>é€šè¿‡æœ¬æ–‡å¯ä»¥å¯¹Python é¢å‘å¯¹è±¡æœ‰å†™å¯è’™ï¼Œä½†æ˜¯å…·ä½“è¦æ ¹æ®é¡¹ç›®å®é™…åœºæ™¯åº”ç”¨æ‰èƒ½æ·±åˆ»ä½“ä¼šã€‚</p><h2 id="4-1-ä¸€åˆ‡çš†å¯¹è±¡ã€é‡ç‚¹ã€‘"><a href="#4-1-ä¸€åˆ‡çš†å¯¹è±¡ã€é‡ç‚¹ã€‘" class="headerlink" title="4.1 ä¸€åˆ‡çš†å¯¹è±¡ã€é‡ç‚¹ã€‘"></a>4.1 ä¸€åˆ‡çš†å¯¹è±¡ã€é‡ç‚¹ã€‘</h2><ul><li>Pythonæ˜¯ä¸€é—¨<code>é¢å‘å¯¹è±¡</code>è¯­è¨€</li><li>Pythonä¸­ä¸€åˆ‡çš†å¯¹è±¡</li><li>æ— æ³•æ·±åˆ»ç†è§£<code>é¢å‘å¯¹è±¡</code>å°±æ— æ³•ç”¨å¥½Python</li><li>è‡ªå®šä¹‰çš„ç±»å®ä¾‹åŒ–å¯¹è±¡ï¼Œå…¶å®åƒåŸºæœ¬æ•°æ®ç±»å‹(int\string\list\dictç­‰)ã€å‡½æ•°ã€ç±»éƒ½æ˜¯å¯¹è±¡ï¼Œéƒ½å¯ä»¥æŒ‰ç…§å¯¹è±¡çš„æ–¹å¼æ¥æ“ä½œã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># è‡ªå®šä¹‰Studentç±» å¹¶å®ä¾‹åŒ–å¯¹è±¡jack</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age</span>):<br>        self.name = name<br>        self.age = age<br> <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">say_hello</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;My name is <span class="hljs-subst">&#123;self.name&#125;</span>&quot;</span>)<br>        <br>        <br>jack = Student(<span class="hljs-string">&quot;jack&quot;</span>, <span class="hljs-number">18</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(jack))<span class="hljs-comment">#ä½¿ç”¨typeæŸ¥çœ‹å˜é‡ç±»å‹ &lt;class &#x27;__main__.Student&#x27;&gt;</span><br>jack.say_hello()<br><span class="hljs-built_in">print</span>(jack.age)<br><br><br><br><span class="hljs-comment"># æ™®é€šå˜é‡ä¹Ÿéƒ½æ˜¯å¯¹åº”ç±»çš„å®ä¾‹åŒ–å¯¹è±¡ï¼Œæ¯”å¦‚åˆ—è¡¨å˜é‡å¯ä»¥ä½¿ç”¨ pop()ã€append()ç­‰æ–¹æ³•ã€‚</span><br>ll = []     <span class="hljs-comment"># ç­‰ä»·äº ll = list()ï¼Œ listå°±æ˜¯python å†…ç½®ç±»</span><br>ll.append(<span class="hljs-number">123</span>)<br><br><br><span class="hljs-comment"># å‡½æ•°ä¹Ÿæ˜¯</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">foo</span>():<br>    <span class="hljs-keyword">pass</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(foo))<span class="hljs-comment">#å‡½æ•°fooæ˜¯functionçš„å®ä¾‹åŒ–å¯¹è±¡ &lt;class &#x27;function&#x27;&gt;</span><br></code></pre></td></tr></table></figure><ul><li><code>type</code>æŸ¥çœ‹å¯¹è±¡ç±»å‹</li><li><strong>é€šè¿‡dirå‡½æ•°æŸ¥çœ‹å¯¹è±¡ä¸‹é¢æœ‰å“ªäº›å±æ€§å’Œæ–¹æ³•</strong></li><li>é€šè¿‡id()æŸ¥çœ‹å˜é‡çš„å†…å­˜åœ°å€</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">num1 = <span class="hljs-number">400</span><br>num2 = <span class="hljs-number">500</span><br><br><span class="hljs-built_in">print</span>(num1 <span class="hljs-keyword">is</span> num2)<span class="hljs-comment"># False, å†…å­˜åœ°å€ä¸ä¸€æ ·ï¼Œå¼€è¾Ÿä¸¤å—ä¸åŒçš„å†…å­˜åœ°å€</span><br>n1 = <span class="hljs-number">100</span><br>n2 = <span class="hljs-number">100</span><br><span class="hljs-built_in">print</span>(n1 <span class="hljs-keyword">is</span> n2)<span class="hljs-comment"># True, å°æ•´æ•°æ± ä¼˜åŒ–ï¼Œé€šç”¨ä¸€å—å†…å­˜åœ°å€ã€‚</span><br><br>stu1 = Student(<span class="hljs-string">&quot;jack&quot;</span>, <span class="hljs-number">18</span>)<br>stu2 = Student(<span class="hljs-string">&quot;jack&quot;</span>, <span class="hljs-number">18</span>)<br><span class="hljs-built_in">print</span>(stu1 <span class="hljs-keyword">is</span> stu2)<span class="hljs-comment"># False, å†…å­˜åœ°å€ä¸ä¸€æ ·ï¼Œå®ä¾‹åŒ–å¯¹è±¡éƒ½å¼€è¾Ÿä¸€å—æ–°çš„å†…å­˜åœ°å€ã€‚</span><br></code></pre></td></tr></table></figure><h2 id="4-2-é¢å‘å¯¹è±¡çš„å°è£…æ€æƒ³ã€é‡ç‚¹ã€‘"><a href="#4-2-é¢å‘å¯¹è±¡çš„å°è£…æ€æƒ³ã€é‡ç‚¹ã€‘" class="headerlink" title="4.2 é¢å‘å¯¹è±¡çš„å°è£…æ€æƒ³ã€é‡ç‚¹ã€‘"></a>4.2 é¢å‘å¯¹è±¡çš„å°è£…æ€æƒ³ã€é‡ç‚¹ã€‘</h2><ul><li>åŸºæœ¬æ•°æ®ç±»å‹int&#x2F;str&#x2F;boolçš„åŠŸèƒ½å•ä¸€ï¼Œäºæ˜¯æœ‰äº†å®¹å™¨å‹æ•°æ®ç±»å‹list&#x2F;tuple&#x2F;dict&#x2F;setç­‰</li><li>ç‹¬ç«‹çš„ä»£ç å—ä½¿ç”¨èµ·æ¥å†—ä½™ï¼Œäºæ˜¯åˆäº†å‡½æ•°ï¼Œä¾¿äºç‰¹å®šåŠŸèƒ½ä»£ç å—çš„ç»„ç»‡ç®¡ç†ã€é‡å¤ä½¿ç”¨</li><li>é¢å‘å¯¹è±¡ï¼šå°†ç¨‹åºè¿›ä¸€æ­¥æ•´åˆï¼Œå¯¹è±¡å°è£…äº†æ•°æ®å±æ€§å’Œæ–¹æ³•å±æ€§ï¼ˆæ•°æ®å’ŒåŠŸèƒ½ï¼‰å³å¯¹è±¡ä¹Ÿæ˜¯â€œå®¹å™¨â€</li><li>è¿›ä¸€æ­¥ï¼Œè®¸å¤šåŒç±»å‹çš„å¯¹è±¡ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿè¢«<code>æŠ½è±¡</code>æˆäº†ç±»ï¼Œæ‰€ä»¥ç±»ä¹Ÿæ˜¯<code>â€œå®¹å™¨â€</code>ï¼Œå°è£…äº†åŒç±»å‹å¯¹è±¡å…±æœ‰çš„æ•°æ®å’ŒåŠŸèƒ½ï¼Œå¯ä»¥é‡å¤ä½¿ç”¨</li></ul><h2 id="4-3-ç»‘å®šæ–¹æ³•å’Œéç»‘å®šæ–¹æ³•ã€æœ‰ç”¨ã€‘"><a href="#4-3-ç»‘å®šæ–¹æ³•å’Œéç»‘å®šæ–¹æ³•ã€æœ‰ç”¨ã€‘" class="headerlink" title="4.3 ç»‘å®šæ–¹æ³•å’Œéç»‘å®šæ–¹æ³•ã€æœ‰ç”¨ã€‘"></a>4.3 ç»‘å®šæ–¹æ³•å’Œéç»‘å®šæ–¹æ³•ã€æœ‰ç”¨ã€‘</h2><ul><li>pythonä¸­ï¼Œç±»å†…éƒ¨å®šä¹‰çš„å‡½æ•°åˆ†ä¸ºä¸¤å¤§ç±»ï¼šç»‘å®šæ–¹æ³•å’Œéç»‘å®šæ–¹æ³•</li><li>ç»‘å®šæ–¹æ³•æœ‰ä¸¤ä¸ªï¼šç»‘å®šç»™å¯¹è±¡çš„æ–¹æ³•ï¼Œç»‘å®šç»™ç±»çš„æ–¹æ³•ï¼›ç»‘å®šç»™è°çš„æ–¹æ³•ï¼Œè°åœ¨è°ƒç”¨çš„æ—¶å€™å°±ä¸ç”¨ä¼ ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œæ¯”å¦‚è¯´selfå°±æ˜¯ç»‘å®šç»™å¯¹è±¡çš„æ–¹æ³•ï¼Œå®ä¾‹åŒ–å¯¹è±¡è°ƒç”¨çš„æ—¶å€™å°±ä¸ç”¨ä¼ ç¬¬ä¸€ä¸ªå‚ï¼Œclså°±æ˜¯ç»‘å®šç»™ç±»çš„æ–¹æ³•ï¼Œç±»ä½¿ç”¨çš„æ—¶å€™å°±ä¸éœ€è¦ä¼ ç¬¬ä¸€ä¸ªå‚</li><li>éç»‘å®šæ–¹æ³•ï¼šç±»å‹æ™®é€šå‡½æ•°ï¼Œè°éƒ½å¯ä»¥ä½¿ç”¨ï¼Œéµå¾ªæ™®é€šå‡½æ•°çš„ä¼ å‚ï¼Œç›®çš„åªæ˜¯ä¸ºäº†å°è£…åœ¨ä¸€èµ·ï¼Œå¦‚ï¼šé™æ€æ–¹æ³•ã€‚å°±æ˜¯è°éƒ½å¯ä»¥è°ƒç”¨ä¸”è°ƒç”¨çš„æ—¶å€™ä¸éœ€è¦ä¼ ç¬¬ä¸€ä¸ªå‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>():<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self,name,age</span>):<br>        self.name=name<br>        self.age=age<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">edit_name</span>(<span class="hljs-params">self,new_name</span>):<br>        self.name = new_name<br><span class="hljs-meta">    @classmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_student</span>(<span class="hljs-params">cls,name,age</span>):<br>        <span class="hljs-keyword">return</span> cls(name,age)  <span class="hljs-comment"># ç›¸å½“äºStudent(name,age)</span><br><span class="hljs-meta">    @staticmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a,b</span>):<br>        <span class="hljs-keyword">return</span> a+b  <span class="hljs-comment"># è¿™ä¸ªæ–¹æ³•æ²¡æœ‰ç”¨çš„ç±»çš„ä»»ä½•å±æ€§æ–¹æ³•ï¼Œæ˜¯ä¸€ä¸ªé™æ€æ–¹æ³•ï¼ŒåŠ è£…é¥°å™¨</span><br></code></pre></td></tr></table></figure><h2 id="4-4-ç±»è£…é¥°å™¨propertyã€äº†è§£ã€‘"><a href="#4-4-ç±»è£…é¥°å™¨propertyã€äº†è§£ã€‘" class="headerlink" title="4.4 ç±»è£…é¥°å™¨propertyã€äº†è§£ã€‘"></a>4.4 ç±»è£…é¥°å™¨propertyã€äº†è§£ã€‘</h2><p>pythonä¸­çš„propertyå°±æ˜¯ä¸€ä¸ªç±»è£…é¥°å™¨ï¼Œæœ‰ä¸¤ä¸ªç”¨é€”ï¼š</p><ul><li>ç”¨é€”ä¸€ï¼šå°†å‡½æ•°å±æ€§ä¼ªè£…æˆæ•°æ®å±æ€§</li><li>ç”¨é€”äºŒï¼šç»Ÿä¸€æ•°æ®å±æ€§çš„æŸ¥ã€æ”¹ã€åˆ é™¤æ“ä½œã€æŠŠæ•°æ®è½¬æˆå¯¹è±¡å»æ“ä½œã€‘</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ç”¨é€”ä¸€:</span><br><span class="hljs-comment"># ç±»ä¸­çš„æŸä¸ªæ•°æ®å€¼ï¼Œå…¶å®æ˜¯é€šè¿‡æ‹¿åˆ°ç±»ä¸­çš„æŸä¸ªå±æ€§ç„¶åè®¡ç®—å‡ºæ¥çš„å€¼ï¼Œ</span><br><span class="hljs-comment"># ä½†æ˜¯ç”¨æˆ·ä¸æƒ³é€šè¿‡ç±»çš„æ–¹æ³•å»æ‹¿åˆ°è¿™ä¸ªå€¼ï¼Œé‚£å°±åŠ ä¸Špropertyè£…é¥°å™¨ </span><br><span class="hljs-comment"># ç„¶åå°±å¯ä»¥é€šè¿‡ç±»ä¼¼äºå¯¹è±¡.å±æ€§å€¼çš„æ–¹å¼æ¥é€šè¿‡å¯¹è±¡.æ–¹æ³•åè¿™ç§æ–¹å¼æ‹¿åˆ°è¿™ä¸ªå€¼</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">People</span>():<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self,name,w,h</span>):<br>        self.__name=name<br>        self.w=w<br>        self.h=h<br>    <br><span class="hljs-meta">    @property</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">bmi</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> self.w / (self.h**<span class="hljs-number">2</span>)<br>obj1 = People(<span class="hljs-string">&#x27;jack&#x27;</span>ï¼Œ<span class="hljs-number">66</span>,<span class="hljs-number">1.75</span>)<br><span class="hljs-built_in">print</span>(obj1.bmi)<br><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ç”¨é€”äºŒï¼šåœ¨ä¿®æ”¹å’Œåˆ é™¤æ—¶åšé€»è¾‘åˆ¤æ–­</span><br><span class="hljs-comment"># å½“name é‡åˆ°æŸ¥è¯¢æ—¶ï¼Œè§¦å‘è¢«propertyè£…é¥°çš„å‡½æ•°çš„æ‰§è¡Œï¼Œ</span><br><span class="hljs-comment"># å½“name é‡åˆ°èµ‹å€¼æ“ä½œï¼Œå³ = æ—¶è§¦å‘è¢«property.setterè£…é¥°çš„å‡½æ•°çš„æ‰§è¡Œ</span><br><span class="hljs-comment"># å½“name é‡åˆ°åˆ é™¤æ“ä½œï¼Œå³ del  æ—¶è§¦å‘property.deleterè£…é¥°çš„å‡½æ•°çš„æ‰§è¡Œ</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Poeple</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, w, h</span>):<br>        self.__name = name<br>        self.w = w<br>        self.h = h<br><br><span class="hljs-meta">    @property</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">name</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> self.__name<br><br><span class="hljs-meta">    @name.setter </span><span class="hljs-comment"># ä¿®æ”¹å±æ€§çš„è£…é¥°å™¨ï¼Œå½“å‡ºå‘ä¿®æ”¹æ—¶ï¼Œå°±ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">name</span>(<span class="hljs-params">self, value</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">type</span>(value) <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">str</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;å¿…é¡»ä¼ å…¥strç±»å‹&#x27;</span>)<br>            <span class="hljs-keyword">return</span><br>        self.__name = value<br><br><span class="hljs-meta">    @name.deleter </span><span class="hljs-comment"># åˆ é™¤å±æ€§çš„è£…é¥°å™¨ï¼Œå½“delåˆ é™¤æŸä¸ªå±æ€§çš„æ—¶å€™ï¼Œè§¦å‘è¿™ä¸ªæ–¹æ³•</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">name</span>(<span class="hljs-params">self</span>): <br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;ä¸èƒ½åˆ &#x27;</span>)<br><br><br>obj1 = Poeple(<span class="hljs-string">&#x27;jack&#x27;</span>, <span class="hljs-number">66</span>, <span class="hljs-number">1.75</span>)<br><span class="hljs-built_in">print</span>(obj1.name)<br>obj1.name = <span class="hljs-string">&#x27;aaa&#x27;</span><br><span class="hljs-keyword">del</span> obj1.name<br></code></pre></td></tr></table></figure><h2 id="4-5-cached-propertyã€äº†è§£ã€‘"><a href="#4-5-cached-propertyã€äº†è§£ã€‘" class="headerlink" title="4.5 cached_propertyã€äº†è§£ã€‘"></a>4.5 cached_propertyã€äº†è§£ã€‘</h2><ul><li>å°†ä¸€ä¸ªç±»æ–¹æ³•è½¬æ¢ä¸ºç‰¹å¾å±æ€§ï¼Œä¸€æ¬¡æ€§è®¡ç®—è¯¥ç‰¹å¾å±æ€§çš„å€¼ï¼Œç„¶åå°†å…¶ç¼“å­˜ä¸ºå®ä¾‹ç”Ÿå‘½å‘¨æœŸå†…çš„æ™®é€šå±æ€§ã€‚</li><li>ç±»ä¼¼äºå¯¹ <code>property</code> ä½†å¢åŠ äº†ç¼“å­˜åŠŸèƒ½ã€‚å¯¹äºä¸å¯å˜çš„é«˜è®¡ç®—èµ„æºæ¶ˆè€—çš„å®ä¾‹ç‰¹å¾å±æ€§æ¥è¯´è¯¥å‡½æ•°éå¸¸æœ‰ç”¨</li><li>å†…ç½®åŒ…functoolsä¸‹é¢çš„ç±»è£…é¥°å™¨cached_property</li></ul><p><em><code>cached_property</code> æ˜¯ä¸€ä¸ª Python è£…é¥°å™¨ï¼Œå®ƒå¯ä»¥ç”¨äºå®šä¹‰ä¸€ä¸ªç¼“å­˜çš„å±æ€§ï¼Œè¿™æ„å‘³ç€å±æ€§çš„å€¼åœ¨ç¬¬ä¸€æ¬¡è®¿é—®åä¼šè¢«è®¡ç®—ï¼Œå¹¶å°†ç»“æœç¼“å­˜èµ·æ¥ï¼Œåç»­çš„è®¿é—®ä¼šç›´æ¥è¿”å›ç¼“å­˜çš„å€¼ï¼Œä»è€Œé¿å…é‡å¤è®¡ç®—ã€‚</em></p><p><em><code>cached_property</code> è£…é¥°å™¨å¯ä»¥åœ¨éœ€è¦è®¡ç®—ä»£ä»·è¾ƒé«˜çš„å±æ€§æ—¶ä½¿ç”¨ï¼Œä»¥æé«˜æ€§èƒ½å’Œæ•ˆç‡ã€‚</em></p><p><em>åœ¨ä½¿ç”¨ <code>cached_property</code> è£…é¥°å™¨ä¹‹å‰ï¼Œä½ éœ€è¦å…ˆå®‰è£…ä¸€ä¸ªåä¸º <code>cached-property</code> çš„ç¬¬ä¸‰æ–¹åº“ï¼Œå®ƒæä¾›äº†è¿™ä¸ªè£…é¥°å™¨çš„å®ç°ã€‚</em></p><p><em>è¿™ä¸ªç”¨çš„å°‘</em></p><h2 id="4-6-å±æ€§æŸ¥æ‰¾é¡ºåºã€äº†è§£ã€‘"><a href="#4-6-å±æ€§æŸ¥æ‰¾é¡ºåºã€äº†è§£ã€‘" class="headerlink" title="4.6 å±æ€§æŸ¥æ‰¾é¡ºåºã€äº†è§£ã€‘"></a>4.6 å±æ€§æŸ¥æ‰¾é¡ºåºã€äº†è§£ã€‘</h2><p>å±æ€§æˆ–è€…æ–¹æ³•çš„æŸ¥æ‰¾é¡ºåºçš„åŸåˆ™</p><ul><li>å…ˆä»<strong>å¯¹è±¡</strong>è‡ªèº«èº«ä¸Šæ‰¾ï¼Œæœ‰åˆ™ä½¿ç”¨ï¼›æ²¡æœ‰çš„è¯ï¼Œå†ä»<strong>ç±»</strong>ä¸Šæ‰¾ï¼Œæœ‰åˆ™ä½¿ç”¨ï¼›ç±»ä¸Šä¹Ÿæ²¡æœ‰çš„è¯å°±æŠ¥é”™åˆ™æŠ¥é”™AttributeError</li></ul><p>ç¤ºä¾‹1ï¼šæŸ¥çœ‹å¯¹è±¡æˆ–ç±»æœ‰å“ªäº›å±æ€§æˆ–æ–¹æ³•å¯ä»¥ä½¿ç”¨ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>:<br>    school = <span class="hljs-string">&#x27;PKU&#x27;</span><span class="hljs-comment"># ç±»å±æ€§</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age, gender</span>):<br>        self.name = name<br>        self.age = age<br>        self.gender = gender<br>        self.course = <span class="hljs-literal">None</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_info</span>(<span class="hljs-params">self</span>):<span class="hljs-comment"># ç»‘å®šç»™å¯¹è±¡çš„æ–¹æ³•</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;å­¦ç”Ÿä¿¡æ¯ï¼šåå­—ï¼š%s å¹´é¾„ï¼š%s æ€§åˆ«ï¼š%s&#x27;</span> % (<br>            self.name,<br>            self.age,<br>            self.gender<br>        ))<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">select_course</span>(<span class="hljs-params">self, new_class</span>):<span class="hljs-comment"># ç»‘å®šç»™å¯¹è±¡çš„æ–¹æ³•</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;æ­£åœ¨é€‰è¯¾&#x27;</span>)<br>        self.course = new_class<br><br><br><span class="hljs-built_in">print</span>(Student.__dict__)<span class="hljs-comment"># æŸ¥çœ‹ç±»ä¸‹çš„å±æ€§å’Œæ–¹æ³•</span><br><span class="hljs-built_in">print</span>(Student.school)<span class="hljs-comment"># .çš„æ–¹å¼è®¿é—®ç±»å±æ€§/æ–¹æ³•ã€‚æœ¬è´¨æ˜¯ Student.__dict__[&quot;school&quot;]</span><br><span class="hljs-built_in">print</span>(Student.get_info)<br><span class="hljs-built_in">print</span>(Student.__dict__[<span class="hljs-string">&quot;school&quot;</span>]) <span class="hljs-comment"># è®¿é—®ç±»å±æ€§/æ–¹æ³•</span><br><span class="hljs-built_in">print</span>(Student.__dict__[<span class="hljs-string">&quot;get_info&quot;</span>])<br><br><br>stu1 = Student(<span class="hljs-string">&quot;jack&quot;</span>, <span class="hljs-number">18</span>, <span class="hljs-string">&quot;ç”·&quot;</span>)<br><span class="hljs-built_in">print</span>(stu1.name)<br><span class="hljs-built_in">print</span>(stu1.get_info)<br><span class="hljs-built_in">print</span>(stu1.__dict__)<span class="hljs-comment">#  è®¿é—®å¯¹è±¡çš„å±æ€§</span><br>stu1.haha = <span class="hljs-string">&quot;123&quot;</span>    <span class="hljs-comment"># å¢åŠ ä¸€ä¸ªæ•°æ®å±æ€§</span><br>stu1.add = <span class="hljs-keyword">lambda</span> x: <span class="hljs-built_in">print</span>(x) <span class="hljs-comment"># å¢åŠ ä¸€ä¸ªæ™®é€šå‡½æ•°å±æ€§ï¼Œä¸æ˜¯å¯¹è±¡çš„ç»‘å®šæ–¹æ³•å“¦</span><br></code></pre></td></tr></table></figure><h2 id="4-7-éšè—å±æ€§ã€æœ‰ç”¨ã€‘"><a href="#4-7-éšè—å±æ€§ã€æœ‰ç”¨ã€‘" class="headerlink" title="4.7 éšè—å±æ€§ã€æœ‰ç”¨ã€‘"></a>4.7 éšè—å±æ€§ã€æœ‰ç”¨ã€‘</h2><ul><li>å¦‚æœç±»çš„è®¾è®¡è€…ä¸æƒ³æŸäº›å±æ€§è¢«è®¿é—®ï¼Œå°±å¯ä»¥å°†è¯¥å±æ€§ç»™éšè—èµ·æ¥ã€‚</li><li>éšè—å±æ€§å¯ä»¥éšè—ç±»ä¸­çš„å…¬æœ‰å±æ€§å’Œå¯¹è±¡çš„ç§æœ‰å±æ€§ï¼Œå¯¹è±¡è®¿é—®ä¼šæŠ¥é”™ï¼Œ</li><li>å®ç°æ–¹æ³•ï¼šä½¿ç”¨åŒä¸‹åˆ’çº¿å¼€å¤´å‘½åçš„å±æ€§å°†ä¼šè¢«éšè—</li><li>å¦ï¼šå•ä¸‹åˆ’çº¿å¼€å¤´çš„å±æ€§å’Œæ–¹æ³•ç±»ä¼¼äºä¿æŠ¤å±æ€§ï¼Œç±»å†…å¯ä»¥è®¿é—®ï¼Œç±»å¤–ä¹Ÿå¯ä»¥è®¿é—®ä½†ä¸ä¼šæç¤º</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        self.public_attr = <span class="hljs-number">42</span><br>        self._protected_attr = <span class="hljs-number">23</span><br>        self.__private_attr = <span class="hljs-string">&quot;secret&quot;</span><br><br>obj = MyClass()<br><br><span class="hljs-built_in">print</span>(obj.public_attr)  <span class="hljs-comment"># å¯ä»¥ç›´æ¥è®¿é—®</span><br><span class="hljs-built_in">print</span>(obj._protected_attr)  <span class="hljs-comment"># å¯ä»¥ç›´æ¥è®¿é—®ï¼Œä½†æ˜¯è§†ä¸ºå—ä¿æŠ¤</span><br><span class="hljs-comment"># print(obj.__private_attr)  # ä¸èƒ½ç›´æ¥è®¿é—®ï¼Œä¼šæŠ¥é”™</span><br><br><span class="hljs-built_in">print</span>(obj._MyClass__private_attr)  <span class="hljs-comment"># ä½¿ç”¨åç§°ä¿®é¥°çš„æ–¹å¼è®¿é—®ç§æœ‰å±æ€§</span><br><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹2ï¼šåœ¨ç±»å¤–éƒ¨æ— æ³•ç›´æ¥è®¿é—®åŒä¸‹æ»‘çº¿å¼€å¤´çš„å±æ€§ï¼Œåœ¨ç±»å†…éƒ¨å¯ä»¥è®¿é—®åˆ°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Foo</span>:<br>    ...<br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__f1</span>(<span class="hljs-params">self</span>):     <span class="hljs-comment"># éšè—å¯¹è±¡çš„ç§æœ‰ç»‘å®šå‡½æ•°</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;from test&#x27;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">f2</span>(<span class="hljs-params">self</span>):       <span class="hljs-comment"># f2æ²¡æœ‰è¢«éšè—ï¼Œå¯ä»¥è¢«è®¿é—®åˆ°</span><br>        <span class="hljs-built_in">print</span>(self.age)<br>        <span class="hljs-built_in">print</span>(self.__name)<br>        self.__f1()<br><br>        <br>obj = Foo(<span class="hljs-string">&#x27;jack&#x27;</span>, <span class="hljs-number">18</span>)<br>obj.f2()<span class="hljs-comment"># ä¸ä¼šæŠ¥é”™ï¼Œå¯ä»¥è®¿é—® __name, __f1</span><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹3ï¼šåœ¨ç±»å®šä¹‰é˜¶æ®µï¼ŒåŒä¸‹åˆ’å…ˆå¼€å¤´çš„å±æ€§ä¼šå‘ç”Ÿå˜å½¢</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># åœ¨ç±»å®šä¹‰é˜¶æ®µï¼ŒåŒä¸‹åˆ’å…ˆå¼€å¤´çš„å±æ€§ä¼šå‘ç”Ÿå˜å½¢ï¼Œå˜ä¸º _Foo__x, _Foo__f1, _Foo__name, æ‰€ä»¥åœ¨åœ¨ç±»å¤–æ— æ³•ç›´æ¥é€šè¿‡è¿‡ .__x çš„æ–¹å¼è®¿é—®ã€‚</span><br><span class="hljs-comment"># ä½†æ˜¯å¯ä»¥é€šè¿‡å˜å½¢åçš„ _Foo__xè®¿é—®ã€‚ä½†è¿™æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚</span><br><span class="hljs-comment"># æ‰€ä»¥è¯´è¿™ç§æ“ä½œå¹¶æ²¡æœ‰ä¸¥æ ¼æ„ä¹‰ä¸Šåœ°é™åˆ¶å¤–éƒ¨è®¿é—®ï¼Œä»…ä»…åªæ˜¯ä¸€ç§è¯­æ³•æ„ä¹‰ä¸Šçš„å˜å½¢ã€‚</span><br><span class="hljs-comment"># ç±»ä¼¼çš„ï¼Œpythonä¸­å¼€å‘äººå‘˜ä¸€èˆ¬é€šè¿‡çº¦å®šçš„æ–¹å¼ï¼Œä»»åŠ¡_å¼€å¤´çš„å˜é‡æ˜¯å†…éƒ¨ä½¿ç”¨çš„å˜é‡ï¼Œ__å¼€å¤´çš„å˜é‡æ˜¯è¢«ä¿æŠ¤çš„å˜é‡ã€‚</span><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹4ï¼šåªåœ¨å®šä¹‰é˜¶æ®µå‘ç”Ÿå½¢å˜</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ä¹‹æ‰€ä»¥åœ¨ç±»å†…éƒ¨å¯ä»¥ç›´æ¥é€šè¿‡__x è®¿é—®ï¼Œæ˜¯å› ä¸º__å¼€å¤´çš„å±æ€§ä¼šåœ¨æ£€æŸ¥ç±»ä½“ä»£ç è¯­æ³•æ—¶ç»Ÿä¸€å‘ç”Ÿå˜å½¢ï¼ˆç±»å®šä¹‰é˜¶æ®µï¼‰</span><br><span class="hljs-comment"># è¿™ç§å˜å½¢æ“ä½œåªåœ¨æ£€æŸ¥ç±»ä½“è¯­æ³•çš„æ—¶å€™å‘ç”Ÿä¸€æ¬¡ï¼Œä¹‹åå†å®šä¹‰çš„__å¼€å¤´çš„å±æ€§éƒ½ä¸ä¼šå˜å½¢ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥__yè®¿é—®åˆ°</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Foo</span>:<br>    __x = <span class="hljs-number">1</span>             <span class="hljs-comment"># éšè—ç±»çš„å…¬æœ‰æ•°æ®å±æ€§</span><br>    ...<br><br><br>Foo.__y = <span class="hljs-number">2</span><span class="hljs-comment"># å¢åŠ ç±»Fooçš„æ•°æ®å±æ€§</span><br><span class="hljs-built_in">print</span>(Foo.__y)<span class="hljs-comment"># å¯ä»¥è®¿é—®åˆ°</span><br></code></pre></td></tr></table></figure><h2 id="4-8-å¼€å‘æ¥å£ã€äº†è§£ã€‘"><a href="#4-8-å¼€å‘æ¥å£ã€äº†è§£ã€‘" class="headerlink" title="4.8 å¼€å‘æ¥å£ã€äº†è§£ã€‘"></a>4.8 å¼€å‘æ¥å£ã€äº†è§£ã€‘</h2><ul><li>å®šä¹‰å±æ€§çš„ç›®çš„æ˜¯ä¸ºäº†è¢«ä½¿ç”¨ï¼Œæ‰€ä»¥éšè—å±æ€§çš„ç›®çš„ä¸æ˜¯å•çº¯çš„éšè—ï¼Œéšè—å¼ä¸ºäº†æ›´å¥½çš„ä½¿ç”¨ã€‚</li><li>æƒ³è¦è¿™äº›å±æ€§è¢«ä½¿ç”¨ï¼Œé‚£å°±å¿…é¡»æä¾›ä¸€ä¸ªå¯¹å¤–çš„æ¥å£ï¼Œï¼ˆæ²¡æœ‰è¢«éšè—çš„å±æ€§ï¼‰</li><li>éšè—æ•°æ®å±æ€§ï¼š<strong>å°†æ•°æ®éšè—èµ·æ¥å°±é™åˆ¶äº†ç±»å¤–éƒ¨å¯¹ç±»å†…æ•°æ®çš„ç›´æ¥æ“ä½œï¼Œç„¶åç±»å†…åº”è¯¥æä¾›ç›¸åº”çš„æ¥å£ï¼ˆå‡½æ•°æ–¹æ³•ï¼‰æ¥å…è®¸å¤–éƒ¨é—´æ¥çš„æ“ä½œæ•°æ®ï¼Œæ¥å£ä¹‹ä¸Šå‘¢å¯ä»¥é™„åŠ é¢å¤–çš„é€»è¾‘æ¥å¯¹æ•°æ®çš„æ“ä½œè¿›è¡Œä¸¥æ ¼çš„åˆ¤æ–­ï¼Œæ¯”å¦‚è¯´åŠ ä¸Šå„ç§ if å•Šï¼Œå¦‚æœä¸ç¬¦åˆå°±raiseæŠ›å‡ºå¼‚å¸¸</strong></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>:<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name</span>):<br>        self.__name = name<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_name</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(self.__name)  <span class="hljs-comment"># é€šè¿‡è¯¥æ¥å£å°±å¯ä»¥é—´æ¥åœ°è®¿é—®åˆ°åå­—å±æ€§</span><br>    <br><span class="hljs-meta">    @property</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">name</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> self.__name<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">set_name</span>(<span class="hljs-params">self, new_name</span>):<br>        <span class="hljs-comment"># é€šè¿‡æ”¹æ¥å£åˆ¤æ–­ç”¨æˆ·ä¿®æ”¹çš„æ–°åå­—æ˜¯å¦åˆæ³•ï¼›éæ³•åˆ™ä¿®æ”¹ï¼Œä¸åˆæ³•å°±ä¸ä¿®æ”¹</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">type</span>(new_name) <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">str</span>:<br>            <span class="hljs-keyword">raise</span> TypeError(<span class="hljs-string">&quot;åå­—å¿…é¡»æ˜¯å­—ç¬¦ä¸²ç±»å‹&quot;</span>)<br>        self.__name = new_name<br><br><br>stu = Student(<span class="hljs-string">&quot;jack&quot;</span>)<br>stu.set_name(<span class="hljs-string">&quot;111&quot;</span>)<br>stu.get_name()<br><span class="hljs-built_in">print</span>(stu.name)<br></code></pre></td></tr></table></figure><h2 id="4-9-pythonå¤šç»§æ‰¿ã€æ¦‚å¿µã€‘"><a href="#4-9-pythonå¤šç»§æ‰¿ã€æ¦‚å¿µã€‘" class="headerlink" title="4.9 pythonå¤šç»§æ‰¿ã€æ¦‚å¿µã€‘"></a>4.9 pythonå¤šç»§æ‰¿ã€æ¦‚å¿µã€‘</h2><ul><li>ç»§æ‰¿æ˜¯é¢å‘å¯¹è±¡æ€æƒ³çš„å¦ä¸€ä¸ªç‰¹æ€§ã€‚å®ƒçš„å­˜åœ¨æ˜¯ä¸ºäº†è§£å†³ç±»ä¸ç±»ä¹‹é—´ä»£ç é‡å¤çš„é—®é¢˜ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ä¸ä½¿ç”¨ç»§æ‰¿</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>:<br>    school = <span class="hljs-string">&#x27;PKU&#x27;</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age, sex</span>):<br>        self.name = name<br>        self.age = age<br>        self.sex = sex<br>      <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">select_course</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;å­¦ç”Ÿï¼š<span class="hljs-subst">&#123;self.name&#125;</span>æ­£åœ¨é€‰è¯¾ã€‚ã€‚ã€‚&#x27;</span>)<br><br>        <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Teacher</span>:<br>    school = <span class="hljs-string">&#x27;PKU&#x27;</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age, sex, level</span>):<br>        self.name = name<br>        self.age = age<br>        self.sex = sex<br>        self.level = level<br>    <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">score</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;è€å¸ˆï¼š<span class="hljs-subst">&#123;self.name&#125;</span>æ­£åœ¨æ‰“åˆ†ã€‚ã€‚ã€‚&#x27;</span>)<br>    <br>    <br><span class="hljs-comment"># ä¸ä½¿ç”¨ç»§æ‰¿</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PkuPeople</span>:<br>    school = <span class="hljs-string">&#x27;PKU&#x27;</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age, sex</span>):<br>        self.name = name<br>        self.age = age<br>        self.sex = sex<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>(<span class="hljs-title class_ inherited__">PkuPeople</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">select_course</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;å­¦ç”Ÿï¼š<span class="hljs-subst">&#123;self.name&#125;</span>æ­£åœ¨é€‰è¯¾ã€‚ã€‚ã€‚&#x27;</span>)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Teacher</span>(<span class="hljs-title class_ inherited__">PkuPeople</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age, sex, level</span>):<br>        <span class="hljs-built_in">super</span>().__init__(name, age, sex)<br>        self.level = level<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">score</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;è€å¸ˆï¼š<span class="hljs-subst">&#123;self.name&#125;</span>æ­£åœ¨æ‰“åˆ†ã€‚ã€‚ã€‚&#x27;</span>)<br></code></pre></td></tr></table></figure><ul><li><p>å¤šç»§æ‰¿çš„ä¼˜ç‚¹ï¼šåŒæ—¶ç»§æ‰¿å¤šä¸ªçˆ¶ç±»å±æ€§å’Œæ–¹æ³•ï¼ŒåŠŸèƒ½å¼ºå¤§ã€‚</p></li><li><p>å¤šç»§æ‰¿ç¼ºç‚¹ï¼šä»£ç å¯è¯»æ€§å˜å·®ã€‚</p></li><li><p>é€šè¿‡ç±»çš„mro()æ–¹æ³•æŸ¥çœ‹å¤šç»§æ‰¿çš„æŸ¥æ‰¾é¡ºåºã€‚</p></li></ul><h2 id="4-10-æ·±åº¦ä¼˜å…ˆå’Œå¹¿åº¦ä¼˜å…ˆã€çŸ¥é“å°±è¡Œã€‘"><a href="#4-10-æ·±åº¦ä¼˜å…ˆå’Œå¹¿åº¦ä¼˜å…ˆã€çŸ¥é“å°±è¡Œã€‘" class="headerlink" title="4.10 æ·±åº¦ä¼˜å…ˆå’Œå¹¿åº¦ä¼˜å…ˆã€çŸ¥é“å°±è¡Œã€‘"></a>4.10 æ·±åº¦ä¼˜å…ˆå’Œå¹¿åº¦ä¼˜å…ˆã€çŸ¥é“å°±è¡Œã€‘</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># python2ä¸­åŒºåˆ†ç»å…¸ç±»å’Œæ–°å¼ç±»ï¼š</span><br>- ç»å…¸ç±»ï¼šæ²¡æœ‰ç»§æ‰¿<span class="hljs-built_in">object</span>ç±»çš„å­ç±»ï¼Œä»¥åŠè¯¥å­ç±»çš„å­ç±»å­å­ç±»ã€‚ã€‚ã€‚<br>- æ–°å¼ç±»ï¼šç»§æ‰¿äº†<span class="hljs-built_in">object</span>ç±»çš„å­ç±»ï¼Œä»¥åŠè¯¥å­ç±»çš„å­ç±»å­å­ç±»ã€‚ã€‚ã€‚<br>    <br><span class="hljs-comment"># python3ä¸­å…¨éƒ¨é»˜è®¤ç»§æ‰¿objectï¼Œæ‰€ä»¥éƒ½æ˜¯æ–°å¼ç±»ã€‚</span><br>- <span class="hljs-built_in">object</span>ç±»æä¾›äº†ä¸€äº›å¸¸ç”¨å†…ç½®æ–¹æ³•çš„å®ç°ï¼Œå¦‚ç”¨æ¥åœ¨æ‰“å°å¯¹è±¡æ—¶è¿”å›å­—ç¬¦ä¸²çš„å†…ç½®æ–¹æ³•__str__<br>    - é€šè¿‡ç±»çš„å†…ç½®å±æ€§__bases__å¯ä»¥æŸ¥çœ‹ç±»ç»§æ‰¿çš„æ‰€æœ‰çˆ¶ç±»<br>    <br>    <br></code></pre></td></tr></table></figure><ul><li><p>ç»§æ‰¿çš„è±å½¢ç»“æ„</p></li><li><p>æ¦‚å¿µä¸€ï¼šç»å…¸ç±»å’Œæ–°å¼ç±»</p></li><li><p>æ¦‚å¿µäºŒï¼šæ·±åº¦ä¼˜å…ˆå’Œå¹¿åº¦ä¼˜å…ˆ</p></li></ul><p><img src="/img/python/image-20220508171910552.png" alt="image-20220508171910552"></p><p>å¦‚ä¸Šå›¾ï¼Œç»§æ‰¿å…³ç³»æˆè±å½¢</p><h2 id="4-11-Mixinæ··åˆæœºåˆ¶ã€æœ‰ç‚¹ç”¨ã€‘"><a href="#4-11-Mixinæ··åˆæœºåˆ¶ã€æœ‰ç‚¹ç”¨ã€‘" class="headerlink" title="4.11 Mixinæ··åˆæœºåˆ¶ã€æœ‰ç‚¹ç”¨ã€‘"></a>4.11 Mixinæ··åˆæœºåˆ¶ã€æœ‰ç‚¹ç”¨ã€‘</h2><ul><li>å…è®¸å°†æŸä¸ªå•ä¸€åŠŸèƒ½å°è£…åœ¨ç‹¬ç«‹çš„ç±»ä¸­ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªç±»å¤šé‡ç»§æ‰¿è¿™äº›åŠŸèƒ½ç±»ï¼Œæ··åˆåœ¨ä¸€èµ·ï¼Œå®ç°ä»£ç çš„å¤ç”¨å’Œæ¨¡å—åŒ–</li><li>å•ä¸€èŒè´£ï¼Œä¸€ä¸ªç±»åªå…³æ³¨å•ä¸€åŠŸèƒ½</li><li>å¤šé‡ç»„åˆï¼Œé€šè¿‡å¤šç»§æ‰¿å°†å¤šç±»æ··åˆåœ¨ä¸€èµ·</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Mixin ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">LoggingMixin</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">log</span>(<span class="hljs-params">self, message</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Log: <span class="hljs-subst">&#123;message&#125;</span>&quot;</span>)<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">EmailMixin</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">send_email</span>(<span class="hljs-params">self, subject, body</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Sending email to <span class="hljs-subst">&#123;self.email&#125;</span>: <span class="hljs-subst">&#123;subject&#125;</span>, <span class="hljs-subst">&#123;body&#125;</span>&quot;</span>)<br><br><span class="hljs-comment"># å…·æœ‰ LoggingMixin å’Œ EmailMixin åŠŸèƒ½çš„ç±»</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(LoggingMixin, EmailMixin):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, username, email</span>):<br>        self.username = username<br>        self.email = email<br><br><span class="hljs-comment"># åˆ›å»º User å¯¹è±¡å¹¶ä½¿ç”¨ Mixin åŠŸèƒ½</span><br>user = User(<span class="hljs-string">&quot;alice&quot;</span>, <span class="hljs-string">&quot;alice@example.com&quot;</span>)<br>user.log(<span class="hljs-string">&quot;User created&quot;</span>)<br>user.send_email(<span class="hljs-string">&quot;Welcome&quot;</span>, <span class="hljs-string">&quot;Welcome to our website!&quot;</span>)<br><br></code></pre></td></tr></table></figure><ul><li>Mixinä¸æ˜¯å•ä¸€åŠŸèƒ½ï¼Œåªæ˜¯ä¸€ç§ç¼–ç¨‹æ€ç»´ï¼Œé€šå¸¸è¢«å®šä¹‰ä¸ºæ··åˆçš„ç±»ï¼Œç±»ååœ¨å‘½åçš„æ—¶å€™éƒ½ä¼šåœ¨åé¢åŠ ä¸€ä¸ªMinxinæ¥è¡¨ç¤ºè¿™ä¸ªç±»æ˜¯æ··åˆç±»</li></ul><p>Minxä½¿ç”¨è§„èŒƒ</p><ul><li>é¦–å…ˆå®ƒå¿…é¡»è¡¨ç¤ºæŸä¸€ç§åŠŸèƒ½ï¼Œè€Œä¸æ˜¯æŸä¸ªç‰©å“ï¼Œpython å¯¹äºmixinç±»çš„å‘½åæ–¹å¼ä¸€èˆ¬ä»¥ Mixin, able, ible ä¸ºåç¼€ã€‚</li><li>å…¶æ¬¡å®ƒå¿…é¡»è´£ä»»å•ä¸€ï¼Œå¦‚æœæœ‰å¤šä¸ªåŠŸèƒ½ï¼Œé‚£å°±å†™å¤šä¸ªMixinç±»ï¼Œä¸€ä¸ªç±»å¯ä»¥ç»§æ‰¿å¤šä¸ªMixinã€‚</li><li>å®ƒä¸ä¾èµ–äºå­ç±»çš„å®ç°ï¼›å­ç±»å³ä¾¿æ²¡æœ‰ç»§æ‰¿è¿™ä¸ªMixinç±»ï¼Œä¹Ÿç…§æ ·å¯ä»¥å·¥ä½œï¼Œå°±æ˜¯ç¼ºå°‘äº†æŸä¸ªåŠŸèƒ½ã€‚</li><li>é€šå¸¸Mixinçš„ç±»æ”¾åœ¨å­ç±»æ‹¬å·å†…çš„å³è¾¹ï¼ˆè¡¨ç¤ºéæ ¸å¿ƒåŠŸèƒ½ï¼‰</li></ul><h2 id="4-12-æ´¾ç”Ÿå’Œç»„åˆ"><a href="#4-12-æ´¾ç”Ÿå’Œç»„åˆ" class="headerlink" title="4.12 æ´¾ç”Ÿå’Œç»„åˆ"></a>4.12 æ´¾ç”Ÿå’Œç»„åˆ</h2><p>æ´¾ç”Ÿï¼šåœ¨ä½¿ç”¨çˆ¶ç±»åŸæœ‰çš„æ–¹æ³•çš„åŸºç¡€ä¸Šï¼Œå¢åŠ æ–°çš„å†…å®¹ï¼ˆç”¨super( )æ–¹æ³•é‡å†™çˆ¶ç±»æ–¹æ³•ï¼‰</p><p>å­ç±»å¯ä»¥åŸå°ä¸åŠ¨çš„ä½¿ç”¨çˆ¶ç±»çš„å±æ€§&#x2F;æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥é‡å†™çˆ¶ç±»çš„å±æ€§&#x2F;æ–¹æ³•ï¼Œè¿˜å¯ä»¥åœ¨ä½¿ç”¨çˆ¶ç±»çš„å±æ€§&#x2F;æ–¹æ³•çš„åŒæ—¶ï¼Œæ·»åŠ æ–°çš„å†…å®¹ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æ–¹å¼1ï¼šä½¿ç”¨åªç”¨çˆ¶ç±»çš„æ–¹æ³•ï¼Œéœ€è¦ä¼ selfå‚æ•°ã€‚</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">People</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age, gender</span>):<br>        self.name = name<br>        self.age = age<br>        self.gender = gender<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>(<span class="hljs-title class_ inherited__">People</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age, gender, code</span>):<br>        People.__init__(self, name, age, gender)<br>        self.code = code<br><br><br>stu = Student(<span class="hljs-string">&quot;jack&quot;</span>, <span class="hljs-number">18</span>, <span class="hljs-string">&quot;ç”·&quot;</span>, <span class="hljs-number">10111</span>)<br><span class="hljs-built_in">print</span>(stu.__dict__)<br><br><br><span class="hljs-comment"># æ–¹å¼2ï¼šä½¿ç”¨super(), æŒ‰ç…§MORåˆ—è¡¨çš„é¡ºåºå¾€ä¸‹æ‰¾</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>(<span class="hljs-title class_ inherited__">People</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name, age, gender, code</span>):<br>        <span class="hljs-built_in">super</span>().__init__(name, age, gender)  <span class="hljs-comment"># ç”¨super()é‡å†™äº†çˆ¶ç±»å±æ€§</span><br>        self.code = code<br></code></pre></td></tr></table></figure><ul><li>ç»„åˆï¼šå¯¹è±¡çš„æŸä¸ªå±æ€§ï¼Œæ˜¯å¦ä¸€ä¸ªç±»çš„å®ä¾‹åŒ–å¯¹è±¡</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">name, age</span>):<br>        self.name = name<br>        self.age = age<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Coursr</span>:<br>    <span class="hljs-keyword">pass</span><br><br>stu = Student(<span class="hljs-string">&#x27;jack&#x27;</span>, <span class="hljs-number">18</span>)<br>course_obj = Course()<br>stu.course = course_obj<br><br><span class="hljs-comment"># ç»§æ‰¿æ˜¯ä¸€ç§â€œæ˜¯â€çš„å…³ç³»ï¼Œæ¯”å¦‚è€å¸ˆæ˜¯äººã€å­¦ç”Ÿæ˜¯äººã€‚</span><br><span class="hljs-comment"># ç»„åˆåˆ™æ˜¯ä¸€ç§â€œæœ‰â€çš„å…³ç³»ï¼Œæ¯”å¦‚è€å¸ˆæœ‰ç”Ÿæ—¥ï¼Œè€å¸ˆæœ‰å¤šé—¨è¯¾ç¨‹ã€‚</span><br></code></pre></td></tr></table></figure><h2 id="4-13-é™åˆ¶å­ç±»å¿…é¡»å®ç°çš„æ–¹æ³•ã€é‡ç‚¹ã€‘ã€æŠ½è±¡æ¦‚å¿µã€‘â€“è®¾è®¡æ¨¡å¼çš„ä¸€ç§"><a href="#4-13-é™åˆ¶å­ç±»å¿…é¡»å®ç°çš„æ–¹æ³•ã€é‡ç‚¹ã€‘ã€æŠ½è±¡æ¦‚å¿µã€‘â€“è®¾è®¡æ¨¡å¼çš„ä¸€ç§" class="headerlink" title="4.13 é™åˆ¶å­ç±»å¿…é¡»å®ç°çš„æ–¹æ³•ã€é‡ç‚¹ã€‘ã€æŠ½è±¡æ¦‚å¿µã€‘â€“è®¾è®¡æ¨¡å¼çš„ä¸€ç§"></a>4.13 é™åˆ¶å­ç±»å¿…é¡»å®ç°çš„æ–¹æ³•ã€é‡ç‚¹ã€‘ã€æŠ½è±¡æ¦‚å¿µã€‘â€“è®¾è®¡æ¨¡å¼çš„ä¸€ç§</h2><p>åœ¨çˆ¶ç±»ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œéœ€è¦å­ç±»å¿…é¡»å®ç°ï¼Œæ­¤æ—¶å°±æœ‰ä¸¤ç§é™åˆ¶æ–¹æ³•</p><p>æ–¹å¼1ï¼šä½¿ç”¨æ¨¡å—abcï¼Œï¼ˆå³æŠ½è±¡ç±»abstract classçš„ç¼©å†™ï¼‰</p><p>å°±æ˜¯åŠ abçš„è£…é¥°å™¨çš„æ–¹æ³•ï¼Œç„¶åä½ åœ¨ç»§æ‰¿çš„æ—¶å€™ï¼Œå¿…é¡»å»å®šä¹‰è¿™ä¸ªæ–¹æ³•ï¼Œä¸ç„¶å®ä¾‹åŒ–çš„æ—¶å€™å°±ä¼šå‡ºé”™</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> abc<br><span class="hljs-keyword">import</span> abc<br><br><span class="hljs-comment"># æŒ‡å®šmetaclasså±æ€§å°†ç±»è®¾ç½®ä¸ºæŠ½è±¡ç±»ï¼ŒæŠ½è±¡ç±»æœ¬èº«åªæ˜¯ç”¨æ¥çº¦æŸå­ç±»çš„ï¼ŒæŠ½è±¡ç±»æœ¬èº«ä¸èƒ½è¢«å®ä¾‹åŒ–</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span>(metaclass=abc.ABCMeta):<br><span class="hljs-meta">    @abc.abstractmethod </span><span class="hljs-comment"># è¯¥è£…é¥°å™¨é™åˆ¶å­ç±»å¿…é¡»å®šä¹‰æœ‰ä¸€ä¸ªåä¸ºtalkçš„æ–¹æ³•</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">talk</span>(<span class="hljs-params">self</span>): <span class="hljs-comment"># æŠ½è±¡æ–¹æ³•ä¸­æ— éœ€å®ç°å…·ä½“çš„åŠŸèƒ½</span><br>        <span class="hljs-keyword">pass</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Cat</span>(<span class="hljs-title class_ inherited__">Animal</span>):<span class="hljs-comment"># ä½†å‡¡ç»§æ‰¿Animalçš„å­ç±»éƒ½å¿…é¡»éµå¾ªAnimalè§„å®šçš„æ ‡å‡†</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">talk</span>(<span class="hljs-params">self</span>):<span class="hljs-comment"># å¿…é¡»å®šä¹‰talkæ–¹æ³•</span><br>        <span class="hljs-keyword">pass</span><br><br>cat=Cat() <span class="hljs-comment"># è‹¥å­ç±»ä¸­æ²¡æœ‰ä¸€ä¸ªå®šä¹‰talkçš„æ–¹æ³•åˆ™ä¼šæŠ›å‡ºå¼‚å¸¸TypeErrorï¼Œæ— æ³•å®ä¾‹åŒ–</span><br></code></pre></td></tr></table></figure><p>æ–¹å¼2ï¼šä½¿ç”¨ <code>NotImplementedError</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">talk</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">raise</span> NotImplementedError(<span class="hljs-string">&quot;è¯¥æ–¹æ³•å¿…é¡»è¢«å®ç°&quot;</span>)<br>        <br><span class="hljs-comment"># å¦‚æœå­ç±»æ²¡æœ‰å®ç°talkæ–¹æ³•ï¼Œå­ç±»è°ƒç”¨talkæ—¶å€™ä½¿ç”¨çˆ¶ç±»çš„talk,æ­¤æ—¶ç›´æ¥æŠ›å‡ºå¼‚å¸¸ NotImplementedError</span><br></code></pre></td></tr></table></figure><h2 id="4-14-isinstance"><a href="#4-14-isinstance" class="headerlink" title="4.14 isinstance"></a>4.14 isinstance</h2><p>å½“æˆ‘ä»¬éœ€è¦è·å–ä¸€ä¸ªå¯¹è±¡çš„ç±»å‹æ˜¯ï¼Œå¯ä»¥ä½¿ç”¨&#96;type()</p><p>å½“æˆ‘ä»¬éœ€è¦åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯æŒ‡å®šç±»å‹æ—¶å¯ä»¥ä½¿ç”¨<code>isinstance</code>å‡½æ•°å¿«é€Ÿåˆ¤æ–­ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">People</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name</span>):<br>        self.name = name<br><br><br>p = People(<span class="hljs-string">&quot;jack&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">isinstance</span>(p, People))<span class="hljs-comment"># åˆ¤æ–­p æ˜¯å¦æ˜¯Peopleç±»å‹</span><br><br>a = <span class="hljs-number">10</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">isinstance</span>(a, <span class="hljs-built_in">int</span>))<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">isinstance</span>(a, (<span class="hljs-built_in">str</span>, <span class="hljs-built_in">int</span>)))<span class="hljs-comment"># å¯ä»¥æ˜¯å¤šä¸ªå¤‡é€‰ç±»å‹ï¼Œä»¥å…ƒç»„çš„å½¢å¼åšç¬¬äºŒä¸ªå‚æ•°</span><br>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªå‡½æ•°å¯ä»¥åˆ¤æ–­ç±»ä¸ç±»ä¹‹é—´çš„çˆ¶å­å…³ç³»ï¼Œ`<span class="hljs-built_in">issubclass</span>`<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name</span>):<br>        self.name = name<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">People</span>(<span class="hljs-title class_ inherited__">Animal</span>):<br>    <span class="hljs-keyword">pass</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">issubclass</span>(People, Animal))               <span class="hljs-comment"># True</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">issubclass</span>(Animal, People))               <span class="hljs-comment"># False</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">issubclass</span>(People, (<span class="hljs-built_in">list</span>, Animal)))       <span class="hljs-comment"># True</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">issubclass</span>(People, People))               <span class="hljs-comment"># True</span><br></code></pre></td></tr></table></figure><h2 id="4-15-åå°„æœºåˆ¶ã€é‡ç‚¹ã€‘"><a href="#4-15-åå°„æœºåˆ¶ã€é‡ç‚¹ã€‘" class="headerlink" title="4.15 åå°„æœºåˆ¶ã€é‡ç‚¹ã€‘"></a>4.15 åå°„æœºåˆ¶ã€é‡ç‚¹ã€‘</h2><ul><li>é¦–å…ˆï¼š åå°„æœºåˆ¶æ˜¯ä»€ä¹ˆï¼Ÿåå°„æœºåˆ¶<br>é¦–å…ˆï¼Œpythonæ˜¯ä¸€é—¨åŠ¨æ€è¯­è¨€ï¼Œpythonçš„åå°„æœºåˆ¶å°±æ˜¯æŒ‡ï¼Œå¯ä»¥åœ¨ç¨‹åºè¿è¡Œçš„æ—¶å€™è·å–ç¨‹åºçš„å±æ€§æ–¹æ³•ï¼Œè€Œä¸éœ€è¦åœ¨ç¼–ç æ—¶æ˜ç¡®çŸ¥é“è¿™äº›å¯¹è±¡ã€æ–¹æ³•åã€æˆ–å±æ€§åçš„å…·ä½“ä¿¡æ¯ï¼Œåå°„ä½¿å¾—ä½ å¯ä»¥åœ¨ç¨‹åºè¿è¡Œæ—¶åŠ¨æ€åœ°è·å–ã€æ“ä½œå’Œæ¢ç´¢å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ã€‚pythonçš„åå°„æœºåˆ¶æ ¸å¿ƒ4ç‚¹ï¼š</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">hasattr</span>(<span class="hljs-built_in">object</span>, <span class="hljs-string">&quot;x&quot;</span>)  <span class="hljs-comment"># åˆ¤æ–­å¯¹è±¡æ˜¯å¦æœ‰è¿™ä¸ªå±æ€§ï¼Œå¦‚æœæœ‰ å°±è¿”å›å¸ƒå°”å€¼True æˆ– False</span><br><span class="hljs-built_in">getattr</span>(<span class="hljs-built_in">object</span>, name, default=<span class="hljs-literal">None</span>)  <span class="hljs-comment"># è·å–ä¸€ä¸ªå¯¹è±¡çš„nameå±æ€§ï¼Œå¦‚æœnameå±æ€§ä¸å­˜åœ¨çš„è¯ï¼Œè¿”å›None</span><br><span class="hljs-built_in">setattr</span>(<span class="hljs-built_in">object</span>, <span class="hljs-string">&#x27;xå±æ€§å&#x27;</span>, <span class="hljs-string">&#x27;yå±æ€§å&#x27;</span>)  <span class="hljs-comment"># æ›´æ–°å¯¹è±¡xå±æ€§çš„å€¼ï¼Œå°±æ˜¯object.x = &#x27;y&#x27; å¦‚æœxå±æ€§ä¸å­˜åœ¨ï¼Œé‚£å°±æ–°å¢ä¸€ä¸ªyå±æ€§</span><br><span class="hljs-built_in">delattr</span>(<span class="hljs-built_in">object</span>, <span class="hljs-string">&#x27;yå±æ€§å&#x27;</span>)  <span class="hljs-comment"># åˆ é™¤å¯¹è±¡çš„ä¸€ä¸ªå±æ€§yï¼Œå¦‚æœå±æ€§yä¸å­˜åœ¨ï¼Œå°±ä¼šæŠ¥é”™</span><br><br><br></code></pre></td></tr></table></figure><ul><li>1ã€getattr( object, name,default&#x3D;None):</li><li>2ã€hasattr():</li><li>3ã€setattr():</li><li>4ã€delattr():</li><li>5ã€dir(): è¿™ä¸ªå¸¸ç”¨ï¼Œè¿™ä¸ªå°±æ—¶è·å–å¯¹è±¡æ‰€æœ‰å±æ€§</li><li>6ã€exec():å’Œeval():å‡½æ•°</li></ul><p>pythonä¸­ä½¿ç”¨åå°„éå¸¸æ–¹ä¾¿ï¼Œä»…éœ€è¦ä½¿ç”¨4ä¸ªå†…ç½®å‡½æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æ¯”å¦‚åˆ¤æ–­ç”¨æˆ·è¾“å…¥çš„ä¸€ä¸ªå­—ç¬¦ä¸²æ˜¯ä¸æ˜¯ä¸€ä¸ªå¯¹è±¡çš„å±æ€§, ä½¿ç”¨if-elif-else åˆ¤æ–­è¾ƒä¸ºç¹çã€‚</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Ftp</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">pass</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">set</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">pass</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">pass</span><br><br>ftp = Ftp()<br>cmd = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;è¯·è¾“å…¥æŒ‡ä»¤ï¼š&#x27;</span>).strip()<br><span class="hljs-keyword">if</span> cmd == <span class="hljs-string">&#x27;get&#x27;</span>:<br>    ftp.get()<br><span class="hljs-keyword">elif</span> cmd == <span class="hljs-string">&#x27;set&#x27;</span>:<br>    ftp.<span class="hljs-built_in">set</span>()<br><span class="hljs-keyword">elif</span> cmd == <span class="hljs-string">&quot;delete&quot;</span>:<br>    ftp.delete()<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;æŒ‡ä»¤ä¸å­˜åœ¨&#x27;</span>)<br>    <br><span class="hljs-built_in">hasattr</span>(obj, <span class="hljs-string">&#x27;x&#x27;</span>)                  <span class="hljs-comment"># åˆ¤æ–­å¯¹è±¡æ˜¯å¦æœ‰ä¸€ä¸ªå±æ€§ï¼Œè¿”å›å¸ƒå°”å€¼</span><br><span class="hljs-built_in">getattr</span>(<span class="hljs-built_in">object</span>, name, default=<span class="hljs-literal">None</span>)  <span class="hljs-comment"># è·å–ä¸€ä¸ªå¯¹è±¡çš„nameå±æ€§ï¼Œå¦‚æœnameå±æ€§ä¸å­˜åœ¨çš„è¿”å›None</span><br><span class="hljs-built_in">setattr</span>(x, <span class="hljs-string">&#x27;y&#x27;</span>, <span class="hljs-string">&#x27;v&#x27;</span>)              <span class="hljs-comment"># æ›´æ–°å¯¹è±¡yå±æ€§çš„å€¼, ç­‰ä»·äº x.y = &#x27;v&#x27;ï¼Œå½“yä¸å­˜åœ¨çš„æ–°å¢</span><br><span class="hljs-built_in">delattr</span>(x, <span class="hljs-string">&#x27;y&#x27;</span>)                  <span class="hljs-comment"># åˆ é™¤å¯¹è±¡çš„ä¸€ä¸ªå±æ€§ï¼Œ ç­‰ä»·äº del x.y   å±æ€§yä¸å­˜åœ¨åˆ™æŠ¥é”™</span><br><span class="hljs-comment"># ä¸Šé¢ä½¿ç”¨æ¡ä»¶åˆ¤æ–­çš„ä¾‹å­ä½¿ç”¨åå°„å¯ä»¥ç®€åŒ–å¦‚ä¸‹</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Ftp</span>:<br>    ...<br><br>ftp = Ftp()<br>cmd = <span class="hljs-built_in">input</span>(<span class="hljs-string">&#x27;è¯·è¾“å…¥æŒ‡ä»¤ï¼š&#x27;</span>).strip()<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">hasattr</span>(ftp, cmd):<br>    <span class="hljs-built_in">getattr</span>(ftp, cmd)()<br><span class="hljs-keyword">else</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;æŒ‡ä»¤ä¸å­˜åœ¨&#x27;</span>)<br></code></pre></td></tr></table></figure><ul><li>åå°„ç±»çš„å±æ€§</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Foo</span>(<span class="hljs-title class_ inherited__">object</span>):<br> <br>    staticField = <span class="hljs-string">&quot;HAHA&quot;</span><br> <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        self.name = <span class="hljs-string">&#x27;jack&#x27;</span><br> <br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">func</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;func&#x27;</span><br> <br><span class="hljs-meta">    @staticmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">bar</span>():<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;bar&#x27;</span><br> <br><span class="hljs-built_in">print</span> <span class="hljs-built_in">getattr</span>(Foo, <span class="hljs-string">&#x27;staticField&#x27;</span>)<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">getattr</span>(Foo, <span class="hljs-string">&#x27;func&#x27;</span>)<br><span class="hljs-built_in">print</span> <span class="hljs-built_in">getattr</span>(Foo, <span class="hljs-string">&#x27;bar&#x27;</span>)<br></code></pre></td></tr></table></figure><ul><li>åå°„å½“å‰æ¨¡å—æˆå‘˜</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">s1</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;s1&#x27;</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">s2</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;s2&#x27;</span>)<br><br><br>this_module = sys.modules[__name__]<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">hasattr</span>(this_module, <span class="hljs-string">&#x27;s1&#x27;</span>))<br><span class="hljs-built_in">getattr</span>(this_module, <span class="hljs-string">&#x27;s2&#x27;</span>)<br></code></pre></td></tr></table></figure><ul><li>è¡¥å……ï¼šåå°„çš„åº•å±‚åŸç†</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(<span class="hljs-built_in">dir</span>(obj))<br><span class="hljs-built_in">print</span>(obj.__dict__[<span class="hljs-built_in">dir</span>(obj)[index]])<br></code></pre></td></tr></table></figure><p>ä½œç”¨å‘¢ï¼Ÿ</p><p>åŠ¨æ€è°ƒç”¨å’Œè®¿é—®å¯¹è±¡çš„å±æ€§ï¼Œgetattr() setattr() hasattr()è¿™äº›éƒ½å¯ä»¥éšæ—¶ä¿®æ”¹å’Œè·å–å¯¹è±¡çš„å±æ€§</p><p>åŠ¨æ€è·å–token</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ApiClient</span>:<br>  <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>    self.token = <span class="hljs-literal">None</span><br><br>  <span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">self, username, password</span>):<br>    <span class="hljs-comment"># å‡è®¾è¿™é‡Œè°ƒç”¨ç™»å½•æ¥å£ï¼Œè·å–è¿”å›çš„ tokenï¼Œå¹¶å°†å…¶å­˜å‚¨åˆ° self.token ä¸­</span><br>    response = self.send_request(<span class="hljs-string">&#x27;/login&#x27;</span>, &#123;<span class="hljs-string">&#x27;username&#x27;</span>: username, <span class="hljs-string">&#x27;password&#x27;</span>: password&#125;)<br>    self.token = response[<span class="hljs-string">&#x27;token&#x27;</span>]<br><br>  <span class="hljs-keyword">def</span> <span class="hljs-title function_">send_request</span>(<span class="hljs-params">self, endpoint, data</span>):<br>    <span class="hljs-comment"># å‘é€æ¥å£è¯·æ±‚çš„é€»è¾‘ï¼Œè¿”å›å“åº”æ•°æ®</span><br>    <span class="hljs-keyword">pass</span><br><br>  <span class="hljs-keyword">def</span> <span class="hljs-title function_">request_with_token</span>(<span class="hljs-params">self, endpoint, data=<span class="hljs-literal">None</span></span>):<br>    <span class="hljs-keyword">if</span> self.token:<br>      headers = &#123;<span class="hljs-string">&#x27;Authorization&#x27;</span>: <span class="hljs-string">f&#x27;Bearer <span class="hljs-subst">&#123;self.token&#125;</span>&#x27;</span>&#125;<br>    <span class="hljs-keyword">else</span>:<br>      headers = <span class="hljs-literal">None</span><br>    <span class="hljs-keyword">return</span> self.send_request(endpoint, data, headers)<br><br><br><span class="hljs-comment"># åœ¨æµ‹è¯•ä¸­ä½¿ç”¨åå°„è·å– token å¹¶è¿›è¡Œæ¥å£è¯·æ±‚</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_api</span>():<br>  client = ApiClient()<br>  client.login(<span class="hljs-string">&#x27;your_username&#x27;</span>, <span class="hljs-string">&#x27;your_password&#x27;</span>)<br><br>  <span class="hljs-comment"># ä½¿ç”¨åå°„è·å– token</span><br>  token = <span class="hljs-built_in">getattr</span>(client, <span class="hljs-string">&#x27;token&#x27;</span>, <span class="hljs-literal">None</span>)<br>  <span class="hljs-keyword">assert</span> token <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>, <span class="hljs-string">&quot;Token not obtained&quot;</span><br><br>  <span class="hljs-comment"># ä½¿ç”¨ token å‘é€å…¶ä»–æ¥å£è¯·æ±‚</span><br>  response = client.request_with_token(<span class="hljs-string">&#x27;/some_endpoint&#x27;</span>, &#123;<span class="hljs-string">&#x27;param&#x27;</span>: <span class="hljs-string">&#x27;value&#x27;</span>&#125;)<br>  <span class="hljs-keyword">assert</span> response[<span class="hljs-string">&#x27;status&#x27;</span>] == <span class="hljs-string">&#x27;success&#x27;</span>, <span class="hljs-string">&quot;Request failed&quot;</span><br><br>  <span class="hljs-comment"># ... å…¶ä»–æµ‹è¯•é€»è¾‘</span><br><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># é‚£æ¥å£è‡ªåŠ¨åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œè¿˜æœ‰ä»€ä¹ˆå…¶ä»–çš„æ–¹å¼æ‹¿tokenå—</span><br><span class="hljs-comment"># åœ¨æ¥å£è‡ªåŠ¨åŒ–è¿‡ç¨‹ä¸­ï¼Œé™¤äº†ä½¿ç”¨åå°„æœºåˆ¶å¤–ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–çš„æ–¹å¼å¯ä»¥è·å– tokenï¼Œå…·ä½“å–å†³äºæ¥å£çš„è®¾è®¡å’Œå®é™…æƒ…å†µã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸è§çš„è·å– token çš„æ–¹å¼ï¼š</span><br><br><span class="hljs-comment"># å›ºå®š Tokenï¼š åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œå¯ä»¥äº‹å…ˆåˆ›å»ºä¸€ä¸ªç‰¹å®šçš„ç”¨æˆ·è´¦å·ï¼Œä¸ºå…¶ç”Ÿæˆä¸€ä¸ªå›ºå®šçš„ tokenï¼Œç”¨äºæ¥å£æµ‹è¯•ã€‚è¿™æ ·æ¯æ¬¡æµ‹è¯•å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™ä¸ªå›ºå®šçš„ tokenã€‚</span><br><br><span class="hljs-comment"># ç¯å¢ƒå˜é‡ï¼š å°† token å­˜å‚¨ä¸ºç¯å¢ƒå˜é‡ï¼Œæµ‹è¯•æ—¶ä»ç¯å¢ƒå˜é‡ä¸­è¯»å– token å€¼ã€‚è¿™æ ·å¯ä»¥åœ¨ä¸åŒç¯å¢ƒä¸­çµæ´»åˆ‡æ¢å’Œç®¡ç† tokenã€‚</span><br><br><span class="hljs-comment"># åŠ¨æ€ç”Ÿæˆï¼š åœ¨æ¯æ¬¡æµ‹è¯•è¿è¡Œå‰ï¼Œé€šè¿‡è‡ªåŠ¨åŒ–è„šæœ¬æ‰§è¡Œç™»å½•æ“ä½œï¼Œè·å–å®æ—¶çš„ tokenã€‚ç™»å½•æˆåŠŸåï¼Œä»æ¥å£å“åº”ä¸­æå– token å¹¶å­˜å‚¨åˆ°å˜é‡ä¸­ï¼Œä¾›åç»­æ¥å£è¯·æ±‚ä½¿ç”¨ã€‚</span><br><br><span class="hljs-comment"># Token ä¸­å¿ƒï¼š åœ¨ä¸€äº›å¤æ‚çš„ç³»ç»Ÿä¸­ï¼Œå¯èƒ½ä¼šæœ‰ä¸“é—¨çš„ token ä¸­å¿ƒç”¨äºç®¡ç†ç”¨æˆ·çš„èº«ä»½éªŒè¯ä¿¡æ¯ã€‚æµ‹è¯•æ—¶ï¼Œå¯ä»¥è°ƒç”¨ token ä¸­å¿ƒçš„æ¥å£è·å–æœ‰æ•ˆçš„ tokenã€‚</span><br><br><span class="hljs-comment"># JWTï¼ˆJSON Web Tokenï¼‰ï¼š å¦‚æœæ¥å£ä½¿ç”¨äº† JWT è¿›è¡Œèº«ä»½éªŒè¯ï¼Œå¯ä»¥æ ¹æ® JWT çš„ç”Ÿæˆè§„åˆ™ç”Ÿæˆåˆæ³•çš„ tokenã€‚è¿™éœ€è¦äº†è§£ JWT çš„å…·ä½“ç”Ÿæˆæ–¹å¼ã€‚</span><br></code></pre></td></tr></table></figure><h2 id="4-16-å•ä¾‹æ¨¡å¼ã€é‡ç‚¹ã€‘â€“è®¾è®¡æ¨¡å¼çš„ä¸€ç§"><a href="#4-16-å•ä¾‹æ¨¡å¼ã€é‡ç‚¹ã€‘â€“è®¾è®¡æ¨¡å¼çš„ä¸€ç§" class="headerlink" title="4.16 å•ä¾‹æ¨¡å¼ã€é‡ç‚¹ã€‘â€“è®¾è®¡æ¨¡å¼çš„ä¸€ç§"></a>4.16 å•ä¾‹æ¨¡å¼ã€é‡ç‚¹ã€‘â€“è®¾è®¡æ¨¡å¼çš„ä¸€ç§</h2><ul><li>é¦–å…ˆï¼Œå•ä¾‹æ¨¡å¼æ˜¯ä»€ä¹ˆï¼Ÿ æ˜¯è½¯ä»¶çš„ä¸€ç§è®¾è®¡æ¨¡å¼ï¼Œ</li><li>ç›®çš„ï¼šæ— è®ºè°ƒç”¨å¤šå°‘æ¬¡äº§ç”Ÿçš„å®ä¾‹å¯¹è±¡ï¼Œéƒ½æ˜¯æŒ‡å‘åŒä¸€ä¸ªå†…å­˜åœ°å€ï¼Œä»…ä»…åªæœ‰ä¸€ä¸ªå®åŠ›ï¼ˆ<strong>ä¸€ä¸ªå¯¹è±¡</strong>ï¼‰</li><li>æ–¹å¼ï¼š é¦–å…ˆå®ç°å•ä¾‹æ¨¡å¼çš„æ‰‹æ®µæœ‰å¾ˆå¤šç»ˆç«¯é¹…ï¼Œä½†æ€»çš„åŸåˆ™æ˜¯ä»€ä¹ˆï¼Œæ˜¯åŒ…è£…ä½ å®šä¹‰çš„ä¸€ä¸ªç±»ï¼Œåªè¦å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ï¼Œä¸‹ä¸€æ¬¡å†å®ä¾‹åŒ–å¯¹è±¡çš„æ—¶å€™ï¼Œå°±ç›´æ¥è¿”å›ä½ å·²ç»å®ä¾‹åŒ–è¿‡çš„è¿™ä¸ªå¯¹è±¡ï¼Œä¸å†åšå®ä¾‹åŒ–çš„æ“ä½œï¼Œ<br><strong>æ‰€ä»¥è¿™é‡Œå…³é”®çš„ä¸€ç‚¹å°±æ˜¯ï¼Œä½ è¯¥å¦‚ä½•å»åˆ¤æ–­è¿™ä¸ªç±»æ˜¯å¦å·²ç»å®ä¾‹åŒ–è¿‡ä¸€ä¸ªå¯¹è±¡</strong></li><li>è¿™é‡Œä»‹ç»ä¸¤ç±»æ–¹å¼ï¼š<ul><li>ä¸€ä¸ªæ˜¯é€šè¿‡<strong>æ¨¡å—å¯¼å…¥</strong>çš„æ–¹å¼ï¼›</li><li>äºŒä¸ªäº‹é€šè¿‡ä¸€ä¸ª<strong>é­”æ³•æ–¹æ³•</strong>å»åˆ¤æ–­æ–¹å¼</li></ul></li><li>åº”ç”¨çš„åœºæ™¯å‘¢ï¼Ÿä»€ä¹ˆæ—¶å€™ç”¨å•ä¾‹æ¨¡å¼å»åˆ›å»ºä¸€ä¸ªç±»å‘¢ï¼Ÿ<ul><li><p>ç½‘ç«™è®¡æ•°å™¨ï¼Œç¡®ä¿å…¨å±€åªæœ‰ä¸€ä¸ªè®¡æ•°å™¨å®ä¾‹åŒ–å¯¹è±¡ï¼Œç”¨æ¥è®°å½•ç½‘ç«™çš„æ€»è®¿é—®æ¬¡æ•°ã€‚</p></li><li><p>**é…ç½®ç®¡ç†å™¨ï¼šé…ç½®ä¿¡æ¯çš„ç®¡ç†ï¼Œç¡®ä¿ä½ æ•´å¥—ä»£ç ä¸­ï¼Œåªæœ‰ä¸€ä¸ªé…ç½®ç®¡ç†å™¨çš„å®ä¾‹ï¼Œç”¨äºç»Ÿä¸€ç®¡ç†é…ç½®ä¿¡æ¯ï¼Œæ¯”å¦‚è¯´åŒæ„å‘é€è¯·æ±‚ï¼Œæ‰€æœ‰çš„è¯·æ±‚éƒ½æ˜¯é€šè¿‡è¿™ä¸ªå®ä¾‹åŒ–å¯¹è±¡å»è®¿é—®çš„ï¼Œ</p><p>**</p></li><li><p><strong>æ—¥å¿—è®°å½•å™¨ï¼šå…¨å±€ä»£ç è¿è¡Œçš„æ—¶å€™ç¡®ä¿åªæœ‰ä¸€ä¸ªæ—¥å¿—è®°å½•å™¨çš„å®ä¾‹åŒ–å¯¹è±¡ï¼Œç”¨æ¥è®°å½•è¿™å¥—ä»£ç è¿è¡Œæ—¶çš„æ—¥å¿—è®°å½•</strong></p></li><li><p><strong>æ•°æ®åº“è¿æ¥æ± ï¼šä¿è¯æ•´å¥—ä»£ç è¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œåªæœ‰ä¸€ä¸ªæ•°æ®åº“è¿æ¥æ± çš„å®ä¾‹ï¼Œæ–¹ä¾¿ç®¡ç†å¯¹æ•°æ®åº“çš„åŒæ„è¿æ¥å’ŒåŒæ„å…³é—­è¿æ¥æ± </strong></p></li></ul></li><li>æ³¨æ„ä¸€ä¸‹ï¼šå•ä¾‹æ¨¡å¼è™½ç„¶å¯ä»¥åœ¨å¾ˆå¤šç‰¹å®šåœºæ™¯ä¸‹ä½“ç»Ÿä¾¿åˆ©ï¼Œä½†ä¸å¯ä»¥è¿‡åº¦ä¾èµ–å•ä¾‹æ¨¡å¼å¯¼è‡´ä»£ç çš„å¯æµ‹è¯•æ€§å’Œå¯ç»´æŠ¤æ€§é™ä½</li></ul><p>é€šè¿‡<strong>æ¨¡å—å¯¼å…¥</strong>çš„æ–¹å¼æ€ä¹ˆå®ç°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># singleton.py</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span>:<br>  <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Singleton instance created&quot;</span>)<br><br><br>singleton_instance = Singleton()<br><span class="hljs-comment"># åœ¨singleton.py æ–‡ä»¶é‡Œé¢å®šä¹‰äº†ä¸€ä¸ªç±»Singletonï¼Œ</span><br><span class="hljs-comment"># é€šè¿‡singleton_instance = Singleton()</span><br></code></pre></td></tr></table></figure><p>åœ¨å¦ä¸€ä¸ªæ–‡ä»¶ä¸­å¯¼å…¥è¿™ä¸ªæ¨¡å—</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># main.py</span><br><span class="hljs-keyword">import</span> singleton<br><br><span class="hljs-comment"># åˆ›å»ºç¬¬ä¸€ä¸ªå®ä¾‹ï¼Œä¼šè¾“å‡º&quot;Singleton instance created&quot;</span><br>instance1 = singleton.singleton_instance<br><br><span class="hljs-comment"># åˆ›å»ºç¬¬äºŒä¸ªå®ä¾‹ï¼Œä¸ä¼šå†æ¬¡è¾“å‡º&quot;Singleton instance created&quot;</span><br>instance2 = singleton.singleton_instance<br><br><span class="hljs-built_in">print</span>(instance1 <span class="hljs-keyword">is</span> instance2)  <span class="hljs-comment"># è¾“å‡ºï¼šTrueï¼Œè¯´æ˜ä¸¤ä¸ªå®ä¾‹æ˜¯åŒä¸€ä¸ªå®ä¾‹</span><br><br></code></pre></td></tr></table></figure><p>é€šè¿‡<strong>ç±»ç»‘å®šæ–¹æ³•</strong>çš„æ–¹å¼æ¥å®ç°å•ä¾‹æ¨¡å¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># é€šè¿‡åœ¨ç±»æ–¹æ³•ä¸­æ§åˆ¶å®ä¾‹çš„åˆ›å»ºå’Œè¿”å›ï¼Œå¯ä»¥ç¡®ä¿åœ¨ç¨‹åºä¸­åªæœ‰ä¸€ä¸ªå®ä¾‹è¢«åˆ›å»ºã€‚</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span>:<br>  _instance = <span class="hljs-literal">None</span><br><br>  <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>    <span class="hljs-keyword">if</span> Singleton._instance <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>      <span class="hljs-keyword">raise</span> ValueError(<br>        <span class="hljs-string">&quot;Singleton instance already exists&quot;</span>)  <span class="hljs-comment"># ç¬¬äºŒæ¬¡å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œ_instanceä¸ä¸ºç©º æŠ›å‡ºå¼‚å¸¸ï¼Œä¸æ‰“å°Singleton instance created </span><br>    Singleton._instance = self<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Singleton instance created&quot;</span>)<br><br><span class="hljs-meta">  @classmethod</span><br>  <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_instance</span>(<span class="hljs-params">cls</span>):<br>    <span class="hljs-keyword">if</span> cls._instance <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:  <span class="hljs-comment"># ç¬¬ä¸€æ¬¡å®ä¾‹åŒ–çš„æ—¶å€™ï¼Œç±»çš„_instanceä¸ºç©ºï¼Œèµ°åˆ°äº†ä¸Šé¢çš„æ–¹æ³•äº†ï¼Œæ‰“å°Singleton instance created</span><br>      cls._instance = cls()  <span class="hljs-comment"># </span><br>    <span class="hljs-keyword">return</span> cls._instance<br><br><br><span class="hljs-comment"># åˆ›å»ºç¬¬ä¸€ä¸ªå®ä¾‹ï¼Œä¼šè¾“å‡º&quot;Singleton instance created&quot;</span><br>instance1 = Singleton.get_instance()<br><br><span class="hljs-comment"># åˆ›å»ºç¬¬äºŒä¸ªå®ä¾‹ï¼Œä¸ä¼šå†æ¬¡è¾“å‡º&quot;Singleton instance created&quot;</span><br>instance2 = Singleton.get_instance()<br><br><span class="hljs-built_in">print</span>(instance1 <span class="hljs-keyword">is</span> instance2)  <span class="hljs-comment"># è¾“å‡ºï¼šTrueï¼Œè¯´æ˜ä¸¤ä¸ªå®ä¾‹æ˜¯åŒä¸€ä¸ªå®ä¾‹</span><br><span class="hljs-comment"># åŸç†ï¼šç±»çš„ç»‘å®šæ–¹æ³•æ˜¯ç¬¬äºŒç§å®ä¾‹åŒ–å¯¹è±¡çš„æ–¹å¼ï¼Œ</span><br><span class="hljs-comment"># ç¬¬ä¸€æ¬¡å®ä¾‹åŒ–çš„å¯¹è±¡ä¿å­˜æˆç±»çš„æ•°æ®å±æ€§ _instanceï¼Œ</span><br><span class="hljs-comment"># ç¬¬äºŒæ¬¡å†å®ä¾‹åŒ–æ—¶ï¼Œåœ¨get_singletonä¸­åˆ¤æ–­å·²ç»æœ‰äº†å®ä¾‹å¯¹è±¡ï¼Œç›´æ¥è¿”å›ç±»çš„æ•°æ®å±æ€§ _instance</span><br></code></pre></td></tr></table></figure><blockquote><p><strong>è¡¥å……</strong>ï¼šè¿™ç§æ–¹å¼å®ç°çš„å•ä¾‹æ¨¡å¼æœ‰ä¸€ä¸ªæ˜æ˜¾çš„bugï¼›bugçš„æ ¹æºåœ¨äºå¦‚æœç”¨æˆ·ä¸é€šè¿‡ç»‘å®šç±»çš„æ–¹æ³•å®ä¾‹åŒ–å¯¹è±¡ï¼Œè€Œæ˜¯ç›´æ¥é€šè¿‡ç±»ååŠ æ‹¬å·å®ä¾‹åŒ–å¯¹è±¡ï¼Œé‚£è¿™æ ·ä¸å†æ˜¯å•åˆ©æ¨¡å¼äº†ã€‚</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€pythonã€‘è¿›é˜¶ä¹‹å‡½æ•°è¯¦è§£ï¼ˆä¸‰ï¼‰</title>
    <link href="/2024/03/18/603python%E8%BF%9B%E9%98%B6%E4%B9%8B%E5%87%BD%E6%95%B0%E8%AF%A6%E8%A7%A3%EF%BC%88%E4%B8%89%EF%BC%89/"/>
    <url>/2024/03/18/603python%E8%BF%9B%E9%98%B6%E4%B9%8B%E5%87%BD%E6%95%B0%E8%AF%A6%E8%A7%A3%EF%BC%88%E4%B8%89%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="3-å‡½æ•°"><a href="#3-å‡½æ•°" class="headerlink" title="3 å‡½æ•°"></a>3 å‡½æ•°</h1><h2 id="3-1ç±»å‹æç¤º"><a href="#3-1ç±»å‹æç¤º" class="headerlink" title="3.1ç±»å‹æç¤º"></a>3.1ç±»å‹æç¤º</h2><ul><li>Python 3.6ååŠ å…¥äº†æ–°åŠŸèƒ½ï¼šç±»å‹æç¤ºï¼Œç”¨æ¥å£°æ˜ä¸€ä¸ªå˜é‡çš„ç±»å‹</li><li>åœ¨FastAPIä¸­ï¼Œç±»å‹æç¤ºå¯ä»¥ç”¨åˆ°Swaggeræ–‡æ¡£ä¸­</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_name_with_age</span>(<span class="hljs-params">name: <span class="hljs-built_in">str</span>, age: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>    <span class="hljs-keyword">pass</span><br><span class="hljs-comment"># åŸºæœ¬ç±»å‹: intã€floatã€boolã€bytes</span><br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>: <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">process_items</span>(<span class="hljs-params">items: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]</span>):  <span class="hljs-comment"># å¤æ‚çš„ç±»å‹æç¤º</span><br>    <span class="hljs-keyword">for</span> item <span class="hljs-keyword">in</span> items:<br>        <span class="hljs-built_in">print</span>(item)<br></code></pre></td></tr></table></figure><h2 id="3-2-å‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘"><a href="#3-2-å‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘" class="headerlink" title="3.2 å‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘"></a>3.2 å‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘</h2><ul><li><p>åœ¨ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œä¸€ç­‰å…¬æ°‘å¯ä»¥ä½œä¸ºå‡½æ•°å‚æ•°ï¼Œå¯ä»¥ä½œä¸ºå‡½æ•°è¿”å›å€¼ï¼Œä¹Ÿå¯ä»¥èµ‹å€¼ç»™å˜é‡ã€‚</p></li><li><p>pythonä¸­ä¸€åˆ‡ä¸”å¯¹è±¡ï¼Œæ‰€ä»¥å‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡ï¼Œå‡½æ•°ä¹Ÿæ˜¯ä¸€ç­‰å…¬æ°‘ã€‚</p></li><li><p>ä¹Ÿå°±æ˜¯è¯´å‡½æ•°å¯ä»¥ä½œä¸ºå‡½æ•°å‚æ•°ï¼Œå¯ä»¥ä½œä¸ºå‡½æ•°è¿”å›å€¼ï¼Œä¹Ÿå¯ä»¥èµ‹å€¼ç»™å˜é‡ã€‚</p></li></ul><p>ç¤ºä¾‹1ï¼šå‡½æ•°å½“å˜é‡è¢«èµ‹å€¼å¼•ç”¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">x, y</span>):<br>    <span class="hljs-built_in">print</span>(x + y)<br>    <br>func = add<span class="hljs-comment"># func</span><br>func(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>)<span class="hljs-comment"># ç­‰åŒäº add(x, y); ç±»ä¼¼å˜é‡çš„èµ‹å€¼å¼•ç”¨</span><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹2ï¼šå‡½æ•°åšå®¹å™¨å…ƒç´ çš„å‚æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">x, y</span>):<br>    <span class="hljs-built_in">print</span>(x + y)<br><br>funcs = [add]<br><br><span class="hljs-keyword">for</span> f <span class="hljs-keyword">in</span> funcs:<br>    f(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹3ï¼šå‡½æ•°åšå®å‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">func</span>(<span class="hljs-params">x</span>):<br>    <span class="hljs-keyword">return</span> x + <span class="hljs-number">1</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">x, func</span>):<br>    <span class="hljs-keyword">return</span> func(x)<br><br><span class="hljs-built_in">print</span>(add(<span class="hljs-number">3</span>, func))    <span class="hljs-comment"># æ‰“å°ï¼š4</span><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹4ï¼šå‡½æ•°åšè¿”å›å€¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">x, y</span>):<br>    <span class="hljs-keyword">return</span> x+y<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">foo</span>():<br>    <span class="hljs-keyword">return</span> add<br><br><br>func = foo()<span class="hljs-comment"># ç›¸å½“äº func = add</span><br>func(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>)<span class="hljs-comment"># xç›¸å½“äº add(3, 4)</span><br></code></pre></td></tr></table></figure><h2 id="3-3é—­åŒ…å‡½æ•°"><a href="#3-3é—­åŒ…å‡½æ•°" class="headerlink" title="3.3é—­åŒ…å‡½æ•°"></a>3.3é—­åŒ…å‡½æ•°</h2><p>å‰é¢è¯´äº†ï¼Œå‡½æ•°æ˜¯ä¸€ç­‰å…¬æ°‘ï¼Œæ‰€ä»¥å‡½æ•°å¯ä»¥ä½œä¸ºå…¥å‚å’Œè¿”å›å€¼ä¼ é€’</p><ul><li>å†…åµŒå‡½æ•°åŒ…å«å¯¹å¤–å±‚å‡½æ•°ä½œç”¨åŸŸä¸­å˜é‡çš„å¼•ç”¨ï¼ˆéå…¨å±€ä½œç”¨åŸŸçš„å˜é‡ï¼Œæ˜¯å¤–å±‚å‡½æ•°å†…éƒ¨çš„å˜é‡ï¼‰ï¼Œé‚£ä¹ˆè¯¥å†…åµŒå‡½æ•°å°±æ˜¯é—­åŒ…å‡½æ•°ï¼Œç§°ä¸ºé—­åŒ…ï¼ˆClosuresï¼‰</li><li>æ­£å¸¸å‡½æ•°å†…éƒ¨å˜é‡åœ¨å‡½æ•°è°ƒç”¨ä¹‹åå°±ä¼šè¢«å›æ”¶ï¼Œä½†æ˜¯é—­åŒ…å‡½æ•°çš„å‡ºç°ï¼Œç ´åäº†è¿™ä¸ªè§„åˆ™ï¼Œè®©å†…éƒ¨å˜é‡å¯ä»¥åœ¨å‡½æ•°å¤–éƒ¨ä½¿ç”¨</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">outer</span>():<br>    x = <span class="hljs-number">10</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">inner</span>():<br>        <span class="hljs-keyword">return</span> x + <span class="hljs-number">1</span><span class="hljs-comment"># æ­¤æ—¶ inneræ˜¯é—­åŒ…å‡½æ•°ï¼ˆå¼•ç”¨äº†å¤–å±‚å‡½æ•°ä½œç”¨åŸŸçš„å˜é‡ï¼‰</span><br>    <span class="hljs-keyword">return</span> inner<br><br><br>x = <span class="hljs-number">10</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">outer</span>():<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">inner</span>():<br>        <span class="hljs-keyword">return</span> x + <span class="hljs-number">1</span><span class="hljs-comment"># æ­¤æ—¶ï¼Œinnerä¸æ˜¯é—­åŒ…å‡½æ•°(æ²¡æœ‰å¼•ç”¨å¤–å±‚å‡½æ•°ä½œç”¨åŸŸçš„å˜é‡)</span><br>    <span class="hljs-keyword">return</span> inner<br></code></pre></td></tr></table></figure><p>ã€å¦‚ä½•åˆ¤æ–­é—­åŒ…å‡½æ•°ã€‘</p><ul><li>æ–¹æ³•1ï¼šæ˜¯å¦å¼•ç”¨å¤–å±‚å‡½æ•°ä½œç”¨åŸŸä¸­çš„å˜é‡</li><li>æ–¹æ³•2ï¼šé€šè¿‡å‡½æ•°çš„closureå±æ€§ï¼ŒæŸ¥çœ‹åˆ°é—­åŒ…å‡½æ•°æ‰€åŒ…è£¹çš„å¤–éƒ¨å˜é‡ã€‚ä¸æ˜¯é—­åŒ…è¯¥å€¼ä¸ºNone</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">func.__closure__<br>f.__closure__[<span class="hljs-number">0</span>].cell_contents<br></code></pre></td></tr></table></figure><p>ã€é—­åŒ…å‡½æ•°çš„ç”¨é€”ã€‘</p><ul><li>ä¸ºå‡½æ•°ä½“ä¼ å‚ã€‚<strong>ä¸€æ¬¡ä¼ å‚ï¼Œåç»­ä½¿ç”¨æ— é¡»å†ä¼ å‚</strong> ã€‚é—­åŒ…å‡½æ•°çš„è¿™ç§ç‰¹æ€§æœ‰æ—¶åˆç§°ä¸ºæƒ°æ€§è®¡ç®—ã€‚</li><li>è£…é¥°å™¨ï¼ˆé‡è¦ï¼‰</li><li>ç¤ºä¾‹2ï¼šä¸ºå‡½æ•°ä½“ä¼ å‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> requests<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">outer</span>(<span class="hljs-params">url</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">inner</span>():<br>        response = requests.get(url)<br>        <span class="hljs-built_in">print</span>(response.text)<br>    <span class="hljs-keyword">return</span> inner<br><br><br>baidu = outer(<span class="hljs-string">&quot;http://www.baidu.com&quot;</span>)<br>baidu()<br>baidu()<br></code></pre></td></tr></table></figure><p>ä½œç”¨ï¼š</p><ul><li>1ã€å®ç°å‡½æ•°å·¥å‚ï¼šåŠ¨æ€åœ°ç”Ÿæˆå’Œè¿”å›å…·æœ‰ä¸åŒå‚æ•°çš„å‡½æ•°</li><li>2ã€ä¿æŠ¤æ•°æ®ï¼š å°†å˜é‡å°è£…åœ¨é—­åŒ…ä¸­ï¼Œé™åˆ¶å¯¹å˜é‡çš„ç›´æ¥è®¿é—®ï¼Œå®ç°æ•°æ®çš„å°è£…å’Œéšè—</li><li>3ã€è£…é¥°å™¨ï¼šç”¨äºåœ¨å‡½æ•°å‰åæ‰§è¡Œé¢å¤–çš„ä»£ç ï¼Œå¦‚æ€§èƒ½åˆ†æï¼Œæ—¥å¿—æ”¶é›†ç­‰ï¼Œç”¨äºåŠ å¼ºå‡½æ•°</li></ul><h2 id="3-4-æ™®é€šè£…é¥°å™¨ã€æœ‰å¦å¼€ä¸€ç¯‡ã€‘"><a href="#3-4-æ™®é€šè£…é¥°å™¨ã€æœ‰å¦å¼€ä¸€ç¯‡ã€‘" class="headerlink" title="3.4 æ™®é€šè£…é¥°å™¨ã€æœ‰å¦å¼€ä¸€ç¯‡ã€‘"></a>3.4 æ™®é€šè£…é¥°å™¨ã€æœ‰å¦å¼€ä¸€ç¯‡ã€‘</h2><p>ç›®çš„ï¼šåœ¨ä¸ä¿®æ”¹åŸæœ‰å‡½æ•°ä»£ç çš„æƒ…å†µä¸‹ï¼Œå¢å¼ºå‡½æ•°ï¼Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å‡è®¾è¦åœ¨è¿è¡Œå‡½æ•°çš„æ—¶å€™ï¼ŒåŠ ä¸Šæ—¥å¿—æ‰“å°å‡½æ•°çš„æ–¹æ³•ï¼š</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">outfun</span>(<span class="hljs-params">fun</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">innerfun</span>(<span class="hljs-params">*args,**kwargs</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;å½“å‰æ–¹æ³•çš„åç§°æ˜¯ï¼š<span class="hljs-subst">&#123;fun.__name__&#125;</span>&quot;</span>)<br>        re = fun(*args,**kwargs)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;å½“å‰æ–¹æ³•çš„åç§°æ˜¯ï¼š<span class="hljs-subst">&#123;fun.__name__&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> re<br>    <span class="hljs-keyword">return</span> innerfun<br><br><span class="hljs-meta">@outfun</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a,b</span>):<br>    <span class="hljs-keyword">return</span> a+b<br>result = add(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>) <span class="hljs-comment"># è¿è¡Œçš„æ˜¯ä¸Šé¢å®šä¹‰çš„è¢«è£…é¥°è¿‡åçš„å†…åµŒå‡½æ•°innerfun</span><br><span class="hljs-built_in">print</span>(result)  <br><span class="hljs-comment"># è¾“å‡ºç»“æœ</span><br><span class="hljs-comment"># å½“å‰æ–¹æ³•çš„åç§°æ˜¯ï¼šadd</span><br><span class="hljs-comment"># å½“å‰æ–¹æ³•çš„åç§°æ˜¯ï¼šadd</span><br><span class="hljs-comment"># 3</span><br><span class="hljs-comment"># åŠ äº†è£…é¥°å™¨è¯­æ³•@outfunä¹‹åï¼Œå½“æˆ‘ä»¬è¿è¡Œadd()æ–¹æ³•çš„æ—¶å€™ï¼Œå®é™…ä¸Šè¿è¡Œçš„æ˜¯è¢«è£…é¥°è¿‡åçš„å‡½æ•°innerfun</span><br></code></pre></td></tr></table></figure><h2 id="3-5-å¸¦å‚æ•°è£…é¥°å™¨"><a href="#3-5-å¸¦å‚æ•°è£…é¥°å™¨" class="headerlink" title="3.5 å¸¦å‚æ•°è£…é¥°å™¨"></a>3.5 å¸¦å‚æ•°è£…é¥°å™¨</h2><p>çŸ¥é“è£…é¥°å™¨çš„åŸç†ä¹‹åï¼Œå¸¦å‚æ•°çš„è£…é¥°å™¨å®ç°å°±å¾ˆç®€å•ï¼Œå°±æ˜¯åœ¨å¤–å±‚å‡½æ•°çš„å¤–é¢ï¼Œå†åµŒå¥—ä¸€å±‚å‡½æ•°ï¼Œä¸”æœ€å¤–å±‚å‡½æ•°çš„å…¥å‚å°±æ˜¯å¸¦å‚è£…é¥°å™¨çš„å…¥å‚ï¼Œæ¥ä¸Šé¢</p><p>è¢«è£…é¥°çš„å‡½æ•°éœ€è¦å‚æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å†åˆ°å¤–å±‚å®šä¹‰ä¸€ä¸ªæœ€å¤–å±‚å‡½æ•°</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">overfun</span>(<span class="hljs-params">login</span>):<br><span class="hljs-comment"># å…ˆå®šä¹‰ä¸€ä¸ªè£…é¥°å™¨å‡½æ•°</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">outfun</span>(<span class="hljs-params">fun</span>):<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">innerfun</span>(<span class="hljs-params">*arg,**kwargs</span>):<br>            <span class="hljs-keyword">if</span> login== <span class="hljs-string">&quot;debug&quot;</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;å‡½æ•°çš„åç§°æ˜¯ï¼š<span class="hljs-subst">&#123;fun.__name__&#125;</span>,ç­‰çº§æ˜¯debug&quot;</span>)<br>            result = fun(*arg.**kwargs)<br>            <span class="hljs-keyword">if</span> login==<span class="hljs-string">&quot;info&quot;</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;å‡½æ•°çš„åç§°æ˜¯ï¼š<span class="hljs-subst">&#123;fun.__name__&#125;</span>,ç­‰çº§æ˜¯info&quot;</span>)<br>            <span class="hljs-keyword">return</span> result<br>        <span class="hljs-keyword">return</span> innerfun<br>    <span class="hljs-keyword">return</span> outfun<br><br><span class="hljs-meta">@overfun(<span class="hljs-params">login=<span class="hljs-string">&quot;info&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">testadd</span>(<span class="hljs-params">a,b</span>):<br>    <span class="hljs-keyword">return</span> a+b<br>r = testadd(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>)<br><span class="hljs-built_in">print</span>(r)<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨è£…é¥°å™¨æ—¶å¯ä»¥ç»™è£…é¥°å™¨ä¼ å‚æ•°</p><p>- </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>(<span class="hljs-params">flag</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">outer</span>(<span class="hljs-params">func</span>):<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">inner</span>(<span class="hljs-params">*args, **kwargs</span>):<br>            start = time.time()<br>            rets = func(*args, **kwargs)<br>            end = time.time()<br>            <span class="hljs-keyword">if</span> flag == <span class="hljs-string">&quot;am&quot;</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;func&#125;</span>è¿è¡Œç”¨æ—¶(am):<span class="hljs-subst">&#123;end - start&#125;</span>s&#x27;</span>)<br>            <span class="hljs-keyword">elif</span> flag == <span class="hljs-string">&quot;pm&quot;</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;func&#125;</span>è¿è¡Œç”¨æ—¶(pm):<span class="hljs-subst">&#123;end - start&#125;</span>s&#x27;</span>)<br>            <span class="hljs-keyword">return</span> rets<br><br>        <span class="hljs-keyword">return</span> inner<br>    <span class="hljs-keyword">return</span> outer<br><br><br><span class="hljs-meta">@wrapper(<span class="hljs-params"><span class="hljs-string">&quot;am&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params">x, y</span>):<br>    time.sleep(<span class="hljs-number">2</span>)<br>    <span class="hljs-keyword">return</span> x + y<br><br><br><span class="hljs-built_in">print</span>(foo(<span class="hljs-number">3</span>, <span class="hljs-number">4</span>))<br></code></pre></td></tr></table></figure><p>åˆ†æï¼šå…ˆè°ƒç”¨wrapper(â€œamâ€)  è¿”å›outerï¼Œå†çœ‹@outerï¼Œå³æ™®é€šçš„è£…é¥°å™¨ï¼Œç›¸å½“äº foo &#x3D; outer(foo)</p><h3 id="3-5-1-è£…é¥°å™¨çš„ä¼˜ç¼ºç‚¹å’Œåº”ç”¨åœºæ™¯"><a href="#3-5-1-è£…é¥°å™¨çš„ä¼˜ç¼ºç‚¹å’Œåº”ç”¨åœºæ™¯" class="headerlink" title="3.5.1 è£…é¥°å™¨çš„ä¼˜ç¼ºç‚¹å’Œåº”ç”¨åœºæ™¯"></a>3.5.1 è£…é¥°å™¨çš„ä¼˜ç¼ºç‚¹å’Œåº”ç”¨åœºæ™¯</h3><ul><li><p>ä¼˜ç‚¹ï¼š ä¸æ”¹å˜å‡½æ•°ä»£ç çš„å‰æä¸‹ï¼Œå¯¹å‡½æ•°è¿›è¡Œå¢å¼º</p></li><li><p>ç¼ºç‚¹ï¼šæ— æ³•ä¸€çœ¼çœ‹æ¸…æ¥šä»£ç ï¼Œæœ‰äº›äººçœ‹ä¸æ‡‚ï¼ŒåµŒå¥—æ¯”è¾ƒå¤š</p></li><li><p>åº”ç”¨åœºæ™¯ï¼š</p><ul><li>1ã€<strong>æ—¥å¿—è®°å½•ï¼Œæ— éœ€å†™loginæ–¹æ³•å°±å¯æ‰“å°æ—¥å¿—</strong></li><li>2ã€<strong>æƒé™æ§åˆ¶ï¼Œåˆ¤æ–­å…¥å‚æœ‰æ²¡æœ‰æŸä¸ªå±æ€§ï¼Œå¦‚æœæ²¡æœ‰å°±æ— æƒé™</strong></li><li>3ã€æ€§èƒ½ä¼˜åŒ–ï¼š</li><li>4ã€æ•°æ®éªŒè¯ï¼šåœ¨è¾“å…¥è¾“å‡ºçš„æ•°æ®éªŒè¯å’Œè½¬æ¢æ–¹é¢ï¼Œè£…é¥°å™¨å¯ä»¥å®ç°è¾“å…¥éªŒè¯ã€ç±»å‹è½¬æ¢</li><li>5ã€ä»£ç è®¡æ—¶ï¼šè®°å½•è¿™æ®µå‡½æ•°ä»£ç è¿è¡Œçš„èŠ±è´¹çš„æ—¶é—´</li></ul></li></ul><h2 id="3-6-å¯å˜é•¿å‚æ•°çš„é«˜çº§ç”¨æ³•"><a href="#3-6-å¯å˜é•¿å‚æ•°çš„é«˜çº§ç”¨æ³•" class="headerlink" title="3.6 å¯å˜é•¿å‚æ•°çš„é«˜çº§ç”¨æ³•"></a>3.6 å¯å˜é•¿å‚æ•°çš„é«˜çº§ç”¨æ³•</h2><p>é¦–å…ˆpythonæ˜¯å¸¸è§„å‡½æ•°æ˜¯ä¸¥æ ¼æŒ‰ç…§å®šä¹‰çš„å½¢å‚ä¼ çš„ï¼Œå¦‚æœå®å‚æ•°é‡å¤§äºå½¢å‚å°±ä¼šæŠ¥é”™</p><ul><li>ã€å¯è¾¹é•¿ä½ç½®å‚æ•°ã€‘*args å¦‚è¿‡åœ¨æœ€åä¸€ä¸ªå½¢å‚å‰é¢åŠ æ˜Ÿå·ï¼Œé‚£ä¹ˆåœ¨è°ƒç”¨å‡½æ•°çš„æ—¶å€™ï¼Œæº¢å‡ºçš„ä½ç½®å®å‚éƒ½ä¼šè¢«æ¥æ”¶ä¸‹æ¥ï¼Œä¸”ä¼šä»¥å…ƒç»„çš„å½¢å¼ä¿å­˜ä¸‹æ¥èµ‹å€¼ç»™è¯¥å½¢å‚ã€‚è¿™é‡Œç”¨ *args</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">fun</span>(<span class="hljs-params">*args</span>):<br>    <span class="hljs-built_in">print</span>(*args)<br>foo(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>)<br><span class="hljs-comment"># output:</span><br><span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span><br>(<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>)<br></code></pre></td></tr></table></figure><ul><li>ã€å¯å˜é•¿å…³é”®å­—å‚æ•°ã€‘å¦‚æœåœ¨æœ€åä¸€ä¸ªå½¢å‚å‰é¢åŠ ä¸¤ä¸ªæ˜Ÿå· é‚£ä¹ˆåœ¨è°ƒç”¨å‡½æ•°çš„æ—¶å€™ï¼Œæº¢å‡ºçš„å…³é”®å­—ä»ç„¶éƒ½ä¼šè¢«æ¥æ”¶ï¼Œä¸”ä¼šä»¥å­—å…¸çš„å½¢å¼ä¿å­˜ä¸‹æ¥èµ‹å€¼ç»™è¯¥å½¢å‚ï¼Œä¸€èˆ¬ç”¨  **kwargsä¼ é€’</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">fun</span>(<span class="hljs-params">x,**kwargs</span>):<br>    <span class="hljs-built_in">print</span>(x)<br>    <span class="hljs-built_in">print</span>(kwargs)<br>foo(<span class="hljs-number">1</span>, y=<span class="hljs-number">2</span>, z=<span class="hljs-number">3</span>)<span class="hljs-comment"># æº¢å‡ºçš„å…³é”®å­—å®å‚y=2ï¼Œz=3éƒ½è¢«**æ¥æ”¶ï¼Œä»¥å­—å…¸çš„å½¢å¼ä¿å­˜ä¸‹æ¥ï¼Œèµ‹å€¼ç»™kwargs</span><br><span class="hljs-comment">#output:</span><br><span class="hljs-number">1</span><br>&#123;<span class="hljs-string">&#x27;z&#x27;</span>:<span class="hljs-number">3</span>, <span class="hljs-string">&#x27;y&#x27;</span>:<span class="hljs-number">2</span>&#125;<br></code></pre></td></tr></table></figure><ul><li>ã€è¡¥å……ä¸€ä¸‹ *argsçš„ç”¨æ³•ã€‘ å°†å¯è¿­ä»£å¯¹è±¡çš„å…ƒç´ æ‰“æ•£ä¼ å…¥å‡½æ•°</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">fun</span>(<span class="hljs-params">x,y</span>):<br>    <span class="hljs-built_in">print</span>(x+y)<br>list1=[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>]<br>fun(*list1) <span class="hljs-comment"># è¿™é‡Œä¼šå°†list1åˆ—è¡¨å†…çš„ä¸¤ä¸ªå…ƒç´ æ‰“æ•£ä¼ è¿›å‡½æ•°é‡Œé¢å»</span><br></code></pre></td></tr></table></figure><ul><li>ã€è¡¥å……ä¸€ä¸‹ **çš„ç”¨æ³•ã€‘ å¯ä»¥å°†å­—å…¸æ¯ä¸ªkey-valueæ‹†å¼€ä¸ºå…³é”®å­—ä¼ å‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">fun</span>(<span class="hljs-params">x,y</span>):<br>    <span class="hljs-built_in">print</span>(x+y)<br>    <br>nums = &#123;<span class="hljs-string">&quot;a&quot;</span>:<span class="hljs-number">1</span>,<span class="hljs-string">&quot;b&quot;</span>:<span class="hljs-number">2</span>&#125;<br>fun(**nums)<br></code></pre></td></tr></table></figure><h2 id="3-7-yieldã€é‡ç‚¹ã€‘"><a href="#3-7-yieldã€é‡ç‚¹ã€‘" class="headerlink" title="3.7 yieldã€é‡ç‚¹ã€‘"></a>3.7 yieldã€é‡ç‚¹ã€‘</h2><ul><li><p>æ™®é€šå‡½æ•°åœ¨è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œä¼šä»ä¸Šå¾€ä¸‹ä¾æ¬¡æ‰§è¡Œå‡½æ•°ä»£ç ã€‚é‡åˆ°returnè¯­å¥æ—¶ç«‹å³é€€å‡ºå‡½æ•°ä¸”è¿”å›è¿”å›å€¼ï¼Œå†æ¬¡è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„è¯•è¯•ï¼Œå‡½æ•°ä¼šå†æ¬¡ä»å¤´åˆ°å°¾æ‰§è¡Œä¸€é</p></li><li><p>å‡½æ•°ç”Ÿæˆå™¨è¢«è°ƒç”¨æ—¶ï¼Œä¹Ÿæ˜¯ä¼šä»ä¸Šå¾€ä¸‹æ‰§è¡Œä»£ç ï¼Œé‡åˆ°yieldè¯­å¥åï¼Œå†yieldä½ç½®å¤„æŒ‚èµ·å¹¶ä¸”è¿”å›yieldåçš„æ•°æ®å‡ºæ¥ã€‚æ­¤å‡½æ•°å†æ¬¡è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œä¼šä»æŒ‚èµ·ä½ç½®å¤„ï¼ˆä¹Ÿå°±æ˜¯yieldå¤„ï¼‰å†å¾€ä¸‹æ‰§è¡Œå‡½æ•°</p></li><li><p>ã€å‡½æ•°ç”Ÿæˆå™¨ã€‘å‡½æ•°ä½“åŒ…å«yieldå…³é”®å­—ï¼Œå°±æ˜¯å‡½æ•°ç”Ÿæˆå™¨</p></li><li><p>ç”Ÿæˆå™¨å¯¹è±¡ï¼ŒæŒ‡å¯¹è±¡å†…ç½®æœ‰<code>_iter__</code>__å’Œ <code>__nex__</code>tæ–¹æ³•ï¼Œæ‰€ä»¥ç”Ÿæˆå™¨æœ¬èº«å°±æ˜¯ä¸€ä¸ªè¿­ä»£å™¨ï¼Œå¯ä»¥è¢«forå¾ªç¯éå†</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">my_range</span>(<span class="hljs-params">start,end,step=<span class="hljs-number">1</span></span>):<br>    <span class="hljs-keyword">while</span> start&lt; end:<br>        <span class="hljs-keyword">yield</span> start<br>        start+=step<br>g=my_range(<span class="hljs-number">1</span>,<span class="hljs-number">5</span>)<br><span class="hljs-built_in">print</span>(g) <span class="hljs-comment"># ä¼šæ˜¾ç¤ºgæ˜¯ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡&lt;generator object my_range at 0x7f0ed8a31310&gt;</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">next</span>(g)) <span class="hljs-comment"># 1</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">next</span>(g)) <span class="hljs-comment"># 2</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">next</span>(g)) <span class="hljs-comment"># 3</span><br></code></pre></td></tr></table></figure><ul><li>ç”Ÿæˆå™¨å‡½æ•°çš„ä½¿ç”¨yiledè¯­å¥å®ç°çš„ï¼Œpythonçš„yieldè¡¨è¾¾å¼ä¹Ÿå¾ˆå¼ºå¤§ã€‚yieldä¸ä»…å¯ä»¥ä»å‡½æ•°ä½“å†…å¾€å¤–å–å€¼ï¼Œè¿˜å¯ä»¥ä»å¤–éƒ¨å¾€å‡½æ•°ä½“å†…ä¼ å€¼ï¼Œä¼ å€¼ä½¿ç”¨<code>generator.send(value)</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">eater</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Ready to eat&#x27;</span>)<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        food = <span class="hljs-keyword">yield</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;get the food: %s, and start to eat&#x27;</span> %food)<br><br><br>g = eater()<br><span class="hljs-built_in">next</span>(g)<span class="hljs-comment"># ä¼ å€¼å‰å¿…é¡»å…ˆè°ƒç”¨ä¸€æ¬¡ç”Ÿæˆå™¨ï¼Œè®©ç”Ÿæˆå™¨å…ˆæŒ‚èµ·æ¥ï¼Œç­‰å¾…æ¥æ”¶yieldèµ‹å€¼ç»™food</span><br>g.send(<span class="hljs-string">&#x27;åŒ…å­&#x27;</span>)   <span class="hljs-comment"># é€šè¿‡sendæ–¹æ³•å°†æ•°æ®ä¼ ç»™yieldèµ‹å€¼ç»™food,ç”Ÿæˆå™¨å†…éƒ¨æœ‰å¾ªç¯åˆä¼šå†æ¬¡è¢«æŒ‚èµ·</span><br>g.send(<span class="hljs-string">&#x27;ç‰›å¥¶&#x27;</span>)   <span class="hljs-comment"># sendï¼ˆï¼‰å¿…é¡»è¦æœ‰ä¸€ä¸ªå®å‚</span><br>g.send(<span class="hljs-literal">None</span>)<span class="hljs-comment"># å¦‚æœsendçš„æ˜¯Noneï¼Œåˆ™é»˜è®¤æ‰§è¡Œnext(g)</span><br></code></pre></td></tr></table></figure><h2 id="3-8-åŒ¿åå‡½æ•°"><a href="#3-8-åŒ¿åå‡½æ•°" class="headerlink" title="3.8 åŒ¿åå‡½æ•°"></a>3.8 åŒ¿åå‡½æ•°</h2><ul><li>åŒ¿åå‡½æ•°lambda å°±æ˜¯ä¸å‘½åçš„å‡½æ•°ï¼Œä¸€èˆ¬ç”¨äºä¸€æ¬¡æ€§ä½¿ç”¨çš„åœºæ™¯ï¼Œä¸å±äºä»»ä½•ç±»</li><li>å®šä¹‰æœ‰åå­—çš„å‡½æ•°ç”¨def å®šä¹‰æ²¡åå­—çš„å‡½æ•°ç”¨lambda</li><li>fun &#x3D; lambda å…¥å‚ : è¿”å›ç»“æœ lambda arguments: expression</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">fun</span>(<span class="hljs-params">x,y</span>):<br>    <span class="hljs-keyword">return</span> x+y<br>fun2=<span class="hljs-keyword">lambda</span> x,y:x+y <span class="hljs-comment"># å†’å·å‰é¢å†™å…¥å‚ï¼Œåé¢å†™è¿”å›ç»“æœ</span><br><span class="hljs-comment"># ç¤ºä¾‹äºŒ</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sq</span>(<span class="hljs-params">x</span>):<br>    <span class="hljs-keyword">return</span> x*x<br><span class="hljs-built_in">map</span>(sq,[y <span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>)]) <span class="hljs-comment"># mapç»„åˆï¼Œå‰é¢æ˜¯æ–¹æ³•ï¼Œåé¢æ˜¯ä¼ å‚</span><br><span class="hljs-comment"># ä½¿ç”¨lambda</span><br><span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> x:x*x , [y <span class="hljs-keyword">for</span> y <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>)]) <span class="hljs-comment"># é…åˆå†…ç½®å‡½æ•°ç”¨ï¼Œæ•ˆæœæä½³ï¼Œç®€æ´æœ‰æ•ˆ</span><br></code></pre></td></tr></table></figure><h2 id="3-9-å†…ç½®å‡½æ•°ä¹‹filter-å…¶å®æ˜¯ä¸€ä¸ªç±»"><a href="#3-9-å†…ç½®å‡½æ•°ä¹‹filter-å…¶å®æ˜¯ä¸€ä¸ªç±»" class="headerlink" title="3.9 å†…ç½®å‡½æ•°ä¹‹filter (å…¶å®æ˜¯ä¸€ä¸ªç±»)"></a>3.9 å†…ç½®å‡½æ•°ä¹‹filter (å…¶å®æ˜¯ä¸€ä¸ªç±»)</h2><ul><li>filteræ˜¯ä¸€ä¸ªç±»ï¼Œä¸æ˜¯ä¸€ä¸ªå‡½æ•°ï¼ŒæŸ¥çœ‹æºç å‘ç°</li><li>fulterçš„å…¥å‚æ˜¯ä¸¤ä¸ªï¼šfunction_or_Noneå’Œiterableå¯è¿­ä»£å¯¹è±¡ </li><li>å¦‚æœfunctionæ˜¯Noneçš„è¯ï¼Œå°±æŠ¥é”™</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">fun</span>(<span class="hljs-params">x</span>):<br>    <span class="hljs-keyword">return</span> x%<span class="hljs-number">2</span>==<span class="hljs-number">0</span><br>list1 = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>,<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>,<span class="hljs-number">12</span>,<span class="hljs-number">142</span>,<span class="hljs-number">352</span>,<span class="hljs-number">4235</span>,<span class="hljs-number">56</span>,<span class="hljs-number">57</span>,<span class="hljs-number">86</span>,<span class="hljs-number">12</span>,<span class="hljs-number">11</span>]<br>a = <span class="hljs-built_in">filter</span>(fun,list1)<span class="hljs-comment"># è¿™é‡Œè·å¾—çš„æ˜¯filterå¯¹è±¡ï¼Œè¦è½¬åŒ–æˆå¯¹åº”çš„åˆ—è¡¨</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">list</span>(a)) <span class="hljs-comment"># [2, 4, 6, 8, 10, 12, 142, 352, 56, 86, 12]</span><br><span class="hljs-comment"># ç”¨lambda å®ç° å®šä¹‰åŒ¿åæ–¹æ³•</span><br>a = <span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> x:x%<span class="hljs-number">2</span>==<span class="hljs-number">0</span>,list1)<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">list</span>(a))  <span class="hljs-comment"># [2, 4, 6, 8, 10, 12, 142, 352, 56, 86, 12]</span><br><br></code></pre></td></tr></table></figure><h3 id="3-9-2-å†…ç½®å‡½æ•°ä¹‹map"><a href="#3-9-2-å†…ç½®å‡½æ•°ä¹‹map" class="headerlink" title="3-9.2 å†…ç½®å‡½æ•°ä¹‹map"></a>3-9.2 å†…ç½®å‡½æ•°ä¹‹map</h3><p><code>map()</code> æ˜¯ Python çš„å†…ç½®å‡½æ•°ä¹‹ä¸€ï¼Œå®ƒç”¨äºå°†ä¸€ä¸ªå‡½æ•°åº”ç”¨äºä¸€ä¸ªæˆ–å¤šä¸ªå¯è¿­ä»£å¯¹è±¡ï¼ˆå¦‚åˆ—è¡¨ã€å…ƒç»„ç­‰ï¼‰çš„æ¯ä¸ªå…ƒç´ ï¼Œå¹¶è¿”å›ä¸€ä¸ªåŒ…å«ç»“æœçš„æ–°çš„è¿­ä»£å™¨ã€‚</p><p><code>map()</code> å‡½æ•°çš„å·¥ä½œåŸç†æ˜¯éå† <code>iterable</code> ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œå¹¶å°†æ¯ä¸ªå…ƒç´ ä¼ é€’ç»™ <code>function</code> è¿›è¡Œå¤„ç†ã€‚<code>function</code> å°†å¯¹æ¯ä¸ªå…ƒç´ æ‰§è¡ŒæŒ‡å®šçš„æ“ä½œï¼Œå¹¶è¿”å›ç»“æœã€‚æœ€åï¼Œ<code>map()</code> è¿”å›ä¸€ä¸ªæ–°çš„è¿­ä»£å™¨ï¼Œå…¶ä¸­åŒ…å«äº†ç»è¿‡ <code>function</code> å¤„ç†åçš„æ¯ä¸ªå…ƒç´ ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å°†åˆ—è¡¨ä¸­çš„æ¯ä¸ªå…ƒç´ å¹³æ–¹</span><br>numbers = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]<br>squared_numbers = <span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> x: x ** <span class="hljs-number">2</span>, numbers)<br><br><span class="hljs-comment"># æ‰“å°ç»“æœ</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">list</span>(squared_numbers))  <span class="hljs-comment"># è¾“å‡º: [1, 4, 9, 16, 25]</span><br></code></pre></td></tr></table></figure><h2 id="3-10-å†…ç½®å‡½æ•°å€¼enumerate"><a href="#3-10-å†…ç½®å‡½æ•°å€¼enumerate" class="headerlink" title="3.10 å†…ç½®å‡½æ•°å€¼enumerate"></a>3.10 å†…ç½®å‡½æ•°å€¼enumerate</h2><ul><li>enumerateçœ‹æºç ï¼Œå…¥å‚æ˜¯ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼Œå’Œä¸€ä¸ªé»˜è®¤ä¸º0çš„startèµ·å§‹å€¼ï¼Œ</li><li>è¿”å›ï¼šä»¥å…ƒç»„å½¢å¼è¿”å›enumerateå¯¹è±¡ï¼Œå…ƒç»„å†…æ˜¯ï¼ˆä¸‹æ ‡ç´¢å¼•ï¼Œå€¼ï¼‰çš„å½¢å¼ï¼Œ</li><li>å¯ä»¥é€šè¿‡ç»™startä¼ å‚å®šä¹‰èµ·å§‹ä½ç½®çš„ç´¢å¼•å€¼</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">name=[<span class="hljs-string">&#x27;asd&#x27;</span>,<span class="hljs-string">&#x27;asda&#x27;</span>,<span class="hljs-string">&#x27;qweq&#x27;</span>,<span class="hljs-string">&#x27;fgdb&#x27;</span>]<br><span class="hljs-keyword">for</span> index value <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(name,start=<span class="hljs-number">0</span>): <span class="hljs-comment"># é»˜è®¤ä¸‹æ ‡èµ·å§‹å€¼æ˜¯0</span><br>    <span class="hljs-built_in">print</span>(index,value) <span class="hljs-comment"># (0,&#x27;asd&#x27;),(1,&#x27;asda&#x27;),(2,&#x27;qweq&#x27;),(3,&#x27;fgdb&#x27;),</span><br></code></pre></td></tr></table></figure><h2 id="3-11-æ¨¡å—çš„æœ¬è´¨"><a href="#3-11-æ¨¡å—çš„æœ¬è´¨" class="headerlink" title="3.11 æ¨¡å—çš„æœ¬è´¨"></a>3.11 æ¨¡å—çš„æœ¬è´¨</h2><ul><li>ä¸€ä¸ªpythonæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œ</li><li>æ¨¡å—æ˜¯ä¸€å †åŠŸèƒ½çš„é›†åˆï¼Œç®—æ˜¯ä¸€ç§ä»£ç â€œå°è£…â€çš„æ–¹å¼</li><li>å†…ç½®æ¨¡å—ï¼Œç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œè‡ªå®šä¹‰æ¨¡å—ã€‚å…¶å®å°±æ˜¯å„ç§æ–‡ä»¶</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># pythonä¸‰ç±»æ¨¡å—ï¼š</span><br><span class="hljs-comment"># å†…ç½®æ¨¡å—ï¼špythonè§£é‡Šå™¨è‡ªå¸¦çš„æ¨¡å—ï¼Œç›´æ¥ä½¿ç”¨</span><br><span class="hljs-comment"># ç¬¬ä¸‰æ–¹æ¨¡å—ï¼špythonç¤¾åŒºä¼™ä¼´ä»¬å¼€æºæä¾›çš„pythonæ¨¡å—ï¼Œéœ€è¦ä¸‹è½½åä½¿ç”¨</span><br><span class="hljs-comment"># è‡ªå®šä¹‰æ¨¡å—ï¼šè‡ªå®šä¹‰æ¨¡å—æŒ‡çš„æ˜¯æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„è„šæœ¬æ–‡ä»¶ï¼Œæ–‡ä»¶åå°±æ˜¯æ¨¡å—åï¼Œå¦‚ get_sum.pyï¼Œget_sumå°±æ˜¯æ¨¡å—å</span><br></code></pre></td></tr></table></figure><ul><li>æ¨¡å—å…ˆå¯¼å…¥åä½¿ç”¨ã€‚å¯¼å…¥æ¨¡å—çš„æ–¹å¼ï¼š<code>importã€fromã€æˆ–ä¸¤è€…é…åˆä½¿ç”¨</code>-</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å¯¼å…¥æ¨¡å—çš„æ–¹å¼</span><br>- æ–¹å¼<span class="hljs-number">1</span>ï¼š<span class="hljs-keyword">import</span> module_name<br>- æ–¹å¼<span class="hljs-number">2</span>ï¼š<span class="hljs-keyword">from</span> modele_name <span class="hljs-keyword">import</span> model_content1, modele_content2, ...<br>- æ–¹å¼<span class="hljs-number">3</span>ï¼š<span class="hljs-keyword">from</span> model_name <span class="hljs-keyword">import</span> *<br>- æ–¹å¼<span class="hljs-number">4</span>ï¼š<span class="hljs-keyword">import</span> modele_name <span class="hljs-keyword">as</span> nickname<br><br><span class="hljs-comment"># å¯¼å…¥ä½ç½®</span><br>- æ–‡ä»¶å¤´ï¼šæ–‡ä»¶å¼€å¤´å¯¼å…¥çš„æ¨¡å—å±äºå…¨å±€ä½œç”¨åŸŸ<br>- å‡½æ•°å†…ï¼šå‡½æ•°å†…å¯¼å…¥çš„æ¨¡å—å±äºå±€éƒ¨çš„ä½œç”¨åŸŸ<br></code></pre></td></tr></table></figure><ul><li>å¯¼å…¥æ¨¡å—çš„æœ¬è´¨</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 1ã€äº§ç”Ÿä¸€ä¸ªæ–°çš„åç§°ç©ºé—´ï¼ˆåå­—æ˜¯è¢«å¯¼å…¥æ¨¡å—åï¼‰ï¼›</span><br><span class="hljs-comment"># 2ã€æ‰§è¡Œè¢«å¯¼å…¥æ¨¡å—æºæ–‡ä»¶ä»£ç ï¼Œå°†äº§ç”Ÿçš„åå­—å­˜æ”¾åœ¨æ–°çš„åç§°ç©ºé—´ä¸­ï¼›</span><br><span class="hljs-comment"># 3ã€å°†æ¨¡å—åç§°ç©ºé—´çš„åå­—æ·»åŠ åˆ°å½“å‰æ‰§è¡Œæ–‡ä»¶æ‰€çš„åç§°ç©ºé—´ä¸­</span><br><br><span class="hljs-comment"># è¡¥å……ï¼š</span><br>- å¯¼å…¥æ–¹å¼ï¼š<span class="hljs-keyword">import</span> ..ï¼Œåœ¨å½“å‰æ‰§è¡Œæ–‡ä»¶çš„åç§°ç©ºé—´ä¸­æ”¾ä¸€ä¸ªè¢«å¯¼å…¥æ¨¡å—çš„åå­—ï¼Œé€šè¿‡è¿™ä¸ªåå­—å¼•ç”¨æ¨¡å—ä¸­çš„åå­—ã€‚<br>-å¯¼å…¥æ–¹å¼ï¼š<span class="hljs-keyword">from</span> .. <span class="hljs-keyword">import</span>..ï¼Œåœ¨å½“å‰æ‰§è¡Œæ–‡ä»¶çš„åç§°ç©ºé—´ä¸­ç›´æ¥æ”¾ä¸€ä¸ªæ¨¡å—ä¸­çš„åå­—ï¼Œä¸èƒ½è®¿é—®æ¨¡å—çš„å…¶ä»–åå­—ã€‚ <br></code></pre></td></tr></table></figure><ul><li>æ¨¡å—çš„æœ¬è´¨å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ä¸ªå‘½åç©ºé—´ï¼ˆNamespaceï¼‰</li><li>å‘½åç©ºé—´ç›¸äº’éš”ç¦»çš„ï¼Œè¿™ä¸ªå‘½åäº†çš„ç©ºé—´ä¸‹é¢çš„ä¸œè¥¿ï¼Œå°±åªå±äºè¿™ä¸ªå‘½åç©ºé—´</li><li>import å¯¼å…¥ï¼Œå°±æ˜¯å¯¼å…¥äº†ä¸€ä¸ªå‘½åç©ºé—´ï¼Œå°±æ˜¯å¯¼å…¥äº†ä¸€ä¸ªpyæ–‡ä»¶</li></ul><h2 id="3-12-pyæ–‡ä»¶çš„ä¸¤ç§ç”¨é€”"><a href="#3-12-pyæ–‡ä»¶çš„ä¸¤ç§ç”¨é€”" class="headerlink" title="3.12 pyæ–‡ä»¶çš„ä¸¤ç§ç”¨é€”"></a>3.12 pyæ–‡ä»¶çš„ä¸¤ç§ç”¨é€”</h2><ul><li>1ã€å½“è„šæœ¬è¢«æ‰§è¡Œ</li><li>2ã€å½“æ¨¡å—è¢«å¯¼å…¥ä½¿ç”¨</li><li>åŒºåˆ«ï¼š<ul><li>è„šæœ¬æ–‡ä»¶æ‰§è¡Œçš„æ—¶å€™ï¼Œäº§å“çš„å‘½åç©ºé—´ä¼šåœ¨ç¨‹åºè§£é‡Šåå¤±æ•ˆå›æ”¶</li><li>æ¨¡å—å¯¼å…¥è¿è¡Œçš„è¯•è¯•ï¼Œäº§ç”Ÿçš„å‘½åç©ºé—´ä¼šåœ¨å¼•ç”¨è®¡æ•°ä¸ºé›¶çš„æ—¶å€™å›æ”¶é‡Šæ”¾ã€‚</li></ul></li><li>æ¯ä¸€ä¸ªpyæ–‡ä»¶éƒ½æœ‰ä¸€ä¸ªå±æ€§ï¼š<code>__name___</code>    è¿™ä¸ªä¸æ˜¯ä»–çš„å‘½åç©ºé—´ </li><li>å½“pyæ–‡ä»¶è¢«å½“åšæ¨¡å—å¯¼å…¥çš„æ—¶å€™ï¼Œ<code>__name__</code> &#x3D;&#x3D;â€æ¨¡å—åâ€</li><li>æ‰€ä»¥<code>if __name__=â€œ__main__â€</code>æ—¶ï¼Œå°±æ„å‘³ç€è¯¥æ¨¡å—æ˜¯ä¸»ç¨‹åºå…¥å£</li></ul><h2 id="3-13-åŒ…çš„æœ¬è´¨"><a href="#3-13-åŒ…çš„æœ¬è´¨" class="headerlink" title="3.13 åŒ…çš„æœ¬è´¨"></a>3.13 åŒ…çš„æœ¬è´¨</h2><ul><li>åŒ…ï¼š å°±æ˜¯ä¸€å †æ¨¡å—çš„é›†åˆï¼Œé‚£å•ä¸ªæ¨¡å—æ˜¯å•ä¸ªpyæ–‡ä»¶ï¼Œé‚£åŒ…å°±æ˜¯å¥½å¤šæ–‡ä»¶çš„é›†åˆï¼Œå°±æ˜¯æ–‡ä»¶å¤¹ï¼Œä¸”åŒ…å«ä¸€ä¸ª<code>.__init__</code>æ–‡ä»¶</li><li>å¯¼å…¥åŒ…ï¼Œèµ·å§‹å°±æ˜¯å¯¼å…¥åŒ…å†…initæ–‡ä»¶</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># åŒ…æ˜¯ä¸€ä¸ªåŒ…å«__init__.pyæ–‡ä»¶çš„æ–‡ä»¶å¤¹ã€‚package</span><br><span class="hljs-comment"># å¯¹äºæ™®é€šæ¨¡å—ï¼ˆä¸€ä¸ªpyæ–‡ä»¶ï¼‰ï¼Œä¼šå‘ç”Ÿä¸‰ä»¶äº‹ï¼Œå…¶ä¸­ä¸€ä»¶äº‹å°±æ˜¯æ‰§è¡Œæ¨¡å—æ–‡ä»¶çš„ä»£ç ã€‚</span><br><span class="hljs-comment"># åŒ…æ˜¯ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œä¸èƒ½æ˜¯æ™®é€šæ¨¡å—é‚£æ ·è¢«æ‰§è¡Œä»£ç ï¼Œæ‰€ä»¥ç»™åŒ…æä¾›äº†ä¸€ä¸ª__init__.pyæ–‡ä»¶ï¼Œå¯¼å…¥åŒ…å°±ä¼šæ‰§è¡Œ__init__.pyæ–‡ä»¶ï¼Œè¿™ä¹Ÿæ˜¯__init__.pyæ–‡ä»¶æ‘çš„æ„ä¹‰ã€‚</span><br><span class="hljs-comment"># python3ä¸­ï¼Œæ–‡ä»¶å¤¹æ²¡æœ‰__init__.pyä¹Ÿå¯ä»¥ï¼Œä½†æ˜¯åœ¨python2ä¸­åŒ…å¿…é¡»è¦æœ‰è¯¥æ–‡ä»¶ã€‚</span><br>- tools<br>__init__.py<br>    calculate.py<br>- main.py<br></code></pre></td></tr></table></figure><ul><li>å¯¼å…¥åŒ…å°±æ˜¯å¯¼å…¥åŒ…å†…çš„<code>__init__.py</code>æ–‡ä»¶</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#1 åŒ…çš„å¯¼å…¥æ–¹å¼å’Œæ¨¡å—çš„ä¸€æ ·ï¼šimport å’Œ from...import..ä¸¤ç§</span><br>- æ— è®ºä½•ç§æ–¹å¼ï¼Œæ— è®ºä»»ä½•ä½ç½®ï¼Œå¯¼å…¥æ—¶å¸¦ç‚¹çš„ï¼Œç‚¹çš„å·¦è¾¹éƒ½å¿…é¡»æ˜¯ä¸€ä¸ªåŒ…ã€‚<br><span class="hljs-comment">#2 åŒ…Aå’ŒåŒ…Bä¸‹æœ‰åŒåæ¨¡å—ä¹Ÿä¸ä¼šå†²çªï¼Œå¦‚A.aä¸B.aæ¥è‡ªä¿©ä¸ªå‘½åç©ºé—´</span><br><span class="hljs-comment">#3 importå¯¼å…¥æ–‡ä»¶æ—¶ï¼Œäº§ç”Ÿåç§°ç©ºé—´ä¸­çš„åå­—æ¥æºäºæ–‡ä»¶ï¼Œimport åŒ…ï¼Œäº§ç”Ÿçš„åç§°ç©ºé—´çš„åå­—åŒæ ·æ¥æºäºæ–‡ä»¶ï¼Œå³åŒ…ä¸‹çš„__init__.pyï¼Œå¯¼å…¥åŒ…æœ¬è´¨å°±æ˜¯åœ¨å¯¼å…¥è¯¥æ–‡ä»¶</span><br></code></pre></td></tr></table></figure><ul><li>ä¸ç®¡æ˜¯importåŒ…å.æ¨¡å—å è¿˜æ˜¯from åŒ…å importæ¨¡å—åï¼Œå¸¦ç‚¹çš„æ—¶å€™ï¼Œç‚¹çš„å‰é¢éƒ½æ˜¯åŒ…å</li></ul>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€pythonã€‘è¿›é˜¶ä¹‹æ•°æ®ç»“æ„ï¼ˆäºŒï¼‰</title>
    <link href="/2024/03/18/602python%E8%BF%9B%E9%98%B6%E4%B9%8B%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
    <url>/2024/03/18/602python%E8%BF%9B%E9%98%B6%E4%B9%8B%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="2-æ•°æ®ç»“æ„"><a href="#2-æ•°æ®ç»“æ„" class="headerlink" title="2 æ•°æ®ç»“æ„"></a>2 æ•°æ®ç»“æ„</h1><h2 id="2-1åŸºæœ¬æ•°æ®ç»“æ„"><a href="#2-1åŸºæœ¬æ•°æ®ç»“æ„" class="headerlink" title="2.1åŸºæœ¬æ•°æ®ç»“æ„"></a>2.1åŸºæœ¬æ•°æ®ç»“æ„</h2><p>å¯å˜ï¼šåˆ—è¡¨ã€å­—å…¸ã€é›†åˆ</p><p>ä¸å¯å˜ï¼šæ•°å­—ã€æµ®ç‚¹ã€å­—ç¬¦ä¸²ã€å…ƒç»„ï¼ˆéœ€å…ƒç»„å†…æ— å¯å˜ï¼‰</p><p>ç›´æ¥è®¿é—®ï¼šæ•°å­—</p><p>é¡ºåºè®¿é—®ï¼ˆåºåˆ—ç±»å‹ï¼‰ï¼šå­—ç¬¦ä¸²ã€åˆ—è¡¨ã€å…ƒç»„</p><p>Keyå€¼è®¿é—®ï¼ˆæ˜ å°„å…³ç³»ï¼‰ï¼šå­—å…¸ </p><h2 id="2-2-æ·±æµ…æ‹·è´"><a href="#2-2-æ·±æµ…æ‹·è´" class="headerlink" title="2.2 æ·±æµ…æ‹·è´"></a>2.2 æ·±æµ…æ‹·è´</h2><p>ã€ä»€ä¹ˆæ˜¯æ‹·è´ã€‘ï¼šåŸå°ä¸åŠ¨åœ°å¤åˆ¶ä¸€ä»½æ–°çš„ï¼Œåœ¨ä¸åŒçš„å†…å­˜åœ°å€ä¸Šï¼Œä¿®æ”¹æ—§çš„ä¸ä¼šå½±å“æ–°çš„ã€‚</p><p>å˜é‡èµ‹å€¼ä¸æ˜¯æ‹·è´</p><p><img src="/../img/python/image-20220419175739670.png" alt="image-20220419175739670.png"></p><ul><li><p>å˜é‡èµ‹å€¼ä¸æ˜¯æ‹·è´æ“ä½œï¼Œå› ä¸ºå˜é‡å<code>list1</code>å’Œå˜é‡å<code>list2</code>æŒ‡å‘çš„æ˜¯ä¸€å—ç›¸åŒçš„å†…å­˜åœ°å€</p></li><li><p>èµ‹å€¼æ“ä½œåï¼Œæ— è®ºæ˜¯é€šè¿‡<code>list1</code>è¿˜æ˜¯<code>list2</code>ä¿®æ”¹åˆ—è¡¨çš„å…ƒç´ ï¼Œéƒ½ä¼šå½±å“å¯¹æ–¹ã€‚</p></li><li><p>æµ…æ‹·è´ä¿®æ”¹åŸå§‹æ•°æ®ä¼šå½±å“å¯¹æ–¹</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">list1 = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, [<span class="hljs-number">11</span>, <span class="hljs-number">22</span>]]<br>list2 = list1.copy()<span class="hljs-comment"># ä½¿ç”¨åˆ—è¡¨çš„copyæ–¹æ³•æˆ–ä½¿ç”¨copyæ¨¡å—ä¸­çš„copyæ–¹æ³•ï¼Œéƒ½æ˜¯æµ…æ‹·è´</span><br><br><span class="hljs-comment"># æµ…æ‹·è´åï¼šid(list1) ä¸ç­‰äº id(list2)ï¼Œè¯´æ˜æ‹·è´äº†ä¸€ä¸ªæ–°åˆ—è¡¨ã€‚</span><br></code></pre></td></tr></table></figure><p><img src="/../img/python/image-20220419180226331.png" alt="image-20220419180226331"></p><ul><li>æ‰§è¡Œæµ…æ‹·è´æ“ä½œï¼Œå°†åœ¨å¼€è¾Ÿä¸€å—æ–°çš„å†…å­˜ç©ºé—´ï¼Œç„¶åå°†<code>list2</code>ç»‘å®šåˆ°è¿™å—å†…å­˜ç©ºé—´ä¸Šã€‚</li><li>æ–°å†…å­˜ç©ºé—´ä¸­æœ‰ä¸‰ä¸ªä½ç½®ç”¨æ¥å­˜æ”¾å…¶ä¸‰ä¸ªå…ƒç´ çš„å†…å­˜åœ°å€ã€‚</li><li>æ–°æ‹·è´çš„åˆ—è¡¨çš„ä¸‰ä¸ªä½ç½®åˆ†åˆ«ç»‘å®šæ—§åˆ—è¡¨ä¸‰ä¸ªä½ç½®ä¸Šçš„å…ƒç´ çš„å†…å­˜åœ°å€ã€‚</li><li>æ‰€ä»¥ä¿®æ”¹æ—§åˆ—è¡¨çš„ä¸­çš„å­—åˆ—è¡¨æ—¶ï¼Œä¼šå½±å“æ–°åˆ—è¡¨ä¸­çš„å€¼ï¼Œå› ä¸ºå®ƒä»¬è¿˜åŒæ­¥ä¸€éƒ¨åˆ†å†…å­˜ç©ºé—´ã€‚</li></ul><p>ã€æ·±æ‹·è´ã€‘ï¼šä½¿ç”¨copy.deepcopy()</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> copy<span class="hljs-comment"># å¯¼å…¥å†…ç½®copyæ¨¡å—</span><br>list1 = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, [<span class="hljs-number">11</span>, <span class="hljs-number">22</span>]]<br>list2 = copy.deepcopy(list1)<span class="hljs-comment"># è°ƒç”¨deepcopy()å®ç°æ·±æ‹·è´</span><br></code></pre></td></tr></table></figure><p><img src="/./img/python/image-20220419180757393.png" alt="image-20220419180757393"></p><ul><li>æ·±æ‹·è´æ—¶ï¼Œå½“å…ƒç´ æ˜¯å¯å˜æ•°æ®ç±»å‹æ—¶ï¼Œä¼šé‡æ–°å¼€è¾Ÿä¸€å—å†…å­˜ç©ºé—´ï¼Œå­˜æ”¾è¿™ä¸ªå…ƒç´ å¯¹è±¡çš„å†…å­˜åœ°å€ï¼Œä¸”è¯¥å…ƒç´ å†…éƒ¨çš„å¯å˜æ•°æ®ç±»å‹ä¹Ÿä¼šå†é‡æ–°å¼€è¾Ÿå†…å­˜ç©ºé—´ï¼Œå±‚å±‚æ£€æµ‹ï¼Œå±‚å±‚æ‹·è´ã€‚</li><li>æ­¤æ—¶ï¼Œæ–°æ—§åˆ—è¡¨çš„å­å…ƒç´ éƒ½ä¸ä¼šå…±äº«å†…å­˜åœ°å€ï¼Œæ‰€æœ‰ä¸ä¼šç›¸äº’å½±å“ã€‚</li></ul><p>æ·±æ‹·è´ä¸ä¼šï¼Œäº’ç›¸ç‹¬ç«‹çš„</p><p>ã€æ€»ç»“ã€‘</p><ul><li>æ·±æµ…æ‹·è´è®¨è®ºçš„æ‹·è´å¯¹è±¡æ˜¯å¯å˜æ•°æ®ç±»å‹</li><li>æ·±æµ…æ‹·è´çš„åŒºåˆ«åœ¨äºï¼šæ˜¯å¦åŒºåˆ†å…ƒç´ çš„å¯å˜è¿˜æ˜¯ä¸å¯å˜ç±»å‹çš„åˆ¤æ–­;</li><li>åˆ—è¡¨çš„åˆ‡ç‰‡ä¹Ÿæ˜¯æµ…æ‹·è´ï¼Œcopyæ¨¡å—çš„<code>copy.copy()</code>å‡½æ•°æ˜¯æµ…æ‹·è´æ“ä½œï¼Œå’Œåˆ—è¡¨çš„å†…ç½®æ–¹æ³•<code>copy()</code>åŠŸèƒ½ç›¸åŒã€‚</li><li>å®¹å™¨å‹æ•°æ®ç±»å‹çš„æ‹·è´éƒ½å­˜åœ¨æ·±æµ…æ‹·è´é—®é¢˜ã€‚</li><li>æ·±æµ…æ‹·è´æ²¡æœ‰æœ‰ä¼˜ç¼ºç‚¹ã€‚</li></ul><h2 id="2-3-æ¨å¯¼å¼"><a href="#2-3-æ¨å¯¼å¼" class="headerlink" title="2.3 æ¨å¯¼å¼"></a>2.3 æ¨å¯¼å¼</h2><p>ã€æ¨å¯¼å¼ã€‘ä¹Ÿæˆç”Ÿæˆå¼ï¼ˆcomprehensionsï¼‰æ˜¯ Python ç‹¬æœ‰çš„ä¸€ç§é«˜çº§ç‰¹æ€§ï¼Œå®ƒå¯ä»¥ä½¿ç”¨ç®€å•çš„ä¸€è¡Œä»£ç å®ç°åˆ—è¡¨ã€å­—å…¸ç­‰æ•°æ®ç±»å‹çš„åˆ›å»ºæˆ–æ•°æ®ç±»å‹çš„è½¬æ¢ç­‰ä»»åŠ¡ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æ™®é€šå†™æ³•ï¼š</span><br>nums = []<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">101</span>):<br>    nums.append(i*i)<br><br><span class="hljs-comment"># æ¨å¯¼å¼å†™æ³•ï¼š</span><br>nums = [i*i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">101</span>)]<br></code></pre></td></tr></table></figure><p>ã€åˆ—è¡¨æ¨å¯¼å¼ã€‘</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ã€åˆ—è¡¨æ¨å¯¼å¼ã€‘</span><br><span class="hljs-comment"># æ–¹å¼1</span><br>nums = [i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>) <span class="hljs-keyword">if</span> i % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>]<br><br><span class="hljs-comment"># æ–¹å¼2</span><br>a = &#123;<span class="hljs-string">&quot;name&quot;</span>:<span class="hljs-string">&quot;jack&quot;</span>, <span class="hljs-string">&quot;age&quot;</span>: <span class="hljs-number">18</span>&#125;<br>keys = [key <span class="hljs-keyword">for</span> key <span class="hljs-keyword">in</span> a]<br></code></pre></td></tr></table></figure><p>ã€å­—æ®µæ¨å¯¼å¼ã€‘</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æ–¹å¼1</span><br>nums = &#123;i: i*<span class="hljs-number">2</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>)&#125;<br><br><span class="hljs-comment"># æ–¹å¼2</span><br>li = [[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>], (<span class="hljs-number">3</span>,<span class="hljs-number">4</span>)]<br><span class="hljs-built_in">dict</span>(x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> li)<span class="hljs-comment"># &#123;1: 2, 3: 4&#125;</span><br></code></pre></td></tr></table></figure><p>ã€é›†åˆæ¨å¯¼å¼ã€‘</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æ–¹å¼1</span><br>b = &#123;i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">5</span>)&#125;<br><br><span class="hljs-comment"># æ–¹å¼2</span><br>a = <span class="hljs-built_in">set</span>(i <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">5</span>))<br></code></pre></td></tr></table></figure><p>ã€å…ƒç»„æ¨å¯¼å¼ã€‘</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æ–¹å¼1</span><br><span class="hljs-built_in">tuple</span>(x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">5</span>))<span class="hljs-comment"># (1, 2, 3, 4)</span><br><br><span class="hljs-comment"># æ•°æ®ç±»å‹è½¬æ¢</span><br>nums = [<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>]<br><span class="hljs-built_in">tuple</span>(x <span class="hljs-keyword">for</span> x <span class="hljs-keyword">in</span> nums)<span class="hljs-comment"># (3, 4, 5, 6)</span><br><br><span class="hljs-comment"># å…ƒç»„æ¨å¯¼å¼ï¼ŒæŒ‰ç†è¯´åº”è¯¥ä½¿ç”¨()å®šä¹‰ï¼Œæ‹¬å·å†…å¾ªç¯çš„æ–¹å¼ç”Ÿæˆå…ƒç»„ç”Ÿæˆå¼ï¼Œ</span><br><span class="hljs-comment"># ä½†æ˜¯()è¢«pythonä¸­çš„ç”Ÿæˆå™¨å ç”¨ï¼Œæ‰€ä»¥åªèƒ½ä½¿ç”¨tuple</span><br></code></pre></td></tr></table></figure><p>list_a &#x3D; [m for i in iterable for m in i ]</p><h3 id="2-4-1-ä¸‰å…ƒè¡¨è¾¾å¼"><a href="#2-4-1-ä¸‰å…ƒè¡¨è¾¾å¼" class="headerlink" title="2.4.1 ä¸‰å…ƒè¡¨è¾¾å¼"></a>2.4.1 ä¸‰å…ƒè¡¨è¾¾å¼</h3><p>åœ¨Pythonä¸­ï¼Œä¸‰å…ƒè¡¨è¾¾å¼æ˜¯ä¸€ç§ç®€æ´çš„æ¡ä»¶è¡¨è¾¾å¼ï¼Œç”¨äºæ ¹æ®æ¡ä»¶é€‰æ‹©ä¸åŒçš„å€¼ã€‚å®ƒçš„è¯­æ³•å½¢å¼å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">value_if_true <span class="hljs-keyword">if</span> condition <span class="hljs-keyword">else</span> value_if_false<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œ<code>condition</code> æ˜¯ä¸€ä¸ªæ¡ä»¶è¡¨è¾¾å¼ï¼Œå¦‚æœæ¡ä»¶ä¸ºçœŸï¼Œåˆ™è¿”å› <code>value_if_true</code>ï¼›å¦åˆ™è¿”å› <code>value_if_false</code>ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">x = <span class="hljs-number">10</span><br>y = <span class="hljs-number">20</span><br><br>max_value = x <span class="hljs-keyword">if</span> x &gt; y <span class="hljs-keyword">else</span> y<br><span class="hljs-built_in">print</span>(max_value)  <span class="hljs-comment"># è¾“å‡º 20</span><br></code></pre></td></tr></table></figure><p>ä¸‰å…ƒè¡¨è¾¾å¼é€šå¸¸ç”¨äºç®€å•çš„æ¡ä»¶é€‰æ‹©ï¼Œå¯ä»¥åœ¨ä¸€è¡Œä»£ç ä¸­å¿«é€Ÿè¿›è¡Œæ¡ä»¶åˆ¤æ–­å’Œå€¼çš„é€‰æ‹©ã€‚å®ƒæ¯”ä½¿ç”¨å®Œæ•´çš„ <code>if-else</code> è¯­å¥æ›´ä¸ºç®€æ´å’Œç´§å‡‘ã€‚</p><h2 id="2-4-namedtuple-æœ‰åå…ƒç»„ã€é‡ç‚¹ã€‘"><a href="#2-4-namedtuple-æœ‰åå…ƒç»„ã€é‡ç‚¹ã€‘" class="headerlink" title="2.4 namedtuple æœ‰åå…ƒç»„ã€é‡ç‚¹ã€‘"></a>2.4 namedtuple æœ‰åå…ƒç»„ã€é‡ç‚¹ã€‘</h2><p>å¯ä»¥æƒ³è±¡æˆä¸€ä¸ªå…ƒç»„ä½†æ˜¯ä»–æœ‰åå­—ï¼Œä¹Ÿå«å…·åå…ƒç»„</p><p>å…¼é¡¾å…ƒç»„çš„ç‰¹æ€§ï¼Œä¸€æ—¦å®šä¹‰ä¸èƒ½è¢«ä¿®æ”¹</p><p>å¯ä»¥é€šè¿‡å¯¹è±¡ç‚¹çš„æ–¹å¼è®¿é—®ï¼Œã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> namedtuple<br><br>Point = namedtuple(<span class="hljs-string">&quot;Point&quot;</span>, [<span class="hljs-string">&quot;x&quot;</span>, <span class="hljs-string">&quot;y&quot;</span>])<span class="hljs-comment"># æ–°å»ºä¸€ä¸ªPointç±»å‹ï¼Œå…·æœ‰x yä¸¤ä¸ªå­—æ®µ</span><br>p = Point(<span class="hljs-number">11</span>, y=<span class="hljs-number">22</span>)<span class="hljs-comment"># å®ä¾‹åŒ–p  11èµ‹å€¼ç»™x, 22èµ‹å€¼ç»™y</span><br><br><span class="hljs-built_in">print</span>(p[<span class="hljs-number">0</span>], p[<span class="hljs-number">1</span>])<br><span class="hljs-built_in">print</span>(p.x, p.y)<span class="hljs-comment"># å±æ€§å–å€¼</span><br><span class="hljs-built_in">print</span>(p._asdict())<span class="hljs-comment"># è¿”å›ä¸€ä¸ªå­—å…¸ï¼š&#123;&quot;x&quot;: 11, &quot;y&quot;: 22&#125;</span><br><br>d = &#123;<span class="hljs-string">&quot;x&quot;</span>: <span class="hljs-number">11</span>, <span class="hljs-string">&quot;y&quot;</span>: <span class="hljs-number">22</span>&#125;<br><span class="hljs-built_in">print</span>(Point(**d))<span class="hljs-comment"># é€šè¿‡å­—å…¸æ–°å»º è¿™ä¸ªå¥½ç”¨</span><br><br>p._replace(x=<span class="hljs-number">100</span>)<span class="hljs-comment"># è¿”å›ä¸€ä¸ªæ–°namedtuple</span><br></code></pre></td></tr></table></figure><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> namedtuple<br><br><span class="hljs-comment"># å®šä¹‰æœ‰åå…ƒç»„çš„ç±»</span><br>Person = namedtuple(<span class="hljs-string">&#x27;Person&#x27;</span>, [<span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-string">&#x27;age&#x27;</span>, <span class="hljs-string">&#x27;city&#x27;</span>])<br><br><span class="hljs-comment"># åŸå§‹å­—å…¸</span><br>person_dict = &#123;<br>    <span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;Alice&#x27;</span>,<br>    <span class="hljs-string">&#x27;age&#x27;</span>: <span class="hljs-number">25</span>,<br>    <span class="hljs-string">&#x27;city&#x27;</span>: <span class="hljs-string">&#x27;New York&#x27;</span><br>&#125;<br><br><span class="hljs-comment"># å°†å­—å…¸è½¬æ¢ä¸ºæœ‰åå…ƒç»„</span><br>person_tuple = Person(**person_dict)<br><br><span class="hljs-built_in">print</span>(person_tuple.name)  <span class="hljs-comment"># è¾“å‡º &#x27;Alice&#x27;</span><br><span class="hljs-built_in">print</span>(person_tuple.age)   <span class="hljs-comment"># è¾“å‡º 25</span><br><span class="hljs-built_in">print</span>(person_tuple.city)  <span class="hljs-comment"># è¾“å‡º &#x27;New York&#x27;</span><br></code></pre></td></tr></table></figure><p>é¦–å…ˆé€šè¿‡ <code>namedtuple</code> å‡½æ•°å®šä¹‰äº†ä¸€ä¸ªåä¸º <code>Person</code> çš„æœ‰åå…ƒç»„ç±»ï¼Œå®ƒæœ‰ä¸‰ä¸ªå­—æ®µï¼š<code>name</code>ã€<code>age</code> å’Œ <code>city</code>ã€‚ç„¶åï¼Œå®šä¹‰äº†ä¸€ä¸ªå­—å…¸ <code>person_dict</code>ï¼ŒåŒ…å«äº†ç›¸åº”çš„å­—æ®µå€¼ã€‚æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ <code>**</code> è¿ç®—ç¬¦å°†å­—å…¸ä¸­çš„é”®å€¼å¯¹ä½œä¸ºå‚æ•°ä¼ é€’ç»™ <code>Person</code> ç±»çš„æ„é€ å‡½æ•°ï¼Œåˆ›å»ºäº†ä¸€ä¸ªæœ‰åå…ƒç»„å¯¹è±¡ <code>person_tuple</code>ã€‚</p><p>ä¼˜ç‚¹ï¼šé€šè¿‡è®¿é—®æœ‰åå…ƒç»„å¯¹è±¡çš„å­—æ®µï¼Œå¯ä»¥è·å–å­—å…¸ä¸­å¯¹åº”çš„å€¼ã€‚</p><p>ç¼ºç‚¹ï¼š</p><p>1ã€ä¸å¯å˜æ€§ï¼ˆå®šä¹‰äº†å°±ä¸èƒ½å˜ï¼‰</p><p>2ã€é¢å¤–çš„å†…å­˜æ¶ˆè€—ï¼šéœ€è¦å¼€è¾Ÿé¢å¤–çš„å†…å­˜ç©ºé—´æ¥å­˜å‚¨å­—æ®µåç§°å’Œå€¼ï¼Œå¤§è§„æ¨¡æ•°æ®æ—¶å¯èƒ½ä¼šå½±å“æ€§èƒ½</p><p>3ã€æœ‰é™çš„åŠŸèƒ½ï¼šè½»é‡çº§ï¼Œç¼ºä¹çµæ´»æ€§ï¼Œ</p><p>4ã€ä¸æ”¯æŒåŠ¨æ€å­—æ®µæ“ä½œï¼šä¸å¯ä»¥åŠ¨æ€æ·»åŠ å’Œåˆ é™¤</p><h2 id="2-5-OrderedDict-é¡ºåºå­—å…¸"><a href="#2-5-OrderedDict-é¡ºåºå­—å…¸" class="headerlink" title="2.5 OrderedDict é¡ºåºå­—å…¸"></a>2.5 OrderedDict é¡ºåºå­—å…¸</h2><p>python3.6ä¹‹å‰çš„å­—å…¸æ˜¯ä¸æŒ‰æ’å…¥å…ˆåé¡ºåºæ’åºçš„ï¼Œä½†æ˜¯å¯ä»¥å®ç°è¿™ç§åŠŸèƒ½ï¼Œå°±æ˜¯OrderedDictç±»å‹å­—å…¸</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderedDict</span>(<span class="hljs-title class_ inherited__">dict</span>):<br>    <span class="hljs-string">&#x27;Dictionary that remembers insertion order&#x27;</span><br>    <span class="hljs-keyword">pass</span><br><span class="hljs-comment"># ç¤ºä¾‹1ï¼šåŸºæœ¬ä½¿ç”¨</span><br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> OrderedDict<br><br><span class="hljs-comment"># åˆå§‹åŒ–æ—¶å¯ä»¥ä¼ é”®å€¼å¯¹å‚æ•°</span><br>order_dict = OrderedDict(name=<span class="hljs-string">&quot;jack&quot;</span>, age=<span class="hljs-number">18</span>)<br><span class="hljs-built_in">print</span>(order_dict)<br><br><span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> order_dict.items():<br>    <span class="hljs-built_in">print</span>(k, v)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):<span class="hljs-comment"># ä¹Ÿå¯ä»¥å¾ªç¯æ’å…¥é”®å€¼å¯¹</span><br>    order_dict[i] = i * <span class="hljs-number">10</span><br><br><span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> order_dict.items():<br>    <span class="hljs-built_in">print</span>(k, v)<br>    <br><span class="hljs-comment"># ç¤ºä¾‹2ï¼šç‹¬æœ‰æ–¹æ³•move_to_end()</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">move_to_end</span>(<span class="hljs-params">self, key, last=<span class="hljs-literal">True</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    Move an existing element to the end (or beginning if last is false).</span><br><span class="hljs-string">    Raise KeyError if the element does not exist.</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br><br><span class="hljs-comment"># å°†ageè¿™ä¸ªkeyç§»åŠ¨åˆ°æœ€å</span><br>order_dict.move_to_end(<span class="hljs-string">&quot;age&quot;</span>)<br><span class="hljs-built_in">print</span>(order_dict.keys())<br></code></pre></td></tr></table></figure><p>python3.6ä¹‹åçš„å­—å…¸é»˜è®¤æŒ‰ç…§æ’å…¥çš„å…ˆåé¡ºåºå±•ç¤º</p><h2 id="2-6-defaultdict-ä¸ä¼šé”™è¯¯çš„å­—å…¸"><a href="#2-6-defaultdict-ä¸ä¼šé”™è¯¯çš„å­—å…¸" class="headerlink" title="2.6 defaultdict  ä¸ä¼šé”™è¯¯çš„å­—å…¸"></a>2.6 defaultdict  ä¸ä¼šé”™è¯¯çš„å­—å…¸</h2><p>æ™®é€šçš„å­—å…¸è®¿é—®ä¸å­˜åœ¨çš„é”®æ—¶ä¼šæŠ›å‡ºkeyErrorå¼‚å¸¸</p><p>defaultdictç±»å‹å­—å…¸åœ¨è®¿é—®ä¸å­˜åœ¨çš„keyæ—¶ä¸ä¼šå¼‚å¸¸ï¼Œä¼šè¿”å›default</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python">ç¤ºä¾‹<span class="hljs-number">1</span>ï¼šåŸºæœ¬ä½¿ç”¨<br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict<br><br><br>dd = defaultdict()<span class="hljs-comment"># å› ä¸ºæ²¡æœ‰default_factoryï¼Œæ‰€ä»¥æ­¤æ—¶ddå’Œæ™®é€šdictæ²¡æœ‰åŒºåˆ«</span><br><br>dd = defaultdict(<span class="hljs-built_in">int</span>)<span class="hljs-comment"># default_factoryä¸ºint</span><br>d[<span class="hljs-number">1</span>] = <span class="hljs-number">100</span><br><span class="hljs-built_in">print</span>(d[<span class="hljs-number">1</span>])<br><span class="hljs-built_in">print</span>(d[<span class="hljs-number">2</span>])<span class="hljs-comment"># å› ä¸ºä¸å­˜åœ¨2è¿™ä¸ªkeyï¼Œæ‰€ä»¥è¿”å›intçš„é»˜è®¤å€¼ï¼Œå³0</span><br><br><br>dd = defaultdict(<span class="hljs-built_in">list</span>)<span class="hljs-comment"># default_factoryä¸ºlist</span><br><span class="hljs-built_in">print</span>(d[<span class="hljs-number">2</span>])<span class="hljs-comment"># å› ä¸ºä¸å­˜åœ¨2è¿™ä¸ªkeyï¼Œæ‰€ä»¥è¿”å›listçš„é»˜è®¤å€¼ï¼Œå³[]</span><br>ç¤ºä¾‹<span class="hljs-number">2</span>ï¼šdefault_factoryå¯ä»¥ä¸ºå¯è°ƒç”¨å¯¹è±¡<br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> defaultdict<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">default_value</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">500</span><br><br><br>dd = defaultdict(default_value)<br>v1 = dd[<span class="hljs-number">1</span>]<br><span class="hljs-built_in">print</span>(v1)<br></code></pre></td></tr></table></figure><h2 id="2-7-deque-åŒå‘é˜Ÿåˆ—"><a href="#2-7-deque-åŒå‘é˜Ÿåˆ—" class="headerlink" title="2.7 deque åŒå‘é˜Ÿåˆ—"></a>2.7 deque åŒå‘é˜Ÿåˆ—</h2><p>dequeåŒå‘é˜Ÿåˆ—ï¼ˆdouble-end queueï¼‰ç±»ä¼¼äºlistçš„å®¹å™¨</p><p>deque å¯ä»¥å¿«é€Ÿçš„åœ¨é˜Ÿåˆ—çš„å¤´éƒ¨å’Œå°¾éƒ¨æ·»åŠ ã€åˆ é™¤å…ƒç´ </p><p>liståªèƒ½åœ¨å°¾éƒ¨è¿½åŠ ï¼Œä¸å¯ä»¥ä»å¤´éƒ¨åŠ å…ƒç´ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python">dq = deque()<br>dq.append(<span class="hljs-number">100</span>)<br>dq.appendleft(<span class="hljs-number">300</span>) <span class="hljs-comment"># ä»å·¦è¾¹åŠ å…ƒç´ </span><br>dq.pop()<br>dq.popleft() <span class="hljs-comment"># ä»å·¦è¾¹å¼¹å‡ºå…ƒç´ </span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> dq:<br>    <span class="hljs-built_in">print</span>(i)<br><br><span class="hljs-built_in">print</span>(dq.pop())<br><span class="hljs-built_in">print</span>(dq.popleft())<span class="hljs-comment"># ä»å·¦è¾¹å¼¹å‡ºå…ƒç´ </span><br><br>dq.rotate(<span class="hljs-number">2</span>)            <span class="hljs-comment"># æŠŠå³è¾¹2ä¸ªå…ƒç´ ä¾æ¬¡æ”¾åœ¨å·¦è¾¹, é»˜è®¤1ï¼Œå¤æ•°åˆ™ç›¸åæ–¹å‘</span><br><span class="hljs-comment"># ç¤ºä¾‹2ï¼šå°†å¯è¿­ä»£å¯¹è±¡å˜æˆåŒå‘é˜Ÿåˆ—</span><br><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> deque<br><br>ll = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]<br><br>dq = deque(ll)<br><span class="hljs-built_in">print</span>(dq.popleft())<br></code></pre></td></tr></table></figure><h2 id="2-8-äºŒåˆ†æŸ¥æ‰¾"><a href="#2-8-äºŒåˆ†æŸ¥æ‰¾" class="headerlink" title="2.8 äºŒåˆ†æŸ¥æ‰¾"></a>2.8 äºŒåˆ†æŸ¥æ‰¾</h2><ul><li>æœ€ç®€å•çš„æŸ¥æ‰¾ç®—æ³•æ˜¯éå†ï¼Œä½†éå†çš„æ•ˆç‡å¤ªä½äº†ã€‚</li><li>äºŒåˆ†æŸ¥æ‰¾ï¼ˆä¹Ÿå«æŠ˜åŠæŸ¥æ‰¾ï¼‰</li><li>äºŒåˆ†æŸ¥æ‰¾çš„åŸç†æ˜¯ï¼Œé€‰æ‹©ä¸€ä¸ªæœ‰åºåˆ—è¡¨ï¼Œç¡®å®šæœ€å·¦è¾¹çš„å€¼å’Œæœ€å³è¾¹çš„å€¼å’Œæœ€ä¸­é—´çš„ä½ç½®å€¼ï¼Œæ¯”è¾ƒå¾…æŸ¥å…ƒç´ å’Œä¸­é—´ä½ç½®å€¼ï¼Œè¿™æ ·æ¯æ¬¡æ¯”è¾ƒå°±å¯ä»¥æ’é™¤ä¸€èˆ¬çš„æŸ¥æ‰¾èŒƒå›´ã€‚</li><li>äºŒåˆ†æŸ¥æ‰¾çš„å‰ææ˜¯æœ‰åºï¼Œç‰¹ç‚¹æ˜¯é€Ÿåº¦å¿«ï¼Œå¤§æ•°æ®æŸ¥æ‰¾çš„æ—¶å€™å¿«ä¸€ç‚¹</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å®ç°æ–¹å¼ï¼š </span><br><span class="hljs-comment"># 1ã€å®šä¹‰æœ€å·¦ä¾§å’Œæœ€å³ä¾§çš„ä¸‹æ ‡ï¼Œ</span><br><span class="hljs-comment"># 2ã€å¼€å§‹å¾ªç¯ï¼Œ</span><br><span class="hljs-comment"># 3ã€å®šä¹‰ ä¸­é—´å€¼çš„ä¸‹æ ‡</span><br><span class="hljs-comment"># 4ã€å¦‚æœä¸­é—´å€¼å¤§äºæŸ¥æ‰¾å€¼ï¼Œé‚£ä¹ˆå°±ç¼©å°èŒƒå›´ï¼Œæœ€å³ä¾§ç»“æŸä¸‹æ ‡å˜æˆä¸­é—´å€¼-1 </span><br><span class="hljs-comment"># 5ã€åä¹‹ï¼Œå¦‚æœä¸­é—´å€¼å°äºæŸ¥æ‰¾å€¼ï¼Œé‚£ä¹ˆå°±ç¼©å°èŒƒå›´ï¼Œæœ€å·¦ä¾§ä¸‹æ ‡å˜æˆä¸­é—´å€¼+1</span><br><span class="hljs-comment"># è¿”å› -1 æŸ¥æ‰¾åˆ°äº†ï¼Œå°±è¿”å›-1ï¼Œå¦‚æœæ²¡æ‰¾åˆ°ä¼šä¸€ç›´æ‰¾ï¼Œ</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">query_target</span>(<span class="hljs-params">list_test ,target</span>):<br>    left = <span class="hljs-number">0</span><br>    right = <span class="hljs-built_in">len</span>(list_test)-<span class="hljs-number">1</span><br>    wile left&lt;=right:<br>        mid = (left+right)//<span class="hljs-number">2</span><br>        <span class="hljs-keyword">if</span> list_test[mid]==target:<br>            <span class="hljs-keyword">return</span> mid<br>        <span class="hljs-keyword">elif</span> list_test[mid]&gt;target:<br>            right=mid-<span class="hljs-number">1</span><br>        <span class="hljs-keyword">else</span>:<br>            left=mid+<span class="hljs-number">1</span><br>    <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>ä¼˜ç‚¹ï¼šç®€å•ï¼Œé«˜æ•ˆå¿«é€Ÿ</p><p>ç¼ºç‚¹ï¼šè¦æ±‚è¢«æŸ¥åˆ—è¡¨å¿…é¡»æœ‰åºã€é€’å½’å ç”¨ç©ºé—´ã€ä¸é€‚åˆåŠ¨æ€æ•°æ®</p><p>åº”ç”¨åœºæ™¯ï¼šæœ‰åºåˆ—è¡¨ã€é™æ€æ•°æ®ã€å¿«é€ŸæŸ¥æ‰¾</p><h2 id="2-9-å†’æ³¡æ’åº"><a href="#2-9-å†’æ³¡æ’åº" class="headerlink" title="2.9 å†’æ³¡æ’åº"></a>2.9 å†’æ³¡æ’åº</h2><p>å®ç°çš„é€»è¾‘ï¼šä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼Œé€ä¸ªæ¯”å¯¹æ¯ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœè‡ªå·±æ¯”å¯¹æ¯”çš„å…ƒç´ å¤§ï¼Œé‚£ä¹ˆè‡ªå·±çš„ç´¢å¼•å°±å‰è¿›ä¸€ä¸ª</p><p><img src="/./img/python/image-20220419211719385.png" alt="image-20220419211719385"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">a = [<span class="hljs-number">1</span>, <span class="hljs-number">56</span>, <span class="hljs-number">65</span>, <span class="hljs-number">23</span>, <span class="hljs-number">12</span>, <span class="hljs-number">23</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">3</span>, <span class="hljs-number">9</span>]<br><span class="hljs-built_in">print</span>(a)<br>l = <span class="hljs-built_in">len</span>(a) <span class="hljs-comment"># 10ä¸ªå…ƒç´ ï¼Œlå°±æ˜¯10ï¼Œä½†åˆ—è¡¨ç´¢å¼•æ˜¯0-9</span><br><span class="hljs-comment"># ç¬¬ä¸€å±‚éå†åˆ—è¡¨çš„æ€»é•¿åº¦</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,l): <span class="hljs-comment"># æ³¨æ„ï¼Œrangeé‡Œé¢ç¬¬ä¸€ä¸ªå‚ä¸º0æ—¶å¯ä¸å†™,æ‰€ä»¥è¿™é‡Œæ˜¯0-10ï¼Œå°±æ˜¯iå°±æ˜¯1-9</span><br>    <span class="hljs-comment"># ç¬¬äºŒå±‚ï¼Œéå†åˆ—è¡¨çš„é•¿åº¦å‡å»å½“å‰çš„ä½ç½®å‡å»1,æ¯”å¦‚è¯´ç°åœ¨iæ˜¯åœ¨1ä½ rangeé‡Œé¢å°±æ˜¯0-8</span><br><span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>,l-i-<span class="hljs-number">1</span>): <span class="hljs-comment"># l-i-1çš„ç›®çš„æ˜¯åªéœ€è¦éå†å½“å‰ä½ç½®å¾€åçš„ä½ç½®ä¸Šçš„æ•°ï¼Œä¸éœ€è¦ä¸å½“å‰ä½ç½®å¾€å‰çš„æ•°ä½œå¯¹æ¯”</span><br><span class="hljs-keyword">if</span> a[j]&gt;a[j+<span class="hljs-number">1</span>]: <span class="hljs-comment"># å¦‚æœå½“å‰ä½ç½®æ¯”åé¢ä½ç½®çš„å¤§ï¼Œå°±äº¤æ¢ä½ç½®</span><br>a[j],a[j+<span class="hljs-number">1</span>]=a[j+<span class="hljs-number">1</span>],a[j]<br><span class="hljs-built_in">print</span>(a)<br></code></pre></td></tr></table></figure><p>ä¼˜ç‚¹ï¼šç®€å•æ˜“æ‡‚ï¼Œç¨³å®šï¼Œ<strong>åŸåœ°æ’åºï¼Œä¸ä¼šç”Ÿæˆæ–°çš„åˆ—è¡¨</strong>ï¼Œä¸æ”¹å˜ç›¸ç­‰å€¼çš„ä½ç½®</p><p>ç¼ºç‚¹ï¼šæ€§èƒ½å·®ï¼Œä¸é€‚åˆå¤§è§„æ¨¡æ•°æ®æ’åº</p><p>åº”ç”¨åœºæ™¯ï¼šå°è§„æ¨¡æ’åºï¼Œ</p><h2 id="2-10-é€‰æ‹©æ’åº"><a href="#2-10-é€‰æ‹©æ’åº" class="headerlink" title="2.10 é€‰æ‹©æ’åº"></a>2.10 é€‰æ‹©æ’åº</h2><p>å®ç°é€»è¾‘ï¼š</p><p>1ã€æ‰¾åˆ°æ•°æ®ä¸­æœ€å°çš„å…ƒç´ ï¼Œå°†è¿™ä¸ªå…ƒç´ ä¸ç¬¬ä¸€ä¸ªå…ƒç´ äº¤æ¢ä½ç½®</p><p>2ã€åœ¨å‰©ä¸‹å…ƒç´ ä¸­æ‰¾æœ€å°çš„å…ƒç´ ï¼Œå°†è¿™ä¸ªå…ƒç´ ä¸å‰©ä½™å…ƒç´ ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ äº¤æ¢ä½ç½®</p><p>3ã€å¾ªç¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">selection_sort</span>(<span class="hljs-params">list1</span>):<br>    n=<span class="hljs-built_in">len</span>(list1)<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(n-<span class="hljs-number">1</span>):<br>        min_index = i<br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(i+<span class="hljs-number">1</span>,n):<br>            <span class="hljs-keyword">if</span> <span class="hljs-built_in">list</span>[j]&lt;list1[min_index]:<br>                min_index = j<br>        arr[i],arr[min_index]=arr[min_index],arr[i]<br></code></pre></td></tr></table></figure><p>ã€ä»£ç å®ç°v2ã€‘</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å‚è€ƒå†’æ³¡æ’åºçš„åŸåœ°äº¤æ¢æ€è·¯ï¼Œå®ç°åŸåœ°äº¤æ¢çš„é€‰æ‹©æ’åº</span><br><span class="hljs-comment"># é¦–å…ˆé»˜è®¤min_indexç­‰äºæ— åºåŒºç¬¬ä¸€ä¸ªä½ç½®ï¼Œå¦‚æœåé¢ä½ç½®ä¸Šçš„æ•°æ¯”é»˜è®¤ä½ç½®ä¸Šçš„æ•°å°ï¼Œå³é‡ç½®æœ€å°æ•°çš„ä½ç½®ï¼Œ</span><br><span class="hljs-comment"># è¿™æ ·æ¯è¶Ÿå¾ªç¯åï¼Œmin_indexéƒ½æ˜¯æ— åºåŒºæœ€å°æ•°çš„ä½ç½®ã€‚</span><br><span class="hljs-comment"># å°†æ— åºåŒºç¬¬ä¸€ä¸ªä½ç½®çš„æ•°å’Œmin_indexä¸Šçš„æ•°äº¤æ¢ï¼Œå®ç°åŸåœ°äº¤æ¢</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">select_sort</span>(<span class="hljs-params">li</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(li) - <span class="hljs-number">1</span>):    <span class="hljs-comment"># iè¡¨ç¤ºå¾ªç¯è¶Ÿæ•°</span><br>        min_index = i               <span class="hljs-comment"># é»˜è®¤æ— åºåŒºçš„ç¬¬ä¸€ä¸ªä½ç½®ä¸Šçš„å…ƒç´ æœ€å°ï¼Œæœ€ä¸ºæ¯”è¾ƒçš„å‚è€ƒå¯¹è±¡</span><br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(i+<span class="hljs-number">1</span>, <span class="hljs-built_in">len</span>(li)):    <span class="hljs-comment"># jæ¯”è¾ƒçš„èµ·å§‹ä½ç½®ï¼Œå¯ä»¥ä»i+1å¼€å§‹ï¼Œå‡å°‘ä¸€æ¬¡å’Œè‡ªå·±æ¯”è¾ƒçš„å¾ªç¯</span><br>            <span class="hljs-keyword">if</span> li[j] &lt; li[min_index]:<br>                min_index = j               <span class="hljs-comment"># è®°å½•æœ€å°æ•°çš„ä½ç½®</span><br>        <span class="hljs-comment"># ä¸€è¶Ÿå¾ªç¯åï¼Œæ‰¾åˆ°æ— åºåŒºæœ€å°æ•°çš„ä½ç½®ï¼Œäº¤æ¢æ— åºåŒºç¬¬ä¸€ä¸ªä½ç½®çš„æ•°å’Œæ— åºåŒºæœ€å°çš„æ•°</span><br>        li[i], li[min_index] = li[min_index], li[i]<br></code></pre></td></tr></table></figure><h2 id="2-11-pythonå†…ç½®æ’åºç®—æ³•"><a href="#2-11-pythonå†…ç½®æ’åºç®—æ³•" class="headerlink" title="2.11 pythonå†…ç½®æ’åºç®—æ³•"></a>2.11 pythonå†…ç½®æ’åºç®—æ³•</h2><p>sort() åŸåœ°æ’åºï¼Œä¸ä¼šç”Ÿæˆæ–°çš„æ•°æ®ï¼Œåªå¯¹åˆ—è¡¨ç”¨</p><p>sorted() ï¼Œç”Ÿæˆä¸€ä»½æ–°æ•°æ®ï¼Œå¯¹æ‰€æœ‰å¯è¿­ä»£å¯¹è±¡éƒ½ç”¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ç¤ºä¾‹1ï¼šåŸºæœ¬ä½¿ç”¨</span><br>l1 = [<span class="hljs-number">5</span>, <span class="hljs-number">2</span>, <span class="hljs-number">8</span>, <span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]<br>l2 = [<span class="hljs-number">6</span>, <span class="hljs-number">1</span>, <span class="hljs-number">7</span>, <span class="hljs-number">3</span>, <span class="hljs-number">9</span>, <span class="hljs-number">2</span>]<br>l1.sort(reverse=<span class="hljs-literal">True</span>)<span class="hljs-comment"># reverse=Trueé™åºæ’</span><br><br>l2 = <span class="hljs-built_in">sorted</span>(l2)<br><span class="hljs-comment"># ç¤ºä¾‹2ï¼šé«˜çº§ç”¨æ³•</span><br><span class="hljs-comment"># keyæŒ‡å®šæ’åºè§„åˆ™</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">my_sort</span>(<span class="hljs-params">x</span>):<br>    <span class="hljs-keyword">return</span> x[<span class="hljs-string">&quot;id&quot;</span>]<br>ll.sort(key=my_sort)<br><span class="hljs-comment"># åŒ¿åå‡½æ•°</span><br>ll = [&#123;<span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">5</span>&#125;, &#123;<span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">1</span>&#125;, &#123;<span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">3</span>&#125;]<br>ll.sort(key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-string">&quot;id&quot;</span>])<br><br>readonly option <span class="hljs-keyword">is</span> <span class="hljs-built_in">set</span> (add! tooverride)<br><span class="hljs-comment"># æŒ‰æƒé‡æ’åº</span><br><span class="hljs-comment"># id=3æ’ç¬¬ä¸€ä½ï¼Œid=5æ’ç¬¬äºŒä½ï¼Œ id=1æ’ç¬¬ä¸‰ä½</span><br>weights = &#123;<span class="hljs-number">3</span>: <span class="hljs-number">1</span>, <span class="hljs-number">5</span>: <span class="hljs-number">2</span>, <span class="hljs-number">1</span>: <span class="hljs-number">3</span>&#125;<br><br>ll.sort(key=<span class="hljs-keyword">lambda</span> x: weights[x[<span class="hljs-string">&quot;id&quot;</span>]])<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€pythonã€‘è¿›é˜¶ä¹‹åŸºç¡€å›é¡¾ï¼ˆä¸€ï¼‰</title>
    <link href="/2024/03/18/601python%E8%BF%9B%E9%98%B6%E4%B9%8B%E5%9F%BA%E7%A1%80%E5%9B%9E%E9%A1%BE%EF%BC%88%E4%B8%80%EF%BC%89/"/>
    <url>/2024/03/18/601python%E8%BF%9B%E9%98%B6%E4%B9%8B%E5%9F%BA%E7%A1%80%E5%9B%9E%E9%A1%BE%EF%BC%88%E4%B8%80%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="1-åŸºç¡€å›é¡¾"><a href="#1-åŸºç¡€å›é¡¾" class="headerlink" title="1 åŸºç¡€å›é¡¾"></a>1 åŸºç¡€å›é¡¾</h1><h2 id="1-1å˜é‡èµ‹å€¼å’Œå¼•ç”¨"><a href="#1-1å˜é‡èµ‹å€¼å’Œå¼•ç”¨" class="headerlink" title="1.1å˜é‡èµ‹å€¼å’Œå¼•ç”¨"></a>1.1å˜é‡èµ‹å€¼å’Œå¼•ç”¨</h2><ul><li>å½“æœ‰ä¸€ä¸ªæ–°å˜é‡çš„æ—¶å€™ï¼Œå†…å­˜ç©ºé—´å°±ä¼šå¼€è¾Ÿä¸€å—æ•°æ®å­˜å‚¨</li><li>å˜é‡ä¸åŒï¼Œåœ°å€æ˜¯ä¸åŒçš„ï¼Œå¯ä»¥ç”¨id( )è·å–å†…å­˜åœ°å€</li></ul><p>å˜é‡å¼•ç”¨çš„æœ¬è´¨å°±æ˜¯å°†è¿™ä¸ªå˜é‡çš„å†…å­˜åœ°å€ï¼Œå…³è”åˆ°ä¸€ä¸ªæ–°å˜é‡ä¸­ï¼Œä¸¤ä¸ªå˜é‡æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªåœ°å€ï¼Œ</p><p>æ‰€ä»¥å˜é‡æ˜¯<strong>ä¸å å†…å­˜</strong>çš„ï¼Œ</p><h2 id="1-2-å°æ•´æ•°æ± "><a href="#1-2-å°æ•´æ•°æ± " class="headerlink" title="1.2 å°æ•´æ•°æ± "></a>1.2 å°æ•´æ•°æ± </h2><p>å°æ•´æ•°æ± å°±æ˜¯Pythonè§£é‡Šå™¨åœ¨ç¨‹åºå¼€å§‹è¿è¡Œçš„æ—¶å€™å°±é¢„å…ˆå¼€è¾Ÿçš„ä¸€å—å†…å­˜ç©ºé—´ï¼Œå­˜æ”¾ä¸€éƒ¨åˆ†çš„æ•´æ•°ï¼Œæ–¹ä¾¿åé¢å»è°ƒç”¨ï¼Œç”¨äºä¼˜åŒ–èµ„æºæ¶ˆè€—çš„</p><h2 id="1-3-åƒåœ¾å›æ”¶æœºåˆ¶"><a href="#1-3-åƒåœ¾å›æ”¶æœºåˆ¶" class="headerlink" title="1.3 åƒåœ¾å›æ”¶æœºåˆ¶"></a>1.3 åƒåœ¾å›æ”¶æœºåˆ¶</h2><p>å˜é‡ä½¿ç”¨å‰éœ€è¦å…ˆå®šä¹‰ï¼Œå®šä¹‰å°±æ˜¯å¼€è¾Ÿäº†ç©ºé—´ï¼Œå¦‚æœéœ€è¦ç”¨åˆ°å¾ˆå¤šæ•°æ®é‚£ä¹ˆå°±ä¼šå¼€è¾Ÿå¾ˆå¤šç©ºé—´ï¼Œç©ºé—´æ˜¯æœ‰é™çš„ï¼Œå¼€å¤šäº†ä¼šé€ æˆæµªè´¹å’Œæº¢å‡ºçš„é£é™©ï¼Œæ‰€ä»¥éœ€è¦åœ¨ä½¿ç”¨åå°±é‡Šæ”¾è¿™ä¸ªç©ºé—´ï¼Œ</p><p>pythonè§£é‡Šå™¨è‡ªåŠ¨çš„å¸®æˆ‘ä»¬åšäº†è¿™ä¸ªæ¸…ç†å†…å­˜ç©ºé—´çš„æœºåˆ¶ï¼Œ</p><p>é‡‡ç”¨çš„æ˜¯<strong>å¼•ç”¨è®¡æ•°</strong>çš„æ–¹å¼å›æ”¶åƒåœ¾ã€‚</p><p>ä»€ä¹ˆæ˜¯åƒåœ¾ï¼Ÿåƒåœ¾å°±æ˜¯æ²¡æœ‰ç»‘å®šå˜é‡åçš„å€¼ï¼Œä¹Ÿå°±æ˜¯æ— æ³•è®¿é—®çš„å€¼ï¼Œå°±æ˜¯æ²¡æœ‰ç”¨çš„å€¼</p><p>å¦‚ä½•å›æ”¶åƒåœ¾ï¼Ÿï¼šé€šè¿‡å¼•ç”¨è®¡æ•°çš„æ–¹å¼ï¼Œå°±æ˜¯å½“è¿™ä¸ªå€¼è¢«å¼•ç”¨çš„æ—¶å€™ï¼Œå°±ä¼šç»‘å®šåˆ°ä¸€ä¸ªæ–°çš„å˜é‡åä¸Šï¼Œå¼•ç”¨è®¡æ•°å°±ä¼šåŠ 1 </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python">x = <span class="hljs-number">10</span><span class="hljs-comment"># xç»‘å®šç»™å€¼10ï¼Œ10çš„å¼•ç”¨è®¡æ•°=1</span><br>y = x<span class="hljs-comment"># yç»‘å®šç»™å€¼10ï¼Œ10çš„å¼•ç”¨è®¡æ•°=2</span><br>z = <span class="hljs-number">10</span>  <span class="hljs-comment"># zç»‘å®šç»™å€¼10ï¼Œ10çš„å¼•ç”¨è®¡æ•°=3</span><br><br><span class="hljs-comment"># é€šè¿‡èµ‹å€¼å¯ä»¥å°†å˜é‡åç»‘å®šåˆ°å€¼ï¼Œå°†å¼•ç”¨è®¡æ•°å¢åŠ </span><br><span class="hljs-comment"># é€šè¿‡del æ–¹æ³•å¯ä»¥å°†å˜é‡åå’Œå€¼è§£ç»‘ï¼Œå°†å¼•ç”¨è®¡æ•°å‡å°‘</span><br><br><span class="hljs-keyword">del</span> z <span class="hljs-comment"># zä¸å®ƒæ‰€ç»‘å®šçš„å€¼è§£ç»‘ï¼Œå³å€¼10çš„å¼•ç”¨è®¡æ•°å‡ä¸º2</span><br><span class="hljs-comment"># æ³¨æ„ delä¸æ˜¯ä¸æ˜¯åˆ é™¤zçš„æ„æ€æœ¬è´¨æ˜¯æ¥è§¦å˜é‡åçš„ç»‘å®šï¼Œå†…å­˜å›æ”¶çš„ç›®çš„</span><br><br><span class="hljs-keyword">import</span> sys<br>sys.getrefcount(a)<span class="hljs-comment"># æŸ¥çœ‹å¼•ç”¨è®¡æ•°</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">f</span>():<br>    <span class="hljs-keyword">import</span> sys<br>    a = <span class="hljs-number">10</span><br>    <span class="hljs-built_in">print</span>(sys.getrefcount(a))<br>    b = a<br>    <span class="hljs-built_in">print</span>(sys.getrefcount(a))<br>    c = [a]<br>    <span class="hljs-built_in">print</span>(sys.getrefcount(a))<br>    <span class="hljs-keyword">del</span> b<br>    <span class="hljs-built_in">print</span>(sys.getrefcount(a))<br>    <span class="hljs-keyword">del</span> c<br>    <span class="hljs-built_in">print</span>(sys.getrefcount(a))<br></code></pre></td></tr></table></figure><p>æ‹“å±•ï¼špyçš„åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œé™¤äº†å¼•ç”¨è®¡æ•°ä¹‹å¤–ï¼Œè¿˜æœ‰ã€æ ‡è®°å›æ”¶ã€‘ã€ã€åˆ†ä»£å›æ”¶ã€‘</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æ ‡è®°æ¸…é™¤è§£å†³å¾ªç¯å¼•ç”¨é€ æˆçš„é—®é¢˜</span><br>l1=[]<br>l2=[]<br>l1.append(l2)<br>l2.append(l1) <br><br><span class="hljs-keyword">del</span> l1, l2<br><br><span class="hljs-comment"># åˆ†ä»£å›æ”¶è§£å†³å¼•ç”¨è®¡æ•°æ•ˆç‡ä½çš„é—®é¢˜</span><br></code></pre></td></tr></table></figure><h2 id="1-4-è¿­ä»£å™¨"><a href="#1-4-è¿­ä»£å™¨" class="headerlink" title="1.4 è¿­ä»£å™¨"></a>1.4 è¿­ä»£å™¨</h2><p>ã€å¯è¿­ä»£å¯¹è±¡(iterable)è¡£ç‰¹ä¼¯ã€‘æ˜¯å•¥ï¼Ÿ</p><p>æŒ‡çš„æ˜¯å¯ä»¥ä¾æ¬¡è¿”å›å…¶å†…éƒ¨æˆå‘˜çš„å¯¹è±¡ï¼Œæ¯”å¦‚å­—ç¬¦ä¸²ã€åˆ—è¡¨ã€å­—å…¸ã€æ–‡ä»¶ç­‰ç­‰éƒ½æ˜¯å¯è¿­ä»£çš„å¯¹è±¡</p><p>ã€è¿­ä»£å™¨ï¼ˆiteratorï¼‰è¡£ç‰¹ç‘å„¿ã€‘æ˜¯å•¥ï¼Ÿ</p><p>å†…ç½®å‡½æ•°__iter(å¯è¿­ä»£å¯¹è±¡)å¾—åˆ°è¿­ä»£å™¨ï¼Œæœ¬è´¨ä¸Šè¿­ä»£å™¨ä¹Ÿæ˜¯å¯è¿­ä»£å¯¹è±¡</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å¯è¿­ä»£å¯¹è±¡ï¼Œä»è¯­æ³•ä¸Šè¯´å°±æ˜¯é‚£äº›å…·æœ‰__iter__çš„æ–¹æ³•çš„å¯¹è±¡</span><br><span class="hljs-comment"># è¿­ä»£å™¨ï¼Œä»è¯­æ³•ä¸Šè¯´å°±æ˜¯é‚£äº›åŒäº‹å…·æœ‰__next__å’Œ__iter__æ–¹æ³•çš„å¯¹è±¡ã€‚</span><br>- è¿­ä»£å™¨è°ƒç”¨__next__æ–¹æ³•ä¼šè°ƒç”¨è¿­ä»£å™¨ä¸­çš„ä¸‹ä¸€ä¸ªå€¼ï¼›<br>- è¿­ä»£å™¨è°ƒç”¨__iter__æ–¹æ³•è¿”å›è¿­ä»£å™¨æœ¬èº«ï¼›<br><span class="hljs-comment"># ç¤ºä¾‹ï¼š</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>s=&#123;<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>&#125;  <span class="hljs-comment"># å¯è¿­ä»£å¯¹è±¡s</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>i=<span class="hljs-built_in">iter</span>(s)  <span class="hljs-comment"># iæ˜¯è¿­ä»£å™¨</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">next</span>(i)    <span class="hljs-comment"># è¿”å›è¿­ä»£å™¨ä¸­ä¸‹ä¸€ä¸ªå€¼</span><br><span class="hljs-number">1</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">next</span>(i)<br><span class="hljs-number">2</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">next</span>(i)<br><span class="hljs-number">3</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">next</span>(i)  <span class="hljs-comment">#æŠ›å‡ºStopIterationçš„å¼‚å¸¸ï¼Œä»£è¡¨æ— å€¼å¯å–ï¼Œè¿­ä»£ç»“æŸ</span><br></code></pre></td></tr></table></figure><p>ä¼˜ç‚¹ï¼šæƒ°æ€§å–å€¼ï¼›æ¯æ¬¡åªå–ä¸€ä¸ªæ•°æ®ï¼Œä¸å å†…å­˜</p><p>ç¼ºç‚¹ï¼šåªèƒ½ä»å‰å¾€åä¾æ¬¡å–å€¼ï¼Œä¸èƒ½è¿”å›å¤´å¾€å‰å–å€¼ã€‚å°±åƒè±¡æ£‹ä¸­çš„å’ã€‚åªè¿›ä¸é€€</p><h2 id="1-5-for-å¾ªç¯çš„æœ¬è´¨"><a href="#1-5-for-å¾ªç¯çš„æœ¬è´¨" class="headerlink" title="1.5 for å¾ªç¯çš„æœ¬è´¨"></a>1.5 for å¾ªç¯çš„æœ¬è´¨</h2><p>whileå¾ªç¯å¯ä»¥åšå¾ªç¯éå†æ“ä½œï¼Œä½†æ˜¯è¿œä¸å¦‚for å¾ªç¯ç®€æ´å®ç”¨ã€‚</p><p>whileå¾ªç¯é€‚åˆåšæ¡ä»¶å¾ªç¯ï¼Œfor å¾ªç¯é€‚åˆåšè¿­ä»£å™¨å¾ªç¯</p><p>ã€forå¾ªç¯çš„æœ¬è´¨ã€‘ï¼šforå¾ªç¯åº•å±‚åˆ©ç”¨äº†è¿­ä»£å™¨çš„åŸç†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># while + iterator</span><br>goods = [<span class="hljs-string">&#x27;mac&#x27;</span>,<span class="hljs-string">&#x27;len&#x27;</span>,<span class="hljs-string">&#x27;huawei&#x27;</span>,<span class="hljs-string">&#x27;xiaomi&#x27;</span>]<br>goods_iterator = <span class="hljs-built_in">iter</span>(goods)<br><span class="hljs-keyword">while</span> ture:<br>    tyr:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-built_in">next</span>(goods_iterator)) <span class="hljs-comment"># æ— é™å¾ªç¯ä¾æ¬¡å–å€¼</span><br>    <span class="hljs-keyword">except</span> StopIteration: <span class="hljs-comment"># æ— é™å¾ªç¯ä»€ä¹ˆæ—¶å€™ç»ˆæ­¢ï¼Ÿæ•æ‰å¼‚å¸¸ç»ˆæ­¢å¾ªç¯</span><br>        <span class="hljs-keyword">break</span><br>        <br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> goods:<br>    <span class="hljs-built_in">print</span>(i)<br></code></pre></td></tr></table></figure><p>for å¾ªç¯åº•å±‚å®ç°åˆ†ä¸‰æ­¥</p><p>ç¬¬ä¸€ï¼šè°ƒç”¨iter()ï¼Œå°†goodsè½¬åŒ–æˆè¿­ä»£å™¨goods_iterator</p><p>ç¬¬äºŒï¼š è°ƒç”¨next() æ–¹æ³•åˆ°è¿­ä»£å™¨goods_iteratorå–å€¼</p><p>ç¬¬ä¸‰ï¼šå¾ªç¯è°ƒç”¨ç¬¬äºŒæ­¥ï¼Œç›´åˆ°æ•æ‰åˆ°å¼‚å¸¸åç»ˆæ­¢å¾ªç¯</p><p>ã€forå¾ªç¯çš„å¥½å¤„ã€‘ï¼šä¸ºåºåˆ—å’Œéåºåˆ—ç±»å‹æä¾›äº†ä¸€ç§ç»Ÿä¸€çš„è¿­ä»£å–å€¼çš„æ–¹å¼</p><h2 id="1-6-chain"><a href="#1-6-chain" class="headerlink" title="1.6 chain"></a>1.6 chain</h2><p>pythonå®˜æ–¹æä¾›äº†itertoolså·¥å…·åŒ…ï¼Œæ–¹ä¾¿æ“ä½œè¿­ä»£å™¨ï¼Œè¿™ä¸ªåŒ…é‡Œæä¾›äº†chianå‡½æ•°ï¼Œå…¼é¡¾å†…å­˜æ•ˆç‡å’Œå†™æ³•ä¼˜é›…</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> itertools <span class="hljs-keyword">import</span> chian<br>a= [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>]<br>b = [<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">65</span>,<span class="hljs-number">56</span>]<br>c = &#123;<span class="hljs-string">&#x27;a&#x27;</span>:<span class="hljs-number">1</span>,<span class="hljs-string">&#x27;b&#x27;</span>:<span class="hljs-number">4</span>&#125;<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> chain(a,b):<br>    <span class="hljs-built_in">print</span>(i) <span class="hljs-comment"># 1, 2 ,3 ,4,5,4,5,65,56</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> chain(a,c.values()):<br>    <span class="hljs-built_in">print</span>(i)   <span class="hljs-comment"># 1,2,3,4,5,1,4</span><br></code></pre></td></tr></table></figure><p>å»é™¤åµŒå¥—</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> itertools <span class="hljs-keyword">import</span> chain<br>a = [[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>],[<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>],[<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>]]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> chain(a):<br>    <span class="hljs-built_in">print</span>(i) <span class="hljs-comment"># 1,2,3,4,5,6,7,8,9</span><br><span class="hljs-comment"># å–å€¼</span><br>b = <span class="hljs-built_in">list</span>(chian(*a)) <span class="hljs-comment"># [1,2,3,4,5,6,7,8,9]</span><br><br></code></pre></td></tr></table></figure><h3 id="ç»ƒä¹ ï¼š"><a href="#ç»ƒä¹ ï¼š" class="headerlink" title="ç»ƒä¹ ï¼š"></a>ç»ƒä¹ ï¼š</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># è§£åµŒå¥—ã€</span><br>a = [[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>],[<span class="hljs-number">8</span>,<span class="hljs-number">2</span>,<span class="hljs-number">5</span>],[<span class="hljs-number">1</span>,<span class="hljs-number">5</span>,<span class="hljs-number">9</span>]]<br>test1 = [m <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> a <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> i] <span class="hljs-comment"># [1, 2, 3, 3, 4, 5, 5, 6, 7]</span><br>test2 = <span class="hljs-built_in">list</span> (itertools.chian(*a)) <span class="hljs-comment"># [1, 2, 3, 3, 4, 5, 5, 6, 7]</span><br>test3 = <span class="hljs-built_in">sum</span>(a,start=[]) <span class="hljs-comment"># [1, 2, 3, 3, 4, 5, 5, 6, 7]</span><br><span class="hljs-comment"># è§£åµŒå¥—ã€å»é‡</span><br>test1 = <span class="hljs-built_in">list</span>(setm <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> a <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> i()) <span class="hljs-comment"># [1, 2, 3, 5, 8, 9]</span><br>test2 = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">set</span>(itertools.chian(*a))) <span class="hljs-comment"># [1, 2, 3, 5, 8, 9]</span><br>test3 = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">set</span>(<span class="hljs-built_in">sum</span>(a,start=[]))) <span class="hljs-comment"># [1, 2, 3, 5, 8, 9]</span><br><span class="hljs-comment"># è§£åµŒå¥—ã€å»é‡ã€ä¸ç ´åæ’åº</span><br><span class="hljs-comment"># æ–¹å¼ä¸€</span><br>new_list = []<br>test_set = <span class="hljs-built_in">set</span>()<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> a:<br>m_list=[]<br><span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> i:<br><span class="hljs-keyword">if</span> m <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> test_set:<br>m_list.append(m)å•Š<br>test_set.add(m)<br>new_list.append(m_list)<br><span class="hljs-comment"># print(new_list)</span><br>test1 = [m <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> new_list <span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> i]<br><span class="hljs-built_in">print</span>(test1) <span class="hljs-comment"># [1, 2, 3, 8, 5, 9]</span><br><span class="hljs-comment"># æ–¹å¼äºŒï¼š</span><br>test2 = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">dict</span>.fromkeys(itertools.chain(*a)))<br><span class="hljs-built_in">print</span>(test2) <span class="hljs-comment"># [1, 2, 3, 8, 5, 9]</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€pythonã€‘ä¹‹ä½¿ç”¨gRPC</title>
    <link href="/2024/03/14/692python%E4%BD%BF%E7%94%A8gRPC/"/>
    <url>/2024/03/14/692python%E4%BD%BF%E7%94%A8gRPC/</url>
    
    <content type="html"><![CDATA[<h1 id="gRPC-Pythonè°ƒç”¨"><a href="#gRPC-Pythonè°ƒç”¨" class="headerlink" title="gRPC Pythonè°ƒç”¨"></a>gRPC Pythonè°ƒç”¨</h1><p>é€šè¿‡ä¸€ä¸ªç®€å•çš„å·¥ä½œç¤ºä¾‹ä½¿ç”¨ Python ä¸­çš„ gRPCã€‚</p><h2 id="1-ã€å®šä¹‰rpc-æ¥å£-protoæ–‡ä»¶-hello-proto"><a href="#1-ã€å®šä¹‰rpc-æ¥å£-protoæ–‡ä»¶-hello-proto" class="headerlink" title="1 ã€å®šä¹‰rpc æ¥å£ ,protoæ–‡ä»¶ hello.proto"></a>1 ã€å®šä¹‰rpc æ¥å£ ,protoæ–‡ä»¶ hello.proto</h2><figure class="highlight protobuf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs protobuf">syntax = <span class="hljs-string">&quot;proto3&quot;</span>;<br><br><span class="hljs-keyword">option</span> go_package=<span class="hljs-string">&quot;../proto&quot;</span>;<br><br><span class="hljs-keyword">service </span><span class="hljs-title class_">Greeter</span> &#123;<br>  <span class="hljs-comment">// Sends a greeting</span><br>    <span class="hljs-function"><span class="hljs-keyword">rpc</span> SayHello (HelloRequest) <span class="hljs-keyword">returns</span> (HelloReply) </span>&#123;&#125; <span class="hljs-comment">// å®šä¹‰rpcæ¥å£</span><br>  <span class="hljs-comment">// Sends another greeting  å¦‚æœè¿˜è¦åŠ å°±åœ¨ä¸‹é¢æ·»åŠ  rpc</span><br>    <span class="hljs-comment">// rpc SayHelloAgain (HelloRequest) returns (HelloReply) &#123;&#125;</span><br>&#125;<br><br><span class="hljs-comment">// The request message containing the user&#x27;s name. å®šä¹‰è¯·æ±‚</span><br><span class="hljs-keyword">message </span><span class="hljs-title class_">HelloRequest</span> &#123;<br>    <span class="hljs-type">string</span> name = <span class="hljs-number">1</span>;<br>&#125;<br><br><span class="hljs-comment">// The response message containing the greetingsï¼Œå®šä¹‰å“åº”</span><br><span class="hljs-keyword">message </span><span class="hljs-title class_">HelloReply</span> &#123;<br>    <span class="hljs-type">string</span> message = <span class="hljs-number">1</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="2ã€å®‰è£…å¯¹åº”çš„åº“"><a href="#2ã€å®‰è£…å¯¹åº”çš„åº“" class="headerlink" title="2ã€å®‰è£…å¯¹åº”çš„åº“"></a>2ã€å®‰è£…å¯¹åº”çš„åº“</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pip install  grpcioã€pip install grpcio-toolsã€pip install grpc <br></code></pre></td></tr></table></figure><h2 id="3ã€ç”Ÿæˆpyä»£ç "><a href="#3ã€ç”Ÿæˆpyä»£ç " class="headerlink" title="3ã€ç”Ÿæˆpyä»£ç "></a>3ã€ç”Ÿæˆpyä»£ç </h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python -m grpc_tools.protoc -I . --python_out=. --grpc_python_out=. hello.proto <br></code></pre></td></tr></table></figure><h2 id="4ã€å¾—åˆ°ä¸¤ä¸ªæ–‡ä»¶hello-pb2-py-å’Œ-hello-pb2-grpc-py"><a href="#4ã€å¾—åˆ°ä¸¤ä¸ªæ–‡ä»¶hello-pb2-py-å’Œ-hello-pb2-grpc-py" class="headerlink" title="4ã€å¾—åˆ°ä¸¤ä¸ªæ–‡ä»¶hello_pb2.py å’Œ hello_pb2_grpc.py"></a>4ã€å¾—åˆ°ä¸¤ä¸ªæ–‡ä»¶hello_pb2.py å’Œ hello_pb2_grpc.py</h2><p><code>hello_pb2.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-comment"># Generated by the protocol buffer compiler.  DO NOT EDIT!</span><br><span class="hljs-comment"># source: hello.proto</span><br><span class="hljs-comment"># Protobuf Python Version: 4.25.1</span><br><span class="hljs-string">&quot;&quot;&quot;Generated protocol buffer code.&quot;&quot;&quot;</span><br><span class="hljs-keyword">from</span> google.protobuf <span class="hljs-keyword">import</span> descriptor <span class="hljs-keyword">as</span> _descriptor<br><span class="hljs-keyword">from</span> google.protobuf <span class="hljs-keyword">import</span> descriptor_pool <span class="hljs-keyword">as</span> _descriptor_pool<br><span class="hljs-keyword">from</span> google.protobuf <span class="hljs-keyword">import</span> symbol_database <span class="hljs-keyword">as</span> _symbol_database<br><span class="hljs-keyword">from</span> google.protobuf.internal <span class="hljs-keyword">import</span> builder <span class="hljs-keyword">as</span> _builder<br><span class="hljs-comment"># @@protoc_insertion_point(imports)</span><br><br>_sym_db = _symbol_database.Default()<br><br><br><br><br>DESCRIPTOR = _descriptor_pool.Default().AddSerializedFile(<span class="hljs-string">b&#x27;\n\x0bhello.proto\&quot;\x1c\n\x0cHelloRequest\x12\x0c\n\x04name\x18\x01 \x01(\t\&quot;\x1d\n\nHelloReply\x12\x0f\n\x07message\x18\x01 \x01(\t23\n\x07Greeter\x12(\n\x08SayHello\x12\r.HelloRequest\x1a\x0b.HelloReply\&quot;\x00\x42\nZ\x08../protob\x06proto3&#x27;</span>)<br><br>_<span class="hljs-built_in">globals</span> = <span class="hljs-built_in">globals</span>()<br>_builder.BuildMessageAndEnumDescriptors(DESCRIPTOR, _<span class="hljs-built_in">globals</span>)<br>_builder.BuildTopDescriptorsAndMessages(DESCRIPTOR, <span class="hljs-string">&#x27;hello_pb2&#x27;</span>, _<span class="hljs-built_in">globals</span>)<br><span class="hljs-keyword">if</span> _descriptor._USE_C_DESCRIPTORS == <span class="hljs-literal">False</span>:<br>  _<span class="hljs-built_in">globals</span>[<span class="hljs-string">&#x27;DESCRIPTOR&#x27;</span>]._options = <span class="hljs-literal">None</span><br>  _<span class="hljs-built_in">globals</span>[<span class="hljs-string">&#x27;DESCRIPTOR&#x27;</span>]._serialized_options = <span class="hljs-string">b&#x27;Z\010../proto&#x27;</span><br>  _<span class="hljs-built_in">globals</span>[<span class="hljs-string">&#x27;_HELLOREQUEST&#x27;</span>]._serialized_start=<span class="hljs-number">15</span><br>  _<span class="hljs-built_in">globals</span>[<span class="hljs-string">&#x27;_HELLOREQUEST&#x27;</span>]._serialized_end=<span class="hljs-number">43</span><br>  _<span class="hljs-built_in">globals</span>[<span class="hljs-string">&#x27;_HELLOREPLY&#x27;</span>]._serialized_start=<span class="hljs-number">45</span><br>  _<span class="hljs-built_in">globals</span>[<span class="hljs-string">&#x27;_HELLOREPLY&#x27;</span>]._serialized_end=<span class="hljs-number">74</span><br>  _<span class="hljs-built_in">globals</span>[<span class="hljs-string">&#x27;_GREETER&#x27;</span>]._serialized_start=<span class="hljs-number">76</span><br>  _<span class="hljs-built_in">globals</span>[<span class="hljs-string">&#x27;_GREETER&#x27;</span>]._serialized_end=<span class="hljs-number">127</span><br><span class="hljs-comment"># @@protoc_insertion_point(module_scope)</span><br><br></code></pre></td></tr></table></figure><p><code>hello_pb2_grpc.py </code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># Generated by the gRPC Python protocol compiler plugin. DO NOT EDIT!</span><br><span class="hljs-string">&quot;&quot;&quot;Client and server classes corresponding to protobuf-defined services.&quot;&quot;&quot;</span><br><span class="hljs-keyword">import</span> grpc<br><br><span class="hljs-comment"># import hello_pb2 as hello__pb2</span><br><span class="hljs-keyword">from</span> . <span class="hljs-keyword">import</span> hello_pb2 <span class="hljs-keyword">as</span> hello__pb2<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">GreeterStub</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Missing associated documentation comment in .proto file.&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, channel</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;Constructor.</span><br><span class="hljs-string"></span><br><span class="hljs-string">        Args:</span><br><span class="hljs-string">            channel: A grpc.Channel.</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        self.SayHello = channel.unary_unary(<br>                <span class="hljs-string">&#x27;/Greeter/SayHello&#x27;</span>,<br>                request_serializer=hello__pb2.HelloRequest.SerializeToString,<br>                response_deserializer=hello__pb2.HelloReply.FromString,<br>                )<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">GreeterServicer</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Missing associated documentation comment in .proto file.&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">SayHello</span>(<span class="hljs-params">self, request, context</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;Sends a greeting</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        context.set_code(grpc.StatusCode.UNIMPLEMENTED)<br>        context.set_details(<span class="hljs-string">&#x27;Method not implemented!&#x27;</span>)<br>        <span class="hljs-keyword">raise</span> NotImplementedError(<span class="hljs-string">&#x27;Method not implemented!&#x27;</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">add_GreeterServicer_to_server</span>(<span class="hljs-params">servicer, server</span>):<br>    rpc_method_handlers = &#123;<br>            <span class="hljs-string">&#x27;SayHello&#x27;</span>: grpc.unary_unary_rpc_method_handler(<br>                    servicer.SayHello,<br>                    request_deserializer=hello__pb2.HelloRequest.FromString,<br>                    response_serializer=hello__pb2.HelloReply.SerializeToString,<br>            ),<br>    &#125;<br>    generic_handler = grpc.method_handlers_generic_handler(<br>            <span class="hljs-string">&#x27;Greeter&#x27;</span>, rpc_method_handlers)<br>    server.add_generic_rpc_handlers((generic_handler,))<br><br><br> <span class="hljs-comment"># This class is part of an EXPERIMENTAL API.</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Greeter</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Missing associated documentation comment in .proto file.&quot;&quot;&quot;</span><br><br><span class="hljs-meta">    @staticmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">SayHello</span>(<span class="hljs-params">request,</span><br><span class="hljs-params">            target,</span><br><span class="hljs-params">            options=(<span class="hljs-params"></span>),</span><br><span class="hljs-params">            channel_credentials=<span class="hljs-literal">None</span>,</span><br><span class="hljs-params">            call_credentials=<span class="hljs-literal">None</span>,</span><br><span class="hljs-params">            insecure=<span class="hljs-literal">False</span>,</span><br><span class="hljs-params">            compression=<span class="hljs-literal">None</span>,</span><br><span class="hljs-params">            wait_for_ready=<span class="hljs-literal">None</span>,</span><br><span class="hljs-params">            timeout=<span class="hljs-literal">None</span>,</span><br><span class="hljs-params">            metadata=<span class="hljs-literal">None</span></span>):<br>        <span class="hljs-keyword">return</span> grpc.experimental.unary_unary(request, target, <span class="hljs-string">&#x27;/Greeter/SayHello&#x27;</span>,<br>            hello__pb2.HelloRequest.SerializeToString,<br>            hello__pb2.HelloReply.FromString,<br>            options, channel_credentials,<br>            insecure, call_credentials, compression, wait_for_ready, timeout, metadata)<br><br></code></pre></td></tr></table></figure><h2 id="5ã€æ ¹ç›®å½•å®šä¹‰server-pyæ–‡ä»¶ï¼Œä½œä¸ºå¯åŠ¨æœåŠ¡ç«¯"><a href="#5ã€æ ¹ç›®å½•å®šä¹‰server-pyæ–‡ä»¶ï¼Œä½œä¸ºå¯åŠ¨æœåŠ¡ç«¯" class="headerlink" title="5ã€æ ¹ç›®å½•å®šä¹‰server.pyæ–‡ä»¶ï¼Œä½œä¸ºå¯åŠ¨æœåŠ¡ç«¯"></a>5ã€æ ¹ç›®å½•å®šä¹‰server.pyæ–‡ä»¶ï¼Œä½œä¸ºå¯åŠ¨æœåŠ¡ç«¯</h2><p><code>server.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> grpc<br><span class="hljs-keyword">from</span> concurrent <span class="hljs-keyword">import</span> futures<br><span class="hljs-comment"># import proto.stream_pb2 as stream_pb2</span><br><span class="hljs-comment"># import proto.stream_pb2_grpc as stream_pb2_grpc</span><br><br><span class="hljs-keyword">from</span> proto <span class="hljs-keyword">import</span> hello_pb2, hello_pb2_grpc<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> base64<br><br><br><span class="hljs-comment"># ç»§æ‰¿ hello_pb2_grpcé‡Œé¢çš„ GreeterServicer åˆ›å»ºæœåŠ¡ç±»ï¼Œå¿…é¡»å®ç°GreeterServiceré‡Œé¢çš„æ–¹æ³•</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyGreeterServicer</span>(hello_pb2_grpc.GreeterServicer):<br>    <span class="hljs-comment"># å®šä¹‰æœåŠ¡ï¼Œè¿™ä¸ªæœåŠ¡æ¥æ”¶è¯·æ±‚ï¼Œè¿”å›å“åº”</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">SayHello</span>(<span class="hljs-params">self, request, context</span>):<br>        <span class="hljs-comment"># åœ¨è¿™é‡Œå¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œå¹¶ç”Ÿæˆç›¸åº”çš„å“åº”æ•°æ®</span><br>        <span class="hljs-built_in">print</span>(request)  <span class="hljs-comment"># requestæ˜¯è¯·æ±‚ï¼Œ</span><br>        <span class="hljs-comment"># è¯·æ±‚è¿›æ¥åè¿™é‡Œå¯ä»¥å†™é€»è¾‘å»å¤„ç†è¯·æ±‚ï¼Œæ¯”å¦‚è¯´åˆ¤æ–­è®¡ç®—ä¹‹ç±»çš„</span><br>        response_str = <span class="hljs-string">f&quot;Hello, <span class="hljs-subst">&#123;request.name&#125;</span>&quot;</span>  <span class="hljs-comment"># æŠŠè¯·æ±‚å¤„ç†ä¸€ä¸‹ï¼Œç­‰ä¸‹è¿”å›å‡ºå»ï¼Œ</span><br>        <span class="hljs-comment"># è¿™é‡Œçš„request.nameæ˜¯å› ä¸ºä½ protoé‡Œå®šä¹‰çš„å°±æ˜¯è¿™ä¸ªï¼Œå‘è¿‡æ¥çš„ requestæ˜¯HelloRequestç±»å‹ï¼Œ</span><br>        <span class="hljs-comment"># å†…å®¹æ˜¯name:&quot;è¾“å…¥çš„å†…å®¹&quot;ï¼Œæ‰€ä»¥ä½ è¦ç”¨request.nameå»æ‹¿åˆ°è¿™ä¸ªè¯·æ±‚ä¼ å…¥çš„å†…å®¹</span><br><br>        response = hello_pb2.HelloReply(message=<span class="hljs-string">f&quot;response: <span class="hljs-subst">&#123;response_str&#125;</span>&quot;</span>)  <span class="hljs-comment"># å®šä¹‰å“åº”ï¼Œè¿”å›å‡ºå»</span><br>        <span class="hljs-keyword">return</span> response<br><br><br><span class="hljs-comment"># å¯åŠ¨æœåŠ¡</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">run_server</span>():<br>    server = grpc.server(futures.ThreadPoolExecutor(max_workers=<span class="hljs-number">10</span>))  <span class="hljs-comment"># è®¾ç½®æœåŠ¡çº¿ç¨‹ï¼Œ</span><br>    hello_pb2_grpc.add_GreeterServicer_to_server(MyGreeterServicer(), server)  <span class="hljs-comment"># æœåŠ¡æ·»åŠ è¿›å»</span><br>    server.add_insecure_port(<span class="hljs-string">&#x27;[::]:50051&#x27;</span>)  <span class="hljs-comment"># å®šä¹‰æœåŠ¡ç«¯å£</span><br>    server.start()  <span class="hljs-comment"># å¼€å¯æœåŠ¡</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;started server&quot;</span>)  <span class="hljs-comment"># æ‰“å°ä¸€ä¸‹ç¡®å®šæœåŠ¡å¼€å¯äº†</span><br>    server.wait_for_termination()  <span class="hljs-comment"># ç­‰å¾…ç»ˆæ­¢ï¼Œå°±æ˜¯å…³é—­</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    run_server()<br><br></code></pre></td></tr></table></figure><h2 id="6ã€æ ¹ç›®å½•å®šä¹‰client-pyæ–‡ä»¶ï¼Œä½œä¸ºå®¢æˆ·ç«¯å»è¿æ¥æœåŠ¡ç«¯"><a href="#6ã€æ ¹ç›®å½•å®šä¹‰client-pyæ–‡ä»¶ï¼Œä½œä¸ºå®¢æˆ·ç«¯å»è¿æ¥æœåŠ¡ç«¯" class="headerlink" title="6ã€æ ¹ç›®å½•å®šä¹‰client.pyæ–‡ä»¶ï¼Œä½œä¸ºå®¢æˆ·ç«¯å»è¿æ¥æœåŠ¡ç«¯"></a>6ã€æ ¹ç›®å½•å®šä¹‰client.pyæ–‡ä»¶ï¼Œä½œä¸ºå®¢æˆ·ç«¯å»è¿æ¥æœåŠ¡ç«¯</h2><p><code>client.py</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">import</span> grpc<br><span class="hljs-comment"># import stream_pb2</span><br><span class="hljs-keyword">from</span> proto <span class="hljs-keyword">import</span> hello_pb2, hello_pb2_grpc<br><br><br><span class="hljs-comment"># import stream_pb2_grpc</span><br><br><span class="hljs-comment"># å¯åŠ¨å®¢æˆ·ç«¯ï¼Œä¸æœåŠ¡ç«¯è¿›è¡Œè¿æ¥ï¼Œä¸”å‘é€è¯·æ±‚</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">run_client</span>():<br>    <span class="hljs-comment"># wit ä¸Šä¸‹æ–‡æ‰“å¼€ä¼šè‡ªåŠ¨å…³é—­ï¼Œ</span><br><br>    <span class="hljs-comment"># channel = grpc.insecure_channel(&#x27;localhost:50051&#x27;)  # å¦‚æœä¸å†™with å°±æ˜¯è¿™æ ·æ¥æ”¶</span><br>    <span class="hljs-keyword">with</span> grpc.insecure_channel(<span class="hljs-string">&#x27;localhost:50051&#x27;</span>) <span class="hljs-keyword">as</span> channel:<br>        stub = hello_pb2_grpc.GreeterStub(channel)  <span class="hljs-comment"># å¾—åˆ°å­˜æ ¹ï¼Œå­˜æ ¹å°±æ˜¯ä»£ç†ï¼Œç”±è¿™ä¸ªä»£ç†å»å‘é€ä½ çš„è¯·æ±‚</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;stub:&quot;</span>, stub)  <span class="hljs-comment"># æ‰“å°ä¸‹å­˜æ ¹ï¼Œç¡®ä¿ä»£ç†å»ºç«‹</span><br>        request = hello_pb2.HelloRequest(name=<span class="hljs-string">&#x27;Tom&#x27;</span>)  <span class="hljs-comment"># å®šä¹‰è¦å‘æœåŠ¡ç«¯å‘é€çš„å†…å®¹</span><br>        <span class="hljs-comment"># è¿™é‡ŒåŒæ ·è¦æ³¨æ„å› ä¸ºä½ protoé‡Œé¢å®šä¹‰çš„ è¯·æ±‚çš„å­—æ®µåå°±æ˜¯name æ‰€ä»¥å¿…é¡»ç”¨name=&#x27;ä½ è¦ä¼ çš„å†…å®¹&#x27;çš„å½¢å¼å»åŒ…è£…è¯·æ±‚ï¼ŒæœåŠ¡ç«¯æ‰èƒ½è¯†åˆ«</span><br><br>        response = stub.SayHello(request)  <span class="hljs-comment"># å¾—åˆ°å“åº” ä¸res = requests.get(url)ä¸€ä¸ªæ„æ€</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Received response:&#x27;</span>, response.message)<br>        <span class="hljs-comment"># æ‰“å°å“åº” ä¹Ÿæ˜¯åŒç†ï¼Œå› ä¸ºä½ protoé‡Œå®šä¹‰è¿”å›çš„å­—æ®µå æ‰€ä»¥å¿…é¡»ç”¨response.messageå»å–è¿™ä¸ªå€¼</span><br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    run_client()<br>    <span class="hljs-comment"># # Get the returned data from the trailing metadata</span><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€pythonã€‘é—­åŒ…ä¹‹å›è°ƒå‡½æ•°å¼‚æ­¥åº”ç”¨åœºæ™¯</title>
    <link href="/2024/03/05/693python%E4%B9%8B%E9%97%AD%E5%8C%85%E4%B9%8B%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0%E5%BC%82%E6%AD%A5%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/"/>
    <url>/2024/03/05/693python%E4%B9%8B%E9%97%AD%E5%8C%85%E4%B9%8B%E5%9B%9E%E8%B0%83%E5%87%BD%E6%95%B0%E5%BC%82%E6%AD%A5%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF/</url>
    
    <content type="html"><![CDATA[<h1 id="python-é—­åŒ…å‡½æ•°-çš„ç”¨é€”"><a href="#python-é—­åŒ…å‡½æ•°-çš„ç”¨é€”" class="headerlink" title="python é—­åŒ…å‡½æ•° çš„ç”¨é€”"></a>python é—­åŒ…å‡½æ•° çš„ç”¨é€”</h1><p>é—­åŒ…å‡½æ•°åœ¨Pythonä¸­æœ‰å¤šç§ç”¨é€”ï¼Œä¸‹é¢æ˜¯ä¸€äº›å¸¸è§çš„åº”ç”¨åœºæ™¯ï¼š</p><ol><li>å°è£…æ•°æ®ï¼šé—­åŒ…å‡½æ•°å¯ä»¥ç”¨äºåˆ›å»ºå¯¹è±¡çš„ç§æœ‰å˜é‡ï¼Œå°†å˜é‡éšè—åœ¨å‡½æ•°å†…éƒ¨ï¼Œåªèƒ½é€šè¿‡ç‰¹å®šçš„å‡½æ•°è®¿é—®å’Œä¿®æ”¹ã€‚è¿™æ ·å¯ä»¥é¿å…å…¨å±€å˜é‡çš„æ±¡æŸ“ï¼Œå¹¶å¢åŠ ä»£ç çš„å°è£…æ€§å’Œå®‰å…¨æ€§ã€‚</li><li>ä¿ç•™çŠ¶æ€ï¼šé—­åŒ…å‡½æ•°å¯ä»¥æ•è·å¹¶ä¿ç•™å…¶å®šä¹‰æ—¶çš„ä¸Šä¸‹æ–‡ç¯å¢ƒã€‚è¿™æ„å‘³ç€å‡½æ•°å¯ä»¥è®°ä½å…¶è¢«åˆ›å»ºæ—¶çš„çŠ¶æ€ï¼Œå¯ä»¥åœ¨åç»­è°ƒç”¨ä¸­ç»§ç»­ä½¿ç”¨è¿™äº›çŠ¶æ€ã€‚è¿™åœ¨éœ€è¦ä¿æŒæŒä¹…çŠ¶æ€çš„åœºæ™¯ä¸­éå¸¸æœ‰ç”¨ï¼Œæ¯”å¦‚è®¡æ•°å™¨ã€ç¼“å­˜ã€å†å²è®°å½•ç­‰ã€‚</li><li>å®ç°è£…é¥°å™¨ï¼šé—­åŒ…å‡½æ•°å¸¸ç”¨äºå®ç°è£…é¥°å™¨ï¼Œè£…é¥°å™¨æ˜¯ä¸€ç§ä¿®æ”¹å‡½æ•°è¡Œä¸ºçš„æŠ€æœ¯ã€‚é€šè¿‡åœ¨å‡½æ•°å®šä¹‰å‰ä½¿ç”¨è£…é¥°å™¨è¯­æ³•ï¼Œå¯ä»¥åœ¨ä¸ä¿®æ”¹åŸå§‹å‡½æ•°ä»£ç çš„æƒ…å†µä¸‹ï¼Œä¸ºå‡½æ•°æ·»åŠ é¢å¤–çš„åŠŸèƒ½ï¼Œæ¯”å¦‚æ—¥å¿—è®°å½•ã€æ€§èƒ½åˆ†æã€è¾“å…¥éªŒè¯ç­‰ã€‚</li><li>å®ç°å›è°ƒå‡½æ•°ï¼šé—­åŒ…å‡½æ•°å¯ä»¥ç”¨ä½œå›è°ƒå‡½æ•°ï¼Œå³å°†ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’ç»™å¦ä¸€ä¸ªå‡½æ•°ï¼Œä»¥åœ¨é€‚å½“çš„æ—¶å€™è¿›è¡Œè°ƒç”¨ã€‚å›è°ƒå‡½æ•°å¸¸ç”¨äºå¼‚æ­¥ç¼–ç¨‹ã€äº‹ä»¶å¤„ç†å’Œè§¦å‘å™¨ç­‰åœºæ™¯ï¼Œé€šè¿‡é—­åŒ…å‡½æ•°å¯ä»¥æ–¹ä¾¿åœ°ä¼ é€’ä¸Šä¸‹æ–‡å’ŒçŠ¶æ€ä¿¡æ¯ã€‚</li><li>å»¶è¿Ÿè®¡ç®—ï¼šé—­åŒ…å‡½æ•°å¯ä»¥ç”¨äºå®ç°å»¶è¿Ÿè®¡ç®—ï¼Œå³å°†è®¡ç®—æ¨è¿Ÿåˆ°ç¨åçš„æ—¶å€™å†è¿›è¡Œã€‚é—­åŒ…å‡½æ•°å¯ä»¥æ•è·æ‰€éœ€çš„å˜é‡å’Œè¡¨è¾¾å¼ï¼Œå¹¶åœ¨éœ€è¦æ—¶è¿›è¡Œè®¡ç®—ã€‚è¿™å¯¹äºå¤„ç†å¤§æ•°æ®é›†æˆ–å¤æ‚è®¡ç®—çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥æé«˜æ•ˆç‡å’Œæ€§èƒ½ã€‚</li></ol><p>æ€»ä¹‹ï¼Œé—­åŒ…å‡½æ•°æä¾›äº†ä¸€ç§çµæ´»è€Œå¼ºå¤§çš„ç¼–ç¨‹å·¥å…·ï¼Œå¯ä»¥ç”¨äºå®ç°è®¸å¤šæœ‰ç”¨çš„åŠŸèƒ½å’Œæ¨¡å¼ã€‚å®ƒä»¬èƒ½å¤Ÿæ•è·ä¸Šä¸‹æ–‡ç¯å¢ƒå¹¶ä¿ç•™çŠ¶æ€ï¼Œä½¿å¾—å‡½æ•°èƒ½å¤Ÿå…·æœ‰æ›´å¤šçš„èƒ½åŠ›å’Œç‰¹æ€§ã€‚</p><p>é—­åŒ…æ¦‚å¿µä¸å›è°ƒå‡½æ•°åœ¨å¼‚æ­¥ä¸Šä¼ æ–‡ä»¶æ—¶çš„åº”ç”¨åœºæ™¯ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">import</span> asyncio<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">upload_file</span>(<span class="hljs-params">file_path</span>):<br>    <span class="hljs-comment"># æ¨¡æ‹Ÿä¸Šä¼ æ–‡ä»¶çš„æ“ä½œ</span><br>    <span class="hljs-comment"># å®é™…åº”è¯¥è°ƒç”¨ä¸Šä¼ æ–‡ä»¶çš„æ–¹æ³•ï¼Œè¿”å›ä»»åŠ¡ID</span><br>    <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">1</span>)  <span class="hljs-comment"># æ¨¡æ‹Ÿä¸Šä¼ çš„è€—æ—¶æ“ä½œ</span><br>    task_id = file_path  <span class="hljs-comment"># è¿™é‡Œå‡è®¾ä»»åŠ¡IDå°±æ˜¯æ–‡ä»¶è·¯å¾„</span><br>    <span class="hljs-keyword">return</span> task_id<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_file</span>(<span class="hljs-params">task_id</span>):<br>    <span class="hljs-comment"># æ¨¡æ‹Ÿè§£ææ–‡ä»¶çš„æ“ä½œ</span><br>    <span class="hljs-comment"># å®é™…åº”è¯¥æ ¹æ®ä»»åŠ¡IDæ‰§è¡Œç›¸åº”çš„è§£ææ“ä½œ</span><br>    <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">1</span>)  <span class="hljs-comment"># æ¨¡æ‹Ÿè§£æçš„è€—æ—¶æ“ä½œ</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&#x27;è§£ææ–‡ä»¶ <span class="hljs-subst">&#123;task_id&#125;</span>&#x27;</span>)<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">upload_worker</span>(<span class="hljs-params">queue, result_queue</span>):<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        file_path = <span class="hljs-keyword">await</span> queue.get()<br>        task_id = <span class="hljs-keyword">await</span> upload_file(file_path)<br>        <span class="hljs-keyword">await</span> result_queue.put(task_id)<br>        queue.task_done()<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">parse_worker</span>(<span class="hljs-params">result_queue</span>):<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>        task_id = <span class="hljs-keyword">await</span> result_queue.get()<br>        <span class="hljs-keyword">await</span> parse_file(task_id)<br>        result_queue.task_done()<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    file_paths = [<span class="hljs-string">f&#x27;/path/to/file<span class="hljs-subst">&#123;i&#125;</span>&#x27;</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>)]  <span class="hljs-comment"># æ–‡ä»¶è·¯å¾„åˆ—è¡¨</span><br><br>    queue = asyncio.Queue()<br>    result_queue = asyncio.Queue()<br><br>    <span class="hljs-comment"># åˆ›å»ºä¸Šä¼ ä»»åŠ¡</span><br>    upload_tasks = []<br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>):  <span class="hljs-comment"># å¯æ ¹æ®éœ€æ±‚è°ƒæ•´å¹¶å‘æ•°</span><br>        task = asyncio.create_task(upload_worker(queue, result_queue))<br>        upload_tasks.append(task)<br><br>    <span class="hljs-comment"># åˆ›å»ºè§£æä»»åŠ¡</span><br>    parse_tasks = []<br>    <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>):  <span class="hljs-comment"># å¯æ ¹æ®éœ€æ±‚è°ƒæ•´å¹¶å‘æ•°</span><br>        task = asyncio.create_task(parse_worker(result_queue))<br>        parse_tasks.append(task)<br><br>    <span class="hljs-comment"># å°†æ–‡ä»¶è·¯å¾„æ”¾å…¥é˜Ÿåˆ—</span><br>    <span class="hljs-keyword">for</span> file_path <span class="hljs-keyword">in</span> file_paths:<br>        <span class="hljs-keyword">await</span> queue.put(file_path)<br><br>    <span class="hljs-comment"># ç­‰å¾…æ‰€æœ‰æ–‡ä»¶ä¸Šä¼ å®Œæˆ</span><br>    <span class="hljs-keyword">await</span> queue.join()<br><br>    <span class="hljs-comment"># ç»“æŸä¸Šä¼ ä»»åŠ¡</span><br>    <span class="hljs-keyword">for</span> task <span class="hljs-keyword">in</span> upload_tasks:<br>        task.cancel()<br><br>    <span class="hljs-comment"># ç­‰å¾…æ‰€æœ‰è§£æä»»åŠ¡å®Œæˆ</span><br>    <span class="hljs-keyword">await</span> result_queue.join()<br><br>    <span class="hljs-comment"># ç»“æŸè§£æä»»åŠ¡</span><br>    <span class="hljs-keyword">for</span> task <span class="hljs-keyword">in</span> parse_tasks:<br>        task.cancel()<br><br>asyncio.run(main())<br><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€pythonã€‘ä¹‹è£…é¥°å™¨çš„åŸºç¡€å®ç°å’Œå¸¸è§è£…é¥°å™¨</title>
    <link href="/2024/03/05/695python%E8%A3%85%E9%A5%B0%E5%99%A8/"/>
    <url>/2024/03/05/695python%E8%A3%85%E9%A5%B0%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<h1 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h1><h1 id="å®ç°æ–¹å¼"><a href="#å®ç°æ–¹å¼" class="headerlink" title="å®ç°æ–¹å¼"></a>å®ç°æ–¹å¼</h1><h1 id="åº”ç”¨åœºæ™¯åŠå¸¸è§è£…é¥°å™¨"><a href="#åº”ç”¨åœºæ™¯åŠå¸¸è§è£…é¥°å™¨" class="headerlink" title="åº”ç”¨åœºæ™¯åŠå¸¸è§è£…é¥°å™¨"></a>åº”ç”¨åœºæ™¯åŠå¸¸è§è£…é¥°å™¨</h1><ul><li>åœ¨Pythonæ¥å£è‡ªåŠ¨åŒ–æµ‹è¯•ä¸­ï¼Œè£…é¥°å™¨å¯ä»¥ç”¨äºå¢å¼ºæµ‹è¯•å‡½æ•°çš„åŠŸèƒ½æˆ–æ”¹å˜å…¶è¡Œä¸ºã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¯èƒ½ä½¿ç”¨çš„è£…é¥°å™¨ç¤ºä¾‹ï¼š</li></ul><h2 id="è®¾ç½®å’Œæ¸…ç†ç¯å¢ƒã€setupå’Œteardownã€‘"><a href="#è®¾ç½®å’Œæ¸…ç†ç¯å¢ƒã€setupå’Œteardownã€‘" class="headerlink" title="è®¾ç½®å’Œæ¸…ç†ç¯å¢ƒã€setupå’Œteardownã€‘"></a><strong>è®¾ç½®å’Œæ¸…ç†ç¯å¢ƒ</strong>ã€setupå’Œteardownã€‘</h2><h3 id="setupï¼šç”¨äºåœ¨æµ‹è¯•å¼€å§‹å‰åˆå§‹åŒ–ç¯å¢ƒæˆ–é…ç½®ã€‚"><a href="#setupï¼šç”¨äºåœ¨æµ‹è¯•å¼€å§‹å‰åˆå§‹åŒ–ç¯å¢ƒæˆ–é…ç½®ã€‚" class="headerlink" title="@setupï¼šç”¨äºåœ¨æµ‹è¯•å¼€å§‹å‰åˆå§‹åŒ–ç¯å¢ƒæˆ–é…ç½®ã€‚"></a>@setupï¼šç”¨äºåœ¨æµ‹è¯•å¼€å§‹å‰åˆå§‹åŒ–ç¯å¢ƒæˆ–é…ç½®ã€‚</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomTestRunner</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        self.setup_done = <span class="hljs-literal">False</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">setup</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Setting up environment...&quot;</span>)<br>        <span class="hljs-comment"># åˆå§‹åŒ–ç¯å¢ƒæˆ–é…ç½®çš„ä»£ç ...</span><br>        self.setup_done = <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">teardown</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">if</span> self.setup_done:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Tearing down environment...&quot;</span>)<br>            <span class="hljs-comment"># æ¸…ç†ç¯å¢ƒæˆ–èµ„æºçš„ä»£ç ...</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">setup</span>(<span class="hljs-params">func</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>(<span class="hljs-params">test_runner, *args, **kwargs</span>):<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> test_runner.setup_done:<br>            test_runner.setup()<br>        <span class="hljs-keyword">return</span> func(test_runner, *args, **kwargs)<br>    <span class="hljs-keyword">return</span> wrapper<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTestCase</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        self.test_runner = CustomTestRunner()<br><span class="hljs-meta">    @setup</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_my_api</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">assert</span> self.test_runner.setup_done, <span class="hljs-string">&quot;Setup should have been called&quot;</span><br>        <span class="hljs-comment"># å®ç°ä½ çš„æ¥å£æµ‹è¯•ä»£ç ...</span><br><span class="hljs-comment"># ä½¿ç”¨ç¤ºä¾‹</span><br>test_case = MyTestCase()<br>test_case.test_my_api()<br></code></pre></td></tr></table></figure><ul><li><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸ºCustomTestRunnerçš„ç±»ï¼Œå…¶ä¸­åŒ…å«äº†ä¸€ä¸ªsetupæ–¹æ³•ç”¨äºåˆå§‹åŒ–ç¯å¢ƒæˆ–é…ç½®ã€‚æˆ‘ä»¬è¿˜å®šä¹‰äº†ä¸€ä¸ªåä¸ºsetupçš„è£…é¥°å™¨ï¼Œå®ƒä¼šåœ¨è°ƒç”¨è¢«è£…é¥°çš„æµ‹è¯•å‡½æ•°ä¹‹å‰æ£€æŸ¥æ˜¯å¦å·²ç»å®Œæˆäº†è®¾ç½®ï¼Œå¹¶åœ¨å¿…è¦æ—¶è°ƒç”¨setupæ–¹æ³•ã€‚</p><p>åœ¨MyTestCaseç±»ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨@setupè£…é¥°å™¨è£…é¥°äº†test_my_apiæ–¹æ³•ã€‚å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªMyTestCaseå®ä¾‹å¹¶è°ƒç”¨å…¶test_my_apiæ–¹æ³•æ—¶ï¼Œè£…é¥°å™¨ä¼šç¡®ä¿åœ¨æµ‹è¯•å¼€å§‹å‰è°ƒç”¨äº†setupæ–¹æ³•ã€‚</p><p>è¯·æ³¨æ„ï¼Œè¿™ä¸ªç¤ºä¾‹ä½¿ç”¨äº†ä¸€ä¸ªè‡ªå®šä¹‰çš„æµ‹è¯•è¿è¡Œå™¨ç±»ï¼ˆCustomTestRunnerï¼‰å’Œè£…é¥°å™¨ï¼ˆ@setupï¼‰ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œä½ å¯èƒ½éœ€è¦æ ¹æ®æ‰€ä½¿ç”¨çš„æµ‹è¯•æ¡†æ¶ï¼ˆå¦‚unittestã€pytestç­‰ï¼‰æ¥è°ƒæ•´å®ç°æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œåœ¨unittestæ¡†æ¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨setUpå’ŒtearDownæ–¹æ³•ä»£æ›¿è‡ªå®šä¹‰çš„setupå’Œteardownæ–¹æ³•ã€‚</p></li></ul><h3 id="teardownï¼šç”¨äºåœ¨æµ‹è¯•ç»“æŸåæ¸…ç†ç¯å¢ƒæˆ–èµ„æºã€‚"><a href="#teardownï¼šç”¨äºåœ¨æµ‹è¯•ç»“æŸåæ¸…ç†ç¯å¢ƒæˆ–èµ„æºã€‚" class="headerlink" title="teardownï¼šç”¨äºåœ¨æµ‹è¯•ç»“æŸåæ¸…ç†ç¯å¢ƒæˆ–èµ„æºã€‚"></a>teardownï¼šç”¨äºåœ¨æµ‹è¯•ç»“æŸåæ¸…ç†ç¯å¢ƒæˆ–èµ„æºã€‚</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomTestRunner</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        self.setup_done = <span class="hljs-literal">False</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">setup</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Setting up environment...&quot;</span>)<br>        <span class="hljs-comment"># åˆå§‹åŒ–ç¯å¢ƒæˆ–é…ç½®çš„ä»£ç ...</span><br>        self.setup_done = <span class="hljs-literal">True</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">teardown</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">if</span> self.setup_done:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Tearing down environment...&quot;</span>)<br>            <span class="hljs-comment"># æ¸…ç†ç¯å¢ƒæˆ–èµ„æºçš„ä»£ç ...</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">teardown</span>(<span class="hljs-params">func</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>(<span class="hljs-params">test_runner, *args, **kwargs</span>):<br>        result = func(test_runner, *args, **kwargs)<br>        test_runner.teardown()<br>        <span class="hljs-keyword">return</span> result<br>    <span class="hljs-keyword">return</span> wrapper<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTestCase</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        self.test_runner = CustomTestRunner()<br><span class="hljs-meta">    @teardown</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_my_api</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">assert</span> self.test_runner.setup_done, <span class="hljs-string">&quot;Setup should have been called&quot;</span><br>        <span class="hljs-comment"># å®ç°ä½ çš„æ¥å£æµ‹è¯•ä»£ç ...</span><br><span class="hljs-comment"># ä½¿ç”¨ç¤ºä¾‹</span><br>test_case = MyTestCase()<br>test_case.test_my_api()<br></code></pre></td></tr></table></figure><ul><li><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåä¸ºCustomTestRunnerçš„ç±»ï¼Œå…¶ä¸­åŒ…å«äº†ä¸€ä¸ªteardownæ–¹æ³•ç”¨äºæ¸…ç†ç¯å¢ƒæˆ–èµ„æºã€‚æˆ‘ä»¬è¿˜å®šä¹‰äº†ä¸€ä¸ªåä¸ºteardownçš„è£…é¥°å™¨ï¼Œå®ƒä¼šåœ¨è¢«è£…é¥°çš„æµ‹è¯•å‡½æ•°æ‰§è¡Œå®Œæ¯•åè°ƒç”¨teardownæ–¹æ³•ã€‚</p><p>åœ¨MyTestCaseç±»ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨@teardownè£…é¥°å™¨è£…é¥°äº†test_my_apiæ–¹æ³•ã€‚å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªMyTestCaseå®ä¾‹å¹¶è°ƒç”¨å…¶test_my_apiæ–¹æ³•æ—¶ï¼Œè£…é¥°å™¨ä¼šç¡®ä¿åœ¨æµ‹è¯•ç»“æŸåè°ƒç”¨äº†teardownæ–¹æ³•ã€‚</p><p>è¯·æ³¨æ„ï¼Œè¿™ä¸ªç¤ºä¾‹ä½¿ç”¨äº†ä¸€ä¸ªè‡ªå®šä¹‰çš„æµ‹è¯•è¿è¡Œå™¨ç±»ï¼ˆCustomTestRunnerï¼‰å’Œè£…é¥°å™¨ï¼ˆ@teardownï¼‰ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œä½ å¯èƒ½éœ€è¦æ ¹æ®æ‰€ä½¿ç”¨çš„æµ‹è¯•æ¡†æ¶ï¼ˆå¦‚unittestã€pytestç­‰ï¼‰æ¥è°ƒæ•´å®ç°æ–¹å¼ã€‚ä¾‹å¦‚ï¼Œåœ¨unittestæ¡†æ¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨setUpå’ŒtearDownæ–¹æ³•ä»£æ›¿è‡ªå®šä¹‰çš„setupå’Œteardownæ–¹æ³•ã€‚åœ¨pytestæ¡†æ¶ä¸­ï¼Œå¯ä»¥ä½¿ç”¨yieldè¯­å¥å’ŒfixtureåŠŸèƒ½æ¥å®ç°ç±»ä¼¼çš„æ•ˆæœã€‚</p></li></ul><h2 id="æ•°æ®é©±åŠ¨æµ‹è¯•"><a href="#æ•°æ®é©±åŠ¨æµ‹è¯•" class="headerlink" title="æ•°æ®é©±åŠ¨æµ‹è¯•"></a>æ•°æ®é©±åŠ¨æµ‹è¯•</h2><p>ä½¿ç”¨ddtåº“æä¾›çš„è£…é¥°å™¨ï¼Œå¦‚@dataã€@unpackç­‰ï¼Œæ¥å®ç°æ•°æ®é©±åŠ¨çš„æµ‹è¯•ã€‚</p><p>@dataå’Œ@unpackæ˜¯ddtï¼ˆData-Driven Testsï¼‰åº“æä¾›çš„è£…é¥°å™¨ï¼Œç”¨äºå®ç°æ•°æ®é©±åŠ¨çš„æµ‹è¯•ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨@dataå’Œ@unpackè£…é¥°å™¨çš„ç¤ºä¾‹ï¼š</p><ul><li><p>é¦–å…ˆï¼Œç¡®ä¿å·²ç»å®‰è£…äº†ddtåº“ï¼špip install ddt</p></li><li><p>ç„¶åï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç ç¤ºä¾‹ï¼š</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">from</span> ddt <span class="hljs-keyword">import</span> ddt, data, unpack<br><span class="hljs-keyword">import</span> unittest<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTestCase</span>(unittest.TestCase):<br><span class="hljs-meta">    @classmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">setUpClass</span>(<span class="hljs-params">cls</span>):<br>        cls.base_url = <span class="hljs-string">&quot;http://example.com/api&quot;</span><br><span class="hljs-meta">    @data(<span class="hljs-params"></span></span><br><span class="hljs-params"><span class="hljs-meta">        (<span class="hljs-params"><span class="hljs-string">&quot;Alice&quot;</span>, <span class="hljs-string">&quot;password123&quot;</span>, <span class="hljs-number">200</span></span>),</span></span><br><span class="hljs-params"><span class="hljs-meta">        (<span class="hljs-params"><span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-string">&quot;invalid_password&quot;</span>, <span class="hljs-number">401</span></span>),</span></span><br><span class="hljs-params"><span class="hljs-meta">        (<span class="hljs-params"><span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-number">400</span></span>),</span></span><br><span class="hljs-params"><span class="hljs-meta">        (<span class="hljs-params"><span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>, <span class="hljs-number">400</span></span>),</span></span><br><span class="hljs-params"><span class="hljs-meta">    </span>)</span><br><span class="hljs-meta">    @unpack</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_login</span>(<span class="hljs-params">self, username, password, expected_status_code</span>):<br>        url = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;self.base_url&#125;</span>/login&quot;</span><br>        payload = &#123;<span class="hljs-string">&quot;username&quot;</span>: username, <span class="hljs-string">&quot;password&quot;</span>: password&#125;<br>        response = requests.post(url, json=payload)<br>        self.assertEqual(response.status_code, expected_status_code)<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    unittest.main()<br></code></pre></td></tr></table></figure><ul><li><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p><p>æˆ‘ä»¬ä½¿ç”¨@dataè£…é¥°å™¨å®šä¹‰äº†ä¸€ä¸ªåŒ…å«å¤šä¸ªæµ‹è¯•æ•°æ®é›†çš„å…ƒç»„åˆ—è¡¨ã€‚æ¯ä¸ªå…ƒç»„ä»£è¡¨ä¸€ä¸ªç‰¹å®šçš„æµ‹è¯•åœºæ™¯ï¼ŒåŒ…æ‹¬ç”¨æˆ·åã€å¯†ç å’Œé¢„æœŸçš„HTTPçŠ¶æ€ç ã€‚</p><p>ä½¿ç”¨@unpackè£…é¥°å™¨ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…ƒç»„ä¸­çš„å€¼ç›´æ¥è§£åŒ…å¹¶ä½œä¸ºæµ‹è¯•å‡½æ•°çš„å‚æ•°ã€‚è¿™æ ·åœ¨æµ‹è¯•å‡½æ•°å†…éƒ¨ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥ä½¿ç”¨è¿™äº›å˜é‡åï¼Œè€Œä¸éœ€è¦é€šè¿‡ç´¢å¼•æ¥è®¿é—®å®ƒä»¬ã€‚</p><p>åœ¨test_loginæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬æ ¹æ®æä¾›çš„ç”¨æˆ·åã€å¯†ç å’Œé¢„æœŸçŠ¶æ€ç å‘é€ç™»å½•è¯·æ±‚ï¼Œå¹¶éªŒè¯å“åº”çš„çŠ¶æ€ç æ˜¯å¦ä¸é¢„æœŸç›¸ç¬¦ã€‚</p><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨@dataå’Œ@unpackè£…é¥°å™¨è½»æ¾åœ°ä¸ºåŒä¸€ä¸ªæµ‹è¯•å‡½æ•°å®šä¹‰å¤šä¸ªä¸åŒçš„æµ‹è¯•åœºæ™¯ï¼Œä»è€Œæé«˜æµ‹è¯•è¦†ç›–ç‡å’Œä»£ç çš„å¯è¯»æ€§ã€‚</p></li></ul><h2 id="æ•°æ®ç±»è£…é¥°å™¨ï¼Œ-dataclass"><a href="#æ•°æ®ç±»è£…é¥°å™¨ï¼Œ-dataclass" class="headerlink" title="æ•°æ®ç±»è£…é¥°å™¨ï¼Œ@dataclass"></a>æ•°æ®ç±»è£…é¥°å™¨ï¼Œ@dataclass</h2><p>æŠŠä¸€ä¸ªç±»è£…é¥°æˆä¸€ä¸ªæ•°æ®ç±»â€“æ–¹ä¾¿åé¢å–å€¼ï¼Œåé¢å°±å¯ä»¥ç›´æ¥è°ƒç”¨æ­¤ç±»çš„å±æ€§æ‹¿åˆ°å€¼äº†ï¼Œä¸éœ€è¦åƒå­—å…¸ä¸€æ ·ä½¿ç”¨ç‚¹get()æˆ–è€…[â€˜é”®åâ€™]çš„æ–¹å¼å»æ‹¿æ•°æ®</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> dataclasses <span class="hljs-keyword">import</span> dataclass<br><br><span class="hljs-meta">@dataclass</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span>:<span class="hljs-comment"># å°†è¿™ä¸ªç±»è£…é¥°æˆæ•°æ®ç±»</span><br>    name: <span class="hljs-built_in">str</span><span class="hljs-comment"># å®šä¹‰æ•°æ®çš„ç±»å‹</span><br>    age: <span class="hljs-built_in">int</span><br>    email: <span class="hljs-built_in">str</span><br><br><span class="hljs-comment"># åˆ›å»ºå¯¹è±¡ å®ä¾‹åŒ–å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯å®ä¾‹åŒ–æ•°æ®ï¼Œ</span><br>person = Person(<span class="hljs-string">&quot;Alice&quot;</span>, <span class="hljs-number">25</span>, <span class="hljs-string">&quot;alice@example.com&quot;</span>)<br><span class="hljs-built_in">print</span>(person.name)    <span class="hljs-comment"># è¾“å‡º: Alice</span><br><span class="hljs-built_in">print</span>(person.age)     <span class="hljs-comment"># è¾“å‡º: 25</span><br><span class="hljs-built_in">print</span>(person.email)   <span class="hljs-comment"># è¾“å‡º: alice@example.com</span><br><span class="hljs-comment"># ä¹Ÿå¯ä»¥é€šè¿‡**çš„æ–¹å¼ä¼ è¿›å»ï¼Œæ›´ç¾è§‚</span><br>person2_dict = &#123;<br>    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Bob&quot;</span>,<br>    <span class="hljs-string">&quot;age&quot;</span>: <span class="hljs-number">30</span>,<br>    <span class="hljs-string">&quot;email&quot;</span>: <span class="hljs-string">&quot;Bob@example.com&quot;</span><br>&#125;<br>person2 = Person(**person2_dict)<br><span class="hljs-comment"># è®¿é—®å±æ€§</span><br><br><span class="hljs-built_in">print</span>(person2.name) <span class="hljs-comment"># è¾“å‡º: Bob</span><br><span class="hljs-built_in">print</span>(person2.age)  <span class="hljs-comment"># è¾“å‡º: 30</span><br><span class="hljs-built_in">print</span>(person2.email)  <span class="hljs-comment"># è¾“å‡º: Bob@example.com</span><br><br></code></pre></td></tr></table></figure><h2 id="æ€§èƒ½æµ‹è¯•"><a href="#æ€§èƒ½æµ‹è¯•" class="headerlink" title="æ€§èƒ½æµ‹è¯•"></a>æ€§èƒ½æµ‹è¯•</h2><h3 id="timerï¼šæµ‹é‡æµ‹è¯•å‡½æ•°çš„æ‰§è¡Œæ—¶é—´ã€‚"><a href="#timerï¼šæµ‹é‡æµ‹è¯•å‡½æ•°çš„æ‰§è¡Œæ—¶é—´ã€‚" class="headerlink" title="@timerï¼šæµ‹é‡æµ‹è¯•å‡½æ•°çš„æ‰§è¡Œæ—¶é—´ã€‚"></a>@timerï¼šæµ‹é‡æµ‹è¯•å‡½æ•°çš„æ‰§è¡Œæ—¶é—´ã€‚</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">timer</span>(<span class="hljs-params">func</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>(<span class="hljs-params">*args, **kwargs</span>):<br>        start_time = time.time() <span class="hljs-comment"># è®°å½•å¼€å§‹æ—¶é—´</span><br>        result = func(*args, **kwargs)<br>        end_time = time.time()<span class="hljs-comment"># è®°å½•ç»“æŸæ—¶é—´</span><br>        <span class="hljs-comment"># è®°å½•è¿è¡Œæ—¶é—´</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;<span class="hljs-subst">&#123;func.__name__&#125;</span> executed in <span class="hljs-subst">&#123;end_time - start_time:<span class="hljs-number">.6</span>f&#125;</span> seconds&quot;</span>)<br>        <span class="hljs-keyword">return</span> result<br>    <span class="hljs-keyword">return</span> wrapper<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTestCase</span>(unittest.TestCase):<br><span class="hljs-meta">    @timer</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_my_api</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-comment"># å®ç°ä½ çš„æ¥å£æµ‹è¯•ä»£ç ...</span><br>        time.sleep(<span class="hljs-number">2</span>)  <span class="hljs-comment"># æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    unittest.main()<br></code></pre></td></tr></table></figure><ul><li><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p><p>æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸ºtimerçš„è£…é¥°å™¨ï¼Œå®ƒæ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼ˆå³wrapperï¼‰ã€‚</p><p>åœ¨wrapperå‡½æ•°å†…éƒ¨ï¼Œæˆ‘ä»¬é¦–å…ˆè®°å½•å¼€å§‹æ—¶é—´ï¼Œç„¶åè°ƒç”¨åŸå§‹å‡½æ•°å¹¶è·å–å…¶ç»“æœï¼Œæœ€åè®°å½•ç»“æŸæ—¶é—´ã€‚</p><p>æˆ‘ä»¬è®¡ç®—å¹¶æ‰“å°å‡ºè¢«è£…é¥°çš„å‡½æ•°çš„æ‰§è¡Œæ—¶é—´ã€‚</p><p>åœ¨MyTestCaseç±»ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨@timerè£…é¥°å™¨è£…é¥°äº†test_my_apiæ–¹æ³•ã€‚å½“æˆ‘ä»¬è¿è¡Œè¿™ä¸ªæµ‹è¯•ç”¨ä¾‹æ—¶ï¼Œè£…é¥°å™¨ä¼šæµ‹é‡å¹¶æ‰“å°å‡ºè¯¥æ–¹æ³•çš„æ‰§è¡Œæ—¶é—´ã€‚</p><p>è¯·æ³¨æ„ï¼Œè¿™ä¸ªtimerè£…é¥°å™¨åªæ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå®é™…ä½¿ç”¨ä¸­å¯èƒ½éœ€è¦æ ¹æ®å…·ä½“éœ€æ±‚è¿›è¡Œè°ƒæ•´ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½å¸Œæœ›å°†æ‰§è¡Œæ—¶é—´è®°å½•åˆ°æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œæˆ–è€…åœ¨æµ‹è¯•æŠ¥å‘Šä¸­åŒ…å«æ‰§è¡Œæ—¶é—´ä¿¡æ¯ç­‰ã€‚</p></li></ul><h3 id="profileï¼ˆä½¿ç”¨cProfileåº“ï¼‰ï¼šè¿›è¡ŒCPUæ€§èƒ½åˆ†æã€‚"><a href="#profileï¼ˆä½¿ç”¨cProfileåº“ï¼‰ï¼šè¿›è¡ŒCPUæ€§èƒ½åˆ†æã€‚" class="headerlink" title="@profileï¼ˆä½¿ç”¨cProfileåº“ï¼‰ï¼šè¿›è¡ŒCPUæ€§èƒ½åˆ†æã€‚"></a>@profileï¼ˆä½¿ç”¨cProfileåº“ï¼‰ï¼šè¿›è¡ŒCPUæ€§èƒ½åˆ†æã€‚</h3><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨@profileè£…é¥°å™¨ï¼ˆé…åˆcProfileåº“ï¼‰è¿›è¡ŒCPUæ€§èƒ½åˆ†æçš„ç®€å•ç¤ºä¾‹ï¼š</p><ul><li><p>é¦–å…ˆï¼Œç¡®ä¿å·²ç»å®‰è£…äº†cProfileåº“ pip install cProfile</p></li><li><p>ç„¶åï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç ç¤ºä¾‹ï¼š</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">import</span> cProfile<br><span class="hljs-keyword">from</span> pstats <span class="hljs-keyword">import</span> Stats<br><span class="hljs-keyword">import</span> unittest<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTestCase</span>(unittest.TestCase):<br><span class="hljs-meta">    @classmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">setUpClass</span>(<span class="hljs-params">cls</span>):<br>        cls.base_url = <span class="hljs-string">&quot;http://example.com/api&quot;</span><br><span class="hljs-meta">    @profile</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_my_api</span>(<span class="hljs-params">self</span>):<br>        url = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;self.base_url&#125;</span>/resource&quot;</span><br>        response = requests.get(url)<br>        self.assertEqual(response.status_code, <span class="hljs-number">200</span>)<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    profiler = cProfile.Profile()<br>    test_case = MyTestCase()<br>    test_case.test_my_api()<br>    profiler.create_stats()<br>    stats = Stats(profiler)<br>    stats.sort_stats(<span class="hljs-string">&#x27;cumulative&#x27;</span>)<br>    stats.print_stats()<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p><p>æˆ‘ä»¬ä½¿ç”¨@profileè£…é¥°å™¨è£…é¥°äº†test_my_apiæ–¹æ³•ã€‚å½“è¿è¡Œè¿™ä¸ªæµ‹è¯•ç”¨ä¾‹æ—¶ï¼ŒcProfileåº“ä¼šè®°å½•è¯¥æ–¹æ³•çš„CPUæ€§èƒ½æ•°æ®ã€‚</p><p>åœ¨æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œå®Œæ¯•åï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªStatså¯¹è±¡ï¼Œå¹¶å°†Profilerçš„ç»Ÿè®¡æ•°æ®ä¼ é€’ç»™å®ƒã€‚</p><p>æˆ‘ä»¬è°ƒç”¨sort_statsæ–¹æ³•å¯¹ç»Ÿè®¡æ•°æ®è¿›è¡Œæ’åºã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬é€‰æ‹©äº†æŒ‰ç´¯è®¡æ—¶é—´æ’åºã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬è°ƒç”¨print_statsæ–¹æ³•æ‰“å°å‡ºæ€§èƒ½åˆ†æç»“æœã€‚</p><p>è¯·æ³¨æ„ï¼Œè¿™ä¸ªç¤ºä¾‹åªæ˜¯ä¸€ä¸ªåŸºæœ¬çš„ä½¿ç”¨æ–¹å¼ï¼Œå®é™…ä½¿ç”¨ä¸­å¯èƒ½éœ€è¦æ ¹æ®å…·ä½“éœ€æ±‚è¿›è¡Œè°ƒæ•´ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½å¸Œæœ›å°†æ€§èƒ½åˆ†æç»“æœä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼Œæˆ–è€…ä½¿ç”¨æ›´å¤æ‚çš„ç»Ÿè®¡å’Œè¿‡æ»¤é€‰é¡¹ç­‰ã€‚å¦å¤–ï¼ŒcProfileåº“ä¸»è¦ç”¨äºCPUæ€§èƒ½åˆ†æï¼Œå¦‚æœä½ éœ€è¦è¿›è¡Œå†…å­˜æˆ–å…¶ä»–èµ„æºçš„æ€§èƒ½åˆ†æï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨å…¶ä»–å·¥å…·æˆ–åº“ã€‚</p><h2 id="æ—¥å¿—è®°å½•"><a href="#æ—¥å¿—è®°å½•" class="headerlink" title="æ—¥å¿—è®°å½•"></a><strong>æ—¥å¿—è®°å½•</strong></h2><h3 id="log-testï¼šè®°å½•æµ‹è¯•çš„å¼€å§‹å’Œç»“æŸï¼Œä»¥åŠæµ‹è¯•ç»“æœã€‚"><a href="#log-testï¼šè®°å½•æµ‹è¯•çš„å¼€å§‹å’Œç»“æŸï¼Œä»¥åŠæµ‹è¯•ç»“æœã€‚" class="headerlink" title="@log_testï¼šè®°å½•æµ‹è¯•çš„å¼€å§‹å’Œç»“æŸï¼Œä»¥åŠæµ‹è¯•ç»“æœã€‚"></a>@log_testï¼šè®°å½•æµ‹è¯•çš„å¼€å§‹å’Œç»“æŸï¼Œä»¥åŠæµ‹è¯•ç»“æœã€‚</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> unittest<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestLogger</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">log_start</span>(<span class="hljs-params">self, test_name</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Starting test: <span class="hljs-subst">&#123;test_name&#125;</span>&quot;</span>)<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">log_end</span>(<span class="hljs-params">self, test_name, result</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Ending test: <span class="hljs-subst">&#123;test_name&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">if</span> result:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Test passed.&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Test failed.&quot;</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">log_test</span>(<span class="hljs-params">func</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>(<span class="hljs-params">test_logger, *args, **kwargs</span>):<br>        test_name = func.__name__<br>        test_logger.log_start(test_name)<br>        result = func(test_logger, *args, **kwargs)<br>        test_logger.log_end(test_name, result)<br>        <span class="hljs-keyword">return</span> result<br>    <span class="hljs-keyword">return</span> wrapper<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTestCase</span>(unittest.TestCase):<br><span class="hljs-meta">    @classmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">setUpClass</span>(<span class="hljs-params">cls</span>):<br>        cls.test_logger = TestLogger()<br><span class="hljs-meta">    @log_test</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_my_api</span>(<span class="hljs-params">self, test_logger</span>):<br>        url = <span class="hljs-string">&quot;http://example.com/api&quot;</span><br>        response = requests.get(url)<br>        self.assertEqual(response.status_code, <span class="hljs-number">200</span>)<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    unittest.main()<br></code></pre></td></tr></table></figure><ul><li><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p><p>æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸ºTestLoggerçš„ç±»ï¼Œå®ƒåŒ…å«ä¸¤ä¸ªæ–¹æ³•ï¼šlog_startå’Œlog_endï¼Œåˆ†åˆ«ç”¨äºè®°å½•æµ‹è¯•çš„å¼€å§‹å’Œç»“æŸï¼Œä»¥åŠæµ‹è¯•ç»“æœã€‚</p><p>æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸ºlog_testçš„è£…é¥°å™¨ï¼Œå®ƒæ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼ˆå³wrapperï¼‰ã€‚</p><p>åœ¨wrapperå‡½æ•°å†…éƒ¨ï¼Œæˆ‘ä»¬é¦–å…ˆè·å–è¢«è£…é¥°çš„å‡½æ•°åï¼Œç„¶åè°ƒç”¨log_startæ–¹æ³•è®°å½•æµ‹è¯•çš„å¼€å§‹ã€‚</p><p>æˆ‘ä»¬è°ƒç”¨åŸå§‹å‡½æ•°å¹¶è·å–å…¶ç»“æœã€‚</p><p>æˆ‘ä»¬è°ƒç”¨log_endæ–¹æ³•è®°å½•æµ‹è¯•çš„ç»“æŸï¼Œå¹¶ä¼ é€’æµ‹è¯•ç»“æœã€‚</p><p>åœ¨MyTestCaseç±»ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªTestLoggerå®ä¾‹ï¼Œå¹¶åœ¨setUpClassæ–¹æ³•ä¸­è®¾ç½®ä¸ºç±»å˜é‡ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨@log_testè£…é¥°å™¨è£…é¥°äº†test_my_apiæ–¹æ³•ã€‚å½“æˆ‘ä»¬è¿è¡Œè¿™ä¸ªæµ‹è¯•ç”¨ä¾‹æ—¶ï¼Œè£…é¥°å™¨ä¼šè®°å½•æµ‹è¯•çš„å¼€å§‹å’Œç»“æŸï¼Œä»¥åŠæµ‹è¯•ç»“æœã€‚</p><p>è¯·æ³¨æ„ï¼Œè¿™ä¸ªlog_testè£…é¥°å™¨åªæ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå®é™…ä½¿ç”¨ä¸­å¯èƒ½éœ€è¦æ ¹æ®å…·ä½“éœ€æ±‚è¿›è¡Œè°ƒæ•´ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½å¸Œæœ›å°†æ—¥å¿—ä¿¡æ¯å†™å…¥æ–‡ä»¶ï¼Œæˆ–è€…ä½¿ç”¨æ›´å¤æ‚çš„æ—¥å¿—æ ¼å¼å’Œçº§åˆ«ç­‰ã€‚å¦å¤–ï¼Œè¿™ä¸ªç¤ºä¾‹ä¸­çš„æ—¥å¿—è¾“å‡ºæ˜¯ç®€å•çš„æ–‡æœ¬å½¢å¼ï¼Œå¦‚æœä½ éœ€è¦æ›´ä¸°å¯Œçš„æ—¥å¿—åŠŸèƒ½ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨Pythonçš„loggingæ¨¡å—ã€‚</p></li></ul><h2 id="å¼‚å¸¸å¤„ç†"><a href="#å¼‚å¸¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å¤„ç†"></a><strong>å¼‚å¸¸å¤„ç†</strong></h2><h3 id="catch-exceptionsï¼šæ•è·å¹¶å¤„ç†æµ‹è¯•å‡½æ•°ä¸­å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸ã€‚"><a href="#catch-exceptionsï¼šæ•è·å¹¶å¤„ç†æµ‹è¯•å‡½æ•°ä¸­å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸ã€‚" class="headerlink" title="@catch_exceptionsï¼šæ•è·å¹¶å¤„ç†æµ‹è¯•å‡½æ•°ä¸­å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸ã€‚"></a>@catch_exceptionsï¼šæ•è·å¹¶å¤„ç†æµ‹è¯•å‡½æ•°ä¸­å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸ã€‚</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> unittest<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">catch_exceptions</span>(<span class="hljs-params">func</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>(<span class="hljs-params">*args, **kwargs</span>):<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-keyword">return</span> func(*args, **kwargs)<br>        <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Exception caught during test: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">False</span><br>    <span class="hljs-keyword">return</span> wrapper<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTestCase</span>(unittest.TestCase):<br><span class="hljs-meta">    @classmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">setUpClass</span>(<span class="hljs-params">cls</span>):<br>        cls.base_url = <span class="hljs-string">&quot;http://example.com/api&quot;</span><br><span class="hljs-meta">    @catch_exceptions</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_my_api</span>(<span class="hljs-params">self</span>):<br>        url = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;self.base_url&#125;</span>/resource&quot;</span><br>        response = requests.get(url)<br>        self.assertEqual(response.status_code, <span class="hljs-number">200</span>)<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    unittest.main()<br></code></pre></td></tr></table></figure><ul><li><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p><p>æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸ºcatch_exceptionsçš„è£…é¥°å™¨ï¼Œå®ƒæ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼ˆå³wrapperï¼‰ã€‚</p><p>åœ¨wrapperå‡½æ•°å†…éƒ¨ï¼Œæˆ‘ä»¬ä½¿ç”¨try-exceptè¯­å¥åŒ…è£¹åŸå§‹å‡½æ•°çš„è°ƒç”¨ã€‚å¦‚æœåœ¨æ‰§è¡ŒåŸå§‹å‡½æ•°æ—¶æŠ›å‡ºäº†å¼‚å¸¸ï¼Œæˆ‘ä»¬å°†æ•è·è¿™ä¸ªå¼‚å¸¸ï¼Œå¹¶æ‰“å°å‡ºå¼‚å¸¸ä¿¡æ¯ã€‚</p><p>å¦‚æœæ•è·åˆ°å¼‚å¸¸ï¼Œæˆ‘ä»¬è¿”å›Falseï¼Œè¡¨ç¤ºæµ‹è¯•å¤±è´¥ã€‚å¦åˆ™ï¼Œæˆ‘ä»¬è¿”å›åŸå§‹å‡½æ•°çš„è¿”å›å€¼ã€‚</p><p>åœ¨MyTestCaseç±»ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨@catch_exceptionsè£…é¥°å™¨è£…é¥°äº†test_my_apiæ–¹æ³•ã€‚å½“æˆ‘ä»¬è¿è¡Œè¿™ä¸ªæµ‹è¯•ç”¨ä¾‹æ—¶ï¼Œè£…é¥°å™¨ä¼šæ•è·å¹¶å¤„ç†è¯¥æ–¹æ³•ä¸­å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸ã€‚</p><p>è¯·æ³¨æ„ï¼Œè¿™ä¸ªcatch_exceptionsè£…é¥°å™¨åªæ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå®é™…ä½¿ç”¨ä¸­å¯èƒ½éœ€è¦æ ¹æ®å…·ä½“éœ€æ±‚è¿›è¡Œè°ƒæ•´ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½å¸Œæœ›å¯¹ä¸åŒç±»å‹çš„å¼‚å¸¸è¿›è¡Œä¸åŒçš„å¤„ç†ï¼Œæˆ–è€…åœ¨æ•è·å¼‚å¸¸åæ‰§è¡Œä¸€äº›æ¸…ç†æ“ä½œç­‰ã€‚å¦å¤–ï¼Œè™½ç„¶è¿™ä¸ªè£…é¥°å™¨å¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨æµ‹è¯•å‡½æ•°ä¸­æ•è·å’Œå¤„ç†å¼‚å¸¸ï¼Œä½†åœ¨ç¼–å†™æµ‹è¯•ä»£ç æ—¶ï¼Œé€šå¸¸å»ºè®®æ˜ç¡®é¢„æœŸå¯èƒ½ä¼šæŠ›å‡ºçš„å¼‚å¸¸ï¼Œå¹¶ä½¿ç”¨assertRaisesç­‰æ–­è¨€æ¥éªŒè¯å®ƒä»¬ã€‚è¿™æ ·å¯ä»¥æä¾›æ›´æ¸…æ™°çš„æµ‹è¯•æ„å›¾å’Œæ›´å¥½çš„é”™è¯¯æ¶ˆæ¯ã€‚</p></li></ul><h2 id="é‡è¯•æœºåˆ¶"><a href="#é‡è¯•æœºåˆ¶" class="headerlink" title="é‡è¯•æœºåˆ¶"></a>é‡è¯•æœºåˆ¶</h2><h3 id="retryï¼šåœ¨æµ‹è¯•å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•æŒ‡å®šæ¬¡æ•°"><a href="#retryï¼šåœ¨æµ‹è¯•å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•æŒ‡å®šæ¬¡æ•°" class="headerlink" title="@retryï¼šåœ¨æµ‹è¯•å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•æŒ‡å®šæ¬¡æ•°"></a>@retryï¼šåœ¨æµ‹è¯•å¤±è´¥æ—¶è‡ªåŠ¨é‡è¯•æŒ‡å®šæ¬¡æ•°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">import</span> unittest<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">retry</span>(<span class="hljs-params">attempts=<span class="hljs-number">3</span>, delay=<span class="hljs-number">1</span></span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">decorator</span>(<span class="hljs-params">func</span>):<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>(<span class="hljs-params">*args, **kwargs</span>):<br>            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(attempts):<br>                <span class="hljs-keyword">try</span>:<br>                    <span class="hljs-keyword">return</span> func(*args, **kwargs)<br>                <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>                    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Test failed on attempt <span class="hljs-subst">&#123;i + <span class="hljs-number">1</span>&#125;</span>: <span class="hljs-subst">&#123;e&#125;</span>&quot;</span>)<br>                    <span class="hljs-keyword">if</span> i &lt; attempts - <span class="hljs-number">1</span>:<br>                        time.sleep(delay)<br>            <span class="hljs-keyword">raise</span> Exception(<span class="hljs-string">f&quot;Test failed after <span class="hljs-subst">&#123;attempts&#125;</span> attempts&quot;</span>)<br>        <span class="hljs-keyword">return</span> wrapper<br>    <span class="hljs-keyword">return</span> decorator<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTestCase</span>(unittest.TestCase):<br><span class="hljs-meta">    @classmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">setUpClass</span>(<span class="hljs-params">cls</span>):<br>        cls.base_url = <span class="hljs-string">&quot;http://example.com/api&quot;</span><br><span class="hljs-meta">    @retry(<span class="hljs-params">attempts=<span class="hljs-number">3</span>, delay=<span class="hljs-number">2</span></span>)</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_my_api</span>(<span class="hljs-params">self</span>):<br>        url = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;self.base_url&#125;</span>/resource&quot;</span><br>        response = requests.get(url)<br>        self.assertEqual(response.status_code, <span class="hljs-number">200</span>)<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    unittest.main()<br></code></pre></td></tr></table></figure><ul><li><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p><p>æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸ºretryçš„è£…é¥°å™¨ï¼Œå®ƒæ¥å—ä¸¤ä¸ªå¯é€‰å‚æ•°ï¼šattemptsï¼ˆé‡è¯•æ¬¡æ•°ï¼Œé»˜è®¤ä¸º3ï¼‰å’Œdelayï¼ˆæ¯æ¬¡é‡è¯•ä¹‹é—´çš„å»¶è¿Ÿæ—¶é—´ï¼Œé»˜è®¤ä¸º1ç§’ï¼‰ã€‚</p><p>retryè£…é¥°å™¨å†…éƒ¨å®šä¹‰äº†ä¸€ä¸ªæ–°çš„è£…é¥°å™¨å‡½æ•°ï¼ˆå³decoratorï¼‰ï¼Œå®ƒæ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼ˆå³wrapperï¼‰ã€‚</p><p>åœ¨wrapperå‡½æ•°å†…éƒ¨ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªå¾ªç¯æ¥å°è¯•è°ƒç”¨åŸå§‹å‡½æ•°ã€‚å¦‚æœåœ¨æ‰§è¡ŒåŸå§‹å‡½æ•°æ—¶æŠ›å‡ºäº†å¼‚å¸¸ï¼Œæˆ‘ä»¬å°†æ•è·è¿™ä¸ªå¼‚å¸¸ï¼Œå¹¶æ‰“å°å‡ºå¼‚å¸¸ä¿¡æ¯ã€‚</p><p>å¦‚æœæ•è·åˆ°å¼‚å¸¸å¹¶ä¸”è¿˜æœ‰å‰©ä½™çš„é‡è¯•æ¬¡æ•°ï¼Œæˆ‘ä»¬å°†æš‚åœä¸€æ®µæ—¶é—´ï¼ˆç”±delayå‚æ•°æŒ‡å®šï¼‰ï¼Œç„¶åå†æ¬¡å°è¯•è°ƒç”¨åŸå§‹å‡½æ•°ã€‚</p><p>å¦‚æœæ‰€æœ‰é‡è¯•éƒ½å¤±è´¥äº†ï¼Œæˆ‘ä»¬å°†é‡æ–°æŠ›å‡ºæœ€åä¸€ä¸ªæ•è·åˆ°çš„å¼‚å¸¸ã€‚</p><p>åœ¨MyTestCaseç±»ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨@retryè£…é¥°å™¨è£…é¥°äº†test_my_apiæ–¹æ³•ï¼Œå¹¶æŒ‡å®šäº†é‡è¯•æ¬¡æ•°å’Œå»¶è¿Ÿæ—¶é—´ã€‚å½“æˆ‘ä»¬è¿è¡Œè¿™ä¸ªæµ‹è¯•ç”¨ä¾‹æ—¶ï¼Œè£…é¥°å™¨ä¼šè‡ªåŠ¨é‡è¯•è¯¥æ–¹æ³•ï¼Œç›´åˆ°æˆåŠŸæˆ–è¾¾åˆ°æœ€å¤§é‡è¯•æ¬¡æ•°ã€‚</p><p>è¯·æ³¨æ„ï¼Œè¿™ä¸ªretryè£…é¥°å™¨åªæ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå®é™…ä½¿ç”¨ä¸­å¯èƒ½éœ€è¦æ ¹æ®å…·ä½“éœ€æ±‚è¿›è¡Œè°ƒæ•´ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½å¸Œæœ›å¯¹ä¸åŒç±»å‹çš„å¼‚å¸¸è¿›è¡Œä¸åŒçš„é‡è¯•ç­–ç•¥ï¼Œæˆ–è€…åœ¨é‡è¯•ä¹‹é—´æ‰§è¡Œä¸€äº›æ¸…ç†æ“ä½œç­‰ã€‚å¦å¤–ï¼Œè™½ç„¶é‡è¯•æœºåˆ¶å¯ä»¥åœ¨æŸäº›æƒ…å†µä¸‹å¸®åŠ©å¤„ç†ä¸´æ—¶æ€§æ•…éšœï¼Œä½†è¿‡åº¦ä¾èµ–é‡è¯•å¯èƒ½ä¼šæ©ç›–ç³»ç»Ÿä¸­çš„æ ¹æœ¬é—®é¢˜ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨é‡è¯•æœºåˆ¶æ—¶åº”è°¨æ…è€ƒè™‘å…¶é€‚ç”¨æ€§å’Œå¯èƒ½çš„å‰¯ä½œç”¨ã€‚</p></li></ul><h2 id="æƒé™å’Œè®¤è¯"><a href="#æƒé™å’Œè®¤è¯" class="headerlink" title="æƒé™å’Œè®¤è¯"></a>æƒé™å’Œè®¤è¯</h2><h3 id="with-authï¼šä¸ºæµ‹è¯•å‡½æ•°æ·»åŠ ç‰¹å®šçš„è®¤è¯ä¿¡æ¯æˆ–æƒé™"><a href="#with-authï¼šä¸ºæµ‹è¯•å‡½æ•°æ·»åŠ ç‰¹å®šçš„è®¤è¯ä¿¡æ¯æˆ–æƒé™" class="headerlink" title="@with_authï¼šä¸ºæµ‹è¯•å‡½æ•°æ·»åŠ ç‰¹å®šçš„è®¤è¯ä¿¡æ¯æˆ–æƒé™"></a>@with_authï¼šä¸ºæµ‹è¯•å‡½æ•°æ·»åŠ ç‰¹å®šçš„è®¤è¯ä¿¡æ¯æˆ–æƒé™</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">import</span> unittest<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">AuthManager</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, username, password</span>):<br>        self.username = username<br>        self.password = password<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">authenticate</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-comment"># è¿™é‡Œæ˜¯å®é™…çš„è®¤è¯é€»è¾‘ï¼Œä¾‹å¦‚å‘é€HTTPè¯·æ±‚è·å–è®¿é—®ä»¤ç‰Œç­‰</span><br>        <span class="hljs-keyword">pass</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">with_auth</span>(<span class="hljs-params">username, password</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">decorator</span>(<span class="hljs-params">func</span>):<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>(<span class="hljs-params">*args, **kwargs</span>):<br>            auth_manager = AuthManager(username, password)<br>            auth_manager.authenticate()<br>            <span class="hljs-keyword">return</span> func(auth_manager, *args, **kwargs)<br>        <span class="hljs-keyword">return</span> wrapper<br>    <span class="hljs-keyword">return</span> decorator<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTestCase</span>(unittest.TestCase):<br><span class="hljs-meta">    @classmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">setUpClass</span>(<span class="hljs-params">cls</span>):<br>        cls.base_url = <span class="hljs-string">&quot;http://example.com/api&quot;</span><br><span class="hljs-meta">    @with_auth(<span class="hljs-params"><span class="hljs-string">&quot;test_user&quot;</span>, <span class="hljs-string">&quot;test_password&quot;</span></span>)</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_my_api</span>(<span class="hljs-params">self, auth_manager</span>):<br>        url = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;self.base_url&#125;</span>/resource&quot;</span><br>        headers = &#123;<span class="hljs-string">&quot;Authorization&quot;</span>: auth_manager.access_token&#125;  <span class="hljs-comment"># å‡è®¾auth_managerå¯¹è±¡æœ‰ä¸€ä¸ªaccess_tokenå±æ€§</span><br>        response = requests.get(url, headers=headers)<br>        self.assertEqual(response.status_code, <span class="hljs-number">200</span>)<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    unittest.main()<br></code></pre></td></tr></table></figure><ul><li><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p><p>æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸ºAuthManagerçš„ç±»ï¼Œå®ƒç”¨äºç®¡ç†è®¤è¯ä¿¡æ¯å’Œæ‰§è¡Œè®¤è¯æ“ä½œã€‚</p><p>æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸ºwith_authçš„è£…é¥°å™¨ï¼Œå®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼šusernameå’Œpasswordã€‚</p><p>with_authè£…é¥°å™¨å†…éƒ¨å®šä¹‰äº†ä¸€ä¸ªæ–°çš„è£…é¥°å™¨å‡½æ•°ï¼ˆå³decoratorï¼‰ï¼Œå®ƒæ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼ˆå³wrapperï¼‰ã€‚</p><p>åœ¨wrapperå‡½æ•°å†…éƒ¨ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªAuthManagerå®ä¾‹ï¼Œå¹¶ä½¿ç”¨æä¾›çš„ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œåˆå§‹åŒ–ã€‚</p><p>æˆ‘ä»¬è°ƒç”¨authenticateæ–¹æ³•å¯¹AuthManagerå®ä¾‹è¿›è¡Œè®¤è¯ã€‚</p><p>æˆ‘ä»¬å°†è®¤è¯åçš„AuthManagerå®ä¾‹ä¼ é€’ç»™åŸå§‹å‡½æ•°ï¼Œå¹¶è¿”å›å…¶ç»“æœã€‚</p><p>åœ¨MyTestCaseç±»ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨@with_authè£…é¥°å™¨è£…é¥°äº†test_my_apiæ–¹æ³•ï¼Œå¹¶æä¾›äº†ç”¨æˆ·åå’Œå¯†ç ã€‚å½“æˆ‘ä»¬è¿è¡Œè¿™ä¸ªæµ‹è¯•ç”¨ä¾‹æ—¶ï¼Œè£…é¥°å™¨ä¼šå…ˆæ‰§è¡Œè®¤è¯æ“ä½œï¼Œç„¶åå°†è®¤è¯åçš„AuthManagerå®ä¾‹ä¼ é€’ç»™test_my_apiæ–¹æ³•ã€‚</p><p>è¯·æ³¨æ„ï¼Œè¿™ä¸ªwith_authè£…é¥°å™¨åªæ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå®é™…ä½¿ç”¨ä¸­å¯èƒ½éœ€è¦æ ¹æ®å…·ä½“éœ€æ±‚è¿›è¡Œè°ƒæ•´ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½éœ€è¦å¤„ç†æ›´å¤æ‚çš„è®¤è¯æµç¨‹ï¼Œæˆ–è€…æ”¯æŒå¤šç§ä¸åŒçš„è®¤è¯æ–¹å¼ç­‰ã€‚å¦å¤–ï¼Œè¿™ä¸ªç¤ºä¾‹ä¸­çš„AuthManagerç±»å’Œauthenticateæ–¹æ³•åªæ˜¯ä¸ºäº†æ¼”ç¤ºç›®çš„è€Œç¼–å†™çš„ï¼Œå®é™…ä½¿ç”¨æ—¶åº”æ›¿æ¢ä¸ºå®é™…çš„è®¤è¯é€»è¾‘å’Œæ•°æ®ã€‚</p></li></ul><h2 id="å‚æ•°åŒ–æµ‹è¯•"><a href="#å‚æ•°åŒ–æµ‹è¯•" class="headerlink" title="å‚æ•°åŒ–æµ‹è¯•"></a>å‚æ•°åŒ–æµ‹è¯•</h2><h3 id="parametrizeï¼ˆä½¿ç”¨pyteståº“ï¼‰ï¼šä¸ºæµ‹è¯•å‡½æ•°æä¾›å¤šä¸ªå‚æ•°ç»„åˆ"><a href="#parametrizeï¼ˆä½¿ç”¨pyteståº“ï¼‰ï¼šä¸ºæµ‹è¯•å‡½æ•°æä¾›å¤šä¸ªå‚æ•°ç»„åˆ" class="headerlink" title="@parametrizeï¼ˆä½¿ç”¨pyteståº“ï¼‰ï¼šä¸ºæµ‹è¯•å‡½æ•°æä¾›å¤šä¸ªå‚æ•°ç»„åˆ"></a>@parametrizeï¼ˆä½¿ç”¨pyteståº“ï¼‰ï¼šä¸ºæµ‹è¯•å‡½æ•°æä¾›å¤šä¸ªå‚æ•°ç»„åˆ</h3><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªä½¿ç”¨@pytest.mark.parametrizeè£…é¥°å™¨ï¼ˆæ¥è‡ªpyteståº“ï¼‰ä¸ºæµ‹è¯•å‡½æ•°æä¾›å¤šä¸ªå‚æ•°ç»„åˆçš„ç®€å•ç¤ºä¾‹ï¼š</p><p>é¦–å…ˆï¼Œç¡®ä¿å·²ç»å®‰è£…äº†pyteståº“ï¼špip install pytest</p><p>ç„¶åï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pytest<br><span class="hljs-keyword">import</span> requests<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTestCase</span>:<br><span class="hljs-meta">    @classmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">setUpClass</span>(<span class="hljs-params">cls</span>):<br>        cls.base_url = <span class="hljs-string">&quot;http://example.com/api&quot;</span><br><span class="hljs-meta">    @pytest.mark.parametrize(<span class="hljs-params"><span class="hljs-string">&quot;username, password, expected_status_code&quot;</span>, [</span></span><br><span class="hljs-params"><span class="hljs-meta">        (<span class="hljs-params"><span class="hljs-string">&quot;Alice&quot;</span>, <span class="hljs-string">&quot;password123&quot;</span>, <span class="hljs-number">200</span></span>),</span></span><br><span class="hljs-params"><span class="hljs-meta">        (<span class="hljs-params"><span class="hljs-string">&quot;Bob&quot;</span>, <span class="hljs-string">&quot;invalid_password&quot;</span>, <span class="hljs-number">401</span></span>),</span></span><br><span class="hljs-params"><span class="hljs-meta">        (<span class="hljs-params"><span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-number">400</span></span>),</span></span><br><span class="hljs-params"><span class="hljs-meta">        (<span class="hljs-params"><span class="hljs-literal">None</span>, <span class="hljs-literal">None</span>, <span class="hljs-number">400</span></span>),</span></span><br><span class="hljs-params"><span class="hljs-meta">    ]</span>)</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_login</span>(<span class="hljs-params">self, username, password, expected_status_code</span>):<br>        url = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;self.base_url&#125;</span>/login&quot;</span><br>        payload = &#123;<span class="hljs-string">&quot;username&quot;</span>: username, <span class="hljs-string">&quot;password&quot;</span>: password&#125;<br>        response = requests.post(url, json=payload)<br>        <span class="hljs-keyword">assert</span> response.status_code == expected_status_code<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    pytest.main()<br>    <br></code></pre></td></tr></table></figure><ul><li><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p><p>æˆ‘ä»¬ä½¿ç”¨@pytest.mark.parametrizeè£…é¥°å™¨è£…é¥°äº†test_loginæ–¹æ³•ã€‚è¯¥è£…é¥°å™¨æ¥å—ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ªå‚æ•°ååˆ—è¡¨å’Œä¸€ä¸ªå‚æ•°å€¼åˆ—è¡¨ã€‚</p><p>å‚æ•°ååˆ—è¡¨åŒ…å«äº†è¢«è£…é¥°çš„æµ‹è¯•å‡½æ•°æœŸæœ›æ¥æ”¶çš„å‚æ•°åç§°ã€‚</p><p>å‚æ•°å€¼åˆ—è¡¨æ˜¯ä¸€ä¸ªåŒ…å«å¤šä¸ªå…ƒç»„çš„åˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç»„ä»£è¡¨ä¸€ç»„ç‰¹å®šçš„å‚æ•°å€¼ç»„åˆã€‚</p><p>å½“æˆ‘ä»¬è¿è¡Œè¿™ä¸ªæµ‹è¯•ç”¨ä¾‹æ—¶ï¼Œpytestä¼šä¸ºtest_loginæ–¹æ³•ç”Ÿæˆå¤šä¸ªå®ä¾‹ï¼Œæ¯ä¸ªå®ä¾‹ä½¿ç”¨ä¸€ç»„ä¸åŒçš„å‚æ•°å€¼ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸€ç§ç®€æ´çš„æ–¹å¼ä¸ºåŒä¸€ä¸ªæµ‹è¯•å‡½æ•°æä¾›å¤šä¸ªä¸åŒçš„è¾“å…¥å’Œé¢„æœŸè¾“å‡ºã€‚</p><p>è¯·æ³¨æ„ï¼Œè™½ç„¶è¿™ä¸ªä¾‹å­ä¸­æˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨unittest.TestCaseç±»ï¼Œä½†ä½ å¯ä»¥å°†è¿™ä¸ªæµ‹è¯•ç”¨ä¾‹ä¸unittest.TestCaseç»“åˆä½¿ç”¨ï¼Œåªéœ€è¦åœ¨æµ‹è¯•ç±»ä¸­ç»§æ‰¿unittest.TestCaseï¼Œå¹¶ä½¿ç”¨unittestçš„æ–­è¨€æ–¹æ³•å³å¯ã€‚å¦å¤–ï¼Œpytestæä¾›äº†è®¸å¤šå…¶ä»–åŠŸèƒ½å’Œè£…é¥°å™¨ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œæ¢ç´¢å’Œä½¿ç”¨ã€‚</p></li></ul><h2 id="æ¡ä»¶æ‰§è¡Œ"><a href="#æ¡ä»¶æ‰§è¡Œ" class="headerlink" title="æ¡ä»¶æ‰§è¡Œ"></a>æ¡ä»¶æ‰§è¡Œ</h2><h3 id="skip-ifï¼šåœ¨æ»¡è¶³ç‰¹å®šæ¡ä»¶æ—¶è·³è¿‡æµ‹è¯•"><a href="#skip-ifï¼šåœ¨æ»¡è¶³ç‰¹å®šæ¡ä»¶æ—¶è·³è¿‡æµ‹è¯•" class="headerlink" title="@skip_ifï¼šåœ¨æ»¡è¶³ç‰¹å®šæ¡ä»¶æ—¶è·³è¿‡æµ‹è¯•"></a>@skip_ifï¼šåœ¨æ»¡è¶³ç‰¹å®šæ¡ä»¶æ—¶è·³è¿‡æµ‹è¯•</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">import</span> unittest<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">skip_if</span>(<span class="hljs-params">condition</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">decorator</span>(<span class="hljs-params">func</span>):<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>(<span class="hljs-params">*args, **kwargs</span>):<br>            <span class="hljs-keyword">if</span> condition:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Test skipped because condition is satisfied: <span class="hljs-subst">&#123;condition&#125;</span>&quot;</span>)<br>                <span class="hljs-keyword">return</span><br>            <span class="hljs-keyword">return</span> func(*args, **kwargs)<br>        <span class="hljs-keyword">return</span> wrapper<br>    <span class="hljs-keyword">return</span> decorator<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTestCase</span>(unittest.TestCase):<br><span class="hljs-meta">    @classmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">setUpClass</span>(<span class="hljs-params">cls</span>):<br>        cls.base_url = <span class="hljs-string">&quot;http://example.com/api&quot;</span><br><span class="hljs-meta">    @skip_if(<span class="hljs-params">os.environ.get(<span class="hljs-params"><span class="hljs-string">&quot;SKIP_FLAKY_TESTS&quot;</span>, <span class="hljs-literal">False</span></span>)</span>)</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_flaky_api</span>(<span class="hljs-params">self</span>):<br>        url = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;self.base_url&#125;</span>/flaky-resource&quot;</span><br>        response = requests.get(url)<br>        self.assertEqual(response.status_code, <span class="hljs-number">200</span>)<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    unittest.main()<br></code></pre></td></tr></table></figure><ul><li><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p><p>æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸ºskip_ifçš„è£…é¥°å™¨ï¼Œå®ƒæ¥å—ä¸€ä¸ªå‚æ•°ï¼šä¸€ä¸ªè¡¨ç¤ºæ¡ä»¶çš„è¡¨è¾¾å¼ã€‚</p><p>skip_ifè£…é¥°å™¨å†…éƒ¨å®šä¹‰äº†ä¸€ä¸ªæ–°çš„è£…é¥°å™¨å‡½æ•°ï¼ˆå³decoratorï¼‰ï¼Œå®ƒæ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼ˆå³wrapperï¼‰ã€‚</p><p>åœ¨wrapperå‡½æ•°å†…éƒ¨ï¼Œæˆ‘ä»¬æ£€æŸ¥æä¾›çš„æ¡ä»¶æ˜¯å¦ä¸ºçœŸã€‚å¦‚æœæ¡ä»¶ä¸ºçœŸï¼Œæˆ‘ä»¬å°†æ‰“å°ä¸€æ¡æ¶ˆæ¯å¹¶ç›´æ¥è¿”å›ï¼Œä»è€Œè·³è¿‡æµ‹è¯•ã€‚å¦åˆ™ï¼Œæˆ‘ä»¬å°†è°ƒç”¨åŸå§‹å‡½æ•°å¹¶è¿”å›å…¶ç»“æœã€‚</p><p>åœ¨MyTestCaseç±»ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨@skip_ifè£…é¥°å™¨è£…é¥°äº†test_flaky_apiæ–¹æ³•ï¼Œå¹¶æä¾›äº†ä¸€ä¸ªæ¡ä»¶è¡¨è¾¾å¼ã€‚è¿™ä¸ªæ¡ä»¶è¡¨è¾¾å¼æ£€æŸ¥ç¯å¢ƒå˜é‡â€SKIP_FLAKY_TESTSâ€æ˜¯å¦å­˜åœ¨ä¸”å€¼ä¸ºTrueã€‚å¦‚æœæˆ‘ä»¬è®¾ç½®äº†è¿™ä¸ªç¯å¢ƒå˜é‡ï¼Œé‚£ä¹ˆè¿™ä¸ªæµ‹è¯•å°†è¢«è·³è¿‡ã€‚</p><p>è¯·æ³¨æ„ï¼Œè¿™ä¸ªskip_ifè£…é¥°å™¨åªæ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå®é™…ä½¿ç”¨ä¸­å¯èƒ½éœ€è¦æ ¹æ®å…·ä½“éœ€æ±‚è¿›è¡Œè°ƒæ•´ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½å¸Œæœ›å¯¹ä¸åŒç±»å‹çš„æ¡ä»¶ä½¿ç”¨ä¸åŒçš„è£…é¥°å™¨ï¼Œæˆ–è€…åœ¨è·³è¿‡æµ‹è¯•æ—¶æ‰§è¡Œä¸€äº›æ¸…ç†æ“ä½œç­‰ã€‚å¦å¤–ï¼Œè™½ç„¶è·³è¿‡æµ‹è¯•å¯ä»¥åœ¨æŸäº›æƒ…å†µä¸‹é¿å…ä¸å¿…è¦çš„å¤±è´¥å’Œå¤æ‚æ€§ï¼Œä½†è¿‡åº¦ä¾èµ–è·³è¿‡æœºåˆ¶å¯èƒ½ä¼šæ©ç›–ç³»ç»Ÿä¸­çš„é—®é¢˜ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨è·³è¿‡æœºåˆ¶æ—¶åº”è°¨æ…è€ƒè™‘å…¶é€‚ç”¨æ€§å’Œå¯èƒ½çš„å‰¯ä½œç”¨ã€‚</p></li></ul><h3 id="run-only-ifï¼šåœ¨æ»¡è¶³ç‰¹å®šæ¡ä»¶æ—¶æ‰§è¡Œæµ‹è¯•"><a href="#run-only-ifï¼šåœ¨æ»¡è¶³ç‰¹å®šæ¡ä»¶æ—¶æ‰§è¡Œæµ‹è¯•" class="headerlink" title="@run_only_ifï¼šåœ¨æ»¡è¶³ç‰¹å®šæ¡ä»¶æ—¶æ‰§è¡Œæµ‹è¯•"></a>@run_only_ifï¼šåœ¨æ»¡è¶³ç‰¹å®šæ¡ä»¶æ—¶æ‰§è¡Œæµ‹è¯•</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">import</span> unittest<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">run_only_if</span>(<span class="hljs-params">condition</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">decorator</span>(<span class="hljs-params">func</span>):<br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>(<span class="hljs-params">*args, **kwargs</span>):<br>            <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> condition:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Test skipped because condition is not satisfied: <span class="hljs-subst">&#123;condition&#125;</span>&quot;</span>)<br>                <span class="hljs-keyword">return</span><br>            <span class="hljs-keyword">return</span> func(*args, **kwargs)<br>        <span class="hljs-keyword">return</span> wrapper<br>    <span class="hljs-keyword">return</span> decorator<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTestCase</span>(unittest.TestCase):<br><span class="hljs-meta">    @classmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">setUpClass</span>(<span class="hljs-params">cls</span>):<br>        cls.base_url = <span class="hljs-string">&quot;http://example.com/api&quot;</span><br><span class="hljs-meta">    @run_only_if(<span class="hljs-params">os.environ.get(<span class="hljs-params"><span class="hljs-string">&quot;RUN_SPECIFIC_TESTS&quot;</span>, <span class="hljs-literal">False</span></span>)</span>)</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_specific_api</span>(<span class="hljs-params">self</span>):<br>        url = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;self.base_url&#125;</span>/specific-resource&quot;</span><br>        response = requests.get(url)<br>        self.assertEqual(response.status_code, <span class="hljs-number">200</span>)<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    unittest.main()<br></code></pre></td></tr></table></figure><ul><li><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p><p>æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸ºrun_only_ifçš„è£…é¥°å™¨ï¼Œå®ƒæ¥å—ä¸€ä¸ªå‚æ•°ï¼šä¸€ä¸ªè¡¨ç¤ºæ¡ä»¶çš„è¡¨è¾¾å¼ã€‚</p><p>run_only_ifè£…é¥°å™¨å†…éƒ¨å®šä¹‰äº†ä¸€ä¸ªæ–°çš„è£…é¥°å™¨å‡½æ•°ï¼ˆå³decoratorï¼‰ï¼Œå®ƒæ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼ˆå³wrapperï¼‰ã€‚</p><p>åœ¨wrapperå‡½æ•°å†…éƒ¨ï¼Œæˆ‘ä»¬æ£€æŸ¥æä¾›çš„æ¡ä»¶æ˜¯å¦ä¸ºçœŸã€‚å¦‚æœæ¡ä»¶ä¸ºå‡ï¼Œæˆ‘ä»¬å°†æ‰“å°ä¸€æ¡æ¶ˆæ¯å¹¶ç›´æ¥è¿”å›ï¼Œä»è€Œè·³è¿‡æµ‹è¯•ã€‚å¦åˆ™ï¼Œæˆ‘ä»¬å°†è°ƒç”¨åŸå§‹å‡½æ•°å¹¶è¿”å›å…¶ç»“æœã€‚</p><p>åœ¨MyTestCaseç±»ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨@run_only_ifè£…é¥°å™¨è£…é¥°äº†test_specific_apiæ–¹æ³•ï¼Œå¹¶æä¾›äº†ä¸€ä¸ªæ¡ä»¶è¡¨è¾¾å¼ã€‚è¿™ä¸ªæ¡ä»¶è¡¨è¾¾å¼æ£€æŸ¥ç¯å¢ƒå˜é‡â€RUN_SPECIFIC_TESTSâ€æ˜¯å¦å­˜åœ¨ä¸”å€¼ä¸ºTrueã€‚å¦‚æœæˆ‘ä»¬è®¾ç½®äº†è¿™ä¸ªç¯å¢ƒå˜é‡ï¼Œé‚£ä¹ˆè¿™ä¸ªæµ‹è¯•å°†è¢«æ‰§è¡Œã€‚</p><p>è¯·æ³¨æ„ï¼Œè¿™ä¸ªrun_only_ifè£…é¥°å™¨åªæ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå®é™…ä½¿ç”¨ä¸­å¯èƒ½éœ€è¦æ ¹æ®å…·ä½“éœ€æ±‚è¿›è¡Œè°ƒæ•´ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½å¸Œæœ›å¯¹ä¸åŒç±»å‹çš„æ¡ä»¶ä½¿ç”¨ä¸åŒçš„è£…é¥°å™¨ï¼Œæˆ–è€…åœ¨æ‰§è¡Œæµ‹è¯•å‰æ‰§è¡Œä¸€äº›åˆå§‹åŒ–æ“ä½œç­‰ã€‚å¦å¤–ï¼Œè™½ç„¶é€‰æ‹©æ€§åœ°æ‰§è¡Œæµ‹è¯•å¯ä»¥åœ¨æŸäº›æƒ…å†µä¸‹æé«˜æµ‹è¯•æ•ˆç‡å’Œé’ˆå¯¹æ€§ï¼Œä½†è¿‡åº¦ä¾èµ–è¿™ç§æœºåˆ¶å¯èƒ½ä¼šå¯¼è‡´éƒ¨åˆ†æµ‹è¯•è¢«å¿½è§†æˆ–é—æ¼ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨run_only_ifè£…é¥°å™¨æ—¶åº”è°¨æ…è€ƒè™‘å…¶é€‚ç”¨æ€§å’Œå¯èƒ½çš„å‰¯ä½œç”¨ã€‚</p></li></ul><h2 id="æŠ¥å‘Šå’Œç»Ÿè®¡"><a href="#æŠ¥å‘Šå’Œç»Ÿè®¡" class="headerlink" title="æŠ¥å‘Šå’Œç»Ÿè®¡"></a><strong>æŠ¥å‘Šå’Œç»Ÿè®¡</strong></h2><h3 id="report-resultï¼šè‡ªå®šä¹‰æµ‹è¯•ç»“æœçš„æŠ¥å‘Šæ ¼å¼æˆ–ç»Ÿè®¡æ•°æ®"><a href="#report-resultï¼šè‡ªå®šä¹‰æµ‹è¯•ç»“æœçš„æŠ¥å‘Šæ ¼å¼æˆ–ç»Ÿè®¡æ•°æ®" class="headerlink" title="@report_resultï¼šè‡ªå®šä¹‰æµ‹è¯•ç»“æœçš„æŠ¥å‘Šæ ¼å¼æˆ–ç»Ÿè®¡æ•°æ®"></a>@report_resultï¼šè‡ªå®šä¹‰æµ‹è¯•ç»“æœçš„æŠ¥å‘Šæ ¼å¼æˆ–ç»Ÿè®¡æ•°æ®</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">import</span> unittest<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CustomTestResult</span>(unittest.TestResult):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>().__init__()<br>        self.success_count = <span class="hljs-number">0</span><br>        self.failure_count = <span class="hljs-number">0</span><br>        self.error_count = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">addSuccess</span>(<span class="hljs-params">self, test</span>):<br>        <span class="hljs-built_in">super</span>().addSuccess(test)<br>        self.success_count += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">addFailure</span>(<span class="hljs-params">self, test, err</span>):<br>        <span class="hljs-built_in">super</span>().addFailure(test, err)<br>        self.failure_count += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">addError</span>(<span class="hljs-params">self, test, err</span>):<br>        <span class="hljs-built_in">super</span>().addError(test, err)<br>        self.error_count += <span class="hljs-number">1</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">report_result</span>(<span class="hljs-params">func</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">wrapper</span>(<span class="hljs-params">*args, **kwargs</span>):<br>        result = CustomTestResult()<br>        test_method = <span class="hljs-built_in">getattr</span>(args[<span class="hljs-number">0</span>], func.__name__)<br>        test_method(result)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Test results: <span class="hljs-subst">&#123;result.success_count&#125;</span> successes, <span class="hljs-subst">&#123;result.failure_count&#125;</span> failures, <span class="hljs-subst">&#123;result.error_count&#125;</span> errors&quot;</span>)<br>        <span class="hljs-keyword">return</span> result<br>    <span class="hljs-keyword">return</span> wrapper<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyTestCase</span>(unittest.TestCase):<br><span class="hljs-meta">    @classmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">setUpClass</span>(<span class="hljs-params">cls</span>):<br>        cls.base_url = <span class="hljs-string">&quot;http://example.com/api&quot;</span><br><span class="hljs-meta">    @report_result</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_my_api</span>(<span class="hljs-params">self, result</span>):<br>        url = <span class="hljs-string">f&quot;<span class="hljs-subst">&#123;self.base_url&#125;</span>/resource&quot;</span><br>        response = requests.get(url)<br>        self.assertEqual(response.status_code, <span class="hljs-number">200</span>)<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    suite = unittest.TestLoader().loadTestsFromTestCase(MyTestCase)<br>    runner = unittest.TextTestRunner()<br>    runner.run(suite)<br></code></pre></td></tr></table></figure><ul><li><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼š</p><p>æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸ºCustomTestResultçš„ç±»ï¼Œå®ƒç»§æ‰¿è‡ªunittest.TestResultå¹¶æ·»åŠ äº†è‡ªå®šä¹‰çš„è®¡æ•°å™¨å±æ€§ã€‚</p><p>æˆ‘ä»¬é‡å†™äº†addSuccessã€addFailureå’ŒaddErroræ–¹æ³•ï¼Œä»¥ä¾¿åœ¨æµ‹è¯•æˆåŠŸã€å¤±è´¥æˆ–å‡ºç°é”™è¯¯æ—¶æ›´æ–°è‡ªå®šä¹‰è®¡æ•°å™¨ã€‚</p><p>æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªåä¸ºreport_resultçš„è£…é¥°å™¨ï¼Œå®ƒæ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–°çš„å‡½æ•°ï¼ˆå³wrapperï¼‰ã€‚</p><p>åœ¨wrapperå‡½æ•°å†…éƒ¨ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªCustomTestResultå®ä¾‹ï¼Œå¹¶è·å–è¢«è£…é¥°çš„æµ‹è¯•æ–¹æ³•ã€‚</p><p>æˆ‘ä»¬è°ƒç”¨æµ‹è¯•æ–¹æ³•å¹¶å°†CustomTestResultå®ä¾‹ä¼ é€’ç»™å®ƒï¼Œä»¥ä¾¿æ”¶é›†æµ‹è¯•ç»“æœã€‚</p><p>æˆ‘ä»¬æ‰“å°å‡ºè‡ªå®šä¹‰çš„æµ‹è¯•ç»“æœæŠ¥å‘Šï¼ŒåŒ…æ‹¬æˆåŠŸã€å¤±è´¥å’Œé”™è¯¯çš„æ•°é‡ã€‚</p><p>åœ¨MyTestCaseç±»ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨@report_resultè£…é¥°å™¨è£…é¥°äº†test_my_apiæ–¹æ³•ã€‚å½“æˆ‘ä»¬è¿è¡Œè¿™ä¸ªæµ‹è¯•ç”¨ä¾‹æ—¶ï¼Œè£…é¥°å™¨ä¼šæ”¶é›†æµ‹è¯•ç»“æœå¹¶æ‰“å°å‡ºè‡ªå®šä¹‰çš„æŠ¥å‘Šã€‚</p><p>è¯·æ³¨æ„ï¼Œè¿™ä¸ªreport_resultè£…é¥°å™¨åªæ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œå®é™…ä½¿ç”¨ä¸­å¯èƒ½éœ€è¦æ ¹æ®å…·ä½“éœ€æ±‚è¿›è¡Œè°ƒæ•´ã€‚ä¾‹å¦‚ï¼Œä½ å¯èƒ½å¸Œæœ›ç”Ÿæˆæ›´å¤æ‚çš„æŠ¥å‘Šæ ¼å¼ï¼Œæˆ–è€…å°†æŠ¥å‘Šä¿å­˜åˆ°æ–‡ä»¶æˆ–æ•°æ®åº“ç­‰ã€‚å¦å¤–ï¼Œè™½ç„¶è¿™ä¸ªä¾‹å­ä¸­æˆ‘ä»¬æ²¡æœ‰ç›´æ¥ä½¿ç”¨unittest.TextTestRunneræ¥è¿è¡Œæµ‹è¯•ï¼Œä½†åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œä½ å¯ä»¥å°†è‡ªå®šä¹‰çš„CustomTestResultç±»ä¸unittest.TextTestRunnerç»“åˆä½¿ç”¨ï¼Œä»¥å®ç°æ›´çµæ´»çš„æµ‹è¯•æŠ¥å‘ŠåŠŸèƒ½ã€‚</p><p><img src="/img/neom-kirkdJn(2).jpg" alt="unsplash"></p></li></ul>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€pythonã€‘FastAPIä¹‹å¼‚æ­¥async-awaitï¼ˆå…«ï¼‰</title>
    <link href="/2024/03/04/688FastAPI8%E4%B9%8B%E5%BC%82%E6%AD%A5async-await/"/>
    <url>/2024/03/04/688FastAPI8%E4%B9%8B%E5%BC%82%E6%AD%A5async-await/</url>
    
    <content type="html"><![CDATA[<h1 id="12-1-fastapiæ˜¯å¼‚æ­¥Webæ¡†æ¶ã€é‡ç‚¹ã€‘"><a href="#12-1-fastapiæ˜¯å¼‚æ­¥Webæ¡†æ¶ã€é‡ç‚¹ã€‘" class="headerlink" title="12-1 fastapiæ˜¯å¼‚æ­¥Webæ¡†æ¶ã€é‡ç‚¹ã€‘"></a>12-1 fastapiæ˜¯å¼‚æ­¥Webæ¡†æ¶ã€é‡ç‚¹ã€‘</h1><p>FastAPIè¿™ä¸ªwebæ¡†æ¶æ˜¯å¼‚æ­¥æ¡†æ¶ï¼Œé‚£å®ƒåˆ°åº•æ˜¯å¦‚ä½•ä½“ç°å¼‚æ­¥çš„å‘¢ï¼Ÿ</p><p>æœ¬è´¨ä¸Šï¼Œ<strong>å®ç°å¼‚æ­¥çš„æ–¹å¼æœ‰ä¸‰ç§ï¼šå¤šè¿›ç¨‹ã€å¤šçº¿ç¨‹å’Œåç¨‹ï¼ŒFastAPIå®ç°å¼‚æ­¥ä½¿ç”¨äº†å¤šçº¿ç¨‹(çº¿ç¨‹æ± )å’Œåç¨‹çš„æ–¹å¼</strong>ã€‚</p><ul><li>å½“æˆ‘ä»¬å†™æ™®é€šå½¢å¼çš„ä»£ç æ—¶ï¼šå³ä½¿ç”¨ <code>def</code> å®šä¹‰è·¯å¾„å‡½æ•°ï¼ŒFastAPIå†…éƒ¨å¸®æˆ‘ä»¬ä½¿ç”¨å¤šçº¿ç¨‹ï¼ˆçº¿ç¨‹æ± ï¼‰å®ç°å¼‚æ­¥å¹¶å‘</li><li>å½“æˆ‘ä»¬å†™asyncå½¢å¼çš„ä»£ç æ—¶ï¼šå³ä½¿ç”¨ <code>async def</code>å®šä¹‰è·¯å¾„å‡½æ•°ï¼ŒFastAPIå†…éƒ¨ä½¿ç”¨åç¨‹çš„æ–¹å¼å®ç°å¼‚æ­¥å¹¶å‘ã€‚</li><li>åœ¨ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åŒæ—¶æ™®é€šå‡½æ•°å®šä¹‰çš„è·¯å¾„å‡½æ•°ï¼ˆapiï¼‰ï¼Œå’Œasync def å½¢å¼å®šä¹‰çš„è·¯å¾„å‡½æ•°ï¼ˆapiï¼‰</li><li>ä½†æ˜¯è¦è®°å¾—ï¼Œåœ¨async def å½¢å¼å®šä¹‰çš„å‡½æ•°å†…ï¼Œä¸èƒ½ä½¿ç”¨åŒæ­¥çš„ä»£ç ï¼Œå¦åˆ™æ¥å£çš„å“åº”é€Ÿåº¦ææ…¢ã€‚</li></ul><h1 id="12-2-æ¯”è¾ƒåŒæ­¥å’Œå¼‚æ­¥ä»£ç ã€é‡ç‚¹ã€‘"><a href="#12-2-æ¯”è¾ƒåŒæ­¥å’Œå¼‚æ­¥ä»£ç ã€é‡ç‚¹ã€‘" class="headerlink" title="12-2 æ¯”è¾ƒåŒæ­¥å’Œå¼‚æ­¥ä»£ç ã€é‡ç‚¹ã€‘"></a>12-2 æ¯”è¾ƒåŒæ­¥å’Œå¼‚æ­¥ä»£ç ã€é‡ç‚¹ã€‘</h1><p>åœ¨FastAPIä¸­å¯ä»¥ä½¿ç”¨æ™®é€šå‡½æ•°å®šä¹‰çš„æ¥å£ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨async def å®è¡Œå®šä¹‰çš„æ¥å£ã€‚ä½†æ˜¯ä½¿ç”¨æ˜¯éœ€è¦æ³¨æ„ï¼Œå¦åˆ™ä¼šå¯¼è‡´ç¨‹åºææ…¢ã€‚</p><p>ç¤ºä¾‹1ï¼šæ™®é€šå‡½æ•°å½¢å¼å®šä¹‰çš„æ¥å£ï¼Œä¼šæŒ‰ç…§å¤šçº¿ç¨‹ï¼ˆçº¿ç¨‹æ± ï¼‰çš„æ–¹å¼å¼‚æ­¥æ‰§è¡Œ</p><ul><li>æ¯”å¦‚è¿™ä¸ªæ¥å£ï¼Œä½¿ç”¨<code>time.sleep(5)</code>æ¨¡æ‹Ÿè€—æ—¶5s</li><li>å½“ä¸¤ä¸ªå®¢æˆ·ç«¯åŒæ—¶è®¿é—®è¯¥æ¥å£æ—¶ï¼ŒæœåŠ¡ç«¯å°±ä¼šæ”¶åˆ°ä¸¤ä¸ªè¯·æ±‚ï¼Œå› ä¸ºFastAPIå†…éƒ¨ä½¿ç”¨å¤šçº¿ç¨‹çš„æ–¹å¼æ¥å¤„ç†ï¼Œä¸€ä¸ªè¯·æ±‚ä¼šè¢«ä¸€ä¸ªçº¿ç¨‹æ¥å¤„ç†ï¼Œä¸¤ä¸ªçº¿ç¨‹å‡ ä¹åŒæ—¶æ‰§è¡Œã€‚äºæ˜¯5ç§’åï¼Œä¸¤ä¸ªè¯·æ±‚éƒ½å¾—åˆ°äº†å“åº”ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><br>app = FastAPI()<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    time.sleep(<span class="hljs-number">5</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;index&quot;</span><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹2ï¼šasync def å½¢å¼çš„å®šä¹‰çš„æ¥å£ï¼Œä½¿ç”¨å•çº¿ç¨‹åç¨‹çš„å½¢å¼å¼‚æ­¥æ‰§è¡Œ</p><ul><li><p>å› ä¸ºä½¿ç”¨äº†åç¨‹çš„æ–¹å¼ï¼Œå½“æœ‰ä¸¤ä¸ªå®¢æˆ·ç«¯å‘è¯·æ±‚æ—¶ï¼Œå•çº¿ç¨‹å†…ä»£ç å—çº§åˆ«çš„åˆ‡æ¢ï¼Œæœ€ç»ˆ5ç§’åä¸¤ä¸ªå®¢æˆ·ç«¯éƒ½ä¼šå¾—åˆ°å“åº”ã€‚</p></li><li><p>æ³¨æ„ï¼šåç¨‹æ—¶ä¸èƒ½ä½¿ç”¨åŒæ­¥é˜»å¡çš„timeæ¨¡å—ï¼Œ**éœ€è¦ä½¿ç”¨<code>asyncio.sleep()</code>*<em>ã€‚åˆå› ä¸ºå®ƒæ˜¯åç¨‹å¯¹è±¡ï¼Œæ‰€ä»¥éœ€è¦ä½¿ç”¨<code>await</code>æ‰èƒ½è¢«æ‰§è¡Œã€‚æ³¨æ„ï¼šä¸å¯ä»¥</em>time.sleep()*</p></li><li><p>å¦å¤–ï¼Œ<code>await</code>å¿…é¡»ä½¿ç”¨åœ¨<code>async</code>å®šä¹‰çš„å‡½æ•°å†…ï¼Œå¦åˆ™æŠ¥é”™ã€‚</p></li><li><p>åŒæ—¶æ³¨æ„ï¼Œåœ¨async def å†…éƒ¨ä¸èƒ½ä½¿ç”¨åŒæ­¥æ¨¡å—ï¼Œå¦åˆ™å°±ä¼šå˜æˆå•çº¿ç¨‹åŒæ­¥æ‰§è¡Œçš„æ–¹å¼ã€‚</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><br>app = FastAPI()<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">await</span> asyncio.sleep(<span class="hljs-number">5</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;index&quot;</span><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹3ï¼šåœ¨<strong>åç¨‹å‡½æ•°å†…é”™è¯¯ä½¿ç”¨åŒæ­¥æ¨¡å—</strong></p><ul><li>å› ä¸ºä½¿ç”¨<code>async def</code>å®šä¹‰çš„å‡½æ•°ï¼Œæ‰€ä»¥FadtAPIå†…éƒ¨ä½¿ç”¨å•çº¿ç¨‹çš„åç¨‹æ–¹å¼è¿è¡Œä»£ç ï¼Œæ‰€ä»¥å½“ä¸¤ä¸ªå®¢æˆ·ç«¯å‘è¯·æ±‚æ—¶ï¼ŒæœåŠ¡ç«¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¤„ç†ä¸¤ä¸ªè¯·æ±‚ã€‚</li><li>ä½†å› ä¸ºæ˜¯åŒæ­¥é˜»å¡5ç§’ï¼Œæ‰€ä»¥åªèƒ½ç­‰ç¬¬ä¸€ä¸ªè¯·æ±‚5ç§’åå¤„ç†å®Œï¼Œæ‰èƒ½å¼€å§‹æ‰§è¡Œç¬¬äºŒä¸ªè¯·æ±‚ã€‚æ‰€ä»¥ç¬¬äºŒä¸ªè¯·æ±‚ç­‰å¾…äº†10ç§’æ‰èƒ½å¾—åˆ°å“åº”ã€‚(åŒç†ï¼Œå¤šä¸ªå®¢æˆ·ç«¯å‘è¯·æ±‚å°±æ˜¯å¤šä¸ª5ç§’ç­‰å¾…)</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><br>app = FastAPI()<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    time.sleep(<span class="hljs-number">5</span>)<span class="hljs-comment"># ä¸èƒ½åœ¨async def å‡½æ•°å†…ä½¿ç”¨åŒæ­¥é˜»å¡æ¨¡å—ã€‚</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;index&quot;</span><br></code></pre></td></tr></table></figure><p>ã€æ³¨æ„ã€‘</p><ul><li>æ¼”ç¤ºä¸Šè¿°ä»£ç æ—¶ï¼Œä¸è¦åœ¨ä¸€ä¸ªæµè§ˆå™¨ä¸Šå¼€ä¸¤ä¸ªtabé¡µï¼Œå¯èƒ½æ— æ³•æ¼”ç¤ºå‡ºæ•ˆæœã€‚è¿™æ˜¯å› ä¸ºæœ‰äº›æµè§ˆå™¨æœ‰è®¾ç½®ï¼Œä¸€ä¸ªhostä¹‹åä¸€ä¸ªè¿æ¥ï¼Œæ‰€ä»¥æ‰“å¼€çš„ä¸¤ä¸ªtabä¹Ÿé€šç”¨ä¸€ä¸ªå’ŒæœåŠ¡ç«¯é€šä¿¡çš„è¿æ¥ï¼Œæ­¤æ—¶çš„æ•ˆæœå°±æ˜¯ç¬¬ä¸€ä¸ªè¯·æ±‚å¾—åˆ°å“åº”åæ‰å¼€å§‹ç¬¬äºŒä¸ªå“åº”ã€‚</li><li>ä½ å¯ä»¥ä½¿ç”¨ä¸¤ä¸ªä¸åŒçš„æµè§ˆå™¨æ¼”ç¤ºç¤ºä¾‹ï¼›æˆ–è€…å¼€ä¸¤ä¸ªcmdçª—å£ï¼Œä½¿ç”¨ curlå‘½ä»¤æ¥å‘è¯·æ±‚ã€‚</li></ul><p><img src="/img/fastapi/image-20220731111456693.png" alt="image-20220731111456693"></p><h1 id="12-3-åŒæ­¥å¼‚æ­¥å¦‚ä½•é€‰æ‹©ã€é‡ç‚¹ã€‘"><a href="#12-3-åŒæ­¥å¼‚æ­¥å¦‚ä½•é€‰æ‹©ã€é‡ç‚¹ã€‘" class="headerlink" title="12-3 åŒæ­¥å¼‚æ­¥å¦‚ä½•é€‰æ‹©ã€é‡ç‚¹ã€‘"></a>12-3 åŒæ­¥å¼‚æ­¥å¦‚ä½•é€‰æ‹©ã€é‡ç‚¹ã€‘</h1><p>FastAPIéå¸¸çµæ´»ï¼Œæ”¯æŒä½ å†™æ™®é€šçš„å‡½æ•°ï¼Œä¹Ÿæ”¯æŒä½ å†™async def å½¢å¼çš„å‡½æ•°ï¼Œé‚£åˆ°åº•è¯¥å¦‚ä½•é€‰æ‹©ï¼Ÿ</p><p>ä¸‹é¢æœ‰å‡ ä¸ªåŸåˆ™ï¼Œå¯ä»¥å¸®åŠ©å¤§å®¶åšé€‰æ‹©ï¼š</p><ul><li>ä½ éœ€è¦ä½¿ç”¨ä¸€ä¸ªæ™®é€šçš„ï¼Œå†…éƒ¨æœ‰<strong>IOç­‰å¾…</strong>çš„<strong>ç¬¬ä¸‰æ–¹åº“</strong>ï¼Œæ­¤æ—¶ä½¿ç”¨ <code>def</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">results</span>():<br>    results = some_library()<br>    <span class="hljs-keyword">return</span> results<br></code></pre></td></tr></table></figure><ul><li>ä½ éœ€è¦ä½¿ç”¨çš„ä¸€ä¸ª<strong>ç¬¬ä¸‰æ–¹åº“</strong>ï¼Œéœ€è¦ä½¿ç”¨ <code>await</code>è°ƒç”¨æ—¶ï¼Œæ­¤æ—¶ä½¿ç”¨ <code>async def</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_results</span>():<br>    results = <span class="hljs-keyword">await</span> some_library()<br>    <span class="hljs-keyword">return</span> results<br></code></pre></td></tr></table></figure><ul><li>ä½ è‡ªå·±ç¼–å†™çš„å·¥å…·åº“æˆ–è€…ç¬¬ä¸‰æ–¹å·¥å…·åº“ï¼Œä»£ç æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸æ¶‰åŠIOç­‰å¾…ï¼Œæ­¤æ—¶ç›´æ¥è°ƒç”¨å³å¯ï¼Œä¸ç”¨ <code>await</code></li><li>å½“ä½ çš„å‡½æ•°å†…éƒ¨åªè¦æœ‰ä¸€å¤„ä½¿ç”¨ <code>await</code>ï¼Œ è¯¥å‡½æ•°å¿…é¡»ä½¿ç”¨ <code>async def </code>å®šä¹‰</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&#x27;/&#x27;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">read_results</span>():<br>    results1 = some_library1()<br>    results2 = <span class="hljs-keyword">await</span> some_library()<br>    <span class="hljs-keyword">return</span> results<br><span class="hljs-comment"># test</span><br></code></pre></td></tr></table></figure><ul><li><p>å½“ä½ å¯¹åç¨‹&#x2F;async&#x2F;await&#x2F;asyncioè¿™äº›æ¦‚å¿µä¸æ¸…æ¥šçš„æ—¶å€™ï¼Œå°±ä½¿ç”¨æ™®é€šå‡½æ•°ã€‚</p></li><li><p>ä½ éœ€è¦ä½¿ç”¨çš„ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“æ˜¯åŒæ­¥åº“ï¼Œä½†æ˜¯ä½ éœ€è¦å®ƒæ”¯æŒåç¨‹å¼‚æ­¥ï¼Œé‚£éœ€è¦è‡ªå·±ä½¿ç”¨çº¿ç¨‹æ± çš„æ–¹å¼è¿è¡Œï¼Œå‚è€ƒè§†é¢‘ï¼š</p><ul><li><a href="https://www.51zxw.net/Show.aspx?cid=1054&id=121502">çº¿ç¨‹æ± å’Œåç¨‹æ··åˆå®ç°å¹¶å‘æ¡ˆä¾‹</a></li></ul></li></ul><h1 id="12-4-fastapié›†æˆaiohttp"><a href="#12-4-fastapié›†æˆaiohttp" class="headerlink" title="12-4 fastapié›†æˆaiohttp"></a>12-4 fastapié›†æˆaiohttp</h1><p>ä¼ ç»Ÿpythonä»£ç ä¸­å‘è¯·æ±‚ï¼ˆå¦‚çˆ¬è™«ï¼‰æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨requestsæ¨¡å—ï¼Œä½†æ˜¯è¿™ä¸ªæ¨¡å—æ˜¯åŒæ­¥é˜»å¡çš„ã€‚</p><p>æ‰€ä»¥åœ¨å¼‚æ­¥asyncioä½“ç³»ä¸­ï¼Œæˆ‘ä»¬ä¸å†ä½¿ç”¨requestsæ¨¡å—ï¼Œä¸€èˆ¬ä¼šä½¿ç”¨å¼‚æ­¥çš„ <code>aiohttp</code> æ¨¡å—ã€‚ï¼ˆhttpxï¼‰</p><ul><li>ä½¿ç”¨å‰ç°åœ¨å®‰è£…</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip3 install aiohttp<br></code></pre></td></tr></table></figure><ul><li>ç®€ä»‹ï¼š<strong>å¼‚æ­¥æ”¯æŒå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ï¼ŒåŠŸèƒ½å¼ºå¤§</strong>ã€‚ç½‘å€ï¼š<a href="https://docs.aiohttp.org/en/stable/">https://docs.aiohttp.org/en/stable/</a></li></ul><p>ç¤ºä¾‹1ï¼šåŸºæœ¬ä½¿ç”¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> asyncio<br><span class="hljs-keyword">import</span> aiohttp<br><br><span class="hljs-comment"># åç¨‹å‡½æ•°</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">aiohttp_demo</span>():<br>    <span class="hljs-comment"># è·å–ä¸€ä¸ªè¿æ¥session</span><br>    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> aiohttp.ClientSession() <span class="hljs-keyword">as</span> session:<br>        <span class="hljs-comment"># åŸºäºè¿æ¥å‘é€ä¸€ä¸ªgetè¯·æ±‚å¹¶è·å–åƒä¸€ä¸ªresponse</span><br>        <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> session.get(<span class="hljs-string">&#x27;http://www.baidu.com&#x27;</span>) <span class="hljs-keyword">as</span> response:<br>            <span class="hljs-comment"># ä»responseä¸­è·å–å“åº”çš„å„ç§ç»“æœ</span><br>            <span class="hljs-comment"># å› ä¸ºåŸºäºä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œæ‰€ä»¥å‡ºè‡ªåŠ¨å…³é—­è¿æ¥</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Status:&quot;</span>, response.status)<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Content-type:&quot;</span>, response.headers[<span class="hljs-string">&#x27;content-type&#x27;</span>])<br><br>            html = <span class="hljs-keyword">await</span> response.text()<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Body:&quot;</span>, html[:<span class="hljs-number">15</span>], <span class="hljs-string">&quot;...&quot;</span>)<br><br>     <br><span class="hljs-comment"># è·å–äº‹ä»¶å¾ªç¯ï¼Œåœ¨äº‹ä»¶å¾ªç¯ä¸­æ‰§è¡Œåç¨‹å‡½æ•°</span><br><span class="hljs-comment"># loop = asyncio.get_event_loop()</span><br><span class="hljs-comment"># loop.run_until_complete(aiohttp_demo())</span><br><br><br><span class="hljs-comment"># ä¸Šé¢ä¸¤è¡Œä»£ç çš„ç®€å†™ï¼ŒPython3.7ä»¥åçš„ç‰ˆæœ¬æ‰å¯ä»¥ä½¿ç”¨</span><br>asyncio.run(aiohttp_demo())<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹2ï¼šåœ¨fastapiä¸­ä½¿ç”¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> aiohttp<br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><br><br>app = FastAPI(title=<span class="hljs-string">&quot;ä½¿ç”¨aiohttp&quot;</span>)<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">baidu_index</span>():<br>    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> aiohttp.ClientSession() <span class="hljs-keyword">as</span> session:<br>        <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> session.get(<span class="hljs-string">&#x27;http://www.baidu.com&#x27;</span>) <span class="hljs-keyword">as</span> response:<br>            <span class="hljs-keyword">return</span> &#123;<br>                <span class="hljs-string">&quot;status&quot;</span>: response.status,<br>                <span class="hljs-string">&quot;content-type&quot;</span>: response.headers[<span class="hljs-string">&#x27;content-type&#x27;</span>],<br>                <span class="hljs-string">&quot;body&quot;</span>: <span class="hljs-keyword">await</span> response.text()<br>            &#125;<br></code></pre></td></tr></table></figure><ul><li>æˆ–è€…å°†çˆ¬å–ç™¾åº¦é¡µé¢çš„ä»£ç å°è£…æˆä¸€ä¸ªåç¨‹å‡½æ•°ï¼Œåœ¨æ¥å£ä¸­ç›´æ¥è°ƒç”¨è¯¥åç¨‹å‡½æ•°å³å¯</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> aiohttp<br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><br><br>app = FastAPI(title=<span class="hljs-string">&quot;ä½¿ç”¨aiohttp&quot;</span>)<br><br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">baidu_html</span>():<br>    <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> aiohttp.ClientSession() <span class="hljs-keyword">as</span> session:<br>        <span class="hljs-keyword">async</span> <span class="hljs-keyword">with</span> session.get(<span class="hljs-string">&#x27;http://www.baidu.com&#x27;</span>) <span class="hljs-keyword">as</span> response:<br>            <span class="hljs-keyword">return</span> &#123;<br>                <span class="hljs-string">&quot;status&quot;</span>: response.status,<br>                <span class="hljs-string">&quot;content-type&quot;</span>: response.headers[<span class="hljs-string">&#x27;content-type&#x27;</span>],<br>                <span class="hljs-string">&quot;body&quot;</span>: <span class="hljs-keyword">await</span> response.text()<br>            &#125;<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> baidu_html()<span class="hljs-comment"># éœ€è¦ä½¿ç”¨await æ‰èƒ½æ‰§è¡Œbaidu_html è¿™ä¸ªåç¨‹å‡½æ•°</span><br></code></pre></td></tr></table></figure><h1 id="12-5-fastapié›†æˆaiomysql"><a href="#12-5-fastapié›†æˆaiomysql" class="headerlink" title="12-5 fastapié›†æˆaiomysql"></a>12-5 fastapié›†æˆaiomysql</h1><p>åœ¨pythonä¸­æ“ä½œmysqlæˆ‘ä»¬é€šå¸¸ä½¿ç”¨pymysqlä½œä¸ºæ•°æ®åº“é©±åŠ¨ï¼Œä½†æ˜¯åœ¨å¼‚æ­¥çš„ä¸–ç•Œä¸­æˆ‘ä»¬ä½¿ç”¨aiomysqlå½“é©±åŠ¨ã€‚</p><p>å®˜ç½‘ï¼š<a href="https://aiomysql.readthedocs.io/en/latest/index.html">https://aiomysql.readthedocs.io/en/latest/index.html</a></p><p>ç¤ºä¾‹1ï¼šaiomysqlç®€å•ä½¿ç”¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> aiomysql<br><span class="hljs-keyword">from</span> aiomysql.cursors <span class="hljs-keyword">import</span> DictCursor<br><br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><br>app = FastAPI(title=<span class="hljs-string">&quot;ä½¿ç”¨aiomysql&quot;</span>)<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">aiomysql_demo</span>():<br>    <span class="hljs-comment"># è·å–è¿æ¥å¯¹è±¡</span><br>    conn = <span class="hljs-keyword">await</span> aiomysql.connect(<br>        host=<span class="hljs-string">&quot;127.0.0.1&quot;</span>,<br>        port=<span class="hljs-number">3306</span>,<br>        user=<span class="hljs-string">&quot;root&quot;</span>,<br>        password=<span class="hljs-string">&quot;12345&quot;</span>,<br>        db=<span class="hljs-string">&quot;db&quot;</span>,<br>        cursorclass=DictCursor      <span class="hljs-comment"># è¿”å›å­—å…¸æ ¼å¼çš„æ•°æ®</span><br>    )<br>    <span class="hljs-comment"># åˆ›å»ºæ¸¸æ ‡</span><br>    cur = <span class="hljs-keyword">await</span> conn.cursor()<br>    <span class="hljs-comment"># æ‰§è¡ŒSQL</span><br>    <span class="hljs-keyword">await</span> cur.execute(<span class="hljs-string">&quot;SELECT * from users;&quot;</span>)<br>    <span class="hljs-comment"># è·å–SQLç»“æœ</span><br>    result = <span class="hljs-keyword">await</span> cur.fetchall()<br>    <span class="hljs-comment"># å…³é—­CURSOR</span><br>    <span class="hljs-keyword">await</span> cur.close()<br>    <span class="hljs-comment"># å…³é—­è¿æ¥</span><br>    conn.close()<br><br>    <span class="hljs-keyword">return</span> result<br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> aiomysql_demo()<br><br></code></pre></td></tr></table></figure><h1 id="12-6-fastapié›†æˆdatabases"><a href="#12-6-fastapié›†æˆdatabases" class="headerlink" title="12-6 fastapié›†æˆdatabases"></a>12-6 fastapié›†æˆdatabases</h1><p>åœ¨å¼‚æ­¥ä¸–ç•Œä¸­æ“ä½œæ•°æ®åº“ï¼Œæ¯”å¦‚MySQLï¼Œæˆ‘ä»¬éœ€è¦åªç”¨ aiomysqlï¼Œä¸”éœ€è¦è‡ªå·±æ‰‹å†™SQLè¯­å¥ã€‚</p><p>ä½¿ç”¨å…¶ä»–ç±»å‹çš„æ•°æ®åº“ï¼Œæ¯”å¦‚PostgreSQLï¼Œåˆ™éœ€è¦åŸºäºasyncpgæˆ–aiopgã€‚</p><p>é‚£æ ·çš„å°±æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå½“æˆ‘ä»¬çš„åº”ç”¨éœ€è¦æ¢ä¸€ä¸ªæ•°æ®åº“æ—¶ï¼Œå°±éœ€è¦è°ƒæ•´åŸºç¡€ä»£ç ï¼Œä½¿ç”¨ä¸çµæ´»ã€‚</p><p>æ­¤æ—¶å‡ºç°äº†ä¸€ä¸ªå·¥å…·ï¼Œå®ƒå°è£…äº†ä¸åŒç±»å‹çš„æ•°æ®åº“ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨ä½¿ç”¨å®ƒæä¾›çš„æ¥å£æ“ä½œæ•°æ®åº“å°±è¡Œäº†ï¼Œè€Œä¸ç”¨å…³å¿ƒåº•å±‚çš„æ•°æ®åº“é©±åŠ¨ï¼Œå®ƒå°±æ˜¯encodeå‡ºå“çš„ <code>databases</code>ã€‚</p><p><img src="/img/fastapi/image-20220731215718389.png" alt="image-20220731215718389"></p><p>å®˜ç½‘ç®€ä»‹</p><ul><li><p>Databases gives you simple asyncio support for a range of databases.</p></li><li><p>It allows you to make queries using the powerful <a href="https://docs.sqlalchemy.org/en/latest/core/">SQLAlchemy Core</a> expression language, and provides support for PostgreSQL, MySQL, and SQLite.</p></li><li><p>Databases is suitable for integrating against any async Web framework, such as <a href="https://github.com/encode/starlette">Starlette</a>, <a href="https://github.com/huge-success/sanic">Sanic</a>, <a href="https://github.com/kennethreitz/responder">Responder</a>, <a href="https://gitlab.com/pgjones/quart">Quart</a>, <a href="https://github.com/aio-libs/aiohttp">aiohttp</a>, <a href="https://github.com/tornadoweb/tornado">Tornado</a>, or <a href="https://github.com/tiangolo/fastapi">FastAPI</a>.</p></li><li><p><strong>Documentation</strong>: <a href="https://www.encode.io/databases/">https://www.encode.io/databases/</a></p></li><li><p><strong>Requirements</strong>: Python 3.7+</p></li><li><p>ä¸‹è½½ï¼š<code> pip install databases</code></p></li></ul><p>ç¤ºä¾‹ï¼šåœ¨fastapiä¸­ä½¿ç”¨databasesæ“ä½œMySQLï¼ˆä¾èµ–aiomysqlï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><span class="hljs-keyword">from</span> databases <span class="hljs-keyword">import</span> Database<br><br>app = FastAPI(title=<span class="hljs-string">&quot;ä½¿ç”¨databases&quot;</span>)<br><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">databases_demo</span>():<br>    <span class="hljs-comment"># å®ä¾‹åŒ–ä¸€ä¸ªdbè¿æ¥å¹¶å»ºç«‹è¿æ¥</span><br>    database = Database(<span class="hljs-string">&#x27;mysql://root:12345@localhost:3306/db&#x27;</span>)<br>    <span class="hljs-keyword">await</span> database.connect()<br><br>    <span class="hljs-comment"># Run a database query.</span><br>    query = <span class="hljs-string">&quot;SELECT * FROM users&quot;</span><br>    rows = <span class="hljs-keyword">await</span> database.fetch_all(query=query)<br>    <span class="hljs-keyword">return</span> rows<br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> databases_demo()<br></code></pre></td></tr></table></figure><h1 id="12-7-fastapié›†æˆä¹Œé¾ŸORM"><a href="#12-7-fastapié›†æˆä¹Œé¾ŸORM" class="headerlink" title="12-7 fastapié›†æˆä¹Œé¾ŸORM"></a>12-7 fastapié›†æˆä¹Œé¾ŸORM</h1><p>æƒ³è¦ä½¿ç”¨ORMæ“ä½œæ•°æ®ï¼Œä½¿ç”¨äº†SQLAlchemyï¼Œ</p><p>åŒæ ·çš„åœ¨åŸºäºåç¨‹çš„å¼‚æ­¥ä»£ç ä¸­ï¼Œæ“ä½œæ•°æ®åº“æ—¶ä¹Ÿå¯ä»¥ä½¿ç”¨ORMï¼Œä½†æ­¤æ—¶å°±ä¸èƒ½åœ¨ä½¿ç”¨SQLAlchemyï¼ˆå› ä¸ºå®ƒä¸æ”¯æŒå¼‚æ­¥ï¼‰</p><p>asyncioä¸–ç•Œä¸­ï¼Œæˆ‘ä»¬ä¹Ÿæœ‰å¯ä»¥é€‰æ‹©çš„ORMï¼Œæ¯”å¦‚ï¼š <a href="tortoise.github.io">tortoise-orm</a> ç¿»è¯‘è¿‡æ¥å°±ä¹Œé¾ŸORM</p><p>ä¹Œé¾ŸORMç®€ä»‹</p><ul><li><p>å®˜ç½‘ï¼š<a href="https://tortoise.github.io/">https://tortoise.github.io/</a></p></li><li><p>Tortoise ORM is an easy-to-use <code>asyncio</code> ORM <em>(Object Relational Mapper)</em> inspired by Django.</p></li><li><p>Tortoise ORM was build with relations in mind and admiration for the excellent and popular Django ORM.</p></li><li><p>Tortoise ORM is supported on CPython &gt;&#x3D; 3.7 for SQLite, MySQL and PostgreSQL.</p></li><li><p>ä¸‹è½½å®‰è£…ï¼š<code>pip3 install tortoise-orm</code></p></li></ul><p>ç¤ºä¾‹ï¼šfastapiç®€å•é›†æˆä¹Œé¾ŸORM</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># main.py</span><br><br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><span class="hljs-keyword">from</span> tortoise <span class="hljs-keyword">import</span> fields<br><span class="hljs-keyword">from</span> tortoise.models <span class="hljs-keyword">import</span> Model<br><span class="hljs-keyword">from</span> tortoise.contrib.fastapi <span class="hljs-keyword">import</span> register_tortoise<br><br>app = FastAPI(title=<span class="hljs-string">&quot;ä½¿ç”¨tortoise orm&quot;</span>)<br><br><span class="hljs-comment"># å®šä¹‰æ¨¡å‹è¡¨</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-title class_ inherited__">Model</span>):<br>    <span class="hljs-built_in">id</span> = fields.IntField(pk=<span class="hljs-literal">True</span>)<br>    username = fields.CharField(max_length=<span class="hljs-number">255</span>)<br>    password = fields.CharField(max_length=<span class="hljs-number">255</span>)<br>    email = fields.CharField(max_length=<span class="hljs-number">255</span>)<br><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Meta</span>:<br>        table = <span class="hljs-string">&quot;users&quot;</span><span class="hljs-comment"># è¡¨ç¤ºè¿™ä¸ªè¡¨å¯¹åº”æ•°æ®åº“ä¸­çš„è¡¨å</span><br><br><span class="hljs-comment"># ä½¿ç”¨register_tortoise æ³¨å†Œæ•°æ®åº“ä¿¡æ¯</span><br>register_tortoise(<br>    app,<br>    db_url=<span class="hljs-string">&quot;mysql://root:12345@127.0.0.1:3306/db&quot;</span>,<br>    modules=&#123;<span class="hljs-string">&quot;models&quot;</span>: [<span class="hljs-string">&quot;main&quot;</span>]&#125;,<span class="hljs-comment"># æŒ‡å®šæ¨¡å‹è¡¨æ‰€åœ¨çš„æ–‡æœ¬ï¼Œ&quot;main&quot; è¡¨ç¤ºmian.pyä¸­å®šä¹‰äº†Useræ¨¡å‹è¡¨</span><br>)<br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    user = <span class="hljs-keyword">await</span> User.<span class="hljs-built_in">filter</span>(username=<span class="hljs-string">&quot;liuxu&quot;</span>).first()<br>    user.email = <span class="hljs-string">&quot;1111&quot;</span><br>    <span class="hljs-keyword">await</span> user.save()<br><br>    <span class="hljs-comment"># å¸¸ç”¨çš„CRUDæ–¹æ³•</span><br>    <span class="hljs-comment"># fake_user = await User.create(username=&quot;111&quot;, password=&quot;111&quot;, email=&quot;111&quot;)</span><br>    <span class="hljs-comment"># await User.filter(id=fake_user.id).update(username=&quot;Updated name&quot;)</span><br>    <span class="hljs-comment"># await User.filter(id=1).delete()</span><br><br>    <span class="hljs-keyword">return</span> user<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç¼–ç¨‹ï¼Œwebå¼€å‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€pythonã€‘FastAPI7ä¹‹APIRouterä¸è¯·æ±‚å“åº”çš„è¿›é˜¶ç”¨æ³•ï¼ˆä¸ƒï¼‰</title>
    <link href="/2024/03/04/687FastAPI7%E4%B9%8BAPIRouter%E4%B8%8E%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94%E7%9A%84%E8%BF%9B%E9%98%B6%E7%94%A8%E6%B3%95/"/>
    <url>/2024/03/04/687FastAPI7%E4%B9%8BAPIRouter%E4%B8%8E%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94%E7%9A%84%E8%BF%9B%E9%98%B6%E7%94%A8%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<h1 id="10-1-APIRouteråŸºæœ¬ä½¿ç”¨ã€é‡ç‚¹ã€‘"><a href="#10-1-APIRouteråŸºæœ¬ä½¿ç”¨ã€é‡ç‚¹ã€‘" class="headerlink" title="10-1 APIRouteråŸºæœ¬ä½¿ç”¨ã€é‡ç‚¹ã€‘"></a>10-1 APIRouteråŸºæœ¬ä½¿ç”¨ã€é‡ç‚¹ã€‘</h1><p><strong>åœºæ™¯ï¼š</strong></p><p>å¦‚æœæˆ‘ä»¬å†™ä¸€ä¸ªç½‘ç«™ï¼Œæˆ–è€…å†™ä¸€ä¸ªAPPï¼Œé‚£æ•´ä¸ªé¡¹ç›®æ˜¯<strong>æ¯”è¾ƒå¤æ‚</strong>çš„ï¼Œæ­¤æ—¶ä¸åº”è¯¥æŠŠæ‰€æœ‰ä»£ç æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚</p><p>å‰é¢æˆ‘ä»¬é€šè¿‡æŠŠä»£ç æ‹†åˆ†åˆ°ä¸åŒæ–‡ä»¶çš„æ–¹å¼ï¼Œå¯ä»¥è§£å†³ä¸€äº›ä»£ç æ··ä¹±çš„é—®é¢˜ï¼Œä½†æ˜¯å´ä¸èƒ½æ›´å¥½çš„è§£å†³ã€‚</p><p>æ¯”å¦‚ä¸€ä¸ªé¡¹ç›®ä¸­å¯èƒ½å«æœ‰ä¸åŒçš„æ¨¡å—ï¼Œé‚£ä¸åŒçš„æ¨¡å—åº”è¯¥åˆ†å¼€ç®¡ç†ï¼Œè¿™æ ·é¡¹ç›®æ‰ä¾¿äºç»´æŠ¤å’Œç®¡ç†ã€‚ã€‚</p><p><strong>FastAPIçš„è§£å†³æ–¹å¼</strong></p><p>APIRouterå°±æ˜¯FastAPIä¸ºäº†æ­¤éœ€æ±‚åœºæ™¯æä¾›äº†ä¸€ç§è§£å†³æ–¹å¼ï¼Œå®ƒç±»ä¼¼ <strong>Flaskä¸­çš„è“å›¾</strong>ï¼Œ<strong>Djangoä¸­çš„app</strong></p><p>ç¤ºä¾‹1ï¼šAPIRouterçš„åŸºæœ¬ä½¿ç”¨</p><ul><li>main.py éå¸¸ç®€æ´ï¼Œä¸»è¦è´Ÿè´£æ³¨å†Œç®¡ç†</li><li>ä½¿ç”¨ <code>app.include_router(blog.router, prefix=&quot;/blog&quot;, tags=[&quot;Blog&quot;])</code> æ³¨å†Œæ¨¡å—ï¼ŒåŒæ—¶å¯ä»¥æŒ‡å®šåŠapiçš„å‰ç¼€(prefix)å’Œæ ‡ç­¾(tags)</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><span class="hljs-keyword">from</span> routers <span class="hljs-keyword">import</span> blog, user<br><br>app = FastAPI()<br>app.include_router(blog.router, prefix=<span class="hljs-string">&quot;/blog&quot;</span>, tags=[<span class="hljs-string">&quot;Blog&quot;</span>])<br>app.include_router(user.router)<br></code></pre></td></tr></table></figure><ul><li>routers&#x2F;blog.py ä¸»è¦è´Ÿè´£å’Œblogæ¨¡å—æœ‰å…³çš„ä¸šåŠ¡</li><li><code>router = APIRouter()</code>å¾—åˆ°çš„ routerå¯¹è±¡å’Œmain.pyä¸­çš„appå¯¹è±¡ä½¿ç”¨æ–¹å¼ä¸€æ ·</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> APIRouter<br>router = APIRouter()<br><br><span class="hljs-meta">@router.get(<span class="hljs-params"><span class="hljs-string">&quot;/blogs&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">blogs</span>():<br>    <span class="hljs-keyword">return</span> [&#123;<span class="hljs-string">&quot;id&quot;</span>: i, <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">f&quot;blog<span class="hljs-subst">&#123;i&#125;</span>&quot;</span>&#125; <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>)]<br><br><span class="hljs-meta">@router.get(<span class="hljs-params"><span class="hljs-string">&quot;/&#123;blog_id&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_blog</span>(<span class="hljs-params">blog_id: <span class="hljs-built_in">int</span></span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;id&quot;</span>: blog_id, <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">f&quot;blog<span class="hljs-subst">&#123;blog_id&#125;</span>&quot;</span>&#125;<br><br><span class="hljs-meta">@router.delete(<span class="hljs-params"><span class="hljs-string">&quot;/&#123;blog_id&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete</span>(<span class="hljs-params">blog_id: <span class="hljs-built_in">int</span></span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;code&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">f&quot;Done blog_id: <span class="hljs-subst">&#123;blog_id&#125;</span>&quot;</span>&#125;<br></code></pre></td></tr></table></figure><ul><li>routers&#x2F;user.pyï¼Œè´Ÿè´£å’Œç”¨æˆ·ç›¸å…³çš„æ¨¡å—</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> APIRouter, Form<br>router = APIRouter(tags=[<span class="hljs-string">&quot;User&quot;</span>], prefix=<span class="hljs-string">&quot;/user&quot;</span>)<br><br><span class="hljs-meta">@router.post(<span class="hljs-params"><span class="hljs-string">&quot;/login&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">name: <span class="hljs-built_in">str</span> = Form(<span class="hljs-params"></span>), pwd: <span class="hljs-built_in">str</span> = Form(<span class="hljs-params"></span>)</span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;name&quot;</span>: name&#125;<br><br><br><span class="hljs-meta">@router.get(<span class="hljs-params"><span class="hljs-string">&quot;/me&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">info</span>():<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;info&quot;</span>:  <span class="hljs-string">&quot;this is a cute boy&quot;</span>&#125;<br></code></pre></td></tr></table></figure><ul><li>ç›®çš„ï¼š</li></ul><p>è®©æ‰€æœ‰çš„APIæ–‡ä»¶æŒ‡å‘ä¸€ä¸ªåŒä¸€ä¸ªå®ä¾‹åŒ–çš„FastAPI()å¯¹è±¡ ä¹Ÿå°±æ˜¯åŒä¸€ä¸ªappå¯¹è±¡</p><h1 id="11-1-ç›´æ¥ä½¿ç”¨Requestå¯¹è±¡"><a href="#11-1-ç›´æ¥ä½¿ç”¨Requestå¯¹è±¡" class="headerlink" title="11-1 ç›´æ¥ä½¿ç”¨Requestå¯¹è±¡"></a>11-1 ç›´æ¥ä½¿ç”¨Requestå¯¹è±¡</h1><ul><li><p>å…³äºè¯·æ±‚çš„æ“ä½œï¼Œæ¯”å¦‚ä»URLä¸­æå–è·¯å¾„å‚æ•°ï¼Œè·å–æŸ¥è¯¢å‚æ•°ï¼Œè·å–è¯·æ±‚å¤´ï¼Œè·å–Cookieï¼Œè·å–è¯·æ±‚ä½“ä¸­çš„æ•°æ®ï¼›è¿™äº›å‚æ•°å’Œå€¼çš„è·å–éå¸¸æ–¹ä¾¿ï¼Œè¿™æ˜¯å› ä¸ºFastAPIå¸®æˆ‘ä»¬åˆ›é€ ä¾¿åˆ©ã€‚</p></li><li><p>FastAPIåº•å±‚ä¾èµ–Starletteï¼Œæœ¬è´¨ä¸Šæ˜¯FastAPIå¸®æˆ‘ä»¬åšäº†ä¸€äº›æ“ä½œï¼Œä»Starletteçš„Requestå¯¹è±¡è§£æå‡ºä¸Šè¿°å„ä¸ªå‚æ•°ã€‚</p></li><li><p>æ‰€ä»¥ï¼Œå¯¹äºä¸Šé¢è¿™äº›å¸¸ç”¨çš„è¯·æ±‚å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨FastAPIç»™æˆ‘ä»¬æä¾›çš„å·¥å…·ï¼Œå¹¶ä¸”æœ‰äº†æ•°æ®æ ¡éªŒã€ç±»å‹è½¬åŒ–ã€OPenAPIæ–‡æ¡£ç­‰åŠŸèƒ½ã€‚</p></li><li><p>å½“ç„¶äº†ï¼Œä½ ä¸ä½¿ç”¨FastAPIæä¾›çš„ä¾¿æ·å·¥å…·ï¼Œç›´æ¥ä»Requestå¯¹è±¡ä¸­è§£ææ•°æ®ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œä½†å°±æ²¡ç”±æ•°æ®æ ¡éªŒã€ç±»å‹è½¬åŒ–ã€OPenAPIæ–‡æ¡£ç­‰åŠŸèƒ½ã€‚</p></li><li><p>ä¸è¿‡ï¼Œæœ‰äº›åœºæ™¯ï¼Œæ¯”å¦‚è¯´è·å–è¯·æ±‚çš„IPï¼Œè¯·æ±‚çš„client hostç­‰ç­‰ï¼Œé‚£æˆ‘ä»¬å°±å¿…é¡»ç›´æ¥ä½¿ç”¨Requestå¯¹è±¡ã€‚</p></li></ul><p>ç¤ºä¾‹1ï¼šä½¿ç”¨ä½¿ç”¨Requestè·å–ä¸€äº›å¸¸è§å‚æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Request<br><span class="hljs-keyword">from</span> starlette.requests <span class="hljs-keyword">import</span> Request<br>app = FastAPI()<br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/&#123;item_id&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello</span>(<span class="hljs-params">req: Request</span>):<br>    item_id = req.path_params.get(<span class="hljs-string">&quot;item_id&quot;</span>) <span class="hljs-comment"># ä»è¯·æ±‚çš„è·¯å¾„å‚æ•°è·å–item_id</span><br>    page = req.query_params.get(<span class="hljs-string">&quot;page&quot;</span>, <span class="hljs-number">0</span>) <span class="hljs-comment"># ä»è¯·æ±‚çš„æŸ¥è¯¢å‚æ•°è·å–åˆ†é¡µä¿¡æ¯</span><br>    size = req.query_params.get(<span class="hljs-string">&quot;size&quot;</span>, <span class="hljs-number">10</span>)<br>    x_token = req.headers.get(<span class="hljs-string">&quot;x-token&quot;</span>) <span class="hljs-comment"># ä» è¯·æ±‚å¤´ä»è·å–x-token</span><br>    x_token_cookie = req.cookies.get(<span class="hljs-string">&quot;x_token&quot;</span>) <span class="hljs-comment"># ä» è¯·æ±‚çš„cookiesä»è·å–x-token</span><br><br>    <span class="hljs-keyword">return</span> &#123;<br>        <span class="hljs-string">&quot;item_id&quot;</span>: item_id,<br>        <span class="hljs-string">&quot;page&quot;</span>: page,<br>        <span class="hljs-string">&quot;size&quot;</span>: size,<br>        <span class="hljs-string">&quot;x-token&quot;</span>: x_token,<br>        <span class="hljs-string">&quot;cookie&quot;</span>: x_token_cookie,<br><br>    &#125;<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹2ï¼šä½¿ç”¨Requestè·å–å®¢æˆ·ç«¯host</p><ul><li>ä»fastapiå¯¼å…¥ <code>Request</code>å¯¹è±¡ï¼Œæˆ–è€…ç›´æ¥ä» starlette.requestså¯¼å…¥ <code>Request</code>ï¼Œ ä¸¤è€…æ˜¯ä¸€æ ·çš„æ•ˆæœã€‚</li><li>æœ¬ä¾‹ä¸­ï¼Œè·¯å¾„å‚æ•° <code>item_id</code>æ˜¯ç”¨çš„FastAPIæä¾›çš„ä¾¿æ·æ–¹å¼ï¼Œæ‰€ä»¥å…·æœ‰ç±»å‹è½¬æ¢ã€ç±»å‹æ ¡éªŒã€openapiæ–‡æ¡£ç­‰é™„åŠ åŠŸèƒ½ã€‚</li><li>ç¬¬äºŒä¸ªå½¢å‚ <code>req</code> çš„ç±»å‹æ˜¯ <code>Request</code>ï¼Œé‚£FastAPIå°±çŸ¥é“è¦ç›´æ¥ä»Requestä¸­è·å–å‚æ•°ï¼Œå°±æ²¡æœ‰ä¸Šè¿°é™„åŠ åŠŸèƒ½ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Request<br><span class="hljs-keyword">from</span> starlette.requests <span class="hljs-keyword">import</span> Request<br>app = FastAPI()<br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/item/&#123;item_id&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello</span>(<span class="hljs-params">item_id: <span class="hljs-built_in">int</span>, req: Request</span>):<br>    <span class="hljs-keyword">return</span> &#123;<br>        <span class="hljs-string">&quot;item_id&quot;</span>: item_id,<br>        <span class="hljs-string">&quot;client_host&quot;</span>: req.client.host<br>    &#125;<br></code></pre></td></tr></table></figure><p><strong>è¡¥å……ï¼šç›´æ¥ä»Requestä¸­è·å–è¯·æ±‚ä½“å‚æ•°ï¼Œéœ€è¦ä½¿ç”¨async&#x2F;awaitè¯­æ³•ï¼Œåœ¨ä¸‹ä¸€ç« æˆ‘ä»¬å†è¯¦ç»†ä»‹ç»ã€‚</strong></p><h1 id="11-2-ç›´æ¥ä½¿ç”¨Responseå¯¹è±¡"><a href="#11-2-ç›´æ¥ä½¿ç”¨Responseå¯¹è±¡" class="headerlink" title="11-2 ç›´æ¥ä½¿ç”¨Responseå¯¹è±¡"></a>11-2 ç›´æ¥ä½¿ç”¨Responseå¯¹è±¡</h1><ul><li><p>å…³äºå“åº”çš„æ“ä½œï¼Œåœ¨å‰é¢çš„ç« èŠ‚æœ‰æ¶‰åŠåˆ°ï¼Œæ¯”å¦‚è®¾ç½®<strong>å“åº”çŠ¶æ€ç </strong>ï¼Œè®¾ç½®<strong>å“åº”å¤´</strong>ï¼Œåœ¨è·¯å¾„å‡½æ•°å†…è¿”å›æ•°æ®å°±å¯ä»¥å½“åšå“åº”ä½“ã€‚</p></li><li><p>è¿™äº›éƒ½æ˜¯FastAPIç»™æˆ‘ä»¬æä¾›çš„ä¾¿æ·æ–¹å¼ï¼Œä½¿ç”¨äº†è¿™äº›æ–¹å¼ï¼Œå‡ ä¹å¸®åŠ©æˆ‘ä»¬å¤„ç†äº†å¤§éƒ¨åˆ†å¸¸è§çš„éœ€æ±‚ã€‚</p></li><li><p>ä¸è¿‡ï¼Œåœ¨ä¸€äº›<strong>ç‰¹æ®Š</strong>å¸¸åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦æ›´åŠ çµæ´»çš„å¤„ç†å“åº”ã€‚</p></li><li><p>æ¯”å¦‚ï¼Œæˆ‘ä»¬å·²ç»ä½¿ç”¨è¿‡äº†ï¼Œé€šè¿‡Responseå¯¹è±¡æ¥è®¾ç½®Cookie, è®¾ç½®å“åº”å¤´ç­‰ç­‰ã€‚</p></li><li><p><strong>æœ¬è´¨ä¸Šï¼ŒFastAPIå€Ÿç”¨äº†Starletteæ¡†æ¶çš„Responseå¯¹è±¡ï¼Œå³æˆ‘ä»¬ä½¿ç”¨çš„Responseå¯¹è±¡éƒ½æ˜¯Starletteçš„</strong>ã€‚</p></li><li><p><strong>Responseå¯¹è±¡è¿˜æœ‰å¾ˆå¤šå…¶ä»–é«˜è¿›çš„ç”¨æ³•ï¼Œæ¯”å¦‚å¤„ç†é‡å®šå‘ã€å“åº”å…¶ä»–æ ¼å¼çš„æ•°æ®ï¼šçº¯æ–‡æœ¬&#x2F;HTML&#x2F;XML&#x2F;ä¸‹è½½æ–‡ä»¶ç­‰ç­‰</strong>ã€‚</p></li></ul><p>ç¤ºä¾‹1ï¼šä½¿ç”¨Responseè®¾ç½®çŠ¶æ€ç &#x2F;å“åº”å¤´&#x2F;cookie</p><ul><li>ä»FastAPIå¯¼å…¥çš„Responseï¼Œç­‰ä»·äºä»starlette.responseså¯¼å…¥çš„Response</li><li>åœ¨è·¯å¾„å‡½æ•°ä¸­å®šä¹‰çš„å½¢å‚<code>response</code>çš„ç±»å‹æ˜¯Responseï¼ŒFastAPIå¯ä»¥æ˜¯è¢«å‡ºæ¥ä½ è¦æ‰‹åŠ¨ä½¿ç”¨Responseå¯¹è±¡</li><li>ä½†æ˜¯ï¼Œè¿™æ ·çš„ä½¿ç”¨æ–¹å¼ï¼Œæœ¬è´¨ä¸Šä¾ç„¶ä½¿ç”¨äº†FastAPIçš„ä¾¿æ·æ–¹å¼ï¼Œå› ä¸ºä½ è¿”å›çš„æ˜¯â€123â€ï¼Œä½†å…¶å®å“åº”æ ¼å¼æ˜¯â€application&#x2F;jsonâ€</li><li>è¿™æ˜¯å› ä¸ºï¼ŒFastAPIçš„é»˜è®¤å“åº”æ–¹å¼æ˜¯JSONResponseï¼Œå³æ‰€æœ‰çš„è¿”å›ç»™å®¢æˆ·ç«¯çš„æ•°æ®éƒ½ä¼šè¢«jsonåºåˆ—åŒ–</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Response <span class="hljs-comment"># ç­‰ä»·</span><br><span class="hljs-keyword">from</span> starlette.responses <span class="hljs-keyword">import</span> Response <span class="hljs-comment"># ç­‰ä»·</span><br>app = FastAPI()<br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello</span>(<span class="hljs-params">response: Response</span>):<br>    response.status_code = <span class="hljs-number">201</span> <span class="hljs-comment"># è®¾ç½®å“åº”ç </span><br>    response.headers[<span class="hljs-string">&quot;x-token&quot;</span>] = <span class="hljs-string">&quot;12345&quot;</span> <span class="hljs-comment"># è®¾ç½®å“åº”å¤´</span><br>    response.set_cookie(<span class="hljs-string">&quot;token&quot;</span>, <span class="hljs-string">&quot;111111&quot;</span>, <span class="hljs-number">100</span>) <span class="hljs-comment"># è®¾ç½®å“åº”cookies</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;123&quot;</span><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹2ï¼šç›´æ¥è¿”å›Responseå¯¹è±¡</p><ul><li>Responseç±»åˆå§‹åŒ–å¯¹è±¡ä¸€èˆ¬éœ€è¦<strong>å››ä¸ªå‚æ•°</strong></li><li><code>content</code>æ˜¯å“åº”ä½“çš„æ•°æ®ï¼Œå¿…é¡»æ˜¯æ”¯æŒç¼–ç çš„å­—ç¬¦ä¸²ã€‚å¦‚æœè¦è¿”å›çš„æ•°æ®æ˜¯å­—æ®µï¼Œåˆ™è¦ä½¿ç”¨jsonåºåˆ—åŒ–</li><li><code>status_code</code> è®¾ç½®å“åº”çš„çŠ¶æ€ç </li><li><code>headers</code> è®¾ç½®å“åº”å¤´</li><li><code>media_type</code> è®¾ç½®å“åº”ç±»å‹ï¼Œæ¯”å¦‚è¯´æ˜¯jsonæ ¼å¼çš„æ•°æ®åˆ™å€¼ä¸º <code>application/json</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Response <span class="hljs-comment"># ç­‰ä»·ä¸‹é¢çš„</span><br><span class="hljs-keyword">from</span> starlette.responses <span class="hljs-keyword">import</span> Response <span class="hljs-comment"># ç­‰ä»·ä¸Šé¢çš„</span><br>app = FastAPI()<br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span>, </span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello</span>():<br>    response = Response(<br>        content=json.dumps(&#123;<span class="hljs-string">&quot;hello&quot;</span>: <span class="hljs-string">&quot;world&quot;</span>&#125;), <span class="hljs-comment"># åºåˆ—åŒ–å“åº”ä½“æ•°æ®</span><br>        status_code=<span class="hljs-number">201</span>, <span class="hljs-comment"># è®¾å®šå“åº”çŠ¶æ€ç </span><br>        headers=&#123;<span class="hljs-string">&quot;x-token&quot;</span>: <span class="hljs-string">&quot;qqqqqq&quot;</span>&#125;, <span class="hljs-comment"># è®¾å®šå“åº”å¤´</span><br>        media_type=<span class="hljs-string">&quot;application/json&quot;</span> <span class="hljs-comment"># è®¾å®šå“åº”ç±»å‹</span><br>    ) <span class="hljs-comment"># response=Response(å››ä¸ªå‚æ•°) å®ä¾‹åŒ–ä¸€ä¸ªResponseå¯¹è±¡</span><br><br>    <span class="hljs-keyword">return</span> response<br></code></pre></td></tr></table></figure><h1 id="11-3-é»˜è®¤å“åº”æ–¹å¼"><a href="#11-3-é»˜è®¤å“åº”æ–¹å¼" class="headerlink" title="11-3 é»˜è®¤å“åº”æ–¹å¼"></a>11-3 é»˜è®¤å“åº”æ–¹å¼</h1><p>åŸºäºä¸Šé¢æˆ‘ä»¬çŸ¥é“ï¼Œå¯ä»¥ç›´æ¥è¿”å›Responseå¯¹è±¡ï¼Œä½¿ç”¨èµ·æ¥ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œåªéœ€è¦åœ¨<strong>å®ä¾‹åŒ–å¯¹è±¡æ˜¯æŒ‰ç…§è¦æ±‚ä¼ å‚å³å¯</strong>ã€‚</p><p>ä½†æ˜¯ä½ ä¼šå‘ç°ï¼Œä¸åŒç±»å‹çš„å“åº”æ•°æ®ï¼Œ<strong>éƒ½éœ€è¦æ‰‹åŠ¨ä¼ å‚</strong>ï¼Œè¿™æ˜¯æ¯”è¾ƒéº»çƒ¦çš„ã€‚</p><p>å…¶å®ï¼ŒFastAPIæä¾›äº†å¤šç§å†…ç½®çš„å“åº”æ–¹å¼ï¼Œæ¯”å¦‚<strong>å¯¹äºJSONæ ¼å¼çš„å“åº”æ•°æ®</strong>ï¼Œæä¾›äº†<code>JSONResponse</code>è¿™ç§å“åº”ç±»å‹ã€‚</p><p>æœ¬è´¨ä¸ŠJSONResponseç±»æ˜¯Responseè¿™ä¸ªç±»çš„å­ç±»ï¼Œå¹¶ä¸”JSONResponseæ˜¯FastAPIä¸­çš„<strong>é»˜è®¤å“åº”æ–¹å¼</strong>ã€‚</p><p>ç¤ºä¾‹1:</p><ul><li>æ­¤æ—¶ç›´æ¥è¿”å›çš„æ˜¯å­—å…¸ï¼Œä½†FastAPIå†…éƒ¨å¸®æˆ‘ä»¬å¤„ç†ï¼Œè¿”å›çš„æ•°æ®æ ¼å¼æ˜¯jsonçš„ã€‚</li><li>æƒ³è¦ä¿®æ”¹å†…ç½®å“åº”æ–¹å¼ï¼Œå¯ä¿®æ”¹FastAPI()ä¸­æˆ–çš„APIRouter()ä¸­çš„ <code>default_response_class</code></li><li>è¿˜å¯ä»¥å¯¹äºæŒ‡å®šæ¥å£ï¼Œé€šè¿‡ <code>response_class</code>è®¾ç½®å“åº”æ–¹å¼</li><li>ä¼˜å…ˆçº§ï¼šæ¥å£ &gt; router &gt; app</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, APIRouter<br><span class="hljs-keyword">from</span> fastapi.responses <span class="hljs-keyword">import</span> JSONResponse<br><br><br>app = FastAPI(default_response_class=JSONResponse)<span class="hljs-comment"># è®¾ç½®å…¨å±€çš„é»˜è®¤å“åº”æ–¹å¼</span><br>router = APIRouter(default_response_class=JSONResponse) <span class="hljs-comment"># è®¾ç½®APIRouteræ‰€æœ‰æ¥å£çš„é»˜è®¤å“åº”æ–¹å¼</span><br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span>, response_class=JSONResponse</span>)</span><span class="hljs-comment"># è®¾ç½®è¿™ä¸ªæ¥å£çš„é»˜è®¤å“åº”æ–¹å¼</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello</span>():<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;liixu&quot;</span>&#125;<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹2ï¼šæºç é˜…è¯»</p><ul><li>JSONResponseæ˜¯Responseçš„å­ç±»ï¼Œmé»˜è®¤å†™æ­» <code>media_type = &quot;application/json&quot;</code></li><li>å¹¶é‡å†™äº†<code>render</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¼šåœ¨ç¤ºå®ä¾‹åŒ–å“åº”å¯¹è±¡æ—¶è§¦å‘ï¼Œç”¨æ¥æŠŠæˆ‘ä»¬ä¼ è¿›å»çš„ <code>content</code>åºåˆ—åŒ–ã€‚</li><li>å› æ­¤ä½¿ç”¨æ‰‹åŠ¨JSONResponseæ—¶éœ€è¦ä¿è¯contentæ˜¯å¯åºåˆ—åŒ–çš„ï¼Œå¦åˆ™æŠ¥é”™ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">JSONResponse</span>(<span class="hljs-title class_ inherited__">Response</span>):<br>    media_type = <span class="hljs-string">&quot;application/json&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params"></span><br><span class="hljs-params">        self,</span><br><span class="hljs-params">        content: typing.<span class="hljs-type">Any</span>,</span><br><span class="hljs-params">        status_code: <span class="hljs-built_in">int</span> = <span class="hljs-number">200</span>,</span><br><span class="hljs-params">        headers: typing.<span class="hljs-type">Optional</span>[<span class="hljs-built_in">dict</span>] = <span class="hljs-literal">None</span>,</span><br><span class="hljs-params">        media_type: typing.<span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span>,</span><br><span class="hljs-params">        background: typing.<span class="hljs-type">Optional</span>[BackgroundTask] = <span class="hljs-literal">None</span>,</span><br><span class="hljs-params">    </span>) -&gt; <span class="hljs-literal">None</span>:<br>        <span class="hljs-built_in">super</span>().__init__(content, status_code, headers, media_type, background)<br><span class="hljs-comment"># é‡å†™çˆ¶ç±»æ–¹æ³•</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">render</span>(<span class="hljs-params">self, content: typing.<span class="hljs-type">Any</span></span>) -&gt; <span class="hljs-built_in">bytes</span>:<br>        <span class="hljs-keyword">return</span> json.dumps(<br>            content,<br>            ensure_ascii=<span class="hljs-literal">False</span>,<br>            allow_nan=<span class="hljs-literal">False</span>,<br>            indent=<span class="hljs-literal">None</span>,<br>            separators=(<span class="hljs-string">&quot;,&quot;</span>, <span class="hljs-string">&quot;:&quot;</span>),<br>        ).encode(<span class="hljs-string">&quot;utf-8&quot;</span>)<br></code></pre></td></tr></table></figure><h1 id="11-4-æ–‡æœ¬ç›¸å…³çš„Response"><a href="#11-4-æ–‡æœ¬ç›¸å…³çš„Response" class="headerlink" title="11-4 æ–‡æœ¬ç›¸å…³çš„Response"></a>11-4 æ–‡æœ¬ç›¸å…³çš„Response</h1><p>å’Œæ–‡æœ¬ç›¸å…³çš„æœ‰<strong>ä¸¤ç§</strong>å“åº”æ–¹å¼ï¼š</p><ul><li><p><strong>PlainTextResponse</strong></p></li><li><p><strong>HTMLResponse</strong></p></li></ul><p>ç¤ºä¾‹1ï¼šPlainTextResponseç”¨æ¥<strong>å“åº”çº¯æ–‡æœ¬</strong>çš„æ•°æ®</p><ul><li>PlainTextResponseæ˜¯Responseçš„å­ç±»ï¼Œ<strong>é‡å†™äº†</strong>media_type &#x3D; â€œtext&#x2F;plainâ€ï¼Œå¯¹åº”å“åº”å¤´ä¸­çš„ <code>content-type: text/plain</code>ï¼Œæ­¤æ—¶ç½‘é¡µä¸Šæ˜¾ç¤ºçº¯æ–‡æœ¬ä¿¡æ¯ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><span class="hljs-keyword">from</span> fastapi.responses <span class="hljs-keyword">import</span> PlainTextResponse<br>app = FastAPI()<br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span>, response_class=PlainTextResponse</span>) </span><span class="hljs-comment"># å®šä¹‰response_class</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">main</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello World&quot;</span><br><span class="hljs-comment"># æºç </span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PlainTextResponse</span>(<span class="hljs-title class_ inherited__">Response</span>): <span class="hljs-comment"># ç»§æ‰¿</span><br>    media_type = <span class="hljs-string">&quot;text/plain&quot;</span> <span class="hljs-comment"># é‡å†™å±æ€§</span><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹2ï¼šHTMLResponseç”¨æ¥å“åº”HTMLé¡µé¢</p><ul><li>HTMLResponseæ˜¯Responseçš„å­ç±»ï¼Œé‡å†™media_type &#x3D; â€œtext&#x2F;htmlâ€</li><li>å°±å¯ä»¥ç›´æ¥è¿”å›HTMLResponseå¯¹è±¡ï¼Œç½‘é¡µæ¸²æŸ“HTMLæ ·å¼ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><span class="hljs-keyword">from</span> fastapi.responses <span class="hljs-keyword">import</span> HTMLResponse<br><br>app = FastAPI()<br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    html_content = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    &lt;html&gt;</span><br><span class="hljs-string">        &lt;head&gt;</span><br><span class="hljs-string">            &lt;title&gt;Some HTML in here&lt;/title&gt;</span><br><span class="hljs-string">        &lt;/head&gt;</span><br><span class="hljs-string">        &lt;body&gt;</span><br><span class="hljs-string">            &lt;h1&gt;Look ma! HTML!&lt;/h1&gt;</span><br><span class="hljs-string">        &lt;/body&gt;</span><br><span class="hljs-string">    &lt;/html&gt;</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> HTMLResponse(content=html_content, status_code=<span class="hljs-number">200</span>)<br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span>, response_class=HTMLResponse</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    &lt;html&gt;</span><br><span class="hljs-string">        &lt;head&gt;</span><br><span class="hljs-string">            &lt;title&gt;Some HTML in here&lt;/title&gt;</span><br><span class="hljs-string">        &lt;/head&gt;</span><br><span class="hljs-string">        &lt;body&gt;</span><br><span class="hljs-string">            &lt;h1&gt;Look ma! HTML!&lt;/h1&gt;</span><br><span class="hljs-string">        &lt;/body&gt;</span><br><span class="hljs-string">    &lt;/html&gt;</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br><span class="hljs-comment"># æºç </span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">HTMLResponse</span>(<span class="hljs-title class_ inherited__">Response</span>): <span class="hljs-comment"># ç»§æ‰¿</span><br>    media_type = <span class="hljs-string">&quot;text/html&quot;</span><span class="hljs-comment"># é‡å†™å±æ€§</span><br>    <br></code></pre></td></tr></table></figure><h1 id="11-5-ä¸‹è½½æ–‡ä»¶ç›¸å…³çš„Response"><a href="#11-5-ä¸‹è½½æ–‡ä»¶ç›¸å…³çš„Response" class="headerlink" title="11-5 ä¸‹è½½æ–‡ä»¶ç›¸å…³çš„Response"></a>11-5 ä¸‹è½½æ–‡ä»¶ç›¸å…³çš„Response</h1><p>ä¸‹è½½æ–‡ä»¶ç›¸å…³çš„å“åº”ç±»æœ‰ä¸¤ä¸ªï¼š</p><ul><li>StreamingResponse</li><li>FileResponse</li></ul><p>ç¤ºä¾‹1ï¼šStreamingResponseæ”¯æŒæ–‡ä»¶ç±»å‹çš„æ“ä½œï¼Œä¸‹è½½æ–‡ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><span class="hljs-keyword">from</span> fastapi.responses <span class="hljs-keyword">import</span> StreamingResponse<br><br>app = FastAPI()<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">iterfile</span>():  <span class="hljs-comment">#</span><br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;mybook.zip&quot;</span>, mode=<span class="hljs-string">&quot;rb&quot;</span>) <span class="hljs-keyword">as</span> f:  <span class="hljs-comment">#</span><br>            <span class="hljs-keyword">yield</span> <span class="hljs-keyword">from</span> f<br><br>    <span class="hljs-keyword">return</span> StreamingResponse(iterfile(), media_type=<span class="hljs-string">&quot;application/zip&quot;</span>)<br><span class="hljs-comment"># StreamingResponseä¹Ÿæ˜¯Response çš„å­ç±»</span><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹2ï¼šä½¿ç”¨FileResponse</p><ul><li>æ›´åŠ ç›´æ¥ï¼Œæ–‡ä»¶ä¸‹è½½</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><span class="hljs-keyword">from</span> fastapi.responses <span class="hljs-keyword">import</span> FileResponse<br><br>app = FastAPI()<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">index</span>():<br>    <span class="hljs-keyword">return</span> FileResponse(<span class="hljs-string">&quot;mybook.zip&quot;</span>, filename=<span class="hljs-string">&quot;book.zip&quot;</span>)<span class="hljs-comment"># ç¬¬ä¸€ä¸ªå‚æ•°æ–‡ä»¶è·¯å¾„ï¼ŒfilenameæŒ‡å®šä¸‹è½½ä¸‹æ¥çš„æ–‡ä»¶å</span><br><span class="hljs-comment"># FileResponseä¹Ÿæ˜¯Response çš„å­ç±»</span><br></code></pre></td></tr></table></figure><h1 id="11-6-å…¶ä»–Response"><a href="#11-6-å…¶ä»–Response" class="headerlink" title="11-6 å…¶ä»–Response"></a>11-6 å…¶ä»–Response</h1><p>ç¤ºä¾‹1ï¼šé‡å®šå‘Response</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><span class="hljs-keyword">from</span> fastapi.responses <span class="hljs-keyword">import</span> RedirectResponse<br><br>app = FastAPI()<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">go_to_baidu</span>():<br>    <span class="hljs-keyword">return</span> RedirectResponse(<span class="hljs-string">&quot;https://www.baidu.com&quot;</span>)<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹2ï¼šORJSONResponse</p><ul><li>ORJSONResponseæ˜¯ä¸€ä¸ªåŸºäºorjsonåºåˆ—åŒ–çš„å“åº”ç±»ï¼Œå®ƒåœ¨æ€§èƒ½ä¸Šè¦ç”±äºJSONResponse</li><li>ä½¿ç”¨æ˜¯éœ€è¦å®‰è£… <code>pip3 install orjson</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><span class="hljs-keyword">from</span> fastapi.responses <span class="hljs-keyword">import</span> ORJSONResponse<br><br>app = FastAPI()<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span>, response_class=ORJSONResponse</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">go_to_baidu</span>():<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;liuxu&quot;</span>&#125;<br></code></pre></td></tr></table></figure><p>è¡¥å……ï¼šç»§æ‰¿Responseï¼Œ æ¨¡ä»¿è€…å…¶ä»–å“åº”ç±»ï¼Œå®šä¹‰è‡ªå·±çš„å“åº”ç±»ï¼ˆè‡ªå·±å®ç°å§ï¼‰</p>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç¼–ç¨‹ï¼Œwebå¼€å‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€pythonã€‘FastAPIä¹‹ç™»å½•è®¤è¯ï¼ˆå…­ï¼‰</title>
    <link href="/2024/03/02/686FastAPI6%E4%B9%8B%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/"/>
    <url>/2024/03/02/686FastAPI6%E4%B9%8B%E7%99%BB%E5%BD%95%E8%AE%A4%E8%AF%81/</url>
    
    <content type="html"><![CDATA[<h1 id="9-1-ç”¨æˆ·æ³¨å†Œ"><a href="#9-1-ç”¨æˆ·æ³¨å†Œ" class="headerlink" title="9-1 ç”¨æˆ·æ³¨å†Œ"></a>9-1 ç”¨æˆ·æ³¨å†Œ</h1><p>å¯¹äºå¾ˆå¤šåº”ç”¨æ¥è¯´ï¼Œæ³¨å†Œæ¥å£æ˜¯å¿…å¯ä¸å°‘çš„ã€‚æƒ³è¦å®ç°æ³¨å†Œæ¥å£ï¼Œå…¶å®å¾ˆç®€å•ï¼Œä½†æ˜¯ä½ ä¼šå‘ç°ä¼šæœ‰å¾ˆå¤šç§é€‰æ‹©ï¼š</p><ul><li>æ³¨å†Œæ—¶æœ‰éœ€è¦å“ªäº›å­—æ®µï¼Ÿ</li><li>æ³¨å†Œæ¥å£ä½¿ç”¨ä»€ä¹ˆè¯·æ±‚æ–¹å¼ï¼Ÿ</li><li>å‰ç«¯æœåç«¯ä¼ æ•°æ®æ—¶ï¼Œæ”¾åœ¨æŸ¥è¯¢å‚æ•°ä¸­ã€è¯·æ±‚ä½“ä¸­ï¼Ÿ</li><li>å¦‚æœæ”¾åœ¨è¯·æ±‚ä½“ä¸­ï¼Œä½¿ç”¨JSONæ ¼å¼è¿˜æ˜¯è¡¨å•æ ¼å¼ï¼Ÿ</li></ul><p><strong>è§£å†³æ–¹å¼</strong></p><p>ä½ ä¼šå‘ç°å°±ä¸€ä¸ªç®€å•çš„æ³¨å†Œæ¥å£ï¼Œå…¶å®è¿˜æ˜¯æœ‰å¾ˆå¤šé—®é¢˜éœ€è¦æˆ‘ä»¬æ€è€ƒçš„ã€‚</p><ul><li><p>é¦–å…ˆï¼Œæ³¨å†Œæ¥å£ä¸€èˆ¬æ˜¯å°†ç”¨æˆ·çš„ä¸ªäººä¿¡æ¯æäº¤ç»™æœåŠ¡ç«¯ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬é€‰æ‹©POSTè¯·æ±‚</p></li><li><p>ç„¶åï¼Œæ³¨å†Œä¿¡æ¯ä¸­ä¸€èˆ¬éƒ½åŒ…å«å¯†ç ï¼Œæ‰€ä»¥ä¸èƒ½ç®€å•çš„åœ¨æŸ¥è¯¢å‚æ•°ä¸­æäº¤ç»™åç«¯ï¼Œéœ€è¦æŠŠæ•°æ®æ”¾åœ¨è¯·æ±‚ä½“ä¸­ã€‚</p></li><li><p>æœ€åï¼Œè¯·æ±‚ä½“å¦‚ä½•ä½¿ç”¨JSONæ ¼å¼ï¼Œé‚£æ³¨å†Œæ—¶å¦‚æœæœ‰ä¸Šä¼ æ–‡ä»¶çš„éœ€æ±‚ï¼Œå°†æ¯”è¾ƒéº»çƒ¦ã€‚å› æ­¤æˆ‘ä»¬ä½¿ç”¨Formè¡¨å•çš„å½¢å¼ã€‚</p></li></ul><p>ç»“è®ºï¼šå¯¹äºå¸¸è§çš„æ³¨å†Œæ¥å£ï¼Œä½¿ç”¨POSTï¼Œä½¿ç”¨Formè¡¨å•æ¥ä¸Šä¼ æ•°æ®ã€‚</p><p>è¡¥å……ï¼šä»»ä½•ä¸€ç§æ–¹å¼éƒ½å¯ä»¥å®ç°ï¼Œä½†æœ€ç»ˆå¦‚ä½•é€‰æ‹©è¿˜æ˜¯è¦çœ‹ä¸šåŠ¡éœ€æ±‚ã€‚</p><p>å‰ç«¯é¡µé¢ä»£ç </p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Title<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>æ³¨å†Œ<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;http://127.0.0.1:8000/register&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>ç”¨æˆ·å: <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>å¯†ç : <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>ç¡®è®¤å¯†ç : <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;re_password&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>é‚®ä»¶: <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;email&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;email&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><p><strong>åç«¯æ¥å£</strong></p><ul><li>æ³¨å†Œé€»è¾‘ï¼šåˆ¤æ–­ç”¨æˆ·åæ˜¯å¦å·²ç»æ³¨å†Œï¼›åˆ¤æ–­äºŒæ¬¡å¯†ç æ˜¯å¦ä¸€è‡´ã€‚</li><li>ç¼ºé™·ï¼šå¯†ç æ²¡æœ‰åŠ å¯†ï¼›æ•°æ®æ²¡æœ‰æŒä¹…åŒ–ï¼ˆå­˜æ•°æ®åº“ï¼‰ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Form, Depends, HTTPException<br><br>app = FastAPI(title=<span class="hljs-string">&quot;ç™»å½•è®¤è¯ç›¸å…³&quot;</span>)<br><br><span class="hljs-comment"># æ¨¡æ‹Ÿæ•°æ®åº“</span><br>USERS = &#123;&#125;<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_form_data</span>(<span class="hljs-params">username: <span class="hljs-built_in">str</span> = Form(<span class="hljs-params"></span>), password: <span class="hljs-built_in">str</span> = Form(<span class="hljs-params"></span>), re_password: <span class="hljs-built_in">str</span> = Form(<span class="hljs-params"></span>), email: <span class="hljs-built_in">str</span> = Form(<span class="hljs-params"></span>)</span>): <span class="hljs-comment"># Form()ä¾èµ–æ³¨å…¥</span><br>    <span class="hljs-keyword">return</span> &#123;<br>        <span class="hljs-string">&quot;username&quot;</span>: username,<br>        <span class="hljs-string">&quot;password&quot;</span>: password,<br>        <span class="hljs-string">&quot;re_password&quot;</span>: re_password,<br>        <span class="hljs-string">&quot;email&quot;</span>: email,<br>    &#125;<br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/register&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">register</span>(<span class="hljs-params">form_data: <span class="hljs-built_in">dict</span> = Depends(<span class="hljs-params">get_form_data</span>)</span>):<span class="hljs-comment"># Dependsä¾èµ–æ³¨å…¥</span><br>    <span class="hljs-comment"># åˆ¤æ–­ç”¨æˆ·åæ˜¯å¦å·²å­˜åœ¨</span><br>    <span class="hljs-keyword">if</span> form_data[<span class="hljs-string">&quot;username&quot;</span>] <span class="hljs-keyword">in</span> USERS:<br>        <span class="hljs-keyword">raise</span> HTTPException(detail=<span class="hljs-string">&quot;ç”¨æˆ·åå·²ç»å­˜åœ¨&quot;</span>, status_code=<span class="hljs-number">400</span>)<br>    <span class="hljs-comment"># åˆ¤æ–­å¯†ç æ˜¯å¦ä¸€è‡´</span><br>    <span class="hljs-keyword">if</span> form_data[<span class="hljs-string">&quot;password&quot;</span>] != form_data[<span class="hljs-string">&quot;re_password&quot;</span>]:<br>        <span class="hljs-keyword">raise</span> HTTPException(detail=<span class="hljs-string">&quot;ä¸¤æ¬¡å¯†ç è¾“å…¥ä¸ä¸€è‡´&quot;</span>, status_code=<span class="hljs-number">400</span>)<br>    <span class="hljs-comment"># ä¿å­˜ç”¨æˆ·ä¿¡æ¯ï¼Œå®Œæˆæ³¨å†Œ</span><br>    USERS[form_data[<span class="hljs-string">&quot;username&quot;</span>]] = form_data<br><br>    <span class="hljs-comment"># è¿”å›æ–°ç”¨æˆ·åŸºæœ¬ä¿¡æ¯</span><br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;username&quot;</span>: form_data[<span class="hljs-string">&quot;username&quot;</span>], <span class="hljs-string">&quot;email&quot;</span>: form_data[<span class="hljs-string">&quot;email&quot;</span>]&#125;<br></code></pre></td></tr></table></figure><h1 id="9-2-ç”¨æˆ·å¯†ç åŠ å¯†"><a href="#9-2-ç”¨æˆ·å¯†ç åŠ å¯†" class="headerlink" title="9-2 ç”¨æˆ·å¯†ç åŠ å¯†"></a>9-2 ç”¨æˆ·å¯†ç åŠ å¯†</h1><p>å­˜ç”¨æˆ·ä¿¡æ¯æ—¶ï¼Œä¸èƒ½æ˜æ–‡å­˜å‚¨ï¼Œä¸€å®šè¦åšåŠ å¯†å¤„ç†ã€‚</p><p>ç¤ºä¾‹1ï¼š ä½¿ç”¨pythonå†…ç½®åº“hasslib  æ‰€è°“çš„md5åŠ å¯†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> hashlib<br>m = hashlib.md5(<span class="hljs-string">&quot;ç›&quot;</span>.encode(<span class="hljs-string">&quot;utf-8&quot;</span>))<span class="hljs-comment"># æ”¯æŒåŠ ç›</span><br>m.update(<span class="hljs-string">&quot;hello&quot;</span>.encode(<span class="hljs-string">&quot;utf-8&quot;</span>))<br><br><span class="hljs-built_in">print</span>(m.digest())       <span class="hljs-comment"># åŠ å¯†åçš„äºŒè¿›åˆ¶æ–‡æœ¬</span><br><span class="hljs-built_in">print</span>(m.hexdigest())    <span class="hljs-comment"># ä»¥16è¿›åˆ¶å½¢å¼è¿”å›åŠ å¯†å†…å®¹</span><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹2ï¼šä½¿ç”¨ç¬¬ä¸‰æ–¹åº“ passlib</p><blockquote><p>pip install â€œpasslib[bcrypt]â€</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> passlib.context <span class="hljs-keyword">import</span> CryptContext<br><br>crypt = CryptContext(schemes=[<span class="hljs-string">&quot;bcrypt&quot;</span>], deprecated=<span class="hljs-string">&quot;auto&quot;</span>)<br><br>crypt.<span class="hljs-built_in">hash</span>(<span class="hljs-string">&quot;hello&quot;</span>)<span class="hljs-comment"># åŠ å¯†</span><br></code></pre></td></tr></table></figure><h1 id="9-3-é›†æˆMySQLçš„æ³¨å†Œ"><a href="#9-3-é›†æˆMySQLçš„æ³¨å†Œ" class="headerlink" title="9-3 é›†æˆMySQLçš„æ³¨å†Œ"></a>9-3 é›†æˆMySQLçš„æ³¨å†Œ</h1><p>ç¬¬ä¸€æ­¥ï¼šæ•°æ®æŒä¹…åŒ–</p><ul><li>æ–°å»ºç”¨æˆ·è¡¨</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mysql">CREATE TABLE `users` ( <br>    `id` int(11) NOT NULL AUTO_INCREMENT,<br>    `username` varchar(255) NOT NULL,<br>    `password` varchar(255) NOT NULL,<br>    `email` varchar(255) NOT NULL,<br>    PRIMARY KEY (`id`) # id ä¸»é”®<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin AUTO_INCREMENT=1 ;<br></code></pre></td></tr></table></figure><ul><li>ä½¿ç”¨SQLAlchemyçš„ORMæ“ä½œæ•°æ®åº“ï¼ˆåŸºäºä¹‹å‰çš„ä»£ç ç»“æ„ï¼Œå…¶ä»–æ¨¡å—ä»£ç è§æºæ–‡ä»¶ï¼‰</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Form, Depends, HTTPException<br><span class="hljs-keyword">from</span> sqlalchemy.orm <span class="hljs-keyword">import</span> Session<br><span class="hljs-keyword">from</span> passlib.context <span class="hljs-keyword">import</span> CryptContext<br><br><span class="hljs-keyword">from</span> database <span class="hljs-keyword">import</span> get_db<br><span class="hljs-keyword">from</span> models <span class="hljs-keyword">import</span> User<br><span class="hljs-keyword">from</span> schemas <span class="hljs-keyword">import</span> UserOut<br><br>app = FastAPI(title=<span class="hljs-string">&quot;ç™»å½•è®¤è¯ç›¸å…³&quot;</span>)<br><br><br>crypt = CryptContext(schemes=[<span class="hljs-string">&quot;bcrypt&quot;</span>], deprecated=<span class="hljs-string">&quot;auto&quot;</span>) <span class="hljs-comment"># å®ä¾‹åŒ–å¯¹è±¡ï¼Œç”¨è¿™ä¸ªå¯¹è±¡çš„hashæ–¹æ³•å»åŠ å¯†å¯†ç </span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserForm</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, username: <span class="hljs-built_in">str</span> = Form(<span class="hljs-params"></span>), password: <span class="hljs-built_in">str</span> = Form(<span class="hljs-params"></span>), re_password: <span class="hljs-built_in">str</span> = Form(<span class="hljs-params"></span>), email: <span class="hljs-built_in">str</span> = Form(<span class="hljs-params"></span>)</span>):<br>        self.username = username<br>        self.password = password<br>        self.re_password = re_password<br>        self.email = email<br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/register&quot;</span>, response_model=UserOut</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">register</span>(<span class="hljs-params">user: UserForm = Depends(<span class="hljs-params"></span>), db: Session = Depends(<span class="hljs-params">get_db</span>)</span>):<br>    <span class="hljs-comment"># æ³¨å†Œæ¥å£æ ¸å¿ƒéƒ¨åˆ†ï¼Œæ­¤éƒ¨åˆ†æ²¡æœ‰æ”¾åœ¨crud.pyæ–‡ä»¶ä¸­, å¯ä»¥è‡ªè¡Œå¤„ç†ä¸‹</span><br>    <span class="hljs-comment"># åˆ¤æ–­ç”¨æˆ·åæ˜¯å¦å­˜åœ¨</span><br>    <span class="hljs-keyword">if</span> db.query(User).<span class="hljs-built_in">filter</span>(User.username == user.username).first():<br>        <span class="hljs-keyword">raise</span> HTTPException(detail=<span class="hljs-string">&quot;ç”¨æˆ·åå·²å­˜åœ¨&quot;</span>, status_code=<span class="hljs-number">400</span>)<br>    <span class="hljs-keyword">if</span> user.password != user.re_password:<br>        <span class="hljs-keyword">raise</span> HTTPException(detail=<span class="hljs-string">&quot;ä¸¤æ¬¡å¯†ç è¾“å…¥ä¸ä¸€è‡´&quot;</span>, status_code=<span class="hljs-number">400</span>)<br><br>    <span class="hljs-comment"># æ–°å¢ç”¨æˆ·</span><br>    new_user = User(<br>        username=user.username,<br>        password=crypt.<span class="hljs-built_in">hash</span>(user.password),<span class="hljs-comment"># å¯†æ–‡å­˜å‚¨</span><br>        email=user.email<br>    )<br>    db.add(new_user) <span class="hljs-comment"># è¿™é‡Œä¿å­˜çš„åº”è¯¥å°±æ˜¯åŠ å¯†åçš„å¯†ç äº†ã€‚æ‰€ä»¥å‰é¢æ ¡éªŒæ˜¯å¦å­˜åœ¨çš„ä»£ç åº”è¯¥è¦åŠ å¯†ä¸€ä¸‹ï¼Ÿ</span><br>    db.commit()<br>    db.refresh(new_user)<br>    <span class="hljs-keyword">return</span> new_user<br></code></pre></td></tr></table></figure><h1 id="9-4-ç”¨æˆ·ç™»å½•"><a href="#9-4-ç”¨æˆ·ç™»å½•" class="headerlink" title="9-4 ç”¨æˆ·ç™»å½•"></a>9-4 ç”¨æˆ·ç™»å½•</h1><p>ç™»å½•æ¥å£çš„ä½œç”¨ï¼šé€šè¿‡ç”¨æˆ·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œæ‰¾åˆ°è¯¥ç”¨æˆ·åœ¨æœ¬ç½‘ç«™ä¸Šçš„åŸºæœ¬ä¿¡æ¯ã€‚</p><p>ç™»å½•æ¥å£çš„æ ¸å¿ƒé€»è¾‘ï¼šæ ¡éªŒç”¨æˆ·åå’Œå¯†ç æ˜¯å¦å’Œæ•°æ®åº“ä¸­ä¿å­˜çš„åƒåŒ¹é…ï¼ŒåŒ¹é…åˆ™ç™»å½•æˆåŠŸï¼Œå¦åˆ™å¤±è´¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/login&quot;</span>, response_model=UserOut</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">username: <span class="hljs-built_in">str</span> = Form(<span class="hljs-params"></span>), password: <span class="hljs-built_in">str</span> = Form(<span class="hljs-params"></span>), db: Session = Depends(<span class="hljs-params">get_db</span>)</span>):<br>    <span class="hljs-comment"># æ ¹æ®ç”¨æˆ·åæ‰¾è¯¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨</span><br>    db_user: User = db.query(User).filter_by(username=username).first()<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> db_user:<br>        <span class="hljs-keyword">raise</span> HTTPException(detail=<span class="hljs-string">&quot;ç”¨æˆ·åä¸å­˜åœ¨&quot;</span>, status_code=<span class="hljs-number">400</span>)<br>    <span class="hljs-comment"># ä½¿ç”¨crypt.verifyæ ¡éªŒå¯†ç æ˜¯å¦æ­£ç¡®</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> crypt.verify(password, db_user.password): <span class="hljs-comment"># è¿™é‡Œç”¨åˆ°çš„éªŒè¯å°±æ˜¯åŠ è§£å¯†çš„éªŒè¯</span><br>        <span class="hljs-keyword">raise</span> HTTPException(detail=<span class="hljs-string">&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;</span>, status_code=<span class="hljs-number">400</span>)<br>    <span class="hljs-keyword">return</span> db_user<br></code></pre></td></tr></table></figure><p><strong>è¡¥å……</strong>ï¼šæ ¡éªŒæ˜æ–‡å¯†ç å’Œæ•°æ®åº“ä¸­å¯†æ–‡å¯†ç åŒ¹é…çš„åŸç†</p><ul><li><p>hashçš„åŸç†ï¼šä½¿ç”¨ç›¸åŒçš„åŠ å¯†ç®—æ³•ï¼Œç›¸åŒçš„æ˜æ–‡åŠ å¯†åå¾—åˆ°ç›¸åŒçš„å¯†æ–‡ã€‚</p></li><li><p>æŠŠç”¨æˆ·çš„æ˜æ–‡å¯†ç é€šè¿‡ç›¸åŒçš„åŠ å¯†ç®—æ³•å¾—åˆ°çš„å¯†æ–‡ï¼Œå’Œæ•°æ®åº“ä¸­çš„å¯†æ–‡ç›¸æ¯”è¾ƒï¼Œç›¸åŒåˆ™è¯´æ˜å¯†ç æ­£ç¡®ã€‚</p></li></ul><h1 id="9-5-è®°å½•ç”¨æˆ·ç™»å½•çŠ¶æ€çš„æ–¹å¼"><a href="#9-5-è®°å½•ç”¨æˆ·ç™»å½•çŠ¶æ€çš„æ–¹å¼" class="headerlink" title="9-5 è®°å½•ç”¨æˆ·ç™»å½•çŠ¶æ€çš„æ–¹å¼"></a>9-5 è®°å½•ç”¨æˆ·ç™»å½•çŠ¶æ€çš„æ–¹å¼</h1><p><strong>éœ€æ±‚åœºæ™¯</strong></p><p>å¯¹äºç”µå•†è´­ç‰©ç½‘ç«™ï¼Œç½‘ç«™çŸ¥é“å½“å‰æµè§ˆç½‘ç«™çš„ç”¨æˆ·æ˜¯è°ï¼Œè¯¥ç”¨æˆ·è´­ç‰©è½¦æœ‰å“ªäº›å•†å“ï¼Œè¯¥ç”¨æˆ·ä¹°äº†å“ªäº›å•†å“ç­‰ç­‰ã€‚</p><p>è¿™äº›éœ€æ±‚çš„ä¸€ä¸ªæ ¸å¿ƒç‚¹å°±æ˜¯ï¼Œç½‘ç«™çš„æœåŠ¡ç«¯éœ€è¦çŸ¥é“å½“å‰ç”¨æˆ·æ˜¯è°ã€‚</p><p>é—æ†¾çš„æ˜¯ï¼ŒHTTPåè®®æ˜¯æ— çŠ¶æ€çš„ï¼Œå³æœåŠ¡ç«¯ä¸ä¼šè®°å½•å®¢æˆ·ç«¯çš„æ¯ä¸€æ¬¡è¯·æ±‚ï¼Œå³æ¯ä¸€ä¸ªè¯·æ±‚å¯¹æœåŠ¡ç«¯æ¥è¯´éƒ½æ˜¯ â€œé™Œç”Ÿäººâ€ã€‚</p><p><strong>è§£å†³æ–¹å¼</strong></p><p>è®¡ç®—æœºæœ¬èº«æ— æ³•åˆ¤æ–­ååœ¨æ˜¾ç¤ºå™¨å‰çš„ä½¿ç”¨è€…çš„èº«ä»½ã€‚è¿›ä¸€æ­¥è¯´ï¼Œä¹Ÿæ— æ³•ç¡®è®¤ç½‘ç»œçš„é‚£å¤´ç©¶ç«Ÿæœ‰è°ã€‚å¯è§ï¼Œä¸ºäº†å¼„æ¸…ç©¶ç«Ÿæ˜¯è°åœ¨è®¿é—®æœåŠ¡ å™¨ï¼Œå°±å¾—è®©å¯¹æ–¹çš„å®¢æˆ·ç«¯è‡ªæŠ¥å®¶é—¨ã€‚</p><p>è§£å†³æ–¹å¼ï¼šç”¨æˆ·ç™»å½•è®¤è¯ã€‚</p><p>æ ¸å¿ƒåŸç†ï¼šç”¨æˆ·ç™»å½•ä¹‹åå°±ç»™ç”¨æˆ·ä¸€ä¸ªèº«ä»½æ ‡è¯†ï¼Œå®¢æˆ·ç«¯å†æ¬¡è®¿é—®æœåŠ¡ç«¯æ—¶å¸¦ä¸Šè¿™ä¸ªèº«ä»½æ ‡è¯†ï¼Œé‚£æœåŠ¡ç«¯å°±çŸ¥é“è¯¥ç”¨æˆ·çš„èº«ä»½ã€‚â€”â€”<code>æ‰“æ ‡ç­¾</code></p><p>å¸¸ç”¨çš„å…·ä½“å®ç°æ–¹å¼ï¼š</p><ul><li><strong>è®©ç”¨æˆ·åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦å”¯ä¸€æ ‡è¯†</strong> tokenå°±æ¥äº†ï¼Œæ‰€è°“çš„ä»¤ç‰Œ</li><li>ä½¿ç”¨cookie</li><li>ä½¿ç”¨<strong>jwt</strong></li></ul><h1 id="9-6-ä½¿ç”¨è¯·æ±‚å¤´å®ç°ç™»å½•è®¤è¯"><a href="#9-6-ä½¿ç”¨è¯·æ±‚å¤´å®ç°ç™»å½•è®¤è¯" class="headerlink" title="9-6 ä½¿ç”¨è¯·æ±‚å¤´å®ç°ç™»å½•è®¤è¯"></a>9-6 ä½¿ç”¨è¯·æ±‚å¤´å®ç°ç™»å½•è®¤è¯</h1><p>åœ¨è¯·æ±‚å¤´ä¸­å®ç°ç™»å½•è®¤è¯çš„æ–¹å¼ï¼Œå…¶å®å¾ˆç®€å•ï¼Œå…·ä½“å®ç°é€»è¾‘å¦‚ä¸‹ï¼š</p><ul><li>å½“ç”¨æˆ·è®¿é—®åç«¯æœåŠ¡æ—¶ï¼Œåç«¯åˆ¤æ–­è¯·æ±‚å¤´ä¸­æ˜¯å¦æœ‰æŒ‡å®šçš„è¯·æ±‚å¤´é”®å€¼å¯¹ï¼Œæœ‰ä¸”æ­£ç¡®åˆ™è¯¥ç”¨æˆ·æ˜¯ç™»å½•è¿‡çš„ã€‚</li><li>å¦‚æœè¯·æ±‚å¤´ä¸­æ²¡æœ‰æŒ‡å®šçš„é”®å€¼å¯¹ï¼Œåˆ™æ˜¯æ— æ•ˆçš„è¯·æ±‚ã€‚</li></ul><p>ç¤ºä¾‹ï¼šè¯·æ±‚å¤´ä¸­æœ‰åˆæ³•çš„é”®å€¼å¯¹æ‰å¯ä»¥è·å–è®¿é—®çš„å›¾ä¹¦ä¿¡æ¯ã€‚</p><ul><li>å½“è¯·æ±‚ä¸­æ²¡æœ‰ x-tokenæ—¶ï¼Œæˆ–è€…å®ƒçš„å€¼ä¸æ˜¯æŒ‡å®šçš„åˆæ³•tokenæ—¶ï¼Œéƒ½æ ¡éªŒä¼šæ ¡éªŒå¤±è´¥ï¼Œå¾—ä¸åˆ°æ•°æ®ã€‚</li><li>ç”¨æˆ·åœ¨ç™»å½•ä¹‹åæ‰èƒ½è·å¾—ä¸€ä¸ªx-tokenï¼Œç„¶åè¯·æ±‚å…¶ä»–æ¥å£æ—¶åœ¨è¯·æ±‚å¤´ä¸­æºå¸¦è€…x-tokenæ‰èƒ½è·å–æ•°æ®ã€‚</li><li>å³åªæœ‰æºå¸¦è¿™ä¸ªæ­£ç¡®çš„x-tokenæ‰æ˜¯ç»è¿‡ç™»å½•è®¤è¯çš„ç”¨æˆ·ï¼Œæ‰å…è®¸è·å–æ•°æ®ã€‚æœ‰ä»¤ç‰Œï¼Œç•…é€šæ— é˜»</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python">X_TOKEN = <span class="hljs-string">&quot;SDNQOEFJQIEVNFWESCVMWE&quot;</span><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/login&quot;</span>, response_model=UserOut</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">response: Response,  username: <span class="hljs-built_in">str</span> = Form(<span class="hljs-params"></span>), password: <span class="hljs-built_in">str</span> = Form(<span class="hljs-params"></span>), db: Session = Depends(<span class="hljs-params">get_db</span>)</span>):<br>    db_user: User = db.query(User).filter_by(username=username).first()<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> db_user:<br>        <span class="hljs-keyword">raise</span> HTTPException(detail=<span class="hljs-string">&quot;ç”¨æˆ·åä¸å­˜åœ¨&quot;</span>, status_code=<span class="hljs-number">400</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> crypt.verify(password, db_user.password):<br>        <span class="hljs-keyword">raise</span> HTTPException(detail=<span class="hljs-string">&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;</span>, status_code=<span class="hljs-number">400</span>)<br>       <br>    <span class="hljs-comment"># ä¹‹å‰æœ‰ä»‹ç»çš„å¦‚ä½•è®¾ç½®å“åº”å¤´ï¼Œå…¶å®å°±æ˜¯è°ƒresponseçš„headres </span><br>    response.headers[<span class="hljs-string">&quot;x-token&quot;</span>] = X_TOKEN<br>    <span class="hljs-keyword">return</span> db_user<br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/books&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">books</span>(<span class="hljs-params">x_token: typing.<span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = Header(<span class="hljs-params"></span>)</span>):<br>    <span class="hljs-keyword">if</span> x_token <span class="hljs-keyword">and</span> x_token == X_TOKEN: <span class="hljs-comment"># åœ¨åˆ¤æ–­x_tokenæ˜¯å¦å­˜åœ¨ï¼Œä¸”åˆ¤æ–­x_tokenæ˜¯å¦ç­‰äºæˆ‘ä»¬è®¾å®šçš„X_TOKEN </span><br>        <span class="hljs-keyword">return</span> [&#123;<span class="hljs-string">&quot;id&quot;</span>: i, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">f&quot;book<span class="hljs-subst">&#123;i&#125;</span>&quot;</span>&#125; <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">11</span>)] <span class="hljs-comment"># æ˜¯å°±è¿”å›æ•°æ®ï¼Œ</span><br>    <br>    <span class="hljs-keyword">raise</span> HTTPException(detail=<span class="hljs-string">&quot;Invalid x_token&quot;</span>, status_code=<span class="hljs-number">404</span>) <span class="hljs-comment"># ä¸æ˜¯å°±æŠ¥é”™</span><br></code></pre></td></tr></table></figure><h1 id="9-7-ä½¿ç”¨Cookieå®ç°ç™»å½•è®¤è¯ã€æµè§ˆå™¨ã€‘"><a href="#9-7-ä½¿ç”¨Cookieå®ç°ç™»å½•è®¤è¯ã€æµè§ˆå™¨ã€‘" class="headerlink" title="9-7 ä½¿ç”¨Cookieå®ç°ç™»å½•è®¤è¯ã€æµè§ˆå™¨ã€‘"></a>9-7 ä½¿ç”¨Cookieå®ç°ç™»å½•è®¤è¯ã€æµè§ˆå™¨ã€‘</h1><p><strong>Cookie</strong></p><ul><li>å‚¨å­˜åœ¨ç”¨æˆ·<strong>æœ¬åœ°ç»ˆç«¯ä¸Š</strong>çš„æ•°æ® ï¼ˆ<code>åœ¨ç”¨æˆ·è®¾å¤‡ä¸Šç”Ÿæˆçš„ä¸€ä¸ªæ–‡ä»¶</code>ï¼‰</li><li>Cookieæ˜¯ä¸€æ®µä¸è¶…è¿‡<strong>4KBçš„å°å‹æ–‡æœ¬æ•°æ®</strong>ï¼Œç”±ä¸€ä¸ªåç§°ï¼ˆNameï¼‰ã€ä¸€ä¸ªå€¼ï¼ˆValueï¼‰å’Œå…¶å®ƒå‡ ä¸ªç”¨äºæ§åˆ¶Cookieæœ‰æ•ˆæœŸã€å®‰å…¨æ€§ã€ä½¿ç”¨èŒƒå›´çš„å¯é€‰å±æ€§ç»„æˆ</li><li>åªè¦æ˜¯æœ‰æ•ˆçš„Cookieï¼Œæµè§ˆå™¨ä¸‹æ¬¡è®¿é—®æœåŠ¡å™¨æ—¶ï¼Œå°±ä¼šåœ¨è¯·æ±‚ä¸­æºå¸¦cookieæ–‡æœ¬ä¸­çš„æ•°æ®ã€‚</li></ul><p>ç¤ºä¾‹1ï¼šè·å–å’Œè®¾ç½®cookie</p><ul><li>åœ¨è°·æ­Œæµè§ˆå™¨ä¸­æ‰“å¼€F12æŸ¥çœ‹NetWorkå’ŒApplicationsä¸­çš„Cookies</li><li>set_cookieæ—¶å¯ä»¥valueå¯ä»¥æ˜¯ä¸€ä¸ªå•çº¯çš„å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªè¢«jsonåºåˆ—åŒ–çš„çš„Pythonæ•°æ®ç»“æ„ï¼Œæ¯”å¦‚å­—å…¸ã€‚</li></ul><p><img src="/img/fastapi/cookie.png" alt="cookie"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Response, Cookie<br><br><br>app = FastAPI()<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/set&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">set_cookie</span>(<span class="hljs-params">response: Response</span>):<br>    <span class="hljs-comment"># è®¾ç½®cookie, éœ€è¦ keyå’Œvalueï¼Œè¿˜å¯ä»¥è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆå•ä½:ç§’ï¼‰</span><br>    response.set_cookie(<span class="hljs-string">&quot;x_token&quot;</span>, <span class="hljs-string">&quot;you_auth_token&quot;</span>, <span class="hljs-number">60</span> * <span class="hljs-number">60</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;success&quot;</span><br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/get&quot;</span></span>)</span><br><span class="hljs-comment"># è·å–cookie, Cookie()çš„ç”¨æ³•å’ŒPath()\Header()ç­‰ç±»ä¼¼</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_cookie</span>(<span class="hljs-params">x_token: <span class="hljs-built_in">str</span> = Cookie(<span class="hljs-params"></span>)</span>):    <br>    <span class="hljs-keyword">return</span> &#123;<br>        <span class="hljs-string">&quot;x-token&quot;</span>: x_token<br>    &#125;<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹2ï¼šä½¿ç”¨cookieåšç™»å½•è®¤è¯</p><ul><li>ç™»å½•æ—¶è®¾ç½®cookieï¼Œä½¿ç”¨ç”¨æˆ·åå½“cookieçš„å€¼</li><li>è®¿é—®å›¾ä¹¦èµ„æºæ—¶ï¼Œæºå¸¦cookie, é€šè¿‡cookieä¸­çš„ç”¨æˆ·åï¼Œå¯ä»¥çŸ¥é“å½“å‰ç”¨æˆ·çš„èº«ä»½ä¿¡æ¯</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span>  Cookie, Response<br><br>...<br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/login&quot;</span>, response_model=UserOut</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">response: Response,  username: <span class="hljs-built_in">str</span> = Form(<span class="hljs-params"></span>), password: <span class="hljs-built_in">str</span> = Form(<span class="hljs-params"></span>), db: Session = Depends(<span class="hljs-params">get_db</span>)</span>):<br>    db_user: User = db.query(User).filter_by(username=username).first()<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> db_user:<br>        <span class="hljs-keyword">raise</span> HTTPException(detail=<span class="hljs-string">&quot;ç”¨æˆ·åä¸å­˜åœ¨&quot;</span>, status_code=<span class="hljs-number">400</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> crypt.verify(password, db_user.password):<br>        <span class="hljs-keyword">raise</span> HTTPException(detail=<span class="hljs-string">&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;</span>, status_code=<span class="hljs-number">400</span>)<br><br>    <span class="hljs-comment"># åœ¨å“åº”ä¸­è®¾ç½®cookie,</span><br>    response.set_cookie(<span class="hljs-string">&quot;x_token&quot;</span>, db_user.username, <span class="hljs-number">60</span> * <span class="hljs-number">60</span>)<br>    <span class="hljs-keyword">return</span> db_user<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/books&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">books</span>(<span class="hljs-params">x_token: typing.<span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = Cookie(<span class="hljs-params"></span>),  db: Session = Depends(<span class="hljs-params">get_db</span>)</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> x_token:<br>        <span class="hljs-keyword">raise</span> HTTPException(detail=<span class="hljs-string">&quot;Invalid x_token&quot;</span>, status_code=<span class="hljs-number">404</span>)<br>     <br>    db_user: User = db.query(User).filter_by(username=x_token).first()<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> db_user:<br>        <span class="hljs-keyword">raise</span> HTTPException(detail=<span class="hljs-string">&quot;Invalid x_token&quot;</span>, status_code=<span class="hljs-number">404</span>)<br>    <br>    <span class="hljs-keyword">return</span> [&#123;<span class="hljs-string">&quot;id&quot;</span>: i, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">f&quot;book<span class="hljs-subst">&#123;i&#125;</span>&quot;</span>&#125; <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">11</span>)]<br></code></pre></td></tr></table></figure><p>Cookieçš„ä¼˜ç‚¹å’Œç¼ºç‚¹ï¼š æ˜¯ä¸€ä¸ªæ–‡ä»¶</p><ul><li>ä¼˜ç‚¹ï¼šç®€å•æ–¹ä¾¿</li><li>ç¼ºç‚¹ï¼šä¸å®‰å…¨ï¼Œcookieä¿¡æ¯å¯èƒ½è¢«ç¯¡æ”¹ã€‚</li></ul><h1 id="9-8-ä½¿ç”¨jwtç™»å½•è®¤è¯-ç†è®ºç¯‡ã€ä¸»æµä½¿ç”¨ã€‘"><a href="#9-8-ä½¿ç”¨jwtç™»å½•è®¤è¯-ç†è®ºç¯‡ã€ä¸»æµä½¿ç”¨ã€‘" class="headerlink" title="9-8 ä½¿ç”¨jwtç™»å½•è®¤è¯-ç†è®ºç¯‡ã€ä¸»æµä½¿ç”¨ã€‘"></a>9-8 ä½¿ç”¨jwtç™»å½•è®¤è¯-ç†è®ºç¯‡ã€ä¸»æµä½¿ç”¨ã€‘</h1><p>ä½¿ç”¨Cookieçš„æ–¹å¼åšç™»å½•è®¤è¯ï¼Œç®€å•æ–¹ä¾¿ï¼Œä½†æ˜¯å­˜åœ¨å®‰å…¨éšæ‚£ï¼Œä¸€èˆ¬è¿˜ä¸æ¨èä½¿ç”¨ã€‚</p><p>Cookieä¹‹æ‰€ä»¥ä¸å®‰å…¨çš„æ ¹æœ¬åŸå› æ˜¯ï¼šç”¨æˆ·ä¿¡æ¯ç›´æ¥å­˜æ”¾åœ¨<strong>æµè§ˆå™¨</strong>ï¼Œåœ¨ç½‘ç»œä¼ è¾“ä¸­æ—¢æœ‰å¯èƒ½è¢«<strong>éæ³•ç¯¡æ”¹</strong>ã€‚</p><p><strong>æ‰€ä»¥ï¼Œåæ¥å‡ºç°äº†æŠŠç”¨æˆ·ä¿¡æ¯å­˜æ”¾åœ¨æœåŠ¡å™¨ç«¯çš„æŠ€æœ¯Session</strong>ï¼Œä¸è¿‡sessionä¹Ÿå°±åŸºäºcookieå®ç°çš„ã€‚</p><ul><li>Sessionçš„å¤„ç†é€»è¾‘å¦‚ä¸‹ï¼š</li><li>ç”¨æˆ·ç™»å½•æˆåŠŸåï¼ŒæœåŠ¡ç«¯ä¼šå°†ç”¨æˆ·çš„èº«ä»½ä¿¡æ¯ï¼ˆç”¨æˆ·ID, é‚®ç®±ç­‰å”¯ä¸€ä¿¡æ¯ï¼‰åŠ å¯†æˆä¸€ä¸ªéšæœºå­—ç¬¦ä¸²sessionidï¼Œå°†sessionidå’Œç”¨æˆ·ä¿¡æ¯åšä¸€ä¸ªæ˜ å°„å…³ç³»ï¼Œå­˜åœ¨æœåŠ¡å™¨çš„æ•°æ®åº“ä¸­ã€‚</li><li>ç„¶åï¼ŒæŠŠsessionidè¿”å›ç»™æµè§ˆå™¨ï¼Œä¿å­˜åœ¨cookieä¸­ï¼Œæ‰€ä»¥sessionæŠ€æœ¯æ˜¯åŸºäºcookieçš„ã€‚</li><li>æœ€åï¼Œå½“æµè§ˆå†æ¬¡è¯·æ±‚æœåŠ¡å™¨æ—¶ï¼Œæºå¸¦è¿™ä¸ªsessionidã€‚æœåŠ¡ç«¯ä¼šæ ¡éªŒè¿™ä¸ªsessionæ˜¯å¦åœ¨æ•°æ®åº“ä¸­æœ‰å…³è”ç”¨æˆ·ï¼Œä»¥åŠæ˜¯å¦è¿‡æœŸç­‰æ ¡éªŒï¼Œæ ¡éªŒé€šè¿‡åæ‰æ˜¯åˆæ³•ç”¨æˆ·ï¼Œæ‰å¯ä»¥è·å–è¯·æ±‚æ•°æ®ã€‚</li></ul><p>ä½†æ˜¯ï¼ŒsessionæŠ€æœ¯å› ä¸ºéœ€è¦æŠŠä¿¡æ¯å­˜æ”¾åœ¨æœåŠ¡å™¨ï¼Œè¿™æ ·ä¼šé€ æˆç»´æŠ¤æˆæœ¬é«˜ï¼Œä¸”ä¸å®¹æ˜“åšåˆ†å¸ƒå¼æœåŠ¡ã€‚å¹¶ä¸”ï¼Œä¸€æ—¦sessionidæ³„éœ²ï¼Œä¹Ÿæ˜¯ä¸å®‰å…¨çš„ã€‚</p><p><img src="/img/fastapi/image-20220728212753754.png" alt="image-20220728212753754"></p><p>å› ä¸ºsessionidçš„é™åˆ¶ï¼Œåæ¥åˆå‡ºç°äº†ç›®å‰æ¯”è¾ƒæµè¡Œçš„è§£å†³æ–¹æ¡ˆï¼Œé‚£å°±æ˜¯ <strong>JWTï¼ˆjson web tokenï¼‰</strong></p><blockquote><p> Token: æ˜¯ä¸€ä¸ªå¹¿ä¹‰çš„è¯ï¼Œæ˜¯ä»¤ç‰Œçš„æ„æ€</p><p> ç¬¬ä¸€ç§ï¼š åœ¨è¯·æ±‚å¤´åŒ…å«tokenï¼Œè¿™æ ·çš„åšæ³•å°±æ˜¯æš´éœ²äº†</p><p> ç¬¬äºŒç§ï¼šåœ¨cookieä¸Šä¿ç•™token</p><p> ç¬¬ä¸‰ç§ï¼šåœ¨cookieä¸Šä¿ç•™JWT ï¼ŒJWTç‰¹æ®ŠåŠ å¯†ï¼ŒåŒ…å«ä¸‰éƒ¨åˆ†ï¼Œå¤´éƒ¨ã€è´Ÿè½½ã€ç­¾å è´Ÿè½½å°±æ˜¯ç”¨æˆ·çš„ä¿¡æ¯ï¼Œåªä¸è¿‡æ˜¯åŠ å¯†è¿‡åçš„ç”¨æˆ·ä¿¡æ¯ï¼Œ</p><p> å°†ç”¨æˆ·çš„ä¿¡æ¯åŠ å¯†åä¿å­˜åœ¨cookieä¸Šæˆä¸€ä¸²JWTé”®å€¼å¯¹ï¼Œcookieæ˜¯ä¸€ä¸ªå°æ–‡ä»¶ä¿å­˜åœ¨æµè§ˆå™¨ä¸Šï¼Œä¸‹æ¬¡è¯·æ±‚çš„æ—¶å€™ï¼Œå°±ä¼šå¸¦ä¸Šè¿™ä¸ªJWTå»è¯·æ±‚åæ®µï¼Œå°±ä¼šé€šè¿‡éªŒè¯ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å°†è¿™ä¸ªJWT tokenæ”¾åœ¨è¯·æ±‚å¤´ä¸Šï¼Œéƒ½å¯ä»¥</p></blockquote><p>JWTçš„ç”Ÿæˆtokenæ ¼å¼å¦‚ä¸‹ï¼Œç”± <code>.</code> è¿æ¥çš„ä¸‰æ®µå­—ç¬¦ä¸²ç»„æˆã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># eyjJhbGciOiJqUadI1ASiIsInR5cCI6IkpXC8.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c</span><br></code></pre></td></tr></table></figure><p>JWT tokenæ˜¯å¦‚ä½•ç­¾å‘æµç¨‹ï¼š</p><ul><li>ç¬¬ä¸€æ®µHEADERéƒ¨åˆ†ï¼Œå›ºå®šåŒ…å«ç®—æ³•å’Œtokenç±»å‹ï¼Œå¯¹æ­¤åšJSONåºåˆ—åŒ–å¹¶è¿›è¡Œbase64urlåŠ å¯†ã€‚</li></ul><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs py">&#123;<span class="hljs-string">&quot;alg&quot;</span>: <span class="hljs-string">&quot;HS256&quot;</span>,  <span class="hljs-string">&quot;typ&quot;</span>: <span class="hljs-string">&quot;JWT&quot;</span>&#125;<br></code></pre></td></tr></table></figure><ul><li>ç¬¬äºŒæ®µPAYLOADéƒ¨åˆ†ï¼ŒåŒ…å«ä¸€äº›æ•°æ®ï¼Œå¯¹æ­¤åšJSONåºåˆ—åŒ–å¹¶è¿›è¡Œbase64urlåŠ å¯†ã€‚ï¼ˆpayloadsï¼šæœ‰æ•ˆè½½è· æ‹å–½å¾—ï¼‰</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;<span class="hljs-string">&quot;sub&quot;</span>: <span class="hljs-string">&quot;1234567890&quot;</span>, <span class="hljs-string">&quot;user_id&quot;</span>: <span class="hljs-number">20202</span>, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;liuxu&quot;</span>,  <span class="hljs-string">&quot;email&quot;</span>: <span class="hljs-string">&quot;liuxu@as.com&quot;</span>  ...&#125;<br></code></pre></td></tr></table></figure><p>ç¬¬ä¸‰æ®µSIGNATUREéƒ¨åˆ†ï¼ŒæŠŠå‰ä¸¤æ®µé€šè¿‡<code>.</code>æ‹¼æ¥èµ·æ¥ï¼Œç„¶åå¯¹å…¶è¿›è¡Œ<code>HS256</code>åŠ å¯†ï¼Œå†ç„¶åå¯¹<code>hs256</code>å¯†æ–‡è¿›è¡Œbase64urlåŠ å¯†ï¼Œæœ€ç»ˆå¾—åˆ°tokençš„ç¬¬ä¸‰æ®µã€‚å¯¹<code>hs256</code>åŠ å¯†æ—¶ä¸€èˆ¬ä¼šåšåŠ ç›å¤„ç†ã€‚ï¼ˆsignaturesï¼šç­¾å sinå‘¢ç¼ºï¼‰</p><p>æœ€åå°†ä¸‰æ®µå­—ç¬¦ä¸²é€šè¿‡ <code>.</code>æ‹¼æ¥èµ·æ¥å°±ç”Ÿæˆäº†jwtçš„tokenã€‚</p><p>JWT tokençš„æ ¡éªŒå’Œæå–ç”¨æˆ·ä¿¡æ¯æµç¨‹ï¼š</p><ul><li>ä¸ç­¾å‘æµç¨‹ç›¸å</li></ul><h1 id="9-9-ä½¿ç”¨jwtç™»å½•è®¤è¯-å®ç°"><a href="#9-9-ä½¿ç”¨jwtç™»å½•è®¤è¯-å®ç°" class="headerlink" title="9-9 ä½¿ç”¨jwtç™»å½•è®¤è¯-å®ç°"></a>9-9 ä½¿ç”¨jwtç™»å½•è®¤è¯-å®ç°</h1><ul><li>ä½¿ç”¨ç¬¬ä¸‰æ–¹æ¨¡å—å®ç° jwttokençš„ç”Ÿæˆå’Œæ ¡éªŒï¼Œä½¿ç”¨å‰å…ˆä¸‹è½½å®‰è£…ï¼š<code>pip3 install pyjwt</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> jwt<br><br><br>secret_key = <span class="hljs-string">&quot;åŠ ç›çš„ç§˜é’¥&quot;</span><br>data = &#123;<span class="hljs-string">&quot;user_id&quot;</span>: <span class="hljs-number">20202</span>, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;liuxu&quot;</span>,  <span class="hljs-string">&quot;email&quot;</span>: <span class="hljs-string">&quot;liuxu@as.com&quot;</span>&#125;<br><br><br><span class="hljs-comment"># ç”Ÿæˆjwttoken</span><br>jwt_token = jwt.encode(payload=data, key=secret_key)<br><span class="hljs-built_in">print</span>(jwt_token)<br><br><span class="hljs-comment"># è§£æjwttokenå¾—åˆ°ç”¨æˆ·ä¿¡æ¯</span><br>raw_data = jwt.decode(jwt_token, key=secret_key, algorithms=<span class="hljs-string">&quot;HS256&quot;</span>)<br><span class="hljs-built_in">print</span>(raw_data)<br></code></pre></td></tr></table></figure><p>ä»£ç è§£æï¼š</p><ul><li>ä½¿ç”¨ <code>jwt.encode()</code>ç­¾å‘token</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">encode</span>(<span class="hljs-params"></span><br><span class="hljs-params">    self,</span><br><span class="hljs-params">    payload: <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>],<span class="hljs-comment"># æ˜¯éœ€è¦åŠ å¯†çš„ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼Œæ¯”å¦‚idç­‰ï¼Œä¸è¦æŠŠç”¨æˆ·å¯†ç æ”¾åœ¨é‡Œé¢</span></span><br><span class="hljs-params">    key: <span class="hljs-built_in">str</span>,   <span class="hljs-comment"># åŠ å¯†æ—¶ä½¿ç”¨çš„ç§˜é’¥ï¼Œè§£å¯†æ—¶ä¹Ÿéœ€è¦å®ƒ</span></span><br><span class="hljs-params">    algorithm: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-string">&quot;HS256&quot;</span>,<span class="hljs-comment"># åŠ å¯†çš„ç®—æ³•ï¼Œé»˜è®¤æ˜¯HS256ï¼Œè§£å¯†æ—¶éœ€è¦ä½¿ç”¨ç›¸åŒçš„ç®—æ³•</span></span><br><span class="hljs-params">    headers: <span class="hljs-type">Optional</span>[<span class="hljs-type">Dict</span>] = <span class="hljs-literal">None</span>,<span class="hljs-comment"># jwttokenä¸­çš„ç¬¬ä¸€éƒ¨åˆ†ï¼Œä¸æŒ‡å®šæ—¶é»˜è®¤æ˜¯&#123;&quot;typ&quot;: &quot;JWT&quot;, &quot;alg&quot;: algorithm&#125;</span></span><br><span class="hljs-params">    json_encoder: <span class="hljs-type">Optional</span>[<span class="hljs-type">Type</span>[json.JSONEncoder]] = <span class="hljs-literal">None</span>,</span><br><span class="hljs-params"></span>) -&gt; <span class="hljs-built_in">str</span>:<br>    <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ <code>jwt.decode</code>è§£ætoken</li></ul><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">decode</span>(<span class="hljs-params"></span><br><span class="hljs-params">    self,</span><br><span class="hljs-params">    jwt: <span class="hljs-built_in">str</span>,<span class="hljs-comment"># jwt token</span></span><br><span class="hljs-params">    key: <span class="hljs-built_in">str</span> = <span class="hljs-string">&quot;&quot;</span>,      <span class="hljs-comment"># åŠ å¯†æ—¶ä½¿ç”¨çš„ç§˜é’¥</span></span><br><span class="hljs-params">    algorithms: <span class="hljs-type">Optional</span>[<span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>]] = <span class="hljs-literal">None</span>,   <span class="hljs-comment"># åŠ å¯†æ—¶ä½¿ç”¨çš„ç®—æ³•ï¼Œå¿…é¡»è®¾ç½®</span></span><br><span class="hljs-params">    options: <span class="hljs-type">Optional</span>[<span class="hljs-type">Dict</span>] = <span class="hljs-literal">None</span>,</span><br><span class="hljs-params">    **kwargs,</span><br><span class="hljs-params"></span>) -&gt; <span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-type">Any</span>]:<br>    <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure><ul><li>ç»™tokenè®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œåœ¨payloadä¸­å¢åŠ <code>exp</code>å­—æ®µï¼Œå®ƒçš„å€¼æ˜¯ä¸€ä¸ªdatetimeå¯¹è±¡æˆ–è€…æ—¶é—´æˆ³ exp:expired</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> jwt<br><span class="hljs-keyword">import</span> datetime<br><br>secret_key = <span class="hljs-string">&quot;åŠ ç›çš„ç§˜é’¥&quot;</span><br>data = &#123;<span class="hljs-string">&quot;user_id&quot;</span>: <span class="hljs-number">20202</span>, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;liuxu&quot;</span>, <span class="hljs-string">&quot;email&quot;</span>: <span class="hljs-string">&quot;liuxu@as.com&quot;</span>,<br>        <span class="hljs-string">&quot;exp&quot;</span>: datetime.datetime.now() + datetime.timedelta(days=<span class="hljs-number">1</span>)&#125;<br><br><br>jwt_token = jwt.encode(payload=data, key=secret_key)<br>raw_data = jwt.decode(jwt_token, key=secret_key, algorithms=<span class="hljs-string">&quot;HS256&quot;</span>)<br><span class="hljs-built_in">print</span>(raw_data)<br></code></pre></td></tr></table></figure><ul><li>æ ¡éªŒtokenå¤±è´¥æ—¶çš„å¤„ç†</li><li>jwtåº“ä¸­æä¾›äº†éå¸¸å¤šäº†æ ¡éªŒå¤±è´¥çš„é”™è¯¯ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚æˆ–è€…ç›´æ¥ä½¿ç”¨Exceptionä¹Ÿå¯ä»¥ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> jwt<br><span class="hljs-keyword">import</span> datetime<br><br>secret_key = <span class="hljs-string">&quot;åŠ ç›çš„ç§˜é’¥&quot;</span><br>data = &#123;<span class="hljs-string">&quot;user_id&quot;</span>: <span class="hljs-number">20202</span>, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;liuxu&quot;</span>, <span class="hljs-string">&quot;email&quot;</span>: <span class="hljs-string">&quot;liuxu@as.com&quot;</span>,<br>        <span class="hljs-string">&quot;exp&quot;</span>: datetime.datetime.now() + datetime.timedelta(days=-<span class="hljs-number">1</span>)&#125;<br><br><br>jwt_token = jwt.encode(payload=data, key=secret_key)<br><span class="hljs-keyword">try</span>:<br>    raw_data = jwt.decode(jwt_token, key=secret_key, algorithms=<span class="hljs-string">&quot;HS256&quot;</span>)<br>    <span class="hljs-built_in">print</span>(raw_data)<br><span class="hljs-keyword">except</span> jwt.ExpiredSignatureError <span class="hljs-keyword">as</span> e:<br>    <span class="hljs-built_in">print</span>(e)<br></code></pre></td></tr></table></figure><h1 id="9-10-fastapié›†æˆjwt"><a href="#9-10-fastapié›†æˆjwt" class="headerlink" title="9-10 fastapié›†æˆjwt"></a>9-10 fastapié›†æˆjwt</h1><p>éœ€æ±‚ï¼šä½¿ç”¨jwtåšç™»å½•æ ¡éªŒï¼Œåœ¨ç™»å½•æˆåŠŸåç»™ç”¨æˆ·ç­¾å‘jwttokenï¼Œåœ¨å›¾ä¹¦æ¥å£ä¸­æ ¡éªŒjwttoken, æ ¡éªŒå¤±è´¥åˆ™æŠ¥é”™ï¼Œæ ¡éªŒæˆåŠŸè¿”å›æ•°æ®</p><p>ç¤ºä¾‹1ï¼šä½¿ç”¨pyjwt</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># main.py</span><br><span class="hljs-keyword">import</span> jwt<br><span class="hljs-keyword">import</span> datetime<br><br><br>JWT_SECRET_KEY = <span class="hljs-string">&quot;ASDN*^n23^$:_&#125;;pYz7I&quot;</span><br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/login&quot;</span>, response_model=UserOut</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">response: Response,  username: <span class="hljs-built_in">str</span> = Form(<span class="hljs-params"></span>), password: <span class="hljs-built_in">str</span> = Form(<span class="hljs-params"></span>), db: Session = Depends(<span class="hljs-params">get_db</span>)</span>):<br>    db_user: User = db.query(User).filter_by(username=username).first()<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> db_user:<br>        <span class="hljs-keyword">raise</span> HTTPException(detail=<span class="hljs-string">&quot;ç”¨æˆ·åä¸å­˜åœ¨&quot;</span>, status_code=<span class="hljs-number">400</span>)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> crypt.verify(password, db_user.password):<br>        <span class="hljs-keyword">raise</span> HTTPException(detail=<span class="hljs-string">&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;</span>, status_code=<span class="hljs-number">400</span>)<br><br>    <span class="hljs-comment"># ç­¾å‘jwttoken, å¹¶ä¿å­˜åœ¨å“åº”å¤´ä¸Š</span><br>    exp = datetime.datetime.now() + datetime.timedelta(days=<span class="hljs-number">1</span>)<br>    jwt_token = jwt.encode(payload=&#123;<span class="hljs-string">&quot;id&quot;</span>: db_user.<span class="hljs-built_in">id</span>, <span class="hljs-string">&quot;name&quot;</span>: db_user.username, <span class="hljs-string">&quot;exp&quot;</span>: exp&#125;, key=JWT_SECRET_KEY)<br>    response.headers[<span class="hljs-string">&quot;x-token&quot;</span>] = jwt_token<br>    <span class="hljs-keyword">return</span> db_user<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/books&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">books</span>(<span class="hljs-params">x_token: typing.<span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = Header(<span class="hljs-params"></span>)</span>):<br>    <span class="hljs-comment"># è¯·æ±‚å¤´å–å– x-tokenï¼Œè§£ætokenå¹¶è·å–ç”¨æˆ·ä¿¡æ¯</span><br>    <span class="hljs-keyword">try</span>:<br>        data = jwt.decode(x_token, key=JWT_SECRET_KEY, algorithms=<span class="hljs-string">&quot;HS256&quot;</span>)<br>        <span class="hljs-keyword">return</span> &#123;<br>            <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">f&quot;welcome: <span class="hljs-subst">&#123;data[<span class="hljs-string">&#x27;name&#x27;</span>]&#125;</span>&quot;</span>,<br>            <span class="hljs-string">&quot;books&quot;</span>: [&#123;<span class="hljs-string">&quot;id&quot;</span>: i, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">f&quot;book<span class="hljs-subst">&#123;i&#125;</span>&quot;</span>&#125; <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">11</span>)]<br>        &#125;<br>    <span class="hljs-keyword">except</span> Exception <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-keyword">raise</span> HTTPException(detail=e, status_code=<span class="hljs-number">404</span>)<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹2ï¼šä½¿ç”¨ç¬¬ä¸‰æ–¹åŒ… python-joseæ¥ç­¾å‘å’Œæ ¡éªŒjwttokenï¼Œä½¿ç”¨å‰å…ˆå®‰è£…ï¼š<code>pip3 install &quot;python-jose[cryptography]&quot;</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> datetime<br><br><span class="hljs-keyword">from</span> jose <span class="hljs-keyword">import</span> jwt, JWTError<br><br><br>SECRET_KEY = <span class="hljs-string">&quot;09d25e094faa6ca2556c818166b7a9563b93f7099f6f0f4caa6cf63b88e8d3e7&quot;</span><br>JWT_EXP = datetime.datetime.now() + datetime.timedelta(days=<span class="hljs-number">1</span>)<br><br>data = &#123;<span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;liuxu&quot;</span>, <span class="hljs-string">&quot;exp&quot;</span>: JWT_EXP&#125;<br>jwt_token = jwt.encode(data, SECRET_KEY, algorithm=<span class="hljs-string">&quot;HS256&quot;</span>)<br><span class="hljs-built_in">print</span>(jwt_token)<br><br><span class="hljs-keyword">try</span>:<br>    data = jwt.decode(jwt_token, SECRET_KEY, <span class="hljs-string">&quot;HS256&quot;</span>)<br>    <span class="hljs-built_in">print</span>(data)<br><span class="hljs-keyword">except</span> JWTError <span class="hljs-keyword">as</span> e:<br>    <span class="hljs-keyword">raise</span> e<br></code></pre></td></tr></table></figure><h1 id="9-11-fastapiçš„ç™»å½•è®¤è¯å·¥å…·"><a href="#9-11-fastapiçš„ç™»å½•è®¤è¯å·¥å…·" class="headerlink" title="9-11 fastapiçš„ç™»å½•è®¤è¯å·¥å…·"></a>9-11 fastapiçš„ç™»å½•è®¤è¯å·¥å…·</h1><p><strong>åœºæ™¯</strong></p><p>ç°åœ¨å·²ç»å¯ä»¥ä½¿ç”¨jwtåšç™»å½•è®¤è¯äº†ï¼Œä½†æ˜¯ä¼šå‘ç°åœ¨å¼€å‘çš„æ—¶å€™ï¼Œè¿™ä¸ªæµç¨‹æ¯”è¾ƒéº»çƒ¦ã€‚</p><p>æ¯”å¦‚ï¼Œä½ åœ¨apiæ–‡æ¡£é¡µé¢æ“ä½œï¼š</p><ul><li>1 å…ˆè°ƒç”¨ç™»å½•æ¥å£ï¼Œç™»å½•ååœ¨å“åº”å¤´ä¸­æŠŠx-tokenå¤åˆ¶å‡ºæ¥</li><li>2 ç„¶åè°ƒç”¨å›¾ä¹¦æ¥å£æ—¶ï¼ŒæŠŠå¤åˆ¶å‡ºæ¥çš„jwttokenè´´åœ¨è¯·æ±‚ä¸Š</li><li>3 ä¸€ä¸ªå›¾ä¹¦æ¥å£æ“ä½œä¸€éè¿˜è¡Œï¼Œä½†æ˜¯å¦‚æœæœ‰å¾ˆå¤šæ¥å£éƒ½ä¾èµ–ç™»å½•ï¼Œå°±ä¼šå¾ˆéº»çƒ¦ã€‚é‚£æœ‰æ¯”è¾ƒä¼˜é›…çš„è§£å†³æ–¹å¼å—ï¼Ÿ</li></ul><p><strong>FastAPIçš„è§£å†³æ–¹å¼</strong></p><ul><li>ä½¿ç”¨OAuth2PasswordBearerï¼Œå®ç°è‡ªåŠ¨ç™»å½•è®¤è¯</li></ul><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime, timedelta<br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Form, Depends, HTTPException<br><span class="hljs-keyword">from</span> fastapi.security <span class="hljs-keyword">import</span> OAuth2PasswordBearer<br><span class="hljs-keyword">from</span> jose <span class="hljs-keyword">import</span> jwt, JWTError<br><br><br>app = FastAPI(title=<span class="hljs-string">&quot;XXXé¡¹ç›®æ–‡æ¡£&quot;</span>)<br><br><span class="hljs-comment"># ç¬¬ä¸€æ­¥ï¼šå®ä¾‹åŒ–å¯¹è±¡oauth2_schemeï¼Œ tokenUrl=&quot;login&quot;è¡¨ç¤ºä¾èµ–çš„ç™»å½•æ¥å£æ˜¯ &quot;/login&quot;</span><br>oauth2_scheme = OAuth2PasswordBearer(tokenUrl=<span class="hljs-string">&quot;login&quot;</span>)<br><br><br>SECRET_KEY = <span class="hljs-string">&quot;09d25e094faa6ca2556c818166b7a9563b93f7099f6f0f4caa6cf63b88e8d3e7&quot;</span><br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/login&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">username: <span class="hljs-built_in">str</span> = Form(<span class="hljs-params"></span>), password: <span class="hljs-built_in">str</span> = Form(<span class="hljs-params"></span>)</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> username <span class="hljs-keyword">or</span> <span class="hljs-keyword">not</span> password:<br>        <span class="hljs-keyword">raise</span> HTTPException(detail=<span class="hljs-string">&quot;wrong username or password&quot;</span>, status_code=<span class="hljs-number">404</span>)<br><br>    exp = datetime.utcnow() + timedelta(days=<span class="hljs-number">1</span>)<br>    access_token = jwt.encode(&#123;<span class="hljs-string">&quot;sub&quot;</span>: username, <span class="hljs-string">&quot;exp&quot;</span>: exp&#125;, SECRET_KEY, <span class="hljs-string">&quot;HS256&quot;</span>)<br>    <br>    <span class="hljs-comment"># ç¬¬äºŒæ­¥ï¼šç™»å½•æˆåŠŸåè¿”å› access_tokenå’Œtoken_typeä¸¤ä¸ªå­—æ®µ</span><br>    <span class="hljs-comment"># access_tokenæ˜¯jwttokenï¼Œtoken_type=&quot;bearer&quot;</span><br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;access_token&quot;</span>: access_token, <span class="hljs-string">&quot;token_type&quot;</span>: <span class="hljs-string">&quot;bearer&quot;</span>&#125;<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/books&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_books_list</span>(<span class="hljs-params">token: <span class="hljs-built_in">str</span> = Depends(<span class="hljs-params">oauth2_scheme</span>)</span>):<br>    <span class="hljs-comment"># ç¬¬ä¸‰æ­¥ï¼šéœ€è¦ç™»å½•åæ‰èƒ½ä½¿ç”¨çš„æ¥å£ï¼Œä½¿ç”¨ä¾èµ–æ³¨å…¥Depends(oauth2_scheme)</span><br>    <span class="hljs-comment"># oauth2_schemeä¼šå¸®æˆ‘ä»¬è§£æå‡ºjwttokenï¼Œå¹¶èµ‹å€¼ç»™å½¢å‚token</span><br>    <span class="hljs-keyword">try</span>:<br>        data = jwt.decode(token, key=SECRET_KEY, algorithms=<span class="hljs-string">&quot;HS256&quot;</span>)<br>        <span class="hljs-keyword">return</span> &#123;<br>            <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">f&quot;hello: <span class="hljs-subst">&#123;data[<span class="hljs-string">&#x27;sub&#x27;</span>]&#125;</span>&quot;</span>,<br>            <span class="hljs-string">&quot;books&quot;</span>: [&#123;<span class="hljs-string">&quot;id&quot;</span>: i, <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">f&quot;book<span class="hljs-subst">&#123;i&#125;</span>&quot;</span>&#125; <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>)]<br>        &#125;<br>    <span class="hljs-keyword">except</span> JWTError <span class="hljs-keyword">as</span> e:<br>        <span class="hljs-keyword">raise</span> e<br></code></pre></td></tr></table></figure><p>ä¸‹å›¾æ˜¯openadpiæ–‡æ¡£çš„ç™»å½•è®¤è¯äº¤äº’çª—å£ï¼Œæœ‰äº†å®ƒæˆ‘ä»¬å°±ä¸å¿…å†æ‰‹åŠ¨è°ƒç”¨ç™»å½•æ¥å£ï¼Œå¤åˆ¶tokenäº†</p><p><img src="/img/fastapi/image-20220730105310760.png" alt="image-20220730105310760"></p><p>è¡¥å……ï¼š</p><ul><li>OpenAPIæ–‡æ¡£ä¸æ”¯æŒæºå¸¦ç‰¹æ®Šçš„è¯·æ±‚å¤´å­—æ®µï¼Œä½†æ˜¯è‡ªå®šä¹‰çš„è¯·æ±‚å¤´æ˜¯OKçš„</li></ul><h1 id="9-12-fastapiç™»å½•è®¤è¯å·¥å…·çš„å†…éƒ¨åŸç†"><a href="#9-12-fastapiç™»å½•è®¤è¯å·¥å…·çš„å†…éƒ¨åŸç†" class="headerlink" title="9-12 fastapiç™»å½•è®¤è¯å·¥å…·çš„å†…éƒ¨åŸç†"></a>9-12 fastapiç™»å½•è®¤è¯å·¥å…·çš„å†…éƒ¨åŸç†</h1><p>ä¸€äº›æ„Ÿæƒ³ï¼š</p><ul><li><p>åœ¨æ¥å£è‡ªåŠ¨åŒ–æµ‹è¯•å½“ä¸­ï¼Œæœ‰ä¸€ä¸ªç»å¸¸å¤„ç†çš„ä¸œè¥¿å°±æ˜¯æŠŠè¯·æ±‚å¸¦ä¸Štoken,ç„¶ååé¢æ¯ä¸€ä¸ªè¯·æ±‚éƒ½æ˜¯è¦å¸¦tokençš„ï¼Œå¦‚æœåæ®µä½¿ç”¨çš„æ˜¯JWTçš„è¿™æ ·çš„å½¢å¼çš„è¯ï¼Œå¯ä»¥æ‰¾åç«¯è¦åˆ°è¿™ä¸ªæœºå¯†çš„æ–¹å¼ï¼Œç›å€¼ï¼Œè°ƒç”¨è¿™ä¸ªåŠ å¯†çš„æ–¹æ³•ï¼Œé€šè¿‡ä¼ å…¥payload è´Ÿè½½ä¿¡æ¯ï¼ˆä¸€èˆ¬æ˜¯ç”¨æˆ·ä¿¡æ¯ï¼‰ç„¶ååŠ ä¸Šç›å€¼å†åŠ ä¸Šç®—æ³•å»è¿›è¡ŒåŠ å¯†</p></li><li><p>ä»¥å‰çš„tokenè§£å†³æ–¹å¼ï¼š</p><ul><li>ç™»é™†æ³¨å†Œï¼Œæ‹¿åˆ°token,ä¿å­˜å˜é‡ï¼Œä¼ é€’ç»™ä¸‹ä¸€ä¸ªæ¥å£</li></ul></li><li><p>ç°åœ¨å¯ä»¥æ›´ä¼˜é›…çš„è§£å†³ï¼š</p><ul><li><p>æ‹¿åˆ°åç«¯çš„åŠ å¯†æ–¹å¼å’Œç›å€¼ï¼Œ</p></li><li><p>ç»„è£…Header(å¤´) + Payload(è´Ÿè½½) + Signature(ç­¾å)</p></li><li><p>Header(å¤´)ä¸€èˆ¬æ˜¯å›ºå®šçš„ </p></li><li><pre><code class="python">&#123;  &quot;alg&quot;: &quot;HS256&quot;, # algï¼ˆç®—æ³•ï¼‰  &quot;typ&quot;: &quot;JWT&quot; # typï¼ˆç±»å‹ï¼‰&#125;<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey"><br>- Payload(è´Ÿè½½)ä¸€èˆ¬æ˜¯ç”¨æˆ·ä¿¡æ¯-åç§°ä¹‹ç±»çš„ï¼Œ<br><br>- ```python<br>  &#123;<br>    <span class="hljs-string">&quot;sub&quot;</span>: <span class="hljs-string">&quot;1234567890&quot;</span>,<br>    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;John Doe&quot;</span>,<br>    <span class="hljs-string">&quot;admin&quot;</span>: <span class="hljs-literal">true</span><br>  &#125;<br></code></pre></td></tr></table></figure></code></pre></li><li><p>Signature(ç­¾åâ€”ç­¾åé€šå¸¸ç”±å¤´éƒ¨ã€è´Ÿè½½ã€å¯†é’¥å’ŒæŒ‡å®šçš„ç®—æ³•ç”Ÿæˆ</p></li><li><pre><code class="python"> # ç­¾å‘jwttoken, å¹¶ä¿å­˜åœ¨å“åº”å¤´ä¸Š    exp = datetime.datetime.now() + datetime.timedelta(days=1)    jwt_token = jwt.encode(payload=&#123;&quot;id&quot;: db_user.id, &quot;name&quot;: db_user.username, &quot;exp&quot;: exp&#125;, key=JWT_SECRET_KEY)    response.headers[&quot;x-token&quot;] = jwt_token<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs python"><br>- æœ€åæŠŠç»„åˆèµ·æ¥çš„jwt æ·»åŠ åˆ°request.sessioné‡Œé¢ï¼Œè¿™æ ·è¿™ä¸ªå›è¯åšä»€ä¹ˆéƒ½ä¼šå¸¦ä¸Šè¿™ä¸ªjwtäº†<br><br><span class="hljs-comment"># 9-13 ç™»å½•ç›¸å…³å·¥å…·å°è£…</span><br><br>- å¯†ç åŠ å¯†å’Œæ ¡éªŒå°è£…æˆä¸€ä¸ªå·¥å…·<br>- jwtç­¾å‘å’Œè§£æå°è£…æˆä¸€ä¸ªå·¥å…·<br><br>```py<br><span class="hljs-comment"># tools.py</span><br><br><span class="hljs-keyword">import</span> datetime<br><br><span class="hljs-keyword">from</span> passlib.context <span class="hljs-keyword">import</span> CryptContext<br><span class="hljs-keyword">from</span> jose <span class="hljs-keyword">import</span> jwt, JWTError<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Hashing</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, schemes: <span class="hljs-built_in">str</span> = <span class="hljs-string">&quot;bcrypt&quot;</span></span>):<br>        self.crypt = CryptContext(schemes=[schemes], deprecated=<span class="hljs-string">&quot;auto&quot;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">hash</span>(<span class="hljs-params">self, raw_pwd: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>        <span class="hljs-keyword">return</span> self.crypt.<span class="hljs-built_in">hash</span>(raw_pwd)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">verify</span>(<span class="hljs-params">self, raw_pwd: <span class="hljs-built_in">str</span>, hashed_pwd: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">bool</span>:<br>        <span class="hljs-keyword">return</span> self.crypt.verify(raw_pwd, hashed_pwd)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Jwt</span>:<br>    JWT_KEY = <span class="hljs-string">&quot;ASDN*^n23^$:_&#125;;pYz7I&quot;</span><br>    ALGORITHMS = <span class="hljs-string">&quot;HS256&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">set_token</span>(<span class="hljs-params">self, data: <span class="hljs-built_in">dict</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;exp&quot;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> data:<br>            data[<span class="hljs-string">&quot;exp&quot;</span>] = datetime.datetime.now() + datetime.timedelta(days=<span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">return</span> jwt.encode(data, key=self.JWT_KEY)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_token</span>(<span class="hljs-params">self, jwt_token: <span class="hljs-built_in">str</span></span>):<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-keyword">return</span> jwt.decode(jwt_token, self.JWT_KEY, self.ALGORITHMS)<br>        <span class="hljs-keyword">except</span> JWTError <span class="hljs-keyword">as</span> e:<br>            <span class="hljs-keyword">raise</span> e<br><br><br>hash_obj = Hashing()<br>jwt_obj = Jwt()<br></code></pre></td></tr></table></figure></code></pre></li></ul></li><li><p>ä½¿ç”¨æ—¶ï¼Œç›´æ¥å¯¼å…¥</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> tools <span class="hljs-keyword">import</span> hash_obj, jwt_obj<br><br>app = FastAPI(title=<span class="hljs-string">&quot;ç™»å½•è®¤è¯ç›¸å…³&quot;</span>)<br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/register&quot;</span>, response_model=UserOut</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">register</span>(<span class="hljs-params">user: UserForm = Depends(<span class="hljs-params"></span>), db: Session = Depends(<span class="hljs-params">get_db</span>)</span>):<br>   ...<br>    new_user = User(<br>        username=user.username,<br>        password=hash_obj.<span class="hljs-built_in">hash</span>(user.password),<span class="hljs-comment"># hashåŠ å¯†</span><br>        email=user.email<br>    )<br>   ...<br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/login&quot;</span>, response_model=UserOut</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">response: Response,  username: <span class="hljs-built_in">str</span> = Form(<span class="hljs-params"></span>), password: <span class="hljs-built_in">str</span> = Form(<span class="hljs-params"></span>), db: Session = Depends(<span class="hljs-params">get_db</span>)</span>):<br>    db_user: User = db.query(User).filter_by(username=username).first()<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> db_user:<br>        <span class="hljs-keyword">raise</span> HTTPException(detail=<span class="hljs-string">&quot;ç”¨æˆ·åä¸å­˜åœ¨&quot;</span>, status_code=<span class="hljs-number">400</span>)<br>        <br>    <span class="hljs-comment"># hashæ ¡éªŒ</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> hash_obj.verify(password, db_user.password):<br>        <span class="hljs-keyword">raise</span> HTTPException(detail=<span class="hljs-string">&quot;ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯&quot;</span>, status_code=<span class="hljs-number">400</span>)<br><span class="hljs-comment"># jwtç­¾å‘</span><br>    jwt_token = jwt_obj.set_token(&#123;<span class="hljs-string">&quot;id&quot;</span>: db_user.<span class="hljs-built_in">id</span>, <span class="hljs-string">&quot;name&quot;</span>: db_user.username&#125;)<br>    response.headers[<span class="hljs-string">&quot;authorization&quot;</span>] = jwt_token<br>    <span class="hljs-keyword">return</span> db_user<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/books&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">books</span>(<span class="hljs-params">authorization: typing.<span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = Header(<span class="hljs-params"></span>)</span>):<br>    <span class="hljs-comment"># jwtè§£æ</span><br>    data = jwt_obj.get_token(authorization)<br>    <span class="hljs-keyword">return</span> &#123;<br>        <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">f&quot;welcome: <span class="hljs-subst">&#123;data[<span class="hljs-string">&#x27;name&#x27;</span>]&#125;</span>&quot;</span>,<br>        <span class="hljs-string">&quot;books&quot;</span>: [&#123;<span class="hljs-string">&quot;id&quot;</span>: i, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">f&quot;book<span class="hljs-subst">&#123;i&#125;</span>&quot;</span>&#125; <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">11</span>)]<br>    &#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç¼–ç¨‹ï¼Œwebå¼€å‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€pythonã€‘FastAPIä¹‹æ•°æ®åº“æ“ä½œï¼ˆäº”ï¼‰</title>
    <link href="/2024/02/28/685FastAPI5%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C/"/>
    <url>/2024/02/28/685FastAPI5%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C/</url>
    
    <content type="html"><![CDATA[<h1 id="8-1-å…³ç³»å‹æ•°æ®åº“"><a href="#8-1-å…³ç³»å‹æ•°æ®åº“" class="headerlink" title="8-1 å…³ç³»å‹æ•°æ®åº“"></a>8-1 å…³ç³»å‹æ•°æ®åº“</h1><p>ç”±äºä¹‹å‰å­¦è¿‡æ•°æ®åº“åŸºç¡€çŸ¥è¯†ï¼Œè¿™é‡Œä¸åšä»‹ç»åªåšå¯¹æ¯”</p><p>åœºæ™¯çš„æ•°æ®åº“ä¸€èˆ¬è¡¨ç°ä¸ºè½¯ä»¶ï¼Œæ¯”å¦‚</p><ul><li>MySQLã€Oracleã€SQL Serverã€PostgreSQLã€DB2ã€SQLiteç­‰ç­‰ï¼ˆå…³ç³»å‹æ•°æ®åº“ï¼‰ã€‚</li><li>Redisã€Memcachedã€MangoDbç­‰ç­‰ï¼ˆé”®å€¼å‹æ•°æ®åº“ï¼‰ã€‚</li></ul><p><strong>å…³ç³»å‹æ•°æ®åº“</strong></p><ul><li>å…³ç³»å‹æ•°æ®åº“ï¼Œæ˜¯æŒ‡é‡‡ç”¨äº†<a href="https://baike.baidu.com/item/%E5%85%B3%E7%B3%BB%E6%A8%A1%E5%9E%8B/3189329">å…³ç³»æ¨¡å‹</a>æ¥ç»„ç»‡æ•°æ®çš„æ•°æ®åº“ï¼Œå…¶ä»¥è¡Œå’Œåˆ—çš„å½¢å¼å­˜å‚¨æ•°æ®ï¼Œå¯ä»¥ç±»æ¯”EXCELè¡¨æ ¼ã€‚</li><li>ä¸€å¼ è¡¨å¯ä»¥åŒ…å«å¤šåˆ—ï¼Œæ¯ä¸€åˆ—éƒ½æœ‰ä¸€ä¸ªæ ‡é¢˜å­—æ®µã€‚ç„¶åå¯ä»¥æœ‰Nè¡Œï¼Œä¸€è¡Œæ•°æ®æœ‰å¤šä¸ªå­—æ®µ</li><li>ä¸€ä¸ªæ•°æ®åº“ä¸­å¯ä»¥åŒ…å«å¤šå¼ è¡¨ã€‚</li></ul><h1 id="8-2-ä½¿ç”¨pymysql"><a href="#8-2-ä½¿ç”¨pymysql" class="headerlink" title="8-2 ä½¿ç”¨pymysql"></a>8-2 ä½¿ç”¨pymysql</h1><h2 id="8-2ä½¿ç”¨pymysqlæŸ¥è¯¢"><a href="#8-2ä½¿ç”¨pymysqlæŸ¥è¯¢" class="headerlink" title="8-2ä½¿ç”¨pymysqlæŸ¥è¯¢"></a>8-2ä½¿ç”¨pymysqlæŸ¥è¯¢</h2><ul><li>åœ¨æ•°æ®åº“ <code>db</code> ä¸­æ–°å»ºä¸‹é¢è¿™å¼  <code>users</code>è¡¨</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python">-- æ–°å»ºä¸€ä¸ªæ•°æ®åº“ï¼Œåå­—æ˜¯ db<br>create database db charset utf8;<br><br>-- ä½¿ç”¨ db<br>use db;<br><br>-- åœ¨dbä¸­æ–°å»ºä¸€å¼  usersè¡¨<br>CREATE TABLE `users` (<br>    `<span class="hljs-built_in">id</span>` <span class="hljs-built_in">int</span>(<span class="hljs-number">11</span>) NOT NULL AUTO_INCREMENT,<br>    `name` varchar(<span class="hljs-number">255</span>) COLLATE utf8_bin NOT NULL,<br>    `password` varchar(<span class="hljs-number">255</span>) COLLATE utf8_bin NOT NULL,<br>    PRIMARY KEY (`<span class="hljs-built_in">id</span>`)<br>) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin AUTO_INCREMENT=<span class="hljs-number">1</span> ;<br><br><br>-- æ’å…¥ä¸¤æ¡æ•°æ®<br>insert into users(name, password) values(<span class="hljs-string">&quot;liuxu&quot;</span>,<span class="hljs-string">&quot;12345&quot;</span>);<br>insert into users(name, password) values(<span class="hljs-string">&quot;liuxu2&quot;</span>,<span class="hljs-string">&quot;12345&quot;</span>);<br></code></pre></td></tr></table></figure><ul><li>é€šè¿‡Pythonä»£ç è¿æ¥æ•°æ®åº“å¹¶æŸ¥è¯¢æ•°æ®</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pymysql<br><br><span class="hljs-comment"># è·å–è¿æ¥</span><br>conn = pymysql.connect(<br>    host=<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>,<br>    port=<span class="hljs-number">3306</span>,<br>    user=<span class="hljs-string">&#x27;root&#x27;</span>,<br>    password=<span class="hljs-string">&#x27;12345&#x27;</span>,<br>    database=<span class="hljs-string">&#x27;db&#x27;</span>,<br>    charset=<span class="hljs-string">&#x27;utf8&#x27;</span><br>)<br><br><span class="hljs-comment"># è·å–æ¸¸æ ‡</span><br>cursor = conn.cursor()<br><br><br><span class="hljs-comment"># å‡†å¤‡SQLè¯­å¥</span><br>sql = <span class="hljs-string">&#x27;select * from users;&#x27;</span><br><br><br><span class="hljs-built_in">print</span>(cursor.execute(sql))<span class="hljs-comment"># è¿”å›å—å½±å“çš„å‡½æ•°</span><br><br><span class="hljs-built_in">print</span>(cursor.fetchone())        <span class="hljs-comment"># å–å‡ºä¸€è¡Œæ•°æ®ï¼Œ(1, &#x27;liuxu&#x27;, &#x27;12345&#x27;)</span><br><span class="hljs-built_in">print</span>(cursor.fetchmany(<span class="hljs-number">2</span>))      <span class="hljs-comment"># å–å‡ºNè¡Œæ•°æ®</span><br><span class="hljs-built_in">print</span>(cursor.fetchall())        <span class="hljs-comment"># å–å‡ºå‰©ä¸‹æ‰€æœ‰æ•°æ®</span><br></code></pre></td></tr></table></figure><ul><li>æŒ‰æ¡ä»¶æŸ¥è¯¢</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python">...<br><br><br>sql = <span class="hljs-string">&#x27;select * from users where id = %s;&#x27;</span><span class="hljs-comment"># ä½¿ç”¨ %så ä½</span><br><br>cursor.execute(sql, <span class="hljs-number">2</span>)  <span class="hljs-comment"># execute()ä¸­ç¬¬ä¸€ä¸ªæ˜¯sqlè¯­å¥ï¼Œç¬¬äºŒä¸ªæ˜¯æ›¿æ¢å ä½çš„æ¡ä»¶</span><br><br><span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> cursor.fetchall():<br>    <span class="hljs-built_in">print</span>(d)<br>...<br><br><br>sql = <span class="hljs-string">&#x27;select * from users where id &gt;= %s and id &lt;= %s;&#x27;</span><span class="hljs-comment"># ä½¿ç”¨ %så ä½</span><br><br>cursor.execute(sql, [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>])<span class="hljs-comment"># ä»¥ä¸ºæœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä½¿ç”¨åˆ—è¡¨ä¼šå…ƒç»„çš„å½¢å¼å­˜æ”¾æ›¿æ¢å ä½çš„æ¡ä»¶</span><br><br><span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> cursor.fetchall():<br>    <span class="hljs-built_in">print</span>(d)<br>    <br>...<br>cursor = conn.cursor(pymysql.cursors.DictCursor)<br><br>sql = <span class="hljs-string">&#x27;select * from users where id &gt;= %(start)s and id &lt;= %(end)s;&#x27;</span><br><br>cursor.execute(sql, &#123;<span class="hljs-string">&quot;start&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&quot;end&quot;</span>: <span class="hljs-number">2</span>&#125;)<br><span class="hljs-keyword">for</span> d <span class="hljs-keyword">in</span> cursor.fetchall():<br>    <span class="hljs-built_in">print</span>(d)<br></code></pre></td></tr></table></figure><h2 id="8-3-ä½¿ç”¨pymysqlä¹‹æ–°å¢æ•°æ®"><a href="#8-3-ä½¿ç”¨pymysqlä¹‹æ–°å¢æ•°æ®" class="headerlink" title="8-3 ä½¿ç”¨pymysqlä¹‹æ–°å¢æ•°æ®"></a>8-3 ä½¿ç”¨pymysqlä¹‹æ–°å¢æ•°æ®</h2><p>ç¤ºä¾‹1ï¼šå¢åŠ æ•°æ®ï¼Œæ‰‹åŠ¨æäº¤</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">...<br>cursor = conn.cursor(pymysql.cursors.DictCursor)<br><br><br>sql = <span class="hljs-string">&#x27;insert into users(name, password) values(&quot;liuxu3&quot;, &quot;123456&quot;);&#x27;</span><br>cursor.execute(sql)<br>conn.commit()<span class="hljs-comment"># éœ€è¦ç¡®è®¤ä¸€æ¬¡, å¦åˆ™æ•°æ®åº“ä¸­ä¸ä¼šä¿å­˜è®°å½•</span><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹2ï¼šè‡ªåŠ¨æäº¤ä¿å­˜</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pymysql<br><br><span class="hljs-comment"># è·å–è¿æ¥</span><br>conn = pymysql.connect(<br>    host=<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>,<br>    port=<span class="hljs-number">3306</span>,<br>    user=<span class="hljs-string">&#x27;root&#x27;</span>,<br>    password=<span class="hljs-string">&#x27;12345&#x27;</span>,<br>    database=<span class="hljs-string">&#x27;db&#x27;</span>,<br>    charset=<span class="hljs-string">&#x27;utf8&#x27;</span>,<br>    autocommit=<span class="hljs-literal">True</span><span class="hljs-comment"># autocommit=Trueï¼Œè¡¨ç¤ºexecuteåè‡ªåŠ¨æäº¤ä¿å­˜ï¼Œæ— éœ€å†æ‰‹åŠ¨commit()</span><br>)<br><br>cursor = conn.cursor(pymysql.cursors.DictCursor)<br><br><br>sql = <span class="hljs-string">&#x27;insert into users(name, password) values(&quot;liuxu4&quot;, &quot;123456&quot;)&#x27;</span><br>cursor.execute(sql)<br><br><span class="hljs-comment"># æ‰¹é‡æ‰§è¡Œ executemany</span><br>ç¤ºä¾‹<span class="hljs-number">3</span>ï¼š<br>cursor = conn.cursor(pymysql.cursors.DictCursor)<br><br><br>sql = <span class="hljs-string">&#x27;insert into users(name, password) values(%s, %s)&#x27;</span><span class="hljs-comment"># å ä½, æ³¨æ„å’Œ &quot;%s&quot;çš„åŒºåˆ«ï¼ï¼ï¼</span><br>item_list = [(<span class="hljs-string">&quot;liuxu10&quot;</span>, <span class="hljs-string">&quot;12345&quot;</span>), (<span class="hljs-string">&quot;liuixu11&quot;</span>, <span class="hljs-string">&quot;12345&quot;</span>), (<span class="hljs-string">&quot;liuxu12&quot;</span>, <span class="hljs-string">&quot;12345&quot;</span>)]<span class="hljs-comment"># å¤šä¸ªæ›¿æ¢æ•°æ®</span><br>cursor.executemany(sql, args=item_list)<span class="hljs-comment"># è¿”å›å—å½±å“çš„å‡½æ•°</span><br></code></pre></td></tr></table></figure><h2 id="8-4-ä½¿ç”¨pymysqlä¹‹ä¿®æ”¹å’Œåˆ é™¤æ•°æ®"><a href="#8-4-ä½¿ç”¨pymysqlä¹‹ä¿®æ”¹å’Œåˆ é™¤æ•°æ®" class="headerlink" title="8-4 ä½¿ç”¨pymysqlä¹‹ä¿®æ”¹å’Œåˆ é™¤æ•°æ®"></a>8-4 ä½¿ç”¨pymysqlä¹‹ä¿®æ”¹å’Œåˆ é™¤æ•°æ®</h2><h1 id="8-3-ORMä»‹ç»"><a href="#8-3-ORMä»‹ç»" class="headerlink" title="8-3 ORMä»‹ç»"></a>8-3 ORMä»‹ç»</h1><p><strong>éœ€æ±‚åœºæ™¯</strong></p><p>ä¸Šé¢æˆ‘ä»¬ä½¿ç”¨pymysqlå¯ä»¥ç›´æ¥æ“ä½œMySQLï¼Œä½†æ˜¯ä½ ä¼šå‘ç°<strong>å¯¹æ•°æ®çš„å¢åˆ æ”¹æŸ¥ï¼Œéƒ½éœ€è¦æˆ‘ä»¬è‡ªå·±æ‰‹å†™SQLè¯­å¥ã€‚å¹¶ä¸”ï¼Œå­˜åœ¨å¤§é‡é‡å¤çš„ä»£ç ï¼Œä¸èƒ½ä½¿ç”¨é¢å‘å¯¹è±¡</strong>ã€‚é‚£æ˜¯å¦æ˜¯å¦ä¸€ç§æ›´ä¼˜é›…çš„æ–¹å¼æ¥æ“ä½œæ•°æ®åº“å‘¢ï¼Ÿ</p><p><strong>è§£å†³æ–¹å¼</strong></p><ul><li><p>ä½¿ç”¨ORMæ¥å®Œæˆå¯¹æ•°æ®çš„æ“ä½œ</p></li><li><p>ORMï¼šå¯¹è±¡å…³ç³»æ˜ å°„ï¼ˆObject-Relational Mappingï¼‰ï¼Œå®ƒå¯ä»¥å°†Pythonä¸­çš„ç±»-å¯¹è±¡-å±æ€§ å’Œ æ•°æ®åº“ä¸­çš„è¡¨-è¡Œæ•°æ®-å­—æ®µåšæ˜ å°„ã€‚åˆ©ç”¨å®ƒï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦åœ¨ç›´æ¥æ“ä½œæ•°æ®åº“ä¸­çš„è¡¨ã€è¡Œå’Œå­—æ®µäº†ï¼Œç›´æ¥æ“ä½œPythonä¸­é¢å‘å¯¹è±¡çš„ç±»ã€å¯¹è±¡å’Œå±æ€§å³å¯å®ç°æ•°æ®çš„CRUD</p></li><li><p>ç±»&lt;â€”â€”-&gt;æ•°æ®è¡¨</p></li><li><p>ç±»å¯¹è±¡&lt;â€”â€”-&gt;æ•°æ®è¡Œ</p></li><li><p>ç±»å±æ€§&lt;â€”â€”â€“&gt;å­—æ®µ</p></li></ul><p><img src="/img/fastapi/1.png" alt="1"></p><ul><li><p>ä¼˜ç‚¹ï¼šèƒ½å¤Ÿè®©ä¸€ä¸ªä¸ç”¨sqlè¯­å¥çš„å°ç™½ä¹Ÿèƒ½å¤Ÿé€šè¿‡python é¢å‘å¯¹è±¡çš„ä»£ç ç®€å•å¿«æ·çš„æ“ä½œæ•°æ®åº“</p></li><li><p>ç¼ºç‚¹ï¼šå°è£…ç¨‹åº¦å¤ªé«˜ï¼Œæœ‰æ—¶å€™sqlè¯­å¥çš„æ•ˆç‡ç›¸å¯¹è¾ƒä½ï¼Œå¯èƒ½éœ€è¦ä½ è‡ªå·±å†™SQLè¯­å¥</p></li></ul><p>Pythonä¸­çš„ORMå…¸å‹ä»£è¡¨</p><ul><li>Django-ORMï¼Œæ˜¯Djangoæ¡†æ¶è‡ªå¸¦çš„ORMï¼Œåªèƒ½åœ¨djangoä¸­ä½¿ç”¨</li><li>SQLAlchemy ORMï¼Œæ˜¯ä¸€ä¸ªå¼€æºçš„ORMï¼Œä¸ä¾èµ–webæ¡†æ¶</li><li>Peewee ï¼Œä¸ä¾èµ–webæ¡†æ¶çš„ORM</li><li>ç­‰ç­‰ã€‚</li></ul><h1 id="8-4-ä½¿ç”¨SQLAlchemyæŸ¥è¯¢æ•°æ®ã€å®ç°ã€‘"><a href="#8-4-ä½¿ç”¨SQLAlchemyæŸ¥è¯¢æ•°æ®ã€å®ç°ã€‘" class="headerlink" title="8-4 ä½¿ç”¨SQLAlchemyæŸ¥è¯¢æ•°æ®ã€å®ç°ã€‘"></a>8-4 ä½¿ç”¨SQLAlchemyæŸ¥è¯¢æ•°æ®ã€å®ç°ã€‘</h1><p><code>pip3 install SQLAlchemy</code></p><p>ä½¿ç”¨SQLAlchemyçš„åŸºæœ¬æµç¨‹åˆ†ä¸ºä¸‰æ­¥ï¼š</p><ul><li>åˆ›å»º<strong>sessionå¯¹è±¡</strong></li><li>åˆ›å»º<strong>ç±»æ¨¡å‹</strong></li><li>ä½¿ç”¨<strong>sessionå¯¹è±¡</strong>å’Œ<strong>æ¨¡å‹ç±»</strong>å®ç°æ•°æ®çš„CRUD</li></ul><p>ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºsessionå¯¹è±¡â€”-<strong>ä¸æ•°æ®åº“è¿›è¡Œè¿æ¥</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pymysql<br><span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> create_engine<br><span class="hljs-keyword">from</span> sqlalchemy.orm <span class="hljs-keyword">import</span> sessionmaker<br><br><span class="hljs-comment"># ä½¿ç”¨pymysqlä½œä¸ºMySQLdb</span><br>pymysql.install_as_MySQLdb()<br><br><span class="hljs-comment"># æŒ‡å®šè¿æ¥çš„MySQLæ•°æ®åº“</span><br>DATABASE_URL = <span class="hljs-string">&quot;mysql://root:12345@localhost:3306/db&quot;</span> <span class="hljs-comment"># å¤šç§</span><br><br><span class="hljs-comment"># åˆ›å»ºå¼•æ“</span><br>engine = create_engine(DATABASE_URL)<br><br><span class="hljs-comment"># åŸºäºå¼•æ“åˆ›å»ºsession</span><br>SessionLocal = sessionmaker(bind=engine)<br><br><span class="hljs-comment"># å®ä¾‹åŒ–sessionå¯¹è±¡ï¼Œå¾—åˆ°dbå¯¹è±¡</span><br>db = SessionLocal()<br><br><span class="hljs-comment">#  dbä½¿ç”¨åªæœ‰éœ€è¦å…³é—­ï¼Œé¿å…å ç”¨èµ„æº</span><br>db.close()<br></code></pre></td></tr></table></figure><p>ç¬¬äºŒæ­¥ï¼šåˆ›å»ºæ¨¡å‹ç±»</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sqlalchemy.orm <span class="hljs-keyword">import</span> sessionmaker,declarative_base<br><span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> Column, String, Integer<br><span class="hljs-comment"># åˆ›å»ºå¯¹è±¡çš„åŸºç±»:</span><br>BaseModel = declarative_base() <span class="hljs-comment"># declarative_baseæ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ªç±»</span><br><span class="hljs-comment"># å®šä¹‰Userå¯¹è±¡:</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    __tablename__ = <span class="hljs-string">&quot;users&quot;</span><span class="hljs-comment"># æŒ‡å®šæ•°æ®åº“ä¸­è¡¨çš„åå­—</span><br><br>    <span class="hljs-built_in">id</span> = Column(Integer, primary_key=<span class="hljs-literal">True</span>, autoincrement=<span class="hljs-literal">True</span>)<span class="hljs-comment"># å®šä¹‰idä½œä¸ºä¸»é”®ä¸”è‡ªå¢</span><br>    name = Column(String(<span class="hljs-number">255</span>))<span class="hljs-comment"># å®šä¹‰nameå­—æ®µï¼Œæ˜¯ä¸€ä¸ªstringç±»å‹</span><br>    password = Column(String(<span class="hljs-number">255</span>))<span class="hljs-comment"># passwordï¼Œæ˜¯ä¸€ä¸ªstringç±»å‹</span><br><br>    <span class="hljs-comment"># äººæ€§åŒ–å®šåˆ¶å¯¹è±¡çš„æ‰“å°è¾“å‡º</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__str__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;id: <span class="hljs-subst">&#123;self.<span class="hljs-built_in">id</span>&#125;</span>, name: <span class="hljs-subst">&#123;self.name&#125;</span>, password: <span class="hljs-subst">&#123;self.password&#125;</span>&quot;</span><br></code></pre></td></tr></table></figure><p>ç¬¬ä¸‰æ­¥ï¼šä½¿ç”¨sessionå¯¹è±¡å’Œæ¨¡å‹ç±»å®ç°æ•°æ®çš„æŸ¥è¯¢æ“</p><ul><li><code>result: User = db.query(User).filter(User.id == 1).first()</code></li><li>å¿…é¡»ä½¿ç”¨ <code>first()</code>, <strong>å¦åˆ™åªæ˜¯SQLè¯­å¥</strong>ï¼Œä¸ä¼šæ‰§è¡ŒæŸ¥è¯¢æ“ä½œã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> create_engine, Column, String, Integer<br><span class="hljs-keyword">from</span> sqlalchemy.orm <span class="hljs-keyword">import</span> sessionmaker, declarative_base<br><br><span class="hljs-comment"># åˆ›å»ºå¯¹è±¡çš„åŸºç±»:</span><br>BaseModel = declarative_base()<br><br><br><span class="hljs-comment"># å®šä¹‰è¡¨å¯¹è±¡: åªæ˜¯åœ¨åšæ˜ å°„æ¥æ”¶è¡¨æ•°æ®</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestGroup</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    __tablename__ = <span class="hljs-string">&quot;test_group&quot;</span>  <span class="hljs-comment"># å®šä¹‰å®ƒçš„è¡¨å</span><br><br>    <span class="hljs-built_in">id</span> = Column(Integer, primary_key=<span class="hljs-literal">True</span>, index=<span class="hljs-literal">True</span>, autoincrement=<span class="hljs-literal">True</span>)<br>    name = Column(String(<span class="hljs-number">255</span>))<br>    num = Column(Integer)<br>    teacher = Column(String(<span class="hljs-number">255</span>))<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__str__</span>(<span class="hljs-params">self</span>):<span class="hljs-comment"># å½“å¯¹è±¡è¢«è®¿é—®æ‰“å°æ—¶è§¦å‘æ‰§è¡Œï¼Œä»–å¿…é¡»æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„è¿”å›å€¼</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;id: <span class="hljs-subst">&#123;self.<span class="hljs-built_in">id</span>&#125;</span>, name: <span class="hljs-subst">&#123;self.name&#125;</span>, nums: <span class="hljs-subst">&#123;self.num&#125;</span>,teacher: <span class="hljs-subst">&#123;self.teacher&#125;</span>&quot;</span><br><br><br><span class="hljs-comment"># å®šä¹‰è¿æ¥url</span><br>DATABASE_URL = <span class="hljs-string">&quot;sqlite:///study.db&quot;</span><br><span class="hljs-comment"># åˆ›å»ºå¼•æ“ å’Œä¼šè¯</span><br>engine = create_engine(DATABASE_URL)<br>SessionLocal = sessionmaker(bind=engine)<br><span class="hljs-comment"># dbæ˜¯ä»€ä¹ˆï¼Œdbæ˜¯ä¸€ä¸ªä¼šè¯ï¼Œå…¶å®å°±æ˜¯è¿æ¥ä¸Šäº†è¿™ä¸ªæ•°æ®åº“ï¼Œè¿™ä¸ªè¡¨çš„æ˜ å°„å¯¹è±¡</span><br>db = SessionLocal()<br><span class="hljs-comment"># db.query(TestGroup)ä¼ å…¥è¿™ä¸ªå®šä¹‰çš„è¡¨å¯¹è±¡ï¼Œé€šè¿‡å¼•æ“å¯¹è±¡å»è¿è¡Œï¼Œæ‰§è¡ŒæŸ¥è¯¢æ–¹æ³•ï¼Œç„¶åfilteræ˜¯ç­›é€‰</span><br>result: TestGroup = db.query(TestGroup).<span class="hljs-built_in">filter</span>(TestGroup.<span class="hljs-built_in">id</span> == <span class="hljs-number">1</span>).first() <span class="hljs-comment"># ä¸€å®šè¦æ‰§è¡Œfirst</span><br><span class="hljs-built_in">print</span>(result)<br><span class="hljs-built_in">print</span>(result.<span class="hljs-built_in">id</span>, result.name)<br><br><span class="hljs-comment"># å…³é—­dbè¿æ¥(é‡è¦)</span><br>db.close()<br><br></code></pre></td></tr></table></figure><h1 id="8-8-ä½¿ç”¨SQLAlchemyæŸ¥è¯¢è¡¥å……ã€å¥½ç”¨ã€‘"><a href="#8-8-ä½¿ç”¨SQLAlchemyæŸ¥è¯¢è¡¥å……ã€å¥½ç”¨ã€‘" class="headerlink" title="8-8 ä½¿ç”¨SQLAlchemyæŸ¥è¯¢è¡¥å……ã€å¥½ç”¨ã€‘"></a>8-8 ä½¿ç”¨SQLAlchemyæŸ¥è¯¢è¡¥å……ã€å¥½ç”¨ã€‘</h1><p>æˆ‘ä»¬é™¤äº†ä½¿ç”¨ <code>db.query(User).filter(User.id == 1).first()</code> æ¥è¿‡æ»¤æŸ¥è¯¢æ•°æ®å¤–ï¼Œè¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„æŸ¥è¯¢æ–¹å¼å¯ä»¥ä½¿ç”¨ã€‚</p><p>ç¤ºä¾‹1ï¼šè¿”å›ç¬¦åˆæ¡ä»¶çš„æ‰€æœ‰æ•°æ® <code>all()</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">db = SessionLocal()<br>result: TestGroup = db.query(User).<span class="hljs-built_in">filter</span>(User.<span class="hljs-built_in">id</span> &gt;=<span class="hljs-number">5</span>).<span class="hljs-built_in">all</span>()<br><span class="hljs-built_in">print</span>(result)<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹2ï¼š<strong>ä½¿ç”¨ <code>filter_by()</code>ç®€åŒ–ç­›é€‰å‚æ•°</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">db = SessionLocal()<br>result: TestGroup = db.query(User).filter_by(<span class="hljs-built_in">id</span>=<span class="hljs-number">2</span>).first()<br><span class="hljs-built_in">print</span>(result)<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹3ï¼š<strong>ä¸»é”®ç­›é€‰ä½¿ç”¨ <code>get()</code>ï¼Œç›´æ¥è¿”å›å¯¹è±¡çš„ç¤ºä¾‹</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">db = SessionLocal()<br>result: TestGroup = db.query(User).get(<span class="hljs-number">2</span>)<span class="hljs-comment"># get(2), è¡¨ç¤ºæŸ¥è¯¢ä¸»é”®id=2çš„æ•°æ®</span><br><span class="hljs-built_in">print</span>(result)<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹4ï¼šä½¿ç”¨ <code>order_by</code> æ’åº</p><ul><li>é»˜è®¤æ˜¯<strong>å‡åºæ’åˆ—</strong></li><li><code>db.query(User).order_by(User.id.desc()).all()</code>  ä½¿ç”¨ <code>å­—æ®µ.desc()</code>æŒ‡å®šé™åºæ’åˆ—</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">db = SessionLocal()<br>result: TestGroup = db.query(User).order_by(User.<span class="hljs-built_in">id</span>).<span class="hljs-built_in">all</span>()<br><span class="hljs-built_in">print</span>([r.<span class="hljs-built_in">id</span> <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> result])<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹5ï¼šåˆ†é¡µé€»è¾‘ã€‚</p><ul><li><code>offset(n)</code>æŒ‡å®šè¿‡æ»¤å‡ è¡Œæ•°æ®å†å¼€å§‹æŸ¥è¯¢</li><li><code>limit(n)</code>æŒ‡å®šæ¯æ¬¡æŸ¥è¯¢å‡ æ¡æ•°æ®</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">db = SessionLocal()<br>result: User = db.query(User).offset(<span class="hljs-number">0</span>).limit(<span class="hljs-number">3</span>).<span class="hljs-built_in">all</span>()<br><span class="hljs-built_in">print</span>([r.<span class="hljs-built_in">id</span> <span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> result])<br></code></pre></td></tr></table></figure><h1 id="8-5-ä½¿ç”¨SQLAlchemyæ–°å¢æ•°æ®"><a href="#8-5-ä½¿ç”¨SQLAlchemyæ–°å¢æ•°æ®" class="headerlink" title="8-5 ä½¿ç”¨SQLAlchemyæ–°å¢æ•°æ®"></a>8-5 ä½¿ç”¨SQLAlchemyæ–°å¢æ•°æ®</h1><p>ç¤ºä¾‹1ï¼šæ–°å¢æ•°æ®</p><ul><li>ä½¿ç”¨ <code>add(æ¨¡å‹ç±»å¯¹è±¡)</code>æ–°å¢æ•°æ®</li><li><strong>å¿…é¡»ä½¿ç”¨ <code>db.commit()</code>æäº¤æ•°æ®ï¼Œ</strong>å¦åˆ™æ–°å¢çš„æ•°æ®ä¸ä¼šå†™åˆ°æ•°æ®åº“ä¸­</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># 1ã€æ–°å¢å•æ¡æ•°æ® ç”¨addæ–¹æ³•</span><br>db = SessionLocal()<br><br>db.add(User(name=<span class="hljs-string">&quot;liuxu&quot;</span>, password=<span class="hljs-string">&quot;123456&quot;</span>))<br>db.add(User(name=<span class="hljs-string">&quot;liuxu2&quot;</span>, password=<span class="hljs-string">&quot;123456&quot;</span>))<br>db.commit()<span class="hljs-comment"># éå¸¸é‡è¦</span><br><br><span class="hljs-comment"># 2ã€æ–°å¢æ‰¹é‡  ä½¿ç”¨add_all()</span><br>user3 = User(name=<span class="hljs-string">&quot;liuxu3&quot;</span>, password=<span class="hljs-string">&quot;123456&quot;</span>)<br>user4 = User(name=<span class="hljs-string">&quot;liuxu4&quot;</span>, password=<span class="hljs-string">&quot;123456&quot;</span>)<br>db.add_all([user3, user4])<br>db.commit()<br><br><span class="hljs-comment"># 3ã€æ‰¹é‡æ–°å¢æ•°æ®ï¼Œä½¿ç”¨ bulk_save_objects( ) æ‰¹é‡ä¿å­˜å¯¹è±¡</span><br>user5 = User(name=<span class="hljs-string">&quot;liuxu5&quot;</span>, password=<span class="hljs-string">&quot;123456&quot;</span>)<br>user6 = User(name=<span class="hljs-string">&quot;liuxu6&quot;</span>, password=<span class="hljs-string">&quot;123456&quot;</span>)<br>db.bulk_save_objects([user5, user6])<br>db.commit()<br>db.close()<br></code></pre></td></tr></table></figure><h1 id="8-6-ä½¿ç”¨SQLAlchemyä¿®æ”¹å’Œåˆ é™¤æ•°æ®"><a href="#8-6-ä½¿ç”¨SQLAlchemyä¿®æ”¹å’Œåˆ é™¤æ•°æ®" class="headerlink" title="8-6 ä½¿ç”¨SQLAlchemyä¿®æ”¹å’Œåˆ é™¤æ•°æ®"></a>8-6 ä½¿ç”¨SQLAlchemyä¿®æ”¹å’Œåˆ é™¤æ•°æ®</h1><p><strong>ä¿®æ”¹æ•°æ®å’ŒæŸ¥è¯¢æ•°æ®çš„åŸåˆ™ï¼šå…ˆæŸ¥åˆ°æ•°æ®ï¼Œå†ä¿®æ”¹æˆ–åˆ é™¤</strong></p><p>ç¤ºä¾‹1ï¼šä¿®æ”¹æ•°æ® ç›´æ¥å¯¹è±¡.å±æ€§ &#x3D; â€œæ–°å­—æ®µåâ€</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">db = SessionLocal()<br><br>user: User = db.query(User).<span class="hljs-built_in">filter</span>(User.<span class="hljs-built_in">id</span> == <span class="hljs-number">1</span>).first()<br><span class="hljs-built_in">print</span>(user)<br>user.name = <span class="hljs-string">&quot;LIUXU&quot;</span><span class="hljs-comment"># ç›´æ¥ä¿®æ”¹å¯¹è±¡çš„å±æ€§å€¼</span><br>db.commit()    <span class="hljs-comment"># ç„¶åæäº¤ä¿å­˜æ‰èƒ½æ›´æ–°</span><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹2ï¼šä¿®æ”¹æ•°æ®ï¼Œä½¿ç”¨ <code>update()</code>ï¼Œæ”¯æŒæ‰¹é‡æ›´æ–°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">db = SessionLocal()<br>db.query(User).<span class="hljs-built_in">filter</span>(User.<span class="hljs-built_in">id</span> == <span class="hljs-number">1</span>).update(&#123;<span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;LLL&quot;</span>&#125;)<span class="hljs-comment"># æ›´æ–°æŒ‡å®šå­—æ®µçš„å€¼</span><br>db.commit()<span class="hljs-comment"># æäº¤ä¿å­˜ä¿®æ”¹</span><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹3ï¼šåˆ é™¤æ•°æ®ï¼Œä½¿ç”¨ <code>delete()</code>ï¼Œæ”¯æŒæ‰¹é‡åˆ é™¤ </p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs py">db = SessionLocal()<br>db.query(User).<span class="hljs-built_in">filter</span>(User.<span class="hljs-built_in">id</span> &gt;= <span class="hljs-number">3</span>).delete()<span class="hljs-comment"># æ”¯æŒæ‰¹é‡åˆ é™¤</span><br>db.commit()<span class="hljs-comment"># æäº¤æ‰èƒ½åˆ é™¤</span><br></code></pre></td></tr></table></figure><h1 id="8-7-FastAPIé›†æˆSQLAlchemyä¹‹æŸ¥è¯¢å’Œåˆ é™¤ã€æœ‰ç”¨ã€‘"><a href="#8-7-FastAPIé›†æˆSQLAlchemyä¹‹æŸ¥è¯¢å’Œåˆ é™¤ã€æœ‰ç”¨ã€‘" class="headerlink" title="8-7 FastAPIé›†æˆSQLAlchemyä¹‹æŸ¥è¯¢å’Œåˆ é™¤ã€æœ‰ç”¨ã€‘"></a>8-7 FastAPIé›†æˆSQLAlchemyä¹‹æŸ¥è¯¢å’Œåˆ é™¤ã€æœ‰ç”¨ã€‘</h1><ul><li>ä½¿ç”¨ORMçš„æŸ¥è¯¢å’Œåˆ é™¤æ“ä½œ</li><li>ä½¿ç”¨ä¾èµ–æ³¨å…¥çš„æ–¹å¼è·å–dbï¼Œåœ¨è¯·æ±‚æ¥çš„æ—¶å€™è·å–dbè¿æ¥ï¼Œåœ¨è¯·æ±‚ç»“æŸçš„æ—¶å€™å…³é—­dbè¿æ¥ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> typing<br><br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, HTTPException, Depends<br><span class="hljs-keyword">import</span> pymysql<br><span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> create_engine, Column, String, Integer<br><span class="hljs-keyword">from</span> sqlalchemy.ext.declarative <span class="hljs-keyword">import</span> declarative_base<br><span class="hljs-keyword">from</span> sqlalchemy.orm <span class="hljs-keyword">import</span> sessionmaker, Session<br><br>pymysql.install_as_MySQLdb()<br><br><br>DATABASE_URL = <span class="hljs-string">&quot;mysql://root:12345@localhost:3306/db&quot;</span><br>engine = create_engine(DATABASE_URL)<br>SessionLocal = sessionmaker(bind=engine)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_db</span>():<br>    db: Session = SessionLocal()<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">yield</span> db  <span class="hljs-comment"># yield å¦™ç”¨</span><br>    <span class="hljs-keyword">finally</span>:<br>        db.close()<br><br><br>BaseModel = declarative_base()<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    __tablename__ = <span class="hljs-string">&quot;users&quot;</span><br><br>    <span class="hljs-built_in">id</span> = Column(Integer, primary_key=<span class="hljs-literal">True</span>, index=<span class="hljs-literal">True</span>, autoincrement=<span class="hljs-literal">True</span>)<br>    name = Column(String(<span class="hljs-number">255</span>))<br>    password = Column(String(<span class="hljs-number">255</span>))<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__str__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;id: <span class="hljs-subst">&#123;self.<span class="hljs-built_in">id</span>&#125;</span>, name: <span class="hljs-subst">&#123;self.name&#125;</span>, password: <span class="hljs-subst">&#123;self.password&#125;</span>&quot;</span><br><br><br>app = FastAPI(title=<span class="hljs-string">&quot;FastAPI + SqlAlchemy&quot;</span>)<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/users&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_users</span>(<span class="hljs-params">page: <span class="hljs-built_in">int</span> = <span class="hljs-number">1</span>, size: <span class="hljs-built_in">int</span> = <span class="hljs-number">3</span>, db: Session = Depends(<span class="hljs-params">get_db</span>)</span>):<br>    users: typing.<span class="hljs-type">List</span>[User] = db.query(User).<span class="hljs-built_in">all</span>()[(page - <span class="hljs-number">1</span>) * size:page * size]<br>    <span class="hljs-keyword">return</span> [&#123;<span class="hljs-string">&quot;id&quot;</span>: u.<span class="hljs-built_in">id</span>, <span class="hljs-string">&quot;name&quot;</span>: u.name&#125; <span class="hljs-keyword">for</span> u <span class="hljs-keyword">in</span> users]<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/user/&#123;user_id&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_user_by_id</span>(<span class="hljs-params">user_id: <span class="hljs-built_in">int</span>, db: Session = Depends(<span class="hljs-params">get_db</span>)</span>):<br>    user: User = db.query(User).<span class="hljs-built_in">filter</span>(User.<span class="hljs-built_in">id</span> == user_id).first()<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> user:<br>        <span class="hljs-keyword">raise</span> HTTPException(detail=<span class="hljs-string">f&quot;Not found user with id: <span class="hljs-subst">&#123;user_id&#125;</span>&quot;</span>, status_code=<span class="hljs-number">404</span>)<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;id&quot;</span>: user.<span class="hljs-built_in">id</span>, <span class="hljs-string">&quot;name&quot;</span>: user.name&#125;<br><br><br><span class="hljs-meta">@app.delete(<span class="hljs-params"><span class="hljs-string">&quot;/user/&#123;user_id&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete_user_by_id</span>(<span class="hljs-params">user_id: <span class="hljs-built_in">int</span>, db: Session = Depends(<span class="hljs-params">get_db</span>)</span>):<br>    db.query(User).<span class="hljs-built_in">filter</span>(User.<span class="hljs-built_in">id</span> == user_id).delete()<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;code&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;success&quot;</span>&#125;<br></code></pre></td></tr></table></figure><h1 id="8-8-FastAPIé›†æˆSQLAlchemyä¹‹æ–°å»ºå’Œæ›´æ–°"><a href="#8-8-FastAPIé›†æˆSQLAlchemyä¹‹æ–°å»ºå’Œæ›´æ–°" class="headerlink" title="8-8 FastAPIé›†æˆSQLAlchemyä¹‹æ–°å»ºå’Œæ›´æ–°"></a>8-8 FastAPIé›†æˆSQLAlchemyä¹‹æ–°å»ºå’Œæ›´æ–°</h1><ul><li><p>ä½¿ç”¨pydanticçš„BaseModelåšSchemaæ¥æ”¶è¯·æ±‚ä½“æ•°æ®å¹¶åšæ ¡éªŒã€‚</p></li><li><p>ä½¿ç”¨ä½¿ç”¨SQLAlchemyçš„ORMå®ç°æ–°å»ºå’Œæ›´æ–°æ•°æ®æ“ä½œã€‚</p></li><li><p>db.refresh(db_user)     # refreshä¹‹åï¼Œdb_useræ‰æœ‰æ•°æ®</p><ul><li><p>åœ¨SQLAlchemyä¸­ï¼Œ<code>db.refresh()</code>æ˜¯ä¼šè¯å¯¹è±¡ï¼ˆSessionï¼‰çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºåˆ·æ–°å¯¹è±¡çš„çŠ¶æ€ã€‚</p><p>å½“æ‚¨ä»æ•°æ®åº“ä¸­æŸ¥è¯¢ä¸€ä¸ªå¯¹è±¡å¹¶å°†å…¶æ”¾å…¥ä¼šè¯ä¸­åï¼Œè¯¥å¯¹è±¡çš„çŠ¶æ€å°†ä¿æŒåœ¨ä¼šè¯ä¸­ï¼Œå³ä½¿æ•°æ®åº“ä¸­çš„æ•°æ®å‘ç”Ÿäº†å˜åŒ–ã€‚ä½†æœ‰æ—¶å€™æ‚¨å¯èƒ½å¸Œæœ›æ›´æ–°ä¼šè¯ä¸­çš„å¯¹è±¡çŠ¶æ€ï¼Œä»¥åæ˜ æœ€æ–°çš„æ•°æ®åº“æ•°æ®ã€‚è¿™å°±æ˜¯<code>db.refresh()</code>æ–¹æ³•å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚</p><p><code>db.refresh(obj)</code>æ–¹æ³•ä¼šæŸ¥è¯¢æ•°æ®åº“ï¼Œè·å–å¯¹è±¡çš„æœ€æ–°æ•°æ®ï¼Œå¹¶å°†å…¶æ›´æ–°åˆ°ä¼šè¯ä¸­çš„å¯¹è±¡ä¸Šã€‚è¿™æ ·ï¼Œæ‚¨å¯ä»¥ç¡®ä¿ä¼šè¯ä¸­çš„å¯¹è±¡ä¸æ•°æ®åº“ä¸­çš„æ•°æ®ä¿æŒåŒæ­¥</p></li></ul></li><li><p>orm_mode &#x3D; True     # è®¾ç½®å response_model&#x3D;UserOutæ—¶ï¼Œæ‰èƒ½ç›´æ¥è¿”å› db_user</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pymysql<br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, HTTPException, Depends<br><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel <span class="hljs-keyword">as</span> SchemaBaseModel<br><br><span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> create_engine, Column, String, Integer<br><span class="hljs-keyword">from</span> sqlalchemy.ext.declarative <span class="hljs-keyword">import</span> declarative_base<br><span class="hljs-keyword">from</span> sqlalchemy.orm <span class="hljs-keyword">import</span> sessionmaker, Session<br><br>pymysql.install_as_MySQLdb()<br><br><br>DATABASE_URL = <span class="hljs-string">&quot;mysql://root:12345@localhost:3306/db&quot;</span><br>engine = create_engine(DATABASE_URL)<br>SessionLocal = sessionmaker(bind=engine)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_db</span>():<br>    db: Session = SessionLocal()<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">yield</span> db<br>    <span class="hljs-keyword">finally</span>:<br>        db.close()<br><br><br>BaseModel = declarative_base()<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    __tablename__ = <span class="hljs-string">&quot;users&quot;</span><br><br>    <span class="hljs-built_in">id</span> = Column(Integer, primary_key=<span class="hljs-literal">True</span>, index=<span class="hljs-literal">True</span>, autoincrement=<span class="hljs-literal">True</span>)<br>    name = Column(String(<span class="hljs-number">255</span>))<br>    password = Column(String(<span class="hljs-number">255</span>))<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__str__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;id: <span class="hljs-subst">&#123;self.<span class="hljs-built_in">id</span>&#125;</span>, name: <span class="hljs-subst">&#123;self.name&#125;</span>, password: <span class="hljs-subst">&#123;self.password&#125;</span>&quot;</span><br><br><br>app = FastAPI(title=<span class="hljs-string">&quot;FastAPI + SqlAlchemy&quot;</span>)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserBase</span>(<span class="hljs-title class_ inherited__">SchemaBaseModel</span>):<br>    name: <span class="hljs-built_in">str</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserIn</span>(<span class="hljs-title class_ inherited__">UserBase</span>):<br>    password: <span class="hljs-built_in">str</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserOut</span>(<span class="hljs-title class_ inherited__">UserBase</span>):<br>    <span class="hljs-built_in">id</span>: <span class="hljs-built_in">int</span><br><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Config</span>:<br>        orm_mode = <span class="hljs-literal">True</span>     <span class="hljs-comment"># è®¾ç½®å response_model=UserOutæ—¶ï¼Œæ‰èƒ½ç›´æ¥è¿”å› db_user</span><br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/user&quot;</span>, response_model=UserOut</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_user</span>(<span class="hljs-params">user: UserIn, db: Session = Depends(<span class="hljs-params">get_db</span>)</span>):<br>    <span class="hljs-comment"># db_user = User(name=user.name, password=user.password)</span><br>    db_user = User(**user.<span class="hljs-built_in">dict</span>())       <span class="hljs-comment"># å’Œä¸Šé¢çš„ç”¨æ³•æ˜¯ç­‰ä»·çš„</span><br>    db.add(db_user)<br>    db.commit()<br>    db.refresh(db_user)     <span class="hljs-comment"># refreshä¹‹åï¼Œdb_useræ‰æœ‰æ•°æ®</span><br>    <span class="hljs-keyword">return</span> db_user<br><br><br><span class="hljs-meta">@app.put(<span class="hljs-params"><span class="hljs-string">&quot;/user/&#123;user_id&#125;&quot;</span>, response_model=UserOut</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">update_user_by_id</span>(<span class="hljs-params">user_id: <span class="hljs-built_in">int</span>, user: UserIn, db: Session = Depends(<span class="hljs-params">get_db</span>)</span>):<br>    db_user = db.query(User).<span class="hljs-built_in">filter</span>(User.<span class="hljs-built_in">id</span> == user_id).first()<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> db_user:<br>        <span class="hljs-keyword">raise</span> HTTPException(detail=<span class="hljs-string">f&quot;Not found user with id: <span class="hljs-subst">&#123;user_id&#125;</span>&quot;</span>, status_code=<span class="hljs-number">404</span>)<br>    db_user.name = user.name<br>    db_user.password = user.password<br>    db.commit()<br>    db.refresh(db_user)<br>    <span class="hljs-keyword">return</span> db_user<br></code></pre></td></tr></table></figure><h1 id="8-9-é¡¹ç›®ä»£ç ç»“æ„è°ƒæ•´ã€é‡ç‚¹ã€‘"><a href="#8-9-é¡¹ç›®ä»£ç ç»“æ„è°ƒæ•´ã€é‡ç‚¹ã€‘" class="headerlink" title="8-9 é¡¹ç›®ä»£ç ç»“æ„è°ƒæ•´ã€é‡ç‚¹ã€‘"></a>8-9 é¡¹ç›®ä»£ç ç»“æ„è°ƒæ•´ã€é‡ç‚¹ã€‘</h1><p>ç›®å‰ï¼Œæˆ‘ä»¬å·²ç»å®ç°äº†FastAPIå’ŒSQLAlchemyçš„é›†æˆï¼Œä½†æ˜¯å‘ç°ï¼Œé¡¹ç›®çš„æ‰€æœ‰ä»£ç éƒ½åœ¨ä¸€ä¸ªPythonæ–‡ä»¶ä¸­ã€‚</p><p>è¿™æ ·ä¼šé€ æˆä»£ç ç»“æ„ä¸æ¸…æ¥šï¼Œå±‚æ¬¡ä¸æ¸…æ™°ï¼Œä»£ç å¯è¯»æ€§å·®ï¼Œç»´æŠ¤æˆæœ¬é«˜ã€‚</p><p>å› æ­¤ï¼Œéœ€è¦åšä»£ç æ‹†åˆ†ï¼ŒæŒ‰ç…§åŠŸèƒ½æ‹†åˆ†æˆä¸åŒçš„Pythonæ–‡ä»¶ã€‚</p><ul><li>é¡¹ç›®å®Œæ•´ä»£ç ç¤ºä¾‹ï¼ˆä¸€ä¸ªæ–‡ä»¶ç‰ˆæœ¬ï¼‰</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> typing<br><span class="hljs-keyword">import</span> pymysql<br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, HTTPException, Depends<br><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel <span class="hljs-keyword">as</span> SchemaBaseModel<br><br><span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> create_engine, Column, String, Integer<br><span class="hljs-keyword">from</span> sqlalchemy.ext.declarative <span class="hljs-keyword">import</span> declarative_base<br><span class="hljs-keyword">from</span> sqlalchemy.orm <span class="hljs-keyword">import</span> sessionmaker, Session<br><br>pymysql.install_as_MySQLdb()<br><br><br>DATABASE_URL = <span class="hljs-string">&quot;mysql://root:12345@localhost:3306/db&quot;</span><br>engine = create_engine(DATABASE_URL)<br>SessionLocal = sessionmaker(bind=engine)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_db</span>():<br>    db: Session = SessionLocal()<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">yield</span> db<br>    <span class="hljs-keyword">finally</span>:<br>        db.close()<br><br><br>BaseModel = declarative_base()<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    __tablename__ = <span class="hljs-string">&quot;users&quot;</span><br><br>    <span class="hljs-built_in">id</span> = Column(Integer, primary_key=<span class="hljs-literal">True</span>, index=<span class="hljs-literal">True</span>, autoincrement=<span class="hljs-literal">True</span>)<br>    name = Column(String(<span class="hljs-number">255</span>))<br>    password = Column(String(<span class="hljs-number">255</span>))<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__str__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;id: <span class="hljs-subst">&#123;self.<span class="hljs-built_in">id</span>&#125;</span>, name: <span class="hljs-subst">&#123;self.name&#125;</span>, password: <span class="hljs-subst">&#123;self.password&#125;</span>&quot;</span><br><br><br>app = FastAPI(title=<span class="hljs-string">&quot;FastAPI + SqlAlchemy&quot;</span>)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserBase</span>(<span class="hljs-title class_ inherited__">SchemaBaseModel</span>):<br>    name: <span class="hljs-built_in">str</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserIn</span>(<span class="hljs-title class_ inherited__">UserBase</span>):<br>    password: <span class="hljs-built_in">str</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserOut</span>(<span class="hljs-title class_ inherited__">UserBase</span>):<br>    <span class="hljs-built_in">id</span>: <span class="hljs-built_in">int</span><br><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Config</span>:<br>        orm_mode = <span class="hljs-literal">True</span>     <span class="hljs-comment"># è®¾ç½®å response_model=UserOutæ—¶ï¼Œæ‰èƒ½ç›´æ¥è¿”å› db_user</span><br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/users&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_users</span>(<span class="hljs-params">page: <span class="hljs-built_in">int</span> = <span class="hljs-number">1</span>, size: <span class="hljs-built_in">int</span> = <span class="hljs-number">3</span>, db: Session = Depends(<span class="hljs-params">get_db</span>)</span>):<br>    users: typing.<span class="hljs-type">List</span>[User] = db.query(User).<span class="hljs-built_in">all</span>()[(page - <span class="hljs-number">1</span>) * size:page * size]<br>    <span class="hljs-keyword">return</span> [&#123;<span class="hljs-string">&quot;id&quot;</span>: u.<span class="hljs-built_in">id</span>, <span class="hljs-string">&quot;name&quot;</span>: u.name&#125; <span class="hljs-keyword">for</span> u <span class="hljs-keyword">in</span> users]<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/user/&#123;user_id&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_user_by_id</span>(<span class="hljs-params">user_id: <span class="hljs-built_in">int</span>, db: Session = Depends(<span class="hljs-params">get_db</span>)</span>):<br>    user: User = db.query(User).<span class="hljs-built_in">filter</span>(User.<span class="hljs-built_in">id</span> == user_id).first()<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> user:<br>        <span class="hljs-keyword">raise</span> HTTPException(detail=<span class="hljs-string">f&quot;Not found user with id: <span class="hljs-subst">&#123;user_id&#125;</span>&quot;</span>, status_code=<span class="hljs-number">404</span>)<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;id&quot;</span>: user.<span class="hljs-built_in">id</span>, <span class="hljs-string">&quot;name&quot;</span>: user.name&#125;<br><br><br><span class="hljs-meta">@app.delete(<span class="hljs-params"><span class="hljs-string">&quot;/user/&#123;user_id&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete_user_by_id</span>(<span class="hljs-params">user_id: <span class="hljs-built_in">int</span>, db: Session = Depends(<span class="hljs-params">get_db</span>)</span>):<br>    db.query(User).<span class="hljs-built_in">filter</span>(User.<span class="hljs-built_in">id</span> == user_id).delete()<br>    db.commit()<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;code&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;success&quot;</span>&#125;<br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/user&quot;</span>, response_model=UserOut</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_user</span>(<span class="hljs-params">user: UserIn, db: Session = Depends(<span class="hljs-params">get_db</span>)</span>):<br>    <span class="hljs-comment"># db_user = User(name=user.name, password=user.password)</span><br>    db_user = User(**user.<span class="hljs-built_in">dict</span>())       <span class="hljs-comment"># å’Œä¸Šé¢çš„ç”¨æ³•æ˜¯ç­‰ä»·çš„</span><br>    db.add(db_user)<br>    db.commit()<br>    db.refresh(db_user)     <span class="hljs-comment"># refreshä¹‹åï¼Œdb_useræ‰æœ‰æ•°æ®</span><br>    <span class="hljs-keyword">return</span> db_user<br><br><br><span class="hljs-meta">@app.put(<span class="hljs-params"><span class="hljs-string">&quot;/user/&#123;user_id&#125;&quot;</span>, response_model=UserOut</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">update_user_by_id</span>(<span class="hljs-params">user_id: <span class="hljs-built_in">int</span>, user: UserIn, db: Session = Depends(<span class="hljs-params">get_db</span>)</span>):<br>    db_user = db.query(User).<span class="hljs-built_in">filter</span>(User.<span class="hljs-built_in">id</span> == user_id).first()<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> db_user:<br>        <span class="hljs-keyword">raise</span> HTTPException(detail=<span class="hljs-string">f&quot;Not found user with id: <span class="hljs-subst">&#123;user_id&#125;</span>&quot;</span>, status_code=<span class="hljs-number">404</span>)<br>    db_user.name = user.name<br>    db_user.password = user.password<br>    db.commit()<br>    db.refresh(db_user)<br>    <span class="hljs-keyword">return</span> db_user<br></code></pre></td></tr></table></figure><p><strong>æ‹†åˆ†åçš„é¡¹ç›®ç»“æ„</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">â”€â”€ sql_app<br>    â”œâ”€â”€ main.py<span class="hljs-comment"># ç¨‹åºå…¥å£</span><br>    â”œâ”€â”€ crud.py<span class="hljs-comment"># å¢åˆ æŸ¥æ”¹çš„æ–¹æ³•</span><br>    â”œâ”€â”€ database.py<span class="hljs-comment"># æ•°æ®åº“ç›¸å…³</span><br>    â”œâ”€â”€ models.py<span class="hljs-comment"># ORMæ¨¡å‹ç±»ç›¸å…³</span><br>    â””â”€â”€ schemas.py<span class="hljs-comment"># Pydanticçš„BaseModelï¼Œæ ¡éªŒç›¸å…³</span><br></code></pre></td></tr></table></figure><ul><li>database.py   # æ•°æ®åº“ç›¸å…³çš„é…ç½®</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pymysql<br><br><span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> create_engine<br><span class="hljs-keyword">from</span> sqlalchemy.orm <span class="hljs-keyword">import</span> sessionmaker, Session<br><br>pymysql.install_as_MySQLdb()<br><br><br>DATABASE_URL = <span class="hljs-string">&quot;mysql://root:12345@localhost:3306/db&quot;</span><br>engine = create_engine(DATABASE_URL)<br>SessionLocal = sessionmaker(bind=engine)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_db</span>():<br>    db: Session = SessionLocal()  <span class="hljs-comment"># dbå¯¹è±¡å‡ºæ¥äº†</span><br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">yield</span> db<br>    <span class="hljs-keyword">finally</span>:<br>        db.close()<br></code></pre></td></tr></table></figure><ul><li>models.py    # ORMæ¨¡å‹ç›¸å…³ä»£ç â€“å»ºç«‹ä¸è¡¨å¯¹åº”çš„æ¨¡å‹ç±»</li></ul><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">from</span> sqlalchemy <span class="hljs-keyword">import</span> Column, String, Integer<br><span class="hljs-keyword">from</span> sqlalchemy.ext.declarative <span class="hljs-keyword">import</span> declarative_base<br><br><br>BaseModel = declarative_base()<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):  <span class="hljs-comment"># åˆ›å»ºä¸€ä¸ªæ¨¡å‹ç±» å®šä¹‰è¡¨åå­—æ®µ</span><br>    __tablename__ = <span class="hljs-string">&quot;users&quot;</span><br><br>    <span class="hljs-built_in">id</span> = Column(Integer, primary_key=<span class="hljs-literal">True</span>, index=<span class="hljs-literal">True</span>, autoincrement=<span class="hljs-literal">True</span>)<br>    name = Column(String(<span class="hljs-number">255</span>))<br>    password = Column(String(<span class="hljs-number">255</span>))<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__str__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;id: <span class="hljs-subst">&#123;self.<span class="hljs-built_in">id</span>&#125;</span>, name: <span class="hljs-subst">&#123;self.name&#125;</span>, password: <span class="hljs-subst">&#123;self.password&#125;</span>&quot;</span><br></code></pre></td></tr></table></figure><ul><li>schemas.py    # Pydanticçš„BaseModelï¼Œæ ¡éªŒç›¸å…³</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserBase</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    name: <span class="hljs-built_in">str</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserIn</span>(<span class="hljs-title class_ inherited__">UserBase</span>): <span class="hljs-comment"># è¾“å…¥çš„ ç”¨çš„å“åº”æ¨¡å‹</span><br>    password: <span class="hljs-built_in">str</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserOut</span>(<span class="hljs-title class_ inherited__">UserBase</span>): <span class="hljs-comment"># è¾“å‡ºç”¨çš„ å“åº”æ¨¡å‹ï¼Œè¾“å‡ºè¦å±è”½å¯†ç </span><br>    <span class="hljs-built_in">id</span>: <span class="hljs-built_in">int</span><br><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Config</span>:<br>        orm_mode = <span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure><ul><li>crud.py</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> typing<br><br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> HTTPException<br><span class="hljs-keyword">from</span> sqlalchemy.orm <span class="hljs-keyword">import</span> Session<br><br><span class="hljs-keyword">from</span> models <span class="hljs-keyword">import</span> User<br><span class="hljs-keyword">from</span> schemas <span class="hljs-keyword">import</span> UserIn<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_users</span>(<span class="hljs-params">page: <span class="hljs-built_in">int</span>, size: <span class="hljs-built_in">int</span>, db: Session</span>) -&gt; typing.<span class="hljs-type">List</span>[User]:<br>    users: typing.<span class="hljs-type">List</span>[User] = db.query(User).<span class="hljs-built_in">all</span>()[(page - <span class="hljs-number">1</span>) * size:page * size]<br>    <span class="hljs-keyword">return</span> users<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_user_by_id</span>(<span class="hljs-params">user_id: <span class="hljs-built_in">int</span>, db: Session</span>) -&gt; User:<br>    user: User = db.query(User).<span class="hljs-built_in">filter</span>(User.<span class="hljs-built_in">id</span> == user_id).first()<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> user:<br>        <span class="hljs-keyword">raise</span> HTTPException(detail=<span class="hljs-string">f&quot;Not found user with id: <span class="hljs-subst">&#123;user_id&#125;</span>&quot;</span>, status_code=<span class="hljs-number">404</span>)<br>    <span class="hljs-keyword">return</span> user<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete_user_by_id</span>(<span class="hljs-params">user_id: <span class="hljs-built_in">int</span>, db: Session</span>):<br>    db.query(User).<span class="hljs-built_in">filter</span>(User.<span class="hljs-built_in">id</span> == user_id).delete()<br>    db.commit()<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_user</span>(<span class="hljs-params">user: UserIn, db: Session</span>) -&gt; User:<br>    <span class="hljs-comment"># db_user = User(name=user.name, password=user.password)</span><br>    db_user = User(**user.<span class="hljs-built_in">dict</span>())  <span class="hljs-comment"># å’Œä¸Šé¢çš„ç”¨æ³•æ˜¯ç­‰ä»·çš„</span><br>    db.add(db_user)<br>    db.commit()<br>    db.refresh(db_user)  <span class="hljs-comment"># refreshä¹‹åï¼Œdb_useræ‰æœ‰æ•°æ®</span><br>    <span class="hljs-keyword">return</span> db_user<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">update_user</span>(<span class="hljs-params">user_id: <span class="hljs-built_in">int</span>, user: UserIn, db: Session</span>) -&gt; User:<br>    db_user = db.query(User).<span class="hljs-built_in">filter</span>(User.<span class="hljs-built_in">id</span> == user_id).first()<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> db_user:<br>        <span class="hljs-keyword">raise</span> HTTPException(detail=<span class="hljs-string">f&quot;Not found user with id: <span class="hljs-subst">&#123;user_id&#125;</span>&quot;</span>, status_code=<span class="hljs-number">404</span>)<br>    db_user.name = user.name<br>    db_user.password = user.password<br>    db.commit()<br>    db.refresh(db_user)<br>    <span class="hljs-keyword">return</span> db_user<br></code></pre></td></tr></table></figure><ul><li>main.py     # ç¨‹åºä¸»å…¥å£ï¼Œå®šä¹‰æ¥å£</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> typing<br><br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Depends<br><span class="hljs-keyword">from</span> sqlalchemy.orm <span class="hljs-keyword">import</span> Session<br><br><span class="hljs-keyword">import</span> crud<br><span class="hljs-keyword">from</span> models <span class="hljs-keyword">import</span> User<br><span class="hljs-keyword">from</span> database <span class="hljs-keyword">import</span> get_db<br><span class="hljs-keyword">from</span> schemas <span class="hljs-keyword">import</span> UserIn, UserOut<br><br>app = FastAPI(title=<span class="hljs-string">&quot;FastAPI + SqlAlchemy&quot;</span>)<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/users&quot;</span>, response_model=typing.<span class="hljs-type">List</span>[UserOut]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_users</span>(<span class="hljs-params">page: <span class="hljs-built_in">int</span> = <span class="hljs-number">1</span>, size: <span class="hljs-built_in">int</span> = <span class="hljs-number">3</span>, db: Session = Depends(<span class="hljs-params">get_db</span>)</span>):<br>    user = crud.get_users(page, size, db)<br>    <span class="hljs-keyword">return</span> user<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/user/&#123;user_id&#125;&quot;</span>, response_model=UserOut</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_user_by_id</span>(<span class="hljs-params">user_id: <span class="hljs-built_in">int</span>, db: Session = Depends(<span class="hljs-params">get_db</span>)</span>):<br>    user: User = crud.get_user_by_id(user_id, db)<br>    <span class="hljs-keyword">return</span> user<br><br><br><span class="hljs-meta">@app.delete(<span class="hljs-params"><span class="hljs-string">&quot;/user/&#123;user_id&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete_user_by_id</span>(<span class="hljs-params">user_id: <span class="hljs-built_in">int</span>, db: Session = Depends(<span class="hljs-params">get_db</span>)</span>):<br>    crud.delete_user_by_id(user_id, db)<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;code&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&quot;msg&quot;</span>: <span class="hljs-string">&quot;success&quot;</span>&#125;<br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/user&quot;</span>, response_model=UserOut</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_user</span>(<span class="hljs-params">user: UserIn, db: Session = Depends(<span class="hljs-params">get_db</span>)</span>):<br>    <span class="hljs-keyword">return</span> crud.create_user(user, db)<br><br><br><span class="hljs-meta">@app.put(<span class="hljs-params"><span class="hljs-string">&quot;/user/&#123;user_id&#125;&quot;</span>, response_model=UserOut</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">update_user_by_id</span>(<span class="hljs-params">user_id: <span class="hljs-built_in">int</span>, user: UserIn, db: Session = Depends(<span class="hljs-params">get_db</span>)</span>):<br>    <span class="hljs-keyword">return</span> crud.update_user(user_id, user, db)<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç¼–ç¨‹ï¼Œwebå¼€å‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€otherã€‘UMLç±»å›¾ç®€å•å­¦ä¹ ç¬”è®°</title>
    <link href="/2024/02/26/UML%E7%B1%BB%E5%9B%BE%E7%AE%80%E5%8D%95%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <url>/2024/02/26/UML%E7%B1%BB%E5%9B%BE%E7%AE%80%E5%8D%95%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<blockquote><p>UMLå›¾æ˜¯è½¯ä»¶å·¥ç¨‹å»ºæ¨¡ä¸­å¯¹ç¨‹åºè®¾è®¡æè¿°çš„è®¾è®¡å›¾ç±»çš„æ€»ç§°ï¼Œå¯ä»¥è®©æˆ‘ä»¬æ›´æ¸…æ™°çš„äº†è§£é¡¹ç›®çš„ç»“æ„ã€‚</p><p>å¸¸è§UMLå›¾åŒ…å«ç±»å›¾ã€å¯¹è±¡å›¾ã€ç»„ä»¶å›¾ã€éƒ¨ç½²å›¾ã€ç”¨ä¾‹å›¾ç­‰ç»“æ„è¡Œä¸ºå›¾ä»¥åŠåºåˆ—å›¾ã€åä½œå›¾ã€çŠ¶æ€å›¾ã€æ´»åŠ¨å›¾ç­‰åŠ¨æ€è¡Œä¸ºå›¾ï¼Œæƒ³è¦æ‹“å±•çš„å¯ä»¥å‚è€ƒç½‘ä¸Šåšå®¢â€”&gt;<a href="https://www.cnblogs.com/hzxll/p/16190230.html">ä¹ç§å¸¸è§UMLå›¾</a> </p><p>æœ¬æ–‡æ˜¯æœ€å¸¸ç”¨çš„UMLç±»å›¾çš„ç¬”è®°</p></blockquote><h2 id="ä¸€ã€UMLç±»å›¾ç®€ä»‹"><a href="#ä¸€ã€UMLç±»å›¾ç®€ä»‹" class="headerlink" title="ä¸€ã€UMLç±»å›¾ç®€ä»‹"></a><strong>ä¸€ã€UMLç±»å›¾ç®€ä»‹</strong></h2><p>ç±»å›¾ä»¥åæ˜ ç±»çš„ç»“æ„(<strong>å±æ€§ã€æ“ä½œ</strong>)ä»¥åŠç±»ä¹‹é—´çš„å…³ç³»ä¸ºä¸»è¦ç›®çš„ï¼Œæè¿°äº†è½¯ä»¶ç³»ç»Ÿçš„ç»“æ„ï¼Œæ˜¯ä¸€ç§é™æ€å»ºæ¨¡æ–¹æ³•ã€‚ç±»å›¾ç”¨æ¥<strong>æè¿°ç³»ç»Ÿä¸­æœ‰æ„ä¹‰çš„æ¦‚å¿µ</strong>ï¼ŒåŒ…æ‹¬å…·ä½“çš„æ¦‚å¿µã€æŠ½è±¡çš„æ¦‚å¿µã€å®ç°æ–¹é¢çš„æ¦‚å¿µç­‰ï¼Œæ˜¯å¯¹ç°å®ä¸–ç•Œä¸­äº‹ç‰©çš„<strong>æŠ½è±¡</strong>ã€‚ç±»å›¾çš„ä¸»è¦ä½œç”¨æ˜¯å¯¹ç³»ç»Ÿçš„è¯æ±‡è¿›è¡Œå»ºæ¨¡ã€å¯¹ç®€å•çš„åä½œè¿›è¡Œå»ºæ¨¡å’Œå¯¹é€»è¾‘æ•°æ®åº“æ¨¡å¼è¿›è¡Œå»ºæ¨¡ã€‚</p><h1 id="äºŒ-ã€ç±»å›¾çš„åŸºæœ¬å±æ€§"><a href="#äºŒ-ã€ç±»å›¾çš„åŸºæœ¬å±æ€§" class="headerlink" title="äºŒ ã€ç±»å›¾çš„åŸºæœ¬å±æ€§"></a>äºŒ ã€ç±»å›¾çš„åŸºæœ¬å±æ€§</h1><p>ç±»å›¾æ¦‚æ‹¬èµ·æ¥ä¸»è¦ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼šç±»å’Œç±»ä¹‹é—´çš„å…³ç³»ï¼Œ</p><p>å…¶ä¸­å¯¹ç±»çš„å®šä¹‰å¦‚ä¸‹å›¾æ‰€ç¤º</p><p>ä¸»è¦ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯<strong>ç±»å</strong>ã€<strong>ç±»çš„å±æ€§</strong>ã€<strong>ç±»çš„æ–¹æ³•</strong>ï¼Œå¯¹åº”å›¾ä¸­çš„ä¸‰ä¸ªåˆ†åŒºå†…å®¹ã€‚</p><p><img src="/img/uml/1.jpg" alt="1"> </p><ul><li><p><strong>ç±»å</strong>ï¼šå›¾ä¸­æœ€ä¸Šé¢çš„çŸ©å½¢æ¡†ä¸­ä¸ºç±»åã€‚å¦‚æœå­—ä½“ä¸º<em>æ–œä½“</em>ï¼Œè¡¨ç¤ºä¸ºæŠ½è±¡ç±»</p></li><li><p><strong>ç±»çš„å±æ€§</strong>ï¼šç±»åä¸‹æ–¹çš„åŒºåŸŸ<strong>Â·ç±»çš„æ–¹æ³•</strong>ï¼šå›¾ä¸­çš„ä¸‹é¢éƒ¨åˆ†</p></li><li><p>*<strong>ç¬¦å·è§£é‡Š</strong> è¯´æ˜ï¼šå±æ€§å’Œæ–¹æ³•å‰é¢çš„â€œ+â€ â€œ-â€ å’Œ â€œ#â€ è¡¨ç¤ºè®¿é—®çº§åˆ«ï¼Œä»¥ä¸‹å¯¹è¿™äº›ç¬¦å·è¿›è¡Œè§£é‡Šè¯´æ˜ã€‚</p><ul><li>â€˜+â€™ ï¼š publicï¼Œå…¬ç”¨çš„ï¼Œå¯¹æ‰€æœ‰ç±»å¯è§</li><li>â€˜-â€™ ï¼š privateï¼Œç§æœ‰çš„ï¼Œåªå¯¹è¯¥ç±»æœ¬èº«å¯ç”¨</li><li>â€˜#â€™ï¼š protectedï¼Œå—ä¿æŠ¤çš„ï¼Œå¯¹è¯¥ç±»çš„å­å­™å¯è§</li><li>â€˜~â€™ï¼špackageï¼ŒåŒ…çš„ï¼Œåªå¯¹åŒä¸€åŒ…å£°æ˜çš„å…¶ä»–ç±»å¯è§</li><li>â€˜&#x3D;â€™ï¼šè¡¨ç¤ºé»˜è®¤å€¼</li><li>ä¸‹åˆ’çº¿ï¼šstatic</li><li>æ–œä½“ï¼šæŠ½è±¡ (æ³¨æ„ä¹Ÿå¯ä»¥ç”¨ä¸¤ä¸ªå°–æ‹¬å·åŒ…è£¹æ¥è¡¨ç¤ºæŠ½è±¡ï¼Œæ¯”å¦‚ â€”â€” &lt;&lt;æˆ‘æ˜¯æŠ½è±¡ç±»oræ¥å£&gt;&gt;)</li><li>å†’å·å‰æ˜¯æ–¹æ³•å&#x2F;å˜é‡åï¼ˆæ ¹æ®æœ‰æ— æ‹¬å·åŒºåˆ†ï¼‰ï¼Œå†’å·åæ˜¯è¿”å›å‚æ•°&#x2F;å˜é‡ç±»å‹ï¼ˆæ ¹æ®æœ‰æ— æ‹¬å·åŒºåˆ†ï¼‰ï¼Œå¦‚æœæ²¡æœ‰å†’å·çš„è¯è¡¨ç¤ºæ–¹æ³•è¿”å›ç©ºï¼ˆä¹Ÿæœ‰äººé€šè¿‡ï¼švoidè¡¨ç¤ºè¿”ç©ºï¼‰</li></ul></li></ul><h1 id="ä¸‰ã€ç±»ä¹‹é—´çš„å…³ç³»"><a href="#ä¸‰ã€ç±»ä¹‹é—´çš„å…³ç³»" class="headerlink" title="ä¸‰ã€ç±»ä¹‹é—´çš„å…³ç³»"></a>ä¸‰ã€ç±»ä¹‹é—´çš„å…³ç³»</h1><p>ç±»ä¹‹é—´çš„å…³ç³»ä¸»è¦åŒ…æ‹¬æ³›åŒ–ï¼ˆç»§æ‰¿ï¼‰ã€ä¾èµ–ã€å…³è”ã€èšåˆã€ç»„åˆå’Œå®ç°6ç§å…³ç³»ï¼Œä¸‹é¢å¯¹å®ƒä»¬è¿›è¡Œä¸€ä¸€é˜é‡Šã€‚</p><p><img src="/img/uml/2.jpg" alt="2"></p><h2 id="1ã€æ³›åŒ–å…³ç³»"><a href="#1ã€æ³›åŒ–å…³ç³»" class="headerlink" title="1ã€æ³›åŒ–å…³ç³»"></a><strong>1ã€æ³›åŒ–å…³ç³»</strong></h2><p>æ³›åŒ–å…³ç³»æ˜¯ä¸€ç§<strong>ç»§æ‰¿</strong>å…³ç³»ï¼Œå­ç±»ç»§æ‰¿çˆ¶ç±»çš„æ‰€æœ‰è¡Œä¸ºå’Œå±æ€§ï¼Œå­ç±»å¯ä»¥æ–°å¢æ–°çš„åŠŸèƒ½æˆ–è€…é‡å†™çˆ¶ç±»åŠŸèƒ½ï¼Œè¡¨ç¤ºçš„æ–¹å¼ä¸ºï¼š<strong>ç©ºå¿ƒä¸‰è§’+å®çº¿ï¼Œç®­å¤´ç«¯æŒ‡å‘çˆ¶ç±»</strong></p><p><img src="/img/uml/3.jpg" alt="3"></p><h2 id="2ã€ä¾èµ–å…³ç³»"><a href="#2ã€ä¾èµ–å…³ç³»" class="headerlink" title="2ã€ä¾èµ–å…³ç³»"></a><strong>2ã€ä¾èµ–å…³ç³»</strong></h2><p>ä¾èµ–å…³ç³»è¡¨ç¤ºä¸€ä¸ªç±»ä½¿ç”¨ï¼ˆä¾èµ–ï¼‰å¦ä¸€ä¸ªç±»çš„æœåŠ¡æˆ–ä¿¡æ¯ã€‚å½“ä¸€ä¸ªç±»çš„æ”¹å˜ä¼šå½±å“åˆ°å¦ä¸€ä¸ªç±»æ—¶ï¼Œä¸¤ä¸ªç±»ä¹‹é—´å­˜åœ¨ä¾èµ–å…³ç³»ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¾èµ–æ€»æ˜¯å•å‘çš„ï¼Œä¸åº”è¯¥å­˜åœ¨åŒå‘ä¾èµ–ã€‚è¡¨ç¤ºæ–¹å¼ä¸ºï¼š<strong>å°–æ‹¬å·+è™šçº¿</strong>ï¼Œ</p><p><img src="/img/uml/4.jpg" alt="4"></p><h2 id="3ã€å…³è”å…³ç³»"><a href="#3ã€å…³è”å…³ç³»" class="headerlink" title="3ã€å…³è”å…³ç³»"></a><strong>3ã€å…³è”å…³ç³»</strong></h2><p>å…³è”å…³ç³»æ˜¯ä¸€ç§æ‹¥æœ‰çš„å…³ç³»ï¼Œä»–ä½¿ä¸€ä¸ªç±»çŸ¥é“å¦ä¸€ä¸ªç±»çš„å±æ€§å’Œæ–¹æ³•ã€‚å®ƒä½“ç°ä¸åŒç±»çš„ä¸€ç§å¼ºä¾èµ–å…³ç³»ï¼Œæ¯”å¦‚æˆ‘å’Œæˆ‘çš„æœ‹å‹ï¼Œè¿™ç§å…³ç³»ä¾èµ–æ›´å¼ºï¼Œä¸å­˜åœ¨ä¾èµ–å…³ç³»ä¸­çš„å¶ç„¶æ€§ï¼Œå…³ç³»ä¹Ÿä¸æ˜¯ä¸´æ—¶çš„ï¼Œä¸€èˆ¬æ˜¯é•¿æœŸæ€§çš„ã€‚</p><p>å…³è”å…³ç³»åˆ†ä¸ºå•å‘å…³è”æˆ–åŒå‘å…³è”ï¼Œä¹Ÿå¯ä»¥æœ‰å¤šé‡æ€§ï¼ˆä¸€å¯¹å¤šï¼‰ï¼ŒåŒå‘çš„å…³è”å¯ä»¥æœ‰ä¸¤ä¸ªç®­å¤´æˆ–è€…æ²¡æœ‰å‰ªå¤´ï¼Œå•å‘çš„å…³è”æœ‰ä¸€ä¸ªç®­å¤´ï¼Œ</p><p>è¡¨ç¤ºæ–¹æ³•ï¼š<strong>å°–æ‹¬å·+å®çº¿ï¼Œç®­å¤´æŒ‡å‘è¢«æ‹¥æœ‰è€…</strong></p><p><img src="/img/uml/5.jpg" alt="5"></p><h2 id="4ã€èšåˆå…³ç³»"><a href="#4ã€èšåˆå…³ç³»" class="headerlink" title="4ã€èšåˆå…³ç³»"></a><strong>4ã€èšåˆå…³ç³»</strong></h2><p>èšåˆå…³ç³»æ˜¯å…³è”å…³ç³»çš„ä¸€ç§ï¼Œè¡¨ç¤ºä¸€ç§  â€œ<strong>å¼±</strong>â€ çš„ <strong>â€œæ‹¥æœ‰â€</strong> å…³ç³»ï¼Œ<strong>æ˜¯æ•´ä½“ä¸éƒ¨åˆ†çš„å…³ç³»</strong>ï¼Œä¸”<strong>éƒ¨åˆ†å¯ä»¥ç¦»å¼€æ•´ä½“è€Œå•ç‹¬å­˜åœ¨</strong>ï¼Œå¦‚è½¦å’Œè½®èƒæ˜¯æ•´ä½“å’Œéƒ¨åˆ†çš„å…³ç³»ï¼Œè½®èƒç¦»å¼€è½¦ä»ç„¶å¯ä»¥å•ç‹¬å­˜åœ¨ï¼Œ</p><p>è¡¨ç¤ºæ–¹æ³•ï¼š<strong>ç©ºå¿ƒè±å½¢+å®çº¿ï¼Œè±å½¢æŒ‡å‘æ•´ä½“</strong> </p><p><img src="/img/uml/6.jpg" alt="6"></p><h2 id="5ã€ç»„åˆå…³ç³»"><a href="#5ã€ç»„åˆå…³ç³»" class="headerlink" title="5ã€ç»„åˆå…³ç³»"></a><strong>5ã€ç»„åˆå…³ç³»</strong></h2><p>ç»„åˆå…³ç³»ä¹Ÿæ˜¯<strong>å…³è”å…³ç³»</strong>çš„ä¸€ç§ï¼Œæ˜¯æ¯”èšåˆå…³ç³»è¿˜è¦å¼ºçš„å…³ç³»ï¼Œ<strong>æ˜¯æ•´ä½“ä¸ä¸ªä½“çš„å…³ç³»</strong>ï¼Œä½†<strong>ä¸ªä½“ä¸èƒ½ç¦»å¼€æ•´ä½“è€Œå•ç‹¬å­˜åœ¨</strong>ï¼Œå¦‚å…¬å¸å’Œéƒ¨é—¨æ˜¯æ•´ä½“å’Œéƒ¨åˆ†çš„å…³ç³»ï¼Œæ²¡æœ‰å…¬å¸å°±ä¸å­˜åœ¨éƒ¨é—¨ï¼Œå®ƒè¦æ±‚æ™®é€šçš„èšåˆå…³ç³»é’Ÿä»£è¡¨æ•´ä½“çš„å¯¹è±¡è´Ÿè´£ä»£è¡¨éƒ¨åˆ†çš„å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚ </p><p>è¡¨ç¤ºæ–¹æ³•ï¼š<strong>å®å¿ƒè±å½¢+å®çº¿</strong></p><p><img src="/img/uml/7.jpg" alt="7"></p><h2 id="6ã€å®ç°å…³ç³»"><a href="#6ã€å®ç°å…³ç³»" class="headerlink" title="6ã€å®ç°å…³ç³»"></a><strong>6ã€å®ç°å…³ç³»</strong></h2><p>å®ç°å…³ç³»æ˜¯ä¸€ç§ç±»ä¸æ¥å£çš„å…³ç³»ï¼Œè¡¨ç¤ºç±»æ˜¯æ¥å£æ‰€æœ‰ç‰¹å¾å’Œè¡Œä¸ºçš„å®ç°ã€‚</p><p>è¡¨ç¤ºæ–¹æ³•ï¼š<strong>ç©ºå¿ƒä¸‰è§’+è™šçº¿</strong></p><p><img src="/img/uml/8.jpg" alt="8"></p><h1 id="å››ã€ç±»å›¾æ¨¡æ¿æ¡ˆä¾‹"><a href="#å››ã€ç±»å›¾æ¨¡æ¿æ¡ˆä¾‹" class="headerlink" title="å››ã€ç±»å›¾æ¨¡æ¿æ¡ˆä¾‹"></a><strong>å››ã€ç±»å›¾æ¨¡æ¿æ¡ˆä¾‹</strong></h1><p>ä¸ºäº†æ›´å¥½çš„ç†è§£ç±»ä¹‹é—´çš„6ç§å…³ç³»ï¼Œä¸‹é¢ä½¿ç”¨ä¾‹å­è¾…åŠ©å­¦ä¹ å’Œæ¶ˆåŒ–å¸æ”¶</p><h3 id="1ã€æ±½è½¦ç±»å›¾æ¡ˆä¾‹"><a href="#1ã€æ±½è½¦ç±»å›¾æ¡ˆä¾‹" class="headerlink" title="1ã€æ±½è½¦ç±»å›¾æ¡ˆä¾‹"></a>1ã€æ±½è½¦ç±»å›¾æ¡ˆä¾‹</h3><p><img src="/img/uml/9.jpg" alt="9"></p><p>æ±½è½¦ç±»å›¾è¯´æ˜ï¼š</p><ul><li>è½¦ä¸å°æ±½è½¦å’Œè‡ªè¡Œè½¦ä¹‹é—´æ˜¯ã€Œå®ç°ã€ å…³ç³»ï¼Œä½¿ç”¨å¸¦ç©ºå¿ƒç®­å¤´çš„è™šçº¿è¡¨ç¤ºï¼›</li><li>å°æ±½è½¦ä¸SUVä¹‹é—´çš„å…³ç³»ä¸ºæ³›åŒ–å…³ç³»ï¼Œä½¿ç”¨å¸¦ç©ºå¿ƒç®­å¤´çš„å®çº¿è¡¨ç¤ºï¼›</li><li>å°æ±½è½¦ä¸å‘åŠ¨æœºå’Œè½®èƒä¹‹é—´æ˜¯ã€Œç»„åˆã€ å…³ç³»ï¼Œä½¿ç”¨å®å¿ƒè±å½¢ç®­å¤´çš„å®çº¿è¡¨ç¤ºï¼›</li><li>å­¦ç”Ÿä¸Šå­¦éœ€è¦ç”¨åˆ°è‡ªè¡Œè½¦ï¼Œä¸è‡ªè¡Œè½¦æ˜¯ä¸€ç§ã€Œä¾èµ–ã€ å…³ç³»ï¼Œä½¿ç”¨å¸¦ç®­å¤´çš„è™šçº¿è¡¨ç¤ºã€‚</li><li>å­¦ç”Ÿä¸ç­çº§ä¹‹é—´æ˜¯ã€Œèšåˆã€ å…³ç³»ï¼Œä½¿ç”¨å¸¦ç©ºå¿ƒè±å½¢ç®­å¤´çš„å®çº¿è¡¨ç¤ºï¼›</li><li>å­¦ç”Ÿä¸èº«ä»½è¯ä¹‹é—´ä¸ºã€Œå…³è”ã€ å…³ç³»ï¼Œä½¿ç”¨å°–ç®­å¤´çš„å®çº¿è¡¨ç¤ºï¼›</li></ul><h3 id="2ã€åŠ¨ç‰©UMLç±»å›¾æ¡ˆä¾‹"><a href="#2ã€åŠ¨ç‰©UMLç±»å›¾æ¡ˆä¾‹" class="headerlink" title="2ã€åŠ¨ç‰©UMLç±»å›¾æ¡ˆä¾‹"></a>2ã€åŠ¨ç‰©UMLç±»å›¾æ¡ˆä¾‹</h3><p><img src="/img/uml/10.jpg" alt="10"></p><h3 id="3ã€å­¦ç”Ÿä¸Šç½‘UMLç±»å›¾æ¡ˆä¾‹"><a href="#3ã€å­¦ç”Ÿä¸Šç½‘UMLç±»å›¾æ¡ˆä¾‹" class="headerlink" title="3ã€å­¦ç”Ÿä¸Šç½‘UMLç±»å›¾æ¡ˆä¾‹"></a>3ã€å­¦ç”Ÿä¸Šç½‘UMLç±»å›¾æ¡ˆä¾‹</h3><p><img src="/img/uml/11.jpg" alt="11"></p><h3 id="4ã€å¾®ä¿¡æ”¯ä»˜ç±»å›¾æ¡ˆä¾‹"><a href="#4ã€å¾®ä¿¡æ”¯ä»˜ç±»å›¾æ¡ˆä¾‹" class="headerlink" title="4ã€å¾®ä¿¡æ”¯ä»˜ç±»å›¾æ¡ˆä¾‹"></a>4ã€å¾®ä¿¡æ”¯ä»˜ç±»å›¾æ¡ˆä¾‹</h3><p><img src="/img/uml/12.jpg" alt="12"></p><p>å¦‚æœä½ èƒ½å¿«é€Ÿçš„çœ‹æ‡‚å¹¶ç†è§£ä»¥ä¸Šæ¡ˆä¾‹ï¼Œè¯´æ˜ä½ åŸºæœ¬ä¸Šå·²ç»æŠŠç±»å›¾å¼„æ‡‚äº†ï¼Œå†å»å¤šç»“åˆä¸€äº›ä»£ç å’Œå¯¹åº”çš„ç±»å›¾å·©å›ºä¸€ä¸‹ï¼Œä»¥åå†çœ‹åˆ°ç±»å›¾å°±ä¸ä¼šæ‡µäº†ã€‚</p><h2 id="äº”ã€å¦‚ä½•ç»˜åˆ¶ç±»å›¾ï¼Ÿ"><a href="#äº”ã€å¦‚ä½•ç»˜åˆ¶ç±»å›¾ï¼Ÿ" class="headerlink" title="äº”ã€å¦‚ä½•ç»˜åˆ¶ç±»å›¾ï¼Ÿ"></a><strong>äº”ã€å¦‚ä½•ç»˜åˆ¶ç±»å›¾ï¼Ÿ</strong></h2><p>æ–°æ‰‹æ¨è ProcessOn ï¼ˆæµè§ˆå™¨å°±å¯ä»¥å…è´¹ä½¿ç”¨ï¼‰</p><p>macç”¨æˆ·æ¨èä¸‹è½½ï¼šastah professional</p>]]></content>
    
    
    <categories>
      
      <category>other</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç¬”è®°</tag>
      
      <tag>UML</tag>
      
      <tag>è§†é‡</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€pythonã€‘ä¹‹è®¾è®¡æ¨¡å¼ã€æœªå®Œã€‘</title>
    <link href="/2024/02/23/699python%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    <url>/2024/02/23/699python%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/</url>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><h1 id="ç¬¬1ç« -ç®€ä»‹"><a href="#ç¬¬1ç« -ç®€ä»‹" class="headerlink" title="ç¬¬1ç«  ç®€ä»‹"></a>ç¬¬1ç«  ç®€ä»‹</h1><h2 id="1-1-é¢å‘å¯¹è±¡ç›¸å…³"><a href="#1-1-é¢å‘å¯¹è±¡ç›¸å…³" class="headerlink" title="1.1 é¢å‘å¯¹è±¡ç›¸å…³"></a>1.1 é¢å‘å¯¹è±¡ç›¸å…³</h2><h2 id="1-2-é¢ç›¸å¯¹è±¡çš„3ä¸ªè®¾è®¡è®¾è®¡åŸåˆ™"><a href="#1-2-é¢ç›¸å¯¹è±¡çš„3ä¸ªè®¾è®¡è®¾è®¡åŸåˆ™" class="headerlink" title="1.2 é¢ç›¸å¯¹è±¡çš„3ä¸ªè®¾è®¡è®¾è®¡åŸåˆ™"></a>1.2 é¢ç›¸å¯¹è±¡çš„3ä¸ªè®¾è®¡è®¾è®¡åŸåˆ™</h2><h1 id="ç¬¬2ç« â€“å•ä¾‹è®¾è®¡æ¨¡å¼ã€åˆ›å»ºå‹æ¨¡å¼ã€‘"><a href="#ç¬¬2ç« â€“å•ä¾‹è®¾è®¡æ¨¡å¼ã€åˆ›å»ºå‹æ¨¡å¼ã€‘" class="headerlink" title="ç¬¬2ç« â€“å•ä¾‹è®¾è®¡æ¨¡å¼ã€åˆ›å»ºå‹æ¨¡å¼ã€‘"></a>ç¬¬2ç« â€“å•ä¾‹è®¾è®¡æ¨¡å¼ã€åˆ›å»ºå‹æ¨¡å¼ã€‘</h1><h2 id="2-1-ç†è§£å•ä¾‹1"><a href="#2-1-ç†è§£å•ä¾‹1" class="headerlink" title="2.1 ç†è§£å•ä¾‹1"></a>2.1 ç†è§£å•ä¾‹1</h2><h3 id="2-1-1å®ç°å•ä¾‹-â€“ä»£ç è§£è¯»"><a href="#2-1-1å®ç°å•ä¾‹-â€“ä»£ç è§£è¯»" class="headerlink" title="2.1.1å®ç°å•ä¾‹ â€“ä»£ç è§£è¯»"></a>2.1.1å®ç°å•ä¾‹ â€“ä»£ç è§£è¯»</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å•ä¾‹æ¨¡å¼</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span>(<span class="hljs-title class_ inherited__">object</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__new__</span>(<span class="hljs-params">cls</span>): <span class="hljs-comment"># __new__æ˜¯åœ¨å®ä¾‹åŒ–çš„æ—¶å€™è°ƒç”¨çš„æ–¹æ³•</span><br>        <span class="hljs-string">&quot;&quot;&quot; åˆ¤æ–­clsç±»æ˜¯å¦å…·æœ‰instanceå®ä¾‹å±æ€§ï¼Œå¦‚æœæ²¡æœ‰å°±åˆ›å»ºä¸€ä¸ªå®ä¾‹å‡ºæ¥&quot;&quot;&quot;</span><br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">hasattr</span>(cls, <span class="hljs-string">&#x27;instance&#x27;</span>): <span class="hljs-comment"># å¦‚æœclsç±»æœ¬èº« æ²¡æœ‰å®ä¾‹</span><br>            <span class="hljs-string">&quot;&quot;&quot; </span><br><span class="hljs-string">            è¿™é‡Œæ¯”è¾ƒéš¾ç†è§£ï¼Œ</span><br><span class="hljs-string">            super(Singleton, cls)ä¼šè¿”å›Singletonç±»çš„çˆ¶ç±»objectçš„å¯¹è±¡</span><br><span class="hljs-string">            super(Singleton, cls).__new__(cls)ä¹Ÿå°±æ˜¯çˆ¶ç±»objectçš„å¯¹è±¡çš„__new__æ–¹æ³•ï¼Œ</span><br><span class="hljs-string">            ç”¨çˆ¶ç±»çš„å¯¹è±¡åˆ›å»ºä¸€ä¸ªå¯¹è±¡ä¼ é€’ç»™clsï¼ˆæœ¬ç±»ï¼‰</span><br><span class="hljs-string">            ç„¶åæœ¬ç±»cls.instanceå°±=çˆ¶ç±»å¯¹è±¡åˆ›å»ºå‡ºæ¥çš„å¯¹è±¡ï¼Œ</span><br><span class="hljs-string">            &quot;&quot;&quot;</span><br>            cls.instance = <span class="hljs-built_in">super</span>(Singleton, cls).__new__(cls) <span class="hljs-comment"># é‚£ç±»çš„å®ä¾‹å°±ç­‰äº</span><br><br>        <span class="hljs-keyword">return</span> cls.instance <span class="hljs-comment"># å¦‚æœæœ‰å°±ç›´æ¥è¿”å›è¿™ä¸ªå®ä¾‹cls.instanceç±»çš„å®ä¾‹</span><br><br>s = Singleton()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Object created&quot;</span>, s) <span class="hljs-comment"># Object created &lt;__main__.Singleton object at 0x7ffbc212fbe0&gt;</span><br><br>s1 = Singleton()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Object created&quot;</span>, s1) <span class="hljs-comment"># Object created &lt;__main__.Singleton object at 0x7ffbc212fbe0&gt;</span><br><span class="hljs-comment"># åœ¨ Python ä¸­ï¼Œå¯¹è±¡çš„å®ä¾‹åŒ–è¿‡ç¨‹åŒ…æ‹¬ä¸¤ä¸ªæ­¥éª¤ï¼š__new__() å’Œ __init__()ã€‚__new__() æ–¹æ³•è´Ÿè´£åˆ›å»ºå®ä¾‹å¯¹è±¡ï¼Œè€Œ __init__() æ–¹æ³•è´Ÿè´£åˆå§‹åŒ–å®ä¾‹ã€‚</span><br><span class="hljs-comment"># åœ¨è¿™ä¸ªä»£ç æ®µä¸­ï¼Œsuper(Singleton, cls).__new__(cls) ä½¿ç”¨äº† super() å†…ç½®å‡½æ•°æ¥è°ƒç”¨çˆ¶ç±» object çš„ __new__() æ–¹æ³•ã€‚é€šè¿‡ä¼ é€’ Singleton ç±»å’Œ cls å‚æ•°ï¼Œsuper(Singleton, cls) è¿”å›äº†ä¸€ä¸ªä»£è¡¨çˆ¶ç±»çš„ç‰¹æ®Šå¯¹è±¡ã€‚</span><br><br><span class="hljs-comment"># ç„¶åï¼Œé€šè¿‡è°ƒç”¨ __new__() æ–¹æ³•ï¼Œçˆ¶ç±» object åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å®ä¾‹å¯¹è±¡ã€‚è¿™ä¸ªæ–°çš„å®ä¾‹å¯¹è±¡æ˜¯é€šè¿‡ä¼ é€’ cls å‚æ•°ï¼ˆå³ Singleton ç±»æœ¬èº«ï¼‰ç»™ __new__() æ–¹æ³•æ¥åˆ›å»ºçš„ã€‚</span><br><br><span class="hljs-comment"># æœ€åï¼Œå°†è¿™ä¸ªæ–°åˆ›å»ºçš„å®ä¾‹å¯¹è±¡èµ‹å€¼ç»™ç±»å±æ€§ instanceï¼Œä»¥ä¾¿åç»­çš„è°ƒç”¨å¯ä»¥è¿”å›åŒä¸€ä¸ªå®ä¾‹ã€‚</span><br><br><span class="hljs-comment"># æ¢å¥è¯è¯´ï¼Œè¿™è¡Œä»£ç çš„ç›®çš„æ˜¯åœ¨é¦–æ¬¡å®ä¾‹åŒ–æ—¶åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œå¹¶å°†å…¶èµ‹å€¼ç»™ç±»å±æ€§ instanceï¼Œä»¥ä¾¿åç»­çš„å®ä¾‹åŒ–éƒ½è¿”å›è¯¥å®ä¾‹ã€‚</span><br></code></pre></td></tr></table></figure><p>é—®ï¼šå¦‚ä½•å®ç°å•ä¾‹æ¨¡å¼ï¼š</p><p>ç­”ï¼šé€šè¿‡åœ¨å®šä¹‰ç±»é­”æ³•æ–¹æ³•__â€“newâ€“__é‡Œé¢ï¼Œåšä¸€ä¸ªåˆ¤æ–­ï¼Œåˆ¤æ–­ å½“å‰ç±»æ˜¯å¦å­˜åœ¨å®ä¾‹åŒ–å¯¹è±¡ä¹Ÿå°±æ˜¯cls.instance å¦‚æœæœ‰ï¼Œå°±ç›´æ¥è¿”å›è¿™ä¸ªå®ä¾‹åŒ–å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰åˆ™é€šè¿‡superè°ƒç”¨çˆ¶ç±»çš„newæ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªå®ä¾‹ cls.instance &#x3D; super(Singleton, cls).<strong>new</strong>(cls)) ç„¶åå†è¿”å›å‡ºå»</p><p>UMLç±»å›¾ç®€å•å­¦ä¹ ç¬”è®°</p><blockquote><p>è®¾è®¡æ¨¡å¼ä¸‰å¤§ç±»â€”&gt;åˆ›å»ºå‹ã€ç»“æ„å‹ã€è¡Œä¸ºå‹</p></blockquote><h1 id="åˆ›å»ºå‹"><a href="#åˆ›å»ºå‹" class="headerlink" title="åˆ›å»ºå‹"></a>åˆ›å»ºå‹</h1><blockquote><p>æ€ä¹ˆå»åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œ å·¥å‚æ–¹æ³•æ¨¡å¼ã€æŠ½è±¡å·¥å‚æ¨¡å¼ã€åˆ›å»ºè€…æ¨¡å¼ã€åŸå‹æ¨¡å¼ã€å•ä¾‹æ¨¡å¼</p></blockquote><h2 id="å·¥å‚æ¨¡å¼"><a href="#å·¥å‚æ¨¡å¼" class="headerlink" title="å·¥å‚æ¨¡å¼"></a>å·¥å‚æ¨¡å¼</h2><h3 id="ç®€å•å·¥å‚æ¨¡å¼"><a href="#ç®€å•å·¥å‚æ¨¡å¼" class="headerlink" title="ç®€å•å·¥å‚æ¨¡å¼"></a>ç®€å•å·¥å‚æ¨¡å¼</h3><p>ä¸ç›´æ¥å‘å®¢æˆ·ç«¯æš´éœ²å¯¹è±¡åˆ›å»ºçš„å®ç°ç»†èŠ‚ï¼Œè€Œæ˜¯é€šè¿‡ä¸€ä¸ªå·¥å‚ç±»æ¥è´Ÿè´£åˆ›å»ºäº§å“ç±»çš„å®ä¾‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">pythonè®¾è®¡æ¨¡å¼ä¹‹å·¥å‚æ¨¡å¼</span><br><span class="hljs-string">ä¸ç›´æ¥å‘å®¢æˆ·ç«¯æš´éœ²å¯¹è±¡åˆ›å»ºçš„å®ç°ç»†èŠ‚ï¼Œè€Œæ˜¯é€šè¿‡ä¸€ä¸ªå·¥å‚ç±»æ¥è´Ÿè´£åˆ›å»ºäº§å“ç±»çš„å®ä¾‹</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-keyword">from</span> abc <span class="hljs-keyword">import</span> ABCMeta, abstractmethod<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Payment</span>(metaclass=ABCMeta):<br><span class="hljs-meta">    @abstractmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">pay</span>(<span class="hljs-params">self, money</span>):<br>        <span class="hljs-keyword">pass</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Alipay</span>(<span class="hljs-title class_ inherited__">Payment</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, us_huabei=<span class="hljs-literal">False</span></span>):<br>        self.us_huabei = us_huabei<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">pay</span>(<span class="hljs-params">self, money</span>):<br>        <span class="hljs-keyword">if</span> self.us_huabei:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;èŠ±å‘—æ”¯ä»˜<span class="hljs-subst">&#123;money&#125;</span>å…ƒ&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æ”¯ä»˜å®æ”¯ä»˜<span class="hljs-subst">&#123;money&#125;</span>å…ƒ&quot;</span>)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">WechatPay</span>(<span class="hljs-title class_ inherited__">Payment</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">pay</span>(<span class="hljs-params">self, money</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;å¾®ä¿¡æ”¯ä»˜<span class="hljs-subst">&#123;money&#125;</span>å…ƒ&quot;</span>)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PaymentFactory</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_payment</span>(<span class="hljs-params">self, method</span>):<br>        <span class="hljs-keyword">if</span> method == <span class="hljs-string">&quot;alipay&quot;</span>:<br>            <span class="hljs-keyword">return</span> Alipay()<br>        <span class="hljs-keyword">elif</span> method == <span class="hljs-string">&quot;wechatpay&quot;</span>:<br>            <span class="hljs-keyword">return</span> WechatPay()<br>        <span class="hljs-keyword">elif</span> method == <span class="hljs-string">&quot;huabei&quot;</span>:<br>            <span class="hljs-keyword">return</span> Alipay(us_huabei=<span class="hljs-literal">True</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">raise</span> TypeError(<span class="hljs-string">f&quot;no such payment named <span class="hljs-subst">&#123;method&#125;</span>&quot;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    pf = PaymentFactory()<br>    p = pf.create_payment(method=<span class="hljs-string">&quot;alipay&quot;</span>)<br>    p.pay(<span class="hljs-number">100</span>)<br><br></code></pre></td></tr></table></figure><p>ç±»ä¸ç›´æ¥å®ä¾‹åŒ–ï¼Œç”±å·¥å‚ç±»å»è¿”å›å¯¹åº”çš„å®ä¾‹åŒ–å¯¹è±¡</p><h3 id="å·¥å‚æ–¹æ³•æ¨¡å¼"><a href="#å·¥å‚æ–¹æ³•æ¨¡å¼" class="headerlink" title="å·¥å‚æ–¹æ³•æ¨¡å¼"></a>å·¥å‚æ–¹æ³•æ¨¡å¼</h3><p>å·¥å‚æ–¹æ³•æ¨¡å¼</p><p>ä¼˜ç‚¹:</p><ul><li>æ¯ä¸ªå…·ä½“äº§å“éƒ½å¯¹åº”ä¸€ä¸ªå…·ä½“å·¥å‚ç±»ï¼Œä¸éœ€è¦ä¿®æ”¹å·¥å‚ç±»ä»£ç </li><li>éšè—äº†å¯¹è±¡åˆ›å»ºçš„å®ç°ç»†èŠ‚3</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>æ¯å¢åŠ ä¸€ä¸ªå…·ä½“äº§å“ç±»ï¼Œå°±å¿…é¡»å¢åŠ ä¸€ä¸ªç›¸åº”çš„å…·ä½“å·¥å‚ç±»</li></ul><p>ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> abc <span class="hljs-keyword">import</span> ABCMeta, abstractmethod<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Payment</span>(metaclass=ABCMeta):<br><span class="hljs-meta">    @abstractmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">pay</span>(<span class="hljs-params">self, money</span>):<br>        <span class="hljs-keyword">pass</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Alipay</span>(<span class="hljs-title class_ inherited__">Payment</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, use_huabei=<span class="hljs-literal">False</span></span>):<br>        self.us_huabei = use_huabei<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">pay</span>(<span class="hljs-params">self, money</span>):<br>        <span class="hljs-keyword">if</span> self.us_huabei:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;èŠ±å‘—æ”¯ä»˜<span class="hljs-subst">&#123;money&#125;</span>å…ƒ&quot;</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æ”¯ä»˜å®æ”¯ä»˜<span class="hljs-subst">&#123;money&#125;</span>å…ƒ&quot;</span>)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">BankPay</span>(<span class="hljs-title class_ inherited__">Payment</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">pay</span>(<span class="hljs-params">self, money</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;é“¶è”æ”¯ä»˜<span class="hljs-subst">&#123;money&#125;</span>å…ƒ&quot;</span>)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">WechatPay</span>(<span class="hljs-title class_ inherited__">Payment</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">pay</span>(<span class="hljs-params">self, money</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;å¾®ä¿¡æ”¯ä»˜<span class="hljs-subst">&#123;money&#125;</span>å…ƒ&quot;</span>)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PaymentFactory</span>(metaclass=ABCMeta):<br><span class="hljs-meta">    @abstractmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_payment</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">pass</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">AlipayFactory</span>(<span class="hljs-title class_ inherited__">PaymentFactory</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_payment</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> Alipay()<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">WechatPayFactory</span>(<span class="hljs-title class_ inherited__">PaymentFactory</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_payment</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> WechatPay()<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">HuabeiFactory</span>(<span class="hljs-title class_ inherited__">PaymentFactory</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_payment</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> Alipay(use_huabei=<span class="hljs-literal">True</span>)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">BankPayFactory</span>(<span class="hljs-title class_ inherited__">PaymentFactory</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_payment</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> BankPay()<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    pf = HuabeiFactory()<br>    p = pf.create_payment()<br>    p.pay(<span class="hljs-number">100</span>)<br></code></pre></td></tr></table></figure><h3 id="æŠ½è±¡å·¥å‚æ¨¡å¼"><a href="#æŠ½è±¡å·¥å‚æ¨¡å¼" class="headerlink" title="æŠ½è±¡å·¥å‚æ¨¡å¼"></a>æŠ½è±¡å·¥å‚æ¨¡å¼</h3><ul><li>å†…å®¹:å®šä¹‰ä¸€ä¸ªå·¥å‚ç±»æ¥å£ï¼Œè®©å·¥å‚å­ç±»æ¥åˆ›å»ºä¸€ç³»åˆ—ç›¸å…³æˆ–ç›¸äº’ä¾èµ–çš„å¯¹è±¡ã€‚</li><li>ä¾‹:ç”Ÿäº§ä¸€éƒ¨æ‰‹æœºï¼Œéœ€è¦æ‰‹æœºå£³ã€CPUã€æ“ä½œç³»ç»Ÿä¸‰ç±»å¯¹è±¡è¿›è¡Œç»„è£…å…¶ä¸­æ¯ç±»å¯¹è±¡éƒ½æœ‰ä¸åŒçš„ç§ç±»ã€‚å¯¹æ¯ä¸ªå…·ä½“å·¥å‚ï¼Œåˆ†åˆ«ç”Ÿäº§ä¸€éƒ¨æ‰‹æœºæ‰€éœ€è¦çš„ä¸‰ä¸ªå¯¹è±¡ã€‚</li><li>ç›¸æ¯”å·¥å‚æ–¹æ³•æ¨¡å¼ï¼ŒæŠ½è±¡å·¥å‚æ¨¡å¼ä¸­çš„æ¯ä¸ªå…·ä½“å·¥å‚éƒ½ç”Ÿäº§ä¸€å¥—äº§å“ã€‚</li></ul><h2 id="å»ºé€ è€…æ¨¡å¼"><a href="#å»ºé€ è€…æ¨¡å¼" class="headerlink" title="å»ºé€ è€…æ¨¡å¼"></a>å»ºé€ è€…æ¨¡å¼</h2><ul><li>å†…å®¹:å°†ä¸€ä¸ªå¤æ‚å¯¹è±¡çš„æ„å»ºä¸å®ƒçš„è¡¨ç¤ºåˆ†ç¦»ï¼Œä½¿å¾—åŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºã€‚</li><li>è§’è‰²<ul><li>æŠ½è±¡å»ºé€ è€…(Builder)</li><li>å…·ä½“å»ºé€ è€…(Concrete Builder)</li><li>æŒ‡æŒ¥è€…(Director)</li><li>äº§å“(Product)</li></ul></li><li>å»ºé€ è€…æ¨¡å¼ä¸æŠ½è±¡å·¥å‚æ¨¡å¼ç›¸ä¼¼ï¼Œä¹Ÿç”¨æ¥åˆ›å»ºå¤æ‚å¯¹è±¡ã€‚ä¸»è¦åŒºåˆ«æ˜¯å»ºé€ è€…æ¨¡å¼ç€é‡ä¸€æ­¥æ­¥æ„é€ ä¸€ä¸ªå¤æ‚å¯¹è±¡ï¼Œè€ŒæŠ½è±¡å·¥å‚æ¨¡å¼ç€é‡äºå¤šä¸ªç³»åˆ—çš„äº§å“å¯¹è±¡</li><li>ä¼˜ç‚¹<ul><li>éšè—äº†ä¸€ä¸ªäº§å“çš„å†…éƒ¨ç»“æ„å’Œè£…é…è¿‡ç¨‹</li><li>å°†æ„é€ ä»£ç ä¸è¡¨ç¤ºä»£ç åˆ†å¼€</li><li>å¯ä»¥å¯¹æ„é€ è¿‡ç¨‹è¿›è¡Œæ›´ç²¾ç»†çš„æ§åˆ¶</li></ul></li></ul><h2 id="å•ä¾‹æ¨¡å¼"><a href="#å•ä¾‹æ¨¡å¼" class="headerlink" title="å•ä¾‹æ¨¡å¼"></a>å•ä¾‹æ¨¡å¼</h2><p>ç¡®ä¿ä¸€ä¸ªç±»åªä¼šåˆ›å»ºå‡ºä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶æä¾›ä¸€ä¸ªè®¿é—®ä»–çš„å…¨å±€è®¿é—®ç‚¹</p><ul><li>è§’è‰²<ul><li>å•ä¾‹(Singleton)</li></ul></li><li>ä¼˜ç‚¹<ul><li>å¯¹å”¯ä¸€å®ä¾‹çš„å—æ§è®¿é—®</li><li>å•ä¾‹ç›¸å½“äºå…¨å±€å˜é‡ï¼Œä½†é˜²æ­¢äº†å‘½åç©ºé—´è¢«æ±¡æŸ“â€”&gt;ä¸ç”¨å•ä¾‹ä¹Ÿå¯ä»¥</li></ul></li></ul><p>ä¸€èˆ¬æ—¥å¿—ç³»ç»Ÿä¼šæ˜¯å•ä¾‹ï¼Œä¸ç„¶ä¸¤ä¸ªæ—¥å¿—å¯¹è±¡åŒæ—¶æ“ä½œä¸€ä¸ªæ–‡ä»¶å¯¹è±¡ï¼Œä¼šå‡ºç°é—®é¢˜ï¼Œ</p><blockquote><p>æŠ½è±¡å·¥å‚æ¨¡å¼å’Œå»ºé€ è€…æ¨¡å¼ç›¸å¯¹æ¯”ç®€å•å·¥å‚æ¨¡å¼å’Œå·¥å‚æ–¹æ³•æ¨¡å¼è€Œè¨€æ›´çµæ´»ä¹Ÿæ›´å¤æ‚</p><p>é€šå¸¸æƒ…å†µä¸‹ã€è®¾è®¡ä»¥ç®€å•å·¥å‚æ¨¡å¼æˆ–å·¥å‚æ–¹æ³•æ¨¡å¼å¼€å§‹ï¼Œå½“ä½ å‘ç°è®¾è®¡éœ€è¦æ›´å¤§çš„çµæ´»æ€§æ—¶ï¼Œåˆ™åƒæ›´å¤æ‚çš„è®¾è®¡æ¨¡å¼æ¼”å˜</p><p>â€”â€”-è®¾è®¡åº”å½“ä»ç®€å•å¼€å§‹ï¼Œç®€å•æ— æ³•æ»¡è¶³æ—¶æ‰è€ƒè™‘å¤æ‚è®¾è®¡æ¨¡å¼</p></blockquote><h1 id="ç»“æ„å‹æ¨¡å¼"><a href="#ç»“æ„å‹æ¨¡å¼" class="headerlink" title="ç»“æ„å‹æ¨¡å¼"></a>ç»“æ„å‹æ¨¡å¼</h1><h2 id="é€‚é…å™¨æ¨¡å¼"><a href="#é€‚é…å™¨æ¨¡å¼" class="headerlink" title="é€‚é…å™¨æ¨¡å¼"></a>é€‚é…å™¨æ¨¡å¼</h2><ul><li>å†…å®¹:å°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·å¸Œæœ›çš„å¦ä¸€ä¸ªæ¥å£ã€‚é€‚é…å™¨æ¨¡å¼ä½¿å¾—åŸæœ¬ç”±äºæ¥å£ä¸å…¼å®¹è€Œä¸èƒ½ä¸€èµ·å·¥ä½œçš„é‚£äº›ç±»å¯ä»¥ä¸€èµ·å·¥ä½œã€‚</li><li>ä¸¤ç§å®ç°æ–¹å¼<ul><li>ç±»é€‚é…å™¨ï¼šä½¿ç”¨å¤šç»§æ‰¿</li><li>å¯¹è±¡é€‚é…å™¨ï¼šä½¿ç”¨ç»„åˆ</li></ul></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> abc <span class="hljs-keyword">import</span> ABCMeta, abstractmethod<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Payment</span>(metaclass=ABCMeta):<br><span class="hljs-meta">    @abstractmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">pay</span>(<span class="hljs-params">self, money</span>):<br>        <span class="hljs-keyword">pass</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Alipay</span>(<span class="hljs-title class_ inherited__">Payment</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">pay</span>(<span class="hljs-params">self, money</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æ”¯ä»˜å®æ”¯ä»˜<span class="hljs-subst">&#123;money&#125;</span>å…ƒ&quot;</span>)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">WechatPay</span>(<span class="hljs-title class_ inherited__">Payment</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">pay</span>(<span class="hljs-params">self, money</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;å¾®ä¿¡æ”¯ä»˜<span class="hljs-subst">&#123;money&#125;</span>å…ƒ&quot;</span>)<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">BankPay</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">cast</span>(<span class="hljs-params">self, money</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;é“¶è”æ”¯ä»˜<span class="hljs-subst">&#123;money&#125;</span>å…ƒ&quot;</span>)<br><br><span class="hljs-comment"># ç±»é€‚é…å™¨</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">NewBankPay</span>(Payment, BankPay):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">pay</span>(<span class="hljs-params">self, money</span>):<br>        self.cast(money)<br>p = NewBankPay()<br>p.pay(<span class="hljs-number">100</span>)<br><br><span class="hljs-comment"># å¯¹è±¡é€‚é…å™¨</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PaymentAdapter</span>(<span class="hljs-title class_ inherited__">Payment</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, payment</span>):<br>        self.payment = payment<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">pay</span>(<span class="hljs-params">self, money</span>):<br>        self.payment.cast(money)<br><br>p = PaymentAdapter(BankPay())<br>p.pay(<span class="hljs-number">100</span>)<br><br></code></pre></td></tr></table></figure><ul><li>è§’è‰²:<ul><li>ç›®æ ‡æ¥å£(Target)</li><li>å¾…é€‚é…çš„ç±»(Adaptee)</li><li>é€‚é…å™¨(Adapter)</li></ul></li><li>é€‚ç”¨åœºæ™¯</li><li>æƒ³ä½¿ç”¨ä¸€ä¸ªå·²ç»å­˜åœ¨çš„ç±»ï¼Œè€Œå®ƒçš„æ¥å£ä¸ç¬¦åˆä½ çš„è¦æ±‚</li><li>(å¯¹è±¡é€‚é…å™¨)æƒ³ä½¿ç”¨ä¸€äº›å·²ç»å­˜åœ¨çš„å­ç±»ï¼Œä½†ä¸å¯èƒ½å¯¹æ¯ä¸€ä¸ªéƒ½è¿›è¡Œå­ç±»åŒ–ä»¥åŒ¹é…å®ƒä»¬çš„æ¥å£ã€‚å¯¹è±¡é€‚é…å™¨å¯ä»¥é€‚é…å®ƒçš„çˆ¶ç±»æ¥å£ã€‚</li></ul><h2 id="æ¡¥æ¨¡å¼"><a href="#æ¡¥æ¨¡å¼" class="headerlink" title="æ¡¥æ¨¡å¼"></a>æ¡¥æ¨¡å¼</h2><h1 id="è¡Œä¸ºå‹æ¨¡å¼"><a href="#è¡Œä¸ºå‹æ¨¡å¼" class="headerlink" title="è¡Œä¸ºå‹æ¨¡å¼"></a>è¡Œä¸ºå‹æ¨¡å¼</h1>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€linuxã€‘Ubuntuä¸Šä½¿ç”¨Charles</title>
    <link href="/2024/02/23/Ubuntu%E4%B8%8A%E4%BD%BF%E7%94%A8Charles/"/>
    <url>/2024/02/23/Ubuntu%E4%B8%8A%E4%BD%BF%E7%94%A8Charles/</url>
    
    <content type="html"><![CDATA[<p>Ubuntuä¸Šä½¿ç”¨Charles</p><h1 id="ä¸‹è½½"><a href="#ä¸‹è½½" class="headerlink" title="ä¸‹è½½"></a>ä¸‹è½½</h1><ol><li>ä½¿ç”¨å®˜ç½‘é“¾æ¥ä¸‹è½½  <a href="https://www.charlesproxy.com/download/%E4%B8%8B%E8%BD%BD.tar.gz%E5%8C%85%E5%90%8E%E8%A7%A3%E5%8E%8B%EF%BC%8C%E8%BF%9B%E5%85%A5%E8%A7%A3%E5%8E%8B%E7%9B%AE%E5%BD%95/charles/bin">https://www.charlesproxy.com/download/ä¸‹è½½.tar.gzåŒ…åè§£å‹ï¼Œè¿›å…¥è§£å‹ç›®å½•/charles/bin</a>  æ‰§è¡Œcharlesæ–‡ä»¶å¯æ‰“å¼€charles</li><li>å‘½ä»¤è¡Œæ–¹å¼ä¸‹è½½å®‰è£…</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">wget -q -O - https://www.charlesproxy.com/packages/apt/PublicKey | sudo apt-key add -<br>sudo sh -c â€˜echo deb https://www.charlesproxy.com/packages/apt/ charles-proxy main &gt; /etc/apt/sources.list.d/charles.listâ€™<br>sudo apt update<br>sudo apt-get install charles-proxy<br></code></pre></td></tr></table></figure><h1 id="æ¿€æ´»"><a href="#æ¿€æ´»" class="headerlink" title="æ¿€æ´»"></a>æ¿€æ´»</h1><ol><li><p>æ¿€æ´»åœ°å€<a href="https://www.zzzmode.com/mytools/charles/">https://www.zzzmode.com/mytools/charles/</a></p><p>å¡«å…¥RegisterNameï¼Œç‚¹å‡»â€œç”Ÿæˆâ€æŒ‰é’®ç”ŸæˆNameå’ŒKey</p></li></ol><p><img src="/img/charles/charles1.PNG" alt="img1"></p><ol start="2"><li>æ‰“å¼€Charles &#x3D;&#x3D;&gt; Help &#x3D;&#x3D;&gt; Register Charles &#x3D;&gt; è¾“å…¥</li></ol><p><img src="/img/charles/charles2.PNG" alt="img1"></p><h1 id="é…ç½®è¯ä¹¦"><a href="#é…ç½®è¯ä¹¦" class="headerlink" title="é…ç½®è¯ä¹¦"></a>é…ç½®è¯ä¹¦</h1><ol><li>å¯ä»¥å°è¯•åœ¨charlesä¸Šè‡ªåŠ¨å®‰è£…ï¼Œ Help â€“ SSL Proxying â€“ Install Charles Root Certificate</li></ol><p><img src="/img/charles/charles3.PNG" alt="img1"></p><p>æˆ‘è¿™é‡Œå¯¼å…¥æŒ‰é’®æ— æ³•ç‚¹å‡»ï¼Œé€‰æ‹©äº†å¦å¤–ä¸€ä¸ªæ–¹æ¡ˆ</p><ol start="2"><li>.æ‰‹åŠ¨é…ç½®è¯ä¹¦åˆ°ç³»ç»Ÿ</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> ~/.charles/ca/<br><span class="hljs-built_in">cp</span> charles-proxy-ssl-proxying-certificate.pem charles-proxy-ssl-proxying-certificate.crt <span class="hljs-comment">#è¿™ç§æ–¹å¼ä¸ä¸€å®šèƒ½ä¿è¯cpå‡ºæ¥ä¿®æ”¹åç¼€çš„æ–‡ä»¶èƒ½è¢«ä¿¡æ¯ï¼Œæœ€å¥½ç”¨ä¸‹é¢è¿™ç§æ–¹å¼</span><br>openssl x509 -outform der -<span class="hljs-keyword">in</span> charles-proxy-ssl-proxying-certificate.pem -out charles-proxy-ssl-proxying-certificate.crt<br>sudo <span class="hljs-built_in">cp</span> charles-proxy-ssl-proxying-certificate.crt /usr/local/share/ca-certificates/<br>sudo update-ca-certificates<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œæœ€åä¸€ä¸ªå‘½ä»¤ï¼Œå‘½ä»¤è¡Œä¼šæœ‰æˆåŠŸçš„æç¤º</p><p>å¯ä»¥é€šè¿‡<code>cat /etc/ssl/certs/charles-proxy-ssl-proxying-certificate.pem</code> çœ‹åˆ°è¯ä¹¦å·²ç»è¢«æ·»åŠ è¿›å»</p><p>&#x2F;etc&#x2F;ssl&#x2F;certs&#x2F;ä¸‹åŒ…å«äº†ç³»ç»Ÿè‡ªå¸¦çš„å„ç§å¯ä¿¡æ ¹è¯ä¹¦</p><ol start="3"><li>æµè§ˆå™¨ä¸Šé€šè¿‡ è®¾ç½®â€”â€”éšç§å’Œå®‰å…¨â€”â€”ç®¡ç†è®¾å¤‡è¯ä¹¦â€”â€”æˆæƒæœºæ„â€”â€”å¯¼å…¥ åœ¨&#x2F;usr&#x2F;local&#x2F;share&#x2F;ca-certificates&#x2F; ä¸‹çš„charles-proxy-ssl-proxying-certificate.crt æ–‡ä»¶ï¼Œç„¶åé€‰æ‹©ä¿¡ä»»è¯¥è¯ä¹¦</li></ol><p><img src="/img/charles/charles4.PNG" alt="img1"></p><h1 id="ä¿®æ”¹charlesçš„é…ç½®"><a href="#ä¿®æ”¹charlesçš„é…ç½®" class="headerlink" title="ä¿®æ”¹charlesçš„é…ç½®"></a>ä¿®æ”¹charlesçš„é…ç½®</h1><p>åœ¨charlesâ€”â€”Proxyâ€”â€”Proxy Settingâ€”â€”Proxies ä¿®æ”¹å†…å®¹å¦‚ä¸‹ï¼š</p><p><img src="/img/charles/charles5.PNG" alt="img1"></p><h1 id="ä¿®æ”¹æœ¬æœºç½‘ç»œè®¾ç½®"><a href="#ä¿®æ”¹æœ¬æœºç½‘ç»œè®¾ç½®" class="headerlink" title="ä¿®æ”¹æœ¬æœºç½‘ç»œè®¾ç½®"></a>ä¿®æ”¹æœ¬æœºç½‘ç»œè®¾ç½®</h1><p><img src="/img/charles/charles6.PNG" alt="img1"></p><h1 id="å¼€å§‹æŠ“åŒ…"><a href="#å¼€å§‹æŠ“åŒ…" class="headerlink" title="å¼€å§‹æŠ“åŒ…"></a>å¼€å§‹æŠ“åŒ…</h1><p>åœ¨æµè§ˆå™¨ä¸Šå‘èµ·è¯·æ±‚å¯ä»¥çœ‹åˆ°charlesä¸ŠæŠ“å–çš„å†…å®¹</p><p><img src="/img/charles/charles7.PNG" alt="img1"></p>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç¬”è®°</tag>
      
      <tag>linux</tag>
      
      <tag>ubuntu</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€pythonã€‘ä¹‹pytestå¦‚ä½•ä½¿ç”¨fixtureå¤¹å…·-å››ã€é‡ã€‘</title>
    <link href="/2024/01/23/664python%E4%B9%8Bpytest%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8fixture%E5%A4%B9%E5%85%B7-%E5%9B%9B/"/>
    <url>/2024/01/23/664python%E4%B9%8Bpytest%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8fixture%E5%A4%B9%E5%85%B7-%E5%9B%9B/</url>
    
    <content type="html"><![CDATA[<h1 id="å››ã€å…³äºfixturesæµ‹è¯•å¤¹å…·çš„ä½¿ç”¨ã€é‡ç‚¹ã€‘"><a href="#å››ã€å…³äºfixturesæµ‹è¯•å¤¹å…·çš„ä½¿ç”¨ã€é‡ç‚¹ã€‘" class="headerlink" title="å››ã€å…³äºfixturesæµ‹è¯•å¤¹å…·çš„ä½¿ç”¨ã€é‡ç‚¹ã€‘"></a>å››ã€å…³äºfixturesæµ‹è¯•å¤¹å…·çš„ä½¿ç”¨ã€é‡ç‚¹ã€‘</h1><p><strong>è¿™ç¯‡æ–‡ç« ä¸»è¦ä»‹ç»<code>fixture</code>å¤¹å…·ï¼Œåœ¨é¡¹ç›®ä¸­çš„ä½¿ç”¨æŠ€å·§ï¼Œä»£ç æ¯”è¾ƒå¤šï¼Œæ–‡ç« æ¯”è¾ƒé•¿ï¼Œè¯·è€å¿ƒçœ‹å®Œ</strong></p><blockquote><p>æœ‰äº›å®˜æ–¹æ–‡æ¡£ä¸Šçš„ä»£ç æ¯”ä»·ç»•æˆ–è€…å†—ä½™ï¼Œå°±è‡ªå·±å†™äº†ç®€å•ç‰ˆçš„ä¾¿äºç†è§£</p></blockquote><h2 id="4-1-â€œRequestingâ€-fixturesï¼ˆè¯·æ±‚å¤¹å…·ï¼‰"><a href="#4-1-â€œRequestingâ€-fixturesï¼ˆè¯·æ±‚å¤¹å…·ï¼‰" class="headerlink" title="4.1 â€œRequestingâ€ fixturesï¼ˆè¯·æ±‚å¤¹å…·ï¼‰"></a>4.1 â€œRequestingâ€ fixturesï¼ˆè¯·æ±‚å¤¹å…·ï¼‰</h2><p>åœ¨åŸºæœ¬å±‚é¢ä¸Šï¼Œæµ‹è¯•å‡½æ•°é€šè¿‡å°†å®ƒä»¬å£°æ˜ä¸ºå‚æ•°æ¥è¯·æ±‚å®ƒä»¬æ‰€éœ€çš„è£…ç½®ã€‚</p><p>å½“pytestè¿è¡Œæµ‹è¯•æ—¶ï¼Œå®ƒä¼šæŸ¥çœ‹è¯¥æµ‹è¯•å‡½æ•°ç­¾åä¸­çš„å‚æ•°ï¼Œç„¶åæœç´¢ä¸è¿™äº›å‚æ•°åç§°ç›¸åŒçš„fixtureã€‚ä¸€æ—¦pytestæ‰¾åˆ°å®ƒä»¬ï¼Œå®ƒå°±è¿è¡Œè¿™äº›fixtureï¼Œæ•è·å®ƒä»¬è¿”å›çš„å†…å®¹(å¦‚æœæœ‰çš„è¯)ï¼Œå¹¶å°†è¿™äº›å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’ç»™testå‡½æ•°ã€‚</p><h3 id="4-1-1-å¿«é€Ÿç¤ºä¾‹Quick-example"><a href="#4-1-1-å¿«é€Ÿç¤ºä¾‹Quick-example" class="headerlink" title="4.1.1 å¿«é€Ÿç¤ºä¾‹Quick example"></a>4.1.1 å¿«é€Ÿç¤ºä¾‹Quick example</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pytest<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Fruit</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, name</span>):<br>        self.name = name<br>        self.cubed = <span class="hljs-literal">False</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">cube</span>(<span class="hljs-params">self</span>):<br>        self.cubed = <span class="hljs-literal">True</span> <span class="hljs-comment"># å½“è°ƒç”¨cubeæ–¹æ³•æ—¶ï¼Œå°†cubedå±æ€§è®¾ç½®ä¸ºTrue</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">FruitSalad</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, *fruit_bowl</span>):<br>        self.fruit = fruit_bowl<br>        self._cube_fruit() <span class="hljs-comment"># è°ƒç”¨ç§æœ‰æ–¹æ³• è°ƒç”¨äº†fruitçš„cubeæ–¹æ³•ï¼Œä½¿å…¶ä¸ºTrue</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_cube_fruit</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">for</span> fruit <span class="hljs-keyword">in</span> self.fruit:<br>            fruit.cube() <span class="hljs-comment"># éå†è°ƒç”¨fruitçš„cubeæ–¹æ³•</span><br><br><span class="hljs-comment"># Arrange</span><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fruit_bowl</span>(): <span class="hljs-comment"># è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹çš„fixtureå‡½æ•°</span><br>    <span class="hljs-keyword">return</span> [Fruit(<span class="hljs-string">&quot;apple&quot;</span>), Fruit(<span class="hljs-string">&quot;banana&quot;</span>)] <span class="hljs-comment"># è¿”å›äº†ä¸¤ä¸ªFruitå®ä¾‹å¯¹è±¡</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_fruit_salad</span>(<span class="hljs-params">fruit_bowl</span>): <span class="hljs-comment"># ä¼ è¿›æ¥å°±å¯ä»¥ç”¨</span><br>    <span class="hljs-comment"># Act</span><br>    fruit_salad = FruitSalad(*fruit_bowl) <span class="hljs-comment"># å®ä¾‹åŒ–FruitSalad åŠ *æ˜¯å¯å˜å‚æ•°</span><br><br>    <span class="hljs-comment"># Assert</span><br>    <span class="hljs-keyword">assert</span> <span class="hljs-built_in">all</span>(fruit.cubed <span class="hljs-keyword">for</span> fruit <span class="hljs-keyword">in</span> fruit_salad.fruit) <span class="hljs-comment"># è°ƒç”¨äº†fruitçš„cubedæ–¹æ³• è¿”å›äº†Ture æ–­è¨€æˆåŠŸ</span><br></code></pre></td></tr></table></figure><p>å¦‚æœè¦æ‰‹åŠ¨å®Œæˆï¼Œéœ€è¦è¿™ä¹ˆåšï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python">ef fruit_bowl(): <span class="hljs-comment"># æ²¡æœ‰åŠ fixture è£…é¥°å™¨ï¼Œè¿™æ˜¯ä¸€ä¸ªæ™®é€šçš„å‡½æ•°</span><br>    <span class="hljs-keyword">return</span> [Fruit(<span class="hljs-string">&quot;apple&quot;</span>), Fruit(<span class="hljs-string">&quot;banana&quot;</span>)]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_fruit_salad</span>(<span class="hljs-params">fruit_bowl</span>):<br>    <span class="hljs-comment"># Act</span><br>    fruit_salad = FruitSalad(*fruit_bowl)<br><br>    <span class="hljs-comment"># Assert</span><br>    <span class="hljs-keyword">assert</span> <span class="hljs-built_in">all</span>(fruit.cubed <span class="hljs-keyword">for</span> fruit <span class="hljs-keyword">in</span> fruit_salad.fruit)<br>    <br><span class="hljs-comment"># Arrange</span><br>bowl = fruit_bowl() <span class="hljs-comment"># éœ€è¦åœ¨è¿™é‡Œæ‰‹åŠ¨å»è°ƒç”¨</span><br>test_fruit_salad(fruit_bowl=bowl) <span class="hljs-comment"># éœ€è¦æ‰‹åŠ¨å»è°ƒç”¨</span><br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œtest_fruit_saladâ€œè¯·æ±‚â€äº†fruit_bowl(å³def test_fruit_salad(fruit_bowl):)ï¼Œå½“pytestçœ‹åˆ°è¿™ä¸ªæ—¶ï¼Œå®ƒå°†æ‰§è¡Œfruit_bowlå›ºå®šå‡½æ•°ï¼Œå¹¶å°†å®ƒè¿”å›çš„å¯¹è±¡ä½œä¸ºfruit_bowlå‚æ•°ä¼ é€’ç»™test_fruit_saladã€‚</p><blockquote><p>å®˜æ–¹çš„è¿™é‡Œç¤ºä¾‹æè¿°çš„ä¸å¤ªå¥½ï¼Œä¼šæŠŠäººçœ‹æ™•ï¼Œçœ‹ä¸‹é¢çš„å°±å¾ˆç®€å•æ˜äº†ï¼Œå®˜æ–¹æƒ³è¡¨è¾¾çš„æ˜¯ï¼Œä½ å¦‚ä½•å®šä¹‰ä¸€ä¸ªfixtureå‡½æ•°ï¼Œç„¶åå¦‚ä½•ä½¿ç”¨å®ƒï¼Œä½ åªéœ€è¦åœ¨æµ‹è¯•å‡½æ•°çš„å…¥å‚é‡Œé¢åŠ å…¥å³å¯ï¼Œä¸éœ€è¦æ‰‹åŠ¨æ‰§è¡Œä½ å®šä¹‰çš„fixtureå‡½æ•°foo( )</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pytest<br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">foo</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_foo</span>(<span class="hljs-params">foo</span>): <span class="hljs-comment"># ä½ å¯ä»¥ä¸ç”¨å»foo()è¿™æ ·è°ƒç”¨foo åªéœ€è¦ä¼ è¿›æ¥å³å¯</span><br>    a = foo<br>    <span class="hljs-keyword">assert</span> a == <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><h3 id="4-1-2-Fixtures-ä¹Ÿå¯ä»¥è¯·æ±‚å…¶ä»–-fixturesã€é‡ç‚¹ã€‘"><a href="#4-1-2-Fixtures-ä¹Ÿå¯ä»¥è¯·æ±‚å…¶ä»–-fixturesã€é‡ç‚¹ã€‘" class="headerlink" title="4.1.2 Fixtures ä¹Ÿå¯ä»¥è¯·æ±‚å…¶ä»– fixturesã€é‡ç‚¹ã€‘"></a>4.1.2 Fixtures ä¹Ÿå¯ä»¥è¯·æ±‚å…¶ä»– fixturesã€é‡ç‚¹ã€‘</h3><p>pytestæœ€å¤§çš„ä¼˜åŠ¿ä¹‹ä¸€æ˜¯å…¶æå…¶çµæ´»çš„å¤¹å…·ç³»ç»Ÿã€‚å®ƒå…è®¸æˆ‘ä»¬å°†å¤æ‚çš„æµ‹è¯•éœ€æ±‚ç®€åŒ–ä¸ºæ›´ç®€å•å’Œæœ‰ç»„ç»‡çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬åªéœ€è¦è®©æ¯ä¸ªåŠŸèƒ½æè¿°å®ƒä»¬æ‰€ä¾èµ–çš„ä¸œè¥¿ã€‚æˆ‘ä»¬å°†åœ¨åé¢æ·±å…¥è®¨è®ºè¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯ç°åœ¨ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªå¿«é€Ÿçš„ç¤ºä¾‹æ¥æ¼”ç¤ºfixtureå¦‚ä½•ä½¿ç”¨å…¶ä»–fixture:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># contents of test_append.py</span><br><span class="hljs-keyword">import</span> pytest<br><br><span class="hljs-comment"># Arrange</span><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">first_entry</span>(): <span class="hljs-comment"># ç¬¬ä¸€ä¸ªfixture è¿”å›äº† &quot;a&quot;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;a&quot;</span><br><br><span class="hljs-comment"># Arrange</span><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">order</span>(<span class="hljs-params">first_entry</span>): <span class="hljs-comment"># orderè¿”å›äº†ä¸€ä¸ªåˆ—è¡¨ï¼Œé‡Œé¢æ˜¯first_entryçš„è¿”å›å€¼ å°±æ˜¯ [ &quot;a&quot; ]</span><br>    <span class="hljs-keyword">return</span> [first_entry]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_string</span>(<span class="hljs-params">order</span>): <span class="hljs-comment"># å¼•å…¥order æ­¤æ—¶order = [ &quot;a&quot; ]</span><br>    <span class="hljs-comment"># Act</span><br>    order.append(<span class="hljs-string">&quot;b&quot;</span>) <span class="hljs-comment"># ç»™order è¿½åŠ ä¸€ä¸ªå…ƒç´ &quot;b&quot;</span><br>    <span class="hljs-comment"># Assert</span><br>    <span class="hljs-keyword">assert</span> order == [<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;b&quot;</span>]<br></code></pre></td></tr></table></figure><p>å¦‚æœæ‰‹åŠ¨è°ƒç”¨å°±æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">first_entry</span>(): <span class="hljs-comment"># æ²¡åŠ fixture å°±æ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;a&quot;</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">order</span>(<span class="hljs-params">first_entry</span>): <span class="hljs-comment"># æ²¡åŠ fixture å°±æ˜¯ä¸€ä¸ªæ™®é€šå‡½æ•°</span><br>    <span class="hljs-keyword">return</span> [first_entry]<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_string</span>(<span class="hljs-params">order</span>):<br>    <span class="hljs-comment"># Act</span><br>    order.append(<span class="hljs-string">&quot;b&quot;</span>)<br>    <span class="hljs-comment"># Assert</span><br>    <span class="hljs-keyword">assert</span> order == [<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;b&quot;</span>]<br><br>entry = first_entry() <span class="hljs-comment"># éœ€è¦æ‰‹åŠ¨è°ƒç”¨</span><br>the_list = order(first_entry=entry) <span class="hljs-comment"># éœ€è¦æ‰‹åŠ¨è°ƒç”¨</span><br>test_string(order=the_list) <span class="hljs-comment"># éœ€è¦æ‰‹åŠ¨è°ƒç”¨</span><br></code></pre></td></tr></table></figure><h3 id="4-1-3-Fixtures-å¯ä»¥é‡å¤ä½¿ç”¨ã€é‡ç‚¹ã€‘"><a href="#4-1-3-Fixtures-å¯ä»¥é‡å¤ä½¿ç”¨ã€é‡ç‚¹ã€‘" class="headerlink" title="4.1.3 Fixtures å¯ä»¥é‡å¤ä½¿ç”¨ã€é‡ç‚¹ã€‘"></a>4.1.3 Fixtures å¯ä»¥é‡å¤ä½¿ç”¨ã€é‡ç‚¹ã€‘</h3><p><code>pytest</code>çš„<code>fixture</code>ç³»ç»Ÿå¦‚æ­¤å¼ºå¤§çš„åŸå› ä¹‹ä¸€å°±æ˜¯ï¼Œå®ƒ<strong>ä½¿æˆ‘ä»¬èƒ½å¤Ÿå®šä¹‰ä¸€ä¸ªå¯ä»¥é‡å¤ä½¿ç”¨çš„é€šç”¨è®¾ç½®æ­¥éª¤</strong>ï¼Œå°±åƒä½¿ç”¨æ™®é€šå‡½æ•°ä¸€æ ·ã€‚ä¸¤ä¸ªä¸åŒçš„æµ‹è¯•å¯ä»¥è¯·æ±‚ç›¸åŒçš„fixtureï¼Œå¹¶è®©<code>pytest</code>ä»è¯¥<code>fixture</code>ä¸ºæ¯ä¸ªæµ‹è¯•æä¾›å„è‡ªçš„ç»“æœã€‚</p><p><strong>è¿™å¯¹äºç¡®ä¿æµ‹è¯•ç”¨ä¾‹ä¸ä¼šç›¸äº’å½±å“éå¸¸æœ‰ç”¨ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªç³»ç»Ÿæ¥ç¡®ä¿æ¯ä¸ªæµ‹è¯•éƒ½è·å¾—è‡ªå·±çš„ä¸€æ‰¹æ–°é²œæ•°æ®ï¼Œå¹¶ä¸”ä»å¹²å‡€çš„çŠ¶æ€å¼€å§‹ï¼Œè¿™æ ·å®ƒå°±å¯ä»¥æä¾›ä¸€è‡´ã€å¯é‡å¤çš„ç»“æœã€‚</strong></p><p>ä½¿ç”¨çš„ç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># contents of test_append.py</span><br><span class="hljs-keyword">import</span> pytest<br><span class="hljs-comment"># è¿™é‡Œå’Œä¹‹å‰çš„ä»£ç ä¸€æ ·</span><br><span class="hljs-comment"># Arrange</span><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">first_entry</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;a&quot;</span><br><br><span class="hljs-comment"># Arrange</span><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">order</span>(<span class="hljs-params">first_entry</span>):<br>    <span class="hljs-keyword">return</span> [first_entry]<br><span class="hljs-comment"># é‡ç‚¹åœ¨è¿™ä¸‹é¢ä¸¤ä¸ªæµ‹è¯•ç”¨ä¾‹é‡Œ</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_string</span>(<span class="hljs-params">order</span>):<br>    <span class="hljs-comment"># Act</span><br>    order.append(<span class="hljs-string">&quot;b&quot;</span>) <span class="hljs-comment"># orderè¿½åŠ äº† &quot;b&quot; ä½†æ˜¯ç”¨ä¾‹ç»“æŸåæ²¡æœ‰æ”¹å˜orderï¼Œå…¶ä»–ç”¨ä¾‹ä»ç„¶ç”¨orderçš„åˆå§‹å€¼æ—¶ä½¿ç”¨ï¼Œorderä»ç„¶æ˜¯ [ &quot;a&quot; ]</span><br>    <span class="hljs-comment"># Assert</span><br>    <span class="hljs-keyword">assert</span> order == [<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;b&quot;</span>]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_int</span>(<span class="hljs-params">order</span>): <span class="hljs-comment"># ä»–ç”¨ä¾‹ä»ç„¶ç”¨orderçš„åˆå§‹å€¼æ—¶ä½¿ç”¨ï¼Œorderä»ç„¶æ˜¯ [ &quot;a&quot; ]</span><br>    <span class="hljs-comment"># Act</span><br>    order.append(<span class="hljs-number">2</span>) <span class="hljs-comment"># order è¿½åŠ äº†ä¸€ä¸ª &quot;2&quot;</span><br>    <span class="hljs-comment"># Assert</span><br>    <span class="hljs-keyword">assert</span> order == [<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-number">2</span>]<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹éƒ½è¢«èµ‹äºˆäº†è¯¥åˆ—è¡¨å¯¹è±¡çš„è‡ªå·±çš„å‰¯æœ¬ï¼Œè¿™æ„å‘³ç€<code>fixture</code>è£…ç½®å‡½æ•°è¢«æ‰§è¡Œä¸¤æ¬¡ï¼ˆå¯¹äº<code>first_entry</code>å›ºå®šè£…ç½®ä¹Ÿæ˜¯å¦‚æ­¤ï¼‰ã€‚</p><p>å¦‚æœæˆ‘ä»¬ä¹Ÿæ‰‹åŠ¨æ‰§è¡Œæ­¤æ“ä½œï¼Œå°±æ˜¯è¿™æ ·å†™çš„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">first_entry</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;a&quot;</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">order</span>(<span class="hljs-params">first_entry</span>):<br>    <span class="hljs-keyword">return</span> [first_entry]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_string</span>(<span class="hljs-params">order</span>):<br>    <span class="hljs-comment"># Act</span><br>    order.append(<span class="hljs-string">&quot;b&quot;</span>)<br>    <span class="hljs-comment"># Assert</span><br>    <span class="hljs-keyword">assert</span> order == [<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-string">&quot;b&quot;</span>]<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_int</span>(<span class="hljs-params">order</span>):<br>    <span class="hljs-comment"># Act</span><br>    order.append(<span class="hljs-number">2</span>)<br>    <span class="hljs-comment"># Assert</span><br>    <span class="hljs-keyword">assert</span> order == [<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-number">2</span>]<br><br>entry = first_entry() <span class="hljs-comment"># </span><br>the_list = order(first_entry=entry)<br>test_string(order=the_list)<br><br><span class="hljs-comment"># é‡ç‚¹åœ¨è¿™é‡Œï¼Œè¿™é‡Œå†æ¬¡entry = first_entry() æ˜¯å› ä¸ºå‰é¢çš„entryå·²ç»è¢«æ”¹å˜äº†ï¼Œå˜æˆäº†[&quot;a&quot;, &quot;b&quot;]ï¼Œä¸èƒ½ä½¿ç”¨äº†ï¼Œéœ€è¦ä¸€ä¸ªæ–°çš„entry = first_entry()ä¹Ÿå°±æ˜¯[ &quot;a&quot; ]</span><br>entry = first_entry() <br>the_list = order(first_entry=entry)<br>test_int(order=the_list)<br></code></pre></td></tr></table></figure><h3 id="4-1-4-ä¸€ä¸ª-testæˆ–è€…fixtureå¯ä»¥åŒæ—¶è¯·æ±‚å¤šä¸ªfixtureã€é‡ç‚¹ã€‘"><a href="#4-1-4-ä¸€ä¸ª-testæˆ–è€…fixtureå¯ä»¥åŒæ—¶è¯·æ±‚å¤šä¸ªfixtureã€é‡ç‚¹ã€‘" class="headerlink" title="4.1.4 ä¸€ä¸ª testæˆ–è€…fixtureå¯ä»¥åŒæ—¶è¯·æ±‚å¤šä¸ªfixtureã€é‡ç‚¹ã€‘"></a>4.1.4 ä¸€ä¸ª testæˆ–è€…fixtureå¯ä»¥åŒæ—¶è¯·æ±‚å¤šä¸ªfixtureã€é‡ç‚¹ã€‘</h3><p>æµ‹è¯•ç”¨ä¾‹å’Œfixtureè£…ç½®ä¸é™äºä¸€æ¬¡è¯·æ±‚ä¸€ä¸ªfixtureè£…ç½®ã€‚ä»–ä»¬å¯ä»¥è¦æ±‚ä»»æ„æ•°é‡çš„ã€‚</p><p>è¿™æ˜¯å¦ä¸€ä¸ªæ¼”ç¤ºçš„ç®€å•ç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># contents of test_append.py</span><br><span class="hljs-keyword">import</span> pytest<br><br><br><span class="hljs-comment"># Arrange</span><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">first_entry</span>(): <span class="hljs-comment"># first_entry() = &quot;a&quot;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;a&quot;</span><br><br><span class="hljs-comment"># Arrange</span><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">second_entry</span>(): <span class="hljs-comment">#  second_entry()= 2</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">2</span><br><span class="hljs-comment"># Arrange</span><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">order</span>(<span class="hljs-params">first_entry, second_entry</span>):  <br>    <span class="hljs-comment"># é‡ç‚¹åœ¨è¿™ä¸ªfixtureè£…ç½®é‡Œï¼Œè¿™é‡Œä¸ä»…å¯ä»¥ä½¿ç”¨å…¶ä»–fixture è¿˜å¯ä»¥ä½¿ç”¨å¤šä¸ªå…¶ä»–fixture</span><br>    <span class="hljs-keyword">return</span> [first_entry, second_entry] <span class="hljs-comment"># # æ‰€ä»¥order() = [&quot;a&quot;, 2]</span><br><br><span class="hljs-comment"># Arrange</span><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">expected_list</span>(): <span class="hljs-comment">#  second_entry()= [&quot;a&quot;, 2, 3.0]</span><br>    <span class="hljs-keyword">return</span> [<span class="hljs-string">&quot;a&quot;</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3.0</span>]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_string</span>(<span class="hljs-params">order, expected_list</span>):<br>    <span class="hljs-comment"># Act</span><br>    order.append(<span class="hljs-number">3.0</span>)<br><br>    <span class="hljs-comment"># Assert</span><br>    <span class="hljs-keyword">assert</span> order == expected_list <span class="hljs-comment">#orderæœ¬æ¥æ˜¯[&quot;a&quot;, 2]è¿½åŠ äº†ä¸€ä¸ª3.0 æ‰€ä»¥æ–­è¨€è‚¯å®šæˆåŠŸ</span><br></code></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œè®²çš„å‡ ä¸ªè¿˜æ˜¯æ¯”è¾ƒé‡è¦çš„</p><p>1ã€å¦‚ä½•ä½¿ç”¨fixture</p></blockquote><h3 id="4-1-5-æ¯æ¬¡æµ‹è¯•å¯ä»¥å¤šæ¬¡è¯·æ±‚fixtureå¤¹å…·ï¼ˆè¿”å›å€¼è¢«ç¼“å­˜ï¼‰"><a href="#4-1-5-æ¯æ¬¡æµ‹è¯•å¯ä»¥å¤šæ¬¡è¯·æ±‚fixtureå¤¹å…·ï¼ˆè¿”å›å€¼è¢«ç¼“å­˜ï¼‰" class="headerlink" title="4.1.5 æ¯æ¬¡æµ‹è¯•å¯ä»¥å¤šæ¬¡è¯·æ±‚fixtureå¤¹å…·ï¼ˆè¿”å›å€¼è¢«ç¼“å­˜ï¼‰"></a>4.1.5 æ¯æ¬¡æµ‹è¯•å¯ä»¥å¤šæ¬¡è¯·æ±‚fixtureå¤¹å…·ï¼ˆè¿”å›å€¼è¢«ç¼“å­˜ï¼‰</h3><p>åœ¨åŒä¸€æµ‹è¯•ç”¨ä¾‹æœŸé—´ä¹Ÿå¯ä»¥å¤šæ¬¡è¯·æ±‚fixtureå¤¹å…·å‡½æ•°,ã€</p><p>å¹¶ä¸” pytest ä¸ä¼šåœ¨è¯¥æµ‹è¯•ä¸­å†æ¬¡æ‰§è¡Œå®ƒä»¬,</p><p>æ„å‘³ç€æˆ‘ä»¬å¯ä»¥åœ¨ä¾èµ–äºå®ƒä»¬çš„å¤šä¸ªfixtureè£…ç½®ä¸­è¯·æ±‚å…¶ä»–fixtureè£…ç½®ï¼ˆç”šè‡³åœ¨æµ‹è¯•æœ¬èº«ä¸­å†æ¬¡è¯·æ±‚fixtureè£…ç½®ï¼‰ï¼Œè€Œæ— éœ€å¤šæ¬¡æ‰§è¡Œè¿™äº›fixtureè£…ç½®ã€‚â€”-çœ‹ç€æœ‰ç‚¹ç»•å…ˆä¸ç®¡ï¼Œæ¥ç€å¾€ä¸‹çœ‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># contents of test_append.py</span><br><span class="hljs-keyword">import</span> pytest<br><br><br><span class="hljs-comment"># Arrange</span><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">first_entry</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;å¦‚æœè¿è¡Œäº†<span class="hljs-subst">&#123;first_entry.__name__&#125;</span>å°±ä¼šæ‰“å°è¿™å¥è¯&quot;</span>)<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;a&quot;</span><br><span class="hljs-comment"># Arrange</span><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">order</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;å¦‚æœè¿è¡Œäº†<span class="hljs-subst">&#123;order.__name__&#125;</span>å°±ä¼šæ‰“å°è¿™å¥è¯&quot;</span>)<br>    <span class="hljs-keyword">return</span> []<br><span class="hljs-comment"># Act</span><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">append_first</span>(<span class="hljs-params">order, first_entry</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;å¦‚æœè¿è¡Œäº†<span class="hljs-subst">&#123;append_first.__name__&#125;</span>å°±ä¼šæ‰“å°è¿™å¥è¯&quot;</span>)<br>    <span class="hljs-keyword">return</span> order.append(first_entry)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_string_only</span>(<span class="hljs-params">append_first, order, first_entry</span>):<br>    <span class="hljs-comment"># Assert</span><br>    <span class="hljs-built_in">print</span>(order) <span class="hljs-comment"># è¿™ä¸ªæ—¶å€™orderå·²ç»è¢«æ”¹å˜äº†ï¼Œå·²ç»æ˜¯[&quot;a&quot;]äº†è€Œä¸æ˜¯[]</span><br>    <span class="hljs-built_in">print</span>(first_entry) <span class="hljs-comment"># a </span><br>    <span class="hljs-keyword">assert</span> order == [first_entry]<br><span class="hljs-comment"># æ‰€ä»¥å½“fixtureåœ¨fixtureå’Œtest_ä¹‹é—´æ··åˆä½¿ç”¨æ—¶æ˜¯ä¼šæœ‰ç¼“å­˜çš„ï¼Œæœ€åæ±‡æ€»åˆ°ä¸€èµ·</span><br></code></pre></td></tr></table></figure><p>å¦‚æœåœ¨æµ‹è¯•æœŸé—´æ¯æ¬¡è¯·æ±‚æ—¶éƒ½æ‰§è¡Œä¸€æ¬¡æ‰€å®šä¹‰çš„fixtureè£…ç½®çš„è¯ ï¼Œé‚£ä¹ˆè¿™ä¸ªæµ‹è¯•å°±ä¼šå¤±è´¥,ã€</p><p>å› ä¸º<code>append_first</code>æ–¹æ³•å’Œ<code>test_string_only</code>ç”¨ä¾‹éƒ½ä¼šå°†<code>order</code>è§†ä¸ºä¸€ä¸ªç©ºåˆ—è¡¨(å¦‚[ ]),</p><p>ä½†ç”±äº <code>order</code> çš„è¿”å›å€¼åœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨åè¢«ç¼“å­˜ï¼ˆä»¥åŠæ‰§è¡Œå®ƒå¯èƒ½äº§ç”Ÿçš„ä»»ä½•å‰¯ä½œç”¨ï¼‰ï¼Œæµ‹è¯•ç”¨ä¾‹åˆ¤æ–­äº†<code>append_first</code>å¯¹è¯¥å¯¹è±¡çš„å½±å“ã€‚</p><blockquote><p>è¿™é‡Œå®˜æ–¹æƒ³è¡¨è¾¾çš„æ˜¯ï¼Œfixtureåœ¨fixtureå’Œtest_ä¹‹é—´æ··åˆä½¿ç”¨ä¸ä¼šé‡å¤æ‰§è¡Œï¼Œçœ‹ä¸€ä¸‹ç»ˆç«¯è¾“å‡ºç»“æœä¼šæ›´æ¸…æ™°</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python">================================================================================ test session starts ================================================================================<br>platform linux -- Python <span class="hljs-number">3.10</span><span class="hljs-number">.12</span>, pytest-<span class="hljs-number">8.1</span><span class="hljs-number">.1</span>, pluggy-<span class="hljs-number">1.4</span><span class="hljs-number">.0</span><br><br>plugins: anyio-<span class="hljs-number">4.2</span><span class="hljs-number">.0</span><br>collected <span class="hljs-number">1</span> item                                                                                                                                                                    <br><br>testcases/test_fixturestest.py <br>å¦‚æœè¿è¡Œäº†orderå°±ä¼šæ‰“å°è¿™å¥è¯<br>å¦‚æœè¿è¡Œäº†first_entryå°±ä¼šæ‰“å°è¿™å¥è¯<br>å¦‚æœè¿è¡Œäº†append_firstå°±ä¼šæ‰“å°è¿™å¥è¯<br>[<span class="hljs-string">&#x27;a&#x27;</span>]<br>a<br>.<br><br>================================================================================= <span class="hljs-number">1</span> passed <span class="hljs-keyword">in</span> <span class="hljs-number">0.01</span>s =================================================================================<br></code></pre></td></tr></table></figure><p><strong>è¿™é‡Œçš„æ¯æ®µprint( xxx )ï¼Œéƒ½åªè¢«æ‰“å°äº†ä¸€æ¬¡ï¼Œå¦‚æœä¼šé‡å¤æ‰§è¡Œçš„è¯ï¼Œå°±ä¼šæ‰“å°å¤šæ¬¡äº†ã€‚</strong></p><h2 id="4-2-è‡ªåŠ¨ä½¿ç”¨fixtueï¼ˆä¸å¿…ä¸»åŠ¨è¯·æ±‚çš„fixtureï¼‰"><a href="#4-2-è‡ªåŠ¨ä½¿ç”¨fixtueï¼ˆä¸å¿…ä¸»åŠ¨è¯·æ±‚çš„fixtureï¼‰" class="headerlink" title="4.2 è‡ªåŠ¨ä½¿ç”¨fixtueï¼ˆä¸å¿…ä¸»åŠ¨è¯·æ±‚çš„fixtureï¼‰"></a>4.2 è‡ªåŠ¨ä½¿ç”¨fixtueï¼ˆä¸å¿…ä¸»åŠ¨è¯·æ±‚çš„fixtureï¼‰</h2><p>æµ‹è¯•ä¸­æœ‰æ—¶å¯èƒ½æƒ³è¦æœ‰ä¸€ä¸ªï¼ˆç”šè‡³å‡ ä¸ªï¼‰è®©æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹éƒ½ä¾èµ–çš„<code>fixture</code>è£…ç½®ï¼Œ</p><p>è‡ªåŠ¨ä½¿ç”¨<code>fixture</code>è£…ç½®æ˜¯ä¸€ç§è®©æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹éƒ½è‡ªåŠ¨è¯·æ±‚å®ƒä»¬çš„ä¾¿æ·æ–¹æ³•ã€‚è¿™å¯ä»¥æ¶ˆé™¤å¤§é‡å†—ä½™çš„è¯·æ±‚ï¼Œç”šè‡³å¯ä»¥æä¾›æ›´é«˜çº§çš„å¤¹å…·ä½¿ç”¨ï¼ˆæ›´å¤šå†…å®¹è¯·å‚è§ä¸‹æ–‡ï¼‰</p><p>å¯ä»¥é€šè¿‡å°† <code>autouse=True</code> ä¼ é€’ç»™è£…é¥°å™¨<code>pytest.fixture</code>æ¥ä½¿<code>fixture</code>æˆä¸ºè‡ªåŠ¨ä½¿ç”¨çš„<code>fixture</code>ã€‚</p><p>ä»£ç ç®€å•ç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># contents of test_append.py</span><br><span class="hljs-keyword">import</span> pytest<br><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">first_entry</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;a&quot;</span><br><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">order</span>(<span class="hljs-params">first_entry</span>): <span class="hljs-comment"># è¿™é‡Œçš„first_entry,åªæ˜¯å®šä¹‰äº†ä¸€ä¸ªå½¢å‚ï¼Œå¯ä»¥éšä¾¿ä¼ å‚ï¼Œ</span><br>    <span class="hljs-comment"># æ¢ä¸€ä¸ªå†™æ³•å°±æ˜¯ def order(argument:first_entry):è¿™æ ·å¯ä»¥çœ‹çš„æ›´æ¸…æ™°</span><br>    <span class="hljs-keyword">return</span> []<br><br><span class="hljs-meta">@pytest.fixture(<span class="hljs-params">autouse=<span class="hljs-literal">True</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">append_first</span>(<span class="hljs-params">order, first_entry</span>):<br>    <span class="hljs-keyword">return</span> order.append(first_entry)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_string_only</span>(<span class="hljs-params">order, first_entry</span>):  <span class="hljs-comment"># æ˜æ˜æ²¡æœ‰å¼•ç”¨ append_firstï¼Œå´äº§ç”Ÿäº†æ•ˆæœï¼Œ</span><br>    <span class="hljs-comment"># è¿™é‡Œå°±ä¼šæƒ³å‘€ï¼Œorder ä¸æ˜¯ä¸€ä¸ªç©ºåˆ—è¡¨å—ï¼Ÿä½¿ç”¨äº† append_first æ‰ä¼šå¿˜orderé‡Œé¢æ·»åŠ  first_entryï¼Œ</span><br>    <span class="hljs-comment"># è¿™å°±æ˜¯ autouse=True çš„ä½œç”¨ ï¼Œéšå¼çš„ä½¿ç”¨äº† append_first</span><br>    <span class="hljs-built_in">print</span>(order) <span class="hljs-comment"># [&#x27;a&#x27;]</span><br>    <span class="hljs-keyword">assert</span> order == [first_entry]<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_string_and_int</span>(<span class="hljs-params">order, first_entry</span>):<br>    order.append(<span class="hljs-number">2</span>)<br>    <span class="hljs-comment"># è¿™é‡Œå°±è·Ÿæ˜æ˜¾äº†ï¼Œarder é‡Œé¢æ·»åŠ äº† 2ï¼Œæœ¬åº”è¯¥æ˜¯[2]çš„ï¼Œä½†æ˜¯æ‰“å°å‡ºæ¥æ˜¯[&quot;a&quot;, 2]ï¼Œå› ä¸ºéšæ–¹çš„è°ƒç”¨äº† append_firstå¾€orderé‡Œé¢æ·»åŠ äº†first_entry &quot;a&quot;</span><br>    <span class="hljs-built_in">print</span>(order) <span class="hljs-comment"># [&#x27;a&#x27;, 2]</span><br>    <span class="hljs-keyword">assert</span> order == [first_entry, <span class="hljs-number">2</span>]<br><br></code></pre></td></tr></table></figure><p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œ<code>append_first</code> å›ºå®šè£…ç½®æ˜¯è‡ªåŠ¨ä½¿ç”¨å›ºå®šè£…ç½®ã€‚å› ä¸ºå®ƒæ˜¯è‡ªåŠ¨å‘ç”Ÿçš„ï¼Œæ‰€ä»¥ä¸¤ä¸ªæµ‹è¯•éƒ½ä¼šå—åˆ°å®ƒçš„å½±å“ï¼Œå³ä½¿ä¸¤ä¸ªæµ‹è¯•éƒ½æ²¡æœ‰è¯·æ±‚å®ƒã€‚ä½†è¿™å¹¶ä¸æ„å‘³ç€ä»–ä»¬ä¸èƒ½è¢«è¯·æ±‚ï¼›åªæ˜¯æ²¡æœ‰å¿…è¦å†™ç½¢äº†â€”-&gt;<strong>éšå¼ä¼ é€’</strong></p><h2 id="4-3-ä½œç”¨åŸŸï¼šè·¨ç±»ã€æ¨¡å—ã€åŒ…æˆ–ä¼šè¯å…±äº«fixtureã€é‡ç‚¹ã€‘"><a href="#4-3-ä½œç”¨åŸŸï¼šè·¨ç±»ã€æ¨¡å—ã€åŒ…æˆ–ä¼šè¯å…±äº«fixtureã€é‡ç‚¹ã€‘" class="headerlink" title="4.3 ä½œç”¨åŸŸï¼šè·¨ç±»ã€æ¨¡å—ã€åŒ…æˆ–ä¼šè¯å…±äº«fixtureã€é‡ç‚¹ã€‘"></a>4.3 ä½œç”¨åŸŸï¼šè·¨ç±»ã€æ¨¡å—ã€åŒ…æˆ–ä¼šè¯å…±äº«fixtureã€é‡ç‚¹ã€‘</h2><h3 id="4-3-1ç†è§£fixture-ä½œç”¨åŸŸã€é‡ç‚¹ã€‘"><a href="#4-3-1ç†è§£fixture-ä½œç”¨åŸŸã€é‡ç‚¹ã€‘" class="headerlink" title="4.3.1ç†è§£fixture ä½œç”¨åŸŸã€é‡ç‚¹ã€‘"></a>4.3.1ç†è§£fixture ä½œç”¨åŸŸã€é‡ç‚¹ã€‘</h3><p>éœ€è¦ç½‘ç»œè®¿é—®çš„<code>fixtures</code>å–å†³äºè¿æ¥æ€§ï¼Œå¹¶ä¸”åˆ›å»ºèµ·æ¥é€šå¸¸éå¸¸è€—æ—¶ã€‚</p><p>æ‰©å±•å‰é¢çš„ä¾‹å­</p><p>æˆ‘ä»¬å¯ä»¥åœ¨ <code>@pytest.fixture </code>è°ƒç”¨ä¸­æ·»åŠ ä¸€ä¸ª <code>scope=&quot;module&quot; </code>å‚æ•°æ¥å¼•å‘ smtp_connection å›ºå®šåŠŸèƒ½ï¼Œè´Ÿè´£åˆ›å»ºåˆ°é¢„å…ˆå­˜åœ¨çš„ SMTP æœåŠ¡å™¨çš„è¿æ¥ï¼Œ</p><p>æ¯ä¸ªæµ‹è¯•æ¨¡å—ä»…è°ƒç”¨ä¸€æ¬¡ï¼ˆé»˜è®¤ä¸ºæ¯ä¸ªæµ‹è¯•å‡½æ•°è°ƒç”¨ä¸€æ¬¡ï¼‰ã€‚</p><p>å› æ­¤ï¼Œæµ‹è¯•æ¨¡å—ä¸­çš„å¤šä¸ªæµ‹è¯•å‡½æ•°å°†å„è‡ªæ¥æ”¶ç›¸åŒçš„ smtp_connection å¤¹å…·å®ä¾‹ï¼Œä»è€ŒèŠ‚çœæ—¶é—´</p><p>èŒƒå›´çš„å¯èƒ½å€¼ä¸ºï¼šå‡½æ•°ã€ç±»ã€æ¨¡å—ã€åŒ…æˆ–ä¼šè¯ã€‚</p><p>ä¸‹ä¸€ä¸ªç¤ºä¾‹å°†fixtureå‡½æ•°æ”¾å…¥å•ç‹¬çš„conftest.pyæ–‡ä»¶ä¸­ï¼Œä»¥ä¾¿ç›®å½•ä¸­å¤šä¸ªæµ‹è¯•æ¨¡å—çš„æµ‹è¯•å¯ä»¥è®¿é—®fixtureå‡½æ•°ï¼š</p><blockquote><p>å®˜æ–¹çš„ä»£ç æœ‰ç‚¹çœ‹çš„ä¸æ˜¯ç‰¹åˆ«æ¸…æ™°ï¼Œå¯ä»¥ç›´æ¥çœ‹ä¸‹é¢ä»£ç </p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># content of conftest.py</span><br><span class="hljs-keyword">import</span> smtplib<br><br><span class="hljs-keyword">import</span> pytest<br><br><br><span class="hljs-meta">@pytest.fixture(<span class="hljs-params">scope=<span class="hljs-string">&quot;module&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">smtp_connection</span>():<br>    <span class="hljs-keyword">return</span> smtplib.SMTP(<span class="hljs-string">&quot;smtp.gmail.com&quot;</span>, <span class="hljs-number">587</span>, timeout=<span class="hljs-number">5</span>)<br><span class="hljs-comment"># content of test_module.py</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_ehlo</span>(<span class="hljs-params">smtp_connection</span>):<br>    response, msg = smtp_connection.ehlo()<br>    <span class="hljs-keyword">assert</span> response == <span class="hljs-number">250</span><br>    <span class="hljs-keyword">assert</span> <span class="hljs-string">b&quot;smtp.gmail.com&quot;</span> <span class="hljs-keyword">in</span> msg<br>    <span class="hljs-keyword">assert</span> <span class="hljs-number">0</span>  <span class="hljs-comment"># for demo purposes</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_noop</span>(<span class="hljs-params">smtp_connection</span>):<br>    response, msg = smtp_connection.noop()<br>    <span class="hljs-keyword">assert</span> response == <span class="hljs-number">250</span><br>    <span class="hljs-keyword">assert</span> <span class="hljs-number">0</span>  <span class="hljs-comment"># for demo purposes</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œï¼Œtest_ehlo éœ€è¦ smtp_connection å›ºå®šå€¼ã€‚ pytest å°†å‘ç°å¹¶è°ƒç”¨ @pytest.fixture æ ‡è®°çš„ smtp_connection å›ºå®šåŠŸèƒ½ã€‚è¿è¡Œæµ‹è¯•å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python">$ pytest test_module.py<br>=========================== test session starts ============================<br>platform linux -- Python <span class="hljs-number">3.</span>x.y, pytest-<span class="hljs-number">8.</span>x.y, pluggy-<span class="hljs-number">1.</span>x.y<br>rootdir: /home/sweet/project<br>collected <span class="hljs-number">2</span> items<br><br>test_module.py FF                                                    [<span class="hljs-number">100</span>%]<br><br>================================= FAILURES =================================<br>________________________________ test_ehlo _________________________________<br><br>smtp_connection = &lt;smtplib.SMTP <span class="hljs-built_in">object</span> at <span class="hljs-number">0xdeadbeef0001</span>&gt;<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_ehlo</span>(<span class="hljs-params">smtp_connection</span>):<br>        response, msg = smtp_connection.ehlo()<br>        <span class="hljs-keyword">assert</span> response == <span class="hljs-number">250</span><br>        <span class="hljs-keyword">assert</span> <span class="hljs-string">b&quot;smtp.gmail.com&quot;</span> <span class="hljs-keyword">in</span> msg<br>&gt;       <span class="hljs-keyword">assert</span> <span class="hljs-number">0</span>  <span class="hljs-comment"># for demo purposes</span><br>E       <span class="hljs-keyword">assert</span> <span class="hljs-number">0</span><br><br>test_module.py:<span class="hljs-number">7</span>: AssertionError<br>________________________________ test_noop _________________________________<br><br>smtp_connection = &lt;smtplib.SMTP <span class="hljs-built_in">object</span> at <span class="hljs-number">0xdeadbeef0001</span>&gt;<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_noop</span>(<span class="hljs-params">smtp_connection</span>):<br>        response, msg = smtp_connection.noop()<br>        <span class="hljs-keyword">assert</span> response == <span class="hljs-number">250</span><br>&gt;       <span class="hljs-keyword">assert</span> <span class="hljs-number">0</span>  <span class="hljs-comment"># for demo purposes</span><br>E       <span class="hljs-keyword">assert</span> <span class="hljs-number">0</span><br><br>test_module.py:<span class="hljs-number">13</span>: AssertionError<br>========================= short test summary info ==========================<br>FAILED test_module.py::test_ehlo - <span class="hljs-keyword">assert</span> <span class="hljs-number">0</span><br>FAILED test_module.py::test_noop - <span class="hljs-keyword">assert</span> <span class="hljs-number">0</span><br>============================ <span class="hljs-number">2</span> failed <span class="hljs-keyword">in</span> <span class="hljs-number">0.12</span>s =============================<br></code></pre></td></tr></table></figure><p>æ‚¨ä¼šçœ‹åˆ°ä¸¤ä¸ªæ–­è¨€ 0 å¤±è´¥ï¼Œæ›´é‡è¦çš„æ˜¯æ‚¨è¿˜å¯ä»¥çœ‹åˆ°å®Œå…¨ç›¸åŒçš„ smtp_connection å¯¹è±¡è¢«ä¼ é€’åˆ°ä¸¤ä¸ªæµ‹è¯•å‡½æ•°ä¸­ï¼Œå› ä¸º pytest åœ¨å›æº¯ä¸­æ˜¾ç¤ºä¼ å…¥çš„å‚æ•°å€¼ã€‚å› æ­¤ï¼Œä½¿ç”¨ smtp_connection çš„ä¸¤ä¸ªæµ‹è¯•å‡½æ•°è¿è¡Œé€Ÿåº¦ä¸å•ä¸ªæµ‹è¯•å‡½æ•°ä¸€æ ·å¿«ï¼Œå› ä¸ºå®ƒä»¬é‡å¤ä½¿ç”¨ç›¸åŒçš„å®ä¾‹ã€‚</p><p>ä¸¤ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œè™½ç„¶éƒ½å¼•å…¥çš„è¿™ä¸ªfixtureï¼Œä½†æ˜¯ï¼Œå…¶å®è¿™ä¸ªfixtureæ˜¯åªè¿è¡Œäº†ä¸€æ¬¡ï¼Œæ²¡æœ‰è¢«é‡å¤çš„è¿è¡Œï¼Œè€Œä¸”åªåœ¨æ¨¡å—çº§åˆ«è¿è¡Œï¼Œå‡å¦‚è¿™ä¸ªfixtureæ˜¯å‡½æ•°çº§åˆ«çš„ï¼Œé‚£å°±æ˜¯æ¯ä¸ªæµ‹è¯•æ–¹æ³•å•ç‹¬è¿è¡Œä¸€æ¬¡ï¼ŒåŒç†ï¼Œå‡å¦‚æ˜¯ç±»çº§åˆ«çš„ï¼Œé‚£å°±æ˜¯æ¯ä¸ªç±»å•ç‹¬è¿è¡Œä¸€æ¬¡ï¼Œä¸‹é¢ä¼šä»‹ç»æ‰€æœ‰çº§åˆ«</p><blockquote><p>çœ‹ä¸‹é¢çš„ä»£ç å¯ä»¥æ›´æ¸…æ™°</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;è¿™ä¸ªç±»ï¼Œå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è¢«å®ä¾‹åŒ–å¯¹è±¡ï¼Œageçš„å€¼å°±æ˜¯1ï¼Œå¦‚æœæ˜¯ç¬¬äºŒæ¬¡ï¼Œageå¾—å€¼å°±æ˜¯2&quot;&quot;&quot;</span><br>    instance_count = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        MyClass.instance_count += <span class="hljs-number">1</span><br>        self.age = MyClass.instance_count<br><br><br><span class="hljs-meta">@pytest.fixture(<span class="hljs-params">scope=<span class="hljs-string">&quot;module&quot;</span></span>) </span><span class="hljs-comment"># æ¨¡å—çº§åˆ«</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">module_test</span>():<br>    Tom = MyClass()<br>    <span class="hljs-keyword">return</span> Tom <span class="hljs-comment"># è¿”å›ç±»çš„å®ä¾‹åŒ–å¯¹è±¡çš„ageå±æ€§</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_ehlo</span>(<span class="hljs-params">module_test</span>):<br>    TestTom = module_test<br>    <span class="hljs-keyword">assert</span> TestTom.age == <span class="hljs-number">1</span> <span class="hljs-comment"># è¿™ä¸ªæµ‹è¯•ç”¨ä¾‹å’Œä¸‹é¢çš„æµ‹è¯•ç”¨ä¾‹ï¼Œè¿”å›çš„æ˜¯åŒä¸€ä¸ªå®ä¾‹åŒ–å¯¹è±¡ï¼Œæ‰€ä»¥ageçš„å€¼éƒ½æ˜¯1</span><br><br><span class="hljs-comment"># è¯´ç™½äº†ï¼Œå°±æ˜¯è¿™ä¸¤ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œä½¿ç”¨çš„éƒ½æ˜¯åŒä¸€ä¸ªå®ä¾‹åŒ–å¯¹è±¡ï¼Œ</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_noop</span>(<span class="hljs-params">module_test</span>):<br>    TestTom = module_test<br>    <span class="hljs-keyword">assert</span> TestTom.age == <span class="hljs-number">1</span> <br></code></pre></td></tr></table></figure><blockquote><p>å¦‚æœæ”¹ä¸€ä¸‹ï¼Œæ”¹æˆfunction çº§åˆ«çš„å‘¢ï¼Ÿæµ‹è¯•ç”¨ä¾‹å°±ä¸ä¼šé€šè¿‡</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;è¿™ä¸ªç±»ï¼Œå¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è¢«å®ä¾‹åŒ–å¯¹è±¡ï¼Œageçš„å€¼å°±æ˜¯1ï¼Œå¦‚æœæ˜¯ç¬¬äºŒæ¬¡ï¼Œageå¾—å€¼å°±æ˜¯2&quot;&quot;&quot;</span><br>    instance_count = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        MyClass.instance_count += <span class="hljs-number">1</span><br>        self.age = MyClass.instance_count<br><br><br><span class="hljs-meta">@pytest.fixture(<span class="hljs-params">scope=<span class="hljs-string">&quot;function&quot;</span></span>) </span><span class="hljs-comment"># æ¨¡å—çº§åˆ«</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">module_test</span>():<br>    Tom = MyClass()<br>    <span class="hljs-keyword">return</span> Tom <span class="hljs-comment"># è¿”å›ç±»çš„å®ä¾‹åŒ–å¯¹è±¡çš„ageå±æ€§</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_ehlo</span>(<span class="hljs-params">module_test</span>):<br>    TestTom = module_test<br>    <span class="hljs-keyword">assert</span> TestTom.age == <span class="hljs-number">1</span> <span class="hljs-comment"># è¿™ä¸ªæµ‹è¯•ç”¨ä¾‹å’Œä¸‹é¢çš„æµ‹è¯•ç”¨ä¾‹ï¼Œè¿”å›çš„æ˜¯åŒä¸€ä¸ªå®ä¾‹åŒ–å¯¹è±¡ï¼Œæ‰€ä»¥ageçš„å€¼éƒ½æ˜¯1</span><br><br><span class="hljs-comment"># è¯´ç™½äº†ï¼Œå°±æ˜¯è¿™ä¸¤ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œä½¿ç”¨çš„éƒ½æ˜¯åŒä¸€ä¸ªå®ä¾‹åŒ–å¯¹è±¡ï¼Œ</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_noop</span>(<span class="hljs-params">module_test</span>):<br>    TestTom = module_test<br>    <span class="hljs-keyword">assert</span> TestTom.age == <span class="hljs-number">1</span> <br><br></code></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python">================================ FAILURES =================================================<br>________________________________ test_noop _________________________________________<br><br>module_test = &lt;test_fixturestest.MyClass <span class="hljs-built_in">object</span> at <span class="hljs-number">0x7f0eeb976b60</span>&gt;<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_noop</span>(<span class="hljs-params">module_test</span>):<br>        TestTom = module_test<br>&gt;       <span class="hljs-keyword">assert</span> TestTom.age == <span class="hljs-number">1</span><br>E       <span class="hljs-keyword">assert</span> <span class="hljs-number">2</span> == <span class="hljs-number">1</span><br>E        +  where <span class="hljs-number">2</span> = &lt;test_fixturestest.MyClass <span class="hljs-built_in">object</span> at <span class="hljs-number">0x7f0eeb976b60</span>&gt;.age<br><br>testcases/test_fixturestest.py:<span class="hljs-number">206</span>: AssertionError<br>======================= short test summary info ===========================================<br>FAILED testcases/test_fixturestest.py::test_noop - <span class="hljs-keyword">assert</span> <span class="hljs-number">2</span> == <span class="hljs-number">1</span><br>============================ <span class="hljs-number">1</span> failed, <span class="hljs-number">1</span> passed <span class="hljs-keyword">in</span> <span class="hljs-number">0.01</span>s ==============================<br></code></pre></td></tr></table></figure><p>å¦‚æœæ‚¨å†³å®šå¸Œæœ›æ‹¥æœ‰ä¸€ä¸ªä¼šè¯èŒƒå›´çš„ smtp_connection å®ä¾‹ï¼Œæ‚¨å¯ä»¥ç®€å•åœ°å£°æ˜å®ƒï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@pytest.fixture(<span class="hljs-params">scope=<span class="hljs-string">&quot;session&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">smtp_connection</span>():<br>    <span class="hljs-comment"># the returned fixture value will be shared for</span><br>    <span class="hljs-comment"># all tests requesting it</span><br>    ...<br></code></pre></td></tr></table></figure><h3 id="4-3-2-Fixture-ä½œç”¨åŸŸèŒƒå›´ã€é‡ç‚¹ã€‘"><a href="#4-3-2-Fixture-ä½œç”¨åŸŸèŒƒå›´ã€é‡ç‚¹ã€‘" class="headerlink" title="4.3.2 Fixture ä½œç”¨åŸŸèŒƒå›´ã€é‡ç‚¹ã€‘"></a>4.3.2 Fixture ä½œç”¨åŸŸèŒƒå›´ã€é‡ç‚¹ã€‘</h3><p>å¤¹å…·åœ¨æµ‹è¯•é¦–æ¬¡è¯·æ±‚æ—¶åˆ›å»ºï¼Œå¹¶æ ¹æ®å…¶èŒƒå›´é”€æ¯ï¼š</p><ul><li><code>function</code>: é»˜è®¤èŒƒå›´ï¼Œfixtureåœ¨æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ç»“æŸæ—¶é”€æ¯ã€‚.</li><li><code>class</code>: è¯¥fixtureåœ¨classæœ€åä¸€æ¬¡æµ‹è¯•çš„æµ‹è¯•ç”¨ä¾‹æ—¶è¢«é”€æ¯ã€‚</li><li><code>module</code>: æ¨¡å—çº§åˆ«ï¼ˆpyæ–‡ä»¶ï¼‰</li><li><code>package</code>: åŒ…çº§åˆ«ï¼ˆæ–‡ä»¶å¤¹ï¼‰</li><li><code>session</code>: ä¼šè¯çº§åˆ«ï¼ˆæ•´åœºæµ‹è¯•ï¼‰</li></ul><p>æ¨¡å—çº§åˆ«ã€åŒ…çº§åˆ«ã€ä¼šè¯çº§åˆ«ä¹Ÿæ˜¯ä¸€æ ·ï¼Œå› ä¸ºfixtureæ˜¯åœ¨conftest.pyæ–‡ä»¶é‡Œå†™çš„ï¼Œè¿™ä¸ªæ–‡ä»¶æ˜¯æ”¾åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹çš„ï¼Œä½ çš„æµ‹è¯•ç”¨ä¾‹ï¼Œä¸ä¸€å®šå…¨éƒ½æ˜¯æ”¾åœ¨ä¸€ä¸ªæ¨¡å—å†…ï¼ˆpyæ–‡ä»¶ï¼‰ä¸€ä¸ªåŒ…å†…ï¼ˆæ–‡ä»¶å¤¹ï¼‰ï¼Œä¼šè¯çº§åˆ«çš„æ„æ€å°±æ˜¯æ•´åœºæµ‹è¯•ç”¨ä¾‹çš„çº§åˆ«ã€‚</p><blockquote><p>Pytest ä¸€æ¬¡ä»…ç¼“å­˜fixtureè£…ç½®çš„ä¸€ä¸ªå®ä¾‹ï¼Œè¿™æ„å‘³ç€å½“ä½¿ç”¨å‚æ•°åŒ–fixtureè£…ç½®æ—¶ï¼Œpytest å¯èƒ½ä¼šåœ¨ç»™å®šèŒƒå›´å†…å¤šæ¬¡è°ƒç”¨fixtureè£…ç½®ã€‚</p></blockquote><h3 id="4-3-3-fixture-åŠ¨æ€èŒƒå›´â€“è‡ªå®šä¹‰ä½œç”¨åŸŸ"><a href="#4-3-3-fixture-åŠ¨æ€èŒƒå›´â€“è‡ªå®šä¹‰ä½œç”¨åŸŸ" class="headerlink" title="4.3.3 fixture åŠ¨æ€èŒƒå›´â€“è‡ªå®šä¹‰ä½œç”¨åŸŸ"></a>4.3.3 fixture åŠ¨æ€èŒƒå›´â€“è‡ªå®šä¹‰ä½œç”¨åŸŸ</h3><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨å¯èƒ½å¸Œæœ›åœ¨ä¸æ›´æ”¹ä»£ç çš„æƒ…å†µä¸‹æ›´æ”¹å¤¹å…·çš„èŒƒå›´ã€‚ä¸ºæ­¤ï¼Œè¯·å°†å¯è°ƒç”¨å¯¹è±¡ä¼ é€’ç»™ä½œç”¨åŸŸã€‚</p><p>å¯è°ƒç”¨å‡½æ•°å¿…é¡»è¿”å›ä¸€ä¸ªå…·æœ‰æœ‰æ•ˆèŒƒå›´çš„å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”ä»…åœ¨å¤¹å…·å®šä¹‰æœŸé—´æ‰§è¡Œä¸€æ¬¡ã€‚å®ƒå°†ä½¿ç”¨ä¸¤ä¸ªå…³é”®å­—å‚æ•°è¿›è¡Œè°ƒç”¨â€”â€”fixture_name ä½œä¸ºå­—ç¬¦ä¸²ï¼Œconfig ä½¿ç”¨é…ç½®å¯¹è±¡ã€‚</p><p>å½“å¤„ç†éœ€è¦æ—¶é—´è®¾ç½®çš„å›ºå®šè£…ç½®ï¼ˆä¾‹å¦‚ç”Ÿæˆ docker å®¹å™¨ï¼‰æ—¶ï¼Œè¿™å°¤å…¶æœ‰ç”¨ã€‚</p><p>å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°æ¥æ§åˆ¶ä¸åŒç¯å¢ƒä¸‹ç”Ÿæˆçš„å®¹å™¨çš„èŒƒå›´ã€‚è¯·å‚é˜…ä¸‹é¢çš„ç¤ºä¾‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># determine_scope å‡½æ•°çš„å®šä¹‰æ˜¯å—ä¸¤ä¸ªå‚æ•°ï¼šfixture_name å’Œ configã€‚fixture_name æ˜¯ fixture çš„åç§°ï¼Œè€Œ config æ˜¯ pytest çš„é…ç½®å¯¹è±¡ã€‚</span><br><span class="hljs-comment"># å‡½æ•°çš„é€»è¾‘æ˜¯ï¼Œå¦‚æœåœ¨ pytest çš„å‘½ä»¤è¡Œé€‰é¡¹ä¸­å­˜åœ¨ --keep-containers é€‰é¡¹ï¼ˆè¡¨ç¤ºä¿æŒå®¹å™¨çš„é€‰é¡¹ï¼‰ï¼Œåˆ™è¿”å› &quot;session&quot; ä½œä¸º fixture çš„ä½œç”¨åŸŸï¼›å¦åˆ™ï¼Œè¿”å› &quot;function&quot; ä½œä¸º fixture çš„ä½œç”¨åŸŸã€‚</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">determine_scope</span>(<span class="hljs-params">fixture_name, config</span>):<br>    <span class="hljs-keyword">if</span> config.getoption(<span class="hljs-string">&quot;--keep-containers&quot;</span>, <span class="hljs-literal">None</span>):<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;session&quot;</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;function&quot;</span><br><br><span class="hljs-comment"># fixture çš„åç§°æ˜¯ docker_containerã€‚</span><br><span class="hljs-comment">#scope=determine_scope å°†ä½œç”¨åŸŸå‚æ•°è®¾ç½®ä¸º determine_scope å‡½æ•°çš„è¿”å›å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ ¹æ® determine_scope å‡½æ•°çš„é€»è¾‘ï¼Œè¿™ä¸ª fixture çš„ä½œç”¨åŸŸå°†æ ¹æ® --keep-containers å‘½ä»¤è¡Œé€‰é¡¹çš„å­˜åœ¨ä¸å¦æ¥ç¡®å®šã€‚</span><br><span class="hljs-meta">@pytest.fixture(<span class="hljs-params">scope=determine_scope</span>) </span><span class="hljs-comment"># scope=&quot;session&quot;æˆ–è€…&quot;function&quot;</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">docker_container</span>():<br>    <span class="hljs-keyword">yield</span> spawn_container()<br><span class="hljs-comment"># yield spawn_container() è¡¨ç¤ºåœ¨ fixture çš„è®¾ç½®å’Œæ¸…ç†è¿‡ç¨‹ä¸­ç”Ÿæˆä¸€ä¸ªå€¼ã€‚spawn_container() æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå¯èƒ½åœ¨ fixture çš„è®¾ç½®é˜¶æ®µåˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼Œå¹¶åœ¨ fixture çš„æ¸…ç†é˜¶æ®µé”€æ¯å®¹å™¨ã€‚yield è¯­å¥å°†ç”Ÿæˆçš„å€¼æš‚æ—¶æä¾›ç»™ä½¿ç”¨è¯¥ fixture çš„æµ‹è¯•å‡½æ•°ï¼Œä»¥ä¾¿è¿›è¡Œæµ‹è¯•æ“ä½œã€‚</span><br></code></pre></td></tr></table></figure><h2 id="4-4-Teardown-Cleanup-åˆç§°å‰ç½®å’Œåç½®"><a href="#4-4-Teardown-Cleanup-åˆç§°å‰ç½®å’Œåç½®" class="headerlink" title="4.4 Teardown&#x2F;Cleanup (åˆç§°å‰ç½®å’Œåç½®)"></a>4.4 Teardown&#x2F;Cleanup (åˆç§°å‰ç½®å’Œåç½®)</h2><p>å½“æˆ‘ä»¬è¿è¡Œæµ‹è¯•æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ç¡®ä¿å®ƒä»¬è‡ªè¡Œæ¸…ç†ï¼Œè¿™æ ·å®ƒä»¬å°±ä¸ä¼šå¹²æ‰°ä»»ä½•å…¶ä»–æµ‹è¯•ï¼ˆåŒæ—¶æˆ‘ä»¬ä¹Ÿä¸ä¼šç•™ä¸‹å¤§é‡çš„æµ‹è¯•æ•°æ®æ¥ä½¿ç³»ç»Ÿè†¨èƒ€ï¼‰</p><p>pytest ä¸­çš„è£…ç½®æä¾›äº†ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„æ‹†å¸ç³»ç»Ÿï¼Œå®ƒå…è®¸æˆ‘ä»¬å®šä¹‰æ¯ä¸ªè£…ç½®è‡ªè¡Œæ¸…ç†æ‰€éœ€çš„ç‰¹å®šæ­¥éª¤ã€‚</p><p>å¯ä»¥é€šè¿‡ä¸¤ç§æ–¹å¼åˆ©ç”¨è¯¥ç³»ç»Ÿã€‚</p><h3 id="1-yield-fixtures-ã€æ¨èã€‘"><a href="#1-yield-fixtures-ã€æ¨èã€‘" class="headerlink" title="1. yield fixtures ã€æ¨èã€‘"></a>1. <code>yield</code> fixtures ã€æ¨èã€‘</h3><p>â€œYieldâ€ fixturesä½¿ç”¨ <code>yield</code> è€Œä¸æ˜¯ <code>return</code>.ï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œä¸€äº›ä»£ç å¹¶å°†å¯¹è±¡ä¼ é€’å›è¯·æ±‚çš„è£…ç½®&#x2F;æµ‹è¯•ï¼Œå°±åƒå…¶ä»–è£…ç½®ä¸€æ ·ã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼š</p><ol><li><code>return</code>æ¢æˆ<code>yield</code></li><li>ä¸€äº› <code>teardown</code>ä»£ç æ”¾åœ¨<code>yiend</code>çš„åé¢</li></ol><p>ä¸€æ—¦ pytest è®¡ç®—å‡ºfixturesè£…ç½®çš„çº¿æ€§é¡ºåºï¼Œå®ƒå°†è¿è¡Œæ¯ä¸ªfixturesè£…ç½®ï¼Œç›´åˆ°å®ƒè¿”å›æˆ–äº§ç”Ÿï¼Œç„¶åè½¬åˆ°åˆ—è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªfixturesè£…ç½®ä»¥æ‰§è¡Œç›¸åŒçš„æ“ä½œã€‚</p><p>æµ‹è¯•å®Œæˆåï¼Œpytest å°†è¿”å›fixturesè£…ç½®åˆ—è¡¨ï¼Œä½†ä»¥ç›¸åçš„é¡ºåºï¼Œè·å–æ¯ä¸ªç”Ÿæˆçš„fixturesè£…ç½®ï¼Œå¹¶è¿è¡Œå…¶ä¸­ä½äºyield è¯­å¥ä¹‹åçš„ä»£ç ã€‚</p><p>ä¸¾ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># content of emaillib.py</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MailAdminClient</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_user</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">return</span> MailUser()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">delete_user</span>(<span class="hljs-params">self, user</span>):<br>        <span class="hljs-comment"># do some cleanup</span><br>        <span class="hljs-keyword">pass</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MailUser</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        self.inbox = []<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">send_email</span>(<span class="hljs-params">self, email, other</span>):<br>        other.inbox.append(email)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">clear_mailbox</span>(<span class="hljs-params">self</span>):<br>        self.inbox.clear()<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Email</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, subject, body</span>):<br>        self.subject = subject<br>        self.body = body<br></code></pre></td></tr></table></figure><p>å‡è®¾æˆ‘ä»¬è¦æµ‹è¯•ä»ä¸€ä¸ªç”¨æˆ·å‘å¦ä¸€ä¸ªç”¨æˆ·å‘é€ç”µå­é‚®ä»¶ã€‚</p><ol><li>æˆ‘ä»¬å¿…é¡»é¦–å…ˆåˆ›å»ºæ¯ä¸ªç”¨æˆ·ï¼Œ</li><li>ç„¶åå°†ç”µå­é‚®ä»¶ä»ä¸€ä¸ªç”¨æˆ·å‘é€åˆ°å¦ä¸€ä¸ªç”¨æˆ·ï¼Œ</li><li>æœ€åæ–­è¨€å¦ä¸€ä¸ªç”¨æˆ·åœ¨å…¶æ”¶ä»¶ç®±ä¸­æ”¶åˆ°äº†è¯¥æ¶ˆæ¯ã€‚</li></ol><p>å¦‚æœæˆ‘ä»¬æƒ³åœ¨æµ‹è¯•è¿è¡Œåè¿›è¡Œæ¸…ç†ï¼Œæˆ‘ä»¬å¯èƒ½å¿…é¡»ç¡®ä¿åœ¨åˆ é™¤å…¶ä»–ç”¨æˆ·ä¹‹å‰æ¸…ç©ºè¯¥ç”¨æˆ·çš„é‚®ç®±ï¼Œå¦åˆ™ç³»ç»Ÿå¯èƒ½ä¼šæœ‰åƒåœ¾æ•°æ®ã€‚</p><p>çœ‹ä¸€ä¸‹ç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MailAdminClient</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">create_user</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;create user&quot;</span>)<br>        <span class="hljs-keyword">return</span> MailUser()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">delete_user</span>(<span class="hljs-params">self, user</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;delete user&quot;</span>)<br>        <span class="hljs-comment"># do some cleanup</span><br>        <span class="hljs-keyword">pass</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MailUser</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        self.inbox = []<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">send_email</span>(<span class="hljs-params">self, email, other</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;send email&quot;</span>)<br>        other.inbox.append(email)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">clear_mailbox</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;clearing mailbox&quot;</span>)<br>        self.inbox.clear()<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Email</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, subject, body</span>):<br>        self.subject = subject<br>        self.body = body<br><br><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">mail_admin</span>():<br>    <span class="hljs-keyword">return</span> MailAdminClient()<br><br><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sending_user</span>(<span class="hljs-params">mail_admin</span>):<br>    user = mail_admin.create_user()<br>    <span class="hljs-keyword">yield</span> user<br>    mail_admin.delete_user(user)<br><br><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">receiving_user</span>(<span class="hljs-params">mail_admin</span>):<br>    user = mail_admin.create_user()<br>    <span class="hljs-keyword">yield</span> user<br>    user.clear_mailbox()<br>    mail_admin.delete_user(user)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_email_received</span>(<span class="hljs-params">sending_user, receiving_user</span>):<br>    email = Email(subject=<span class="hljs-string">&quot;Hey!&quot;</span>, body=<span class="hljs-string">&quot;How&#x27;s it going?&quot;</span>)<br>    sending_user.send_email(email, receiving_user)<br>    <span class="hljs-keyword">assert</span> email <span class="hljs-keyword">in</span> receiving_user.inbox<br></code></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹è¿è¡Œçš„ç»“æœ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python">============================ test session starts =======================================<br>platform linux -- Python <span class="hljs-number">3.10</span><span class="hljs-number">.12</span>, pytest-<span class="hljs-number">8.1</span><span class="hljs-number">.1</span>, pluggy-<span class="hljs-number">1.4</span><span class="hljs-number">.0</span><br><br>plugins: anyio-<span class="hljs-number">4.2</span><span class="hljs-number">.0</span><br>collected <span class="hljs-number">1</span> item                                                                                                                                                                    <br><br>testcases/test_fixturestest.py <br>create user <span class="hljs-comment"># å¼€å§‹æ—¶è¿è¡Œäº†</span><br>create user<br>send email<br>.clearing mailbox<br>delete user <span class="hljs-comment"># ç»“æŸæ—¶è¿è¡Œäº†</span><br>delete user<br><br><br>========================= <span class="hljs-number">1</span> passed <span class="hljs-keyword">in</span> <span class="hljs-number">0.01</span>s =============================================<br></code></pre></td></tr></table></figure><p>å› ä¸ºreceiving_useræ˜¯å®‰è£…è¿‡ç¨‹ä¸­æœ€åä¸€ä¸ªè¿è¡Œçš„fixtureè£…ç½®ï¼Œæ‰€ä»¥å®ƒä¹Ÿæ˜¯æ‹†å¸è¿‡ç¨‹ä¸­ç¬¬ä¸€ä¸ªè¿è¡Œçš„fixtureè£…ç½®ã€‚</p><h4 id="yield-fixtureå¤„ç†é”™è¯¯"><a href="#yield-fixtureå¤„ç†é”™è¯¯" class="headerlink" title="yield fixtureå¤„ç†é”™è¯¯"></a>yield fixtureå¤„ç†é”™è¯¯</h4><p>å¦‚æœyieldè£…ç½®åœ¨yieldä¹‹å‰å¼•å‘å¼‚å¸¸ï¼Œpytestå°†ä¸ä¼šå°è¯•åœ¨è¯¥yieldè£…ç½®çš„yieldè¯­å¥ä¹‹åè¿è¡Œç»“æŸä»£ç ã€‚</p><p>ä½†æ˜¯ï¼Œå¯¹äºå·²ç»æˆåŠŸè¿è¡Œè¯¥æµ‹è¯•çš„æ¯ä¸ªfixtureè£…ç½®ï¼Œpytest ä»ä¼šåƒå¹³å¸¸ä¸€æ ·å°è¯•å°†å…¶æ‹†é™¤ã€‚</p><blockquote><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä½ åœ¨yieldä¹‹å‰æŠ¥é”™äº†ï¼Œå°±ä¸ä¼šè¿è¡Œyieldä¹‹åçš„ä»£ç äº†ï¼Œå¦‚æœyieldä¹‹å‰æ²¡æŠ¥é”™ï¼Œå°±è‚¯å®šä¼šè¿è¡Œyieldä¹‹åçš„ä»£ç ï¼Œå“ªæ€•yieldä¹‹åä¹Ÿæœ‰æŠ¥é”™</p></blockquote><h3 id="2-ç›´æ¥æ·»åŠ ç»ˆç»“å™¨finalizers"><a href="#2-ç›´æ¥æ·»åŠ ç»ˆç»“å™¨finalizers" class="headerlink" title="2. ç›´æ¥æ·»åŠ ç»ˆç»“å™¨finalizers"></a>2. ç›´æ¥æ·»åŠ ç»ˆç»“å™¨finalizers</h3><p>è™½ç„¶<code>yield</code>å¤¹å…·è¢«è®¤ä¸ºæ˜¯æ›´ç®€å•ã€æ›´ç›´æ¥çš„é€‰é¡¹ï¼Œä½†è¿˜æœ‰å¦ä¸€ç§é€‰æ‹©ï¼Œé‚£å°±æ˜¯å°†â€œfinalizersâ€å‡½æ•°ç›´æ¥æ·»åŠ åˆ°æµ‹è¯•çš„è¯·æ±‚ä¸Šä¸‹æ–‡å¯¹è±¡<code>request</code>ä¸­ã€‚</p><p>å®ƒå¸¦æ¥äº†ä¸yieldè£…ç½®ç±»ä¼¼çš„ç»“æœï¼Œä½†å¯èƒ½ä¼šè®©ä»£ç å˜å¾—å†—ä½™äº†ä¸€ç‚¹ã€‚</p><p>ä¸ºäº†ä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å¿…é¡»åœ¨éœ€è¦æ·»åŠ æ‹†å¸ä»£ç çš„å›ºå®šè£…ç½®ä¸­è¯·æ±‚è¯·æ±‚ä¸Šä¸‹æ–‡å¯¹è±¡ï¼ˆå°±åƒæˆ‘ä»¬è¯·æ±‚å¦ä¸€ä¸ªå›ºå®šè£…ç½®ä¸€æ ·ï¼‰ï¼Œç„¶åå°†åŒ…å«è¯¥æ‹†å¸ä»£ç çš„å¯è°ƒç”¨å¯¹è±¡ä¼ é€’ç»™å…¶ addfinalizer æ–¹æ³•ã€‚</p><p>ä½†æˆ‘ä»¬å¿…é¡»å°å¿ƒï¼Œå› ä¸º pytest åœ¨æ·»åŠ <code>finalizers</code>åå°†è¿è¡Œè¯¥ç»ˆç»“å™¨ï¼Œå³ä½¿è¯¥è£…ç½®åœ¨æ·»åŠ <code>finalizers</code>åå¼•å‘å¼‚å¸¸</p><p>å› æ­¤ï¼Œä¸ºäº†ç¡®ä¿æˆ‘ä»¬åœ¨ä¸éœ€è¦æ—¶ä¸è¿è¡Œç»ˆç»“å™¨ä»£ç ï¼Œåªæœ‰åœ¨å¤¹å…·å®Œæˆäº†æˆ‘ä»¬éœ€è¦æ‹†å¸çš„æ“ä½œåï¼Œæˆ‘ä»¬æ‰ä¼šæ·»åŠ ç»ˆç»“å™¨ã€‚</p><p>è¿™é‡Œçš„ç›®çš„æ˜¯ï¼Œä½ å¯ä»¥å°†æ¸…ç†ç”¨æˆ·æ•°æ®çš„æ–¹æ³•ï¼Œæ”¾åœ¨è¿™ä¸ªç”¨ä¾‹æ‰§è¡Œå®Œæˆåæ‰§è¡Œï¼Œä»¥ä¸‹æ˜¯ä½¿ç”¨ addfinalizer æ–¹æ³•çš„ç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># content of test_emaillib.py</span><br><span class="hljs-keyword">from</span> emaillib <span class="hljs-keyword">import</span> Email, MailAdminClient<br><span class="hljs-keyword">import</span> pytest<br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">mail_admin</span>():<br>    <span class="hljs-keyword">return</span> MailAdminClient()<br><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">sending_user</span>(<span class="hljs-params">mail_admin</span>):<br>    user = mail_admin.create_user()<br>    <span class="hljs-keyword">yield</span> user<br>    mail_admin.delete_user(user)<br><br><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">receiving_user</span>(<span class="hljs-params">mail_admin, request</span>):<br>    user = mail_admin.create_user()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">delete_user</span>():<br>        mail_admin.delete_user(user)<br><br>    request.addfinalizer(delete_user) <span class="hljs-comment"># è¢«æ·»åŠ è¿›å»çš„å‡½æ•°ï¼Œä¼šåœ¨æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œå®Œä¹‹åæ‰§è¡Œ</span><br>    <span class="hljs-keyword">return</span> user<br><br><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">email</span>(<span class="hljs-params">sending_user, receiving_user, request</span>):<br>    _email = Email(subject=<span class="hljs-string">&quot;Hey!&quot;</span>, body=<span class="hljs-string">&quot;How&#x27;s it going?&quot;</span>)<br>    sending_user.send_email(_email, receiving_user)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">empty_mailbox</span>():<br>        receiving_user.clear_mailbox() <span class="hljs-comment"># è¿™ä¸ªæ–¹æ³•ï¼Œæ˜¯åœ¨</span><br><br>    request.addfinalizer(empty_mailbox) <span class="hljs-comment"># è¢«æ·»åŠ è¿›å»çš„å‡½æ•°ï¼Œä¼šåœ¨æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œå®Œä¹‹åæ‰§è¡Œ</span><br>    <span class="hljs-keyword">return</span> _email<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_email_received</span>(<span class="hljs-params">receiving_user, email</span>):<br>    <span class="hljs-keyword">assert</span> email <span class="hljs-keyword">in</span> receiving_user.inbox<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œçš„ç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python">====================== test session starts ============================<br>platform linux -- Python <span class="hljs-number">3.10</span><span class="hljs-number">.12</span>, pytest-<span class="hljs-number">8.1</span><span class="hljs-number">.1</span>, pluggy-<span class="hljs-number">1.4</span><span class="hljs-number">.0</span><br><br>configfile: pytest.ini<br>plugins: anyio-<span class="hljs-number">4.2</span><span class="hljs-number">.0</span><br>collected <span class="hljs-number">1</span> item                                                                                                                                                                    <br><br>testcases/test_fixturestest.py <br>create user<br>create user<br>send email<br>.clearing mailbox<br>delete user<br>delete user<br><br><br>======================================= <span class="hljs-number">1</span> passed <span class="hljs-keyword">in</span> <span class="hljs-number">0.01</span>s ==========<br></code></pre></td></tr></table></figure><p><code>request.addfinalizer()</code> æ·»åŠ çš„æ–¹æ³•ä¼šåœ¨å½“å‰æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œå®Œæˆåè¿è¡Œã€‚å®ƒä¼šåœ¨æµ‹è¯•ç”¨ä¾‹çš„æ‰€æœ‰ä»£ç ï¼ˆåŒ…æ‹¬æµ‹è¯•å‡½æ•°ã€fixtureã€setup å’Œ teardownï¼‰æ‰§è¡Œå®Œæ¯•åè¢«è°ƒç”¨ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œ<code>request.addfinalizer()</code> æ–¹æ³•ç”¨äºæ³¨å†Œä¸€ä¸ªæ¸…ç†å‡½æ•°ï¼Œè¯¥å‡½æ•°å°†åœ¨ä»¥ä¸‹æƒ…å†µä¹‹ä¸€å‘ç”Ÿæ—¶è¢«è°ƒç”¨ï¼š</p><ol><li>å½“å‰æµ‹è¯•ç”¨ä¾‹çš„æµ‹è¯•å‡½æ•°æ‰§è¡Œå®Œæˆåã€‚</li><li>å½“å‰æµ‹è¯•ç”¨ä¾‹ä¸­çš„ä»»ä½• fixture çš„ <code>yield</code> è¯­å¥ä¹‹åã€‚</li><li>å½“å‰æµ‹è¯•ç”¨ä¾‹ä¸­çš„ä»»ä½• fixture çš„ <code>teardown</code> æ–¹æ³•æ‰§è¡Œå®Œæˆåã€‚</li></ol><p>ç®€åŒ–ä¸€ä¸‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">my_fixture</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">cleanup</span>():<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Performing cleanup,è¿™æ˜¯æœ€åæ‰§è¡Œçš„&quot;</span>)<br><br>    request.addfinalizer(cleanup) <span class="hljs-comment"># è¢«æ·»åŠ è¿›å»çš„å‡½æ•°ï¼Œä¼šåœ¨æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œå®Œä¹‹åæ‰§è¡Œ</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Setup&quot;</span>)<br>    <span class="hljs-keyword">yield</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Teardown&quot;</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_example2</span>(<span class="hljs-params">my_fixture</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Running test&quot;</span>)<br>    <br><span class="hljs-comment"># ä½ è¿˜å¯ä»¥å†™ lambda åŒ¿åæ–¹æ³•ä¼ è¿›å»ï¼Œä¾‹å¦‚ï¼š</span><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">my_fixture</span>(<span class="hljs-params">request</span>):<br>    request.addfinalizer(<span class="hljs-keyword">lambda</span>: <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Performing cleanup,è¿™æ˜¯æœ€åæ‰§è¡Œçš„&quot;</span>)) <span class="hljs-comment"># è¢«æ·»åŠ è¿›å»çš„å‡½æ•°ï¼Œä¼šåœ¨æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œå®Œä¹‹åæ‰§è¡Œ</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Setup&quot;</span>)<br>    <span class="hljs-keyword">yield</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Teardown&quot;</span>)<br><span class="hljs-comment"># ä½ ä¹Ÿå¯ä»¥å°†æ–¹æ³•å®šä¹‰åœ¨å¤–é¢ï¼š</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">cleanup</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Performing cleanup,è¿™æ˜¯æœ€åæ‰§è¡Œçš„&quot;</span>)<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">my_fixture</span>(<span class="hljs-params">request</span>):<br>    request.addfinalizer(cleanup) <span class="hljs-comment"># è¢«æ·»åŠ è¿›å»çš„å‡½æ•°ï¼Œä¼šåœ¨æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œå®Œä¹‹åæ‰§è¡Œ</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Setup&quot;</span>)<br>    <span class="hljs-keyword">yield</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Teardown&quot;</span>)<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œçš„ç»“æœ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python">====================== test session starts =================================<br>platform linux -- Python <span class="hljs-number">3.10</span><span class="hljs-number">.12</span>, pytest-<span class="hljs-number">8.1</span><span class="hljs-number">.1</span>, pluggy-<span class="hljs-number">1.4</span><span class="hljs-number">.0</span><br><br>configfile: pytest.ini<br>plugins: anyio-<span class="hljs-number">4.2</span><span class="hljs-number">.0</span><br>collected <span class="hljs-number">1</span> item                                                                                                                                                                    <br><br>testcases/test_fixturestest.py <br>Setup <span class="hljs-comment"># yield å‰æ‰§è¡Œçš„</span><br>Running test <span class="hljs-comment"># æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œçš„</span><br>.Teardown <span class="hljs-comment"># yield åæ‰§è¡Œçš„</span><br>Performing cleanup,è¿™æ˜¯æœ€åæ‰§è¡Œçš„ <span class="hljs-comment"># ç»ˆç»“å™¨æ‰§è¡Œçš„</span><br><br><br>======================== <span class="hljs-number">1</span> passed <span class="hljs-keyword">in</span> <span class="hljs-number">0.01</span>s =========<br></code></pre></td></tr></table></figure><p><code> request.addfinalizer()</code>å’Œ<code>fixture</code>å‡½æ•°é‡Œé¢æ·»åŠ <code>yield</code>çš„åŒºåˆ«åœ¨äºï¼š</p><ul><li><code> request.addfinalizer()</code>çš„å‡½æ•°æ˜¯åœ¨æµ‹è¯•ç»“æŸåæ‰§è¡Œï¼Œ</li><li><code> request.addfinalizer()</code>å¯ä»¥åœ¨ç¨‹åºå‘ç”ŸæŠ¥é”™åä»ç„¶æ‰§è¡Œï¼Œ<strong>è€Œä½¿ç”¨<code>yield</code>çš„è¯ï¼Œ<code>yield</code>å‰é¢çš„ä»£ç åœ¨æ‰§è¡Œæ—¶å¦‚æœæŠ¥é”™ï¼Œé‚£<code>yield</code>åé¢çš„ä»£ç å°±ä¸ä¼šæ‰§è¡Œï¼Œ</strong></li></ul><blockquote><p>å¦å…³äºå¯¹äº<code>request</code>çš„ä½¿ç”¨ï¼Œåç»­å¼€ä¸€ç¯‡æ–‡ç« è®²è§£</p></blockquote><h4 id="å…³äºfinalizeré¡ºåºçš„æ³¨æ„äº‹é¡¹ã€é‡ç‚¹ã€‘"><a href="#å…³äºfinalizeré¡ºåºçš„æ³¨æ„äº‹é¡¹ã€é‡ç‚¹ã€‘" class="headerlink" title="å…³äºfinalizeré¡ºåºçš„æ³¨æ„äº‹é¡¹ã€é‡ç‚¹ã€‘"></a>å…³äºfinalizeré¡ºåºçš„æ³¨æ„äº‹é¡¹ã€é‡ç‚¹ã€‘</h4><p><code>finalizer</code>æŒ‰ç…§å…ˆè¿›åå‡ºçš„é¡ºåºæ‰§è¡Œã€‚å¯¹äº<code>yield </code>çš„<code>fixture</code>ï¼Œè¦è¿è¡Œçš„ç¬¬ä¸€ä¸ª<code>teardown</code>ä»£ç æ¥è‡ªæœ€å³ä¾§çš„<code>fixture</code>è£…ç½®ï¼Œå³æœ€åä¸€ä¸ªæµ‹è¯•å‚æ•°ï¼ˆå…¥å‚ï¼‰ã€‚</p><ul><li>ä»å³å¾€å·¦é¡ºåºæ‰§è¡Œ<code>yield</code> çš„ <code>fixture</code></li></ul><p>çœ‹ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># content of test_finalizers.py</span><br><span class="hljs-keyword">import</span> pytest<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_bar</span>(<span class="hljs-params">fix_w_yield1, fix_w_yield2</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;test_bar&quot;</span>)<br><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fix_w_yield1</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;after_yield_1,start&quot;</span>)<br>    <span class="hljs-keyword">yield</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;after_yield_1,end&quot;</span>)<br><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fix_w_yield2</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;after_yield_2,start&quot;</span>)<br>    <span class="hljs-keyword">yield</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;after_yield_2,end&quot;</span>)<br>    <br>$ pytest -s test_finalizers.py<br>=========================== test session starts ============================<br>platform linux -- Python <span class="hljs-number">3.</span>x.y, pytest-<span class="hljs-number">8.</span>x.y, pluggy-<span class="hljs-number">1.</span>x.y<br>rootdir: /home/sweet/project<br>collected <span class="hljs-number">1</span> item<br><br>test_finalizers.py <br>test_bar <span class="hljs-comment"># å…ˆæ‰“å°æµ‹è¯•å‡½æ•°å†…çš„ä»£ç </span><br>.after_yield_2 <span class="hljs-comment"># å…ˆæ‰§è¡Œçš„2</span><br>after_yield_1 <span class="hljs-comment"># å†æ‰§è¡Œçš„1</span><br>yield_1,start <span class="hljs-comment"># å¼€å§‹æ—¶å…ˆæ‰§è¡Œçš„1çš„å¼€å§‹</span><br>after_yield_2,start <span class="hljs-comment"># å†æ‰§è¡Œ2çš„å¼€å§‹</span><br>test_bar <span class="hljs-comment"># å†æ‰§è¡Œæµ‹è¯•å‡½æ•°</span><br>.after_yield_2,end <span class="hljs-comment"># ç»“æŸæ—¶å…ˆæ‰§è¡Œ2çš„ç»“æŸ</span><br>after_yield_1,end <span class="hljs-comment"># å†æ‰§è¡Œ1çš„ç»“æŸ</span><br><br>============================ <span class="hljs-number">1</span> passed <span class="hljs-keyword">in</span> <span class="hljs-number">0.12</span>s =============================<br></code></pre></td></tr></table></figure><p>å¯¹äºfinalizerså†…æ³¨å†Œçš„å‡½æ•°ï¼Œä¼˜å…ˆè¿è¡Œæœ€åä¸€ä¸ªæ·»åŠ è¿›å»çš„å‡½æ•°ï¼Œä¾æ¬¡å¾€å‰è¿è¡Œã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># content of test_finalizers.py</span><br><span class="hljs-keyword">from</span> functools <span class="hljs-keyword">import</span> partial<br><span class="hljs-keyword">import</span> pytest<br><br><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fix_w_finalizers</span>(<span class="hljs-params">request</span>):<br>    request.addfinalizer(partial(<span class="hljs-built_in">print</span>, <span class="hljs-string">&quot;finalizer_2&quot;</span>)) <span class="hljs-comment"># åè¿è¡Œ2</span><br>    request.addfinalizer(partial(<span class="hljs-built_in">print</span>, <span class="hljs-string">&quot;finalizer_1&quot;</span>)) <span class="hljs-comment"># å…ˆè¿è¡Œ1</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_bar</span>(<span class="hljs-params">fix_w_finalizers</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;test_bar&quot;</span>)<br>$ pytest -s test_finalizers.py<br>=========================== test session starts ============================<br>platform linux -- Python <span class="hljs-number">3.</span>x.y, pytest-<span class="hljs-number">8.</span>x.y, pluggy-<span class="hljs-number">1.</span>x.y<br>rootdir: /home/sweet/project<br>collected <span class="hljs-number">1</span> item<br><br>test_finalizers.py test_bar<br>.finalizer_1 <span class="hljs-comment"># å…ˆè¿è¡Œ1</span><br>finalizer_2 <span class="hljs-comment"># åè¿è¡Œ2</span><br><br><br>============================ <span class="hljs-number">1</span> passed <span class="hljs-keyword">in</span> <span class="hljs-number">0.12</span>s =============================<br></code></pre></td></tr></table></figure><p>ä¹‹æ‰€ä»¥å¦‚æ­¤ï¼Œæ˜¯å› ä¸ºäº§é‡yield fixturesè£…ç½®åœ¨å¹•åä½¿ç”¨äº† addfinalizerï¼šå½“fixtureè£…ç½®æ‰§è¡Œæ—¶ï¼Œaddfinalizer æ³¨å†Œä¸€ä¸ªæ¢å¤ç”Ÿæˆå™¨çš„å‡½æ•°ï¼Œè¯¥å‡½æ•°åˆè°ƒç”¨teardownä»£ç ã€‚</p><blockquote><p>æ‰€ä»¥ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹å†…çš„fixtureçš„æ‰§è¡Œé¡ºåºæ˜¯ï¼Œå…¥å‚ä¸­çš„æœ€åä¸€ä¸ªå…ˆæ‰§è¡Œï¼Œaddfinalizeræ³¨å†Œçš„å‡½æ•°æœ€åæ‰§è¡Œ</p></blockquote><h2 id="4-5-teardownså®‰å…¨ã€æ³¨æ„ã€‘"><a href="#4-5-teardownså®‰å…¨ã€æ³¨æ„ã€‘" class="headerlink" title="4.5 teardownså®‰å…¨ã€æ³¨æ„ã€‘"></a>4.5 teardownså®‰å…¨ã€æ³¨æ„ã€‘</h2><p>pytest çš„å›ºå®šç³»ç»Ÿéå¸¸å¼ºå¤§ï¼Œä½†å®ƒä»ç„¶ç”±è®¡ç®—æœºè¿è¡Œï¼Œå› æ­¤å®ƒæ— æ³•å¼„æ¸…æ¥šå¦‚ä½•å®‰å…¨åœ°æ‹†é™¤æˆ‘ä»¬æ‰”ç»™å®ƒçš„æ‰€æœ‰ä¸œè¥¿</p><p>å¦‚æœæˆ‘ä»¬ä¸å°å¿ƒï¼Œé”™è¯¯ä½ç½®çš„é”™è¯¯å¯èƒ½ä¼šç•™ä¸‹æµ‹è¯•ä¸­çš„å†…å®¹ï¼Œè¿™å¯èƒ½å¾ˆå¿«ä¼šå¯¼è‡´è¿›ä¸€æ­¥çš„é—®é¢˜ã€‚</p><p>ä¾‹å¦‚ï¼Œè€ƒè™‘ä»¥ä¸‹æµ‹è¯•ï¼ˆåŸºäºä¸Šé¢çš„é‚®ä»¶ç¤ºä¾‹ï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># content of test_emaillib.py</span><br><span class="hljs-keyword">from</span> emaillib <span class="hljs-keyword">import</span> Email, MailAdminClient<br><br><span class="hljs-keyword">import</span> pytest<br><br><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">setup</span>():<br>    mail_admin = MailAdminClient()<br>    sending_user = mail_admin.create_user()<br>    receiving_user = mail_admin.create_user()<br>    email = Email(subject=<span class="hljs-string">&quot;Hey!&quot;</span>, body=<span class="hljs-string">&quot;How&#x27;s it going?&quot;</span>)<br>    sending_user.send_email(email, receiving_user)<br>    <span class="hljs-keyword">yield</span> receiving_user, email<br>    receiving_user.clear_mailbox()<br>    mail_admin.delete_user(sending_user)<br>    mail_admin.delete_user(receiving_user)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_email_received</span>(<span class="hljs-params">setup</span>):<br>    receiving_user, email = setup<br>    <span class="hljs-keyword">assert</span> email <span class="hljs-keyword">in</span> receiving_user.inbox<br></code></pre></td></tr></table></figure><ul><li><p>è¿™ä¸ªç‰ˆæœ¬çš„ä»£ç çœ‹èµ·æ¥ç¡®å®æ˜¯æ›´åŠ ç´§å‡‘ï¼Œåªå®šä¹‰äº†ä¸€ä¸ª<code>fixture</code>å‡½æ•°,ä½†æ˜¯å¯è¿™æ ·çš„ä»£ç è¯»æ€§ä¹Ÿä¼šæ›´å·®ï¼Œæ²¡æœ‰ä»€ä¹ˆæè¿°æ€§çš„<code>fixture</code>åç§°ï¼Œä¸€ç‚¹ä¹Ÿä¸è§åçŸ¥æ„ï¼Œå¹¶ä¸”ä¹Ÿæ— æ³•åšåˆ°è½»æ¾çš„é‡å¤ä½¿ç”¨è¿™ä¸ª<code>fixture</code>ï¼Œå¤ç”¨æ€§å·®ã€‚</p></li><li><p>è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªæ›´ä¸¥é‡çš„é—®é¢˜ï¼Œå³å¦‚æœåœ¨è¿è¡Œä»£ç çš„æ—¶å€™æœ‰ä»»ä½•æ­¥éª¤å¼•å‘äº†ç¨‹åºå¼‚å¸¸æŠ¥é”™ï¼Œåˆ™ä»»ä½•ä»£ç éƒ½ä¸ä¼šè¿è¡Œã€‚</p></li><li><p>æ‰€ä»¥æœ‰å¦ä¸€ç§é€‰æ‹©å°±æ˜¯ä½¿ç”¨ addfinalizer æ³¨å†Œæ–¹æ³•è€Œä¸æ˜¯å…¨éƒ¨éƒ½å †åœ¨fixtureé‡Œé¢ï¼Œä½†æ˜¯ç”¨addfinalizerçš„è¯å¯èƒ½ä¼šæ˜¯ä»£ç å˜å¾—ç›¸å½“å¤æ‚ä¸”éš¾ä»¥ç»´æŠ¤ï¼ˆå¹¶ä¸”å®ƒä¸å†ç´§å‡‘ï¼‰ã€‚æœ‰åˆ©æœ‰å¼Šå§</p></li></ul><h3 id="4-5-1-fixture-å®‰å…¨ç»“æ„"><a href="#4-5-1-fixture-å®‰å…¨ç»“æ„" class="headerlink" title="4.5.1 fixture å®‰å…¨ç»“æ„"></a>4.5.1 fixture å®‰å…¨ç»“æ„</h3><p>æœ€å®‰å…¨å’Œæœ€ç®€å•çš„<code>fixture</code>ç»“æ„è¦æ±‚é™åˆ¶ä¸€ä¸ª<code>fixture</code>ä»…è¿›è¡Œä¸€ä¸ªçŠ¶æ€çš„æ›´æ”¹æ“ä½œï¼ˆ<strong>æ„æ€å°±æ˜¯ä¸€ä¸ª<code>fixture</code>åªåšä¸€ä»¶äº‹æƒ…ï¼Œé€»è¾‘ä¸å¯ä»¥å†™å¤šäº†</strong>ï¼‰ï¼Œ</p><p>ç„¶åå°†å¤šä¸ª<code>fixture</code>ä¸å…¶ä»–<code>fixture</code>ä»£ç æ†ç»‘åœ¨ä¸€èµ·ï¼Œå¦‚ä¸Šé¢çš„ç”µå­é‚®ä»¶ç¤ºä¾‹æ‰€ç¤ºã€‚</p><p> çŠ¶æ€æ›´æ”¹æ“ä½œå¤±è´¥ä½†ä»ç„¶ä¿®æ”¹çŠ¶æ€çš„å¯èƒ½æ€§å¯ä»¥å¿½ç•¥ä¸è®¡ï¼Œå› ä¸ºå¤§å¤šæ•°è¿™äº›æ“ä½œå¾€å¾€æ˜¯åŸºäºäº‹åŠ¡çš„ï¼ˆè‡³å°‘åœ¨çŠ¶æ€å¯èƒ½è¢«æŠ›åœ¨åé¢çš„æµ‹è¯•çº§åˆ«ï¼‰ã€‚</p><p> å› æ­¤ï¼Œå¦‚æœæˆ‘ä»¬é€šè¿‡å°†ä»»ä½•æˆåŠŸçš„çŠ¶æ€æ›´æ”¹æ“ä½œç§»åŠ¨åˆ°å•ç‹¬çš„<code>fixture</code>å¹¶å°†å…¶ä¸å…¶ä»–æœ‰å¯èƒ½å¤±è´¥çš„çŠ¶æ€æ›´æ”¹æ“ä½œåˆ†å¼€æ¥ç¡®ä¿å°†å…¶æœ€åæ‰§è¡Œï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„æµ‹è¯•å°†æœ‰æœ€å¤šçš„å¯èƒ½ç¦»å¼€æµ‹è¯•ç¯å¢ƒ</p><p>è¿™é‡Œçš„æ„æ€ï¼Œå°†å¿…å®šæˆåŠŸçš„æ“ä½œï¼Œå’Œå¯èƒ½å¤±è´¥çš„æ“ä½œæ‹†åˆ†å¼€æ¥ï¼Œå°†æˆåŠŸç‡å¤§çš„å’ŒæˆåŠŸç‡å¤§çš„æ“ä½œæ”¾åœ¨ä¸€èµ·ï¼Œå¤±è´¥ç‡å¤§çš„æ”¾ä¸€èµ·æˆ–è€…æ‹†å¼€æ¥æ”¾ï¼Œé¿å…ä¸€å¤´æˆåŠŸä¸€å¤´å¤±è´¥çš„ï¼Œé€ æˆå…¶ä»–å®‰å…¨éšæ‚£</p><p> ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå¸¦æœ‰ç™»å½•é¡µé¢çš„ç½‘ç«™ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥è®¿é—®å¯ä»¥ç”Ÿæˆç”¨æˆ·çš„ç®¡ç† APIã€‚ å¯¹äºæˆ‘ä»¬çš„æµ‹è¯•ï¼Œæˆ‘ä»¬æƒ³è¦ï¼š</p><ol><li>é€šè¿‡è¯¥API åˆ›å»ºç®¡ç†ç”¨æˆ·</li><li>ä½¿ç”¨ Selenium å¯åŠ¨æµè§ˆå™¨</li><li>è½¬åˆ°æˆ‘ä»¬ç½‘ç«™çš„ç™»å½•é¡µé¢</li><li>ä»¥æˆ‘ä»¬åˆ›å»ºçš„ç”¨æˆ·èº«ä»½ç™»å½•</li><li>åœ¨ç™»å½•çš„æ ‡é¢˜ä¸­æ–­è¨€æˆ‘ä»¬çš„ç”¨æˆ·åç§°</li></ol><p>æˆ‘ä»¬ä¸æƒ³è®©è¯¥ç”¨æˆ·ç•™åœ¨ç³»ç»Ÿæ•°æ®ä¸­ï¼Œé¿å…è„æ•°æ®ï¼Œä¹Ÿä¸æƒ³è®©æµè§ˆå™¨ä¼šè¯ä¿æŒè¿è¡Œï¼Œå› æ­¤æˆ‘ä»¬å¸Œæœ›ç¡®ä¿åˆ›å»ºè¿™äº›ä¸œè¥¿çš„è£…ç½®èƒ½å¤Ÿè‡ªè¡Œæ¸…ç†è„æ•°æ®å’Œå…³é—­æµè§ˆå™¨é¡µé¢ã€‚</p><p>ç¤ºä¾‹çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š</p><blockquote><p>å¯¹äºæ­¤ç¤ºä¾‹ï¼ŒæŸäº›å›ºå®šè£…ç½®ï¼ˆå³ base_url å’Œ admin_credentialsï¼‰æš—ç¤ºå­˜åœ¨äºå…¶ä»–åœ°æ–¹ã€‚æ‰€ä»¥ç°åœ¨ï¼Œæˆ‘ä»¬å‡è®¾å®ƒä»¬å­˜åœ¨ï¼Œä½†æˆ‘ä»¬åªæ˜¯ä¸å»å…³æ³¨å®ƒä»¬ã€‚</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> uuid <span class="hljs-keyword">import</span> uuid4<br><span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> urljoin<br><br><span class="hljs-keyword">from</span> selenium.webdriver <span class="hljs-keyword">import</span> Chrome<br><span class="hljs-keyword">import</span> pytest<br><br><span class="hljs-keyword">from</span> src.utils.pages <span class="hljs-keyword">import</span> LoginPage, LandingPage<br><span class="hljs-keyword">from</span> src.utils <span class="hljs-keyword">import</span> AdminApiClient<br><span class="hljs-keyword">from</span> src.utils.data_types <span class="hljs-keyword">import</span> User<br><br><span class="hljs-comment"># å…³æ³¨ä»£ç çš„åˆ†å±‚</span><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">admin_client</span>(<span class="hljs-params">base_url, admin_credentials</span>): <span class="hljs-comment"># è¿™ä¸ªfixtureåªè´Ÿè´£è¿æ¥Url</span><br>    <span class="hljs-keyword">return</span> AdminApiClient(base_url, **admin_credentials)<br><br><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">user</span>(<span class="hljs-params">admin_client</span>): <span class="hljs-comment"># è¿™ä¸ªfixtureåªè´Ÿè´£åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·ï¼Œå’Œç»“æŸæ—¶åˆ é™¤ç”¨æˆ·</span><br>    _user = User(name=<span class="hljs-string">&quot;Susan&quot;</span>, username=<span class="hljs-string">f&quot;testuser-<span class="hljs-subst">&#123;uuid4()&#125;</span>&quot;</span>, password=<span class="hljs-string">&quot;P4$$word&quot;</span>)<br>    admin_client.create_user(_user)<br>    <span class="hljs-keyword">yield</span> _user<br>    admin_client.delete_user(_user)<br><br><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">driver</span>(): <span class="hljs-comment"># è¿™ä¸ªfixtureï¼Œåªè´Ÿè´£å®šä¹‰æµè§ˆå™¨é©±åŠ¨æ‰“å¼€å’Œå…³é—­æµè§ˆå™¨</span><br>    _driver = Chrome()<br>    <span class="hljs-keyword">yield</span> _driver<br>    _driver.quit()<br><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">driver, base_url, user</span>): <span class="hljs-comment"># è¿™ä¸ªfixuteåªè´Ÿè´£ç”¨æˆ·çš„é¡µé¢çš„æ‰“å¼€å’Œç™»å½•ç”¨æˆ·</span><br>    driver.get(urljoin(base_url, <span class="hljs-string">&quot;/login&quot;</span>)) <span class="hljs-comment"># ç”¨æˆ·ç™»å½•ç¨‹åº</span><br>    page = LoginPage(driver)<br>    page.login(user)<br><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">landing_page</span>(<span class="hljs-params">driver, login</span>): <span class="hljs-comment"># è¿™ä¸ªfixture å€¼è´Ÿè´£å°†é©±åŠ¨å’Œç”¨æˆ·ç™»å½•é¡µé¢ç»„åˆåœ¨ä¸€èµ·ï¼Œæ„æ€å°±æ˜¯è´Ÿè´£æ‰“å¼€æµè§ˆå™¨ã€è¿›å…¥ç”¨æˆ·ç™»å½•é¡µé¢ç™»å½•</span><br>    <span class="hljs-keyword">return</span> LandingPage(driver)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_name_on_landing_page_after_login</span>(<span class="hljs-params">landing_page, user</span>): <span class="hljs-comment"># æµ‹è¯•ä»£ç ï¼Œå°†æ‰€æœ‰fixtueç»„åˆ</span><br>    <span class="hljs-keyword">assert</span> landing_page.header == <span class="hljs-string">f&quot;Welcome, <span class="hljs-subst">&#123;user.name&#125;</span>!&quot;</span><br></code></pre></td></tr></table></figure><p>ä¾èµ–å…³ç³»çš„å¸ƒç½®æ–¹å¼æ„å‘³ç€ä¸æ¸…æ¥šç”¨æˆ·<code>fixture</code>æ˜¯å¦ä¼šåœ¨é©±åŠ¨ç¨‹åº<code>fixture</code>ä¹‹å‰æ‰§è¡Œã€‚ </p><p>ä½†è¿™æ²¡å…³ç³»ï¼Œå› ä¸ºè¿™äº›éƒ½æ˜¯åŸå­æ“ä½œï¼Œæ‰€ä»¥å“ªä¸ªå…ˆè¿è¡Œå¹¶ä¸é‡è¦ï¼Œå› ä¸ºæµ‹è¯•çš„äº‹ä»¶åºåˆ—ä»ç„¶æ˜¯çº¿æ€§åŒ–çš„ã€‚ </p><p>ä½†é‡è¦çš„æ˜¯ï¼Œæ— è®ºå“ªä¸€ä¸ªå…ˆè¿è¡Œï¼Œå¦‚æœæŸä¸€ä¸ªæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œå¦ä¸€ä¸ªæ²¡æœ‰æŠ›å‡ºå¼‚å¸¸ï¼Œé‚£ä¹ˆä¸¤ä¸ªéƒ½ä¸ä¼šç•™ä¸‹ä»»ä½•ä¸œè¥¿ã€‚</p><p> å¦‚æœé©±åŠ¨ç¨‹åº<code>fixture</code>åœ¨ç”¨æˆ·<code>fixture</code>ä¹‹å‰æ‰§è¡Œï¼Œå¹¶ä¸”ç”¨æˆ·<code>fixture</code>å¼•å‘å¼‚å¸¸ï¼Œé©±åŠ¨ç¨‹åº<code>fixture</code>ä»ç„¶ä¼šé€€å‡ºï¼Œå¹¶ä¸”ç”¨æˆ·æ°¸è¿œä¸ä¼šè¢«åˆ›å»ºã€‚ å¦‚æœé©±åŠ¨ç¨‹åºæ˜¯å¼•å‘å¼‚å¸¸çš„äººï¼Œé‚£ä¹ˆé©±åŠ¨ç¨‹åºå°†æ°¸è¿œä¸ä¼šå¯åŠ¨ï¼Œç”¨æˆ·ä¹Ÿæ°¸è¿œä¸ä¼šè¢«åˆ›å»ºã€‚</p><p>è¿™é‡Œçš„æ„æ€è¿˜æ˜¯åšæ‹†åˆ†ï¼Œå°±åƒä»£ç åˆ†å±‚ä¸€æ ·ï¼ŒåŸå­å±‚çš„æ“ä½œå’Œä¸šåŠ¡å±‚çš„æ“ä½œåˆ†å¼€æ¥ï¼Œè¿™é‡Œçš„ä»£ç å°±æ˜¯å°†ç™»å½•çš„æ“ä½œå’Œåˆ›å»ºç”¨æˆ·çš„æ“ä½œåˆ†äº†å±‚ï¼Œæ‰“å¼€æµè§ˆå™¨çš„æ“ä½œ</p><ul><li>admin_client(base_url, admin_credentials) ï¼šè¿™ä¸ªfixtureåªè´Ÿè´£è¿æ¥å¯¹åº”çš„ Url</li><li>user(admin_client)ï¼šè¿™ä¸ªfixtureä¼šä½¿ç”¨åˆ°admin_clientï¼Œåªè´Ÿè´£åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·ï¼Œå’Œç»“æŸæ—¶åˆ é™¤ç”¨æˆ·</li><li>driver() ï¼šè¿™ä¸ªfixtureï¼Œåªè´Ÿè´£å®šä¹‰æµè§ˆå™¨é©±åŠ¨æ‰“å¼€å’Œå…³é—­æµè§ˆå™¨ï¼Œä¸åšå…¶ä»–æ“ä½œ</li><li>login(driver, base_url, user):  è¿™ä¸ªfixuteæ˜¯ä¸€ä¸ªç»„åˆï¼Œå°†driver å’Œ  base_url å’Œ user ä¸‰ä¸ªç»„åˆåˆ°ä¸€èµ·ï¼Œä½œç”¨æ˜¯æ‰“å¼€æµè§ˆå™¨ã€æ‰“å¼€å¯¹åº”çš„url æ‰§è¡Œç”¨æˆ·æ“ä½œï¼Œç»“æŸæ—¶ä¼šå°†æ‰€æœ‰fixtueçš„ç»“æŸæ“ä½œå…¨éƒ¨æ‰§è¡Œ</li></ul><p><strong>è¿™æ˜¯å¾ˆå¥½çš„ä¸€ç§ç¼–ç è®¾è®¡æ€æƒ³ï¼Œä¸€ç§åˆ†å±‚çš„æ€æƒ³ï¼Œå°†ç”¨æˆ·ç™»å½•çš„æ“ä½œå…¨éƒ¨åˆ†å±‚å‡ºæ¥ï¼Œæµ‹è¯•ä»£ç åªè´Ÿè´£æœ€ç»ˆçš„ç»„åˆï¼Œä¸å…³æ³¨å®ƒæ‰€ä¾èµ–çš„fixture çš„å®ç°é€»è¾‘ï¼Œåªå…³æ³¨è¿›å’Œå‡ºã€‚è¿™é‡Œå¾ˆé‡è¦</strong></p><h2 id="4-6-å®‰å…¨çš„è¿è¡Œå¤šä¸ªassertæ–­è¨€è¯­å¥"><a href="#4-6-å®‰å…¨çš„è¿è¡Œå¤šä¸ªassertæ–­è¨€è¯­å¥" class="headerlink" title="4.6 å®‰å…¨çš„è¿è¡Œå¤šä¸ªassertæ–­è¨€è¯­å¥"></a>4.6 å®‰å…¨çš„è¿è¡Œå¤šä¸ª<code>assert</code>æ–­è¨€è¯­å¥</h2><p>æœ‰æ—¶ï¼Œæ‚¨å¯èƒ½å¸Œæœ›åœ¨å®Œæˆæ‰€æœ‰è®¾ç½®åè¿è¡Œå¤šä¸ªæ–­è¨€ï¼Œè¿™æ˜¯æœ‰é“ç†çš„ï¼Œå› ä¸ºåœ¨æ›´å¤æ‚çš„ç³»ç»Ÿä¸­ï¼Œå•ä¸ªæ“ä½œå¯ä»¥å¯åŠ¨å¤šä¸ªè¡Œä¸º</p><p>pytest æœ‰ä¸€ç§æ–¹ä¾¿çš„æ–¹æ³•æ¥å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Œå®ƒç»“åˆäº†æˆ‘ä»¬åˆ°ç›®å‰ä¸ºæ­¢æ‰€è®¨è®ºçš„ä¸€äº›å†…å®¹ã€‚</p><p>æ‰€éœ€è¦çš„åªæ˜¯é€æ­¥æ‰©å¤§åˆ°æ›´å¤§çš„èŒƒå›´ï¼Œç„¶åå°†è¡Œä¸ºæ­¥éª¤å®šä¹‰ä¸ºè‡ªåŠ¨ä½¿ç”¨å›ºå®šè£…ç½®ï¼Œæœ€åç¡®ä¿æ‰€æœ‰å›ºå®šè£…ç½®éƒ½é’ˆå¯¹æ›´é«˜çº§åˆ«çš„èŒƒå›´</p><p>è®©æˆ‘ä»¬ä»ä¸Šé¢ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œå¹¶ç¨å¾®è°ƒæ•´ä¸€ä¸‹ã€‚å‡è®¾é™¤äº†æ£€æŸ¥æ ‡é¢˜ä¸­çš„æ¬¢è¿æ¶ˆæ¯ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜æƒ³æ£€æŸ¥æ³¨é”€æŒ‰é’®å’Œç”¨æˆ·ä¸ªäººèµ„æ–™çš„é“¾æ¥ã€‚</p><p>è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹å¦‚ä½•æ„å»ºå®ƒï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥è¿è¡Œå¤šä¸ªæ–­è¨€ï¼Œè€Œä¸å¿…å†æ¬¡é‡å¤æ‰€æœ‰è¿™äº›æ­¥éª¤ã€‚</p><blockquote><p>å¯¹äºæ­¤ç¤ºä¾‹ï¼ŒæŸäº›å›ºå®šè£…ç½®ï¼ˆå³ base_url å’Œ admin_credentialsï¼‰æš—ç¤ºå­˜åœ¨äºå…¶ä»–åœ°æ–¹ã€‚æ‰€ä»¥ç°åœ¨ï¼Œæˆ‘ä»¬å‡è®¾å®ƒä»¬å­˜åœ¨ï¼Œä½†æˆ‘ä»¬åªæ˜¯ä¸å»å…³æ³¨å®ƒä»¬ã€‚</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># contents of tests/end_to_end/test_login.py</span><br><span class="hljs-keyword">from</span> uuid <span class="hljs-keyword">import</span> uuid4<br><span class="hljs-keyword">from</span> urllib.parse <span class="hljs-keyword">import</span> urljoin<br><br><span class="hljs-keyword">from</span> selenium.webdriver <span class="hljs-keyword">import</span> Chrome<br><span class="hljs-keyword">import</span> pytest<br><br><span class="hljs-keyword">from</span> src.utils.pages <span class="hljs-keyword">import</span> LoginPage, LandingPage<br><span class="hljs-keyword">from</span> src.utils <span class="hljs-keyword">import</span> AdminApiClient<br><span class="hljs-keyword">from</span> src.utils.data_types <span class="hljs-keyword">import</span> User<br><br><br><span class="hljs-meta">@pytest.fixture(<span class="hljs-params">scope=<span class="hljs-string">&quot;class&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">admin_client</span>(<span class="hljs-params">base_url, admin_credentials</span>):<br>    <span class="hljs-keyword">return</span> AdminApiClient(base_url, **admin_credentials)<br><br><br><span class="hljs-meta">@pytest.fixture(<span class="hljs-params">scope=<span class="hljs-string">&quot;class&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">user</span>(<span class="hljs-params">admin_client</span>):<br>    _user = User(name=<span class="hljs-string">&quot;Susan&quot;</span>, username=<span class="hljs-string">f&quot;testuser-<span class="hljs-subst">&#123;uuid4()&#125;</span>&quot;</span>, password=<span class="hljs-string">&quot;P4$$word&quot;</span>)<br>    admin_client.create_user(_user)<br>    <span class="hljs-keyword">yield</span> _user<br>    admin_client.delete_user(_user)<br><br><br><span class="hljs-meta">@pytest.fixture(<span class="hljs-params">scope=<span class="hljs-string">&quot;class&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">driver</span>():<br>    _driver = Chrome()<br>    <span class="hljs-keyword">yield</span> _driver<br>    _driver.quit()<br><br><br><span class="hljs-meta">@pytest.fixture(<span class="hljs-params">scope=<span class="hljs-string">&quot;class&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">landing_page</span>(<span class="hljs-params">driver, login</span>):<br>    <span class="hljs-keyword">return</span> LandingPage(driver)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestLandingPageSuccess</span>:<br><span class="hljs-meta">    @pytest.fixture(<span class="hljs-params">scope=<span class="hljs-string">&quot;class&quot;</span>, autouse=<span class="hljs-literal">True</span></span>)</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">self, driver, base_url, user</span>):<br>        driver.get(urljoin(base_url, <span class="hljs-string">&quot;/login&quot;</span>))<br>        page = LoginPage(driver)<br>        page.login(user)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_name_in_header</span>(<span class="hljs-params">self, landing_page, user</span>):<br>        <span class="hljs-keyword">assert</span> landing_page.header == <span class="hljs-string">f&quot;Welcome, <span class="hljs-subst">&#123;user.name&#125;</span>!&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_sign_out_button</span>(<span class="hljs-params">self, landing_page</span>):<br>        <span class="hljs-keyword">assert</span> landing_page.sign_out_button.is_displayed()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_profile_link</span>(<span class="hljs-params">self, landing_page, user</span>):<br>        profile_href = urljoin(base_url, <span class="hljs-string">f&quot;/profile?id=<span class="hljs-subst">&#123;user.profile_id&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">assert</span> landing_page.profile_link.get_attribute(<span class="hljs-string">&quot;href&quot;</span>) == profile_href<br></code></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œè¿™äº›æ–¹æ³•åªæ˜¯åœ¨ç­¾åä¸­å¼•ç”¨ self ä½œä¸ºä¸€ç§å½¢å¼ã€‚æ²¡æœ‰ä»»ä½•çŠ¶æ€ä¸å®é™…çš„æµ‹è¯•ç±»ç›¸å…³ï¼Œå› ä¸ºå®ƒå¯èƒ½ä½äº unittest.TestCase æ¡†æ¶ä¸­ã€‚ä¸€åˆ‡éƒ½ç”± pytest å¤¹å…·ç³»ç»Ÿç®¡ç†ã€‚</p><p>æ¯ä¸ªæ–¹æ³•åªéœ€è¦è¯·æ±‚å®ƒå®é™…éœ€è¦çš„fixtureï¼Œè€Œä¸ç”¨æ‹…å¿ƒæ‰§è¡Œé¡ºåºã€‚è¿™æ˜¯å› ä¸ºfixtureè£…ç½®æ˜¯ä¸€ä¸ªè‡ªåŠ¨ä½¿ç”¨çš„fixtureï¼Œå¹¶ä¸”å®ƒç¡®ä¿æ‰€æœ‰å…¶ä»–fixtureåœ¨å®ƒä¹‹å‰æ‰§è¡Œã€‚</p><p>ä¸å†éœ€è¦è¿›è¡ŒçŠ¶æ€æ›´æ”¹ï¼Œå› æ­¤æµ‹è¯•å¯ä»¥è‡ªç”±åœ°è¿›è¡Œä»»æ„æ•°é‡çš„éçŠ¶æ€æ›´æ”¹æŸ¥è¯¢ï¼Œè€Œä¸å¿…å†’è¸©åˆ°å…¶ä»–æµ‹è¯•çš„é£é™©ã€‚</p><blockquote><p>ç™»å½•è£…ç½®ä¹Ÿåœ¨ç±»å†…éƒ¨å®šä¹‰ï¼Œå› ä¸ºå¹¶éæ¨¡å—ä¸­çš„æ¯ä¸ªå…¶ä»–æµ‹è¯•éƒ½æœŸæœ›æˆåŠŸç™»å½•ï¼Œå¹¶ä¸”å¯¹äºå¦ä¸€ä¸ªæµ‹è¯•ç±»ï¼Œè¯¥è¡Œä¸ºå¯èƒ½éœ€è¦ç¨å¾®ä¸åŒåœ°å¤„ç†ã€‚å¯ä»¥æ¯ä¸ªç±»æ¯ä¸ªç™»å½•</p></blockquote><blockquote><p>è¿™é‡Œè¡¨è¾¾çš„æ˜¯ï¼Œåœ¨ä¸€ä¸ªæµ‹è¯•ç±»å†…ï¼Œè¿è¡Œå¤šä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œå¤šä¸ªæ–­è¨€ï¼Œä¸ä¼šå› ä¸ºæŸä¸ªæµ‹è¯•ç”¨ä¾‹çš„æ–­è¨€å¤±è´¥äº†å¯¼è‡´å¦ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹æ— æ³•è¿è¡Œä¸‹ä¸‹å»ï¼Œè™½ç„¶ä»–ä»¬éƒ½æ˜¯ä½¿ç”¨çš„åŒä¸€ä¸ªfixtureå¤¹å…·ï¼Œä½ éœ€è¦å…¶ä»–çš„ç™»å½•å‰ç½®ï¼Œé‚£ä¹ˆä½ å¯ä»¥åœ¨å¦ä¸€ä¸ªç±»å†…ç¼–å†™ä¸€ä¸ªfixture ä¾›è¿™ä¸ªç±»å†…çš„ç”¨ä¾‹å»ä½¿ç”¨ï¼Œ</p></blockquote><p>ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æƒ³å›´ç»•æäº¤é”™è¯¯å‡­æ®ç¼–å†™å¦ä¸€ä¸ªæµ‹è¯•åœºæ™¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨æµ‹è¯•æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹å†…å®¹æ¥å¤„ç†å®ƒï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestLandingPageBadCredentials</span>:<br><span class="hljs-meta">    @pytest.fixture(<span class="hljs-params">scope=<span class="hljs-string">&quot;class&quot;</span></span>)</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">faux_user</span>(<span class="hljs-params">self, user</span>):<br>        _user = deepcopy(user)<br>        _user.password = <span class="hljs-string">&quot;badpass&quot;</span><br>        <span class="hljs-keyword">return</span> _user<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_raises_bad_credentials_exception</span>(<span class="hljs-params">self, login_page, faux_user</span>):<br>        <span class="hljs-keyword">with</span> pytest.raises(BadCredentialsException):<br>            login_page.login(faux_user)<br></code></pre></td></tr></table></figure><h2 id="4-7-Fixtures-å¯ä»¥ä½¿ç”¨å†…ç½®çš„requestingæ¥æµ‹è¯•ä¸Šä¸‹æ–‡ã€é‡ç‚¹ã€‘"><a href="#4-7-Fixtures-å¯ä»¥ä½¿ç”¨å†…ç½®çš„requestingæ¥æµ‹è¯•ä¸Šä¸‹æ–‡ã€é‡ç‚¹ã€‘" class="headerlink" title="4.7 Fixtures å¯ä»¥ä½¿ç”¨å†…ç½®çš„requestingæ¥æµ‹è¯•ä¸Šä¸‹æ–‡ã€é‡ç‚¹ã€‘"></a>4.7 Fixtures å¯ä»¥ä½¿ç”¨å†…ç½®çš„requestingæ¥æµ‹è¯•ä¸Šä¸‹æ–‡ã€é‡ç‚¹ã€‘</h2><p><code>fixture</code>å‡½æ•°å¯ä»¥æ¥å—<code>requesting</code>å¯¹è±¡æ¥å†…çœâ€œrequestâ€æ¥æµ‹è¯•å‡½æ•°ã€ç±»æˆ–æ¨¡å—ä¸Šä¸‹æ–‡ã€‚</p><p>è¿›ä¸€æ­¥æ‰©å±•å‰é¢çš„ smtp_connection å¤¹å…·ç¤ºä¾‹ï¼Œè®©æˆ‘ä»¬ä»ä½¿ç”¨æˆ‘ä»¬çš„å¤¹å…·çš„æµ‹è¯•æ¨¡å—ä¸­è¯»å–å¯é€‰çš„æœåŠ¡å™¨ URLï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># content of conftest.py</span><br><span class="hljs-keyword">import</span> smtplib<br><br><span class="hljs-keyword">import</span> pytest<br><br><span class="hljs-meta">@pytest.fixture(<span class="hljs-params">scope=<span class="hljs-string">&quot;module&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">smtp_connection</span>(<span class="hljs-params">request</span>):<br>    server = <span class="hljs-built_in">getattr</span>(request.module, <span class="hljs-string">&quot;smtpserver&quot;</span>, <span class="hljs-string">&quot;smtp.gmail.com&quot;</span>) <span class="hljs-comment"># getattr()è·å–å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¯¹è±¡æœ¬èº«ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯å¯¹è±¡çš„å±æ€§ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯å¦‚æœæ²¡æœ‰æ—¶çš„è¿”å›é»˜è®¤å€¼</span><br>    smtp_connection = smtplib.SMTP(server, <span class="hljs-number">587</span>, timeout=<span class="hljs-number">5</span>)<br>    <span class="hljs-keyword">yield</span> smtp_connection<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;finalizing <span class="hljs-subst">&#123;smtp_connection&#125;</span> (<span class="hljs-subst">&#123;server&#125;</span>)&quot;</span>)<br>    smtp_connection.close()<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ä½¿ç”¨<code>request.module</code>å±æ€§æ¥é€‰æ‹©æ€§åœ°ä»æµ‹è¯•æ¨¡å—è·å– <code>smtpserver </code>å±æ€§ã€‚å¦‚æœæˆ‘ä»¬å†æ¬¡æ‰§è¡Œï¼Œæ²¡æœ‰ä»€ä¹ˆæ”¹å˜ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">$ pytest -s -q --tb=no test_module.py<br>FFfinalizing &lt;smtplib.SMTP <span class="hljs-built_in">object</span> at <span class="hljs-number">0xdeadbeef0002</span>&gt; (smtp.gmail.com)<br><br>========================= short test summary info ==========================<br>FAILED test_module.py::test_ehlo - <span class="hljs-keyword">assert</span> <span class="hljs-number">0</span><br>FAILED test_module.py::test_noop - <span class="hljs-keyword">assert</span> <span class="hljs-number">0</span><br><span class="hljs-number">2</span> failed <span class="hljs-keyword">in</span> <span class="hljs-number">0.12</span>s<br></code></pre></td></tr></table></figure><p>è®©æˆ‘ä»¬å¿«é€Ÿåˆ›å»ºå¦ä¸€ä¸ªæµ‹è¯•æ¨¡å—ï¼Œè¯¥æ¨¡å—å®é™…ä¸Šåœ¨å…¶æ¨¡å—å‘½åç©ºé—´ä¸­è®¾ç½®æœåŠ¡å™¨ URLï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"> content of test_anothersmtp.py<br><br>smtpserver = <span class="hljs-string">&quot;mail.python.org&quot;</span>  <span class="hljs-comment"># will be read by smtp fixture</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_showhelo</span>(<span class="hljs-params">smtp_connection</span>):<br>    <span class="hljs-keyword">assert</span> <span class="hljs-number">0</span>, smtp_connection.helo()<br></code></pre></td></tr></table></figure><p>Running it:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python">$ pytest -qq --tb=short test_anothersmtp.py<br>F                                                                    [<span class="hljs-number">100</span>%]<br>================================= FAILURES =================================<br>______________________________ test_showhelo _______________________________<br>test_anothersmtp.py:<span class="hljs-number">6</span>: <span class="hljs-keyword">in</span> test_showhelo<br>    <span class="hljs-keyword">assert</span> <span class="hljs-number">0</span>, smtp_connection.helo()<br>E   AssertionError: (<span class="hljs-number">250</span>, <span class="hljs-string">b&#x27;mail.python.org&#x27;</span>)<br>E   <span class="hljs-keyword">assert</span> <span class="hljs-number">0</span><br>------------------------- Captured stdout teardown -------------------------<br>finalizing &lt;smtplib.SMTP <span class="hljs-built_in">object</span> at <span class="hljs-number">0xdeadbeef0003</span>&gt; (mail.python.org)<br>========================= short test summary info ==========================<br>FAILED test_anothersmtp.py::test_showhelo - AssertionError: (<span class="hljs-number">250</span>, <span class="hljs-string">b&#x27;mail....</span><br></code></pre></td></tr></table></figure><p>ç§ï¼ smtp_connection fixtureä»æ¨¡å—å‘½åç©ºé—´ä¸­è·å–æˆ‘ä»¬çš„é‚®ä»¶æœåŠ¡å™¨åç§°ã€‚</p><blockquote><p>é€šè¿‡request.moduleè·å–æµ‹è¯•æ¨¡å—å¯¹è±¡ï¼Œrequestæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å°±æ˜¯æ•´åœºæµ‹è¯•ï¼Œ</p><p>requestæ˜¯ä¸€ä¸ªç‰¹ä¿—çš„fixuteç”¨äºè·å–æœ‰å…³å½“å‰æµ‹è¯•çš„ä¿¡æ¯å’Œæ“ä½œ</p></blockquote><h2 id="4-8-ä½¿ç”¨æ ‡è®°å°†æ•°æ®ä¼ é€’åˆ°fixtures"><a href="#4-8-ä½¿ç”¨æ ‡è®°å°†æ•°æ®ä¼ é€’åˆ°fixtures" class="headerlink" title="4.8 ä½¿ç”¨æ ‡è®°å°†æ•°æ®ä¼ é€’åˆ°fixtures"></a>4.8 ä½¿ç”¨æ ‡è®°å°†æ•°æ®ä¼ é€’åˆ°fixtures</h2><p>ä½¿ç”¨requestå¯¹è±¡ï¼Œå¤¹å…·è¿˜å¯ä»¥è®¿é—®åº”ç”¨äºæµ‹è¯•åŠŸèƒ½çš„æ ‡è®°ã€‚è¿™å¯¹äºå°†æ•°æ®ä»æµ‹è¯•ä¼ é€’åˆ°å¤¹å…·ä¸­éå¸¸æœ‰ç”¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pytest<br><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">fixt</span>(<span class="hljs-params">request</span>): <span class="hljs-comment"># è¿™ä¸ªfixtureçš„ç›®çš„æ˜¯è·å–è¢«æµ‹ç”¨ä¾‹çš„markçš„æ ‡è®°ï¼Œ</span><br>    marker = request.node.get_closest_marker(<span class="hljs-string">&quot;fixt_data&quot;</span>) <span class="hljs-comment"># è·å–ç”¨ä¾‹çš„markæ ‡è®°çš„fixt_data</span><br>    <span class="hljs-keyword">if</span> marker <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-comment"># Handle missing marker in some way...</span><br>        data = <span class="hljs-literal">None</span> <span class="hljs-comment"># å¦‚æœæ²¡æœ‰ä½¿ç”¨æ ‡è®°ï¼Œå°±è¿”å›none </span><br>    <span class="hljs-keyword">else</span>:<br>        data = marker.args[<span class="hljs-number">0</span>] <span class="hljs-comment"># å¦‚æœæœ‰ä½¿ç”¨markæ ‡è®°ï¼Œå°±è¿”å›æ ‡è®°çš„å€¼</span><br>    <span class="hljs-comment"># Do something with the data</span><br>    <span class="hljs-keyword">return</span> data<br><br><span class="hljs-meta">@pytest.mark.fixt_data(<span class="hljs-params"><span class="hljs-number">42</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_fixt</span>(<span class="hljs-params">fixt</span>):<br>    <span class="hljs-keyword">assert</span> fixt == <span class="hljs-number">42</span> <span class="hljs-comment"># æ–­è¨€æˆåŠŸ</span><br></code></pre></td></tr></table></figure><h2 id="4-9-å·¥å‚-fixturesã€é‡ç‚¹ã€‘"><a href="#4-9-å·¥å‚-fixturesã€é‡ç‚¹ã€‘" class="headerlink" title="4.9 å·¥å‚ fixturesã€é‡ç‚¹ã€‘"></a>4.9 å·¥å‚ fixturesã€é‡ç‚¹ã€‘</h2><p>â€œå·¥å‚å³å¤¹å…·â€æ¨¡å¼å¯ä»¥åœ¨å•æ¬¡æµ‹è¯•ä¸­å¤šæ¬¡éœ€è¦å¤¹å…·ç»“æœçš„æƒ…å†µä¸‹æä¾›å¸®åŠ©ã€‚</p><p>å¤¹å…·ä¸æ˜¯ç›´æ¥è¿”å›æ•°æ®ï¼Œè€Œæ˜¯è¿”å›ç”Ÿæˆæ•°æ®çš„å‡½æ•°ã€‚ç„¶åå¯ä»¥åœ¨æµ‹è¯•ä¸­å¤šæ¬¡è°ƒç”¨è¯¥å‡½æ•°ã€‚</p><blockquote><p>è¿™é‡Œéœ€è¦äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯å·¥å‚å‡½æ•°ï¼Œæˆ–è€…è¯´å·¥å‚è®¾è®¡æ¨¡å¼äº†ï¼Œå·¥å‚å¯ä»¥æ ¹æ®æ¡ä»¶æˆ–è€…å‚æ•°çš„ä¸åŒæ¥åˆ›å»ºä¸åŒç±»å‹çš„å¯¹è±¡</p></blockquote><p>æ¼”å‘˜å¯ä»¥æ ¹æ®éœ€è¦æ‹¥æœ‰å‚æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">make_customer_record</span>():<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_make_customer_record</span>(<span class="hljs-params">name</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;Making customer record for <span class="hljs-subst">&#123;name&#125;</span>&quot;</span>)<br>        <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;name&quot;</span>: name, <span class="hljs-string">&quot;orders&quot;</span>: []&#125;<br><br>    <span class="hljs-keyword">return</span> _make_customer_record <span class="hljs-comment">#è¿”å›çš„æ˜¯ä¸€ä¸ªå‡½æ•°</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_customer_records</span>(<span class="hljs-params">make_customer_record</span>):<br>    <span class="hljs-comment"># è°ƒç”¨3æ¬¡ï¼Œè·å¾—3ä¸ªä¸åŒçš„å¯¹è±¡ï¼Œå› ä¸ºè¿™ä¸ªfixtureçš„è¿”å›å€¼å°±æ˜¯ä¸€ä¸ªå‡½æ•°</span><br>    customer_1 = make_customer_record(<span class="hljs-string">&quot;Lisa&quot;</span>) <span class="hljs-comment"># è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼ŒMaking customer record for Lisa</span><br>    customer_2 = make_customer_record(<span class="hljs-string">&quot;Mike&quot;</span>) <span class="hljs-comment"># Making customer record for Mike</span><br>    customer_3 = make_customer_record(<span class="hljs-string">&quot;Meredith&quot;</span>) <span class="hljs-comment"># Making customer record for Meredith</span><br></code></pre></td></tr></table></figure><p>å¦‚æœå·¥å‚åˆ›å»ºçš„æ•°æ®éœ€è¦ç®¡ç†ï¼Œå¤¹å…·å¯ä»¥å¤„ç†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">make_customer_record</span>():<br>    created_records = []<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">_make_customer_record</span>(<span class="hljs-params">name</span>):<br>        record = models.Customer(name=name, orders=[])<br>        created_records.append(record)<br>        <span class="hljs-keyword">return</span> record<br><br>    <span class="hljs-keyword">yield</span> _make_customer_record<br><br>    <span class="hljs-keyword">for</span> record <span class="hljs-keyword">in</span> created_records: <span class="hljs-comment"># è¿™ä¸€æ¡åœ¨æµ‹è¯•ç”¨ä¾‹ç»“æŸæ—¶æ‰§è¡Œ</span><br>        record.destroy() <span class="hljs-comment"># å¾ªç¯é”€æ¯çš„æ„æ€ï¼Œ</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_customer_records</span>(<span class="hljs-params">make_customer_record</span>):<br>    customer_1 = make_customer_record(<span class="hljs-string">&quot;Lisa&quot;</span>)<br>    customer_2 = make_customer_record(<span class="hljs-string">&quot;Mike&quot;</span>)<br>    customer_3 = make_customer_record(<span class="hljs-string">&quot;Meredith&quot;</span>)<br></code></pre></td></tr></table></figure><blockquote><p><code>fixture</code>å¯ä»¥å®šä¹‰æˆä¸€ä¸ªå·¥å‚æ–¹æ³•ä¾›æµ‹è¯•ç”¨ä¾‹å»ä½¿ç”¨</p></blockquote><h2 id="4-10-å‚æ•°åŒ–-fixturesã€é‡ç‚¹ã€‘"><a href="#4-10-å‚æ•°åŒ–-fixturesã€é‡ç‚¹ã€‘" class="headerlink" title="4.10 å‚æ•°åŒ– fixturesã€é‡ç‚¹ã€‘"></a>4.10 å‚æ•°åŒ– fixturesã€é‡ç‚¹ã€‘</h2><p>å¤¹å…·å‡½æ•°å¯ä»¥å‚æ•°åŒ–ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒä»¬å°†è¢«å¤šæ¬¡è°ƒç”¨ï¼Œæ¯æ¬¡æ‰§è¡Œä¸€ç»„ç›¸å…³æµ‹è¯•ï¼Œå³ä¾èµ–äºè¯¥å¤¹å…·çš„æµ‹è¯•ã€‚</p><p>æµ‹è¯•å‡½æ•°é€šå¸¸ä¸éœ€è¦çŸ¥é“å®ƒä»¬çš„é‡æ–°è¿è¡Œã€‚å¤¹å…·å‚æ•°åŒ–æœ‰åŠ©äºä¸ºç»„ä»¶ç¼–å†™è¯¦å°½çš„åŠŸèƒ½æµ‹è¯•ï¼Œè¿™äº›ç»„ä»¶æœ¬èº«å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼è¿›è¡Œé…ç½®ã€‚</p><p>å±•å‰é¢çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬å¯ä»¥æ ‡è®°è¯¥å›ºå®šè£…ç½®ä»¥åˆ›å»ºä¸¤ä¸ª smtp_connection å›ºå®šè£…ç½®å®ä¾‹ï¼Œè¿™å°†å¯¼è‡´ä½¿ç”¨è¯¥å›ºå®šè£…ç½®çš„æ‰€æœ‰æµ‹è¯•è¿è¡Œä¸¤æ¬¡ã€‚</p><p>Fixtureå‡½æ•°é€šè¿‡ç‰¹æ®Šçš„è¯·æ±‚å¯¹è±¡æ¥è®¿é—®æ¯ä¸ªå‚æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># content of conftest.py</span><br><span class="hljs-keyword">import</span> smtplib<br><br><span class="hljs-keyword">import</span> pytest<br><br><span class="hljs-meta">@pytest.fixture(<span class="hljs-params">scope=<span class="hljs-string">&quot;module&quot;</span>, params=[<span class="hljs-string">&quot;smtp.gmail.com&quot;</span>, <span class="hljs-string">&quot;mail.python.org&quot;</span>]</span>) </span><span class="hljs-comment"># æ³¨æ„è¿™é‡Œå®šä¹‰çš„params = [ ] å‚æ•°æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œæ‰€ä»¥ä¼šè¿è¡Œä¸¤æ¬¡ï¼Œå¦‚ä½•æ‹¿åˆ°è¿™ä¸ªå‚æ•°å‘¢ï¼Ÿ</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">smtp_connection</span>(<span class="hljs-params">request</span>):<br>    smtp_connection = smtplib.SMTP(request.param, <span class="hljs-number">587</span>, timeout=<span class="hljs-number">5</span>) <span class="hljs-comment"># ç”¨request.paramå»æ‹¿å³å¯</span><br>    <span class="hljs-keyword">yield</span> smtp_connection<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;finalizing <span class="hljs-subst">&#123;smtp_connection&#125;</span>&quot;</span>)<br>    smtp_connection.close()<br></code></pre></td></tr></table></figure><p>ä¸»è¦éœ€è¦äº†è§£çš„æ˜¯ä½¿ç”¨ @pytest.fixture å£°æ˜å‚æ•°ï¼Œè¿™æ˜¯ä¸€ä¸ªå€¼åˆ—è¡¨ï¼Œå…¶ä¸­çš„æ¯ä¸ªå€¼å°†è¢«æ‰§è¡Œï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡ request.param è®¿é—®å€¼ã€‚</p><p><strong>å†™ä¸€ä¸ªç®€å•çš„æ›´å®¹æ˜“ç†è§£ï¼š</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@pytest.fixture(<span class="hljs-params">scope=<span class="hljs-string">&quot;session&quot;</span>, params=[ [<span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;two&#x27;</span>],[<span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;one&#x27;</span>]]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_param</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-keyword">return</span> request.param<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_getParam</span>(<span class="hljs-params">get_param</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;ç¬¬<span class="hljs-subst">&#123;get_param[<span class="hljs-number">0</span>]&#125;</span>æ¬¡è¿è¡Œï¼Œæ‰“å°<span class="hljs-subst">&#123;get_param[<span class="hljs-number">1</span>]&#125;</span>&quot;</span>)<br><span class="hljs-comment"># è¿è¡Œç»“æœï¼š</span><br>============================= test session starts ==============================<br>platform linux -- Python <span class="hljs-number">3.10</span><span class="hljs-number">.12</span>, pytest-<span class="hljs-number">8.1</span><span class="hljs-number">.1</span>, pluggy-<span class="hljs-number">1.4</span><span class="hljs-number">.0</span><br>configfile: pytest.ini<br>plugins: anyio-<span class="hljs-number">4.2</span><span class="hljs-number">.0</span><br>collected <span class="hljs-number">2</span> items<br><br>testcases/test_fixturestest.py <br>ç¬¬<span class="hljs-number">1</span>æ¬¡è¿è¡Œï¼Œæ‰“å°one<br>.ç¬¬<span class="hljs-number">2</span>æ¬¡è¿è¡Œï¼Œæ‰“å°two<br>.<br><br>============================== <span class="hljs-number">2</span> passed <span class="hljs-keyword">in</span> <span class="hljs-number">0.01</span>s ======================<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæµ‹è¯•å‡½æ•°ï¼Œé’ˆå¯¹get_paramæ–¹æ³•ï¼Œè¿è¡Œäº†ä¸¤æ¬¡ï¼Œ</p><p>pytest å¯ä»¥ä½¿ç”¨å­—ç¬¦ä¸²è¿›è¡Œæ ‡è®°ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²æ˜¯å‚æ•°åŒ–fixtureå¤¹å…·ä¸­æ¯ä¸ªå¤¹å…·å€¼çš„æµ‹è¯• ID æ ‡ç­¾ï¼Œã€‚è¿™äº› ID å¯ä»¥ä¸ -k ä¸€èµ·ä½¿ç”¨æ¥é€‰æ‹©è¿è¡Œçš„æŒ‡å®šçš„æµ‹è¯•ç”¨ä¾‹ï¼Œå¹¶ä¸”å®ƒä»¬ä¹Ÿæ”¯æŒå¤±è´¥é‡è¯•ï¼Œ</p><p>ä¹Ÿå¯ä»¥åœ¨å‘½ä»¤è¡Œæ‰§è¡Œæµ‹è¯•æ—¶åŠ å…¥ <code>--collect-only </code>å‘½ä»¤å¯ä»¥åœ¨è¿è¡Œæµ‹è¯•æ—¶å±•ç¤ºå¯¹åº”çš„ ID</p><p>æ•°å­—ã€å­—ç¬¦ä¸²ã€å¸ƒå°”å€¼å’Œ None å°†åœ¨æµ‹è¯• ID ä¸­ä½¿ç”¨å…¶å¸¸ç”¨çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ã€‚</p><p>å¯¹äºå…¶ä»–å¯¹è±¡ï¼Œpytest å°†æ ¹æ®å‚æ•°åç§°åˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²ã€‚é€šè¿‡ä½¿ç”¨ ids å…³é”®å­—å‚æ•°ï¼Œå¯ä»¥ä¸ºæŸä¸ªå›ºå®šè£…ç½®å€¼è‡ªå®šä¹‰æµ‹è¯• ID ä¸­ä½¿ç”¨çš„å­—ç¬¦ä¸²ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># content of test_ids.py</span><br><span class="hljs-keyword">import</span> pytest<br><br><br><span class="hljs-meta">@pytest.fixture(<span class="hljs-params">params=[<span class="hljs-number">0</span>, <span class="hljs-number">1</span>], ids=[<span class="hljs-string">&quot;spam&quot;</span>, <span class="hljs-string">&quot;ham&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">a</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-built_in">print</span>(request.param)<br>    <span class="hljs-keyword">return</span> request.param<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_a</span>(<span class="hljs-params">a</span>):<br>    <span class="hljs-keyword">pass</span><br><br>========================= test session starts ==============================<br>platform linux -- Python <span class="hljs-number">3.10</span><span class="hljs-number">.12</span>, pytest-<span class="hljs-number">8.1</span><span class="hljs-number">.1</span>, pluggy-<span class="hljs-number">1.4</span><span class="hljs-number">.0</span> -- /home/wang/code/venvadmin/<span class="hljs-built_in">bin</span>/python<br>cachedir: .pytest_cache<br>rootdir: /home/<br>configfile: pytest.ini<br>plugins: anyio-<span class="hljs-number">4.2</span><span class="hljs-number">.0</span><br>collecting ... collected <span class="hljs-number">2</span> items<br><br>testcases/test_fixturestest.py::test_a[ham] <span class="hljs-number">1</span> <span class="hljs-comment"># ham æ˜¯ id 1 æ˜¯å‚æ•°</span><br>PASSED<br>testcases/test_fixturestest.py::test_a[spam] <span class="hljs-number">0</span> <span class="hljs-comment"># spam æ˜¯ id 1 æ˜¯å‚æ•°</span><br>PASSED<br><br>============================== <span class="hljs-number">2</span> passed <span class="hljs-keyword">in</span> <span class="hljs-number">0.01</span>s ========<br><span class="hljs-comment"># ä¹Ÿå¯ä»¥æ”¯æŒåŠ¨æ€ç»™æ ‡ç­¾</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">idfn</span>(<span class="hljs-params">fixture_value</span>): <span class="hljs-comment"># åŠ¨æ€ç»™æ ‡ç­¾</span><br>    <span class="hljs-keyword">if</span> fixture_value == <span class="hljs-number">0</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;eggs&quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;eggs&quot;</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ‰§è¡Œäº† &quot;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br><br><br><span class="hljs-meta">@pytest.fixture(<span class="hljs-params">params=[<span class="hljs-number">0</span>, <span class="hljs-number">1</span>], ids=idfn</span>) </span><span class="hljs-comment"># æ”¯æŒåŠ¨æ€ä¼ å…¥æ ‡ç­¾</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">b</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-built_in">print</span>(request.param)<br>    <span class="hljs-keyword">return</span> request.param<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_b</span>(<span class="hljs-params">b</span>):<br>    <span class="hljs-keyword">pass</span><br>====================== test session starts ==============================<br>platform linux -- Python <span class="hljs-number">3.10</span><span class="hljs-number">.12</span>, pytest-<span class="hljs-number">8.1</span><span class="hljs-number">.1</span>, pluggy-<span class="hljs-number">1.4</span><span class="hljs-number">.0</span> -- /home/wang/code//venvadmin/<span class="hljs-built_in">bin</span>/python<br>cachedir: .pytest_cache<br>rootdir: /home/<br>configfile: pytest.ini<br>plugins: anyio-<span class="hljs-number">4.2</span><span class="hljs-number">.0</span><br>collecting ... eggs<br>æ‰§è¡Œäº† <br>collected <span class="hljs-number">2</span> items<br><br>testcases/test_fixturestest.py::test_b[<span class="hljs-number">1</span>] <span class="hljs-number">1</span> <span class="hljs-comment"># id å’Œ å‚æ•°åŒ–</span><br>PASSED<br>testcases/test_fixturestest.py::test_b[eggs] <span class="hljs-number">0</span><br>PASSED<br><br>============================== <span class="hljs-number">2</span> passed <span class="hljs-keyword">in</span> <span class="hljs-number">0.01</span>s ===============<br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥åœ¨<code>pytest.ini</code>é‡Œé¢ä½¿ç”¨<code>-k</code>æ¥å­—ç¬¦ä¸²æ¥æŒ‡å®šæ ‡ç­¾è¿è¡Œ</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># content of pytest.ini</span><br><span class="hljs-section">[pytest]</span><br><span class="hljs-attr">addopts</span> = -s -v  -k <span class="hljs-string">&quot;ham&quot;</span><br><span class="hljs-comment"># -s æ˜¯æ•è·æ‰“å°è¾“å‡ºï¼Œå¦‚æœæœ‰ç”¨åˆ°print()æ‰“å°ç»ˆç«¯è¾“å‡ºçš„è¯ï¼Œå°±å¿…é¡»å°±åŠ è¿™ä¸ª</span><br><span class="hljs-comment"># -v å°±æ˜¯å±•ç¤ºæ ‡è¯†ç¬¦ï¼Œ</span><br><span class="hljs-comment"># -k å°±æ˜¯åˆ¶å®šè¡¨ç¤ºç¬¦</span><br></code></pre></td></tr></table></figure><h2 id="4-11-ä½¿ç”¨å¸¦æ ‡è®°å‚æ•°åŒ–fixtureå¤¹å…·"><a href="#4-11-ä½¿ç”¨å¸¦æ ‡è®°å‚æ•°åŒ–fixtureå¤¹å…·" class="headerlink" title="4.11 ä½¿ç”¨å¸¦æ ‡è®°å‚æ•°åŒ–fixtureå¤¹å…·"></a>4.11 ä½¿ç”¨å¸¦æ ‡è®°å‚æ•°åŒ–fixtureå¤¹å…·</h2><p><code>pytest.param()</code> å¯ç”¨äºåœ¨å‚æ•°åŒ–è£…ç½®çš„å€¼é›†ä¸­åº”ç”¨æ ‡è®°ï¼Œå…¶æ–¹å¼ä¸ä¸ @pytest.mark.parametrize ä½¿ç”¨çš„æ–¹å¼ç›¸åŒã€‚</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># content of test_fixture_marks.py</span><br><span class="hljs-keyword">import</span> pytest<br><br><br><span class="hljs-meta">@pytest.fixture(<span class="hljs-params">params=[<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, pytest.param(<span class="hljs-params"><span class="hljs-number">2</span>, marks=pytest.mark.skip</span>)]</span>) </span><span class="hljs-comment"># ä½¿ç”¨ pytest.param</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">data_set</span>(<span class="hljs-params">request</span>):<br>    <span class="hljs-keyword">return</span> request.param<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_data</span>(<span class="hljs-params">data_set</span>):<br>    <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure><p>è¿è¡Œæ­¤æµ‹è¯•å°†è·³è¿‡å¯¹å€¼ä¸º 2 çš„ data_set çš„è°ƒç”¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python">$ pytest test_fixture_marks.py -v<br>=========================== test session starts ============================<br>platform linux -- Python <span class="hljs-number">3.</span>x.y, pytest-<span class="hljs-number">8.</span>x.y, pluggy-<span class="hljs-number">1.</span>x.y -- $PYTHON_PREFIX/<span class="hljs-built_in">bin</span>/python<br>cachedir: .pytest_cache<br>rootdir: /home/sweet/project<br>collecting ... collected <span class="hljs-number">3</span> items<br><br>test_fixture_marks.py::test_data[<span class="hljs-number">0</span>] PASSED                           [ <span class="hljs-number">33</span>%]<br>test_fixture_marks.py::test_data[<span class="hljs-number">1</span>] PASSED                           [ <span class="hljs-number">66</span>%]<br>test_fixture_marks.py::test_data[<span class="hljs-number">2</span>] SKIPPED (unconditional skip)     [<span class="hljs-number">100</span>%]<br><br>======================= <span class="hljs-number">2</span> passed, <span class="hljs-number">1</span> skipped <span class="hljs-keyword">in</span> <span class="hljs-number">0.12</span>s =======================<br></code></pre></td></tr></table></figure><h2 id="4-12-æ¨¡å—åŒ–ï¼šä»ä¸€ä¸ªfixutreæ–¹æ³•ä¸­ä½¿ç”¨fixture"><a href="#4-12-æ¨¡å—åŒ–ï¼šä»ä¸€ä¸ªfixutreæ–¹æ³•ä¸­ä½¿ç”¨fixture" class="headerlink" title="4.12 æ¨¡å—åŒ–ï¼šä»ä¸€ä¸ªfixutreæ–¹æ³•ä¸­ä½¿ç”¨fixture"></a>4.12 æ¨¡å—åŒ–ï¼šä»ä¸€ä¸ªfixutreæ–¹æ³•ä¸­ä½¿ç”¨fixture</h2><p>æ¨¡å—åŒ–ï¼šä½¿ç”¨å›ºå®šåŠŸèƒ½ä¸­çš„å›ºå®šè£…ç½®</p><p>é™¤äº†åœ¨æµ‹è¯•å‡½æ•°ä¸­ä½¿ç”¨å›ºå®šè£…ç½®ä¹‹å¤–ï¼Œå›ºå®šè£…ç½®å‡½æ•°è¿˜å¯ä»¥ä½¿ç”¨å…¶ä»–å›ºå®šè£…ç½®æœ¬èº«</p><p>è¿™æœ‰åŠ©äºè®¾å¤‡çš„æ¨¡å—åŒ–è®¾è®¡ï¼Œå¹¶å…è®¸åœ¨è®¸å¤šé¡¹ç›®ä¸­é‡å¤ä½¿ç”¨ç‰¹å®šäºæ¡†æ¶çš„è®¾å¤‡ã€‚ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œ</p><p>æˆ‘ä»¬å¯ä»¥æ‰©å±•å‰é¢çš„ç¤ºä¾‹å¹¶å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡åº”ç”¨ç¨‹åºï¼Œå°†å·²å®šä¹‰çš„ smtp_connection èµ„æºç²˜è´´åˆ°å…¶ä¸­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># content of test_appsetup.py</span><br><br><span class="hljs-keyword">import</span> pytest<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">App</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, smtp_connection</span>):<br>        self.smtp_connection = smtp_connection<br><br><br><span class="hljs-meta">@pytest.fixture(<span class="hljs-params">scope=<span class="hljs-string">&quot;module&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">app</span>(<span class="hljs-params">smtp_connection</span>):<br>    <span class="hljs-keyword">return</span> App(smtp_connection) <span class="hljs-comment"># è¿™ä¸ªsmtp_connectionå°±æ˜¯ä¹‹å‰å®šä¹‰çš„fixture åœ¨è¿™ä¸ªè¢«ä½¿ç”¨äº†</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_smtp_connection_exists</span>(<span class="hljs-params">app</span>):<br>    <span class="hljs-keyword">assert</span> app.smtp_connection<br></code></pre></td></tr></table></figure><p>ç”±äºsmtp_connectionçš„å‚æ•°åŒ–ï¼Œæµ‹è¯•å°†ä½¿ç”¨ä¸¤ä¸ªä¸åŒçš„Appå®ä¾‹å’Œå„è‡ªçš„smtpæœåŠ¡å™¨è¿è¡Œä¸¤æ¬¡ã€‚åº”ç”¨ç¨‹åºfixtureä¸éœ€è¦çŸ¥é“smtp_connectionå‚æ•°åŒ–ï¼Œå› ä¸ºpytestå°†å®Œå…¨åˆ†æfixtureä¾èµ–å…³ç³»å›¾ã€‚</p><p>æ³¨æ„ï¼Œapp fixtureçš„ä½œç”¨åŸŸæ˜¯moduleï¼Œå¹¶ä½¿ç”¨äº†ä¸€ä¸ªæ¨¡å—ä½œç”¨åŸŸçš„smtp_connection fixtureã€‚å¦‚æœsmtp_connectionç¼“å­˜åœ¨ä¼šè¯ä½œç”¨åŸŸä¸­ï¼Œè¿™ä¸ªä¾‹å­ä»ç„¶å¯ä»¥å·¥ä½œ:fixtureå¯ä»¥ä½¿ç”¨â€œæ›´å¹¿â€ä½œç”¨åŸŸçš„fixtureï¼Œä½†åä¹‹åˆ™ä¸è¡Œ:ä¼šè¯ä½œç”¨åŸŸçš„fixtureä¸èƒ½ä»¥æœ‰æ„ä¹‰çš„æ–¹å¼ä½¿ç”¨æ¨¡å—ä½œç”¨åŸŸçš„fixtureã€‚</p><h2 id="4-13-æŒ‰fixtureå®ä¾‹è‡ªåŠ¨å¯¹æµ‹è¯•è¿›è¡Œåˆ†ç»„"><a href="#4-13-æŒ‰fixtureå®ä¾‹è‡ªåŠ¨å¯¹æµ‹è¯•è¿›è¡Œåˆ†ç»„" class="headerlink" title="4.13 æŒ‰fixtureå®ä¾‹è‡ªåŠ¨å¯¹æµ‹è¯•è¿›è¡Œåˆ†ç»„"></a>4.13 æŒ‰fixtureå®ä¾‹è‡ªåŠ¨å¯¹æµ‹è¯•è¿›è¡Œåˆ†ç»„</h2><p>Pyteståœ¨æµ‹è¯•è¿è¡ŒæœŸé—´æœ€å°åŒ–æ´»åŠ¨fixtureçš„æ•°é‡ã€‚å¦‚æœæ‚¨æœ‰ä¸€ä¸ªå‚æ•°åŒ–çš„fixtureï¼Œé‚£ä¹ˆä½¿ç”¨å®ƒçš„æ‰€æœ‰æµ‹è¯•å°†é¦–å…ˆä½¿ç”¨ä¸€ä¸ªå®ä¾‹æ‰§è¡Œï¼Œç„¶ååœ¨åˆ›å»ºä¸‹ä¸€ä¸ªfixtureå®ä¾‹ä¹‹å‰è°ƒç”¨finalizersã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿™ç®€åŒ–äº†åˆ›å»ºå’Œä½¿ç”¨å…¨å±€çŠ¶æ€çš„åº”ç”¨ç¨‹åºçš„æµ‹è¯•ã€‚</p><p>ä¸‹é¢çš„ä¾‹å­ä½¿ç”¨äº†ä¸¤ä¸ªå‚æ•°åŒ–çš„fixtureï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯åŸºäºæ¯ä¸ªæ¨¡å—çš„ï¼Œæ‰€æœ‰çš„å‡½æ•°éƒ½æ‰§è¡Œprintè°ƒç”¨æ¥æ˜¾ç¤ºsetup&#x2F;teardownæµç¨‹:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># content of test_module.py</span><br><span class="hljs-keyword">import</span> pytest<br><br><br><span class="hljs-meta">@pytest.fixture(<span class="hljs-params">scope=<span class="hljs-string">&quot;module&quot;</span>, params=[<span class="hljs-string">&quot;mod1&quot;</span>, <span class="hljs-string">&quot;mod2&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">modarg</span>(<span class="hljs-params">request</span>):<br>    param = request.param<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;  SETUP modarg&quot;</span>, param)<br>    <span class="hljs-keyword">yield</span> param<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;  TEARDOWN modarg&quot;</span>, param)<br><br><br><span class="hljs-meta">@pytest.fixture(<span class="hljs-params">scope=<span class="hljs-string">&quot;function&quot;</span>, params=[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">otherarg</span>(<span class="hljs-params">request</span>):<br>    param = request.param<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;  SETUP otherarg&quot;</span>, param)<br>    <span class="hljs-keyword">yield</span> param<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;  TEARDOWN otherarg&quot;</span>, param)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_0</span>(<span class="hljs-params">otherarg</span>):  <span class="hljs-comment"># è¿™ä¸ªç”¨çš„æ˜¯otherarg æ˜¯ç‹¬ç«‹çš„æ‰§è¡Œäº†2æ¬¡</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;  RUN test0 with otherarg&quot;</span>, otherarg)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_1</span>(<span class="hljs-params">modarg</span>): <span class="hljs-comment"># è¿™ä¸ªç”¨äº†modarg æ‰§è¡Œäº†ä¸¤æ¬¡</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;  RUN test1 with modarg&quot;</span>, modarg)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_2</span>(<span class="hljs-params">otherarg, modarg</span>): <span class="hljs-comment"># è¿™ä¸ªæ˜¯2+2æ¬¡ï¼Œ</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;  RUN test2 with otherarg <span class="hljs-subst">&#123;otherarg&#125;</span> and modarg <span class="hljs-subst">&#123;modarg&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure><p>æ€»å…±æ‰§è¡Œäº†8æ¬¡,è®©æˆ‘ä»¬åœ¨è¯¦ç»†æ¨¡å¼ä¸‹è¿è¡Œæµ‹è¯•å¹¶æŸ¥çœ‹æ‰“å°è¾“å‡ºï¼šè¯¦ç»†æ¨¡å¼ï¼Œå°±æ˜¯åŠ äº†-sçš„æ¨¡å¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs python">======================= test session starts ==============================<br>platform linux -- Python <span class="hljs-number">3.10</span><span class="hljs-number">.12</span>, pytest-<span class="hljs-number">8.1</span><span class="hljs-number">.1</span>, pluggy-<span class="hljs-number">1.4</span><span class="hljs-number">.0</span> -- /home/wang/code//venvadmin/<span class="hljs-built_in">bin</span>/python<br>cachedir: .pytest_cache<br>rootdir: /home/wang/<br>configfile: pytest.ini<br>plugins: anyio-<span class="hljs-number">4.2</span><span class="hljs-number">.0</span><br>collecting ... collected <span class="hljs-number">8</span> items<br><br>testcases/test_fixturestest.py::test_0[<span class="hljs-number">1</span>]   SETUP otherarg <span class="hljs-number">1</span><br>  RUN test0 <span class="hljs-keyword">with</span> otherarg <span class="hljs-number">1</span><br>PASSED  TEARDOWN otherarg <span class="hljs-number">1</span><br><br>testcases/test_fixturestest.py::test_0[<span class="hljs-number">2</span>]   SETUP otherarg <span class="hljs-number">2</span><br>  RUN test0 <span class="hljs-keyword">with</span> otherarg <span class="hljs-number">2</span><br>PASSED  TEARDOWN otherarg <span class="hljs-number">2</span><br><br>testcases/test_fixturestest.py::test_1[mod1]   SETUP modarg mod1<br>  RUN test1 <span class="hljs-keyword">with</span> modarg mod1<br>PASSED<br>testcases/test_fixturestest.py::test_2[mod1-<span class="hljs-number">1</span>]   SETUP otherarg <span class="hljs-number">1</span><br>  RUN test2 <span class="hljs-keyword">with</span> otherarg <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> modarg mod1<br>PASSED  TEARDOWN otherarg <span class="hljs-number">1</span><br><br>testcases/test_fixturestest.py::test_2[mod1-<span class="hljs-number">2</span>]   SETUP otherarg <span class="hljs-number">2</span><br>  RUN test2 <span class="hljs-keyword">with</span> otherarg <span class="hljs-number">2</span> <span class="hljs-keyword">and</span> modarg mod1<br>PASSED  TEARDOWN otherarg <span class="hljs-number">2</span><br><br>testcases/test_fixturestest.py::test_1[mod2]   TEARDOWN modarg mod1<br>  SETUP modarg mod2<br>  RUN test1 <span class="hljs-keyword">with</span> modarg mod2<br>PASSED<br>testcases/test_fixturestest.py::test_2[mod2-<span class="hljs-number">1</span>]   SETUP otherarg <span class="hljs-number">1</span><br>  RUN test2 <span class="hljs-keyword">with</span> otherarg <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> modarg mod2<br>PASSED  TEARDOWN otherarg <span class="hljs-number">1</span><br><br>testcases/test_fixturestest.py::test_2[mod2-<span class="hljs-number">2</span>]   SETUP otherarg <span class="hljs-number">2</span><br>  RUN test2 <span class="hljs-keyword">with</span> otherarg <span class="hljs-number">2</span> <span class="hljs-keyword">and</span> modarg mod2<br>PASSED  TEARDOWN otherarg <span class="hljs-number">2</span><br>  TEARDOWN modarg mod2<br><br><br>============================== <span class="hljs-number">8</span> passed <span class="hljs-keyword">in</span> <span class="hljs-number">0.01</span>s =============<br></code></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥çœ‹åˆ°ï¼Œå‚æ•°åŒ–çš„æ¨¡å—èŒƒå›´çš„å»ºæ¨¡èµ„æºå¯¼è‡´äº†æµ‹è¯•æ‰§è¡Œçš„æ’åºï¼Œä»è€Œå¯¼è‡´äº†æœ€å°‘å¯èƒ½çš„â€œæ´»åŠ¨â€èµ„æºã€‚mod1å‚æ•°åŒ–èµ„æºçš„ç»ˆç»“å™¨åœ¨mod2èµ„æºè¢«è®¾ç½®ä¹‹å‰è¢«æ‰§è¡Œã€‚</p><p>ç‰¹åˆ«è¦æ³¨æ„çš„æ˜¯ï¼Œtest_0æ˜¯å®Œå…¨ç‹¬ç«‹çš„ï¼Œå¹¶ä¸”é¦–å…ˆå®Œæˆã€‚ç„¶åç”¨mod1æ‰§è¡Œtest_1ï¼Œç„¶åç”¨mod1æ‰§è¡Œtest_2ï¼Œç„¶åç”¨mod2æ‰§è¡Œtest_1ï¼Œæœ€åç”¨mod2æ‰§è¡Œtest_2ã€‚</p><p>å…¶ä»–å‚æ•°åŒ–èµ„æº(å…·æœ‰åŠŸèƒ½èŒƒå›´)åœ¨æ¯æ¬¡ä½¿ç”¨å®ƒçš„æµ‹è¯•ä¹‹å‰è®¾ç½®å¹¶åœ¨æµ‹è¯•ä¹‹ååˆ é™¤ã€‚</p><h2 id="4-14-é€šè¿‡-usefixtures-åœ¨ç±»å’Œæ¨¡å—ä¸­ä½¿ç”¨fixturesè£…ç½®"><a href="#4-14-é€šè¿‡-usefixtures-åœ¨ç±»å’Œæ¨¡å—ä¸­ä½¿ç”¨fixturesè£…ç½®" class="headerlink" title="4.14 é€šè¿‡ usefixtures åœ¨ç±»å’Œæ¨¡å—ä¸­ä½¿ç”¨fixturesè£…ç½®"></a>4.14 é€šè¿‡ usefixtures åœ¨ç±»å’Œæ¨¡å—ä¸­ä½¿ç”¨fixturesè£…ç½®</h2><p>æœ‰æ—¶æµ‹è¯•å‡½æ•°ä¸ç›´æ¥éœ€è¦è®¿é—®fixtureå¯¹è±¡ã€‚</p><p>ä¾‹å¦‚ï¼Œæµ‹è¯•å¯èƒ½éœ€è¦ä½¿ç”¨ç©ºç›®å½•ä½œä¸ºå½“å‰å·¥ä½œç›®å½•ï¼Œä½†ä¸å…³å¿ƒå…·ä½“ç›®å½•ã€‚</p><p>ä¸‹é¢æ˜¯å¦‚ä½•ä½¿ç”¨æ ‡å‡†çš„tempfileå’Œpytest fixtureæ¥å®ç°å®ƒã€‚æˆ‘ä»¬å°†fixtureçš„åˆ›å»ºåˆ†ç¦»åˆ°ä¸€ä¸ªconftest.pyæ–‡ä»¶ä¸­:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># content of conftest.py</span><br><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> tempfile<br><br><span class="hljs-keyword">import</span> pytest<br><br><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">cleandir</span>():<br>    <span class="hljs-keyword">with</span> tempfile.TemporaryDirectory() <span class="hljs-keyword">as</span> newpath:<br>        old_cwd = os.getcwd()<br>        os.chdir(newpath)<br>        <span class="hljs-keyword">yield</span><br>        os.chdir(old_cwd)<br></code></pre></td></tr></table></figure><p>å¹¶é€šè¿‡ usefixtures æ ‡è®°åœ¨æµ‹è¯•æ¨¡å—ä¸­å£°æ˜å…¶ä½¿ç”¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># content of test_setenv.py</span><br><span class="hljs-keyword">import</span> os<br><br><span class="hljs-keyword">import</span> pytest<br><br><br><span class="hljs-meta">@pytest.mark.usefixtures(<span class="hljs-params"><span class="hljs-string">&quot;cleandir&quot;</span></span>) </span><span class="hljs-comment"># æ„æ€å°±æ˜¯å¯ä»¥ä¸ä¼ å…¥åˆ°testå‡½æ•°ä¸­ï¼Œç”¨usefixtureè£…é¥°å™¨æ¥ä½¿ç”¨ä½ çš„fixtureè£…ç½®ï¼Œå¦ä¸€ç§å†™æ³•è€Œå·²</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestDirectoryInit</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_cwd_starts_empty</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">assert</span> os.listdir(os.getcwd()) == []<br>        <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;myfile&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>) <span class="hljs-keyword">as</span> f:<br>            f.write(<span class="hljs-string">&quot;hello&quot;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_cwd_again_starts_empty</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">assert</span> os.listdir(os.getcwd()) == []<br></code></pre></td></tr></table></figure><p>ç”±äºä½¿ç”¨äº†usefixturesæ ‡è®°ï¼Œæ¯ä¸ªæµ‹è¯•æ–¹æ³•çš„æ‰§è¡Œéƒ½éœ€è¦cleandir fixtureï¼Œå°±åƒæ‚¨ä¸ºæ¯ä¸ªæµ‹è¯•æ–¹æ³•æŒ‡å®šäº†ä¸€ä¸ªâ€œcleandirâ€å‡½æ•°å‚æ•°ä¸€æ ·ã€‚è®©æˆ‘ä»¬è¿è¡Œå®ƒæ¥éªŒè¯æˆ‘ä»¬çš„å¤¹å…·æ˜¯å¦è¢«æ¿€æ´»å¹¶ä¸”æµ‹è¯•é€šè¿‡äº†:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">$ pytest -q<br>..                                                                   [<span class="hljs-number">100</span>%]<br><span class="hljs-number">2</span> passed <span class="hljs-keyword">in</span> <span class="hljs-number">0.12</span>s<br></code></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥åƒè¿™æ ·æŒ‡å®šå¤šä¸ªè£…ç½®ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@pytest.mark.usefixtures(<span class="hljs-params"><span class="hljs-string">&quot;cleandir&quot;</span>, <span class="hljs-string">&quot;anotherfixture&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test</span>(): ...<br></code></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥ä½¿ç”¨ <code>pytestmark </code>åœ¨æµ‹è¯•æ¨¡å—çº§åˆ«æŒ‡å®šå¤¹å…·çš„ä½¿ç”¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">pytestmark = pytest.mark.usefixtures(<span class="hljs-string">&quot;cleandir&quot;</span>)<br></code></pre></td></tr></table></figure><p>è¿˜å¯ä»¥å°†é¡¹ç›®ä¸­æ‰€æœ‰æµ‹è¯•æ‰€éœ€çš„è£…ç½®æ”¾å…¥ ini æ–‡ä»¶ä¸­ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-comment"># content of pytest.ini</span><br><span class="hljs-section">[pytest]</span><br><span class="hljs-attr">usefixtures</span> = cleandir<br></code></pre></td></tr></table></figure><p>Warning</p><p>è¯·æ³¨æ„ï¼Œè¯¥æ ‡è®°å¯¹å¤¹å…·åŠŸèƒ½æ²¡æœ‰å½±å“ã€‚ä¾‹å¦‚ï¼Œ<strong>è¿™ä¸ä¼šæŒ‰é¢„æœŸå·¥ä½œ</strong>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@pytest.mark.usefixtures(<span class="hljs-params"><span class="hljs-string">&quot;my_other_fixture&quot;</span></span>)</span><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">my_fixture_that_sadly_wont_use_my_other_fixture</span>(): ...<br></code></pre></td></tr></table></figure><p>This generates a deprecation warning, and will become an error in Pytest 8.</p><h2 id="4-15-è¦†ç›–å„ä¸ªçº§åˆ«çš„åŒåfixturesè£…ç½®"><a href="#4-15-è¦†ç›–å„ä¸ªçº§åˆ«çš„åŒåfixturesè£…ç½®" class="headerlink" title="4.15 è¦†ç›–å„ä¸ªçº§åˆ«çš„åŒåfixturesè£…ç½®"></a>4.15 è¦†ç›–å„ä¸ªçº§åˆ«çš„åŒåfixturesè£…ç½®</h2><p>åœ¨ç›¸å¯¹è¾ƒå¤§çš„æµ‹è¯•å¥—ä»¶ä¸­ï¼Œæ‚¨å¾ˆå¯èƒ½éœ€è¦ä½¿ç”¨æœ¬åœ°å®šä¹‰çš„fixtureè¦†ç›–å…¨å±€fixtureæˆ–æ ¹fixtureï¼Œä»¥ä¿æŒæµ‹è¯•ä»£ç çš„å¯è¯»æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚</p><h3 id="4-15-1-è¦†ç›–conftest-pyæ–‡ä»¶å†…å®šä¹‰çš„æ–‡ä»¶å¤¹ï¼ˆåŒ…ï¼‰çº§åˆ«çš„å›ºå®šè£…ç½®"><a href="#4-15-1-è¦†ç›–conftest-pyæ–‡ä»¶å†…å®šä¹‰çš„æ–‡ä»¶å¤¹ï¼ˆåŒ…ï¼‰çº§åˆ«çš„å›ºå®šè£…ç½®" class="headerlink" title="4.15.1 è¦†ç›–conftest.pyæ–‡ä»¶å†…å®šä¹‰çš„æ–‡ä»¶å¤¹ï¼ˆåŒ…ï¼‰çº§åˆ«çš„å›ºå®šè£…ç½®"></a>4.15.1 è¦†ç›–conftest.pyæ–‡ä»¶å†…å®šä¹‰çš„æ–‡ä»¶å¤¹ï¼ˆåŒ…ï¼‰çº§åˆ«çš„å›ºå®šè£…ç½®</h3><p>ç»“æ„å¦‚ä¸‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python">tests/<br>    __init__.py<br><br>    conftest.py<br>        <span class="hljs-comment"># content of tests/conftest.py</span><br>        <span class="hljs-keyword">import</span> pytest<br><br><span class="hljs-meta">        @pytest.fixture</span><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">username</span>(): <span class="hljs-comment"># è¿™ä¸ªusername çš„ä½œç”¨åŸŸï¼Œå¯ä»¥ä½œç”¨åœ¨testsæ•´ä¸ªç›®å½•ä¸‹</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;username&#x27;</span><br><br>    test_something.py<br>        <span class="hljs-comment"># content of tests/test_something.py</span><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_username</span>(<span class="hljs-params">username</span>):<br>            <span class="hljs-keyword">assert</span> username == <span class="hljs-string">&#x27;username&#x27;</span> <span class="hljs-comment"># æµ‹è¯•é€šè¿‡</span><br><br>    subfolder/<br>        __init__.py<br><br>        conftest.py<br>            <span class="hljs-comment"># content of tests/subfolder/conftest.py</span><br>            <span class="hljs-keyword">import</span> pytest<br><br><span class="hljs-meta">            @pytest.fixture</span><br>            <span class="hljs-keyword">def</span> <span class="hljs-title function_">username</span>(<span class="hljs-params">username</span>): <span class="hljs-comment"># åœ¨testçš„ä¸‹çº§ç›®å½•subfolderå†…åˆé‡æ–°å®šä¹‰äº†ä¸€ä¸ªconftest.pyæ–‡ä»¶ï¼Œåœ¨æ–‡ä»¶å†…ï¼Œåˆé‡æ–°å®šä¹‰äº†usernameçš„fixtureï¼Œå±äºé‡å†™äº†ï¼Œåœ¨test/subfolderç›®å½•å†…çš„æµ‹è¯•ç”¨ä¾‹ï¼Œéƒ½ä¼šä½¿ç”¨å¿ƒå¾—username</span><br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;overridden-&#x27;</span> + username<br><br>        test_something.py<br>            <span class="hljs-comment"># content of tests/subfolder/test_something.py</span><br>            <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_username</span>(<span class="hljs-params">username</span>):<br>                <span class="hljs-keyword">assert</span> username == <span class="hljs-string">&#x27;overridden-username&#x27;</span> <span class="hljs-comment"># å› ä¸ºæ˜¯é‡å†™åçš„ï¼Œæ‰€ä»¥æµ‹è¯•é€šè¿‡</span><br></code></pre></td></tr></table></figure><h3 id="4-15-2-è¦†ç›–conftest-pyæ–‡ä»¶å†…å®šä¹‰çš„æ¨¡å—ï¼ˆ-pyï¼‰çº§åˆ«çš„å›ºå®šè£…ç½®"><a href="#4-15-2-è¦†ç›–conftest-pyæ–‡ä»¶å†…å®šä¹‰çš„æ¨¡å—ï¼ˆ-pyï¼‰çº§åˆ«çš„å›ºå®šè£…ç½®" class="headerlink" title="4.15.2 è¦†ç›–conftest.pyæ–‡ä»¶å†…å®šä¹‰çš„æ¨¡å—ï¼ˆ.pyï¼‰çº§åˆ«çš„å›ºå®šè£…ç½®"></a>4.15.2 è¦†ç›–conftest.pyæ–‡ä»¶å†…å®šä¹‰çš„æ¨¡å—ï¼ˆ.pyï¼‰çº§åˆ«çš„å›ºå®šè£…ç½®</h3><p>ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python">tests/<br>    __init__.py<br><br>    conftest.py<br>        <span class="hljs-comment"># content of tests/conftest.py</span><br>        <span class="hljs-keyword">import</span> pytest<br><br><span class="hljs-meta">        @pytest.fixture</span><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">username</span>():<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;username&#x27;</span><br><br>    test_something.py<br>        <span class="hljs-comment"># content of tests/test_something.py</span><br>        <span class="hljs-keyword">import</span> pytest<br><br><span class="hljs-meta">        @pytest.fixture</span><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">username</span>(<span class="hljs-params">username</span>): <span class="hljs-comment"># æµ‹è¯•æ¨¡å—å†…åˆå•ç‹¬å®šä¹‰äº†ä¸€ä¸ªfixtureï¼Œä»¥å½“å‰æ¨¡å—å†…çš„ä¸ºä¸»</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;overridden-&#x27;</span> + username<br><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_username</span>(<span class="hljs-params">username</span>):<br>            <span class="hljs-keyword">assert</span> username == <span class="hljs-string">&#x27;overridden-username&#x27;</span> <span class="hljs-comment"># æµ‹è¯•é€šè¿‡</span><br><br>    test_something_else.py<br>        <span class="hljs-comment"># content of tests/test_something_else.py</span><br>        <span class="hljs-keyword">import</span> pytest<br><br><span class="hljs-meta">        @pytest.fixture</span><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">username</span>(<span class="hljs-params">username</span>): <span class="hljs-comment"># åŒçº§ç›®å½•å†…åˆä¸€ä¸ªæ¨¡å—å†…åˆé‡æ–°å®šä¹‰äº†ä¸€ä¸ªåŒåfixuteï¼Œä»¥è¿™ä¸ªä¸ºå‡†</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;overridden-else-&#x27;</span> + username<br><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_username</span>(<span class="hljs-params">username</span>):<br>            <span class="hljs-keyword">assert</span> username == <span class="hljs-string">&#x27;overridden-else-username&#x27;</span> <span class="hljs-comment"># æµ‹è¯•é€šè¿‡</span><br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œå¯ä»¥ä¸ºæŸäº›æµ‹è¯•æ¨¡å—è¦†ç›–å…·æœ‰ç›¸åŒåç§°çš„å¤¹å…·ã€‚</p><h3 id="4-15-3-é€šè¿‡å‚æ•°åŒ–å¤¹å…·è¦†ç›–conftest-pyå†…å®šä¹‰çš„fixtureå¤¹å…·"><a href="#4-15-3-é€šè¿‡å‚æ•°åŒ–å¤¹å…·è¦†ç›–conftest-pyå†…å®šä¹‰çš„fixtureå¤¹å…·" class="headerlink" title="4.15.3 é€šè¿‡å‚æ•°åŒ–å¤¹å…·è¦†ç›–conftest.pyå†…å®šä¹‰çš„fixtureå¤¹å…·"></a>4.15.3 é€šè¿‡å‚æ•°åŒ–å¤¹å…·è¦†ç›–conftest.pyå†…å®šä¹‰çš„fixtureå¤¹å…·</h3><p>ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python">tests/<br>    __init__.py<br><br>    conftest.py<br>        <span class="hljs-comment"># content of tests/conftest.py</span><br>        <span class="hljs-keyword">import</span> pytest<br><br><span class="hljs-meta">        @pytest.fixture</span><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">username</span>():<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;username&#x27;</span><br><br><span class="hljs-meta">        @pytest.fixture</span><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">other_username</span>(<span class="hljs-params">username</span>):<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;other-&#x27;</span> + username<br><br>    test_something.py<br>        <span class="hljs-comment"># content of tests/test_something.py</span><br>        <span class="hljs-keyword">import</span> pytest<br><br><span class="hljs-meta">        @pytest.mark.parametrize(<span class="hljs-params"><span class="hljs-string">&#x27;username&#x27;</span>, [<span class="hljs-string">&#x27;directly-overridden-username&#x27;</span>]</span>) </span><span class="hljs-comment"># å‚æ•°åŒ–</span><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_username</span>(<span class="hljs-params">username</span>):<br>            <span class="hljs-keyword">assert</span> username == <span class="hljs-string">&#x27;directly-overridden-username&#x27;</span><br><br><span class="hljs-meta">        @pytest.mark.parametrize(<span class="hljs-params"><span class="hljs-string">&#x27;username&#x27;</span>, [<span class="hljs-string">&#x27;directly-overridden-username-other&#x27;</span>]</span>)</span><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_username_other</span>(<span class="hljs-params">other_username</span>):<br>            <span class="hljs-keyword">assert</span> other_username == <span class="hljs-string">&#x27;other-directly-overridden-username-other&#x27;</span><br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œå¤¹å…·å€¼è¢«æµ‹è¯•å‚æ•°å€¼è¦†ç›–ã€‚è¯·æ³¨æ„ï¼Œå³ä½¿æµ‹è¯•ä¸ç›´æ¥ä½¿ç”¨å¤¹å…·çš„å€¼ï¼ˆåœ¨å‡½æ•°åŸå‹ä¸­æœªæåŠï¼‰ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼è¦†ç›–å®ƒã€‚</p><h3 id="4-15-4-åä¹‹äº¦ç„¶ï¼Œç”¨éå‚æ•°åŒ–å¤¹å…·è¦†ç›–å‚æ•°åŒ–å¤¹å…·"><a href="#4-15-4-åä¹‹äº¦ç„¶ï¼Œç”¨éå‚æ•°åŒ–å¤¹å…·è¦†ç›–å‚æ•°åŒ–å¤¹å…·" class="headerlink" title="4.15.4 åä¹‹äº¦ç„¶ï¼Œç”¨éå‚æ•°åŒ–å¤¹å…·è¦†ç›–å‚æ•°åŒ–å¤¹å…·"></a>4.15.4 åä¹‹äº¦ç„¶ï¼Œç”¨éå‚æ•°åŒ–å¤¹å…·è¦†ç›–å‚æ•°åŒ–å¤¹å…·</h3><p>Given the tests file structure is:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs python">tests/<br>    __init__.py<br><br>    conftest.py<br>        <span class="hljs-comment"># content of tests/conftest.py</span><br>        <span class="hljs-keyword">import</span> pytest<br><br><span class="hljs-meta">        @pytest.fixture(<span class="hljs-params">params=[<span class="hljs-string">&#x27;one&#x27;</span>, <span class="hljs-string">&#x27;two&#x27;</span>, <span class="hljs-string">&#x27;three&#x27;</span>]</span>) </span><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">parametrized_username</span>(<span class="hljs-params">request</span>): <span class="hljs-comment"># å‚æ•°åŒ–å¤¹å…·</span><br>            <span class="hljs-keyword">return</span> request.param<br><br><span class="hljs-meta">        @pytest.fixture</span><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">non_parametrized_username</span>(<span class="hljs-params">request</span>): <span class="hljs-comment"># éå‚æ•°åŒ–å¤¹å…·</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;username&#x27;</span><br><br>    test_something.py<br>        <span class="hljs-comment"># content of tests/test_something.py</span><br>        <span class="hljs-keyword">import</span> pytest<br><br><span class="hljs-meta">        @pytest.fixture</span><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">parametrized_username</span>(): <span class="hljs-comment"># éå‚æ•°åŒ–å¤¹å…·ï¼Œè¦†ç›–äº†conftest.pyé‡Œçš„å‚æ•°åŒ–å¤¹å…·</span><br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;overridden-username&#x27;</span><br><br><span class="hljs-meta">        @pytest.fixture(<span class="hljs-params">params=[<span class="hljs-string">&#x27;one&#x27;</span>, <span class="hljs-string">&#x27;two&#x27;</span>, <span class="hljs-string">&#x27;three&#x27;</span>]</span>)</span><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">non_parametrized_username</span>(<span class="hljs-params">request</span>): <span class="hljs-comment"># å‚æ•°åŒ–å¤¹å…·è¦†ç›–äº†conftest.pyé‡Œçš„éå‚æ•°åŒ–å¤¹å…·</span><br>            <span class="hljs-keyword">return</span> request.param<br><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_username</span>(<span class="hljs-params">parametrized_username</span>):<br>            <span class="hljs-keyword">assert</span> parametrized_username == <span class="hljs-string">&#x27;overridden-username&#x27;</span><br><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_parametrized_username</span>(<span class="hljs-params">non_parametrized_username</span>):<br>            <span class="hljs-keyword">assert</span> non_parametrized_username <span class="hljs-keyword">in</span> [<span class="hljs-string">&#x27;one&#x27;</span>, <span class="hljs-string">&#x27;two&#x27;</span>, <span class="hljs-string">&#x27;three&#x27;</span>]<br><br>    test_something_else.py<br>        <span class="hljs-comment"># content of tests/test_something_else.py</span><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_username</span>(<span class="hljs-params">parametrized_username</span>):<br>            <span class="hljs-keyword">assert</span> parametrized_username <span class="hljs-keyword">in</span> [<span class="hljs-string">&#x27;one&#x27;</span>, <span class="hljs-string">&#x27;two&#x27;</span>, <span class="hljs-string">&#x27;three&#x27;</span>]<br><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_username</span>(<span class="hljs-params">non_parametrized_username</span>):<br>            <span class="hljs-keyword">assert</span> non_parametrized_username == <span class="hljs-string">&#x27;username&#x27;</span><br></code></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä¸€ä¸ªå‚æ•°åŒ–çš„å¤¹å…·è¢«ä¸€ä¸ªéå‚æ•°åŒ–çš„ç‰ˆæœ¬è¦†ç›–ï¼Œè€Œä¸€ä¸ªéå‚æ•°åŒ–çš„å¤¹å…·è¢«ä¸€ä¸ªç‰¹å®šæµ‹è¯•æ¨¡å—çš„å‚æ•°åŒ–çš„ç‰ˆæœ¬è¦†ç›–ã€‚è¿™åŒæ ·é€‚ç”¨äºæµ‹è¯•æ–‡ä»¶å¤¹çº§åˆ«ã€‚</p><h2 id="4-16-ä½¿ç”¨å…¶ä»–é¡¹ç›®çš„fixtureã€ä¸å»ºè®®ã€‘"><a href="#4-16-ä½¿ç”¨å…¶ä»–é¡¹ç›®çš„fixtureã€ä¸å»ºè®®ã€‘" class="headerlink" title="4.16 ä½¿ç”¨å…¶ä»–é¡¹ç›®çš„fixtureã€ä¸å»ºè®®ã€‘"></a>4.16 ä½¿ç”¨å…¶ä»–é¡¹ç›®çš„fixtureã€ä¸å»ºè®®ã€‘</h2><p>é€šå¸¸ï¼Œæä¾›pytestæ”¯æŒçš„é¡¹ç›®å°†ä½¿ç”¨å…¥å£ç‚¹ï¼Œå› æ­¤åªéœ€å°†è¿™äº›é¡¹ç›®å®‰è£…åˆ°ç¯å¢ƒä¸­ï¼Œå°±å¯ä»¥ä½¿ç”¨è¿™äº›fixtureã€‚</p><p>å¦‚æœæ‚¨æƒ³ä½¿ç”¨ä¸ä½¿ç”¨å…¥å£ç‚¹çš„é¡¹ç›®ä¸­çš„fixtureï¼Œæ‚¨å¯ä»¥åœ¨é¡¶éƒ¨conftest.pyæ–‡ä»¶ä¸­å®šä¹‰pytest_pluginsï¼Œä»¥å°†è¯¥æ¨¡å—æ³¨å†Œä¸ºæ’ä»¶ã€‚</p><p>å‡è®¾åœ¨mylibraryä¸­æœ‰ä¸€äº›fixtureã€‚ä½ æƒ³åœ¨app&#x2F;testsç›®å½•ä¸­é‡ç”¨å®ƒä»¬ã€‚</p><p>ä½ æ‰€éœ€è¦åšçš„å°±æ˜¯åœ¨app&#x2F;tests&#x2F;conftest.pyä¸­å®šä¹‰pytest_pluginsï¼Œå¹¶æŒ‡å‘è¯¥æ¨¡å—ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">pytest_plugins = <span class="hljs-string">&quot;mylibrary.fixtures&quot;</span><br></code></pre></td></tr></table></figure><p>è¿™æœ‰æ•ˆåœ°æ³¨å†Œäº†mylibraryã€‚fixtureä½œä¸ºä¸€ä¸ªæ’ä»¶ï¼Œä½¿å…¶æ‰€æœ‰fixtureå’Œé’©å­å¯ç”¨äºapp&#x2F;testsä¸­çš„æµ‹è¯•ã€‚</p><p>è¯·æ³¨æ„<br>æœ‰æ—¶ç”¨æˆ·ä¼šä»å…¶ä»–é¡¹ç›®å¯¼å…¥fixtureä»¥ä¾›ä½¿ç”¨ï¼Œä½†ä¸å»ºè®®è¿™æ ·åš:å°†fixtureå¯¼å…¥åˆ°æ¨¡å—ä¸­ä¼šå°†å®ƒä»¬æ³¨å†Œåˆ°pytestä¸­ï¼Œå°±åƒè¯¥æ¨¡å—ä¸­å®šä¹‰çš„é‚£æ ·ã€‚</p><p>è¿™æœ‰è½»å¾®çš„åæœï¼Œæ¯”å¦‚åœ¨pytestâ€”â€”helpä¸­å‡ºç°å¤šæ¬¡ï¼Œä½†ä¸å»ºè®®è¿™æ ·åšï¼Œå› ä¸ºè¿™ç§è¡Œä¸ºå¯èƒ½ä¼šåœ¨æœªæ¥çš„ç‰ˆæœ¬ä¸­æ”¹å˜&#x2F;åœæ­¢å·¥ä½œã€‚</p><p><img src="/../img/bing_2022_OHR.CelebratingSurfing.jpg" alt="img"></p>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç¬”è®°</tag>
      
      <tag>pytest</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€pythonã€‘ä¹‹pyteståœ¨æµ‹è¯•ä¸­ç¼–å†™å’ŒæŠ¥å‘Šæ–­è¨€(ä¸‰)</title>
    <link href="/2024/01/22/663python%E4%B9%8Bpytest%E5%9C%A8%E6%B5%8B%E8%AF%95%E4%B8%AD%E7%BC%96%E5%86%99%E5%92%8C%E6%8A%A5%E5%91%8A%E6%96%AD%E8%A8%80-%E4%B8%89/"/>
    <url>/2024/01/22/663python%E4%B9%8Bpytest%E5%9C%A8%E6%B5%8B%E8%AF%95%E4%B8%AD%E7%BC%96%E5%86%99%E5%92%8C%E6%8A%A5%E5%91%8A%E6%96%AD%E8%A8%80-%E4%B8%89/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸‰-å¦‚ä½•åœ¨æµ‹è¯•ä¸­ç¼–å†™å’ŒæŠ¥å‘Šæ–­è¨€"><a href="#ä¸‰-å¦‚ä½•åœ¨æµ‹è¯•ä¸­ç¼–å†™å’ŒæŠ¥å‘Šæ–­è¨€" class="headerlink" title="ä¸‰ å¦‚ä½•åœ¨æµ‹è¯•ä¸­ç¼–å†™å’ŒæŠ¥å‘Šæ–­è¨€"></a>ä¸‰ å¦‚ä½•åœ¨æµ‹è¯•ä¸­ç¼–å†™å’ŒæŠ¥å‘Šæ–­è¨€</h1><h2 id="3-1-ä½¿ç”¨-assert-è¯­å¥æ–­è¨€"><a href="#3-1-ä½¿ç”¨-assert-è¯­å¥æ–­è¨€" class="headerlink" title="3.1 ä½¿ç”¨ assert è¯­å¥æ–­è¨€"></a>3.1 ä½¿ç”¨ <code>assert</code> è¯­å¥æ–­è¨€</h2><p>pytest å…è®¸ä½¿ç”¨æ ‡å‡† Python æ–­è¨€æ¥éªŒè¯ Python æµ‹è¯•ä¸­çš„æœŸæœ›å’Œå€¼ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ç¼–å†™ä»¥ä¸‹å†…å®¹ï¼š</p><blockquote><p>assert æ˜¯Pythonä¸­çš„å…³é”®å­—ï¼Œassert åé¢è·Ÿçš„å¦‚æœä¸ºTure å°±é€šè¿‡ï¼Œä¸ºFalse</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># content of test_assert1.py</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">f</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">3</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_function</span>():<br>    <span class="hljs-keyword">assert</span> f() == <span class="hljs-number">4</span><br></code></pre></td></tr></table></figure><p>æ–­è¨€å‡½æ•°è¿”å›æŸä¸ªå€¼ã€‚å¦‚æœæ­¤æ–­è¨€å¤±è´¥ï¼Œå°†çœ‹åˆ°å‡½æ•°è°ƒç”¨çš„è¿”å›å€¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python">$ pytest test_assert1.py<br>=========================== test session starts ============================<br>platform linux -- Python <span class="hljs-number">3.</span>x.y, pytest-<span class="hljs-number">8.</span>x.y, pluggy-<span class="hljs-number">1.</span>x.y<br>rootdir: /home/sweet/project<br>collected <span class="hljs-number">1</span> item<br><br>test_assert1.py F     <span class="hljs-comment"># Få°±æ˜¯å¤±è´¥                                                [100%]</span><br><br>================================= FAILURES =================================<br>______________________________ test_function _______________________________<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_function</span>():<br>&gt;       <span class="hljs-keyword">assert</span> f() == <span class="hljs-number">4</span><br>E       <span class="hljs-keyword">assert</span> <span class="hljs-number">3</span> == <span class="hljs-number">4</span><br>E        +  where <span class="hljs-number">3</span> = f()<br><br>test_assert1.py:<span class="hljs-number">6</span>: AssertionError<br>========================= short test summary info ==========================<br>FAILED test_assert1.py::test_function - <span class="hljs-keyword">assert</span> <span class="hljs-number">3</span> == <span class="hljs-number">4</span><br>============================ <span class="hljs-number">1</span> failed <span class="hljs-keyword">in</span> <span class="hljs-number">0.12</span>s =============================<br></code></pre></td></tr></table></figure><p>Pytestæ”¯æŒæ˜¾ç¤ºæœ€å¸¸è§çš„å­è¡¨è¾¾å¼çš„å€¼ï¼ŒåŒ…æ‹¬è°ƒç”¨ã€å±æ€§ã€æ¯”è¾ƒã€äºŒè¿›åˆ¶å’Œä¸€å…ƒæ“ä½œç¬¦ã€‚</p><p>å¦‚æœä½¿ç”¨å¦‚ä¸‹æ–­è¨€æŒ‡å®šæ¶ˆæ¯ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">assert</span> a % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>, <span class="hljs-string">&quot;value was odd, should be even&quot;</span><br></code></pre></td></tr></table></figure><p>å®ƒå°†ä¼šä¸å›æº¯ä¸­çš„æ–­è¨€æ£€æŸ¥ä¸€èµ·æ‰“å°ã€‚</p><p>ç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_study</span>(<span class="hljs-params">self</span>):<br>    a = <span class="hljs-number">1</span>+<span class="hljs-number">1</span><br>    <span class="hljs-keyword">assert</span>  a == <span class="hljs-number">0</span>, <span class="hljs-string">&quot;å¦‚æœæ–­è¨€å¤±è´¥ï¼Œå°±ä¼šåœ¨AssertionErrorä¸­æ‰“å°è¿™å¥è¯ï¼Œå¦‚æœæˆåŠŸå°±ä¸ä¼šæ‰“å°&quot;</span><br></code></pre></td></tr></table></figure><h2 id="3-2-å…³äºé¢„æœŸå¼‚å¸¸çš„æ–­è¨€"><a href="#3-2-å…³äºé¢„æœŸå¼‚å¸¸çš„æ–­è¨€" class="headerlink" title="3.2 å…³äºé¢„æœŸå¼‚å¸¸çš„æ–­è¨€"></a>3.2 å…³äºé¢„æœŸå¼‚å¸¸çš„æ–­è¨€</h2><p>ä¸ºäº†ç¼–å†™å…³äºå¼•å‘çš„å¼‚å¸¸çš„æ–­è¨€ï¼Œä½ å¯ä»¥ä½¿ç”¨ <a href="https://docs.pytest.org/en/8.0.x/reference/reference.html#pytest.raises"><code>pytest.raises()</code></a>å¦‚ä¸‹ä¸Šä¸‹æ–‡ç®¡ç†å™¨</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">import</span> pytest<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_zero_division</span>():<br>    <span class="hljs-keyword">with</span> pytest.raises(ZeroDivisionError): <span class="hljs-comment"># pytest.raises æ–­è¨€è§£é‡Šå™¨æŠ¥é”™</span><br>        <span class="hljs-number">1</span> / <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>å¦‚æœæ‚¨éœ€è¦è®¿é—®å®é™…çš„å¼‚å¸¸ä¿¡æ¯ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_recursion_depth</span>():<br>    <span class="hljs-keyword">with</span> pytest.raises(RuntimeError) <span class="hljs-keyword">as</span> excinfo:<br><br>        <span class="hljs-keyword">def</span> <span class="hljs-title function_">f</span>():<br>            f()<br><br>        f()<br>    <span class="hljs-keyword">assert</span> <span class="hljs-string">&quot;maximum recursion&quot;</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">str</span>(excinfo.value)<br>excinfo`æ˜¯ä¸€ä¸ª[`ExceptionInfo`](https://docs.pytest.org/en/<span class="hljs-number">8.0</span>.x/reference/reference.html<span class="hljs-comment">#pytest.ExceptionInfo)å®ä¾‹ï¼Œå®ƒæ˜¯å®é™…å¼•å‘çš„å¼‚å¸¸çš„åŒ…è£…å™¨ã€‚ä¸»è¦æ„Ÿå…´è¶£çš„å±æ€§ æ˜¯`.type`å’Œã€‚`.value``.traceback</span><br></code></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œ<code>pytest.raises</code>å°†åŒ¹é…å¼‚å¸¸ç±»å‹æˆ–ä»»ä½•å­ç±»ï¼ˆå¦‚æ ‡å‡†<code>except</code>è¯­å¥ï¼‰ã€‚å¦‚æœæ‚¨æƒ³æ£€æŸ¥ä»£ç å—æ˜¯å¦å¼•å‘ç¡®åˆ‡çš„å¼‚å¸¸ç±»å‹ï¼Œåˆ™éœ€è¦æ˜ç¡®æ£€æŸ¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_foo_not_implemented</span>():<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">foo</span>():<br>        <span class="hljs-keyword">raise</span> NotImplementedError<br><br>    <span class="hljs-keyword">with</span> pytest.raises(RuntimeError) <span class="hljs-keyword">as</span> excinfo:<br>        foo()<br>    <span class="hljs-keyword">assert</span> excinfo.<span class="hljs-built_in">type</span> <span class="hljs-keyword">is</span> RuntimeError <span class="hljs-comment"># è¿™æ˜¯å®˜æ–¹æ–‡æ¡£çš„ï¼Œæ˜¯é”™çš„ï¼Œå› ä¸ºNotImplementedErroræ˜¯RuntimeErrorçš„å­ç±» æ‰€ä»¥ä¸æ˜¯is è€Œæ˜¯æ¢æˆissubclass</span><br>    <span class="hljs-keyword">assert</span> <span class="hljs-built_in">issubclass</span>(excinfo.<span class="hljs-built_in">type</span>, RuntimeError) <span class="hljs-comment"># è¿™é‡Œæ‰€æ‰§è¡Œçš„foo()æŠ›å‡ºçš„é”™è¯¯æ˜¯NotImplementedError æ‰€ä»¥æ–­è¨€é€šè¿‡äº†</span><br>    <br><span class="hljs-comment"># å¦å†™ä¸€ä¸ªä¾‹å­</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">foo</span>():<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>/<span class="hljs-number">0</span> <span class="hljs-comment"># è¿è¡Œfoo()ä¼šæŠ›å‡ºä¸€ä¸ªZeroDivisionError 0ä¸ºé™¤æ•°å¼‚å¸¸</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_arithmetic_error</span>():<br>    <span class="hljs-keyword">with</span> pytest.raises(Exception) <span class="hljs-keyword">as</span> excinfo: <span class="hljs-comment"># pytest.raises()å¯ä»¥ä¼ Exceptionï¼ŒExceptionæ˜¯æ‰€æœ‰é”™è¯¯çš„åŸºç±»ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥ä¼ ArithmeticError </span><br>        foo()<br>    <span class="hljs-keyword">assert</span> <span class="hljs-built_in">issubclass</span>(excinfo.<span class="hljs-built_in">type</span>, ArithmeticError)<br></code></pre></td></tr></table></figure><p>å³ä½¿å‡½æ•°å¼•å‘ NotImplementedErrorï¼Œpytest.raises() è°ƒç”¨ä¹Ÿä¼šæˆåŠŸï¼Œå› ä¸º <code>NotImplementedError</code> æ˜¯ <code>RuntimeError</code> çš„å­ç±»ï¼›ä½†æ˜¯ä¸‹é¢çš„æ–­è¨€è¯­å¥å°†æ•è·è¯¥é—®é¢˜ã€‚</p><h3 id="3-2-1-åŒ¹é…å¼‚å¸¸æ¶ˆæ¯"><a href="#3-2-1-åŒ¹é…å¼‚å¸¸æ¶ˆæ¯" class="headerlink" title="3.2.1 åŒ¹é…å¼‚å¸¸æ¶ˆæ¯"></a>3.2.1 åŒ¹é…å¼‚å¸¸æ¶ˆæ¯</h3><p>å¯ä»¥å°† match å…³é”®å­—å‚æ•°ä¼ é€’ç»™ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œä»¥æµ‹è¯•æ­£åˆ™è¡¨è¾¾å¼æ˜¯å¦ä¸å¼‚å¸¸çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼åŒ¹é…ï¼ˆç±»ä¼¼äº unittest ä¸­çš„ TestCase.assertRaisesRegex æ–¹æ³•ï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pytest<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">myfunc</span>():<br>    <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&quot;Exception 123 raised&quot;</span>)<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_match</span>():<br>    <span class="hljs-keyword">with</span> pytest.raises(ValueError, <span class="hljs-keyword">match</span>=<span class="hljs-string">r&quot;.* 123 .*&quot;</span>):<br>        myfunc()<br></code></pre></td></tr></table></figure><p>ç¬”è®°:</p><ul><li>match å‚æ•°ä¸ <code>re.search() </code>å‡½æ•°åŒ¹é…ï¼Œå› æ­¤åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ <code>match=&#39;123&#39; </code>ä¹Ÿå¯ä»¥å·¥ä½œ</li><li>åŒ¹é…å‚æ•°è¿˜ä¸ PEP-678 <code>__notes__ </code>åŒ¹é…ã€‚</li></ul><h3 id="3-2-2-åŒ¹é…ä¾‹å¤–ç»„exception-groups"><a href="#3-2-2-åŒ¹é…ä¾‹å¤–ç»„exception-groups" class="headerlink" title="3.2.2 åŒ¹é…ä¾‹å¤–ç»„exception groups"></a>3.2.2 åŒ¹é…ä¾‹å¤–ç»„exception groups</h3><p>æ‚¨è¿˜å¯ä»¥ä½¿ç”¨<code>excinfo.group_contains()</code>æ–¹æ³•æ¥æµ‹è¯•ä½œä¸º <code>ExceptionGroup</code> çš„ä¸€éƒ¨åˆ†è¿”å›çš„å¼‚å¸¸</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_exception_in_group</span>():<br>    <span class="hljs-keyword">with</span> pytest.raises(ExceptionGroup) <span class="hljs-keyword">as</span> excinfo:<br>        <span class="hljs-keyword">raise</span> ExceptionGroup(<br>            <span class="hljs-string">&quot;Group message&quot;</span>,<br>            [<br>                RuntimeError(<span class="hljs-string">&quot;Exception 123 raised&quot;</span>),<br>            ],<br>        )<br>    <span class="hljs-keyword">assert</span> excinfo.group_contains(RuntimeError, <span class="hljs-keyword">match</span>=<span class="hljs-string">r&quot;.* 123 .*&quot;</span>)<br>    <span class="hljs-keyword">assert</span> <span class="hljs-keyword">not</span> excinfo.group_contains(TypeError)<br></code></pre></td></tr></table></figure><p>å¯é€‰çš„ match å…³é”®å­—å‚æ•°çš„å·¥ä½œæ–¹å¼ä¸ pytest.raises() ç›¸åŒã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œgroup_contains()å°†åœ¨åµŒå¥—çš„ExceptionGroupå®ä¾‹çš„ä»»ä½•çº§åˆ«ä¸Šé€’å½’åœ°æœç´¢åŒ¹é…çš„å¼‚å¸¸ã€‚å¦‚æœæ‚¨åªæƒ³åœ¨ç‰¹å®šçº§åˆ«åŒ¹é…å¼‚å¸¸ï¼Œåˆ™å¯ä»¥æŒ‡å®šdepthå…³é”®å­—å‚æ•°;ç›´æ¥åŒ…å«åœ¨top ExceptionGroupä¸­çš„å¼‚å¸¸å°†åŒ¹é…depth&#x3D;1ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_exception_in_group_at_given_depth</span>():<br>    <span class="hljs-keyword">with</span> pytest.raises(ExceptionGroup) <span class="hljs-keyword">as</span> excinfo:<br>        <span class="hljs-keyword">raise</span> ExceptionGroup(<br>            <span class="hljs-string">&quot;Group message&quot;</span>,<br>            [<br>                RuntimeError(),<br>                ExceptionGroup(<br>                    <span class="hljs-string">&quot;Nested group&quot;</span>,<br>                    [<br>                        TypeError(),<br>                    ],<br>                ),<br>            ],<br>        )<br>    <span class="hljs-keyword">assert</span> excinfo.group_contains(RuntimeError, depth=<span class="hljs-number">1</span>)<br>    <span class="hljs-keyword">assert</span> excinfo.group_contains(TypeError, depth=<span class="hljs-number">2</span>)<br>    <span class="hljs-keyword">assert</span> <span class="hljs-keyword">not</span> excinfo.group_contains(RuntimeError, depth=<span class="hljs-number">2</span>)<br>    <span class="hljs-keyword">assert</span> <span class="hljs-keyword">not</span> excinfo.group_contains(TypeError, depth=<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure><h3 id="3-2-3-xfail-mark-å’Œ-pytest-raises"><a href="#3-2-3-xfail-mark-å’Œ-pytest-raises" class="headerlink" title="3.2.3 xfail mark å’Œ pytest.raises"></a>3.2.3 xfail mark å’Œ pytest.raises</h3><p>ä¹Ÿå¯ä»¥ä¸ºpytest.markæŒ‡å®šä¸€ä¸ªraiseå‚æ•°ã€‚Xfailå®ƒä»¥ä¸€ç§æ›´å…·ä½“çš„æ–¹å¼æ£€æŸ¥æµ‹è¯•æ˜¯å¦å¤±è´¥ï¼Œè€Œä¸ä»…ä»…æ˜¯å¼•å‘ä»»ä½•å¼‚å¸¸:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">f</span>():<br>    <span class="hljs-keyword">raise</span> IndexError()<br><br><br><span class="hljs-meta">@pytest.mark.xfail(<span class="hljs-params">raises=IndexError</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_f</span>():<br>    f()<br><br>testcases/test_case.py x                                                 [<span class="hljs-number">100</span>%]<br><br>============================== <span class="hljs-number">1</span> xfailed <span class="hljs-keyword">in</span> <span class="hljs-number">0.01</span>s ==============================<br></code></pre></td></tr></table></figure><p>å¦‚æœæµ‹è¯•å› å¼•å‘<code>IndexError</code>æˆ–å­ç±»è€Œå¤±è´¥ï¼Œä¹Ÿä¼šâ€œxfailâ€ã€‚</p><ul><li>ä½¿ç”¨å¸¦æœ‰å‚æ•°çš„pytest.mark.xfail <code>raises</code>æ›´é€‚åˆè®°å½•æœªä¿®å¤çš„bugï¼ˆå…¶ä¸­å¯ä»¥æè¿°â€œåº”è¯¥â€å‘ç”Ÿä»€ä¹ˆï¼‰æˆ–è€…ä¾èµ–é¡¹ä¸­çš„é”™è¯¯</li><li>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæµ‹è¯•ä½ è‡ªå·±æ•…æ„å¼•å‘çš„å¼‚å¸¸é”™è¯¯çš„ä»£ç çš„æƒ…å†µï¼Œæ›´é€‚åˆä½¿ç”¨<code>pytest.raises()</code>å¯èƒ½ä¼šæ›´å¥½ä¸€ç‚¹ï¼Œ</li></ul><h2 id="3-3-åˆ©ç”¨ä¸Šä¸‹æ–‡ç›¸å…³çš„æ¯”è¾ƒ"><a href="#3-3-åˆ©ç”¨ä¸Šä¸‹æ–‡ç›¸å…³çš„æ¯”è¾ƒ" class="headerlink" title="3.3 åˆ©ç”¨ä¸Šä¸‹æ–‡ç›¸å…³çš„æ¯”è¾ƒ"></a>3.3 åˆ©ç”¨ä¸Šä¸‹æ–‡ç›¸å…³çš„æ¯”è¾ƒ</h2><p>pytest å¯¹åœ¨é‡åˆ°æ¯”è¾ƒæ—¶æä¾›ä¸Šä¸‹æ–‡ç›¸å…³ä¿¡æ¯æœ‰ä¸°å¯Œçš„æ”¯æŒã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># content of test_assert2.py</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_set_comparison</span>():<br>    set1 = <span class="hljs-built_in">set</span>(<span class="hljs-string">&quot;1308&quot;</span>)<br>    set2 = <span class="hljs-built_in">set</span>(<span class="hljs-string">&quot;8035&quot;</span>)<br>    <span class="hljs-keyword">assert</span> set1 == set2<br><br></code></pre></td></tr></table></figure><p>è¿è¡ŒåæŠ¥é”™ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python">================================= FAILURES =================================<br>___________________________ test_set_comparison ____________________________<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_set_comparison</span>():<br>        set1 = <span class="hljs-built_in">set</span>(<span class="hljs-string">&quot;1308&quot;</span>)<br>        set2 = <span class="hljs-built_in">set</span>(<span class="hljs-string">&quot;8035&quot;</span>)<br>&gt;       <span class="hljs-keyword">assert</span> set1 == set2<br>E       AssertionError: <span class="hljs-keyword">assert</span> &#123;<span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>, <span class="hljs-string">&#x27;8&#x27;</span>&#125; == &#123;<span class="hljs-string">&#x27;0&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>, <span class="hljs-string">&#x27;5&#x27;</span>, <span class="hljs-string">&#x27;8&#x27;</span>&#125;<br>E<br>E         Extra items <span class="hljs-keyword">in</span> the left <span class="hljs-built_in">set</span>:<br>E         <span class="hljs-string">&#x27;1&#x27;</span><br>E         Extra items <span class="hljs-keyword">in</span> the right <span class="hljs-built_in">set</span>:<br>E         <span class="hljs-string">&#x27;5&#x27;</span><br>E         Use -v to get more diff<br><br>test_assert2.py:<span class="hljs-number">4</span>: AssertionError<br>========================= short test summary info ==========================<br>FAILED test_assert2.py::test_set_comparison - AssertionError: <span class="hljs-keyword">assert</span> &#123;<span class="hljs-string">&#x27;0&#x27;</span>...<br>============================ <span class="hljs-number">1</span> failed <span class="hljs-keyword">in</span> <span class="hljs-number">0.12</span>s =============================<br></code></pre></td></tr></table></figure><p>é’ˆå¯¹ä¸€äº›åœºæ™¯è¿›è¡Œäº†ä¸“é—¨çš„æ¯”è¾ƒï¼š</p><ul><li>æ¯”è¾ƒé•¿å­—ç¬¦ä¸²ï¼šæ˜¾ç¤ºä¸Šä¸‹æ–‡å·®å¼‚</li><li>æ¯”è¾ƒé•¿åºåˆ—ï¼šç¬¬ä¸€ä¸ªå¤±è´¥çš„ç´¢å¼•</li><li>æ¯”è¾ƒå­—å…¸ï¼šä¸åŒçš„æ¡ç›®</li></ul><p>æœ‰å…³æ›´å¤šç¤ºä¾‹ï¼Œè¯·å‚é˜…æŠ¥å‘Šæ¼”ç¤º <a href="https://docs.pytest.org/en/8.0.x/example/reportingdemo.html#tbreportdemo">reporting demo</a> </p><h2 id="3-4-ä¸ºå¤±è´¥çš„æ–­è¨€å®šä¹‰è‡ªå·±çš„è§£é‡Š"><a href="#3-4-ä¸ºå¤±è´¥çš„æ–­è¨€å®šä¹‰è‡ªå·±çš„è§£é‡Š" class="headerlink" title="3.4 ä¸ºå¤±è´¥çš„æ–­è¨€å®šä¹‰è‡ªå·±çš„è§£é‡Š"></a>3.4 ä¸ºå¤±è´¥çš„æ–­è¨€å®šä¹‰è‡ªå·±çš„è§£é‡Š</h2><p>å¯ä»¥é€šè¿‡å®ç° pytest_assertrepr_compare é’©å­æ¥æ·»åŠ æ‚¨è‡ªå·±çš„è¯¦ç»†è§£é‡Šã€‚â€”&gt;ä¼šåœ¨â€œå¦‚ä½•ç¼–å†™é’©å­å‡½æ•°â€é‡Œè®²</p><p><strong>pytest_assertrepr_compare</strong>(<em>config</em>, <em>op</em>, <em>left</em>, <em>right</em>)</p><p><strong>pytest_assertrepr_compare</strong>(<em>config</em>, <em>op</em>, <em>left</em>, <em>right</em>)[<a href="https://docs.pytest.org/en/8.0.x/_modules/_pytest/hookspec.html#pytest_assertrepr_compare">source]</a></p><p>   Return explanation for comparisons in failing assert expressions.</p><p>   Return None for no custom explanation, otherwise return a list of strings. The strings will be joined by    newlines but any newlines <em>in</em> a string will be escaped. Note that all but the first line will be indented slightly, the intention is for the first line to be a summary.</p><ul><li><p>Parameters:</p><p><strong>config</strong> (<a href="https://docs.pytest.org/en/8.0.x/reference/reference.html#pytest.Config"><em>Config</em></a>) â€“ The pytest config object.<strong>op</strong> (<a href="https://docs.python.org/3/library/stdtypes.html#str"><em>str</em></a>) â€“ The operator, e.g. <code>&quot;==&quot;</code>, <code>&quot;!=&quot;</code>, <code>&quot;not in&quot;</code>.<strong>left</strong> (<a href="https://docs.python.org/3/library/functions.html#object"><em>object</em></a>) â€“ The left operand.<strong>right</strong> (<a href="https://docs.python.org/3/library/functions.html#object"><em>object</em></a>) â€“ The right operand.</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">pytest_assertrepr_compare</span>(<span class="hljs-params">config, op, left, right</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    Return explanation for comparisons in failing assert expressions.</span><br><span class="hljs-string">è¿”å›å¤±è´¥æ–­è¨€è¡¨è¾¾å¼ä¸­çš„æ¯”è¾ƒçš„è§£é‡Šã€‚</span><br><span class="hljs-string">    Return None for no custom explanation, otherwise return a list of strings. The strings will be joined by newlines but any newlines in a string will be escaped. Note that all but the first line will be indented slightly, the intention is for the first line to be a summary.</span><br><span class="hljs-string">å¦‚æœæ²¡æœ‰è‡ªå®šä¹‰è§£é‡Šï¼Œåˆ™è¿”å› Noneï¼Œå¦åˆ™è¿”å›å­—ç¬¦ä¸²åˆ—è¡¨,å­—ç¬¦ä¸²å°†é€šè¿‡æ¢è¡Œç¬¦è¿æ¥ï¼Œä½†å­—ç¬¦ä¸²ä¸­çš„ä»»ä½•æ¢è¡Œç¬¦éƒ½å°†è¢«è½¬ä¹‰,è¯·æ³¨æ„ï¼Œé™¤äº†ç¬¬ä¸€è¡Œä¹‹å¤–çš„æ‰€æœ‰è¡Œéƒ½å°†ç¨å¾®ç¼©è¿›ï¼Œç›®çš„æ˜¯è®©ç¬¬ä¸€è¡Œæˆä¸ºæ‘˜è¦ã€‚</span><br><span class="hljs-string">Parameters:</span><br><span class="hljs-string">    config (Config) â€“ The pytest config object. pytest é…ç½®å¯¹è±¡</span><br><span class="hljs-string">    op (str) â€“ The operator, e.g. &quot;==&quot;, &quot;!=&quot;, &quot;not in&quot;.æ“ä½œå‘˜ï¼Œä¾‹å¦‚â€œ==â€ã€â€œ!=â€ã€â€œä¸åœ¨â€</span><br><span class="hljs-string">    left (object) â€“ The left operand. å·¦æ“ä½œæ•°ã€‚</span><br><span class="hljs-string">    right (object) â€“ The right operand.å³æ“ä½œæ•°ã€‚</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <br></code></pre></td></tr></table></figure><p>ä½œä¸ºç¤ºä¾‹ï¼Œè¯·è€ƒè™‘åœ¨ conftest.py æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹æŒ‚é’©ï¼Œè¯¥æ–‡ä»¶ä¸º Foo å¯¹è±¡æä¾›æ›¿ä»£è§£é‡Šï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># content of conftest.py</span><br><span class="hljs-keyword">from</span> test_foocompare <span class="hljs-keyword">import</span> Foo<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">pytest_assertrepr_compare</span>(<span class="hljs-params">op, left, right</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">isinstance</span>(left, Foo) <span class="hljs-keyword">and</span> <span class="hljs-built_in">isinstance</span>(right, Foo) <span class="hljs-keyword">and</span> op == <span class="hljs-string">&quot;==&quot;</span>:<br>        <span class="hljs-keyword">return</span> [<br>            <span class="hljs-string">&quot;Comparing Foo instances:&quot;</span>,<br>            <span class="hljs-string">f&quot;   vals: <span class="hljs-subst">&#123;left.val&#125;</span> != <span class="hljs-subst">&#123;right.val&#125;</span>&quot;</span>,<br>        ]<br></code></pre></td></tr></table></figure><p>ç°åœ¨ï¼Œç¼–å†™è¿™ä¸ªæµ‹è¯•æ¨¡å—ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># content of test_foocompare.py</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Foo</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, val</span>):<br>        self.val = val<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__eq__</span>(<span class="hljs-params">self, other</span>):<br>        <span class="hljs-keyword">return</span> self.val == other.val<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_compare</span>():<br>    f1 = Foo(<span class="hljs-number">1</span>)<br>    f2 = Foo(<span class="hljs-number">2</span>)<br>    <span class="hljs-keyword">assert</span> f1 == f2<br></code></pre></td></tr></table></figure><p>å¯ä»¥è¿è¡Œæµ‹è¯•æ¨¡å—å¹¶è·å–conftestæ–‡ä»¶ä¸­å®šä¹‰çš„è‡ªå®šä¹‰è¾“å‡ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python">$ pytest -q test_foocompare.py<br>F                                                                    [<span class="hljs-number">100</span>%]<br>================================= FAILURES =================================<br>_______________________________ test_compare _______________________________<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_compare</span>():<br>        f1 = Foo(<span class="hljs-number">1</span>)<br>        f2 = Foo(<span class="hljs-number">2</span>)<br>&gt;       <span class="hljs-keyword">assert</span> f1 == f2<br>E       <span class="hljs-keyword">assert</span> Comparing Foo instances:<br>E            vals: <span class="hljs-number">1</span> != <span class="hljs-number">2</span><br><br>test_foocompare.py:<span class="hljs-number">12</span>: AssertionError<br>========================= short test summary info ==========================<br>FAILED test_foocompare.py::test_compare - <span class="hljs-keyword">assert</span> Comparing Foo instances:<br><span class="hljs-number">1</span> failed <span class="hljs-keyword">in</span> <span class="hljs-number">0.12</span>s<br></code></pre></td></tr></table></figure><h2 id="3-5-Assertion-introspection-details"><a href="#3-5-Assertion-introspection-details" class="headerlink" title="3.5 Assertion introspection details"></a>3.5 Assertion introspection details</h2><p>ä¸åšå¤šä»‹ç»äº†ï¼Œæ²¡å•¥ç”¨</p>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç¬”è®°</tag>
      
      <tag>pytest</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€pythonã€‘ä¹‹pytestå‘½ä»¤è¡Œè°ƒç”¨ï¼ˆäºŒï¼‰</title>
    <link href="/2024/01/21/662python%E4%B9%8Bpytest%E5%91%BD%E4%BB%A4%E8%A1%8C%E8%B0%83%E7%94%A8%EF%BC%88%E4%BA%8C%EF%BC%89/"/>
    <url>/2024/01/21/662python%E4%B9%8Bpytest%E5%91%BD%E4%BB%A4%E8%A1%8C%E8%B0%83%E7%94%A8%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="äºŒ-å¦‚ä½•ç”¨å‘½ä»¤è¡Œè°ƒç”¨pytest"><a href="#äºŒ-å¦‚ä½•ç”¨å‘½ä»¤è¡Œè°ƒç”¨pytest" class="headerlink" title="äºŒ å¦‚ä½•ç”¨å‘½ä»¤è¡Œè°ƒç”¨pytest"></a>äºŒ å¦‚ä½•ç”¨å‘½ä»¤è¡Œè°ƒç”¨pytest</h1><p>See also</p><p><a href="https://docs.pytest.org/en/8.0.x/reference/reference.html#command-line-flags">Complete pytest command-line flag reference</a></p><p>ä¹Ÿå¯ä»¥ç‚¹å‡»é“¾æ¥æŸ¥çœ‹å®Œæ•´çš„å‘½ä»¤è¡Œä»‹ç»ï¼ˆé‚£å¯å¤ªå…¨é¢äº†ï¼‰</p><blockquote><p>In general, pytest is invoked with the command pytest (see below for other ways to invoke pytest).  This will execute all tests in all files whose names follow the form test_*.py or *_test.py in the current directory and its subdirectories.  More generally, pytest follows standard test discovery rules.</p></blockquote><p>é€šå¸¸ï¼Œpytestæ˜¯ç”¨å‘½ä»¤pytestè°ƒç”¨çš„(å‚è§ä¸‹é¢çš„å…¶ä»–è°ƒç”¨pytestçš„æ–¹æ³•)ã€‚è¿™å°†æ‰§è¡Œå½“å‰ç›®å½•åŠå…¶å­ç›®å½•ä¸­æ‰€æœ‰æ–‡ä»¶åä»¥test_*.pyæˆ–*_test.pyå½¢å¼ç»“å°¾çš„æ–‡ä»¶ä¸­çš„æ‰€æœ‰æµ‹è¯•ã€‚æ›´ä¸€èˆ¬åœ°è¯´ï¼Œpytestéµå¾ªæ ‡å‡†çš„<code>æµ‹è¯•å‘ç°è§„åˆ™</code>ã€‚</p><h2 id="2-1-æŒ‡å®šè¦è¿è¡Œçš„æµ‹è¯•"><a href="#2-1-æŒ‡å®šè¦è¿è¡Œçš„æµ‹è¯•" class="headerlink" title="2.1 æŒ‡å®šè¦è¿è¡Œçš„æµ‹è¯•"></a>2.1 æŒ‡å®šè¦è¿è¡Œçš„æµ‹è¯•</h2><p>Pytest æ”¯æŒå¤šç§ä»å‘½ä»¤è¡Œè¿è¡Œå’Œé€‰æ‹©æµ‹è¯•çš„æ–¹æ³•ã€‚</p><p><strong>Run tests in a moduleï¼šåœ¨æ¨¡å—ä¸­è¿è¡Œæµ‹è¯• ï¼ˆæ¨¡å—å°±æ˜¯pyæ–‡ä»¶ï¼‰</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pytest test_mod.py<br></code></pre></td></tr></table></figure><p><strong>Run tests in a directoryï¼šåœ¨ç›®å½•ä¸­è¿è¡Œæµ‹è¯•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pytest testing/<br></code></pre></td></tr></table></figure><p><strong>Run tests by keyword expressionsï¼šé€šè¿‡å…³é”®å­—è¡¨è¾¾å¼è¿è¡Œæµ‹è¯•</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">pytest -k <span class="hljs-string">&#x27;MyClass and not method&#x27;</span><br></code></pre></td></tr></table></figure><blockquote><p>This will run tests which contain names that match the given string expression (case-insensitive), which can include Python operators that use filenames, class names and function names as variables. The example above will run TestMyClass.test_something but not TestMyClass.test_method_simple. Use â€œâ€ instead of â€˜â€™ in expression when running this on Windows</p><p>è¿™å°†è¿è¡ŒåŒ…å«ä¸ç»™å®šåç§°åŒ¹é…çš„åç§°çš„æµ‹è¯• <em>å­—ç¬¦ä¸²è¡¨è¾¾å¼</em> ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰ï¼Œå®ƒå¯ä»¥åŒ…æ‹¬ä½¿ç”¨æ–‡ä»¶åã€ç±»åå’Œå‡½æ•°åä½œä¸ºå˜é‡çš„Pythonè¿ç®—ç¬¦ã€‚ä¸Šé¢çš„ä¾‹å­å°†è¿è¡Œ <code>TestMyClass.test_something</code> ä½†ä¸æ˜¯ <code>TestMyClass.test_method_simple</code> .</p><p>ï¼ˆè¿™ä¸ªç”¨çš„å°‘ï¼‰</p></blockquote><p><strong>Run tests by collection argumentsï¼šé€šè¿‡é›†åˆå‚æ•°è¿è¡Œæµ‹è¯•</strong></p><p>Pass the module filename relative to the working directory, followed by specifiers like the class name and function name separated by <code>::</code> characters, and parameters from parameterization enclosed in <code>[]</code>.</p><p>ä¼ é€’ç›¸å¯¹äºå·¥ä½œç›®å½•çš„æ¨¡å—æ–‡ä»¶åï¼Œåè·Ÿç”± :: å­—ç¬¦åˆ†éš”çš„ç±»åå’Œå‡½æ•°åç­‰è¯´æ˜ç¬¦ï¼Œä»¥åŠåŒ…å«åœ¨ [ ] ä¸­çš„å‚æ•°åŒ–å‚æ•°ã€‚ï¼ˆä¸‹é¢è®©æˆ‘ä»¬çœ‹çœ‹ :: çš„ç”¨æ³•ï¼‰</p><p>To run a specific test within a module:è¦åœ¨æ¨¡å—å†…è¿è¡Œç‰¹å®šæµ‹è¯•ï¼š</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">pytest tests/test_mod.py::test_func<br></code></pre></td></tr></table></figure><p>To run all tests in a class: è¦è¿è¡Œç±»ä¸­çš„æ‰€æœ‰æµ‹è¯•ï¼š</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">pytest tests/test_mod.py::TestClass<br></code></pre></td></tr></table></figure><p>Specifying a specific test method: æŒ‡å®šå…·ä½“çš„æµ‹è¯•æ–¹æ³•ï¼š</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cpp">pytest tests/test_mod.py::TestClass::test_method<br></code></pre></td></tr></table></figure><p>Specifying a specific parametrization of a test: æŒ‡å®šæµ‹è¯•çš„ç‰¹å®šå‚æ•°åŒ–ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus">pytest tests/test_mod<span class="hljs-selector-class">.py</span>::test_func<span class="hljs-selector-attr">[x1,y2]</span><br></code></pre></td></tr></table></figure><p><strong>Run tests by marker expressionsï¼šé€šè¿‡æ ‡è®°è¡¨è¾¾å¼è¿è¡Œæµ‹è¯•</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">pytest -m slow <br></code></pre></td></tr></table></figure><p>Will run all tests which are decorated with the <code>@pytest.mark.slow</code> decorator.</p><p>For more information see <a href="https://docs.pytest.org/en/8.0.x/how-to/mark.html#mark">marks</a>.</p><p>å°†è¿è¡Œæ‰€æœ‰ç”¨ @pytest.mark.slow è£…é¥°å™¨è£…é¥°çš„æµ‹è¯•ã€‚ æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…æ ‡è®°ï¼ˆå…³äºmarkæ ‡è®°ï¼Œåé¢ä¼šè®²â€¦ï¼‰ã€‚</p><p><strong>Run tests from packagesï¼šä»åŒ…è¿è¡Œæµ‹è¯•</strong></p><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ada">pytest <span class="hljs-comment">--pyargs pkg.testing</span><br></code></pre></td></tr></table></figure><p>This will import <code>pkg.testing</code> and use its filesystem location to find and run tests from.</p><p>è¿™å°†å¯¼å…¥ pkg.testing å¹¶ä½¿ç”¨å…¶æ–‡ä»¶ç³»ç»Ÿä½ç½®æ¥æŸ¥æ‰¾å¹¶è¿è¡Œæµ‹è¯•ã€‚ï¼ˆè¿™ä¸ªç”¨çš„å°‘ï¼‰</p><h2 id="2-2-è·å–æœ‰å…³ç‰ˆæœ¬ã€é€‰é¡¹åç§°ã€ç¯å¢ƒå˜é‡çš„å¸®åŠ©"><a href="#2-2-è·å–æœ‰å…³ç‰ˆæœ¬ã€é€‰é¡¹åç§°ã€ç¯å¢ƒå˜é‡çš„å¸®åŠ©" class="headerlink" title="2.2 è·å–æœ‰å…³ç‰ˆæœ¬ã€é€‰é¡¹åç§°ã€ç¯å¢ƒå˜é‡çš„å¸®åŠ©"></a>2.2 è·å–æœ‰å…³ç‰ˆæœ¬ã€é€‰é¡¹åç§°ã€ç¯å¢ƒå˜é‡çš„å¸®åŠ©</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">pytest --version   <span class="hljs-comment"># shows where pytest was imported from ç‰ˆæœ¬</span><br>pytest --fixtures  <span class="hljs-comment"># show available builtin function argumentsæ˜¾ç¤ºå¯ç”¨çš„å†…ç½®å‡½æ•°å‚æ•°</span><br>pytest -h | --<span class="hljs-built_in">help</span> <span class="hljs-comment"># show help on command line and config file optionsæ˜¾ç¤ºå¸®åŠ©</span><br></code></pre></td></tr></table></figure><h2 id="2-3-åˆ†ææµ‹è¯•æ‰§è¡ŒæŒç»­æ—¶é—´"><a href="#2-3-åˆ†ææµ‹è¯•æ‰§è¡ŒæŒç»­æ—¶é—´" class="headerlink" title="2.3 åˆ†ææµ‹è¯•æ‰§è¡ŒæŒç»­æ—¶é—´"></a>2.3 åˆ†ææµ‹è¯•æ‰§è¡ŒæŒç»­æ—¶é—´</h2><p><em>6.0ç‰ˆæœ¬æ›´æ”¹</em></p><p>To get a list of the slowest 10 test durations over 1.0s longè¦è·å–é•¿åº¦è¶…è¿‡ 1.0 ç§’çš„æœ€æ…¢ 10 ä¸ªæµ‹è¯•æŒç»­æ—¶é—´çš„åˆ—è¡¨ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">pytest <span class="hljs-attribute">--durations</span>=10 <span class="hljs-attribute">--durations-min</span>=1.0 # durationsæŒç»­æ—¶é—´<br></code></pre></td></tr></table></figure><p>By default, pytest will not show test durations that are too small (&lt;0.005s) unless <code>-vv</code> is passed on the command-line.</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œpytest ä¸ä¼šæ˜¾ç¤ºå¤ªçŸ­ï¼ˆ&lt;0.005sï¼‰çš„æµ‹è¯•æŒç»­æ—¶é—´ï¼Œé™¤éåœ¨å‘½ä»¤è¡Œä¸Šä¼ é€’ -vvã€‚</p><h2 id="2-4-ç®¡ç†æ’ä»¶çš„åŠ è½½"><a href="#2-4-ç®¡ç†æ’ä»¶çš„åŠ è½½" class="headerlink" title="2.4 ç®¡ç†æ’ä»¶çš„åŠ è½½"></a>2.4 ç®¡ç†æ’ä»¶çš„åŠ è½½</h2><h3 id="2-4-1-æ—©æœŸåŠ è½½æ’ä»¶"><a href="#2-4-1-æ—©æœŸåŠ è½½æ’ä»¶" class="headerlink" title="2.4.1 æ—©æœŸåŠ è½½æ’ä»¶"></a>2.4.1 æ—©æœŸåŠ è½½æ’ä»¶</h3><p>You can early-load plugins (internal and external) explicitly in the command-line with the <code>-p</code> option:</p><p>å¯ä»¥ä½¿ç”¨ -p é€‰é¡¹åœ¨å‘½ä»¤è¡Œä¸­æ˜¾å¼æå‰åŠ è½½æ’ä»¶ï¼ˆå†…éƒ¨å’Œå¤–éƒ¨ï¼‰ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">pytest -<span class="hljs-selector-tag">p</span> mypluginmodule<br></code></pre></td></tr></table></figure><p>The option receives a <code>name</code> parameter, which can be:</p><p>è¯¥é€‰é¡¹æ¥æ”¶ä¸€ä¸ªåç§°å‚æ•°ï¼Œè¯¥å‚æ•°å¯ä»¥æ˜¯ï¼š</p><ul><li><p>A full module dotted name, for example <code>myproject.plugins</code>. This dotted name must be importable.</p></li><li><p>å®Œæ•´çš„æ¨¡å—ç‚¹åç§°ï¼Œä¾‹å¦‚ myproject.pluginsã€‚è¿™ä¸ªç‚¹åç§°å¿…é¡»æ˜¯å¯å¯¼å…¥çš„ã€‚</p></li><li><p>The entry-point name of a plugin. This is the name passed to <code>setuptools</code> when the plugin is registered. For example to early-load the <a href="https://pypi.org/project/pytest-cov/">pytest-cov</a> plugin you can use:</p></li><li><p>æ’ä»¶çš„å…¥å£ç‚¹åç§°ã€‚è¿™æ˜¯æ³¨å†Œæ’ä»¶æ—¶ä¼ é€’ç»™ setuptools çš„åç§°ã€‚ä¾‹å¦‚ï¼Œè¦æå‰åŠ è½½ pytest-cov æ’ä»¶ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ï¼š</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css">pytest -<span class="hljs-selector-tag">p</span> pytest_cov<br></code></pre></td></tr></table></figure></li></ul><h3 id="2-4-2-ç¦ç”¨æ’ä»¶"><a href="#2-4-2-ç¦ç”¨æ’ä»¶" class="headerlink" title="2.4.2 ç¦ç”¨æ’ä»¶"></a>2.4.2 ç¦ç”¨æ’ä»¶</h3><p>To disable loading specific plugins at invocation time, use the <code>-p</code> option together with the prefix <code>no:</code>.</p><p>è¦ç¦æ­¢åœ¨è°ƒç”¨æ—¶åŠ è½½ç‰¹å®šæ’ä»¶ï¼Œè¯·ä½¿ç”¨ -p é€‰é¡¹å’Œå‰ç¼€ no:ã€‚</p><p>ç¤ºä¾‹ï¼šè¦ç¦ç”¨åŠ è½½æ’ä»¶ doctestï¼ˆè¯¥æ’ä»¶è´Ÿè´£ä»æ–‡æœ¬æ–‡ä»¶æ‰§è¡Œ doctest æµ‹è¯•ï¼‰ï¼Œè¯·åƒè¿™æ ·è°ƒç”¨ pytestï¼š</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">pytest</span> -p <span class="hljs-literal">no</span>:doctest<br></code></pre></td></tr></table></figure><h2 id="2-5-è°ƒç”¨-pytest-çš„å…¶ä»–æ–¹å¼"><a href="#2-5-è°ƒç”¨-pytest-çš„å…¶ä»–æ–¹å¼" class="headerlink" title="2.5 è°ƒç”¨ pytest çš„å…¶ä»–æ–¹å¼"></a>2.5 è°ƒç”¨ pytest çš„å…¶ä»–æ–¹å¼</h2><h3 id="2-5-1-è¿‡-python-m-pytest-è°ƒç”¨-pytest"><a href="#2-5-1-è¿‡-python-m-pytest-è°ƒç”¨-pytest" class="headerlink" title="2.5.1 è¿‡ python -m pytest è°ƒç”¨ pytest"></a>2.5.1 è¿‡ python -m pytest è°ƒç”¨ pytest</h3><p>å¯ä»¥ä»å‘½ä»¤è¡Œé€šè¿‡ Python è§£é‡Šå™¨è°ƒç”¨æµ‹è¯•</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">python</span> -m pytest<span class="hljs-meta"> [...]</span><br></code></pre></td></tr></table></figure><p>This is almost equivalent to invoking the command line script <code>pytest [...]</code> directly, except that calling via <code>python</code> will also add the current directory to <code>sys.path</code>.</p><p>è¿™å‡ ä¹ç›¸å½“äºç›´æ¥è°ƒç”¨å‘½ä»¤è¡Œè„šæœ¬ pytest [â€¦]ï¼Œåªä¸è¿‡é€šè¿‡ python è°ƒç”¨è¿˜ä¼šå°†å½“å‰ç›®å½•æ·»åŠ åˆ° sys.path ä¸­ã€‚</p><h3 id="2-5-2-ä»-Python-ä»£ç è°ƒç”¨-pytestã€å¸¸ç”¨ã€‘"><a href="#2-5-2-ä»-Python-ä»£ç è°ƒç”¨-pytestã€å¸¸ç”¨ã€‘" class="headerlink" title="2.5.2 ä» Python ä»£ç è°ƒç”¨ pytestã€å¸¸ç”¨ã€‘"></a>2.5.2 ä» Python ä»£ç è°ƒç”¨ pytestã€å¸¸ç”¨ã€‘</h3><p>å¯ä»¥ç›´æ¥ä»Pythonä»£ç è°ƒç”¨pytestï¼š</p><figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs abnf"><span class="hljs-attribute">retcode</span> <span class="hljs-operator">=</span> pytest.main()<br></code></pre></td></tr></table></figure><p>this acts as if you would call â€œpytestâ€ from the command line. It will not raise <a href="https://docs.python.org/3/library/exceptions.html#SystemExit"><code>SystemExit</code></a> but return the <a href="https://docs.pytest.org/en/8.0.x/reference/exit-codes.html#exit-codes">exit code</a> instead. If you donâ€™t pass it any arguments, <code>main</code> reads the arguments from the command line arguments of the process (<a href="https://docs.python.org/3/library/sys.html#sys.argv"><code>sys.argv</code></a>), which may be undesirable. You can pass in options and arguments explicitly:</p><p>è¿™å°±åƒä»å‘½ä»¤è¡Œè°ƒç”¨â€œpytestâ€ä¸€æ ·ã€‚å®ƒä¸ä¼šå¼•å‘SystemExitï¼Œè€Œæ˜¯è¿”å›é€€å‡ºä»£ç ã€‚å¦‚æœä¸å‘å®ƒä¼ é€’ä»»ä½•å‚æ•°ï¼Œåˆ™mainå°†ä»è¿›ç¨‹çš„å‘½ä»¤è¡Œå‚æ•°(sys.argv)ä¸­è¯»å–å‚æ•°ï¼Œè¿™å¯èƒ½æ˜¯ä¸å¸Œæœ›çœ‹åˆ°çš„ã€‚ä½ å¯ä»¥æ˜¾å¼åœ°ä¼ å…¥é€‰é¡¹å’Œå‚æ•°:</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">retcode</span> = pytest.main([<span class="hljs-string">&quot;-x&quot;</span>, <span class="hljs-string">&quot;mytestdir&quot;</span>])<br></code></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥ä¸º<code> pytest.main</code> æŒ‡å®šå…¶ä»–æ’ä»¶ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-comment"># content of myinvoke.py</span><br>import sys<br><br>import pytest<br><br><br>class MyPlugin:<br>    def pytest_sessionfinish(self):<br>        print(<span class="hljs-string">&quot;*** test run reporting finishing&quot;</span>)<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&quot;__main__&quot;</span>:<br>    sys.<span class="hljs-keyword">exit</span>(pytest.main([<span class="hljs-string">&quot;-qq&quot;</span>], plugins=[MyPlugin()]))<br></code></pre></td></tr></table></figure><p>Running it will show that <code>MyPlugin</code> was added and its hook was invoked:</p><p>è¿è¡Œå®ƒå°†æ˜¾ç¤º MyPlugin å·²æ·»åŠ å¹¶ä¸”å…¶é’©å­å·²è¢«è°ƒç”¨ï¼š</p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gams"><span class="hljs-symbol">$</span> python myinvoke.py<br><span class="hljs-comment">*** test run reporting finishing</span><br></code></pre></td></tr></table></figure><blockquote><p>Note</p><p>Calling <code>pytest.main()</code> will result in importing your tests and any modules that they import. Due to the caching mechanism of pythonâ€™s import system, making subsequent calls to <code>pytest.main()</code> from the same process will not reflect changes to those files between the calls. For this reason, making multiple calls to <code>pytest.main()</code> from the same process (in order to re-run tests, for example) is not recommended.</p></blockquote><blockquote><p>æ³¨æ„<br>è°ƒç”¨pytest.main()å°†å¯¼è‡´å¯¼å…¥æµ‹è¯•å’Œå®ƒä»¬å¯¼å…¥çš„ä»»ä½•æ¨¡å—ã€‚ç”±äºpythonå¯¼å…¥ç³»ç»Ÿçš„ç¼“å­˜æœºåˆ¶ï¼Œä»åŒä¸€è¿›ç¨‹å¯¹pytest.main()çš„åç»­è°ƒç”¨å°†ä¸ä¼šåæ˜ è°ƒç”¨ä¹‹é—´å¯¹è¿™äº›æ–‡ä»¶çš„æ›´æ”¹ã€‚å‡ºäºè¿™ä¸ªåŸå› ï¼Œä¸å»ºè®®ä»åŒä¸€è¿›ç¨‹å¤šæ¬¡è°ƒç”¨pytest.main()(ä¾‹å¦‚ï¼Œä¸ºäº†é‡æ–°è¿è¡Œæµ‹è¯•)ã€‚</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç¬”è®°</tag>
      
      <tag>pytest</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€thoughtã€‘æ€è€ƒä¹‹è´¨é‡å†…å»ºçš„ä¸€äº›ç†è§£</title>
    <link href="/2024/01/20/902%E6%80%9D%E8%80%83%E4%B9%8B%E8%B4%A8%E9%87%8F%E5%86%85%E5%BB%BA%E7%9A%84%E4%B8%80%E4%BA%9B%E7%90%86%E8%A7%A3/"/>
    <url>/2024/01/20/902%E6%80%9D%E8%80%83%E4%B9%8B%E8%B4%A8%E9%87%8F%E5%86%85%E5%BB%BA%E7%9A%84%E4%B8%80%E4%BA%9B%E7%90%86%E8%A7%A3/</url>
    
    <content type="html"><![CDATA[<h1 id="è´¨é‡å†…å»ºçš„ç†è§£"><a href="#è´¨é‡å†…å»ºçš„ç†è§£" class="headerlink" title="è´¨é‡å†…å»ºçš„ç†è§£"></a>è´¨é‡å†…å»ºçš„ç†è§£</h1><p><strong>è´¨é‡çš„æ ‡å‡†</strong>ï¼š</p><p>è´¨é‡çš„æ ‡å‡†æ˜¯å¤šç»´åº¦çš„ã€‚å¯ä»¥æ˜¯åŠŸèƒ½æ€§çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯ä½“éªŒæ–¹é¢çš„ï¼Œæˆ–è€…ä»¥æ›´ä½çš„æˆæœ¬äº¤ä»˜ã€</p><p>æµ‹è¯•çš„æœ¬è´¨ï¼šæ˜¯éªŒè¯äº¤ä»˜çš„äº§å“ç¬¦åˆäº§å“è®¾è®¡çš„é¢„æœŸæ ‡å‡†ï¼Œä»¥åŠæ˜¯å¦å­˜åœ¨å¯èƒ½å½±å“äº§å“è´¨é‡æˆ–è€…ç”¨æˆ·ä½“éªŒçš„é£é™©ã€‚è½¯ä»¶å·¥ç¨‹çš„æœ¬è´¨ä¹Ÿæ˜¯èšç„¦è´¨é‡äº¤ä»˜ï¼Œä¸ºäº†åœ¨ä¸æ–­è¿­ä»£çš„è¿‡ç¨‹ä¸­è§£å†³è´¨é‡ä¸å¯æ§è€Œäº§ç”Ÿçš„ä¸€ç³»åˆ—æ–¹æ³•è®ºå’Œæœ€ä½³æ—¶é—´ï¼Œ</p><p>æˆ‘ä»¬éƒ½çŸ¥é“ä¸€å¥è¯å«åšï¼šâ€œè´¨é‡æ˜¯è®¾è®¡å’Œæ„å»ºå‡ºæ¥çš„ï¼Œè€Œä¸æ˜¯æµ‹è¯•å‡ºæ¥çš„ã€‚â€</p><p>å¯¹äºè´¨é‡å»ºè®¾ï¼Œ ä½œç”¨åœ¨è½¯ä»¶çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ï¼Œè¦æ±‚å‚ä¸çš„å„ä¸ªè§’è‰²å®æ—¶å¯¹é¡¹ç›®çš„è´¨é‡è´Ÿè´£ï¼Œç¡®ä¿é¡¹ç›®åœ¨äº¤ä»˜åˆ°ä¸‹ä¸€ç¯èŠ‚å‰å·²ç»æœ‰äº†åŸºç¡€çš„è´¨é‡ã€‚è´¨é‡å†…å»ºçš„ç›®çš„æ˜¯ä¸ºäº†å‡å°‘å› ä¸ºå‰æœŸé£é™©ä¸å¯æ§è€Œå¯¼è‡´åæœŸçš„ä¿®å¤æˆæœ¬å¢åŠ ï¼Œè¿›è€Œæµªè´¹å¤§é‡èµ„æºã€‚</p><h2 id="å½±å“è´¨é‡çš„ä¸‰è¦ç´ ï¼š"><a href="#å½±å“è´¨é‡çš„ä¸‰è¦ç´ ï¼š" class="headerlink" title="å½±å“è´¨é‡çš„ä¸‰è¦ç´ ï¼š"></a>å½±å“è´¨é‡çš„ä¸‰è¦ç´ ï¼š</h2><p>1ã€èŒƒå›´æ˜¯å¦æ˜ç¡®ï¼šéœ€æ±‚èŒƒå›´ã€å½±å“èŒƒå›´ã€æµ‹è¯•èŒƒå›´ã€äº¤ä»˜èŒƒå›´</p><p>2ã€æ—¶é—´æ˜¯å¦è¶³å¤Ÿï¼šç§‘å­¦åˆç†è¯„ä¼°æŠ•å…¥çš„æ—¶é—´æ˜¯å¦è¶³å¤Ÿ</p><p>3ã€æˆæœ¬æ˜¯å¦å¯æ§ï¼šä¸»è¦æˆæœ¬æœ‰è½¯ä»¶æˆæœ¬å’Œç¡¬ä»¶æˆæœ¬ï¼ŒæœåŠ¡å™¨èµ„æºã€æŠ€æœ¯å®ç°éš¾åº¦ã€æ–°æ¡†æ¶çš„è½åœ°å’Œé€‚é…æ”¹é€ ï¼ŒæŠ•å…¥äººåŠ›å’Œå•ä½äººåŠ›çš„äº§å‡ºæ•ˆç‡</p><p>è´¨é‡å†…å»ºæ‰€é¢ä¸´çš„æŒ‘æˆ˜ï¼šåº”å¯¹å˜åŒ–ã€è´¨é‡æ–‡åŒ–ã€æŒ‡å¯¼æ–¹æ³•ã€å·¥ç¨‹èƒ½åŠ›</p><h2 id="è´¨é‡å†…å»ºè½åœ°å››è¦ç´ ï¼šç»„ç»‡-æ–‡åŒ–-æ–¹æ³•-å·¥å…·ã€‚"><a href="#è´¨é‡å†…å»ºè½åœ°å››è¦ç´ ï¼šç»„ç»‡-æ–‡åŒ–-æ–¹æ³•-å·¥å…·ã€‚" class="headerlink" title="è´¨é‡å†…å»ºè½åœ°å››è¦ç´ ï¼šç»„ç»‡+æ–‡åŒ–+æ–¹æ³•+å·¥å…·ã€‚"></a>è´¨é‡å†…å»ºè½åœ°å››è¦ç´ ï¼šç»„ç»‡+æ–‡åŒ–+æ–¹æ³•+å·¥å…·ã€‚</h2><p>1ã€ç»„ç»‡ï¼šæ›´åˆç†çš„æµç¨‹è§„èŒƒæ¥å°½å¯èƒ½çš„ä¿è¯ä¸šåŠ¡è¿­ä»£å’Œäººå‘˜æ›´è¿­</p><p>2ã€æ–‡åŒ–ï¼šæ–‡åŒ–çš„å½¢æˆæ˜¯é•¿æœŸæŒç»­çš„è¿‡ç¨‹ï¼Œæ—¢è¦å®£è®²ä¹Ÿè¦å®è·µ</p><p>3ã€æ–¹æ³•ï¼šåœ¨æ¼«é•¿çš„æµ‹è¯•ç”Ÿæ¶¯æœ‰å¾ˆå¤šä¼˜ç§€çš„å®è·µå’Œæ–¹æ³•å¯ä»¥å‚è€ƒï¼Œæ¯”å¦‚ï¼šæµ‹è¯•å·¦ç§»ã€æŒç»­åé¦ˆã€æµ‹è¯•å³ç§»ã€è´¨é‡è·Ÿè¸ªç­‰å…·ä½“çš„æ—¶é—´æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•æ²¡æœ‰å…ˆåé¡ºåºï¼Œåœ¨è½åœ°çš„è¿‡ç¨‹ä¸­è¦æ ¹æ®å…·ä½“æƒ…å†µé€‰æ‹©é€‚åˆè‡ªå·±å›¢é˜Ÿçš„æ–¹å¼ï¼Œå…ˆå°èŒƒå›´è½åœ°ï¼Œæ‹¿åˆ°å¥½çš„ç»“æœï¼Œå½¢æˆå½±å“åŠ›ï¼Œç„¶åå†ä¸æ–­åœ°æ‰©å¤§èŒƒå›´ï¼Œç”±ç‚¹åˆ°é¢æœ€ç»ˆå½¢æˆä½“ç³»åŒ–ã€‚</p><p>3ã€å·¥å…·ï¼šä¸Šé¢æåˆ°äº†å½±å“äº¤ä»˜è´¨é‡çš„ä¸‰è¦ç´ ï¼Œå…¶å®æ—¶é—´å’Œæˆæœ¬æ˜¯ç›¸äº’å½±å“çš„ã€‚ä½†æ˜¯ä¸¤è€…ä¹‹é—´æœ‰ä¸ªå…±åŒçš„è¿½æ±‚ï¼Œå°±æ˜¯æ•ˆç‡ï¼Œè€Œå„ç§å·¥å…·æˆ–è€…å¹³å°çš„å¼•å…¥å°±æ˜¯å¯ä»¥å¤§å¹…æé«˜ç ”å‘è¿‡ç¨‹çš„æ•ˆç‡ã€‚æ¯”å¦‚CICDã€ç›‘æ§å¹³å°ã€é“¾è·¯è¿½è¸ªã€æ•°æ®å·¥å‚ã€è´¨é‡åº¦é‡ã€è‡ªåŠ¨åŒ–æµ‹è¯•ç­‰å·¥å…·å¹³å°ï¼Œå°±æ˜¯å¯ä»¥å¸®åŠ©è´¨é‡å†…å»ºæ›´é«˜æ•ˆçš„è½åœ°</p><h2 id="è´¨é‡å†…å»ºçš„ä½œç”¨"><a href="#è´¨é‡å†…å»ºçš„ä½œç”¨" class="headerlink" title="è´¨é‡å†…å»ºçš„ä½œç”¨"></a>è´¨é‡å†…å»ºçš„ä½œç”¨</h2><p>å°±æ˜¯åœ¨è½¯ä»¶çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ï¼Œè¦æ±‚å‚ä¸çš„å„ä¸ªè§’è‰²å®æ—¶å¯¹è½¯ä»¶çš„è´¨é‡è´Ÿè´£ï¼Œç¡®ä¿è½¯ä»¶åœ¨äº¤ä»˜åˆ°ä¸‹ä¸€ç¯èŠ‚é’±å·²ç»æœ‰äº†åŸºç¡€çš„è´¨é‡ä¿è¯ã€‚ç›®çš„æ˜¯ä¸ºäº†å‡å°‘å› ä¸ºå‰æœŸé£é™©ä¸å¯æ§è€Œå¯¼è‡´åæœŸçš„ä¿®å¤æˆæœ¬å¢åŠ ï¼Œè¿›è€Œæµªè´¹å¤§é‡èµ„æºã€‚</p><p>ä¸å…¶è¯´è´¨é‡å†…å»ºæ˜¯ä¸€å¥—æ–¹æ³•è®ºï¼Œæˆ‘æ›´è®¤ä¸ºå…¶æœ¬è´¨æ˜¯ä¸€ç§æ€æƒ³å’Œæ–‡åŒ–ã€‚é€šè¿‡å…¨ç”Ÿå‘½å‘¨æœŸçš„å…¨å‘˜å¯¹è´¨é‡è´Ÿè´£çš„ç†å¿µï¼Œæ¥æŒ‡å¯¼å®é™…çš„è½¯ä»¶ç ”å‘è¿‡ç¨‹ä¸­å…³æ³¨è´¨é‡ï¼Œæé«˜è®¾è®¡å’Œæ„å»ºè´¨é‡ï¼Œ</p><h2 id="è´¨é‡å†…å»ºæ ¸å¿ƒå››ç‚¹ï¼šå…¨ä½“è´Ÿè´£ã€æ§åˆ¶é£é™©ã€å…³æ³¨å’Œæé«˜è´¨é‡"><a href="#è´¨é‡å†…å»ºæ ¸å¿ƒå››ç‚¹ï¼šå…¨ä½“è´Ÿè´£ã€æ§åˆ¶é£é™©ã€å…³æ³¨å’Œæé«˜è´¨é‡" class="headerlink" title="è´¨é‡å†…å»ºæ ¸å¿ƒå››ç‚¹ï¼šå…¨ä½“è´Ÿè´£ã€æ§åˆ¶é£é™©ã€å…³æ³¨å’Œæé«˜è´¨é‡"></a>è´¨é‡å†…å»ºæ ¸å¿ƒå››ç‚¹ï¼šå…¨ä½“è´Ÿè´£ã€æ§åˆ¶é£é™©ã€å…³æ³¨å’Œæé«˜è´¨é‡</h2><p>è½¯ä»¶çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå¦‚ä¸‹</p><p>é¡¹ç›®-&gt;è®¡åˆ’-&gt;éœ€æ±‚-&gt;è®¾è®¡-&gt;å®ç°-&gt;æµ‹è¯•-&gt;äº¤ä»˜-&gt;å†åˆ°è®¡åˆ’è¿­ä»£</p><p>1ã€å…¨ä½“è´Ÿè´£ï¼šæ„å‘³ç€å‚ä¸é¡¹ç›®çš„å„ä¸ªè§’è‰²ï¼Œå¦‚é¡¹ç›®è´Ÿè´£äººã€é¡¹ç›®ç®¡ç†ã€äº§å“ã€ç ”å‘ã€æµ‹è¯•è¿ç»´ç­‰å¤šä¸ªè§’è‰²éƒ½å¯¹æœ€ç»ˆçš„çº¿ä¸Šäº§å“äº¤ä»˜è´¨é‡è´Ÿä¸€å®šè´£ä»»</p><p>2ã€æ§åˆ¶é£é™©ï¼šå³åœ¨è½¯ä»¶ç”Ÿå‘½å‘¨æœŸä¸­çš„æ¯ä¸ªç¯èŠ‚ï¼Œéƒ½è¦åˆ©ç”¨è´¨é‡é—¨ç¦çš„ä½œç”¨å°½æ—©çš„ä»‹å…¥éœ€æ±‚è®¾è®¡ã€äº§å“è®¾è®¡ã€æŠ€æœ¯æ–¹æ¡ˆè®¾è®¡ç­‰ç¯èŠ‚ï¼Œé€šè¿‡è¯„å®¡ã€æé—®ç­‰æ–¹å¼ï¼Œå°½å¯èƒ½å¤šçš„å‘ç°å­˜åœ¨çš„æ¼æ´å’Œä¸è¶³ã€‚ç„¶åé€šè¿‡åˆ¶å®šç§‘å­¦åˆç†ç¬¦åˆé¡¹ç›®å®é™…æƒ…å†µçš„å‡†å…¥å‡†å‡ºæ ‡å‡†ï¼Œæ¥ä¿è¯æ¯ä¸ªç¯èŠ‚çš„æµè½¬åˆ°ä¸‹ä¸€ä¸ªç¯èŠ‚çš„äº§å‡ºç‰©è¾¾æ ‡</p><p>3ã€æé«˜è´¨é‡ ï¼š  ä¸ç”¨è¯´ï¼Œè¿™ä¸ªè½¯ä»¶æµ‹è¯•æˆ–è€…è¯´è´¨é‡ä¿éšœå·¥ä½œä¸€ç›´ä»¥æ¥çš„ç›®æ ‡ã€‚</p><p>è´¨é‡å†…å»ºçš„å…«å¤§ç‰¹è´¨ï¼š</p><p>æŒç»­è¯„ä¼°</p><p>æŒç»­æ”¹è¿›</p><p>æŒç»­éªŒè¯</p><p>æŒç»­äº¤ä»˜</p><p>æŒç»­å·¡æ£€</p><p>æŒç»­åº¦é‡</p><p>æŒç»­è¿è¥</p><p>æŒç»­åé¦ˆ</p><p> 1ã€è‡ªèº«ä¸“ä¸šèƒ½åŠ›çš„æŒç»­æå‡ä¸æ ¸å¿ƒè¾“å‡ºã€‚ </p><p> 2ã€è´¨é‡æµ‹è¯•éƒ¨é—¨çš„ç®¡ç†åŠè·¨éƒ¨é—¨ååŒï¼›</p><p> 3ã€è´¨é‡æµ‹è¯•å…¨æµç¨‹ä½“ç³»çš„æ¢³ç†ä¸å»ºè®¾ï¼›</p><p>æ‚¨å¥½ï¼Œæ‚¨æŒ‡å‡ºçš„ä¸‰ä¸ªç»´åº¦ï¼Œæ˜¯ç›¸è¾…ç›¸æˆä¸”å…ˆåæœ‰åºçš„ï¼Œ</p><p>è‡ªèº«40%â€”&gt;å›¢é˜ŸåŠè·¨éƒ¨é—¨30%â€”&gt;å…¨æµç¨‹ä½“ç³»å»ºè®¾30%</p><p>ç¬¬ä¸€ï¼šè‡ªèº«ä¸“ä¸šèƒ½åŠ›çš„æŒç»­æå‡ä¸æ ¸å¿ƒè¾“å‡ºæ˜¯é‡ä¸­ä¹‹é‡ï¼Œè¿™ä¹Ÿæ˜¯è¿™ä¸ªå²—ä½çš„å®‰èº«ä¹‹æ ¹æœ¬æ‰€åœ¨ï¼Œä½œä¸ºä¸€ä¸ªè´¨é‡æµ‹è¯•ä¸“ä¸šäººå‘˜ï¼ŒæŒç»­æå‡è‡ªèº«ä¸šåŠ¡èƒ½åŠ›æ˜¯è‡³å…³é‡è¦çš„ã€‚é€šè¿‡ä¸æ–­çš„å­¦ä¹ å’Œå®è·µï¼Œå¯¹æ–°çš„æµ‹è¯•å·¥å…·å’Œæ¡†æ¶çš„å¼€å‘æ˜¯å¯ä»¥æ˜æ˜¾æå‡æµ‹è¯•æ•ˆç‡ä¸”å¹¿æ³›åº”ç”¨åœ¨å›¢é˜Ÿä¹‹ä¸Šçš„ï¼Œ</p><p>ç¬¬äºŒï¼šè´¨é‡éƒ¨é—¨ç®¡ç†åŠè·¨éƒ¨é—¨ååŒï¼šä¸€ä¸ªå›¢é˜Ÿçš„æˆ˜æ–—åŠ›è¿œé«˜äºä¸€ä¸ªäººä¹‹ä¸Šï¼Œ å›¢é˜Ÿçš„ç»„å»ºã€äººå‘˜çš„åŸ¹å…»ã€èµ„æºç®¡ç†ã€é¡¹ç›®ç®¡ç†ç­‰ç»´åº¦å¯ä»¥é€šè¿‡æŠ€æœ¯æ–‡æ¡£ç¼–å†™ã€å‘˜å·¥æ‰‹å†Œæ±‡æ€»ã€æŠ€æœ¯ç»éªŒåˆ†äº«å­¦ä¹ ä¼šç­‰æ–¹å¼æ¥æå‡æ•´ä¸ªè´¨é‡å›¢é˜Ÿç»¼åˆèƒ½åŠ›ï¼Œä¸å¼€å‘ã€äº§å“å›¢é˜Ÿçš„åä½œç­‰å¯ä»¥å¾ˆå¥½æ§åˆ¶è´¨é‡å›¢é˜Ÿçš„å‡†å…¥å‡†å‡ºæ ‡å‡†ï¼Œåœ¨é¡¹ç›®çš„æ›´æ—©æœŸå¯ä»¥ä»¥ä¸€ä¸ªæ›´ä½æˆæœ¬çš„æ–¹å¼å»è§£å†³å·²ç»äº§ç”Ÿæˆ–å¯èƒ½äº§ç”Ÿçš„ç¼ºé™·ï¼Œå‡å°‘å› ä¸ºå‰æœŸé£é™©ä¸å¯æ§è€Œå¯¼è‡´åæœŸçš„ä¿®å¤æˆæœ¬å¢åŠ ï¼Œè¿›è€Œæµªè´¹å¤§é‡èµ„æºã€‚</p><p>ç¬¬ä¸‰ï¼šè´¨é‡æµ‹è¯•å…¨æµç¨‹ä½“ç³»æ¢³ç†ä¸å»ºè®¾ï¼šå§‹ç»ˆåšä¿¡â€œè´¨é‡æ˜¯è®¾è®¡å’Œæ„å»ºå‡ºæ¥çš„ï¼Œè€Œä¸æ˜¯æµ‹è¯•å‡ºæ¥çš„â€ã€‚è´¨é‡å†…éƒ¨çš„ä½“ç³»å»ºè®¾éœ€è¦ä»ç»„ç»‡+æ–‡åŒ–+æ–¹æ³•+å·¥å…·å››ä¸ªç»´åº¦åŒæ—¶è¿›è¡Œï¼Œä»¥æ›´åˆç†çš„æµç¨‹è§„èŒƒæ¥ç»è‚¯å‘¢ä¸ªçš„ä¿è¯ä¸šåŠ¡è¿­ä»£å’Œäººå‘˜æ›´è¿­ä»è€Œå½±å“ç»„ç»‡ï¼Œé•¿æœŸæŒç»­å®£è®²åŠ å®è·µå½¢æˆä»ä¸Šè€Œä¸‹çš„è´¨é‡æ–‡åŒ–ï¼Œé€šè¿‡æµ‹è¯•å·¦ç§»ã€æŒç»­åé¦ˆã€æµ‹è¯•å³ç§»ã€è´¨é‡è·Ÿè¸ªç­‰å…·ä½“çš„å®è·µæ–¹æ³•è½åœ°åˆ°å›¢é˜Ÿä¹‹ä¸­åˆ°å“ªåˆ°å¥½çš„ç»“æœï¼Œå½¢æˆå½±å“åŠ›ï¼Œå†ä¸æ–­æ‰©å¤§èŒƒå›´ç”±ç‚¹åˆ°é¢æœ€ç»ˆå½¢æˆä½“ç³»åŒ–ã€‚é€šè¿‡å„ç§å·¥å…·æˆ–è€…å¹³å°çš„å¼•å…¥ä»è€Œå¤§å¹…æé«˜ç ”å‘è¿‡ç¨‹çš„æ•ˆç‡ã€‚å¦‚CICDã€ç›‘æ§å¹³å°ã€é“¾è·¯è¿½è¸ªã€æ•°æ®å·¥å‚ã€è´¨é‡åº¦é‡ã€è‡ªåŠ¨åŒ–æµ‹è¯•ç­‰å·¥å…·å¹³å°ï¼Œå¸®åŠ©è´¨é‡å†…å»ºæ›´é«˜æ•ˆè½åœ°ã€‚</p><p>åŸºäºä»¥ä¸Šä¸‰ä¸ªç»´åº¦åšå¥½è´¨é‡å†…éƒ¨å»ºè®¾ä½“ç³»ï¼Œæ ¸å¿ƒå››è¦ç‚¹ï¼šå…¨ä½“å¤æ‚ã€æ§åˆ¶é£é™©ã€å…³æ³¨è´¨é‡ã€æé«˜è´¨é‡ã€‚</p><h1 id="å¦‚ä½•æŠŠè‡ªåŠ¨åŒ–åœ¨å…¬å¸å®æ–½å¹¶æ¨å¹¿èµ·æ¥ï¼Ÿ"><a href="#å¦‚ä½•æŠŠè‡ªåŠ¨åŒ–åœ¨å…¬å¸å®æ–½å¹¶æ¨å¹¿èµ·æ¥ï¼Ÿ" class="headerlink" title="å¦‚ä½•æŠŠè‡ªåŠ¨åŒ–åœ¨å…¬å¸å®æ–½å¹¶æ¨å¹¿èµ·æ¥ï¼Ÿ"></a><strong>å¦‚ä½•æŠŠè‡ªåŠ¨åŒ–åœ¨å…¬å¸å®æ–½å¹¶æ¨å¹¿èµ·æ¥ï¼Ÿ</strong></h1><p>åˆ†æï¼šé¡¹äº†è§£è‡ªåŠ¨åŒ–æµ‹è¯•çš„å®æ–½å’Œè½åœ°ï¼Œè€ƒå¯Ÿä½ çš„å‚ä¸åº¦ï¼Œæ˜¯ä¸æ˜¯é¡¹ç›®çš„ä¸»å¯¼äººï¼Œä½ æ˜¯è´Ÿè´£æ•´ä¸ªé¡¹ç›®è¿˜æ˜¯ä¸€ä¸ªç®€å•çš„demo</p><p>1ã€å·¥å…·é€‰é¡¹ï¼Œrequests ã€ selenium appium playwright ç­‰ï¼Œçœ‹ä¸‹ä¸é¡¹ç›®åŒ¹é…ç¨‹åº¦ï¼Œ</p><p>2ã€è‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶çš„æ­å»ºâ€”åŒæ—¶é¡¹ç›®ç»„å†…æˆå‘˜å¯ä»¥å¯¹ç”¨ä¾‹è¡¥å……</p><p>3ã€é¡¹ç›®è‡ªåŠ¨åŒ–å®ç°ï¼Œç”¨èµ·æ¥</p><p>4ã€éƒ¨ç½²æ–‡æ¡£ç¼–å†™ï¼Œä½¿ç”¨æ‰‹å†Œç¼–å†™</p><p>5ã€æœ‰æˆæœåï¼Œå°†æ¡†æ¶æ¨å¹¿åˆ°å…¶ä»–é¡¹ç›®ç»„</p><h1 id=""><a href="#" class="headerlink" title=""></a></h1>]]></content>
    
    
    <categories>
      
      <category>thought</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç¬”è®°</tag>
      
      <tag>æ€è€ƒ</tag>
      
      <tag>è´¨é‡ï¼Œæ‘˜æŠ„</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>python ä¹‹ pytestæ ‡è®°ï¼ˆäº”ï¼‰</title>
    <link href="/2024/01/20/665python-%E4%B9%8B-pytest%E6%A0%87%E8%AE%B0%EF%BC%88%E4%BA%94%EF%BC%89/"/>
    <url>/2024/01/20/665python-%E4%B9%8B-pytest%E6%A0%87%E8%AE%B0%EF%BC%88%E4%BA%94%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="å¦‚ä½•ç”¨å±æ€§æ ‡è®°æµ‹è¯•å‡½æ•°"><a href="#å¦‚ä½•ç”¨å±æ€§æ ‡è®°æµ‹è¯•å‡½æ•°" class="headerlink" title="å¦‚ä½•ç”¨å±æ€§æ ‡è®°æµ‹è¯•å‡½æ•°"></a>å¦‚ä½•ç”¨å±æ€§æ ‡è®°æµ‹è¯•å‡½æ•°</h1><h2 id="ç®€å•ä½¿ç”¨"><a href="#ç®€å•ä½¿ç”¨" class="headerlink" title="ç®€å•ä½¿ç”¨"></a>ç®€å•ä½¿ç”¨</h2><p>é€šè¿‡ä½¿ç”¨<code>pytest.mark</code>å¯ä»¥è½»æ¾åœ°åœ¨æµ‹è¯•å‡½æ•°ä¸Šè®¾ç½®å…ƒæ•°æ®ã€‚å¯ä»¥åœ¨APIå‚è€ƒä¸­æ‰¾åˆ°å†…ç½®æ ‡è®°çš„å®Œæ•´åˆ—è¡¨ã€‚</p><p>æˆ–è€…å¯ä»¥ä½¿ç”¨å‘½ä»¤è¡Œ<code>pytest â€” â€”markers</code>åˆ—å‡ºå†…ç½®çš„å’Œè‡ªå®šä¹‰çš„æ‰€æœ‰æ ‡è®°ï¼Œ</p><p>å†…ç½®æ ‡è®°åŒ…å«ï¼š</p><ul><li><code>usefixtures</code> - ä½¿ç”¨fixuturesçš„æµ‹è¯•ç”¨ä¾‹æˆ–è€…ç±»</li><li><code>filterwarnings</code> è¿‡æ»¤å¸¦è­¦å‘Šçš„æµ‹è¯•å‡½æ•°</li><li><code>skip</code> æµ‹è¯•çš„æ—¶å€™è·³è¿‡è¯¥æµ‹è¯•ç”¨ä¾‹</li><li><code>skipif</code>ï¼šæ ¹æ®æ¡ä»¶è·³è¿‡æµ‹è¯•ã€‚åé¢å¯ä»¥å†™æ¡ä»¶</li><li><code>xfail</code>æ ‡è®°é¢„æœŸå¤±è´¥çš„æµ‹è¯•ç”¨ä¾‹ï¼Œå³ä½¿æµ‹è¯•å¤±è´¥ä¹Ÿä¸ä¼šæŠ¥å‘Šä¸ºé”™è¯¯ã€‚</li><li><code>parametrize</code>ï¼šå‚æ•°åŒ–æµ‹è¯•ï¼Œç”¨äºé€šè¿‡ä¸åŒçš„å‚æ•°è¿è¡ŒåŒä¸€ä¸ªæµ‹è¯•å¤šæ¬¡ã€‚</li><li><code>timeout</code>ï¼šè®¾ç½®æµ‹è¯•çš„æœ€å¤§è¿è¡Œæ—¶é—´ï¼Œè¶…æ—¶å°†ä¸­æ­¢æµ‹è¯•ã€‚</li></ul><p>åˆ›å»ºè‡ªå®šä¹‰æ ‡è®°æˆ–å°†æ ‡è®°åº”ç”¨äºæ•´ä¸ªæµ‹è¯•ç±»æˆ–æ¨¡å—éå¸¸å®¹æ˜“ã€‚è¿™äº›æ ‡è®°å¯ä»¥è¢«æ’ä»¶ä½¿ç”¨ï¼Œä¹Ÿé€šå¸¸ç”¨äºä½¿ç”¨-mé€‰é¡¹åœ¨å‘½ä»¤è¡Œä¸Šé€‰æ‹©æµ‹è¯•ã€‚</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-meta">@pytest.mark.usefixtures</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_function</span>():<br>    <span class="hljs-comment"># æµ‹è¯•ä»£ç </span><br><span class="hljs-meta">@pytest.mark.skip</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_function</span>():<br>    <span class="hljs-comment"># æµ‹è¯•ä»£ç </span><br><span class="hljs-meta">@pytest.mark.skipif(<span class="hljs-params">condition, reason=optional_reason</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_function</span>():<br>    <span class="hljs-comment"># æµ‹è¯•ä»£ç </span><br><span class="hljs-meta">@pytest.mark.xfail</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_function</span>():<br>    <span class="hljs-comment"># æµ‹è¯•ä»£ç </span><br><span class="hljs-meta">@pytest.mark.parametrize(<span class="hljs-params"><span class="hljs-string">&quot;param&quot;</span>, [value1, value2, ...]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_function</span>(<span class="hljs-params">param</span>):<br>    <span class="hljs-comment"># æµ‹è¯•ä»£ç </span><br><span class="hljs-meta">@pytest.mark.timeout(<span class="hljs-params">timeout_value</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_function</span>():<br>    <span class="hljs-comment"># æµ‹è¯•ä»£ç </span><br></code></pre></td></tr></table></figure><p>è¦è¿è¡Œå¸¦æœ‰è‡ªå®šä¹‰æ ‡è®° <code>my_marker</code> çš„æµ‹è¯•é¡¹ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">pytest -m my_marker</span><br></code></pre></td></tr></table></figure><h2 id="æ³¨å†Œæ ‡è®°"><a href="#æ³¨å†Œæ ‡è®°" class="headerlink" title="æ³¨å†Œæ ‡è®°"></a>æ³¨å†Œæ ‡è®°</h2><p>å¯ä»¥åœ¨<code>pytest.ini</code>ä¸­è‡ªå®šä¹‰æ ‡è®°ï¼š</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[pytest]</span><br><span class="hljs-attr">markers</span> =<br>    slow: marks tests as slow (deselect with &#x27;-m &quot;not slow&quot;&#x27;)<br>    serial<br></code></pre></td></tr></table></figure><p>æˆ–è€…åœ¨ <code>pyproject.toml</code> æ–‡ä»¶ä¸­ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼šï¼ˆtomlç±»ä¼¼äºiniæ–‡ä»¶ï¼Œä¹Ÿæ˜¯ä¸€ç§å­˜å‚¨é…ç½®æ–‡ä»¶çš„æ–¹å¼ï¼‰</p><figure class="highlight toml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs toml"><span class="hljs-section">[tool.pytest.ini_options]</span><br><span class="hljs-attr">markers</span> = [<br>    <span class="hljs-string">&quot;slow: marks tests as slow (deselect with &#x27;-m \&quot;not slow\&quot;&#x27;)&quot;</span>,<br>    <span class="hljs-string">&quot;serial&quot;</span>,<br>]<br></code></pre></td></tr></table></figure><p>æˆ–è€…å¯ä»¥åœ¨pytesté’©å­é‡Œé¢æ³¨å†Œæ ‡è®°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">pytest_configure</span>(<span class="hljs-params">config</span>):<br>    config.addinivalue_line(<br>        <span class="hljs-string">&quot;markers&quot;</span>, <span class="hljs-string">&quot;env(name): mark test to run only on named environment&quot;</span><br>    )<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç¬”è®°</tag>
      
      <tag>pytest</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>python ä¹‹ pytest ä½¿ç”¨å‚æ•°åŒ–å¤¹å…·æµ‹è¯•ï¼ˆå…­ï¼‰</title>
    <link href="/2024/01/20/666python-%E4%B9%8B-pytest-%E4%BD%BF%E7%94%A8%E5%8F%82%E6%95%B0%E5%8C%96%E5%A4%B9%E5%85%B7%E6%B5%8B%E8%AF%95%EF%BC%88%E5%85%AD%EF%BC%89/"/>
    <url>/2024/01/20/666python-%E4%B9%8B-pytest-%E4%BD%BF%E7%94%A8%E5%8F%82%E6%95%B0%E5%8C%96%E5%A4%B9%E5%85%B7%E6%B5%8B%E8%AF%95%EF%BC%88%E5%85%AD%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="å¦‚ä½•ä½¿ç”¨å‚æ•°åŒ–å¤¹å…·æµ‹è¯•"><a href="#å¦‚ä½•ä½¿ç”¨å‚æ•°åŒ–å¤¹å…·æµ‹è¯•" class="headerlink" title="å¦‚ä½•ä½¿ç”¨å‚æ•°åŒ–å¤¹å…·æµ‹è¯•"></a>å¦‚ä½•ä½¿ç”¨å‚æ•°åŒ–å¤¹å…·æµ‹è¯•</h1><p>pytest æ”¯æŒå¤šä¸ªçº§åˆ«çš„æµ‹è¯•å‚æ•°åŒ–ï¼š</p><ul><li>pytest.fixture() å…è®¸å¯¹å¤¹å…·å‡½æ•°è¿›è¡Œå‚æ•°åŒ–ã€‚</li><li>@pytest.mark.parametrize å…è®¸åœ¨æµ‹è¯•å‡½æ•°æˆ–ç±»ä¸­å®šä¹‰å¤šç»„å‚æ•°å’Œfixtureã€‚</li><li>pytest_generate_tests å…è®¸å®šä¹‰è‡ªå®šä¹‰å‚æ•°åŒ–æ–¹æ¡ˆæˆ–æ‰©å±•ã€‚</li></ul><h2 id="å‚æ•°åŒ–æµ‹è¯•æ–¹æ³•ï¼š-pytest-mark-parametrize"><a href="#å‚æ•°åŒ–æµ‹è¯•æ–¹æ³•ï¼š-pytest-mark-parametrize" class="headerlink" title="å‚æ•°åŒ–æµ‹è¯•æ–¹æ³•ï¼š@pytest.mark.parametrize"></a>å‚æ•°åŒ–æµ‹è¯•æ–¹æ³•ï¼š<code>@pytest.mark.parametrize</code></h2><p>å†…ç½®çš„ pytest.mark.parametrize è£…é¥°å™¨å¯ä»¥å¯¹æµ‹è¯•å‡½æ•°çš„å‚æ•°è¿›è¡Œå‚æ•°åŒ–ã€‚ä»¥ä¸‹æ˜¯æµ‹è¯•å‡½æ•°çš„å…¸å‹ç¤ºä¾‹ï¼Œè¯¥å‡½æ•°å®ç°æ£€æŸ¥ç‰¹å®šè¾“å…¥æ˜¯å¦ä¼šäº§ç”Ÿé¢„æœŸè¾“å‡ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># content of test_expectation.py</span><br><span class="hljs-keyword">import</span> pytest<br><br><br><span class="hljs-meta">@pytest.mark.parametrize(<span class="hljs-params"><span class="hljs-string">&quot;test_input,expected&quot;</span>, [(<span class="hljs-params"><span class="hljs-string">&quot;3+5&quot;</span>, <span class="hljs-number">8</span></span>), (<span class="hljs-params"><span class="hljs-string">&quot;2+4&quot;</span>, <span class="hljs-number">6</span></span>), (<span class="hljs-params"><span class="hljs-string">&quot;6*9&quot;</span>, <span class="hljs-number">42</span></span>)]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_eval</span>(<span class="hljs-params">test_input, expected</span>):<br>    <span class="hljs-keyword">assert</span> <span class="hljs-built_in">eval</span>(test_input) == expected<br><span class="hljs-comment"># ç”¨åˆ—è¡¨ åˆ—è¡¨å†…çš„å…ƒç´ æ˜¯è¦ä¼ é€’ç»™å‰é¢çš„æ–¹æ³•åç§°çš„ï¼Œ</span><br><span class="hljs-comment"># å¦‚æœæ˜¯å¤šä¸ªæ–¹æ³•ï¼Œåˆ—è¡¨å†…çš„å…ƒç´ å°±æ˜¯å…ƒç»„ï¼Œä¸€ç»„å…ƒç´ è¡¨ç¤ºä¸€æ¬¡å‚æ•°åŒ–</span><br><span class="hljs-comment"># è¿™é‡Œï¼Œ @parametrize è£…é¥°å™¨å®šä¹‰äº†ä¸‰ä¸ªä¸åŒçš„ (test_input,expected) å…ƒç»„å…ƒç´ å…¥å‚ï¼Œä»¥ä¾¿ test_evalæµ‹è¯•å‡½æ•°å°†ä¾æ¬¡ä½¿ç”¨å®ƒä»¬è¿è¡Œä¸‰æ¬¡ï¼š</span><br>=================================== FAILURES ===================================<br>______________________________ test_eval[<span class="hljs-number">6</span>*<span class="hljs-number">9</span>-<span class="hljs-number">42</span>] _______________________________<br><br>test_input = <span class="hljs-string">&#x27;6*9&#x27;</span>, expected = <span class="hljs-number">42</span><br><br><span class="hljs-meta">    @pytest.mark.parametrize(<span class="hljs-params"><span class="hljs-string">&quot;test_input,expected&quot;</span>, [(<span class="hljs-params"><span class="hljs-string">&quot;3+5&quot;</span>, <span class="hljs-number">8</span></span>), (<span class="hljs-params"><span class="hljs-string">&quot;2+4&quot;</span>, <span class="hljs-number">6</span></span>), (<span class="hljs-params"><span class="hljs-string">&quot;6*9&quot;</span>, <span class="hljs-number">42</span></span>)]</span>)</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_eval</span>(<span class="hljs-params">test_input, expected</span>):<br>&gt;       <span class="hljs-keyword">assert</span> <span class="hljs-built_in">eval</span>(test_input) == expected<br>E       AssertionError: <span class="hljs-keyword">assert</span> <span class="hljs-number">54</span> == <span class="hljs-number">42</span> <span class="hljs-comment"># é”™è¯¯</span><br>E        +  where <span class="hljs-number">54</span> = <span class="hljs-built_in">eval</span>(<span class="hljs-string">&#x27;6*9&#x27;</span>)<br><br>testcases/test_parametrize_case.py:<span class="hljs-number">6</span>: AssertionError<br>=========================== short test summary info ============================<br>FAILED testcases/test_parametrize_case.py::test_eval[<span class="hljs-number">6</span>*<span class="hljs-number">9</span>-<span class="hljs-number">42</span>] - AssertionError...<br>========================= <span class="hljs-number">1</span> failed, <span class="hljs-number">2</span> passed <span class="hljs-keyword">in</span> <span class="hljs-number">0.01</span>s ==========================<br></code></pre></td></tr></table></figure><blockquote><p>å‚æ•°å€¼æŒ‰åŸæ ·ä¼ é€’ç»™æµ‹è¯•ï¼ˆæ²¡æœ‰ä»»ä½•å‰¯æœ¬ï¼‰ã€‚â€”-&gt; å¼•ç”¨ä¼ é€’ å‡½æ•°æ¥æ”¶çš„æ˜¯å‚æ•°çš„å¼•ç”¨æˆ–æŒ‡é’ˆï¼Œå³å‡½æ•°å†…éƒ¨æ“ä½œçš„æ˜¯å‚æ•°çš„å¼•ç”¨ï¼Œå¯¹å‚æ•°çš„ä¿®æ”¹ä¼šå½±å“åˆ°åŸå§‹å¯¹è±¡ã€‚</p><p> ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨ä¼ é€’ä¸€ä¸ªåˆ—è¡¨æˆ–å­—å…¸ä½œä¸ºå‚æ•°å€¼ï¼Œå¹¶ä¸”æµ‹è¯•ç”¨ä¾‹ä»£ç å¯¹å…¶è¿›è¡Œå˜æ›´ï¼Œåˆ™è¿™äº›å˜æ›´å°†åæ˜ åœ¨åç»­æµ‹è¯•ç”¨ä¾‹è°ƒç”¨ä¸­ã€‚</p></blockquote><blockquote><p>pytest é»˜è®¤æƒ…å†µä¸‹ä¼šå¯¹ unicode å­—ç¬¦ä¸²ä¸­ä½¿ç”¨çš„ä»»ä½•é ascii å­—ç¬¦è¿›è¡Œè½¬ä¹‰ä»¥è¿›è¡Œå‚æ•°åŒ–ï¼Œå› ä¸ºå®ƒæœ‰å‡ ä¸ªç¼ºç‚¹ã€‚ä½†æ˜¯ï¼Œå¦‚æœæ‚¨æƒ³åœ¨å‚æ•°åŒ–ä¸­ä½¿ç”¨ unicode å­—ç¬¦ä¸²å¹¶æŒ‰åŸæ ·åœ¨ç»ˆç«¯ä¸­æŸ¥çœ‹å®ƒä»¬ï¼ˆéè½¬ä¹‰ï¼‰ï¼Œè¯·åœ¨ pytest.ini ä¸­ä½¿ç”¨æ­¤é€‰é¡¹ï¼š</p></blockquote><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[pytest]</span><br><span class="hljs-attr">disable_test_id_escaping_and_forfeit_all_rights_to_community_support</span> = <span class="hljs-literal">True</span><br><span class="hljs-comment"># ä½†è¯·è®°ä½ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´ä¸å¿…è¦çš„å‰¯ä½œç”¨ç”šè‡³é”™è¯¯ï¼Œå…·ä½“å–å†³äºæ‰€ä½¿ç”¨çš„æ“ä½œç³»ç»Ÿå’Œå½“å‰å®‰è£…çš„æ’ä»¶ï¼Œ</span><br></code></pre></td></tr></table></figure><p>æ­£å¦‚æœ¬ç¤ºä¾‹ä¸­æ‰€è®¾è®¡çš„ï¼Œåªæœ‰ä¸€ç»„è¾“å…¥&#x2F;è¾“å‡ºå€¼æœªé€šè¿‡ åŠŸèƒ½æµ‹è¯•ã€‚ä¸æµ‹è¯•å‡½æ•°å‚æ•°ä¸€æ ·ï¼Œå¯ä»¥åœ¨å›æº¯ä¸­çœ‹åˆ°è¾“å…¥å’Œè¾“å‡ºå€¼ã€‚</p><p>è¿˜å¯ä»¥åœ¨ç±»æˆ–æ¨¡å—ä¸Šä½¿ç”¨<code>mark.parametrize</code>æ ‡è®°ï¼Œç±»å†…çš„æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹éƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ªå‚æ•°åŒ–ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pytest<br><br><br><span class="hljs-meta">@pytest.mark.parametrize(<span class="hljs-params"><span class="hljs-string">&quot;n,expected&quot;</span>, [(<span class="hljs-params"><span class="hljs-number">1</span>, <span class="hljs-number">2</span></span>), (<span class="hljs-params"><span class="hljs-number">3</span>, <span class="hljs-number">4</span></span>)]</span>)</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestClass</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_simple_case</span>(<span class="hljs-params">self, n, expected</span>):<br>        <span class="hljs-keyword">assert</span> n + <span class="hljs-number">1</span> == expected<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_weird_simple_case</span>(<span class="hljs-params">self, n, expected</span>):<br>        <span class="hljs-keyword">assert</span> (n * <span class="hljs-number">1</span>) + <span class="hljs-number">1</span> == expected<br></code></pre></td></tr></table></figure><p>è¦ä½¿å‚æ•°åŒ–ä½œç”¨åœ¨è¯¥æ¨¡å—ï¼ˆ.pyæ–‡ä»¶ï¼‰ä¸­çš„æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ª<code>pytestmark</code> å…¨å±€å˜é‡å»æ¥æ”¶è¿™ä¸ªå‚æ•°åŒ–ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pytest<br><br>pytestmark = pytest.mark.parametrize(<span class="hljs-string">&quot;n,expected&quot;</span>, [(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>), (<span class="hljs-number">3</span>, <span class="hljs-number">4</span>)]) <span class="hljs-comment"># ä½¿ç”¨pytestmarkæ¥æ”¶</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestClass</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_simple_case</span>(<span class="hljs-params">self, n, expected</span>):<br>        <span class="hljs-keyword">assert</span> n + <span class="hljs-number">1</span> == expected<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_weird_simple_case</span>(<span class="hljs-params">self, n, expected</span>):<br>        <span class="hljs-keyword">assert</span> (n * <span class="hljs-number">1</span>) + <span class="hljs-number">1</span> == expected<br></code></pre></td></tr></table></figure><p>è¿˜å¯ä»¥åœ¨å‚æ•°åŒ–ä¸­æ ‡è®°å•ä¸ªæµ‹è¯•å®ä¾‹ï¼Œä¾‹å¦‚ä½¿ç”¨å†…ç½®çš„ mark.xfailï¼š(å¯èƒ½é”™è¯¯æ ‡è®°)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># content of test_expectation.py</span><br><span class="hljs-keyword">import</span> pytest<br><br><br><span class="hljs-meta">@pytest.mark.parametrize(<span class="hljs-params"></span></span><br><span class="hljs-params"><span class="hljs-meta">    <span class="hljs-string">&quot;test_input,expected&quot;</span>,</span></span><br><span class="hljs-params"><span class="hljs-meta">    [(<span class="hljs-params"><span class="hljs-string">&quot;3+5&quot;</span>, <span class="hljs-number">8</span></span>), (<span class="hljs-params"><span class="hljs-string">&quot;2+4&quot;</span>, <span class="hljs-number">6</span></span>), pytest.param(<span class="hljs-params"><span class="hljs-string">&quot;6*9&quot;</span>, <span class="hljs-number">42</span>, marks=pytest.mark.xfail</span>)],</span></span><br><span class="hljs-params"><span class="hljs-meta"></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_eval</span>(<span class="hljs-params">test_input, expected</span>):<br>    <span class="hljs-keyword">assert</span> <span class="hljs-built_in">eval</span>(test_input) == expected<br>    <br><span class="hljs-comment"># è¿è¡Œç»“æœ========================</span><br>============================= test session starts ==============================<br>configfile: pytest.ini<br>plugins: anyio-<span class="hljs-number">4.2</span><span class="hljs-number">.0</span><br>collecting ... collected <span class="hljs-number">3</span> items<br><br>testcases/test_parametrize_case.py::test_eval[<span class="hljs-number">6</span>*<span class="hljs-number">9</span>-<span class="hljs-number">42</span>] XFAIL <span class="hljs-comment"># é”™è¯¯æ ‡è®°</span><br>testcases/test_parametrize_case.py::test_eval[<span class="hljs-number">2</span>+<span class="hljs-number">4</span>-<span class="hljs-number">6</span>] PASSED<br>testcases/test_parametrize_case.py::test_eval[<span class="hljs-number">3</span>+<span class="hljs-number">5</span>-<span class="hljs-number">8</span>] PASSED<br><br>========================= <span class="hljs-number">2</span> passed, <span class="hljs-number">1</span> xfailed <span class="hljs-keyword">in</span> <span class="hljs-number">0.01</span>s =========================<br></code></pre></td></tr></table></figure><p>ä¹‹å‰å¯¼è‡´å¤±è´¥çš„ä¸€ä¸ªå‚æ•°é›†ç°åœ¨æ˜¾ç¤ºä¸ºâ€œxfailedâ€ï¼ˆé¢„æœŸå¤±è´¥ï¼‰æµ‹è¯•ã€‚</p><p>å¦‚æœæä¾›ç»™å‚æ•°åŒ–çš„å€¼å¯¼è‡´ç©ºåˆ—è¡¨ - ä¾‹å¦‚ï¼Œå¦‚æœå®ƒä»¬æ˜¯ç”±æŸä¸ªå‡½æ•°åŠ¨æ€ç”Ÿæˆçš„ - pytest çš„è¡Œä¸ºç”±empty_parameter_set_mark é€‰é¡¹å®šä¹‰ã€‚</p><p>è¦è·å–å¤šä¸ªå‚æ•°åŒ–å‚æ•°çš„æ‰€æœ‰ç»„åˆï¼Œå¯ä»¥å †å ä½¿ç”¨å‚æ•°åŒ–è£…é¥°å™¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@pytest.mark.parametrize(<span class="hljs-params"><span class="hljs-string">&quot;x&quot;</span>, [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>]</span>)</span><br><span class="hljs-meta">@pytest.mark.parametrize(<span class="hljs-params"><span class="hljs-string">&quot;y&quot;</span>, [<span class="hljs-number">2</span>, <span class="hljs-number">3</span>]</span>) </span><span class="hljs-comment"># å…ˆä»è¿™ä¸ªçš„æœ€å³è¾¹çš„å¼€å§‹è¿è¡Œ</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_foo</span>(<span class="hljs-params">x, y</span>):<br>    <span class="hljs-keyword">pass</span><br><span class="hljs-comment"># æµ‹è¯•ç»“æœï¼š</span><br><span class="hljs-comment"># è¿è¡Œæµ‹è¯•ï¼Œå‚æ•°è®¾ç½®ä¸º x=0/y=2ã€x=1/y=2ã€x=0/y=3 å’Œ x=1/y=3ï¼ŒæŒ‰ç…§è£…é¥°å™¨çš„é¡ºåºå¼€å§‹å‚æ•°ã€‚</span><br>============================= test session starts ==============================<br>plugins: anyio-<span class="hljs-number">4.2</span><span class="hljs-number">.0</span><br>collecting ... collected <span class="hljs-number">4</span> items<br><br>testcases/test_parametrize_case.py::test_foo[<span class="hljs-number">3</span>-<span class="hljs-number">0</span>] x=<span class="hljs-number">0</span>, y=<span class="hljs-number">3</span> <span class="hljs-comment"># å…ˆä»ç¬¬äºŒä¸ªçš„æœ€å³è¾¹çš„å¼€å§‹è¿è¡Œ</span><br>PASSED<br>testcases/test_parametrize_case.py::test_foo[<span class="hljs-number">3</span>-<span class="hljs-number">1</span>] x=<span class="hljs-number">1</span>, y=<span class="hljs-number">3</span><br>PASSED<br>testcases/test_parametrize_case.py::test_foo[<span class="hljs-number">2</span>-<span class="hljs-number">1</span>] x=<span class="hljs-number">1</span>, y=<span class="hljs-number">2</span><br>PASSED<br>testcases/test_parametrize_case.py::test_foo[<span class="hljs-number">2</span>-<span class="hljs-number">0</span>] x=<span class="hljs-number">0</span>, y=<span class="hljs-number">2</span> <span class="hljs-comment"># æœ€åå†è¿è¡Œç¬¬ä¸€ä¸ªçš„æœ€å·¦è¾¹çš„</span><br>PASSED<br><br>============================== <span class="hljs-number">4</span> passed <span class="hljs-keyword">in</span> <span class="hljs-number">0.01</span>s ===========<br><br></code></pre></td></tr></table></figure><h2 id="åŸºæœ¬-pytest-generate-tests-ç¤ºä¾‹"><a href="#åŸºæœ¬-pytest-generate-tests-ç¤ºä¾‹" class="headerlink" title="åŸºæœ¬ pytest_generate_tests ç¤ºä¾‹"></a>åŸºæœ¬ pytest_generate_tests ç¤ºä¾‹</h2><p>æœ‰æ—¶ï¼Œæ‚¨å¯èƒ½å¸Œæœ›å®ç°è‡ªå·±çš„å‚æ•°åŒ–æ–¹æ¡ˆæˆ–å®ç°ä¸€äº›åŠ¨æ€æ¥ç¡®å®šå¤¹å…·çš„å‚æ•°æˆ–èŒƒå›´ã€‚ä¸ºæ­¤ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨pytest_generate_testsé’©å­ï¼Œè¯¥é’©å­åœ¨æ”¶é›†æµ‹è¯•å‡½æ•°æ—¶è¢«è°ƒç”¨ã€‚é€šè¿‡ä¼ å…¥çš„metafuncå¯¹è±¡ï¼Œæ‚¨å¯ä»¥æ£€æŸ¥è¯·æ±‚æµ‹è¯•ä¸Šä¸‹æ–‡ï¼Œæœ€é‡è¦çš„æ˜¯ï¼Œæ‚¨å¯ä»¥è°ƒç”¨metafunc. parameterize()æ¥è¿›è¡Œå‚æ•°åŒ–ã€‚</p><p>ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æƒ³è¦è¿è¡Œä¸€ä¸ªæµ‹è¯•ï¼Œè·å–æˆ‘ä»¬æƒ³è¦é€šè¿‡æ–°çš„ pytest å‘½ä»¤è¡Œé€‰é¡¹è®¾ç½®çš„å­—ç¬¦ä¸²è¾“å…¥ã€‚è®©æˆ‘ä»¬é¦–å…ˆç¼–å†™ä¸€ä¸ªæ¥å—å­—ç¬¦ä¸²è¾“å…¥å›ºå®šå‡½æ•°å‚æ•°çš„ç®€å•æµ‹è¯•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># content of test_strings.py</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_valid_string</span>(<span class="hljs-params">stringinput</span>):<br>    <span class="hljs-keyword">assert</span> stringinput.isalpha() <span class="hljs-comment"># ä»¥å­—æ¯å¼€å¤´</span><br></code></pre></td></tr></table></figure><p>ç„¶ååœ¨conftest.py æ–‡ä»¶ä¸­æ·»åŠ ï¼Œå…¶ä¸­åŒ…å«å‘½ä»¤è¡Œé€‰é¡¹å’Œæµ‹è¯•å‡½æ•°çš„å‚æ•°åŒ–ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># content of conftest.py</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">pytest_addoption</span>(<span class="hljs-params">parser</span>):<br>    parser.addoption(<br>        <span class="hljs-string">&quot;--stringinput&quot;</span>,<br>        action=<span class="hljs-string">&quot;append&quot;</span>,<br>        default=[],<br>        <span class="hljs-built_in">help</span>=<span class="hljs-string">&quot;list of stringinputs to pass to test functions&quot;</span>,<br>    )<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">pytest_generate_tests</span>(<span class="hljs-params">metafunc</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;stringinput&quot;</span> <span class="hljs-keyword">in</span> metafunc.fixturenames:<br>        metafunc.parametrize(<span class="hljs-string">&quot;stringinput&quot;</span>, metafunc.config.getoption(<span class="hljs-string">&quot;stringinput&quot;</span>))<br></code></pre></td></tr></table></figure><p>å¦‚æœæˆ‘ä»¬ç°åœ¨ä¼ é€’ä¸¤ä¸ªå­—ç¬¦ä¸²è¾“å…¥å€¼ï¼Œæˆ‘ä»¬çš„æµ‹è¯•å°†è¿è¡Œä¸¤æ¬¡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">$ pytest -q --stringinput=<span class="hljs-string">&quot;hello&quot;</span> --stringinput=<span class="hljs-string">&quot;world&quot;</span> test_strings.py<br>..                                                                   [<span class="hljs-number">100</span>%]<br><span class="hljs-number">2</span> passed <span class="hljs-keyword">in</span> <span class="hljs-number">0.12</span>s<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬è¿˜ä½¿ç”¨ä¸€ä¸ªå­—ç¬¦ä¸²è¾“å…¥æ¥è¿è¡Œï¼Œè¿™å°†å¯¼è‡´æµ‹è¯•å¤±è´¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python">$ pytest -q --stringinput=<span class="hljs-string">&quot;!&quot;</span> test_strings.py <span class="hljs-comment"># stringinput=ï¼</span><br>F                                                                    [<span class="hljs-number">100</span>%]<br>================================= FAILURES =================================<br>___________________________ test_valid_string[!] ___________________________<br><br>stringinput = <span class="hljs-string">&#x27;!&#x27;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_valid_string</span>(<span class="hljs-params">stringinput</span>):<br>&gt;       <span class="hljs-keyword">assert</span> stringinput.isalpha()<br>E       AssertionError: <span class="hljs-keyword">assert</span> <span class="hljs-literal">False</span><br>E        +  where <span class="hljs-literal">False</span> = &lt;built-<span class="hljs-keyword">in</span> method isalpha of <span class="hljs-built_in">str</span> <span class="hljs-built_in">object</span> at <span class="hljs-number">0xdeadbeef0001</span>&gt;()<br>E        +    where &lt;built-<span class="hljs-keyword">in</span> method isalpha of <span class="hljs-built_in">str</span> <span class="hljs-built_in">object</span> at <span class="hljs-number">0xdeadbeef0001</span>&gt; = <span class="hljs-string">&#x27;!&#x27;</span>.isalpha <span class="hljs-comment"># ! ä¸æ˜¯å­—æ¯å¼€å¤´</span><br><br>test_strings.py:<span class="hljs-number">4</span>: AssertionError<br>========================= short test summary info ==========================<br>FAILED test_strings.py::test_valid_string[!] - AssertionError: <span class="hljs-keyword">assert</span> <span class="hljs-literal">False</span><br><span class="hljs-number">1</span> failed <span class="hljs-keyword">in</span> <span class="hljs-number">0.12</span>s<br></code></pre></td></tr></table></figure><p>å¦‚æœä¸æŒ‡å®šå­—ç¬¦ä¸²è¾“å…¥ï¼Œå®ƒå°†è¢«è·³è¿‡ï¼Œå› ä¸ºå°†ä½¿ç”¨ç©ºå‚æ•°åˆ—è¡¨è°ƒç”¨metafunc.parametrize()ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">$ pytest -q -rs test_strings.py<br>s                                                                    [<span class="hljs-number">100</span>%]<br>========================= short test summary info ==========================<br>SKIPPED [<span class="hljs-number">1</span>] test_strings.py: got empty parameter <span class="hljs-built_in">set</span> [<span class="hljs-string">&#x27;stringinput&#x27;</span>], function test_valid_string at /home/sweet/project/test_strings.py:<span class="hljs-number">2</span><br><span class="hljs-number">1</span> skipped <span class="hljs-keyword">in</span> <span class="hljs-number">0.12</span>s <span class="hljs-comment"># æç¤ºè¢«è·³è¿‡</span><br></code></pre></td></tr></table></figure><blockquote><p>è¯·æ³¨æ„ï¼Œå½“ä½¿ç”¨ä¸åŒçš„å‚æ•°é›†å¤šæ¬¡è°ƒç”¨metafunc.parametrizeæ—¶ï¼Œè¿™äº›é›†ä¸­çš„æ‰€æœ‰å‚æ•°åç§°ä¸èƒ½é‡å¤ï¼Œå¦åˆ™ä¼šå¼•å‘é”™è¯¯ã€‚</p></blockquote><p>æ›´å¤šç¤ºä¾‹</p><p>å¯¹äºæ›´å¤šç¤ºä¾‹ å¯ä»¥æŸ¥çœ‹æ›´å¤šå‚æ•°åŒ–ç¤ºä¾‹ <a href="https://docs.pytest.org/en/8.0.x/example/parametrize.html#paramexamples">more parametrization examples</a> </p>]]></content>
    
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç¬”è®°</tag>
      
      <tag>pytest</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€pythonã€‘ä¹‹pytestä½¿ç”¨æŒ‡å—å¿«é€Ÿå…¥é—¨(ä¸€)</title>
    <link href="/2024/01/20/661python%E4%B9%8Bpytest%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97-%E4%B8%80/"/>
    <url>/2024/01/20/661python%E4%B9%8Bpytest%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97-%E4%B8%80/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€-ä»‹ç»"><a href="#ä¸€-ä»‹ç»" class="headerlink" title="ä¸€ ä»‹ç»"></a>ä¸€ ä»‹ç»</h1><p>The pytest framework makes it easy to write small, readable tests, and can scale to support complex functional testing for applications and libraries.</p><p><code>pytest</code>æ¡†æ¶å¯ä»¥è½»æ¾ç¼–å†™å°å‹ã€å¯è¯»çš„æµ‹è¯•ï¼Œå¹¶ä¸”å¯ä»¥æ‰©å±•ä»¥æ”¯æŒåº”ç”¨ç¨‹åºå’Œåº“çš„å¤æ‚åŠŸèƒ½æµ‹è¯•ã€‚</p><p>ç»“æ„ç®€å•ã€å¯ä¼¸ç¼©ã€å®¹æ˜“ä½¿ç”¨ã€æµ‹è¯•å…·æœ‰è¡¨è¾¾æ€§å’Œå¯è¯»æ€§ï¼Œ</p><p>ä¸éœ€è¦æ ·æ¿ä»£ç ï¼Œå¿«é€Ÿå¼€å§‹å¯¹åº”ç”¨ç¨‹åºæˆ–åº“è¿›è¡Œå°çš„å•å…ƒæµ‹è¯•æˆ–å¤æ‚çš„åŠŸèƒ½æµ‹è¯•</p><h1 id="1-å®‰è£…å’Œå…¥é—¨"><a href="#1-å®‰è£…å’Œå…¥é—¨" class="headerlink" title="1 å®‰è£…å’Œå…¥é—¨"></a>1 å®‰è£…å’Œå…¥é—¨</h1><h2 id="1-1-å®‰è£…"><a href="#1-1-å®‰è£…" class="headerlink" title="1.1 å®‰è£…"></a>1.1 å®‰è£…</h2><ol><li>åœ¨å‘½ä»¤è¡Œä¸­è¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install -U pytest<br></code></pre></td></tr></table></figure><ol start="2"><li>æ£€æŸ¥æ˜¯å¦å®‰è£…äº†æ­£ç¡®çš„ç‰ˆæœ¬ï¼š</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$ </span><span class="language-bash">pytest --version</span><br>pytest 6.2.1<br></code></pre></td></tr></table></figure><h2 id="1-2-åˆ›å»ºç¬¬ä¸€ä¸ªæµ‹è¯•"><a href="#1-2-åˆ›å»ºç¬¬ä¸€ä¸ªæµ‹è¯•" class="headerlink" title="1.2 åˆ›å»ºç¬¬ä¸€ä¸ªæµ‹è¯•"></a>1.2 åˆ›å»ºç¬¬ä¸€ä¸ªæµ‹è¯•</h2><p>ç”¨å››è¡Œä»£ç åˆ›å»ºä¸€ä¸ªç®€å•çš„æµ‹è¯•å‡½æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># content of test_sample.py</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">func</span>(<span class="hljs-params">x</span>):<br>    <span class="hljs-keyword">return</span> x + <span class="hljs-number">1</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_answer</span>():<br>    <span class="hljs-keyword">assert</span> func(<span class="hljs-number">3</span>) == <span class="hljs-number">5</span><br></code></pre></td></tr></table></figure><p>å°±æ˜¯è¿™æ ·ã€‚ç°åœ¨å¯ä»¥æ‰§è¡Œæµ‹è¯•åŠŸèƒ½</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python">$ pytest<br>=========================== test session starts ============================<br>platform linux -- Python <span class="hljs-number">3.</span>x.y, pytest-<span class="hljs-number">6.</span>x.y, py-<span class="hljs-number">1.</span>x.y, pluggy-<span class="hljs-number">0.</span>x.y<br>cachedir: $PYTHON_PREFIX/.pytest_cache<br>rootdir: $REGENDOC_TMPDIR<br>collected <span class="hljs-number">1</span> item<br><br>test_sample.py F                                                     [<span class="hljs-number">100</span>%]<br><br>================================= FAILURES =================================<br>_______________________________ test_answer ________________________________<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_answer</span>():<br>&gt;       <span class="hljs-keyword">assert</span> func(<span class="hljs-number">3</span>) == <span class="hljs-number">5</span><br>E       <span class="hljs-keyword">assert</span> <span class="hljs-number">4</span> == <span class="hljs-number">5</span><br>E        +  where <span class="hljs-number">4</span> = func(<span class="hljs-number">3</span>)<br><br>test_sample.py:<span class="hljs-number">6</span>: AssertionError<br>========================= short test summary info ==========================<br>FAILED test_sample.py::test_answer - <span class="hljs-keyword">assert</span> <span class="hljs-number">4</span> == <span class="hljs-number">5</span><br>============================ <span class="hljs-number">1</span> failed <span class="hljs-keyword">in</span> <span class="hljs-number">0.12</span>s =============================<br></code></pre></td></tr></table></figure><p>è¿™é‡Œçš„<code> [100%]</code>æŒ‡çš„æ˜¯è¿è¡Œæ‰€æœ‰æµ‹è¯•ç”¨ä¾‹çš„æ€»ä½“è¿›åº¦ã€‚å®Œæˆåï¼Œpytest ä¼šæ˜¾ç¤ºä¸€ä¸ªå°å°çš„å¤±è´¥æŠ¥å‘Šï¼Œå› ä¸º<code>func(3)</code>çš„è¿”å›å€¼ä¸æ˜¯<code>5</code></p><h2 id="1-2-è¿è¡Œå¤šä¸ªæµ‹è¯•"><a href="#1-2-è¿è¡Œå¤šä¸ªæµ‹è¯•" class="headerlink" title="1.2 è¿è¡Œå¤šä¸ªæµ‹è¯•"></a>1.2 è¿è¡Œå¤šä¸ªæµ‹è¯•</h2><p><code>pytest</code> will run all files of the form test_*.py or *_test.py in the current directory and its subdirectories. More generally, it follows <a href="https://docs.pytest.org/en/8.0.x/explanation/goodpractices.html#test-discovery">standard test discovery rules</a>.</p><p>pytest å°†è¿è¡Œå½“å‰ç›®å½•åŠå…¶å­ç›®å½•ä¸­ test_*.py æˆ– *_test.py å½¢å¼çš„æ‰€æœ‰æ–‡ä»¶ã€‚æ›´ä¸€èˆ¬åœ°è¯´ï¼Œå®ƒéµå¾ªæ ‡å‡†<code>æµ‹è¯•å‘ç°è§„åˆ™</code>ã€‚</p><blockquote><p>Pythonæµ‹è¯•å‘ç°çš„çº¦å®š</p><p>Pytestå®ç°äº†ä»¥ä¸‹æ ‡å‡†æµ‹è¯•å‘ç°:</p><ul><li><p>å¦‚æœæ²¡æœ‰æŒ‡å®šå‚æ•°ï¼Œåˆ™ä»testpaths(å¦‚æœé…ç½®äº†)æˆ–å½“å‰ç›®å½•å¼€å§‹æ”¶é›†ã€‚æˆ–è€…ï¼Œå‘½ä»¤è¡Œå‚æ•°å¯ä»¥åœ¨ç›®å½•ã€æ–‡ä»¶åæˆ–èŠ‚ç‚¹idçš„ä»»æ„ç»„åˆä¸­ä½¿ç”¨ã€‚</p></li><li><p>é€’å½’åˆ°ç›®å½•ä¸­ï¼Œé™¤éå®ƒä»¬åŒ¹é…norecursedirsã€‚</p></li><li><p>åœ¨è¿™äº›ç›®å½•ä¸­ï¼Œæœç´¢test_*.pyæˆ–*_test.pyæ–‡ä»¶ï¼Œé€šè¿‡å®ƒä»¬çš„æµ‹è¯•åŒ…åå¯¼å…¥ã€‚</p></li><li><p>ä»è¿™äº›æ–‡ä»¶ä¸­ï¼Œæ”¶é›†æµ‹è¯•é¡¹ç›®:</p><ul><li><p>åœ¨ç±»ä¹‹å¤–æ·»åŠ Testå‰ç¼€çš„æµ‹è¯•å‡½æ•°æˆ–æ–¹æ³•ã€‚</p></li><li><p>testå‰ç¼€æµ‹è¯•å‡½æ•°æˆ–æ–¹æ³•åœ¨testå‰ç¼€æµ‹è¯•ç±»ä¸­(ä¸å¸¦__init__æ–¹æ³•)ã€‚è¿˜è€ƒè™‘äº†ç”¨@staticmethodå’Œ@classmethodsè£…é¥°çš„æ–¹æ³•ã€‚</p></li></ul></li></ul><p>ä¾‹å¦‚ï¼Œå¦‚ä½•è‡ªå®šä¹‰æ‚¨çš„æµ‹è¯•å‘ç°æ›´æ”¹æ ‡å‡†(Python)æµ‹è¯•å‘ç°ã€‚</p><p>åœ¨Pythonæ¨¡å—ä¸­ï¼Œpytestè¿˜ä½¿ç”¨æ ‡å‡†unittestå‘ç°æµ‹è¯•ã€‚TestCaseå­ç±»åŒ–æŠ€æœ¯ã€‚</p></blockquote><h2 id="1-4-æ–­è¨€å¼•å‘äº†æŸç§å¼‚å¸¸"><a href="#1-4-æ–­è¨€å¼•å‘äº†æŸç§å¼‚å¸¸" class="headerlink" title="1.4 æ–­è¨€å¼•å‘äº†æŸç§å¼‚å¸¸"></a>1.4 æ–­è¨€å¼•å‘äº†æŸç§å¼‚å¸¸</h2><p>ä½¿ç”¨ raises å¸®åŠ©å™¨æ¥æ–­è¨€æŸäº›ä»£ç å¼•å‘å¼‚å¸¸ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># content of test_sysexit.py</span><br><span class="hljs-keyword">import</span> pytest<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">f</span>():<br>    <span class="hljs-keyword">raise</span> SystemExit(<span class="hljs-number">1</span>)<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_mytest</span>():<br>    <span class="hljs-keyword">with</span> pytest.raises(SystemExit):<br>        f()<br></code></pre></td></tr></table></figure><p>è¿˜å¯ä»¥ä½¿ç”¨ raise æä¾›çš„ä¸Šä¸‹æ–‡æ¥æ–­è¨€é¢„æœŸå¼‚å¸¸æ˜¯å¼•å‘çš„ ExceptionGroup çš„ä¸€éƒ¨åˆ†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># content of test_exceptiongroup.py</span><br><span class="hljs-keyword">import</span> pytest<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">f</span>():<br>    <span class="hljs-keyword">raise</span> ExceptionGroup(<br>        <span class="hljs-string">&quot;Group message&quot;</span>,<br>        [<br>            RuntimeError(),<br>        ],<br>    )<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_exception_in_group</span>():<br>    <span class="hljs-keyword">with</span> pytest.raises(ExceptionGroup) <span class="hljs-keyword">as</span> excinfo:<br>        f()<br>    <span class="hljs-keyword">assert</span> excinfo.group_contains(RuntimeError)<br>    <span class="hljs-keyword">assert</span> <span class="hljs-keyword">not</span> excinfo.group_contains(TypeError)<br></code></pre></td></tr></table></figure><p>Execute the test function with â€œquietâ€ reporting mode:</p><p>ä»¥â€œå®‰é™â€æŠ¥å‘Šæ¨¡å¼æ‰§è¡Œæµ‹è¯•åŠŸèƒ½ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">$ pytest -q test_sysexit.py<br>.                                                                    [<span class="hljs-number">100</span>%]<br><span class="hljs-number">1</span> passed <span class="hljs-keyword">in</span> <span class="hljs-number">0.12</span>s<br></code></pre></td></tr></table></figure><h2 id="1-5-å°†å¤šä¸ªæµ‹è¯•åˆ†ç»„-å°è£…-åˆ°ä¸€ä¸ªç±»ä¸­"><a href="#1-5-å°†å¤šä¸ªæµ‹è¯•åˆ†ç»„-å°è£…-åˆ°ä¸€ä¸ªç±»ä¸­" class="headerlink" title="1.5 å°†å¤šä¸ªæµ‹è¯•åˆ†ç»„(å°è£…)åˆ°ä¸€ä¸ªç±»ä¸­"></a>1.5 å°†å¤šä¸ªæµ‹è¯•åˆ†ç»„(å°è£…)åˆ°ä¸€ä¸ªç±»ä¸­</h2><p>å®šä¹‰äº†å¤šä¸ªæµ‹è¯•ï¼ˆdef test_xxx() ï¼‰ï¼Œå¯èƒ½å¸Œæœ›å°†å®ƒä»¬åˆ†ç»„åˆ°ä¸€ä¸ªç±»ä¸­ã€‚ pytest å¯ä»¥è½»æ¾åˆ›å»ºåŒ…å«å¤šä¸ªæµ‹è¯•çš„ç±»ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># content of test_class.py</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestClass</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_one</span>(<span class="hljs-params">self</span>):<br>        x = <span class="hljs-string">&quot;this&quot;</span><br>        <span class="hljs-keyword">assert</span> <span class="hljs-string">&quot;h&quot;</span> <span class="hljs-keyword">in</span> x<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_two</span>(<span class="hljs-params">self</span>):<br>        x = <span class="hljs-string">&quot;hello&quot;</span><br>        <span class="hljs-keyword">assert</span> <span class="hljs-built_in">hasattr</span>(x, <span class="hljs-string">&quot;check&quot;</span>)<br></code></pre></td></tr></table></figure><p>pytestå‘ç°æ‰€æœ‰éµå¾ªPython<code>æµ‹è¯•å‘ç°çº¦å®š</code>çš„æµ‹è¯•ï¼Œå› æ­¤å®ƒæ‰¾åˆ°ä¸¤ä¸ªä»¥test_ä¸ºå‰ç¼€çš„å‡½æ•°ã€‚ä¸éœ€è¦åˆ›å»ºä»»ä½•å­ç±»ï¼Œä½†è¦ç¡®ä¿ä¸ºç±»æ·»åŠ Testå‰ç¼€ï¼Œå¦åˆ™å°†è·³è¿‡è¯¥ç±»ã€‚æˆ‘ä»¬å¯ä»¥ç®€å•åœ°é€šè¿‡ä¼ é€’å®ƒçš„æ–‡ä»¶åæ¥è¿è¡Œæ¨¡å—:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python">$ pytest -q test_class.py<br>.F                                                                   [<span class="hljs-number">100</span>%]<br>================================= FAILURES =================================<br>____________________________ TestClass.test_two ____________________________<br><br>self = &lt;test_class.TestClass <span class="hljs-built_in">object</span> at <span class="hljs-number">0xdeadbeef0001</span>&gt;<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_two</span>(<span class="hljs-params">self</span>):<br>        x = <span class="hljs-string">&quot;hello&quot;</span><br>&gt;       <span class="hljs-keyword">assert</span> <span class="hljs-built_in">hasattr</span>(x, <span class="hljs-string">&quot;check&quot;</span>)<br>E       AssertionError: <span class="hljs-keyword">assert</span> <span class="hljs-literal">False</span><br>E        +  where <span class="hljs-literal">False</span> = <span class="hljs-built_in">hasattr</span>(<span class="hljs-string">&#x27;hello&#x27;</span>, <span class="hljs-string">&#x27;check&#x27;</span>)<br><br>test_class.py:<span class="hljs-number">8</span>: AssertionError<br>========================= short test summary info ==========================<br>FAILED test_class.py::TestClass::test_two - AssertionError: <span class="hljs-keyword">assert</span> <span class="hljs-literal">False</span><br><span class="hljs-number">1</span> failed, <span class="hljs-number">1</span> passed <span class="hljs-keyword">in</span> <span class="hljs-number">0.12</span>s<br></code></pre></td></tr></table></figure><p>The first test passed and the second failed. You can easily see the intermediate values in the assertion to help you understand the reason for the failure.</p><p>ç¬¬ä¸€æ¬¡æµ‹è¯•é€šè¿‡äº†ï¼Œç¬¬äºŒæ¬¡æµ‹è¯•å¤±è´¥äº†ã€‚å¯ä»¥è½»æ¾æŸ¥çœ‹æ–­è¨€ä¸­çš„ä¸­é—´å€¼(å¤±è´¥å¤„)ï¼Œä»¥å¸®åŠ©äº†è§£å¤±è´¥çš„åŸå› ã€‚</p><p>Grouping tests in classes can be beneficial for the following reasons:</p><blockquote><ul><li>Test organization</li><li>Sharing fixtures for tests only in that particular class</li><li>Applying marks at the class level and having them implicitly apply to all tests</li></ul></blockquote><p>å°†æµ‹è¯•åˆ†ç»„åˆ°ç­çº§ä¸­å¯èƒ½æ˜¯æœ‰ç›Šçš„ï¼ŒåŸå› å¦‚ä¸‹ï¼š</p><ul><li>æµ‹è¯•ç»„ç»‡ï¼ˆè¿™å¥è¯çš„æ„æ€æ˜¯åˆ†ç±»ï¼‰</li><li>ä»…åœ¨è¯¥ç‰¹å®šç±»ä¸­å…±äº«æµ‹è¯•è£…ç½®ï¼ˆå•ç‹¬åº”ç”¨fixtureï¼‰</li><li>åœ¨ç±»çº§åˆ«æ ‡è®°ï¼ˆpytest.markï¼‰å¹¶å°†å…¶éšå¼åº”ç”¨äºæ‰€æœ‰æµ‹è¯•</li></ul><p>Something to be aware of when grouping tests inside classes is that each test has a unique instance of the class.  Having each test share the same class instance would be very detrimental to test isolation and would promote poor test practices.  This is outlined below:</p><p>åœ¨ç±»ä¸­å¯¹æµ‹è¯•è¿›è¡Œåˆ†ç»„æ—¶éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¯ä¸ªæµ‹è¯•éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„ç±»å®ä¾‹ã€‚è®©æ¯ä¸ªæµ‹è¯•å…±äº«ç›¸åŒçš„ç±»å®ä¾‹å°†éå¸¸ä¸åˆ©äºæµ‹è¯•éš”ç¦»ï¼Œå¹¶ä¼šä¿ƒè¿›ç³Ÿç³•çš„æµ‹è¯•å®è·µã€‚è¿™æ˜¯æ¦‚è¿°å¦‚ä¸‹:</p><p>ï¼ˆæµ‹è¯•éš”ç¦»ï¼šä¾‹å¦‚æµ‹è¯•Aç±»å’ŒBç±»éƒ½æœ‰è‡ªå·±çš„å±æ€§ï¼ˆæˆ–å˜é‡ï¼‰ï¼Œé¿å…ä¸¤ä¸ªæµ‹è¯•ç±»çš„å±æ€§ä¸²äº†ï¼ŒTips ï¼šå°½é‡è¦å†™å…¨å±€å˜é‡ ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># content of test_class_demo.py</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestClassDemoInstance</span>:<br>    value = <span class="hljs-number">0</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_one</span>(<span class="hljs-params">self</span>):<br>        self.value = <span class="hljs-number">1</span><br>        <span class="hljs-keyword">assert</span> self.value == <span class="hljs-number">1</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_two</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-keyword">assert</span> self.value == <span class="hljs-number">1</span><br>$ pytest -k TestClassDemoInstance -q<br>.F                                                                   [<span class="hljs-number">100</span>%]<br>================================= FAILURES =================================<br>______________________ TestClassDemoInstance.test_two ______________________<br><br>self = &lt;test_class_demo.TestClassDemoInstance <span class="hljs-built_in">object</span> at <span class="hljs-number">0xdeadbeef0002</span>&gt;<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_two</span>(<span class="hljs-params">self</span>):<br>&gt;       <span class="hljs-keyword">assert</span> self.value == <span class="hljs-number">1</span><br>E       <span class="hljs-keyword">assert</span> <span class="hljs-number">0</span> == <span class="hljs-number">1</span><br>E        +  where <span class="hljs-number">0</span> = &lt;test_class_demo.TestClassDemoInstance <span class="hljs-built_in">object</span> at <span class="hljs-number">0xdeadbeef0002</span>&gt;.value<br><br>test_class_demo.py:<span class="hljs-number">9</span>: AssertionError<br>========================= short test summary info ==========================<br>FAILED test_class_demo.py::TestClassDemoInstance::test_two - <span class="hljs-keyword">assert</span> <span class="hljs-number">0</span> == <span class="hljs-number">1</span><br><span class="hljs-number">1</span> failed, <span class="hljs-number">1</span> passed <span class="hljs-keyword">in</span> <span class="hljs-number">0.12</span>s<br></code></pre></td></tr></table></figure><p>Note that attributes added at class level are <em>class attributes</em>, so they will be shared between tests.</p><p>è¯·æ³¨æ„ï¼Œåœ¨ç±»çº§åˆ«æ·»åŠ çš„å±æ€§æ˜¯ç±»å±æ€§ï¼Œå› æ­¤å®ƒä»¬å°†åœ¨æµ‹è¯•ç”¨ä¾‹ä¹‹é—´å…±äº«ã€‚</p><blockquote><p>æµ‹è¯•ç”¨ä¾‹ï¼šdef test_xxx():</p></blockquote><h2 id="1-6-è¯·æ±‚ä¸€ä¸ªç”¨äºåŠŸèƒ½æµ‹è¯•çš„å”¯ä¸€ä¸´æ—¶ç›®å½•"><a href="#1-6-è¯·æ±‚ä¸€ä¸ªç”¨äºåŠŸèƒ½æµ‹è¯•çš„å”¯ä¸€ä¸´æ—¶ç›®å½•" class="headerlink" title="1.6 è¯·æ±‚ä¸€ä¸ªç”¨äºåŠŸèƒ½æµ‹è¯•çš„å”¯ä¸€ä¸´æ—¶ç›®å½•"></a>1.6 è¯·æ±‚ä¸€ä¸ªç”¨äºåŠŸèƒ½æµ‹è¯•çš„å”¯ä¸€ä¸´æ—¶ç›®å½•</h2><blockquote><p>Request a unique temporary directory for functional tests</p></blockquote><p><code>pytest</code> provides <a href="https://docs.pytest.org/en/8.0.x/builtin.html">Builtin fixtures&#x2F;function arguments</a> to request arbitrary resources, like a unique temporary directory:</p><p>pytest æä¾›å†…ç½®å›ºå®šè£…ç½®&#x2F;å‡½æ•°å‚æ•°æ¥è¯·æ±‚ä»»æ„èµ„æºï¼Œä¾‹å¦‚å”¯ä¸€çš„ä¸´æ—¶ç›®å½•ï¼š</p><blockquote><p>å†…ç½®å›ºå®šè£…ç½®: å°±æ˜¯fixtures </p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># content of test_tmp_path.py</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_needsfiles</span>(<span class="hljs-params">tmp_path</span>): <span class="hljs-comment"># è¿™é‡Œçš„tmp_path å°±æ˜¯fixtures</span><br>    <span class="hljs-built_in">print</span>(tmp_path)<br>    <span class="hljs-keyword">assert</span> <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><p>List the name <code>tmp_path</code> in the test function signature and <code>pytest</code> will lookup and call a fixture factory to create the resource before performing the test function call. Before the test runs, <code>pytest</code> creates a unique-per-test-invocation temporary directory:</p><p>åœ¨æµ‹è¯•å‡½æ•°ç­¾åä¸­åˆ—å‡ºåç§°tmp_path, pytestå°†åœ¨æ‰§è¡Œæµ‹è¯•å‡½æ•°è°ƒç”¨ä¹‹å‰æŸ¥æ‰¾å¹¶è°ƒç”¨ä¸€ä¸ªfixtureå·¥å‚æ¥åˆ›å»ºèµ„æºã€‚åœ¨æµ‹è¯•è¿è¡Œä¹‹å‰ï¼Œpyteståˆ›å»ºä¸€ä¸ªæ¯ä¸ªæµ‹è¯•è°ƒç”¨å”¯ä¸€çš„ä¸´æ—¶ç›®å½•:</p><p>åœ¨æµ‹è¯•å‡½æ•°åŠ å…¥å‚æ•°tmp_path,</p><p>pytestå°†åœ¨æ‰§è¡Œæµ‹è¯•å‡½æ•°ä¹‹å‰è°ƒç”¨fixtureé‡Œé¢çš„tmp_pathæ–¹æ³•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python">$ pytest -q test_tmp_path.py<br>F                                                                    [<span class="hljs-number">100</span>%]<br>================================= FAILURES =================================<br>_____________________________ test_needsfiles ______________________________<br><br>tmp_path = PosixPath(<span class="hljs-string">&#x27;PYTEST_TMPDIR/test_needsfiles0&#x27;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_needsfiles</span>(<span class="hljs-params">tmp_path</span>):<br>        <span class="hljs-built_in">print</span>(tmp_path)<br>&gt;       <span class="hljs-keyword">assert</span> <span class="hljs-number">0</span><br>E       <span class="hljs-keyword">assert</span> <span class="hljs-number">0</span><br><br>test_tmp_path.py:<span class="hljs-number">3</span>: AssertionError<br>--------------------------- Captured stdout call ---------------------------<br>PYTEST_TMPDIR/test_needsfiles0<br>========================= short test summary info ==========================<br>FAILED test_tmp_path.py::test_needsfiles - <span class="hljs-keyword">assert</span> <span class="hljs-number">0</span><br><span class="hljs-number">1</span> failed <span class="hljs-keyword">in</span> <span class="hljs-number">0.12</span>s<br></code></pre></td></tr></table></figure><p>More info on temporary directory handling is available at <a href="https://docs.pytest.org/en/8.0.x/how-to/tmp_path.html#tmp-path-handling">Temporary directories and files</a>.</p><p>æœ‰å…³ä¸´æ—¶ç›®å½•å¤„ç†çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…ä¸´æ—¶ç›®å½•å’Œæ–‡ä»¶ï¼ˆåé¢ä¼šè®²å“’ï¼‰</p><p>Find out what kind of builtin <a href="https://docs.pytest.org/en/8.0.x/reference/fixtures.html#fixtures">pytest fixtures</a> exist with the command:</p><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯ä»¥æ‰¾å‡ºå­˜åœ¨å“ªç§å†…ç½® pytest è£…ç½®ï¼špytest â€“fixtures</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">pytest --fixtures   <span class="hljs-comment"># shows builtin and custom fixtures</span><br></code></pre></td></tr></table></figure><p>Note that this command omits fixtures with leading <code>_</code> unless the <code>-v</code> option is added.</p><p>è¯·æ³¨æ„ï¼Œé™¤éæ·»åŠ <code> -v</code> é€‰é¡¹ï¼Œå¦åˆ™æ­¤å‘½ä»¤ä¼šå¿½ç•¥å¸¦æœ‰å‰å¯¼ <code>_</code> çš„è£…ç½®ã€‚</p><p>æœªå®Œå¾…ç»­â€¦â€¦</p>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç¬”è®°</tag>
      
      <tag>pytest</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>python ä¹‹ pytest mock æ•°æ®ï¼ˆä¸ƒï¼‰</title>
    <link href="/2024/01/20/667python-%E4%B9%8B-pytest-mock-%E6%95%B0%E6%8D%AE%EF%BC%88%E4%B8%83%EF%BC%89/"/>
    <url>/2024/01/20/667python-%E4%B9%8B-pytest-mock-%E6%95%B0%E6%8D%AE%EF%BC%88%E4%B8%83%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="pytestä¹‹MonkeypatchingçŒ´å­è¡¥ä¸"><a href="#pytestä¹‹MonkeypatchingçŒ´å­è¡¥ä¸" class="headerlink" title="pytestä¹‹MonkeypatchingçŒ´å­è¡¥ä¸"></a>pytestä¹‹MonkeypatchingçŒ´å­è¡¥ä¸</h1><p>æœ‰æ—¶æµ‹è¯•éœ€è¦è°ƒç”¨ä¾èµ–äºå…¨å±€è®¾ç½®çš„åŠŸèƒ½æˆ–è°ƒç”¨ä¸æ˜“æµ‹è¯•çš„ä»£ç ï¼ˆä¾‹å¦‚ç½‘ç»œè®¿é—®ï¼‰ã€‚å¤¹å…·<code>monkeypatch</code>å¯å¸®åŠ©æ‚¨å®‰å…¨åœ°è®¾ç½®&#x2F;åˆ é™¤å±æ€§ã€å­—å…¸é¡¹æˆ–ç¯å¢ƒå˜é‡ï¼Œæˆ–è¿›è¡Œä¿®æ”¹<code>sys.path</code>ä»¥ä¾›å¯¼å…¥ã€‚</p><p>æ¦‚å¿µï¼š</p><p>åœ¨è¿è¡Œæ—¶åŠ¨æ€ä¿®æ”¹æ¨¡å—ã€ç±»æˆ–å‡½æ•°ï¼Œé€šå¸¸æ˜¯æ·»åŠ åŠŸèƒ½æˆ–ä¿®æ­£ç¼ºé™·ã€‚</p><p><strong>çŒ´å­è¡¥ä¸åœ¨ä»£ç è¿è¡Œæ—¶ï¼ˆå†…å­˜ä¸­ï¼‰å‘æŒ¥ä½œç”¨ï¼Œä¸ä¼šä¿®æ”¹æºç ï¼Œå› æ­¤åªå¯¹å½“å‰è¿è¡Œçš„ç¨‹åºå®ä¾‹æœ‰æ•ˆã€‚</strong></p><p>å› ä¸ºçŒ´å­è¡¥ä¸ç ´åäº†å°è£…ï¼Œè€Œä¸”å®¹æ˜“å¯¼è‡´ç¨‹åºä¸è¡¥ä¸ä»£ç çš„å®ç°ç»†èŠ‚ç´§å¯†è€¦åˆï¼Œæ‰€ä»¥è¢«è§†ä¸ºä¸´æ—¶çš„å˜é€šæ–¹æ¡ˆï¼Œä¸æ˜¯é›†æˆä»£ç çš„æ¨èæ–¹å¼ã€‚<br>åœ¨Pythonè¯­è¨€ä¸­ï¼Œmonkey patch æŒ‡çš„æ˜¯å¯¹äºä¸€ä¸ªç±»æˆ–è€…æ¨¡å—æ‰€è¿›è¡Œçš„åŠ¨æ€ä¿®æ”¹ã€‚åœ¨Pythonè¯­è¨€ä¸­ï¼Œæˆ‘ä»¬å…¶å®å¯ä»¥åœ¨è¿è¡Œæ—¶ä¿®æ”¹ä»£ç çš„è¡Œä¸ºã€‚</p><p>è¯¥<code>monkeypatch</code>è£…ç½®æä¾›äº†ä»¥ä¸‹è¾…åŠ©æ–¹æ³•ï¼Œç”¨äºåœ¨æµ‹è¯•ä¸­å®‰å…¨åœ°ä¿®è¡¥å’Œæ¨¡æ‹ŸåŠŸèƒ½ï¼š</p><ul><li><a href="https://docs.pytest.org/en/8.0.x/reference/reference.html#pytest.MonkeyPatch.setattr"><code>monkeypatch.setattr(obj, name, value, raising=True)</code></a></li><li><a href="https://docs.pytest.org/en/8.0.x/reference/reference.html#pytest.MonkeyPatch.delattr"><code>monkeypatch.delattr(obj, name, raising=True)</code></a></li><li><a href="https://docs.pytest.org/en/8.0.x/reference/reference.html#pytest.MonkeyPatch.setitem"><code>monkeypatch.setitem(mapping, name, value)</code></a></li><li><a href="https://docs.pytest.org/en/8.0.x/reference/reference.html#pytest.MonkeyPatch.delitem"><code>monkeypatch.delitem(obj, name, raising=True)</code></a></li><li><a href="https://docs.pytest.org/en/8.0.x/reference/reference.html#pytest.MonkeyPatch.setenv"><code>monkeypatch.setenv(name, value, prepend=None)</code></a></li><li><a href="https://docs.pytest.org/en/8.0.x/reference/reference.html#pytest.MonkeyPatch.delenv"><code>monkeypatch.delenv(name, raising=True)</code></a></li><li><a href="https://docs.pytest.org/en/8.0.x/reference/reference.html#pytest.MonkeyPatch.syspath_prepend"><code>monkeypatch.syspath_prepend(path)</code></a></li><li><a href="https://docs.pytest.org/en/8.0.x/reference/reference.html#pytest.MonkeyPatch.chdir"><code>monkeypatch.chdir(path)</code></a></li><li><a href="https://docs.pytest.org/en/8.0.x/reference/reference.html#pytest.MonkeyPatch.context"><code>monkeypatch.context()</code></a></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">monkeypatch.<span class="hljs-built_in">setattr</span>(obj, name, value, raising=<span class="hljs-literal">True</span>)<br>monkeypatch.<span class="hljs-built_in">delattr</span>(obj, name, raising=<span class="hljs-literal">True</span>)<br>monkeypatch.setitem(mapping, name, value)<br>monkeypatch.delitem(obj, name, raising=<span class="hljs-literal">True</span>)<br>monkeypatch.setenv(name, value, prepend=<span class="hljs-literal">False</span>)<br>monkeypatch.delenv(name, raising=<span class="hljs-literal">True</span>)<br>monkeypatch.syspath_prepend(path)<br>monkeypatch.chdir(path)<br><br></code></pre></td></tr></table></figure><p>è¯·æ±‚æµ‹è¯•å‡½æ•°æˆ–è£…ç½®å®Œæˆåï¼Œæ‰€æœ‰ä¿®æ”¹éƒ½å°†è¢«æ’¤æ¶ˆã€‚ å¦‚æœè®¾ç½®&#x2F;åˆ é™¤æ“ä½œçš„ç›®æ ‡ä¸å­˜åœ¨ï¼Œåˆ™è¯¥<code>raising</code> å‚æ•°ç¡®å®šæ˜¯å¦å¼•å‘<code>KeyError</code>æˆ–ã€‚<code>AttributeError</code></p><p>è¯·è€ƒè™‘ä»¥ä¸‹æƒ…å½¢ï¼š</p><ol><li>ä¿®æ”¹å‡½æ•°çš„è¡Œä¸ºæˆ–ç±»çš„å±æ€§ä»¥è¿›è¡Œæµ‹è¯•ï¼Œä¾‹å¦‚ï¼Œæœ‰ä¸€ä¸ª API è°ƒç”¨æˆ–æ•°æ®åº“è¿æ¥ï¼Œä½ ä¸ä¼šå¯¹å…¶è¿›è¡Œæµ‹è¯•ï¼Œä½†ä½ çŸ¥é“é¢„æœŸçš„è¾“å‡ºåº”è¯¥æ˜¯ä»€ä¹ˆã€‚ä½¿ç”¨<a href="https://docs.pytest.org/en/8.0.x/reference/reference.html#pytest.MonkeyPatch.setattr"><code>monkeypatch.setattr</code></a>ä¿®è¡¥å‡½æ•°æˆ–å±æ€§ä»¥è¾¾åˆ°æ‚¨æƒ³è¦çš„æµ‹è¯•è¡Œä¸ºã€‚è¿™ä¹Ÿå¯ä»¥åŒ…æ‹¬è‡ªå·±å®šä¹‰è‡ªå·±çš„å‡½æ•°ã€‚ä½¿ç”¨<a href="https://docs.pytest.org/en/8.0.x/reference/reference.html#pytest.MonkeyPatch.delattr"><code>monkeypatch.delattr</code></a>åˆ é™¤æµ‹è¯•çš„å‡½æ•°æˆ–å±æ€§ã€‚ </li><li>ä¿®æ”¹å­—å…¸çš„å€¼ä¾‹å¦‚ï¼Œä½ æœ‰ä¸€ä¸ªå…¨å±€é…ç½®ï¼Œæƒ³è¦é’ˆå¯¹æŸäº›æµ‹è¯•ç”¨ä¾‹è¿›è¡Œä¿®æ”¹ã€‚ç”¨äº<a href="https://docs.pytest.org/en/8.0.x/reference/reference.html#pytest.MonkeyPatch.setitem"><code>monkeypatch.setitem</code></a>ä¿®è¡¥æµ‹è¯•å­—å…¸ã€‚<a href="https://docs.pytest.org/en/8.0.x/reference/reference.html#pytest.MonkeyPatch.delitem"><code>monkeypatch.delitem</code></a>å¯ç”¨äºåˆ é™¤é¡¹ç›®ã€‚</li><li>ä¿®æ”¹ç¯å¢ƒå˜é‡ä»¥è¿›è¡Œæµ‹è¯•ï¼Œä¾‹å¦‚ï¼Œå¦‚æœç¼ºå°‘ç¯å¢ƒå˜é‡ï¼Œåˆ™æµ‹è¯•ç¨‹åºè¡Œä¸ºï¼Œæˆ–è€…ä¸ºå·²çŸ¥å˜é‡è®¾ç½®å¤šä¸ªå€¼ã€‚ <a href="https://docs.pytest.org/en/8.0.x/reference/reference.html#pytest.MonkeyPatch.setenv"><code>monkeypatch.setenv</code></a>å¹¶å¯<a href="https://docs.pytest.org/en/8.0.x/reference/reference.html#pytest.MonkeyPatch.delenv"><code>monkeypatch.delenv</code></a>ç”¨äºè¿™äº›è¡¥ä¸ã€‚</li><li>ä½¿ç”¨ä¿®æ”¹ï¼Œå¹¶ åœ¨æµ‹è¯•æœŸé—´æ›´æ”¹å½“å‰å·¥ä½œç›®å½•çš„ä¸Šä¸‹æ–‡ã€‚<code>monkeypatch.setenv(&quot;PATH&quot;, value, prepend=os.pathsep)``$PATH</code><a href="https://docs.pytest.org/en/8.0.x/reference/reference.html#pytest.MonkeyPatch.chdir"><code>monkeypatch.chdir</code></a></li><li>ä½¿ç”¨<a href="https://docs.pytest.org/en/8.0.x/reference/reference.html#pytest.MonkeyPatch.syspath_prepend"><code>monkeypatch.syspath_prepend</code></a>ä¿®æ”¹<code>sys.path</code>ä¹Ÿä¼šè°ƒç”¨<code>pkg_resources.fixup_namespace_packages</code>å’Œ<a href="https://docs.python.org/3/library/importlib.html#importlib.invalidate_caches"><code>importlib.invalidate_caches()</code></a>ã€‚</li><li><a href="https://docs.pytest.org/en/8.0.x/reference/reference.html#pytest.MonkeyPatch.context"><code>monkeypatch.context</code></a>ä»…åœ¨ç‰¹å®šèŒƒå›´å†…åº”ç”¨è¡¥ä¸ï¼Œè¿™æœ‰åŠ©äºæ§åˆ¶å¤æ‚è£…ç½®æˆ– stdlib è¡¥ä¸çš„æ‹†é™¤ã€‚</li></ol><h2 id="Monkeypatchingå‡½æ•°"><a href="#Monkeypatchingå‡½æ•°" class="headerlink" title="Monkeypatchingå‡½æ•°"></a>Monkeypatchingå‡½æ•°</h2><p>æ€è€ƒä¸€ä¸‹ä½ æ­£åœ¨ä½¿ç”¨ç”¨æˆ·ç›®å½•çš„æƒ…å†µã€‚åœ¨æµ‹è¯•ç¯å¢ƒä¸­ï¼Œæ‚¨ä¸å¸Œæœ›æµ‹è¯•ä¾èµ–äºæ­£åœ¨è¿è¡Œçš„ç”¨æˆ·ã€‚<code>monkeypatch</code> å¯ç”¨äºæ¨¡æ‹Ÿç”¨æˆ·ä¾èµ–çš„å‡½æ•°ï¼Œä½¿å…¶å§‹ç»ˆè¿”å›ä½ è®¾å®šçš„ç‰¹å®šå€¼ã€‚</p><p>ä»£ç ç¤ºä¾‹ï¼š</p><p>åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼Œ<a href="https://docs.pytest.org/en/8.0.x/reference/reference.html#pytest.MonkeyPatch.setattr"><code>monkeypatch.setattr</code></a>ç”¨äºä¿®è¡¥<code>Path.home</code> ï¼Œä»¥ä¾¿<code>Path(&quot;/abc&quot;)</code>åœ¨è¿è¡Œæµ‹è¯•æ—¶å§‹ç»ˆä½¿ç”¨å·²çŸ¥çš„æµ‹è¯•è·¯å¾„ã€‚è¿™æ¶ˆé™¤äº†å¯¹æ­£åœ¨è¿è¡Œçš„ç”¨æˆ·çš„ä»»ä½•ä¾èµ–ï¼Œä»¥è¾¾åˆ°æµ‹è¯•ç›®çš„ã€‚ <a href="https://docs.pytest.org/en/8.0.x/reference/reference.html#pytest.MonkeyPatch.setattr"><code>monkeypatch.setattr</code></a>å¿…é¡»åœ¨è°ƒç”¨å°†ä½¿ç”¨ä¿®è¡¥å‡½æ•°çš„å‡½æ•°ä¹‹å‰è°ƒç”¨ã€‚æµ‹è¯•å‡½æ•°å®Œæˆåï¼Œ<code>Path.home</code>ä¿®æ”¹å°†è¢«æ’¤æ¶ˆã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path<br><br><span class="hljs-built_in">print</span>(Path.home())<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">getssh</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;Simple function to return expanded homedir ssh path.&quot;&quot;&quot;</span><br>    <span class="hljs-keyword">return</span> Path.home() / <span class="hljs-string">&quot;.ssh&quot;</span> <span class="hljs-comment"># Path.home()è¿”å›çš„æ˜¯/home/user ï¼Œæ‹¼æ¥å/home/user/ssh</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_getssh</span>(<span class="hljs-params">monkeypatch</span>):<br>    <span class="hljs-comment"># mocked return function to replace Path.home</span><br>    <span class="hljs-comment"># always return &#x27;/abc&#x27;</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">mockreturn</span>(): <span class="hljs-comment"># æ¨¡æ‹Ÿè¿”å›</span><br>        <span class="hljs-keyword">return</span> Path(<span class="hljs-string">&quot;/abc&quot;</span>)<br><br>    <span class="hljs-comment"># Application of the monkeypatch to replace Path.home</span><br>    <span class="hljs-comment"># with the behavior of mockreturn defined above.</span><br>    monkeypatch.<span class="hljs-built_in">setattr</span>(Path, <span class="hljs-string">&quot;home&quot;</span>, mockreturn) <span class="hljs-comment"># è®¾ç½®ï¼Œå½“ä½ è°ƒç”¨Path.homeæ—¶ï¼Œä½¿ç”¨mockreturn ï¼Œmockreturnè¿”å›çš„æ˜¯/abc</span><br><br>    <span class="hljs-comment"># Calling getssh() will use mockreturn in place of Path.home</span><br>    <span class="hljs-comment"># for this test with the monkeypatch.</span><br>    x = getssh() <span class="hljs-comment"># è°ƒç”¨getssh()ï¼Œå®é™…è°ƒç”¨çš„æ˜¯mockreturnï¼Œè¿”å›çš„æ˜¯/abc</span><br>    <span class="hljs-built_in">print</span>(x)<br>    <span class="hljs-keyword">assert</span> x == Path(<span class="hljs-string">&quot;/abc/.ssh&quot;</span>)<br></code></pre></td></tr></table></figure><h2 id="Monkeypatching-è¿”å›å¯¹è±¡ï¼šæ„å»ºæ¨¡æ‹Ÿç±»"><a href="#Monkeypatching-è¿”å›å¯¹è±¡ï¼šæ„å»ºæ¨¡æ‹Ÿç±»" class="headerlink" title="Monkeypatching è¿”å›å¯¹è±¡ï¼šæ„å»ºæ¨¡æ‹Ÿç±»"></a>Monkeypatching è¿”å›å¯¹è±¡ï¼šæ„å»ºæ¨¡æ‹Ÿç±»</h2><p><a href="https://docs.pytest.org/en/8.0.x/reference/reference.html#pytest.MonkeyPatch.setattr"><code>monkeypatch.setattr</code></a>ä¹Ÿå¯ä»¥ä¸ç±»ç»“åˆä½¿ç”¨ï¼Œæ¨¡æ‹Ÿå‡½æ•°æ‰€è¿”å›çš„æ˜¯å¯¹è±¡è€Œä¸æ˜¯å€¼ã€‚å®šä¹‰ä¸€ä¸ªç®€å•çš„å‡½æ•°ï¼Œå®ƒæ¥å— API url å¹¶è¿”å› json å“åº”ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># contents of app.py, a simple API retrieval example</span><br><span class="hljs-keyword">import</span> requests<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_json</span>(<span class="hljs-params">url</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Takes a URL, and returns the JSON.&quot;&quot;&quot;</span><br>    r = requests.get(url) <span class="hljs-comment"># å‘èµ·urlè¯·æ±‚</span><br>    <span class="hljs-keyword">return</span> r.json()<br></code></pre></td></tr></table></figure><p>ä¸ºäº†æµ‹è¯•ï¼Œæˆ‘ä»¬éœ€è¦æ¨¡æ‹Ÿ<code>r</code>è¿”å›çš„å“åº”å¯¹è±¡ã€‚æ¨¡æ‹Ÿçš„<code>r</code>å¯¹è±¡å¿…é¡»è¦æœ‰ä¸€ä¸ª<code>.json()</code>è¿”å›å­—å…¸çš„æ–¹æ³•ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨æµ‹è¯•æ–‡ä»¶ä¸­å®šä¹‰ä¸€ä¸ªç±»æ¥ mock <code>r</code>å¯¹è±¡ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># contents of test_app.py, a simple test for our API retrieval</span><br><span class="hljs-comment"># import requests for the purposes of monkeypatching</span><br><span class="hljs-keyword">import</span> requests<br><br><span class="hljs-comment"># our app.py that includes the get_json() function</span><br><span class="hljs-comment"># this is the previous code block example</span><br><span class="hljs-keyword">import</span> app <span class="hljs-comment"># å¯¼å…¥app.py</span><br><br><br><span class="hljs-comment"># custom class to be the mock return value</span><br><span class="hljs-comment"># will override the requests.Response returned from requests.get</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MockResponse</span>:<br>    <span class="hljs-comment"># mock json() method always returns a specific testing dictionary</span><br><span class="hljs-meta">    @staticmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">json</span>():<br>        <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;mock_key&quot;</span>: <span class="hljs-string">&quot;mock_response&quot;</span>&#125; <span class="hljs-comment"># MockResponseçš„.json()æ–¹æ³•æ€»æ˜¯è¿”å›ä¸€ä¸ªå­—å…¸</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_get_json</span>(<span class="hljs-params">monkeypatch</span>):<br>    <span class="hljs-comment"># Any arguments may be passed and mock_get() will always return our</span><br>    <span class="hljs-comment"># mocked object, which only has the .json() method.</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">mock_get</span>(<span class="hljs-params">*args, **kwargs</span>):<br>        <span class="hljs-keyword">return</span> MockResponse() <span class="hljs-comment"># è¿”å›MockResponseå¯¹è±¡ï¼Œè¿™é‡Œè¿”å›çš„å°±æ˜¯æˆ‘ä»¬è¦mockçš„rå¯¹è±¡</span><br><br>    <span class="hljs-comment"># apply the monkeypatch for requests.get to mock_get</span><br>    monkeypatch.<span class="hljs-built_in">setattr</span>(requests, <span class="hljs-string">&quot;get&quot;</span>, mock_get) <span class="hljs-comment"># ç»™requests.getæ–¹æ³•çš„è¿”å›å€¼å®šä¹‰ä¸ºæˆ‘ä»¬çš„mock_getæ‰€è¿”å›çš„MockResponseå¯¹è±¡</span><br>    <span class="hljs-comment"># è¿™é‡Œå°±ç›¸å½“äºä»€ä¹ˆï¼Œç›¸å½“äºä¹‹å‰çš„ r = requests.get(&quot;https://fakeurl&quot;) å°±ç­‰äºæˆ‘ä»¬çš„r = MockResponse()æ‰€è¿”å›çš„MockResponseå¯¹è±¡</span><br><br>    <span class="hljs-comment"># app.get_json, which contains requests.get, uses the monkeypatch</span><br>    result = app.get_json(<span class="hljs-string">&quot;https://fakeurl&quot;</span>) <span class="hljs-comment"># è¿™é‡Œå°±ç›¸å½“äºå°±æ˜¯ r.json()ä¹Ÿç›¸å½“äºæ˜¯æˆ‘ä»¬mockçš„å¯¹è±¡çš„mock_get()æ‰€è¿”å›çš„&#123;&quot;mock_key&quot;: &quot;mock_response&quot;&#125;)</span><br>    <span class="hljs-keyword">assert</span> result[<span class="hljs-string">&quot;mock_key&quot;</span>] == <span class="hljs-string">&quot;mock_response&quot;</span><br></code></pre></td></tr></table></figure><p>æµ‹è¯•æˆåŠŸï¼Œæ‰“å°ä¸€ä¸‹è¿”å›å†…å®¹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python">============================= test session starts ==============================<br>platform linux -- Python <span class="hljs-number">3.10</span><span class="hljs-number">.12</span>, pytest-<span class="hljs-number">8.1</span><span class="hljs-number">.1</span>, pluggy-<span class="hljs-number">1.4</span><span class="hljs-number">.0</span> -- /home/wang/code/fastApiStudy/venvadmin/<span class="hljs-built_in">bin</span>/python<br>cachedir: .pytest_cache<br>rootdir: /home/wang/code/<br>configfile: pytest.ini<br>plugins: anyio-<span class="hljs-number">4.2</span><span class="hljs-number">.0</span><br>collecting ... collected <span class="hljs-number">1</span> item<br><br>testcases/test_app.py::test_get_json <br>result: &#123;<span class="hljs-string">&#x27;mock_key&#x27;</span>: <span class="hljs-string">&#x27;mock_response&#x27;</span>&#125; <span class="hljs-comment"># æ‰“å°å‡ºæ¥å°±æ˜¯æˆ‘ä»¬è®¾ç½®çš„</span><br>PASSED<br><br>============================== <span class="hljs-number">1</span> passed <span class="hljs-keyword">in</span> <span class="hljs-number">0.03</span>s ===============================<br>Finished running tests!<br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥æ ¹æ®æµ‹è¯•åœºæ™¯æ„å»ºä¸€äº›å¤æ‚çš„ç±»ç»™åˆ°<code>mockresponse</code></p><p>ä¾‹å¦‚è¿™ä¸ªç±»è¿”å›çš„å±æ€§ä¸­å§‹ç»ˆä¼šæœ‰ä¸€ä¸ª<code>ok</code>çš„å±æ€§ï¼Œ</p><p>æˆ–è€…æ ¹æ®è¾“å…¥çš„ä¸åŒçš„å­—ç¬¦ä¸²ç»™<code>.json()æ–¹æ³•</code>è¿”å›ä¸åŒçš„å€¼</p><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹å¼åœ¨æµ‹è¯•ä¹‹é—´å…±äº«æ­¤æ¨¡æ‹Ÿ<code>fixture</code>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs python"> contents of test_app.py, a simple test <span class="hljs-keyword">for</span> our API retrieval<br><span class="hljs-keyword">import</span> pytest<br><span class="hljs-keyword">import</span> requests<br><br><span class="hljs-comment"># app.py that includes the get_json() function</span><br><span class="hljs-keyword">import</span> app<br><br><br><span class="hljs-comment"># custom class to be the mock return value of requests.get()</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MockResponse</span>:<br><span class="hljs-meta">    @staticmethod</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">json</span>():<br>        <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;mock_key&quot;</span>: <span class="hljs-string">&quot;mock_response&quot;</span>&#125;<br><br><br><span class="hljs-comment"># monkeypatched requests.get moved to a fixture</span><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">mock_response</span>(<span class="hljs-params">monkeypatch</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Requests.get() mocked to return &#123;&#x27;mock_key&#x27;:&#x27;mock_response&#x27;&#125;.&quot;&quot;&quot;</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">mock_get</span>(<span class="hljs-params">*args, **kwargs</span>):<br>        <span class="hljs-keyword">return</span> MockResponse()<br><br>    monkeypatch.<span class="hljs-built_in">setattr</span>(requests, <span class="hljs-string">&quot;get&quot;</span>, mock_get) <span class="hljs-comment"># è®¾ç½®å±æ€§</span><br><br><br><span class="hljs-comment"># notice our test uses the custom fixture instead of monkeypatch directly</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_get_json</span>(<span class="hljs-params">mock_response</span>):<br>    result = app.get_json(<span class="hljs-string">&quot;https://fakeurl&quot;</span>)<br>    <span class="hljs-keyword">assert</span> result[<span class="hljs-string">&quot;mock_key&quot;</span>] == <span class="hljs-string">&quot;mock_response&quot;</span><br></code></pre></td></tr></table></figure><p>æ­¤å¤–ï¼Œå¦‚æœè®¾è®¡mockæƒ³è¦åº”ç”¨äºæ‰€æœ‰çš„æµ‹è¯•ç”¨ä¾‹ï¼Œåˆ™<code>fixture</code>å¯ä»¥åœ¨<code>conftest.py</code>æ–‡ä»¶ä¸­å®šä¹‰ ï¼Œå¹¶åœ¨<code>pytest.ini</code>é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨<code>withautouse=True</code>è¿™ä¸ªé€‰é¡¹é€‰é¡¹ã€‚</p><h2 id="å…¨å±€è¡¥ä¸ç¤ºä¾‹ï¼šé˜»æ­¢è¿œç¨‹æ“ä½œçš„â€œè¯·æ±‚â€"><a href="#å…¨å±€è¡¥ä¸ç¤ºä¾‹ï¼šé˜»æ­¢è¿œç¨‹æ“ä½œçš„â€œè¯·æ±‚â€" class="headerlink" title="å…¨å±€è¡¥ä¸ç¤ºä¾‹ï¼šé˜»æ­¢è¿œç¨‹æ“ä½œçš„â€œè¯·æ±‚â€"></a>å…¨å±€è¡¥ä¸ç¤ºä¾‹ï¼šé˜»æ­¢è¿œç¨‹æ“ä½œçš„â€œè¯·æ±‚â€</h2><p>å¦‚æœä½ æƒ³é˜»æ­¢â€œrequestsâ€åº“åœ¨æ‰€æœ‰æµ‹è¯•ä¸­æ‰§è¡Œhttpè¯·æ±‚ï¼Œä½ å¯ä»¥æ‰§è¡Œä»¥ä¸‹æ“ä½œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># contents of conftest.py</span><br><span class="hljs-keyword">import</span> pytest<br><br><br><span class="hljs-meta">@pytest.fixture(<span class="hljs-params">autouse=<span class="hljs-literal">True</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">no_requests</span>(<span class="hljs-params">monkeypatch</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Remove requests.sessions.Session.request for all tests.&quot;&quot;&quot;</span><br>    monkeypatch.<span class="hljs-built_in">delattr</span>(<span class="hljs-string">&quot;requests.sessions.Session.request&quot;</span>)<br></code></pre></td></tr></table></figure><p>æ­¤è‡ªåŠ¨ä½¿ç”¨è£…ç½®å°†é’ˆå¯¹æ¯ä¸ªæµ‹è¯•åŠŸèƒ½æ‰§è¡Œï¼Œå®ƒå°†åˆ é™¤è¯¥æ–¹æ³•<code>request.session.Session.request</code> ï¼Œä»¥ä¾¿åœ¨æµ‹è¯•ä¸­åˆ›å»º http è¯·æ±‚çš„ä»»ä½•å°è¯•éƒ½å°†å¤±è´¥ã€‚</p><h2 id="Monkeypatching-ç¯å¢ƒå˜é‡"><a href="#Monkeypatching-ç¯å¢ƒå˜é‡" class="headerlink" title="Monkeypatching ç¯å¢ƒå˜é‡"></a>Monkeypatching ç¯å¢ƒå˜é‡</h2><p>å¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œåˆ™ç»å¸¸éœ€è¦å®‰å…¨åœ°æ›´æ”¹å€¼æˆ–å°†å…¶ä»ç³»ç»Ÿä¸­åˆ é™¤ä»¥è¿›è¡Œæµ‹è¯•ã€‚æä¾›äº†ä¸€ç§ä½¿ç”¨andæ–¹æ³•<code>monkeypatch</code>æ‰§è¡Œæ­¤æ“ä½œçš„æœºåˆ¶ã€‚æˆ‘ä»¬çš„ç¤ºä¾‹ä»£ç ç”¨äºæµ‹è¯•ï¼š<code>setenv``delenv</code></p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment"># contents of our original code file e.g. code.py</span><br><span class="hljs-keyword">import</span> os<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_os_user_lower</span>():<br>    <span class="hljs-string">&quot;&quot;&quot;Simple retrieval function.</span><br><span class="hljs-string">    Returns lowercase USER or raises OSError.&quot;&quot;&quot;</span><br>    username = os.getenv(<span class="hljs-string">&quot;USER&quot;</span>)<br><br>    <span class="hljs-keyword">if</span> username <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-keyword">raise</span> OSError(<span class="hljs-string">&quot;USER environment is not set.&quot;</span>)<br><br>    <span class="hljs-keyword">return</span> username.lower()<br></code></pre></td></tr></table></figure><p>æœ‰ä¸¤ç§å¯èƒ½çš„è·¯å¾„ã€‚é¦–å…ˆï¼Œ<code>USER</code>ç¯å¢ƒå˜é‡è¢«è®¾ç½®ä¸ºä¸€ä¸ªå€¼ã€‚å…¶æ¬¡ï¼Œ<code>USER</code>ç¯å¢ƒå˜é‡ä¸å­˜åœ¨ã€‚ä½¿ç”¨è¿™<code>monkeypatch</code> ä¸¤ç§è·¯å¾„éƒ½å¯ä»¥å®‰å…¨åœ°è¿›è¡Œæµ‹è¯•ï¼Œè€Œä¸ä¼šå½±å“è¿è¡Œç¯å¢ƒï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># contents of our test file e.g. test_code.py</span><br><span class="hljs-keyword">import</span> pytest<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_upper_to_lower</span>(<span class="hljs-params">monkeypatch</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Set the USER env var to assert the behavior.&quot;&quot;&quot;</span><br>    monkeypatch.setenv(<span class="hljs-string">&quot;USER&quot;</span>, <span class="hljs-string">&quot;TestingUser&quot;</span>) <span class="hljs-comment"># è®¾ç½®ç¯å¢ƒå˜é‡</span><br>    <span class="hljs-keyword">assert</span> get_os_user_lower() == <span class="hljs-string">&quot;testinguser&quot;</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_raise_exception</span>(<span class="hljs-params">monkeypatch</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Remove the USER env var and assert OSError is raised.&quot;&quot;&quot;</span><br>    monkeypatch.delenv(<span class="hljs-string">&quot;USER&quot;</span>, raising=<span class="hljs-literal">False</span>)<br><br>    <span class="hljs-keyword">with</span> pytest.raises(OSError):<br>        _ = get_os_user_lower()<br></code></pre></td></tr></table></figure><p>æ­¤è¡Œä¸ºå¯ä»¥ç§»è‡³<code>fixture</code>ç»“æ„ä¸­å¹¶åœ¨æµ‹è¯•ä¹‹é—´å…±äº«ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># contents of our test file e.g. test_code.py</span><br><span class="hljs-keyword">import</span> pytest<br><br><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">mock_env_user</span>(<span class="hljs-params">monkeypatch</span>):<br>    monkeypatch.setenv(<span class="hljs-string">&quot;USER&quot;</span>, <span class="hljs-string">&quot;TestingUser&quot;</span>)<br><br><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">mock_env_missing</span>(<span class="hljs-params">monkeypatch</span>):<br>    monkeypatch.delenv(<span class="hljs-string">&quot;USER&quot;</span>, raising=<span class="hljs-literal">False</span>)<br><br><br><span class="hljs-comment"># notice the tests reference the fixtures for mocks</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_upper_to_lower</span>(<span class="hljs-params">mock_env_user</span>):<br>    <span class="hljs-keyword">assert</span> get_os_user_lower() == <span class="hljs-string">&quot;testinguser&quot;</span><br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_raise_exception</span>(<span class="hljs-params">mock_env_missing</span>):<br>    <span class="hljs-keyword">with</span> pytest.raises(OSError):<br>        _ = get_os_user_lower()<br></code></pre></td></tr></table></figure><h2 id="Monkeypatching-å­—å…¸"><a href="#Monkeypatching-å­—å…¸" class="headerlink" title="Monkeypatching å­—å…¸"></a>Monkeypatching å­—å…¸</h2><p><a href="https://docs.pytest.org/en/8.0.x/reference/reference.html#pytest.MonkeyPatch.setitem"><code>monkeypatch.setitem</code></a>å¯ç”¨äºåœ¨æµ‹è¯•æœŸé—´å®‰å…¨åœ°å°†å­—å…¸çš„å€¼è®¾ç½®ä¸ºç‰¹å®šå€¼ã€‚ä»¥ä¸‹æ˜¯ç®€åŒ–çš„è¿æ¥å­—ç¬¦ä¸²ç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># contents of app.py to generate a simple connection string</span><br>DEFAULT_CONFIG = &#123;<span class="hljs-string">&quot;user&quot;</span>: <span class="hljs-string">&quot;user1&quot;</span>, <span class="hljs-string">&quot;database&quot;</span>: <span class="hljs-string">&quot;db1&quot;</span>&#125;<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_connection_string</span>(<span class="hljs-params">config=<span class="hljs-literal">None</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Creates a connection string from input or defaults.&quot;&quot;&quot;</span><br>    config = config <span class="hljs-keyword">or</span> DEFAULT_CONFIG<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;User Id=<span class="hljs-subst">&#123;config[<span class="hljs-string">&#x27;user&#x27;</span>]&#125;</span>; Location=<span class="hljs-subst">&#123;config[<span class="hljs-string">&#x27;database&#x27;</span>]&#125;</span>;&quot;</span><br></code></pre></td></tr></table></figure><p>ä¸ºäº†æµ‹è¯•ç›®çš„ï¼Œæˆ‘ä»¬å¯ä»¥å°†<code>DEFAULT_CONFIG</code>å­—å…¸ä¿®è¡¥ä¸ºç‰¹å®šå€¼ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># contents of test_app.py</span><br><span class="hljs-comment"># app.py with the connection string function (prior code block)</span><br><span class="hljs-keyword">import</span> app<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_connection</span>(<span class="hljs-params">monkeypatch</span>):<br>    <span class="hljs-comment"># Patch the values of DEFAULT_CONFIG to specific</span><br>    <span class="hljs-comment"># testing values only for this test.</span><br>    monkeypatch.setitem(app.DEFAULT_CONFIG, <span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;test_user&quot;</span>)<br>    monkeypatch.setitem(app.DEFAULT_CONFIG, <span class="hljs-string">&quot;database&quot;</span>, <span class="hljs-string">&quot;test_db&quot;</span>)<br><br>    <span class="hljs-comment"># expected result based on the mocks</span><br>    expected = <span class="hljs-string">&quot;User Id=test_user; Location=test_db;&quot;</span><br><br>    <span class="hljs-comment"># the test uses the monkeypatched dictionary settings</span><br>    result = app.create_connection_string()<br>    <span class="hljs-keyword">assert</span> result == expected<br></code></pre></td></tr></table></figure><p>æ‚¨å¯ä»¥ä½¿ç”¨<a href="https://docs.pytest.org/en/8.0.x/reference/reference.html#pytest.MonkeyPatch.delitem"><code>monkeypatch.delitem</code></a>æ¥åˆ é™¤å€¼ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># contents of test_app.py</span><br><span class="hljs-keyword">import</span> pytest<br><br><span class="hljs-comment"># app.py with the connection string function</span><br><span class="hljs-keyword">import</span> app<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_missing_user</span>(<span class="hljs-params">monkeypatch</span>):<br>    <span class="hljs-comment"># patch the DEFAULT_CONFIG t be missing the &#x27;user&#x27; key</span><br>    monkeypatch.delitem(app.DEFAULT_CONFIG, <span class="hljs-string">&quot;user&quot;</span>, raising=<span class="hljs-literal">False</span>)<br><br>    <span class="hljs-comment"># Key error expected because a config is not passed, and the</span><br>    <span class="hljs-comment"># default is now missing the &#x27;user&#x27; entry.</span><br>    <span class="hljs-keyword">with</span> pytest.raises(KeyError):<br>        _ = app.create_connection_string()<br></code></pre></td></tr></table></figure><p>è£…ç½®çš„æ¨¡å—åŒ–ä½¿æ‚¨å¯ä»¥çµæ´»åœ°ä¸ºæ¯ä¸ªæ½œåœ¨æ¨¡æ‹Ÿå®šä¹‰å•ç‹¬çš„è£…ç½®ï¼Œå¹¶åœ¨æ‰€éœ€çš„æµ‹è¯•ä¸­å¼•ç”¨å®ƒä»¬ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># contents of test_app.py</span><br><span class="hljs-keyword">import</span> pytest<br><br><span class="hljs-comment"># app.py with the connection string function</span><br><span class="hljs-keyword">import</span> app<br><br><br><span class="hljs-comment"># all of the mocks are moved into separated fixtures</span><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">mock_test_user</span>(<span class="hljs-params">monkeypatch</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Set the DEFAULT_CONFIG user to test_user.&quot;&quot;&quot;</span><br>    monkeypatch.setitem(app.DEFAULT_CONFIG, <span class="hljs-string">&quot;user&quot;</span>, <span class="hljs-string">&quot;test_user&quot;</span>)<br><br><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">mock_test_database</span>(<span class="hljs-params">monkeypatch</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Set the DEFAULT_CONFIG database to test_db.&quot;&quot;&quot;</span><br>    monkeypatch.setitem(app.DEFAULT_CONFIG, <span class="hljs-string">&quot;database&quot;</span>, <span class="hljs-string">&quot;test_db&quot;</span>)<br><br><br><span class="hljs-meta">@pytest.fixture</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">mock_missing_default_user</span>(<span class="hljs-params">monkeypatch</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Remove the user key from DEFAULT_CONFIG&quot;&quot;&quot;</span><br>    monkeypatch.delitem(app.DEFAULT_CONFIG, <span class="hljs-string">&quot;user&quot;</span>, raising=<span class="hljs-literal">False</span>)<br><br><br><span class="hljs-comment"># tests reference only the fixture mocks that are needed</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_connection</span>(<span class="hljs-params">mock_test_user, mock_test_database</span>):<br>    expected = <span class="hljs-string">&quot;User Id=test_user; Location=test_db;&quot;</span><br><br>    result = app.create_connection_string()<br>    <span class="hljs-keyword">assert</span> result == expected<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_missing_user</span>(<span class="hljs-params">mock_missing_default_user</span>):<br>    <span class="hljs-keyword">with</span> pytest.raises(KeyError):<br>        _ = app.create_connection_string()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç¬”è®°</tag>
      
      <tag>pytest</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>python ä¹‹ pytest å¸¸ç”¨æ’ä»¶ï¼ˆå…«ï¼‰</title>
    <link href="/2024/01/20/668python-%E4%B9%8B-pytest-%E5%B8%B8%E7%94%A8%E6%8F%92%E4%BB%B6%EF%BC%88%E5%85%AB%EF%BC%89/"/>
    <url>/2024/01/20/668python-%E4%B9%8B-pytest-%E5%B8%B8%E7%94%A8%E6%8F%92%E4%BB%B6%EF%BC%88%E5%85%AB%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€äº›pytestå¸¸ç”¨æ’ä»¶ä»‹ç»"><a href="#ä¸€äº›pytestå¸¸ç”¨æ’ä»¶ä»‹ç»" class="headerlink" title="ä¸€äº›pytestå¸¸ç”¨æ’ä»¶ä»‹ç»"></a>ä¸€äº›pytestå¸¸ç”¨æ’ä»¶ä»‹ç»</h1><p>[TOC]</p><h2 id="1ã€å¤±è´¥é‡è·‘"><a href="#1ã€å¤±è´¥é‡è·‘" class="headerlink" title="1ã€å¤±è´¥é‡è·‘"></a>1ã€å¤±è´¥é‡è·‘</h2><p>å®‰è£…ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">pip install pytest-rerunfailures<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨æ–¹å¼ä¸€ï¼šå‘½ä»¤è¡Œä½¿ç”¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">pytest test_class.py --reruns 5 --reruns-delay 1 -vs  #ï¼ˆå¤±è´¥åé‡æ–°è¿è¡Œ5æ¬¡ï¼Œæ¯æ¬¡é—´éš”1ç§’ï¼‰<br>pytest  --reruns 5 --reruns-delay 1 -vs test_class.py # æˆ–è€…æ”¾å‰é¢ä¹Ÿè¡Œ<br></code></pre></td></tr></table></figure><p>æµ‹è¯•ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pytest<br><br><br><span class="hljs-meta">@pytest.mark.parametrize(<span class="hljs-params"><span class="hljs-string">&#x27;x,y,result&#x27;</span>, [</span></span><br><span class="hljs-params"><span class="hljs-meta">    (<span class="hljs-params"><span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span></span>),</span></span><br><span class="hljs-params"><span class="hljs-meta">    (<span class="hljs-params"><span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span></span>),</span></span><br><span class="hljs-params"><span class="hljs-meta">    (<span class="hljs-params"><span class="hljs-number">100</span>, <span class="hljs-number">100</span>, <span class="hljs-number">200</span></span>),</span></span><br><span class="hljs-params"><span class="hljs-meta">    (<span class="hljs-params"><span class="hljs-number">0.1</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">0.2</span></span>),</span></span><br><span class="hljs-params"><span class="hljs-meta">    (<span class="hljs-params">-<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">2</span></span>)</span></span><br><span class="hljs-params"><span class="hljs-meta">], ids=[<span class="hljs-string">&#x27;err&#x27;</span>, <span class="hljs-string">&#x27;int&#x27;</span>, <span class="hljs-string">&#x27;bignum&#x27;</span>, <span class="hljs-string">&#x27;float&#x27;</span>, <span class="hljs-string">&#x27;negative&#x27;</span>]</span>)  </span><span class="hljs-comment"># å‚æ•°åŒ–</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_add</span>(<span class="hljs-params">x, y, result</span>):<br>    <span class="hljs-keyword">assert</span> result == x + y<br><br></code></pre></td></tr></table></figure><p>å‘½ä»¤è¡Œè¿è¡ŒåŠç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">$ pytest --reruns <span class="hljs-number">5</span> --reruns-delay <span class="hljs-number">1</span> -sv testcases/test_rerun.py::test_add<br><span class="hljs-comment"># æˆ–è€… pytest testcases/test_rerun.py::test_add --reruns 5 --reruns-delay 1 -sv </span><br>============================= test session starts ==============================<br><span class="hljs-comment"># è¿è¡Œç»“æœå’Œä¸‹é¢æ–¹å¼äºŒçš„ä¸€è‡´</span><br>=========================== short test summary info ============================<br>FAILED testcases/test_rerun.py::test_add[int0] - <span class="hljs-keyword">assert</span> <span class="hljs-number">4</span> == (<span class="hljs-number">1</span> + <span class="hljs-number">2</span>)<br>===================== <span class="hljs-number">1</span> failed, <span class="hljs-number">4</span> passed, <span class="hljs-number">5</span> rerun <span class="hljs-keyword">in</span> <span class="hljs-number">5.06</span>s =====================<br>Finished running tests!<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨æ–¹å¼äºŒï¼šè£…é¥°å™¨è£…é¥°åè¿è¡Œã€è¿™ä¸ªæ¯”è¾ƒå¥½ç”¨ã€‘</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pytest<br><br><br><span class="hljs-meta">@pytest.mark.parametrize(<span class="hljs-params"><span class="hljs-string">&#x27;x,y,result&#x27;</span>, [</span></span><br><span class="hljs-params"><span class="hljs-meta">    (<span class="hljs-params"><span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span></span>),</span></span><br><span class="hljs-params"><span class="hljs-meta">    (<span class="hljs-params"><span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span></span>),</span></span><br><span class="hljs-params"><span class="hljs-meta">    (<span class="hljs-params"><span class="hljs-number">100</span>, <span class="hljs-number">100</span>, <span class="hljs-number">200</span></span>),</span></span><br><span class="hljs-params"><span class="hljs-meta">    (<span class="hljs-params"><span class="hljs-number">0.1</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">0.2</span></span>),</span></span><br><span class="hljs-params"><span class="hljs-meta">    (<span class="hljs-params">-<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">2</span></span>)</span></span><br><span class="hljs-params"><span class="hljs-meta">], ids=[<span class="hljs-string">&#x27;int&#x27;</span>, <span class="hljs-string">&#x27;int&#x27;</span>, <span class="hljs-string">&#x27;bignum&#x27;</span>, <span class="hljs-string">&#x27;float&#x27;</span>, <span class="hljs-string">&#x27;fushu&#x27;</span>]</span>)  </span><span class="hljs-comment"># å‚æ•°åŒ–</span><br><span class="hljs-meta">@pytest.mark.flaky(<span class="hljs-params">reruns=<span class="hljs-number">3</span>, reruns_delay=<span class="hljs-number">2</span></span>) </span><span class="hljs-comment"># è¿™é‡Œçš„flakyæ˜¯pytest-rerunfailuresæ’ä»¶æä¾›çš„åœ¨makrå‡½æ•°ä¸ŠåŠ¨æ€æ·»åŠ çš„å±æ€§ï¼Œ__getattr__æ–¹æ³•å¯ä»¥è·å–å±æ€§</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_add</span>(<span class="hljs-params">x, y, result</span>):<br>    <span class="hljs-keyword">assert</span> result == x + y<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœä¸¤è€…ä¸€æ ·</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python">============================= test session starts ==============================<br>platform linux -- Python <span class="hljs-number">3.10</span><span class="hljs-number">.12</span>, pytest-<span class="hljs-number">8.1</span><span class="hljs-number">.1</span>, pluggy-<span class="hljs-number">1.4</span><span class="hljs-number">.0</span> -- /home/wang/code/fastApiStudy/venvadmin/<span class="hljs-built_in">bin</span>/python<br>cachedir: .pytest_cache<br>rootdir: /home/wang/code/fastApiStudy<br>configfile: pytest.ini<br>plugins: anyio-<span class="hljs-number">4.2</span><span class="hljs-number">.0</span>, rerunfailures-<span class="hljs-number">14.0</span><br>collecting ... collected <span class="hljs-number">5</span> items<br><br>testcases/test_rerun.py::test_add[bignum] PASSED<br>testcases/test_rerun.py::test_add[fushu] PASSED<br>testcases/test_rerun.py::test_add[<span class="hljs-built_in">float</span>] PASSED<br>testcases/test_rerun.py::test_add[int1] PASSED<br>testcases/test_rerun.py::test_add[int0] RERUN<br>testcases/test_rerun.py::test_add[int0] RERUN<br>testcases/test_rerun.py::test_add[int0] RERUN<br>testcases/test_rerun.py::test_add[int0] RERUN<br>testcases/test_rerun.py::test_add[int0] RERUN<br>testcases/test_rerun.py::test_add[int0] FAILED<br><br>=================================== FAILURES ===================================<br>________________________________ test_add[int0] ________________________________<br><br>x = <span class="hljs-number">1</span>, y = <span class="hljs-number">2</span>, result = <span class="hljs-number">4</span><br><br><span class="hljs-meta">    @pytest.mark.parametrize(<span class="hljs-params"><span class="hljs-string">&#x27;x,y,result&#x27;</span>, [</span></span><br><span class="hljs-params"><span class="hljs-meta">        (<span class="hljs-params"><span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span></span>),</span></span><br><span class="hljs-params"><span class="hljs-meta">        (<span class="hljs-params"><span class="hljs-number">2</span>, <span class="hljs-number">2</span>, <span class="hljs-number">4</span></span>),</span></span><br><span class="hljs-params"><span class="hljs-meta">        (<span class="hljs-params"><span class="hljs-number">100</span>, <span class="hljs-number">100</span>, <span class="hljs-number">200</span></span>),</span></span><br><span class="hljs-params"><span class="hljs-meta">        (<span class="hljs-params"><span class="hljs-number">0.1</span>, <span class="hljs-number">0.1</span>, <span class="hljs-number">0.2</span></span>),</span></span><br><span class="hljs-params"><span class="hljs-meta">        (<span class="hljs-params">-<span class="hljs-number">1</span>, -<span class="hljs-number">1</span>, -<span class="hljs-number">2</span></span>)</span></span><br><span class="hljs-params"><span class="hljs-meta">    ], ids=[<span class="hljs-string">&#x27;int&#x27;</span>, <span class="hljs-string">&#x27;int&#x27;</span>, <span class="hljs-string">&#x27;bignum&#x27;</span>, <span class="hljs-string">&#x27;float&#x27;</span>, <span class="hljs-string">&#x27;fushu&#x27;</span>]</span>)  </span><span class="hljs-comment"># å‚æ•°åŒ–</span><br><span class="hljs-meta">    @pytest.mark.flaky(<span class="hljs-params">reruns=<span class="hljs-number">5</span>, reruns_delay=<span class="hljs-number">1</span></span>) </span><span class="hljs-comment"># è¿™é‡Œçš„flakyæ˜¯pytest-rerunfailuresæ’ä»¶æä¾›çš„åœ¨makrå‡½æ•°ä¸ŠåŠ¨æ€æ·»åŠ çš„å±æ€§ï¼Œ__getattr__æ–¹æ³•å¯ä»¥è·å–å±æ€§</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">test_add</span>(<span class="hljs-params">x, y, result</span>):<br>&gt;       <span class="hljs-keyword">assert</span> result == x + y<br>E       <span class="hljs-keyword">assert</span> <span class="hljs-number">4</span> == (<span class="hljs-number">1</span> + <span class="hljs-number">2</span>)<br><br>testcases/test_rerun.py:<span class="hljs-number">13</span>: AssertionError<br>=========================== short test summary info ============================<br>FAILED testcases/test_rerun.py::test_add[int0] - <span class="hljs-keyword">assert</span> <span class="hljs-number">4</span> == (<span class="hljs-number">1</span> + <span class="hljs-number">2</span>)<br>===================== <span class="hljs-number">1</span> failed, <span class="hljs-number">4</span> passed, <span class="hljs-number">5</span> rerun <span class="hljs-keyword">in</span> <span class="hljs-number">5.06</span>s =====================<br>Finished running tests!<br></code></pre></td></tr></table></figure><h2 id="2ã€å¤šé‡æ ¡éªŒpytest-assume"><a href="#2ã€å¤šé‡æ ¡éªŒpytest-assume" class="headerlink" title="2ã€å¤šé‡æ ¡éªŒpytest-assume"></a>2ã€å¤šé‡æ ¡éªŒpytest-assume</h2><p>æ­£å¸¸æƒ…å†µåœ¨ä¸€æ¡æµ‹è¯•ç”¨ä¾‹å†…å¦‚æœæœ‰å¤šæ¡æ–­è¨€ï¼Œå½“ä»£ç èµ°åˆ°æŸæ¡æ–­è¨€å¤±è´¥äº†ï¼Œåé¢çš„å…¶ä»–æ–­è¨€å°±ä¸ä¼šç»§ç»­æ‰§è¡Œä¸‹å»äº†ï¼Œè€Œä½¿ç”¨<code>pytest-assume</code>æ’ä»¶å°±å¯ä»¥ç»§ç»­æ‰§è¡Œä¸‹å»</p><p>ä½†æ˜¯è¿™ä¸ªæ’ä»¶æ„Ÿè§‰æ²¡å¿…è¦ï¼Œå¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå¤±è´¥å°±æ˜¯å¤±è´¥ã€‚ä¸éœ€è¦ç»§ç»­æ‰§è¡Œï¼Œé™¤éç‰¹åˆ«æƒ…å†µ</p><p>ä¸‹è½½å®‰è£…</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install pytest-assume<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨æ–¹å¼ï¼šä¸ç”¨ç‰¹åˆ«æ“ä½œï¼Œç›´æ¥ç”¨å°±è¡Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pytest<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_assume</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;1ã€é”™è¯¯æ“ä½œ&#x27;</span>)<br>    pytest.assume(<span class="hljs-number">1</span> == <span class="hljs-number">2</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;2ã€æ­£ç¡®æ“ä½œ&#x27;</span>)<br>    pytest.assume(<span class="hljs-number">2</span> == <span class="hljs-number">2</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;3ã€é”™è¯¯æ“ä½œ&#x27;</span>)<br>    pytest.assume(<span class="hljs-number">3</span> == <span class="hljs-number">2</span>)<br></code></pre></td></tr></table></figure><p>æµ‹è¯•ç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs python">============================= test session starts ==============================<br>platform linux -- Python <span class="hljs-number">3.10</span><span class="hljs-number">.12</span>, pytest-<span class="hljs-number">8.1</span><span class="hljs-number">.1</span>, pluggy-<span class="hljs-number">1.4</span><span class="hljs-number">.0</span> -- /home/wang/code/fastApiStudy/venvadmin/<span class="hljs-built_in">bin</span>/python<br>cachedir: .pytest_cache<br>rootdir: /home/wang/code/<br>configfile: pytest.ini<br>plugins: anyio-<span class="hljs-number">4.2</span><span class="hljs-number">.0</span>, assume-<span class="hljs-number">2.4</span><span class="hljs-number">.3</span>, rerunfailures-<span class="hljs-number">14.0</span><br>collecting ... collected <span class="hljs-number">1</span> item<br><br>testcases/test_rerun.py::test_assume <span class="hljs-number">1</span>ã€é”™è¯¯æ“ä½œ<br><span class="hljs-number">2</span>ã€æ­£ç¡®æ“ä½œ<br><span class="hljs-number">3</span>ã€é”™è¯¯æ“ä½œ<br>FAILED<br><br>=================================== FAILURES ===================================<br>_________________________________ test_assume __________________________________<br><br>tp = &lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;pytest_assume.plugin.FailedAssumption&#x27;</span>&gt;, value = <span class="hljs-literal">None</span>, tb = <span class="hljs-literal">None</span><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">reraise</span>(<span class="hljs-params">tp, value, tb=<span class="hljs-literal">None</span></span>):<br>        <span class="hljs-keyword">try</span>:<br>            <span class="hljs-keyword">if</span> value <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br>                value = tp()<br>            <span class="hljs-keyword">if</span> value.__traceback__ <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> tb:<br>&gt;               <span class="hljs-keyword">raise</span> value.with_traceback(tb)<br>E               pytest_assume.plugin.FailedAssumption: <br>E               <span class="hljs-number">2</span> Failed Assumptions:<br>E               <br>E               testcases/test_rerun.py:<span class="hljs-number">17</span>: AssumptionFailure<br>E               &gt;&gt;      pytest.assume(<span class="hljs-number">1</span> == <span class="hljs-number">2</span>)<br>E               AssertionError: <span class="hljs-keyword">assert</span> <span class="hljs-literal">False</span><br>E               <br>E               testcases/test_rerun.py:<span class="hljs-number">21</span>: AssumptionFailure<br>E               &gt;&gt;      pytest.assume(<span class="hljs-number">3</span> == <span class="hljs-number">2</span>)<br>E               AssertionError: <span class="hljs-keyword">assert</span> <span class="hljs-literal">False</span><br><br>venvadmin/lib/python3<span class="hljs-number">.10</span>/site-packages/six.py:<span class="hljs-number">718</span>: FailedAssumption<br>=============================== warnings summary ===============================<br>testcases/test_rerun.py::test_assume<br>  /home/wang/code/fastApiStudy/venvadmin/lib/python3<span class="hljs-number">.10</span>/site-packages/_pytest/runner.py:<span class="hljs-number">240</span>: PluggyTeardownRaisedWarning: A plugin raised an exception during an old-style hookwrapper teardown.<br>  Plugin: assume, Hook: pytest_runtest_call<br>  FailedAssumption: <br>  <span class="hljs-number">2</span> Failed Assumptions:<br>  <br>  testcases/test_rerun.py:<span class="hljs-number">17</span>: AssumptionFailure<br>  &gt;&gt;    pytest.assume(<span class="hljs-number">1</span> == <span class="hljs-number">2</span>)<br>  AssertionError: <span class="hljs-keyword">assert</span> <span class="hljs-literal">False</span><br>  <br>  testcases/test_rerun.py:<span class="hljs-number">21</span>: AssumptionFailure<br>  &gt;&gt;    pytest.assume(<span class="hljs-number">3</span> == <span class="hljs-number">2</span>)<br>  AssertionError: <span class="hljs-keyword">assert</span> <span class="hljs-literal">False</span><br>  <br>  <br>  For more information see https://pluggy.readthedocs.io/en/stable/api_reference.html<span class="hljs-comment">#pluggy.PluggyTeardownRaisedWarning</span><br>    <span class="hljs-keyword">lambda</span>: runtest_hook(item=item, **kwds), when=when, reraise=reraise<br><br>-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html<br>=========================== short test summary info ============================<br>FAILED testcases/test_rerun.py::test_assume - pytest_assume.plugin.FailedAssu...<br>========================= <span class="hljs-number">1</span> failed, <span class="hljs-number">1</span> warning <span class="hljs-keyword">in</span> <span class="hljs-number">0.02</span>s =========================<br>Finished running tests!<br></code></pre></td></tr></table></figure><h2 id="3ã€è®¾å®šç”¨ä¾‹æ‰§è¡Œé¡ºåº-pytest-ordering"><a href="#3ã€è®¾å®šç”¨ä¾‹æ‰§è¡Œé¡ºåº-pytest-ordering" class="headerlink" title="3ã€è®¾å®šç”¨ä¾‹æ‰§è¡Œé¡ºåº pytest-ordering"></a>3ã€è®¾å®šç”¨ä¾‹æ‰§è¡Œé¡ºåº pytest-ordering</h2><p>æ­£å¸¸æƒ…å†µï¼Œç”¨ä¾‹ä¼šæŒ‰ç…§ä»£ç æ‰§è¡Œé¡ºåºï¼Œä»ä¸Šè€Œä¸‹çš„æ‰§è¡Œï¼Œä½¿ç”¨<code>ordering</code>æ’ä»¶å¯è‡ªå®šä¹‰æ‰§è¡Œé¡ºåº</p><p>å®‰è£…ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install  pytest-ordering<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨æ–¹æ³•ï¼šåœ¨ç”¨ä¾‹ä¸Šé¢åŠ è£…é¥°å™¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@pytest.mark.run(<span class="hljs-params">order=<span class="hljs-number">2</span></span>) </span><span class="hljs-comment"># é¡ºåºä¸º2å·</span><br></code></pre></td></tr></table></figure><p>ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@pytest.mark.run(<span class="hljs-params">order=<span class="hljs-number">1</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_case1</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;case1&#x27;</span>)<br><br><span class="hljs-meta">@pytest.mark.run(<span class="hljs-params">order=<span class="hljs-number">4</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_case4</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;case4&#x27;</span>)<br>    <br><span class="hljs-meta">@pytest.mark.run(<span class="hljs-params">order=<span class="hljs-number">3</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_case3</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;case3&#x27;</span>)<br><br><span class="hljs-meta">@pytest.mark.run(<span class="hljs-params">order=<span class="hljs-number">2</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_case2</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;case2&#x27;</span>)<br></code></pre></td></tr></table></figure><p>è¿è¡Œç»“æœ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python">============================= test session starts ==============================<br>platform linux -- Python <span class="hljs-number">3.10</span><span class="hljs-number">.12</span>, pytest-<span class="hljs-number">8.1</span><span class="hljs-number">.1</span>, pluggy-<span class="hljs-number">1.4</span><span class="hljs-number">.0</span> -- /home/wang/code/fastApiStudy/venvadmin/<span class="hljs-built_in">bin</span>/python<br>cachedir: .pytest_cache<br>rootdir: /home/wang/code/<br>configfile: pytest.ini<br>plugins: anyio-<span class="hljs-number">4.2</span><span class="hljs-number">.0</span>, ordering-<span class="hljs-number">0.6</span>, rerunfailures-<span class="hljs-number">14.0</span><br>collecting ... collected <span class="hljs-number">4</span> items<br><br>testcases/test_rerun.py::test_case1 case1<br>PASSED<br>testcases/test_rerun.py::test_case2 case2<br>PASSED<br>testcases/test_rerun.py::test_case3 case3<br>PASSED<br>testcases/test_rerun.py::test_case4 case4<br>PASSED<br><br>============================== <span class="hljs-number">4</span> passed <span class="hljs-keyword">in</span> <span class="hljs-number">0.01</span>s ===============================<br>Finished running tests!<br></code></pre></td></tr></table></figure><h3 id="ç”¨ä¾‹ä¾èµ–ï¼ˆpytest-dependencyï¼‰"><a href="#ç”¨ä¾‹ä¾èµ–ï¼ˆpytest-dependencyï¼‰" class="headerlink" title="ç”¨ä¾‹ä¾èµ–ï¼ˆpytest-dependencyï¼‰"></a>ç”¨ä¾‹ä¾èµ–ï¼ˆpytest-dependencyï¼‰</h3><p>ä½¿ç”¨è¯¥æ’ä»¶å¯ä»¥æ ‡è®°ä¸€ä¸ªtestcaseä½œä¸ºå…¶ä»–testcaseçš„ä¾èµ–ï¼Œå½“ä¾èµ–é¡¹æ‰§è¡Œå¤±è´¥æ—¶ï¼Œé‚£äº›ä¾èµ–å®ƒçš„testå°†ä¼šè¢«è·³è¿‡ã€‚</p><p>å®‰è£…  ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install pytest-dependency<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨æ–¹æ³•ï¼š</p><p> ç”¨ @pytest.mark.dependency()å¯¹æ‰€ä¾èµ–çš„æ–¹æ³•è¿›è¡Œæ ‡è®°ï¼Œ</p><p>ä½¿ç”¨@pytest.mark.dependency(depends&#x3D;[â€œtest_nameâ€])å¼•ç”¨ä¾èµ–,test_nameå¯ä»¥æ˜¯å¤šä¸ªã€‚</p><p>ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pytest<br><br><span class="hljs-meta">@pytest.mark.dependency()</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_01</span>():<br>    <span class="hljs-keyword">assert</span> <span class="hljs-literal">False</span><br><br><span class="hljs-meta">@pytest.mark.dependency(<span class="hljs-params">depends=[<span class="hljs-string">&quot;test_01&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_02</span>():<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ‰§è¡Œæµ‹è¯•2&quot;</span>)<br></code></pre></td></tr></table></figure><p>æ‰§è¡Œç”¨ä¾‹test_02åçš„è¿è¡Œç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python">============================= test session starts ==============================<br>platform linux -- Python <span class="hljs-number">3.10</span><span class="hljs-number">.12</span>, pytest-<span class="hljs-number">8.1</span><span class="hljs-number">.1</span>, pluggy-<span class="hljs-number">1.4</span><span class="hljs-number">.0</span> -- /home/wang/code/fastApiStudy/venvadmin/<span class="hljs-built_in">bin</span>/python<br>cachedir: .pytest_cache<br>rootdir: /home/wang/code/<br>configfile: pytest.ini<br>plugins: anyio-<span class="hljs-number">4.2</span><span class="hljs-number">.0</span>, dependency-<span class="hljs-number">0.6</span><span class="hljs-number">.0</span>, ordering-<span class="hljs-number">0.6</span>, rerunfailures-<span class="hljs-number">14.0</span><br>collecting ... collected <span class="hljs-number">1</span> item<br><br>testcases/test_rerun.py::test_02 SKIPPED (test_02 depends on test_01) <span class="hljs-comment"># test_02 ä¾èµ– test_01</span><br><br>============================== <span class="hljs-number">1</span> skipped <span class="hljs-keyword">in</span> <span class="hljs-number">0.01</span>s ==============================<br>Finished running tests!<br></code></pre></td></tr></table></figure><h3 id="åˆ†å¸ƒå¼æµ‹è¯•-pytest-xdist"><a href="#åˆ†å¸ƒå¼æµ‹è¯•-pytest-xdist" class="headerlink" title="åˆ†å¸ƒå¼æµ‹è¯•(pytest-xdist)"></a>åˆ†å¸ƒå¼æµ‹è¯•(pytest-xdist)</h3><p>pytest-xdist æ’ä»¶ä½¿ç”¨æ–°çš„æµ‹è¯•æ‰§è¡Œæ¨¡å¼æ‰©å±•äº† pytestï¼Œæœ€å¸¸ç”¨çš„æ˜¯å°†æµ‹è¯•åˆ†å¸ƒåœ¨å¤šä¸ª CPU æ ¸å¿ƒä¸Šä»¥åŠ é€Ÿæµ‹è¯•æ‰§è¡Œï¼š æ ¸å¿ƒ&#x3D;è¿›ç¨‹</p><p>å®‰è£…ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">pip install pytest-xdist<br><span class="hljs-comment"># è¦ä½¿ç”¨ psutil æ£€æµ‹å¯ç”¨ CPU çš„æ•°é‡ï¼Œè¯·é¢å¤–å®‰è£… psutilï¼Œä¸€èˆ¬ä¸éœ€è¦</span><br>pip install pytest-xdist[psutil]<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pytest -n auto test_xxx.py<br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå‘½ä»¤è¡Œä¸­ï¼Œpytest å°†ç”Ÿæˆæ•°é‡ç­‰äºå¯ç”¨ CPU æ•°é‡çš„å·¥ä½œè¿›ç¨‹ï¼Œå¹¶åœ¨å®ƒä»¬ä¹‹é—´éšæœºåˆ†é…æµ‹è¯•ï¼Œæ¯”å¦‚è¯´ä½ cpuæ˜¯20æ ¸çš„ï¼Œæœ€å¤§åˆ†é…20ä¸ªè¿›ç¨‹æ•°</p><blockquote><p>ç”±äº pytest-xdist çš„å®ç°æ–¹å¼ï¼Œ å½“å‘½ä»¤è¡Œä¸­ä½¿ç”¨äº† -s&#x2F;â€“capture&#x3D;no é€‰é¡¹æ˜¯ä¸èµ·ä½œç”¨çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ç»ˆç«¯ä¸ä¼šæ‰“å°ä½ çš„printå†…å®¹ï¼Œä¹Ÿæ— æ³•ç¦ç”¨æ•è·</p></blockquote><p>ç‰¹å¾ï¼š</p><ul><li><p>è·¨å¤šä¸ª CPU è¿è¡Œæµ‹è¯•ï¼šå¯ä»¥è·¨å¤šä¸ª CPU æˆ–ä¸»æœºæ‰§è¡Œæµ‹è¯•ã€‚æˆ–ä½¿ç”¨SSHè¿›è¡Œè¿œç¨‹è´¦æˆ·è°ƒç”¨ã€‚</p></li><li><p><code>--looponfail</code>ï¼šåœ¨å­è¿›ç¨‹ä¸­é‡å¤è¿è¡Œæµ‹è¯•ã€‚æ¯æ¬¡è¿è¡Œå pytest éƒ½ä¼šç­‰å¾…ï¼Œç›´åˆ°é¡¹ç›®ä¸­çš„æ–‡ä»¶å‘ç”Ÿæ›´æ”¹ï¼Œç„¶åé‡æ–°è¿è¡Œä¹‹å‰å¤±è´¥çš„æµ‹è¯•ã€‚é‡å¤æ­¤æ“ä½œï¼Œç›´åˆ°æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼Œç„¶åå†æ¬¡æ‰§è¡Œå®Œæ•´è¿è¡Œï¼ˆå·²å¼ƒç”¨ï¼‰ã€‚</p></li><li><p>å‘è¿œç¨‹ SSH å¸æˆ·å‘é€æµ‹è¯•è¦†ç›–èŒƒå›´ï¼šæ‚¨å¯ä»¥æŒ‡å®šä¸åŒçš„ Python è§£é‡Šå™¨æˆ–ä¸åŒçš„å¹³å°ï¼Œå¹¶åœ¨æ‰€æœ‰è¿™äº›å¹³å°ä¸Šå¹¶è¡Œè¿è¡Œæµ‹è¯•ã€‚</p></li></ul><p>åœ¨è¿œç¨‹è¿è¡Œæµ‹è¯•ä¹‹å‰ï¼Œpytest ä¼šæœ‰æ•ˆåœ°å°†ç¨‹åºæºä»£ç â€œrsyncâ€åˆ°è¿œç¨‹ä½ç½®ã€‚å¯ä»¥æŒ‡å®šä¸åŒçš„ Python ç‰ˆæœ¬å’Œè§£é‡Šå™¨ã€‚ä½†æ˜¯ï¼Œå®ƒä¸ä¼šå®‰è£…&#x2F;åŒæ­¥ä¾èµ–é¡¹ã€‚</p><p>æ³¨æ„ï¼šè¿™ç§æ¨¡å¼çš„å­˜åœ¨ä¸»è¦æ˜¯ä¸ºäº†å‘åå…¼å®¹ï¼Œå› ä¸ºç°ä»£å¼€å‘ä¾èµ–äºå¤šå¹³å°æµ‹è¯•çš„æŒç»­é›†æˆã€‚</p><h2 id="è·¨å¤šä¸ª-CPU-è¿è¡Œæµ‹è¯•"><a href="#è·¨å¤šä¸ª-CPU-è¿è¡Œæµ‹è¯•" class="headerlink" title="è·¨å¤šä¸ª CPU è¿è¡Œæµ‹è¯•"></a>è·¨å¤šä¸ª CPU è¿è¡Œæµ‹è¯•</h2><p>è¦å°†æµ‹è¯•å‘é€åˆ°å¤šä¸ª CPUè¿›ç¨‹ä¸­æ‰§è¡Œï¼Œä½¿ç”¨ <code>-n</code> ï¼ˆæˆ– <code>--numprocesses</code>ï¼‰å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pytest -n auto<br></code></pre></td></tr></table></figure><ul><li><p>ä½¿ç”¨<code>-n auto</code>æ—¶ï¼Œ<code>pytest-xdist </code>å°†ä½¿ç”¨ä¸æœ¬æœºå…·æœ‰ CPU å†…æ ¸ä¸€æ ·å¤šçš„è¿›ç¨‹ ã€é»˜è®¤å¸¸ç”¨ã€‘</p></li><li><p>ä½¿ç”¨<code> -n logical</code>å¯ä½¿ç”¨é€»è¾‘ CPU æ ¸å¿ƒæ•°è€Œä¸æ˜¯ç‰©ç†æ ¸å¿ƒæ•°ã€‚å½“å‰éœ€è¦å®‰è£… psutil è½¯ä»¶åŒ…ï¼›å¦‚æœæ²¡ç”¨ï¼Œpytest-xdist å°†å›é€€åˆ° -n auto è¡Œä¸ºã€‚ã€ç”¨å¾—å°‘ã€‘è¿™é‡Œä¸å¤šè®²</p></li><li><p>ä½¿ç”¨<code>-n 8</code>æ—¶ï¼ŒæŒ‡å®š8ä¸ªè¿›ç¨‹æ‰§è¡Œ</p></li><li><p>ä¹Ÿå¯ä»¥ç›´æ¥æ¥åˆ°<code>pytest.ini</code>æ–‡ä»¶å½“ä¸­å» <code>addopts = -n auto</code></p></li></ul><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[pytest]</span><br><span class="hljs-attr">addopts</span> = -s -v -n auto<br></code></pre></td></tr></table></figure><p>ç»™ä¸€æ®µæµ‹è¯•ç”¨ä¾‹ï¼šç”¨é»˜è®¤å¹¶å‘æµ‹è¯•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> pytest<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_case1</span>():<br>    time.sleep(<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;çœ‹çœ‹ä¼šä¸ä¼šæ‰“å°ï¼šcase1&quot;</span>) <span class="hljs-comment"># ä¼šç¦ç”¨-s æ‰€ä»¥ä¸ä¼šæ‰“å°</span><br>    <br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_case2</span>():<br>    time.sleep(<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;çœ‹çœ‹ä¼šä¸ä¼šæ‰“å°ï¼šcase2&quot;</span>) <span class="hljs-comment"># ä¼šç¦ç”¨-s æ‰€ä»¥ä¸ä¼šæ‰“å°</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_case3</span>():<br>    time.sleep(<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;çœ‹çœ‹ä¼šä¸ä¼šæ‰“å°ï¼šcase3&quot;</span>) <span class="hljs-comment"># ä¼šç¦ç”¨-s æ‰€ä»¥ä¸ä¼šæ‰“å°</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test_case4</span>():<br>    time.sleep(<span class="hljs-number">1</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;çœ‹çœ‹ä¼šä¸ä¼šæ‰“å°ï¼šcase4&quot;</span>) <span class="hljs-comment"># ä¼šç¦ç”¨-s æ‰€ä»¥ä¸ä¼šæ‰“å°</span><br></code></pre></td></tr></table></figure><p>æµ‹è¯•ç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs python">============================= test session starts ==============================<br>platform linux -- Python <span class="hljs-number">3.10</span><span class="hljs-number">.12</span>, pytest-<span class="hljs-number">8.1</span><span class="hljs-number">.1</span>, pluggy-<span class="hljs-number">1.4</span><span class="hljs-number">.0</span> -- /home/wang/code/fastApiStudy/venvadmin/<span class="hljs-built_in">bin</span>/python<br>cachedir: .pytest_cache<br>rootdir: /home/wang/code/<br>configfile: pytest.ini<br>plugins: xdist-<span class="hljs-number">3.5</span><span class="hljs-number">.0</span>, anyio-<span class="hljs-number">4.2</span><span class="hljs-number">.0</span>, dependency-<span class="hljs-number">0.6</span><span class="hljs-number">.0</span>, ordering-<span class="hljs-number">0.6</span>, Faker-<span class="hljs-number">24.9</span><span class="hljs-number">.0</span>, rerunfailures-<span class="hljs-number">14.0</span><br>created: <span class="hljs-number">20</span>/<span class="hljs-number">20</span> workers <span class="hljs-comment"># åˆ›å»ºäº†20ä¸ªwokers è¿™é‡Œçš„20ä¸ª æ˜¯ä½ çš„cpuæ ¸å¿ƒæ•°ï¼Œä¹Ÿå°±æ˜¯è¿›ç¨‹æ•°</span><br><span class="hljs-number">20</span> workers [<span class="hljs-number">4</span> items] <span class="hljs-comment"># 20ä¸ªè¿›ç¨‹4ä¸ªé¡¹ç›®</span><br><br>scheduling tests via LoadScheduling<br><br>testcases/test_xdits_case.py::test_case4 <br>testcases/test_xdits_case.py::test_case1 <br>testcases/test_xdits_case.py::test_case2 <br>testcases/test_xdits_case.py::test_case3 <br><span class="hljs-comment"># è¿™é‡Œå¯ä»¥çœ‹åˆ°åˆ†é…äº†4ä¸ªè¿›ç¨‹å»æ‰§è¡Œ</span><br>[gw3] PASSED testcases/test_xdits_case.py::test_case4  <span class="hljs-comment"># gw3 å°±æ˜¯æŒ‡gevent worker 3</span><br>[gw1] PASSED testcases/test_xdits_case.py::test_case2 <br>[gw2] PASSED testcases/test_xdits_case.py::test_case3 <br>[gw0] PASSED testcases/test_xdits_case.py::test_case1 <br><br>============================== <span class="hljs-number">4</span> passed <span class="hljs-keyword">in</span> <span class="hljs-number">1.93</span>s ===============================<br>Finished running tests!<br><span class="hljs-comment"># å¦‚è¿‡-n æ˜¯ 2 çš„è¯</span><br>============================= test session starts ==============================<br>.........<br>created: <span class="hljs-number">2</span>/<span class="hljs-number">2</span> workers<br><span class="hljs-number">2</span> workers [<span class="hljs-number">4</span> items] <span class="hljs-comment"># 2ä¸ªè¿›ç¨‹</span><br><br>scheduling tests via LoadScheduling<br><br>testcases/test_xdits_case.py::test_case3 <br>testcases/test_xdits_case.py::test_case1 <br>[gw1] PASSED testcases/test_xdits_case.py::test_case3 <br>[gw0] PASSED testcases/test_xdits_case.py::test_case1 <br>testcases/test_xdits_case.py::test_case2 <br>testcases/test_xdits_case.py::test_case4 <br>[gw1] PASSED testcases/test_xdits_case.py::test_case4 <br>[gw0] PASSED testcases/test_xdits_case.py::test_case2 <br><br>============================== <span class="hljs-number">4</span> passed <span class="hljs-keyword">in</span> <span class="hljs-number">2.28</span>s ===============================<br></code></pre></td></tr></table></figure><p>å¯ä»¥ä½¿ç”¨ä»¥ä¸‹é€‰é¡¹è¿›ä¸€æ­¥é…ç½®å¹¶å‘ï¼š</p><ul><li><code>--maxprocesses=maxprocesses</code>: è®¾ç½®æœ€å¤§è¿›ç¨‹æ•°â€“å·¥äººæ•°  è¿™ä¸ªå’Œ<code>-n</code> æ‰€æŒ‡å®šçš„æ˜¯ä¸€ä¸ªæ„æ€ </li><li><code>--max-worker-restart</code>: å´©æºƒæ—¶å¯ä»¥é‡æ–°å¯åŠ¨çš„æœ€å¤§å·¥ä½œçº¿ç¨‹æ•°ï¼ˆè®¾ç½®ä¸ºé›¶ä»¥ç¦ç”¨æ­¤åŠŸèƒ½ï¼‰ã€‚</li></ul><p><code>--dist</code>è®¾å®šç”¨äºæ§åˆ¶åˆ†å¸ƒå¼æµ‹è¯•ä¸­çš„æµ‹è¯•ç”¨ä¾‹åŠ è½½å’Œåˆ†å‘æ–¹å¼ã€‚å®ƒæä¾›äº†ä¸åŒçš„é€‰é¡¹æ¥æ§åˆ¶æµ‹è¯•ç”¨ä¾‹çš„åŠ è½½å’Œåˆ†å‘è¡Œä¸ºï¼Œä»¥æ»¡è¶³ä¸åŒçš„éœ€æ±‚ã€‚(distribution)</p><ul><li><p><code>--dist load</code> <strong>(é»˜è®¤)</strong>: å°†æŒ‚èµ·çš„æµ‹è¯•å‘é€ç»™ä»»ä½•å¯ç”¨çš„workerå·¥ä½œçº¿ç¨‹ï¼Œä½†æ˜¯é¡ºåºæ˜¯ä¸å›ºå®šçš„ã€‚å¯ä»¥ä½¿ç”¨ <code>â€“maxschedchunk </code>é€‰é¡¹è¿›è¡Œå¾®è°ƒæ¥è°ƒæ•´ï¼Œè¯·å‚é˜… pytest â€“help çš„è¾“å‡ºã€‚</p></li><li><p><code>â€”â€”dist loadscope</code>: åœ¨ä¸»è¿›ç¨‹ä¸­åŠ è½½å’Œè¿è¡Œæµ‹è¯•ç”¨ä¾‹ï¼Œç„¶åå°†æµ‹è¯•ç”¨ä¾‹æŒ‰ç…§å…¶ä½œç”¨åŸŸï¼ˆscopeï¼‰åˆ†å‘åˆ°å·¥ä½œè¿›ç¨‹ã€‚è¿™ç§æ–¹å¼å¯ä»¥æ›´å¥½åœ°æ§åˆ¶æµ‹è¯•ç”¨ä¾‹çš„åŠ è½½è¡Œä¸ºï¼Œç‰¹åˆ«æ˜¯åœ¨ä½¿ç”¨_fixture_ç­‰ pytest åŠŸèƒ½æ—¶ã€‚æŒ‰ç±»åˆ†ç»„ä¼˜å…ˆäºæŒ‰æ¨¡å—åˆ†ç»„ã€‚çœ‹ä»£ç ï¼š</p></li><li><pre><code class="python">import timeimport pytestclass TestScope1: # ä¸€ä¸ªç±»ç®—ä¸€ä¸ªçº§åˆ«        def test_case1(self):        time.sleep(1)        print(&quot;çœ‹çœ‹ä¼šä¸ä¼šæ‰“å°ï¼šcase1&quot;)            def test_case2(self):        time.sleep(1)        print(&quot;çœ‹çœ‹ä¼šä¸ä¼šæ‰“å°ï¼šcase2&quot;)                class TestScope2:        def test_case3(self):        time.sleep(1)        print(&quot;çœ‹çœ‹ä¼šä¸ä¼šæ‰“å°ï¼šcase3&quot;)    def test_case4(self):        time.sleep(1)        print(&quot;çœ‹çœ‹ä¼šä¸ä¼šæ‰“å°ï¼šcase4&quot;)def test_case5(): # ä¸€ä¸ªæ–¹æ³•ç®—ä¸€ä¸ªçº§åˆ«        time.sleep(1)        print(&quot;çœ‹çœ‹ä¼šä¸ä¼šæ‰“å°ï¼šcase4&quot;)# åˆ†æä¸‹æµ‹è¯•ç»“æœ============================= test session starts ==============================........created: 20/20 workers20 workers [5 items] scheduling tests via LoadScopeSchedulingtestcases/test_xdits_case.py::TestScope1::test_case1 testcases/test_xdits_case.py::test_case5 testcases/test_xdits_case.py::TestScope2::test_case3 [gw2] PASSED testcases/test_xdits_case.py::test_case5  # gw2 æ¥æµ‹test_case5[gw1] PASSED testcases/test_xdits_case.py::TestScope2::test_case3  # gw1 æ¥æµ‹TestScope2[gw0] PASSED testcases/test_xdits_case.py::TestScope1::test_case1  # gw0 æ¥æµ‹TestScope1testcases/test_xdits_case.py::TestScope1::test_case2 testcases/test_xdits_case.py::TestScope2::test_case4 [gw1] PASSED testcases/test_xdits_case.py::TestScope2::test_case4 # gw1 æ¥æµ‹TestScope2[gw0] PASSED testcases/test_xdits_case.py::TestScope1::test_case2 # gw0 æ¥æµ‹TestScope1# æ€»å…±åˆ†äº†3ä¸ªè¿›ç¨‹å»åšæµ‹è¯•ï¼Œä¸€ä¸ªç±»ä¸€ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªæ–¹æ³•ä¸€ä¸ªè¿›ç¨‹ï¼Œ============================== 5 passed in 2.94s ===============================<figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs elixir"><br>- `â€”â€”dist loadgroup`<span class="hljs-symbol">:</span>å¯¹æµ‹è¯•ç”¨ä¾‹æŒ‰`xdist_groupæ ‡è®°`åˆ†ç»„ã€‚ä»¥ç»„ä¸ºå•ä½åˆ†é…ç»™å¯ç”¨çš„workerå·¥äººã€‚è¿™ä¿è¯äº†å…·æœ‰ç›¸åŒ`xdist_groupæ ‡è®°`çš„æ‰€æœ‰æµ‹è¯•éƒ½åœ¨åŒä¸€å·¥ä½œçº¿ç¨‹ä¸­è¿è¡Œã€‚å¦‚ä¸‹ï¼š<br><br>```python<br><br>class <span class="hljs-symbol">TestScope1:</span><br>    <span class="hljs-variable">@pytest</span>.mark.xdist_group(<span class="hljs-string">&quot;group1&quot;</span>)<br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_case1</span></span>(self):<br>        time.sleep(<span class="hljs-number">1</span>)<br>        print(<span class="hljs-string">&quot;çœ‹çœ‹ä¼šä¸ä¼šæ‰“å°ï¼šcase1&quot;</span>)<br>        <br>    <span class="hljs-variable">@pytest</span>.mark.xdist_group(<span class="hljs-string">&quot;group2&quot;</span>)<br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_case2</span></span>(self):<br>        time.sleep(<span class="hljs-number">1</span>)<br>        print(<span class="hljs-string">&quot;çœ‹çœ‹ä¼šä¸ä¼šæ‰“å°ï¼šcase2&quot;</span>)<br>        <br>        <br>class <span class="hljs-symbol">TestScope2:</span>    <br>    <span class="hljs-variable">@pytest</span>.mark.xdist_group(<span class="hljs-string">&quot;group2&quot;</span>)<br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_case3</span></span>(self):<br>        time.sleep(<span class="hljs-number">1</span>)<br>        print(<span class="hljs-string">&quot;çœ‹çœ‹ä¼šä¸ä¼šæ‰“å°ï¼šcase3&quot;</span>)<br>    <span class="hljs-variable">@pytest</span>.mark.xdist_group(<span class="hljs-string">&quot;group1&quot;</span>)<br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_case4</span></span>(self):<br>        time.sleep(<span class="hljs-number">1</span>)<br>        print(<span class="hljs-string">&quot;çœ‹çœ‹ä¼šä¸ä¼šæ‰“å°ï¼šcase4&quot;</span>)<br><span class="hljs-variable">@pytest</span>.mark.xdist_group(<span class="hljs-string">&quot;group2&quot;</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">test_case5</span></span>():<br>        time.sleep(<span class="hljs-number">1</span>)<br>        print(<span class="hljs-string">&quot;çœ‹çœ‹ä¼šä¸ä¼šæ‰“å°ï¼šcase4&quot;</span>)<br><span class="hljs-comment"># æµ‹è¯•ç»“æœåˆ†æä¸€ä¸‹</span><br>============================ test session starts ==============================<br>............<br><span class="hljs-symbol">created:</span> <span class="hljs-number">20</span>/<span class="hljs-number">20</span> workers<br><span class="hljs-number">20</span> workers [<span class="hljs-number">5</span> items]<br><br>scheduling tests via <span class="hljs-title class_">LoadGroupScheduling</span><br><span class="hljs-comment"># è¿™é‡Œå°±å¾ˆæ˜æ˜¾äº†ï¼Œå¯ä»¥çœ‹åˆ°å¯¹åº”çš„æµ‹è¯•è¢«åˆ†åˆ°å¯¹åº”çš„ç»„å»è¿è¡Œäº†</span><br>testcases/test_xdits_case.py::<span class="hljs-title class_">TestScope1</span>::test_case1<span class="hljs-variable">@group1</span> <br>testcases/test_xdits_case.py::<span class="hljs-title class_">TestScope1</span>::test_case2<span class="hljs-variable">@group2</span> <br>[gw0] <span class="hljs-title class_">PASSED</span> testcases/test_xdits_case.py::<span class="hljs-title class_">TestScope1</span>::test_case2<span class="hljs-variable">@group2</span>  <span class="hljs-comment"># ç»„2</span><br>[gw1] <span class="hljs-title class_">PASSED</span> testcases/test_xdits_case.py::<span class="hljs-title class_">TestScope1</span>::test_case1<span class="hljs-variable">@group1</span> <br>testcases/test_xdits_case.py::<span class="hljs-title class_">TestScope2</span>::test_case3<span class="hljs-variable">@group2</span> <br>testcases/test_xdits_case.py::<span class="hljs-title class_">TestScope2</span>::test_case4<span class="hljs-variable">@group1</span> <br>[gw0] <span class="hljs-title class_">PASSED</span> testcases/test_xdits_case.py::<span class="hljs-title class_">TestScope2</span>::test_case3<span class="hljs-variable">@group2</span> <br>testcases/test_xdits_case.py::test_case5<span class="hljs-variable">@group2</span> <br>[gw1] <span class="hljs-title class_">PASSED</span> testcases/test_xdits_case.py::<span class="hljs-title class_">TestScope2</span>::test_case4<span class="hljs-variable">@group1</span> <br>[gw0] <span class="hljs-title class_">PASSED</span> testcases/test_xdits_case.py::test_case5<span class="hljs-variable">@group2</span> <br><br>============================== <span class="hljs-number">5</span> passed <span class="hljs-keyword">in</span> <span class="hljs-number">3.96</span>s ===============================<br><span class="hljs-comment"># è¿™å°†ç¡®ä¿ test1 å’Œ TestA::test2 å°†åœ¨åŒä¸€ä¸ªå·¥ä½œçº¿ç¨‹ä¸­è¿è¡Œã€‚æ²¡æœ‰ xdist_group æ ‡è®°çš„æµ‹è¯•æŒ‰ç…§ --dist=load æ¨¡å¼æ­£å¸¸åˆ†å‘ã€‚</span><br></code></pre></td></tr></table></figure></code></pre></li><li><p><code>â€”â€”dist worksteal:</code> æœ€å¼€å§‹çš„æ—¶å€™ï¼Œæµ‹è¯•ç”¨ä¾‹ä¼šè¢«å‡åŒ€çš„åˆ†é…ç»™å¯ç”¨çš„wokerä¸­ï¼Œå½“å·¥ä½œçº¿ç¨‹å®Œæˆäº†å¤§éƒ¨åˆ†åˆ†é…çš„æµ‹è¯•ç”¨ä¾‹å¹¶ä¸”æ²¡æœ‰è¶³å¤Ÿçš„æµ‹è¯•ç”¨ä¾‹æ¥ç»§ç»­(å½“å‰æ¯ä¸ªå·¥ä½œçº¿ç¨‹åœ¨å…¶é˜Ÿåˆ—ä¸­è‡³å°‘éœ€è¦ä¸¤ä¸ªæµ‹è¯•)æ—¶ï¼Œå°†ä¼šå°è¯•ä»å…¶ä»–å·¥ä½œçº¿ç¨‹çš„é˜Ÿåˆ—ä¸­é‡æ–°åˆ†é…(â€œçªƒå–â€)ä¸€éƒ¨åˆ†æµ‹è¯•ç”¨ä¾‹æ¥è·‘ã€‚è¿è¡Œç»“æœä¸<code>--dist load</code>æ–¹æ³•ç›¸ä¼¼ï¼Œä½†æ˜¯<code>worksteal</code>å¯ä»¥æ›´å¥½åœ°å¤„ç†æŒç»­æ—¶é—´æ˜æ˜¾ä¸åŒçš„æµ‹è¯•ç”¨ä¾‹ï¼ŒåŒæ—¶ï¼Œå®ƒå¯ä»¥æä¾›ç±»ä¼¼æˆ–æ›´å¥½çš„fixturesé‡ç”¨ã€‚â€”â€”è¿™ä¸ªä»£ç ä¸å¥½æ¼”ç¤ºï¼Œå¤§è‡´çš„æ„æ€å°±æ˜¯è¿›ç¨‹1å’Œ2éƒ½æœ‰100æ¡ç”¨ä¾‹ï¼Œä½†æ˜¯1å…ˆè·‘å®Œäº†ï¼Œé‚£1å°±ä¼šå»çªƒå–2çš„ç”¨ä¾‹è¿‡æ¥è·‘ï¼Œ</p></li><li><p><code>--dist no</code>: æ­£å¸¸çš„pytestæ‰§è¡Œæ¨¡å¼ï¼Œä¸€æ¬¡è¿è¡Œä¸€ä¸ªæµ‹è¯•(æ ¹æœ¬æ²¡æœ‰åˆ†å‘)ã€‚ç¦ç”¨åˆ†å‘</p></li></ul><p>å½“æˆ‘ä»¬æµ‹è¯•ç”¨ä¾‹éå¸¸å¤šçš„æ—¶å€™ï¼Œæ¯”å¦‚æœ‰1åƒæ¡ç”¨ä¾‹ï¼Œå‡è®¾æ¯ä¸ªç”¨ä¾‹æ‰§è¡Œéœ€è¦1åˆ†é’Ÿï¼Œå¦‚æœå•ä¸ªä¼šè¯å»æµ‹è¯•ï¼Œå°±éœ€è¦1000åˆ†é’Ÿæ‰èƒ½è·‘å®Œ</p><p>ä½¿ç”¨è¯¥æ’ä»¶å¯ä»¥å¹¶å‘å»æ‰§è¡Œï¼Œ</p><p>è¦æ±‚ï¼š</p><ul><li>å„ä¸ªç”¨ä¾‹ä¹‹é—´äº’ç›¸ç‹¬ç«‹ï¼Œæ²¡æœ‰ä¾èµ–ï¼Œå¯å®Œå…¨ç‹¬ç«‹è¿è¡Œ</li><li>æ²¡æœ‰é¡ºåºè¦æ±‚</li><li>å¯é‡å¤è¿è¡Œï¼Œä¸”è¿è¡Œç»“æœäº’ä¸å½±å“</li></ul><h2 id="è¿œç¨‹-SSH-åˆ†å¸ƒå¼æµ‹è¯•"><a href="#è¿œç¨‹-SSH-åˆ†å¸ƒå¼æµ‹è¯•" class="headerlink" title="è¿œç¨‹ SSH åˆ†å¸ƒå¼æµ‹è¯•"></a>è¿œç¨‹ SSH åˆ†å¸ƒå¼æµ‹è¯•</h2><h3 id="è¿œç¨‹-SSH-åˆ†å¸ƒå¼æµ‹è¯•-1"><a href="#è¿œç¨‹-SSH-åˆ†å¸ƒå¼æµ‹è¯•-1" class="headerlink" title="è¿œç¨‹ SSH åˆ†å¸ƒå¼æµ‹è¯•"></a>è¿œç¨‹ SSH åˆ†å¸ƒå¼æµ‹è¯•</h3><blockquote><p>å®˜æ–¹æ–‡æ¡£è¯´å³å°†è¢«å¼ƒç”¨</p></blockquote><p>å‡è®¾æ‚¨æœ‰ä¸€ä¸ªåŒ…mypkgï¼Œå…¶ä¸­åŒ…å«ä¸€äº›å¯ä»¥åœ¨æœ¬åœ°æˆåŠŸè¿è¡Œçš„æµ‹è¯•ã€‚ä½ æœ‰ä¸€ä¸ªsshå¯è¾¾çš„æœºå™¨myhostã€‚ç„¶åï¼Œæ‚¨å¯ä»¥é€šè¿‡é”®å…¥:</p><p>ä½¿ç”¨æ–¹å¼ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pytest -d  --rsyncdir mypkg --tx ssh=myhostpopen mypkg/tests/unit/test_something.py<br></code></pre></td></tr></table></figure><p>å¯ä»¥ä½¿ç”¨<code>â€”â€”rsyncdir</code>æŒ‡å®šè¦å‘é€åˆ°è¿œç¨‹ç«¯çš„å¤šä¸ªç›®å½•ã€‚</p><p>ä¸ºäº†ä½¿pytestæ­£ç¡®åœ°æ”¶é›†å’Œå‘é€æµ‹è¯•ï¼Œæ‚¨ä¸ä»…éœ€è¦ç¡®ä¿æ‰€æœ‰ä»£ç å’Œæµ‹è¯•ç›®å½•éƒ½æ˜¯åŒæ­¥çš„ï¼Œè€Œä¸”ä»»ä½•æµ‹è¯•(å­)ç›®å½•ä¹Ÿéƒ½æœ‰ä¸€ä¸ª__init__.pyæ–‡ä»¶ï¼Œå› ä¸ºpytestå†…éƒ¨å°†testså¼•ç”¨ä¸ºå®Œå…¨é™å®šçš„pythonæ¨¡å—è·¯å¾„ã€‚å¦åˆ™ï¼Œæ‚¨å°†åœ¨è¿œç¨‹ç«¯è®¾ç½®è¿‡ç¨‹ä¸­å¾—åˆ°å¥‡æ€ªçš„é”™è¯¯ã€‚</p><h3 id="å°†æµ‹è¯•å‘é€åˆ°è¿œç¨‹å¥—æ¥å­—æœåŠ¡å™¨"><a href="#å°†æµ‹è¯•å‘é€åˆ°è¿œç¨‹å¥—æ¥å­—æœåŠ¡å™¨" class="headerlink" title="å°†æµ‹è¯•å‘é€åˆ°è¿œç¨‹å¥—æ¥å­—æœåŠ¡å™¨"></a>å°†æµ‹è¯•å‘é€åˆ°è¿œç¨‹å¥—æ¥å­—æœåŠ¡å™¨</h3><p>æ²¡æœ‰å°è¯•è¿‡ï¼Œå°±ä¸å†™äº†ï¼Œæ„Ÿè§‰ä¹Ÿä¸å¸¸ç”¨</p>]]></content>
    
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç¬”è®°</tag>
      
      <tag>pytest</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€pythonã€‘FastAPIä¾èµ–æ³¨å…¥ï¼ˆå››ï¼‰</title>
    <link href="/2024/01/18/684FastAPI4%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/"/>
    <url>/2024/01/18/684FastAPI4%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5/</url>
    
    <content type="html"><![CDATA[<h1 id="7-1-ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥"><a href="#7-1-ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥" class="headerlink" title="7-1 ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥"></a>7-1 ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥</h1><p>åœºæ™¯ï¼š </p><p>ä½ çš„ä¸€ä¸ªç½‘ç«™æœ‰ä¸¤ä¸ªæŸ¥è¯¢æ¥å£ï¼Œä¸€ä¸ªæ˜¯å›¾ä¹¦åˆ—è¡¨å€Ÿå£ï¼Œä¸€ä¸ªæ˜¯ç”¨æˆ·åˆ—è¡¨å€Ÿå£ï¼Œä¸¤ä¸ªæ¥å£æœ‰ç›¸åŒçš„åˆ†é¡µæŸ¥è¯¢é€»è¾‘ï¼Œæ­¤æ—¶ä½ è¯¥å¦‚ä½•å®ç°ï¼Ÿ çœ‹çœ‹ä¸‹é¢çš„æ™®é€šä»£ç å®ç°æ–¹å¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><br>app = FastAPI()<br><br><br>BOOKS = [&#123;<span class="hljs-string">&quot;id&quot;</span>: i, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">f&quot;book<span class="hljs-subst">&#123;i&#125;</span>&quot;</span>, <span class="hljs-string">&quot;status&quot;</span>: i % <span class="hljs-number">4</span> != <span class="hljs-number">0</span>&#125; <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">11</span>)]<br>USERS = [&#123;<span class="hljs-string">&quot;id&quot;</span>: i, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">f&quot;user<span class="hljs-subst">&#123;i&#125;</span>&quot;</span>, <span class="hljs-string">&quot;status&quot;</span>: i % <span class="hljs-number">4</span> != <span class="hljs-number">0</span>&#125; <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">11</span>)]<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/api/books&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_books</span>(<span class="hljs-params">page: <span class="hljs-built_in">int</span> = <span class="hljs-number">1</span>, size: <span class="hljs-built_in">int</span> = <span class="hljs-number">2</span>, status: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">True</span></span>):  <span class="hljs-comment"># éœ€è¦å®šä¹‰ä¸‰ä¸ªå‚æ•° page\size\status</span><br>    books = [b <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> BOOKS <span class="hljs-keyword">if</span> b[<span class="hljs-string">&quot;status&quot;</span>] == status]<br>    <span class="hljs-keyword">return</span> books[(page - <span class="hljs-number">1</span>) * size:page * size]<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/api/users&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_users</span>(<span class="hljs-params">page: <span class="hljs-built_in">int</span> = <span class="hljs-number">1</span>, size: <span class="hljs-built_in">int</span> = <span class="hljs-number">2</span>, status: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">True</span></span>):  <span class="hljs-comment"># éœ€è¦é‡å¤å†æ¬¡å®šä¹‰ä¸‰ä¸ªå‚æ•° ä»£ç é‡å¤å†™äº†</span><br>    users = [u <span class="hljs-keyword">for</span> u <span class="hljs-keyword">in</span> USERS <span class="hljs-keyword">if</span> u[<span class="hljs-string">&quot;status&quot;</span>] == status]<br>    retur<br></code></pre></td></tr></table></figure><ul><li><p>å¯¹äºä¸Šé¢çš„ä»£ç é‡å¤é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¾èµ–æ³¨å…¥è§£å†³</p></li><li><p>ä¾èµ–æ³¨å…¥å…¶å®å°±æ˜¯è‹±æ–‡å•è¯ <strong>Dependency Injection</strong> çš„ç¿»è¯‘ï¼Œå®ƒæ˜¯ä¸€ç§éå¸¸ç®€å•ä¸”ç›´è§‚çš„å·¥å…·ã€‚<strong>ç®€å•æ¥è¯´ï¼Œå°±æ˜¯å½“ä½ çš„ä»£ç ä¸­çš„ä¸€ä¸ªå‚æ•°çš„å€¼éœ€è¦ä¾èµ–å…¶ä»–æ¡ä»¶æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¾èµ–æ³¨å…¥ã€‚å½“ä½ ä½¿ç”¨äº†å®ƒä¹‹åï¼ŒFastAPIå°±ä¼šåœ¨éœ€è¦ä½¿ç”¨è¿™ä¸ªå‚æ•°çš„æ—¶å€™ï¼Œè‡ªåŠ¨å¸®ä½ æ‰§è¡Œå®ƒçš„ä¾èµ–æ¡ä»¶æ¥è·å–ç»“æœã€‚</strong></p><ul><li>å‡½æ•°çš„å…¥å‚éœ€è¦ç¬¦åˆæŸä¸€ç§è§„èŒƒï¼ˆæ‰€è°“ä¾èµ–ï¼‰ã€‚</li></ul></li></ul><h2 id="ä¾èµ–æ³¨å…¥çš„ä½¿ç”¨"><a href="#ä¾èµ–æ³¨å…¥çš„ä½¿ç”¨" class="headerlink" title="ä¾èµ–æ³¨å…¥çš„ä½¿ç”¨"></a>ä¾èµ–æ³¨å…¥çš„ä½¿ç”¨</h2><p>é¦–å…ˆï¼Œä»FastAPIå¼•å…¥<code>Depends</code></p><p>ç„¶åï¼Œå®šä¹‰ä¾èµ–æ¡ä»¶ï¼Œå³å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼ˆå¯è°ƒç”¨å¯¹è±¡å³å¯ï¼‰ï¼Œå‡½æ•°çš„å½¢å‚æ˜¯æˆ‘ä»¬éœ€è¦çš„å‚æ•°ï¼Œè¿”å›å€¼æ˜¯ä¸‰ä¸ªå‚æ•°ç»„æˆçš„å­—å…¸</p><p>æœ€åï¼Œåœ¨è·¯å¾„å‡½æ•°å†…ä½¿ç”¨ <code>Depends(common_params)</code>, è¿™æ ·ä¸€æ¥FastAPIå°±çŸ¥é“ï¼Œ<code>commons</code>è¿™ä¸ªå­—å…¸ä¾èµ–<code>common_params</code>å‡½æ•°çš„è¿”å›å€¼ï¼Œå³<code>commons</code>å­—å…¸å°±æ˜¯<code>common_params</code>å‡½æ•°çš„è¿”å›å€¼ã€‚</p><p>åƒ<code>common_params</code>å‡½æ•°è¢«ç§°ä¸ºä¾èµ–æ¡ä»¶ï¼Œ<strong>åªè¦æ˜¯å¯è°ƒç”¨å¯¹è±¡å°±å¯ä»¥å½“ä¾èµ–æ¡ä»¶</strong></p><p>ä¾èµ–æ¡ä»¶ä¸­å¯ä»¥ä½¿ç”¨Path\Queryç­‰ç­‰è·å–å‚æ•°çš„æ–¹å¼ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Depends<br><br>app = FastAPI()<br><br><br>BOOKS = [&#123;<span class="hljs-string">&quot;id&quot;</span>: i, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">f&quot;book<span class="hljs-subst">&#123;i&#125;</span>&quot;</span>, <span class="hljs-string">&quot;status&quot;</span>: i % <span class="hljs-number">4</span> != <span class="hljs-number">0</span>&#125; <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">11</span>)]<br>USERS = [&#123;<span class="hljs-string">&quot;id&quot;</span>: i, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">f&quot;user<span class="hljs-subst">&#123;i&#125;</span>&quot;</span>, <span class="hljs-string">&quot;status&quot;</span>: i % <span class="hljs-number">4</span> != <span class="hljs-number">0</span>&#125; <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">11</span>)]<br><br><br><span class="hljs-comment"># å®šä¹‰ä¾èµ–æ¡ä»¶</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">common_params</span>(<span class="hljs-params">page: <span class="hljs-built_in">int</span> = <span class="hljs-number">1</span>, size: <span class="hljs-built_in">int</span> = <span class="hljs-number">2</span>, status: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">True</span></span>):<br>    <span class="hljs-keyword">return</span> &#123;<br>        <span class="hljs-string">&quot;page&quot;</span>: page,<br>        <span class="hljs-string">&quot;size&quot;</span>: size,<br>        <span class="hljs-string">&quot;status&quot;</span>: status,<br>    &#125;<br><br><span class="hljs-comment"># ä¸‹é¢ä¸¤ä¸ªè·¯å¾„å‡½æ•°éƒ½æ˜¯ä½¿ç”¨äº†ä¸Šé¢å®šä¹‰çš„ä¾èµ–æ¡ä»¶ï¼Œä¾èµ–æ¡ä»¶å‡½æ•°çš„å…¥å‚å°±æ˜¯æ´—é¢è·¯å¾„å‡½æ•°çš„å…¥å‚è¦æ±‚ï¼Œä¸”é»˜è®¤å€¼å°±æ˜¯å…¶é»˜è®¤å€¼</span><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/api/books&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_books</span>(<span class="hljs-params">commons: <span class="hljs-built_in">dict</span> = Depends(<span class="hljs-params">common_params</span>)</span>):<span class="hljs-comment"># ä½¿ç”¨ä¾èµ–æ¡ä»¶</span><br>    page = commons[<span class="hljs-string">&quot;page&quot;</span>]<br>    size = commons[<span class="hljs-string">&quot;size&quot;</span>]<br>    status = commons[<span class="hljs-string">&quot;status&quot;</span>]<br>    books = [b <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> BOOKS <span class="hljs-keyword">if</span> b[<span class="hljs-string">&quot;status&quot;</span>] == status]<br>    <span class="hljs-keyword">return</span> books[(page - <span class="hljs-number">1</span>) * size:page * size]<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/api/users&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_users</span>(<span class="hljs-params">commons: <span class="hljs-built_in">dict</span> = Depends(<span class="hljs-params">common_params</span>)</span>):<br>    page = commons[<span class="hljs-string">&quot;page&quot;</span>]<br>    size = commons[<span class="hljs-string">&quot;size&quot;</span>]<br>    status = commons[<span class="hljs-string">&quot;status&quot;</span>]<br>    users = [u <span class="hljs-keyword">for</span> u <span class="hljs-keyword">in</span> USERS <span class="hljs-keyword">if</span> u[<span class="hljs-string">&quot;status&quot;</span>] == status]<br>    <span class="hljs-keyword">return</span> users[(page - <span class="hljs-number">1</span>) * size:page * size]<br></code></pre></td></tr></table></figure><p><strong>ä¾èµ–æ³¨å…¥çš„ç”¨é€”</strong>ï¼š</p><ul><li>å…±äº«ä¸€å—ç›¸åŒé€»è¾‘çš„ä»£ç å—</li><li>å…±äº«æ•°æ®åº“è¿æ¥</li><li>æƒé™è®¤è¯ï¼Œç™»å½•çŠ¶æ€è®¤è¯</li><li>ç­‰ç­‰ç­‰</li></ul><h1 id=""><a href="#" class="headerlink" title=""></a></h1><h1 id="7-2-ä¾èµ–æ³¨å…¥åµŒå¥—ä½¿ç”¨ã€ã€‘"><a href="#7-2-ä¾èµ–æ³¨å…¥åµŒå¥—ä½¿ç”¨ã€ã€‘" class="headerlink" title="7-2 ä¾èµ–æ³¨å…¥åµŒå¥—ä½¿ç”¨ã€ã€‘"></a>7-2 ä¾èµ–æ³¨å…¥åµŒå¥—ä½¿ç”¨ã€ã€‘</h1><p>ä¾èµ–æ³¨å…¥æ˜¯éå¸¸å¼ºå¤§çš„ï¼Œæ¯”å¦‚è¯´ï¼Œå®ƒå¯ä»¥<strong>æ”¯æŒåµŒå¥—</strong>ä½¿ç”¨ï¼Œä¸”<strong>åµŒå¥—æ·±åº¦ä¸å—é™åˆ¶</strong></p><p>ç¤ºä¾‹ï¼šä¸¤å±‚åµŒå¥—ä¾èµ–æ³¨å…¥</p><ul><li>è·¯å¾„å‡½æ•°get_nameéœ€è¦çš„å½¢å‚<code>username_or_nickname</code>æœ‰ä¾èµ–æ¡ä»¶ï¼Œæ‰€ä»¥FastAPIä¼šè°ƒç”¨ <code>username_or_nickname_extractor</code></li><li>æ‰§è¡Œ<code>username_or_nickname_extractor</code>çš„æ—¶å€™ï¼Œå‘ç°å®ƒä¹Ÿæœ‰ä¾èµ–æ¡ä»¶ï¼Œæ‰€ä»¥FastAPIä¼šè°ƒç”¨ <code>username_extractor</code></li><li>æŒ‰ç…§è¿™ä¸ªé¡ºåºï¼Œä¾æ¬¡è·å–æ¯ä¸ªæœ‰ä¾èµ–æ¡ä»¶çš„å‚æ•°çš„ç»“æœã€‚æœ€ç»ˆï¼Œåœ¨è·¯å¾„å‡½æ•°å†…è·å–æœ€ç»ˆçš„ç»“æœã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Union</span><br><br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> Depends, FastAPI<br><br>app = FastAPI()<br><span class="hljs-comment"># è¿™é‡Œçš„Union[str, None] å‡½æ•°çš„æ„æ€æ˜¯æŒ‡å®šå¤šä¸ªç±»å‹ä¸­çš„ä¸€ä¸ªï¼Œä¹Ÿå°±æ˜¯è¯´æŒ‡å®šstrç±»å‹æˆ–è€…Noneç±»å‹ Unionæ˜¯è”åˆçš„æ„æ€</span><br><br><span class="hljs-comment"># username_extractorå‡½æ•°çš„å…¥å‚æ˜¯ä¸€ä¸ªï¼Œ</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">username_extractor</span>(<span class="hljs-params">username: <span class="hljs-type">Union</span>[<span class="hljs-built_in">str</span>, <span class="hljs-literal">None</span>] = <span class="hljs-literal">None</span></span>):<br>    <span class="hljs-keyword">return</span> username<br><br><span class="hljs-comment"># username_or_nickname_extractorè¿™ä¸ªå‡½æ•°çš„å…¥å‚æœ‰ä¸¤ä¸ªï¼Œç¬¬ä¸€ä¸ªä¾èµ–äº†username_extractorè¿™ä¸ªå‡½æ•°çš„å…¥å‚ï¼Œç¬¬äºŒä¸ªæ˜¯nickname</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">username_or_nickname_extractor</span>(<span class="hljs-params"></span><br><span class="hljs-params">    username: <span class="hljs-built_in">str</span> = Depends(<span class="hljs-params">username_extractor</span>),</span><br><span class="hljs-params">    nickname: <span class="hljs-type">Union</span>[<span class="hljs-built_in">str</span>, <span class="hljs-literal">None</span>] = <span class="hljs-literal">None</span>,</span><br><span class="hljs-params"></span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> username:<br>        <span class="hljs-keyword">return</span> nickname<br>    <span class="hljs-keyword">return</span> username<br><br><br><br><span class="hljs-comment"># è¿™é‡Œè·¯å¾„å‡½æ•°çš„å…¥å‚æ˜¯ä¾èµ–äº†username_or_nickname_extractorè¿™ä¸ªå‡½æ•°çš„å…¥å‚ï¼Œ</span><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/name&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_name</span>(<span class="hljs-params">username_or_nickname: <span class="hljs-built_in">str</span> = Depends(<span class="hljs-params">username_or_nickname_extractor</span>)</span>): <br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;username_or_nickname&quot;</span>: username_or_nickname&#125;<br></code></pre></td></tr></table></figure><h1 id="7-3-ä¾èµ–æ³¨å…¥çš„ç¼“å­˜ç°è±¡"><a href="#7-3-ä¾èµ–æ³¨å…¥çš„ç¼“å­˜ç°è±¡" class="headerlink" title="7-3 ä¾èµ–æ³¨å…¥çš„ç¼“å­˜ç°è±¡"></a>7-3 ä¾èµ–æ³¨å…¥çš„ç¼“å­˜ç°è±¡</h1><p>å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬å®šä¹‰çš„ä¾èµ–æ¡ä»¶ä¼šè¢«æ‰§è¡Œå¤šæ¬¡ï¼Œè¿™ç§åœºæ™¯ä¸‹ï¼ŒFastAPIé»˜è®¤åªä¼šæ‰§è¡Œä¸€æ¬¡ä¾èµ–æ¡ä»¶ã€‚ä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰§è¡Œä¸ä½¿ç”¨ç¼“å­˜ã€‚</p><p>ç¤ºä¾‹1ï¼šä¾èµ–æ³¨å…¥çš„ç¼“å­˜ç°è±¡</p><ul><li>ä¾èµ–æ¡ä»¶<code>get_num</code>è¢«ä¾èµ–äº†ä¸¤æ¬¡ï¼Œä½†æ˜¯ä½ ä¼šå‘ç°å…¶å†…éƒ¨æ‰“å°è¯­å¥åªæ‰“å°äº†ä¸€æ¬¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>ç¬¬äºŒæ¬¡ä½¿ç”¨è¿™ä¸ªä¾èµ–æ¡ä»¶æ—¶FastAPIå¹¶æ²¡æœ‰çœŸæ­£æ‰§è¡Œè¿™ä¸ªå‡½æ•°ï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨äº†ç¬¬ä¸€æ¬¡æ‰§è¡Œçš„ç»“æœï¼Œè¿™å°±æ˜¯ä¾èµ–æ³¨å…¥çš„ç¼“å­˜ç°è±¡</strong>ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> Depends, FastAPI<br><br>app = FastAPI()<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_num</span>(<span class="hljs-params">num: <span class="hljs-built_in">int</span></span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;get_numè¢«æ‰§è¡Œäº†&quot;</span>)<br>    <span class="hljs-keyword">return</span> num<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_results</span>(<span class="hljs-params">num1: <span class="hljs-built_in">int</span> = Depends(<span class="hljs-params">get_num</span>), num2: <span class="hljs-built_in">int</span> = Depends(<span class="hljs-params">get_num</span>)</span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;num1&quot;</span>: num1, <span class="hljs-string">&quot;num2&quot;</span>: num2&#125;<br></code></pre></td></tr></table></figure><p>å®ä¾‹2ï¼šä¾èµ–æ³¨å…¥ä¸ä½¿ç”¨ç¼“å­˜</p><ul><li><strong>é»˜è®¤ <code>use_cache</code>å­—æ®µæ˜¯Trueï¼Œå¦‚æœåœ¨ç¬¬äºŒæ¬¡ä½¿ç”¨ä¾èµ–æ³¨å…¥ä¸æƒ³ä½¿ç”¨ç¼“å­˜ï¼Œå°†æ­¤å­—æ®µçš„å€¼è®¾ä¸ºFalseå³å¯</strong>ã€‚</li><li>éœ€è¦æ³¨æ„ï¼Œ</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_results</span>(<span class="hljs-params">num1: <span class="hljs-built_in">int</span> = Depends(<span class="hljs-params">get_num</span>), num2: <span class="hljs-built_in">int</span> = Depends(<span class="hljs-params">get_num, use_cache=<span class="hljs-literal">False</span></span>)</span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;num1&quot;</span>: num1, <span class="hljs-string">&quot;num2&quot;</span>: num2&#125;<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹3ï¼šç¼“å­˜ç°è±¡å­˜åœ¨ç¼“å­˜åµŒå¥—ä¸­</p><ul><li>ä¾èµ–æ³¨å…¥åµŒå¥—ä½¿ç”¨æ—¶ï¼Œå­ä¾èµ–å¦‚æœè¢«ä½¿ç”¨å¤šæ¬¡ä¹Ÿä¼šå­˜åœ¨ç¼“å­˜ç°è±¡ï¼Œè§£å†³åŠæ³•å°±æ˜¯ç¬¬äºŒæ¬¡ä½¿ç”¨å­ä¾èµ–æ—¶ä½¿ç”¨use_cache&#x3D;False</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> Depends, FastAPI<br><br>app = FastAPI()<br><br><span class="hljs-comment"># è¿™ä¸ªå­ä¾èµ–è¢«ä½¿ç”¨ä¸¤æ¬¡</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_num</span>(<span class="hljs-params">num: <span class="hljs-built_in">int</span></span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;get_numè¢«æ‰§è¡Œäº†&quot;</span>)<br>    <span class="hljs-keyword">return</span> num<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_result1</span>(<span class="hljs-params">num: <span class="hljs-built_in">int</span> = Depends(<span class="hljs-params">get_num</span>)</span>):<br>    <span class="hljs-keyword">return</span> num * num<br><br><br><span class="hljs-comment"># ç¬¬äºŒæ¬¡ä½¿ç”¨get_numæ—¶ï¼Œè®¾ç½®use_cache=Falseåˆ™ä¸ä½¿ç”¨ç¼“å­˜</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_result2</span>(<span class="hljs-params">num: <span class="hljs-built_in">int</span> = Depends(<span class="hljs-params">get_num, use_cache=<span class="hljs-literal">False</span></span>)</span>):<br>    <span class="hljs-keyword">return</span> num * num * num<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_results</span>(<span class="hljs-params">result1: <span class="hljs-built_in">int</span> = Depends(<span class="hljs-params">get_result1</span>), result2: <span class="hljs-built_in">int</span> = Depends(<span class="hljs-params">get_result2</span>)</span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;result1&quot;</span>: result1, <span class="hljs-string">&quot;result2&quot;</span>: result2&#125;<br><br></code></pre></td></tr></table></figure><p><strong>æ€»ç»“ï¼š</strong></p><ul><li><strong>åœ¨ä¸€ä¸ªè¯·æ±‚ä¸­ï¼Œå¦‚æœä¾èµ–æ³¨å…¥æ¡ä»¶è¢«ä½¿ç”¨äº†å¤šæ¬¡ï¼Œåˆ™åªæœ‰ç¬¬ä¸€æ¬¡ä¼šçœŸæ­£æ‰§è¡Œå†…éƒ¨ä»£ç ï¼Œç„¶åå°†å…¶è¿”å›å€¼ç¼“å­˜èµ·æ¥ï¼Œåé¢å†æ¬¡ä½¿ç”¨å®ƒåˆ™ç›´æ¥è·å–ç¼“å­˜ç»“æœï¼Œä¸ä¼šå†æ¬¡æ‰§è¡Œå…¶å†…éƒ¨ä»£ç ã€‚</strong></li><li><strong>å¦‚æœä¸æƒ³ä½¿ç”¨ä¾èµ–æ³¨å…¥ç¼“å­˜ï¼Œåˆ™å¯ä»¥åœ¨è¿™ä¸ªä¾èµ–æ¡ä»¶ç¬¬äºŒæ¬¡è¢«ä½¿ç”¨æ—¶ï¼Œè®¾ç½® <code>use_cache=False</code>å³å¯ã€‚</strong></li></ul><h1 id="7-4-è·¯å¾„è£…é¥°å™¨å’Œå…¨å±€ä¾èµ–æ³¨å…¥ã€æœ‰ç”¨ã€‘"><a href="#7-4-è·¯å¾„è£…é¥°å™¨å’Œå…¨å±€ä¾èµ–æ³¨å…¥ã€æœ‰ç”¨ã€‘" class="headerlink" title="7-4 è·¯å¾„è£…é¥°å™¨å’Œå…¨å±€ä¾èµ–æ³¨å…¥ã€æœ‰ç”¨ã€‘"></a>7-4 è·¯å¾„è£…é¥°å™¨å’Œå…¨å±€ä¾èµ–æ³¨å…¥ã€æœ‰ç”¨ã€‘</h1><p>æœ‰çš„æ—¶å€™ï¼Œæˆ‘ä»¬æƒ³ä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼Œä½†å¹¶ä¸å¸Œæœ›å®ƒæœ‰è¿”å›å€¼ï¼Œé‚£æ­¤æ—¶å°±ä¸èƒ½åœ¨è·¯å¾„å‡½æ•°å†…ä½¿ç”¨<code>Depends()</code>äº†ï¼Œé‚£è¯¥å¦‚ä½•å‘¢ï¼Ÿ</p><p>ä¸éœ€è¦è¿”å›å€¼çš„ä¾èµ–æ³¨å…¥ï¼Œå¯ä»¥ç›´æ¥åœ¨è·¯å¾„è£…é¥°å™¨ä¸­ä½¿ç”¨</p><p><strong>FastAPIçš„è§£å†³æ–¹å¼</strong></p><p>ä¸éœ€è¦è¿”å›å€¼çš„ä¾èµ–æ³¨å…¥ï¼Œå¯ä»¥åœ¨è·¯å¾„è£…é¥°å™¨ä¸­ä½¿ç”¨ã€‚</p><p>ç¤ºä¾‹1ï¼šä½¿ç”¨ä¾èµ–æ³¨å…¥æ ¡éªŒè®¿é—®æƒé™</p><ul><li>åœ¨è·¯å¾„è£…é¥°å™¨ä¸­å¯ä»¥ä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼Œä½¿ç”¨å­—æ®µ<code>dependencies</code>ï¼Œå®ƒçš„å€¼éœ€è¦æ˜¯ä¸€ä¸ªåŒ…å«<code>Depands()</code>çš„åºåˆ—ï¼Œæ¯”å¦‚åˆ—è¡¨æˆ–å…ƒç»„ã€‚</li><li><code>dependencies</code>ä¸­æ¯ä¸ªä¾èµ–æ¡ä»¶ä¸éœ€è¦è¿”å›å€¼ï¼Œå°±æ˜¯æœ‰è¿”å›å€¼ä¹Ÿä¸ä¼šä½¿ç”¨ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> Depends, FastAPI, Header, HTTPException<br><br><br>app = FastAPI()<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">verify_token</span>(<span class="hljs-params">x_token: <span class="hljs-built_in">str</span> = Header(<span class="hljs-params"></span>)</span>):<br>    <span class="hljs-keyword">if</span> x_token != <span class="hljs-string">&quot;fake-super-secret-token&quot;</span>:<br>        <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">400</span>, detail=<span class="hljs-string">&quot;X-Token header invalid&quot;</span>)<br>    <span class="hljs-keyword">return</span> x_token<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&quot;</span>, dependencies=[Depends(<span class="hljs-params">verify_token</span>)]</span>) </span><span class="hljs-comment"># è¿™ä¸ªæ—¶å€™ï¼Œåœ¨æ¥å£æ–‡æ¡£ä¸Šå°±å¯ä»¥çœ‹åˆ°è¿™æ¡æ¥å£æ˜¯éœ€è¦ x_token å…¥å‚çš„ï¼Œä½†æ˜¯ä¸éœ€è¦è¿”å›å€¼</span><br><span class="hljs-comment"># x_tokençš„æ¥æºæ˜¯ä¾èµ–æ³¨å…¥æ¥å£çš„ç»“æœverify_token</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_items</span>():<br>    <span class="hljs-keyword">return</span> [&#123;<span class="hljs-string">&quot;item&quot;</span>: <span class="hljs-string">&quot;Foo&quot;</span>&#125;, &#123;<span class="hljs-string">&quot;item&quot;</span>: <span class="hljs-string">&quot;Bar&quot;</span>&#125;]<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹2ï¼šå…¨å±€ä½¿ç”¨ä¾èµ–æ³¨å…¥æ ¡éªŒè®¿é—®æƒé™</p><ul><li>å¦‚æœæˆ‘ä»¬å¸Œæœ›ç³»ç»Ÿä¸­çš„<strong>æ‰€æœ‰è·¯ç”±æ¥å£éƒ½é»˜è®¤æœ‰ä¾èµ–æ³¨å…¥</strong>ï¼Œæ­¤æ—¶æˆ‘ä»¬æ²¡æœ‰<strong>å¿…è¦æ¯ä¸ªæ¥å£éƒ½é‡å¤è®¾ç½®ä¸€éä¾èµ–æ³¨å…¥</strong></li><li>åªéœ€è¦åœ¨å®ä¾‹åŒ–FastAPIæ—¶ï¼Œé€šè¿‡<code>dependencies</code>,éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªå‚æ•°æ¥æ”¶çš„å€¼ä¾ç„¶æ˜¯ä¸€ä¸ªåŒ…å«å¤šä¸ªå¯ä¾èµ–å¯¹è±¡çš„åˆ—è¡¨ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> Depends, FastAPI, Header, HTTPException<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">verify_token</span>(<span class="hljs-params">x_token: <span class="hljs-built_in">str</span> = Header(<span class="hljs-params"></span>)</span>):<br>    <span class="hljs-keyword">if</span> x_token != <span class="hljs-string">&quot;fake-super-secret-token&quot;</span>:<br>        <span class="hljs-keyword">raise</span> HTTPException(status_code=<span class="hljs-number">400</span>, detail=<span class="hljs-string">&quot;X-Token header invalid&quot;</span>)<br><br><br>app = FastAPI(dependencies=[Depends(verify_token)])<br><span class="hljs-comment"># åœ¨å®ä¾‹åŒ–FastAPIçš„æ—¶å€™é€‰æ‹©ä¾èµ–æ³¨å…¥ï¼Œè¿™æ ·è¿™ä¸ªå®ä¾‹åŒ–å¯¹è±¡çš„è·¯å¾„è£…é¥°å™¨è£…é¥°çš„è·¯å¾„å‡½æ•°éƒ½ä¼šéœ€è¦æ³¨å…¥ä¾èµ–</span><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_items</span>():<br>    <span class="hljs-keyword">return</span> [&#123;<span class="hljs-string">&quot;item&quot;</span>: <span class="hljs-string">&quot;Portal Gun&quot;</span>&#125;, &#123;<span class="hljs-string">&quot;item&quot;</span>: <span class="hljs-string">&quot;Plumbus&quot;</span>&#125;]<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/users/&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_users</span>():<br>    <span class="hljs-keyword">return</span> [&#123;<span class="hljs-string">&quot;username&quot;</span>: <span class="hljs-string">&quot;Rick&quot;</span>&#125;, &#123;<span class="hljs-string">&quot;username&quot;</span>: <span class="hljs-string">&quot;Morty&quot;</span>&#125;]<br></code></pre></td></tr></table></figure><h1 id="7-5-åŸºäºç±»çš„ä¾èµ–æ³¨å…¥ã€æœ‰ç‚¹ç”¨ã€‘"><a href="#7-5-åŸºäºç±»çš„ä¾èµ–æ³¨å…¥ã€æœ‰ç‚¹ç”¨ã€‘" class="headerlink" title="7-5 åŸºäºç±»çš„ä¾èµ–æ³¨å…¥ã€æœ‰ç‚¹ç”¨ã€‘"></a>7-5 åŸºäºç±»çš„ä¾èµ–æ³¨å…¥ã€æœ‰ç‚¹ç”¨ã€‘</h1><p>åœ¨7-1èŠ‚ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å®šä¹‰ä¾èµ–æ¡ä»¶ï¼Œè§£å†³äº†é€šç”¨æŸ¥è¯¢å‚æ•°é‡å¤å®šä¹‰çš„é—®é¢˜ã€‚å…¶ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰çš„ä¾èµ–æ¡ä»¶æ˜¯æ™®é€šçš„å‡½æ•°ã€‚</p><p>ä½†å…¶å®ï¼Œåªè¦æ˜¯å¯è°ƒç”¨çš„å¯¹è±¡ï¼Œéƒ½å¯ä»¥å½“åšä¾èµ–æ¡ä»¶ï¼Œæ¯”å¦‚ç±»ã€‚<strong>ç±»å®ä¾‹åŒ–å…¶å®å°±æ˜¯ç±»çš„è°ƒç”¨</strong>ã€‚</p><p>ç¤ºä¾‹1ï¼šç±»å½¢å¼çš„ä¾èµ–æ¡ä»¶</p><ul><li><code>CommonQueryParams()</code>å°±ä¼šå®ä¾‹åŒ–å‡ºæ¥ä¸€ä¸ªå¯¹è±¡ï¼Œä¸‰ä¸ªé€šç”¨å‚æ•°å°±ä¼šä¿å­˜åœ¨åœ¨å¯¹è±¡çš„ä¸‰ä¸ªå±æ€§ä¸Šã€‚</li><li>ç±»ä¸­å®šä¹‰çš„<code>__init__</code>æ–¹æ³•ï¼Œç”¨æ¥ä¿å­˜å˜é‡å±æ€§ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> Depends, FastAPI<br><br>app = FastAPI()<br><br><br>BOOKS = [&#123;<span class="hljs-string">&quot;id&quot;</span>: i, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">f&quot;book<span class="hljs-subst">&#123;i&#125;</span>&quot;</span>, <span class="hljs-string">&quot;status&quot;</span>: i % <span class="hljs-number">4</span> != <span class="hljs-number">0</span>&#125; <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">11</span>)]<br><br><br><span class="hljs-comment"># å®šä¹‰ä¾èµ–æ¡ä»¶</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CommonQueryParams</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, page: <span class="hljs-built_in">int</span>, size: <span class="hljs-built_in">int</span>, status: <span class="hljs-built_in">bool</span></span>):<br>        self.page = page<br>        self.size = size<br>        self.status = status<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/api/books&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_books</span>(<span class="hljs-params">commons: CommonQueryParams = Depends(<span class="hljs-params">CommonQueryParams</span>)</span>):    <span class="hljs-comment"># ä½¿ç”¨ä¾èµ–æ¡ä»¶ </span><br><span class="hljs-comment"># è¿™é‡Œ CommonQueryParamsç±»çš„initå±æ€§å°±æ˜¯å…¥å‚ä¾èµ–ï¼Œ</span><br><br>    page = commons.page<br>    size = commons.size<br>    books = [b <span class="hljs-keyword">for</span> b <span class="hljs-keyword">in</span> BOOKS <span class="hljs-keyword">if</span> b[<span class="hljs-string">&quot;status&quot;</span>] == commons.status]<br>    <span class="hljs-keyword">return</span> books[(page - <span class="hljs-number">1</span>) * size:page * size]<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹2ï¼š<strong>ç±»å½¢å¼ä¾èµ–æ³¨å…¥çš„ç®€åŒ–ç”¨æ³•</strong></p><ul><li>ä¸Šé¢æˆ‘ä»¬ä½¿ç”¨ç±»å½¢å¼çš„ä¾èµ–æ³¨å…¥ï¼Œçœ‹èµ·æ¥ä¼˜ç‚¹å†—ä½™å¯¹å§ï¼š<code>commons: CommonQueryParams = Depends(CommonQueryParams)</code></li><li>å¯¹äºè¿™ç§æƒ…å†µï¼Œæœ‰ä¸€ä¸ªç®€å†™æ–¹å¼ï¼š<code>commons: CommonQueryParams = Depends()</code>ï¼Œæ­¤æ—¶fastapiçŸ¥é“Dependsæ‹¬å·å†…ä¾èµ–çš„æ˜¯ä»€ä¹ˆã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å®šä¹‰ä¾èµ–æ¡ä»¶</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CommonQueryParams</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, page: <span class="hljs-built_in">int</span>, size: <span class="hljs-built_in">int</span>, status: <span class="hljs-built_in">bool</span></span>):<br>        self.page = page<br>        self.size = size<br>        self.status = status<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/api/books&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_books</span>(<span class="hljs-params">commons: CommonQueryParams = Depends(<span class="hljs-params"></span>)</span>): <span class="hljs-comment">#ç®€å•ä¸€ç‚¹å†™å°±æ˜¯ç›´æ¥ç±»çš„å®ä¾‹åŒ–å¯¹è±¡ï¼ŒCommonQueryParams = Depends()å°±æ˜¯åœ¨å®ä¾‹åŒ–è¿™ä¸ªç±»</span><br>    <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure><h1 id="7-6-åŸºäºå¯¹è±¡çš„ä¾èµ–æ³¨å…¥ã€å¸¸ç”¨ã€‘"><a href="#7-6-åŸºäºå¯¹è±¡çš„ä¾èµ–æ³¨å…¥ã€å¸¸ç”¨ã€‘" class="headerlink" title="7-6 åŸºäºå¯¹è±¡çš„ä¾èµ–æ³¨å…¥ã€å¸¸ç”¨ã€‘"></a>7-6 åŸºäºå¯¹è±¡çš„ä¾èµ–æ³¨å…¥ã€å¸¸ç”¨ã€‘</h1><p>ä¸Šé¢æˆ‘ä»¬å¯ä»¥å®šä¹‰åŸºäºå‡½æ•°ï¼Œæˆ–è€…åŸºäºç±»å½¢å¼çš„ä¾èµ–æ¡ä»¶ï¼Œä½†æ˜¯ä»–ä»¬æœ‰ä¸€ä¸ªå…±åŒçš„ç¼ºç‚¹ï¼š<strong>å†™æ­»ä¸å¯å˜çš„ï¼Œä¸æ”¯æŒå‚æ•°åŒ–</strong>ã€‚</p><p>æ¯”å¦‚ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªéœ€æ±‚ï¼Œè¦<strong>æ±‚æˆ‘ä»¬æ£€æŸ¥æŸ¥è¯¢å‚æ•°ä¸­</strong>çš„å­—æ®µæ˜¯å¦åŒ…å«æŒ‡å®šçš„æ–‡æœ¬ï¼Œå¹¶ä¸”è¢«æ£€æŸ¥çš„æ–‡æœ¬å¯ä»¥é€šè¿‡å‚æ•°çš„å½¢å¼è°ƒæ•´ã€‚</p><p>ç¤ºä¾‹1ï¼šæ£€æŸ¥æŒ‡å®šçš„æ–‡æœ¬æ˜¯å¦åœ¨æŸ¥è¯¢å‚æ•°qä¸­</p><ul><li>ç¼ºç‚¹ï¼šä»£ç é‡å¤ï¼Œä¸å¤Ÿçµæ´»ä¼˜é›…</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span>  FastAPI<br><br>app = FastAPI()<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/hello&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello_check</span>(<span class="hljs-params">q: <span class="hljs-built_in">str</span></span>):<br>    exists = <span class="hljs-string">&quot;hello&quot;</span> <span class="hljs-keyword">in</span> q<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;exists&quot;</span>: exists&#125;<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/world&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">world_check</span>(<span class="hljs-params">q: <span class="hljs-built_in">str</span></span>): <span class="hljs-comment"># å…¥å‚æ˜¯q åˆ¤æ–­qåŒ…ä¸åŒ…å«world ï¼ŒåŒ…å«å°±è¿”å›ture,å¦è¿™flase</span><br>    exists = <span class="hljs-string">&quot;world&quot;</span> <span class="hljs-keyword">in</span> q<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;exists&quot;</span>: exists&#125;<br></code></pre></td></tr></table></figure><p><strong>FastAPIçš„è§£å†³æ–¹å¼</strong></p><p>å¯¹äºä¸Šé¢çš„çš„éœ€æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŸºäºå¯¹è±¡çš„ä¾èµ–æ³¨å…¥ï¼Œåªè¦åœ¨ç±»ä¸‹é¢å®ç°<code>__call__</code>æ–¹æ³•ï¼Œè¯¥å¯¹è±¡å°±å¯ä»¥è¢«è°ƒç”¨ï¼ŒåŸºäºå¯ä»¥å½“åšä¾èµ–æ¡ä»¶</p><p>ç¤ºä¾‹2ï¼šåŸºäºå¯¹è±¡çš„ä¾èµ–æ¡ä»¶ï¼Œå‚æ•°åŒ–</p><ul><li>å¯¹è±¡<code>FixedContentQueryChecker(&quot;hello&quot;)</code>å½“ä¾èµ–æ¡ä»¶ï¼Œå®ƒè¢«è°ƒç”¨æ—¶å°±ä¼šæ‰§è¡Œå…¶é­”æ³•æ–¹æ³•<code>__call__</code>ï¼Œå°±ä¼šåˆ¤æ–­æŸ¥è¯¢å‚æ•°qä¸­æ˜¯å¦åŒ…å«å¾…æ£€æŸ¥çš„æ–‡æœ¬ä¿¡æ¯ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> Depends, FastAPI<br><br>app = FastAPI()<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">FixedContentQueryChecker</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, fixed_content: <span class="hljs-built_in">str</span></span>):     <span class="hljs-comment"># å®ä¾‹åŒ–å¯¹è±¡æ˜¯æ‰§è¡Œ</span><br>        self.fixed_content = fixed_content<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__call__</span>(<span class="hljs-params">self, q: <span class="hljs-built_in">str</span> = <span class="hljs-string">&quot;&quot;</span></span>) -&gt; <span class="hljs-built_in">bool</span>:    <span class="hljs-comment"># å¯¹è±¡è¢«è°ƒç”¨æ—¶æ‰§è¡Œ</span><br>        <span class="hljs-keyword">return</span> self.fixed_content <span class="hljs-keyword">in</span> q<br><br><span class="hljs-comment"># FixedContentQueryChecker(&quot;hello&quot;)æ˜¯åœ¨å°†ç±»å½“æ–¹æ³•è°ƒç”¨ï¼Œæ­¤æ—¶å°±ä¼šè§¦å‘ç±»çš„callæ–¹æ³•</span><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/hello&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">hello_check</span>(<span class="hljs-params">exists: <span class="hljs-built_in">bool</span> = Depends(<span class="hljs-params">FixedContentQueryChecker(<span class="hljs-params"><span class="hljs-string">&quot;hello&quot;</span></span>)</span>)</span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;exists&quot;</span>: exists&#125;<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/world&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">world_check</span>(<span class="hljs-params">exists: <span class="hljs-built_in">bool</span> = Depends(<span class="hljs-params">FixedContentQueryChecker(<span class="hljs-params"><span class="hljs-string">&quot;world&quot;</span></span>)</span>)</span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;exists&quot;</span>: exists&#125;<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå¤ä¹ ä¸€ä¸‹pythoné­”æ³•æ–¹æ³•call </p><ul><li>ç±»ä¸­çš„callåœ¨å¯¹è±¡è¢«è°ƒç”¨æ—¶å‡ºå‘ã€‚å°±æ˜¯å½“å¯¹è±¡åŠ æ‹¬å·è¢«è°ƒç”¨æ—¶è§¦å‘</li><li>å¯¹è±¡æˆ–è€…å˜é‡ï¼Œåªæœ‰å®ç°äº†callæ–¹æ³•ï¼Œæ‰æ˜¯å¯è°ƒç”¨å¯¹è±¡ï¼Œæ‰å¯ä»¥è¢«æ‰§è¡Œï¼Œå¦åˆ™å°±ä¼šæŠ¥é”™ï¼Œ object is not callable</li><li>å®šä¹‰äº†callåï¼Œä½ å®ä¾‹åŒ–çš„å¯¹è±¡å¯ä»¥åƒå‡½æ•°ä¸€æ ·è¢«è°ƒç”¨ï¼Œ</li></ul><h1 id="7-7-ä¾èµ–æ³¨å…¥ä½¿ç”¨yieldã€å¥½ç©ã€‘"><a href="#7-7-ä¾èµ–æ³¨å…¥ä½¿ç”¨yieldã€å¥½ç©ã€‘" class="headerlink" title="7-7 ä¾èµ–æ³¨å…¥ä½¿ç”¨yieldã€å¥½ç©ã€‘"></a>7-7 ä¾èµ–æ³¨å…¥ä½¿ç”¨yieldã€å¥½ç©ã€‘</h1><ul><li>fastapiçš„ä¾èµ–æ³¨å…¥éå¸¸å¼ºå¤§ï¼Œå®ƒè¿˜å¯ä»¥å…·å¤‡ä¸Šä¸‹æ–‡ç®¡ç†å™¨çš„åŠŸèƒ½ã€‚</li><li>æƒ³è¦åœ¨ä¾èµ–æ³¨å…¥ä¸­å®ç°ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <code>yield</code></li><li>æ¯”å¦‚ï¼Œæˆ‘ä»¬æƒ³è¦åœ¨è¿›å…¥è·¯å¾„æ“ä½œå‡½æ•°æ—¶é€šè¿‡ä¾èµ–è·å–ä¸€ä¸ªæ“ä½œæ•°æ®åº“çš„è¿æ¥ï¼Œè¯·æ±‚ç»“æŸåå…³é—­è¿™ä¸ªdbè¿æ¥</li></ul><p>ç¤ºä¾‹1ï¼šä¾èµ–æ³¨å…¥ä¸­ä½¿ç”¨yield</p><ul><li>è¿™æ ·å†™çš„å¥½å¤„æ˜¯ï¼Œåœ¨è·¯å¾„æ“ä½œå‡½æ•°ç»“æŸæ—¶ï¼Œä¼šè‡ªåŠ¨å…³é—­dbè¿æ¥å›æ”¶èµ„æºã€‚åŠæ—¶åœ¨è·¯å¾„å‡½æ•°ä¼šå‡ºç°å¼‚å¸¸æŠ¥é”™ï¼Œæœ€ç»ˆä¹Ÿä¼šå…³é—­è¿æ¥ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> Depends, FastAPI<br><br><br>app = FastAPI()<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_db</span>():<br>    db = DBSession()<br>    <span class="hljs-keyword">try</span>:<br>        <span class="hljs-keyword">yield</span> db<br>    <span class="hljs-keyword">finally</span>:<br>        db.close()<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/books/&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">books</span>(<span class="hljs-params">db: Depend(<span class="hljs-params">get_db</span>)</span>): <span class="hljs-comment"># å’Œpytestçš„fixtureç±»ä¼¼ä½¿ç”¨ï¼Œyieldå‡½æ•°å°±æ˜¯è¿­ä»£å™¨</span><br>    <span class="hljs-comment"># db.execute(&quot;select * form books&quot;)   dbæ“ä½œ</span><br>    <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure><h1 id="7-8-å›å¿†è¡¥å……ä¸Šä¸‹æ–‡ç®¡ç†å™¨ã€é‡è¦ã€‘"><a href="#7-8-å›å¿†è¡¥å……ä¸Šä¸‹æ–‡ç®¡ç†å™¨ã€é‡è¦ã€‘" class="headerlink" title="7-8 å›å¿†è¡¥å……ä¸Šä¸‹æ–‡ç®¡ç†å™¨ã€é‡è¦ã€‘"></a>7-8 å›å¿†è¡¥å……ä¸Šä¸‹æ–‡ç®¡ç†å™¨ã€é‡è¦ã€‘</h1><p><strong>ä¸Šä¸‹æ–‡ç®¡ç†å™¨ æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p><ul><li>æ˜¯ä¸€ç§ç”¨äºç®¡ç†èµ„æºçš„<strong>æœºåˆ¶</strong></li><li>å®ƒæä¾›äº†ä¸€ç§æ–¹ä¾¿çš„æ–¹å¼æ¥<strong>è‡ªåŠ¨è·å–å’Œé‡Šæ”¾èµ„æº</strong>ï¼Œç¡®ä¿èµ„æºåœ¨ä½¿ç”¨å®Œæ¯•åè¢«<strong>æ­£ç¡®çš„é‡Šæ”¾</strong>ï¼Œ<strong>æ— è®ºæ˜¯æ­£å¸¸æ‰§è¡Œè¿˜æ˜¯å‘ç”Ÿå¼‚å¸¸</strong>ï¼Œéƒ½èƒ½<strong>æ­£ç¡®é‡Šæ”¾</strong></li></ul><p><strong>ä¸Šä¸‹æ–‡ç®¡ç†åè®®éœ€è¦å®ç°ä¸¤ä¸ªåŠŸèƒ½</strong>ï¼š</p><ul><li><code>__enter__</code>ï¼Œè¿›å…¥ä¸Šä¸‹æ–‡æ—¶è¿è¡Œï¼Œå¹¶è¿”å›å½“å‰å¯¹è±¡ã€‚å¦‚æœwithè¯­å¥æœ‰aså…³é”®è¯å­˜åœ¨ï¼Œè¿”å›å€¼ä¼šç»‘å®šåœ¨asåçš„å˜é‡ä¸Šã€‚</li><li><code>__exit__</code>ï¼Œé€€å‡ºä¸Šä¸‹æ–‡æ—¶è¿è¡Œ</li></ul><p>ä¸Šä¸‹æ–‡ç®¡ç†å™¨ä¸­çš„ <code>with</code>, å®ƒçš„ä¸€ä¸ªå¸¸è§ä½¿ç”¨åœºæ™¯å¦‚ä¸‹ï¼š</p><ul><li>openå‡½æ•°ä¼šè¿”å›ä¸€ä¸ªæ–‡ä»¶ç±»å‹å˜é‡ï¼Œè¿™ä¸ªæ–‡ä»¶ç±»å®ç°äº†ä¸Šä¸‹æ–‡ç®¡ç†åè®®ï¼Œè€Œwithè¯­å¥å°±æ˜¯ä¸ºæ”¯æŒä¸Šä¸‹æ–‡ç®¡ç†å™¨è€Œå­˜åœ¨çš„ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;test.txt&quot;</span>,<span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">as</span> f:  <span class="hljs-comment"># open()è¿”å›çš„å°±æ˜¯ä¸€ä¸ªä¸Šä¸‹æ–‡ç®¡ç†å™¨</span><br>    content = f.read()<br></code></pre></td></tr></table></figure><ul><li>è¿›å…¥withè¯­å¥å—æ—¶ï¼Œå°±ä¼šæ‰§è¡Œæ–‡ä»¶ç±»çš„<code>__enter__</code>è¿”å›ä¸€ä¸ªæ–‡ä»¶å¯¹è±¡ï¼Œå¹¶èµ‹å€¼ç»™å˜é‡ <code>f</code></li><li>ä»withè¯­å¥å—å‡ºæ¥æ—¶ï¼Œæœºä¼šæ‰§è¡Œæ–‡ä»¶ç±»çš„<code>__exit__</code>ï¼Œåœ¨å…¶å†…éƒ¨å®ç° <strong>f.close()<strong>ï¼Œæ‰€ä»¥</strong>ä½¿ç”¨è€…å°±ä¸éœ€è¦åœ¨æ‰‹åŠ¨å…³é—­æ–‡ä»¶å¯¹è±¡</strong>äº†ã€‚</li></ul><p>ç¤ºä¾‹1ï¼šæ‰‹åŠ¨å°è£…å®ç°ç±»ä¼¼äºopen()çš„ä¸Šä¸‹æ–‡ç®¡ç†å™¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyFile</span>():<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self,name</span>):<br>        self.name = name<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__enter__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;è¿›å…¥with......&quot;</span>)<br>        <span class="hljs-keyword">return</span> self   <span class="hljs-comment"># è¿”å›çš„æ•°æ®å¤åˆ¶ç»™ä¸‹é¢çš„p</span><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__exit__</span>(<span class="hljs-params">selfï¼Œ exc_type, exc_val, exc_tb</span>): <br>        <span class="hljs-comment"># exc_typeè¡¨ç¤ºå¼‚å¸¸ç±»å‹ï¼Œexc_valè¡¨ç¤ºå¼‚å¸¸å€¼ï¼Œexc_tbè¡¨ç¤ºå¼‚å¸¸å›è°ƒ æ˜¯é»˜è®¤è¦å¡«çš„</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;é€€å‡ºwith=====&quot;</span>)<br>        <br><span class="hljs-keyword">with</span> MyFile(<span class="hljs-string">&#x27;Tom&#x27;</span>) <span class="hljs-keyword">as</span> p:  <span class="hljs-comment"># MyFileï¼ˆ ï¼‰è¿”å›çš„ä¹Ÿæ˜¯ä¸€ä¸ªä¸Šä¸‹æ–‡ç®¡ç†å™¨</span><br>    <span class="hljs-built_in">print</span>(p.name)  <br><span class="hljs-comment"># æ‰§è¡Œçš„ç»“æœæ˜¯</span><br><span class="hljs-comment"># è¿›å…¥with......</span><br><span class="hljs-comment"># Tom</span><br><span class="hljs-comment"># é€€å‡ºwith=====</span><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹2ï¼šcontextlib æ¨¡å—å®ç°ä¸Šä¸‹æ–‡ç®¡ç†å™¨ã€æ‹“å±•ã€‘</p><ul><li>ä½¿ç”¨è£…é¥°å™¨ contextmanager</li><li>get_fileå‡½æ•°å†…éƒ¨ï¼Œyieldè¯­å¥å‰çš„ä»£ç åœ¨è¿›å…¥withè¯­å¥æ—¶æ‰§è¡Œï¼Œyieldçš„å€¼èµ‹å€¼ç»™ asåé¢çš„å˜é‡ï¼Œ</li><li>yieldåé¢çš„ä»£ç åœ¨é€€å‡ºwithè¯­å¥æ—¶æ‰§è¡Œ</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> contextlib<br><br><br><span class="hljs-meta">@contextlib.contextmanager</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_file</span>(<span class="hljs-params">filename: <span class="hljs-built_in">str</span></span>):<br>    file = <span class="hljs-built_in">open</span>(filename, <span class="hljs-string">&quot;r&quot;</span>, encoding=<span class="hljs-string">&quot;utf-8&quot;</span>)<br>    <span class="hljs-keyword">yield</span> file<br>    file.close()<br><br><br><span class="hljs-keyword">with</span> get_file(<span class="hljs-string">&#x27;test.txt&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    <span class="hljs-built_in">print</span>(f.read()) <span class="hljs-comment"># æ‰“å°æ–‡ä»¶å†…çš„å†…å®¹</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç¼–ç¨‹ï¼Œwebå¼€å‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€pythonã€‘FastAPIè¡¨å•å’Œæ–‡ä»¶ä¸Šä¼ ï¼ˆä¸‰ï¼‰</title>
    <link href="/2024/01/18/683FastAPI3%E8%A1%A8%E5%8D%95%E5%92%8C%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/"/>
    <url>/2024/01/18/683FastAPI3%E8%A1%A8%E5%8D%95%E5%92%8C%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/</url>
    
    <content type="html"><![CDATA[<h1 id="6-1-ä»€ä¹ˆæ˜¯Form-è¡¨å•"><a href="#6-1-ä»€ä¹ˆæ˜¯Form-è¡¨å•" class="headerlink" title="6-1  ä»€ä¹ˆæ˜¯Form è¡¨å•"></a>6-1  ä»€ä¹ˆæ˜¯Form è¡¨å•</h1><p>å¾ˆå¤šç½‘ç«™éƒ½æ”¯æŒä¸Šä¼ æ–‡ä»¶ï¼Œæ¯”å¦‚è¯´ï¼šæ³¨å†Œæ—¶ä¸Šä¼ å¤´åƒï¼›å¡«å†™é—®å·æ—¶ä¸Šä¼ é™„ä»¶ç­‰ç­‰ã€‚</p><p>Formè¡¨å•å…¶å®æ˜¯å‰ç«¯HTMLè¯­è¨€ä¸­çš„ä¸€ä¸ªæ ‡ç­¾è¯­è¨€ï¼Œç”¨æ¥å‘æœåŠ¡ç«¯ä¸Šä¼ æ™®é€šæ•°æ®å’Œæ–‡ä»¶ã€‚</p><p>ç¤ºä¾‹1ï¼šFormè¡¨å•çš„åŸºæœ¬ä½¿ç”¨ï¼ˆæµè§ˆå™¨ç›´æ¥æ‰“å¼€è¯¥æ–‡ä»¶å³å¯æ¸²æŸ“å‡ºformè¡¨å•é¡µé¢ï¼‰</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>ç™»å½•é¡µé¢<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>ç”¨æˆ·ç™»å½•<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/login&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>å§“åï¼š <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>å¯†ç ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;ç™»å½•&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li><code>action=&quot;/login&quot;</code>ï¼Œactionç”¨æ¥è®¾ç½®æœåŠ¡ç«¯çš„æ¥å£ï¼Œä¸è®¾ç½®è¡¨ç¤ºæœå½“å‰é¡µé¢æ‰€åœ¨URLå‘è¯·æ±‚</li><li><code>method=&quot;post&quot;</code>ï¼Œmethosç”¨æ¥è®¾ç½®å‘è¯·æ±‚çš„æ–¹å¼ï¼Œä¸€å…±æœ‰ä¸¤ç§ï¼špostå’Œgetï¼Œä¸è®¾ç½®é»˜è®¤æ˜¯getè¯·æ±‚</li><li><input type="text" name="username">ï¼Œnameç”¨æ¥è®¾ç½®è¯¥å­—æ®µçš„å­—æ®µå</li><li><input type="password" name="password">ï¼Œ typeç”¨æ¥è®¾ç½®è¯¥å­—æ®µçš„ç±»å‹ï¼Œæˆ–è€…è¯´inputæ ‡ç­¾çš„ç±»å‹</li></ul><p>è¡¥å……ï¼šå¸¸è§çš„inputæ ‡ç­¾ç±»å‹</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span>&gt;</span>    <span class="hljs-comment">&lt;!--æ™®é€šæ–‡æœ¬--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;password&quot;</span>&gt;</span><span class="hljs-comment">&lt;!--å¯†ç æ–‡æœ¬ï¼Œå¯†ç å¯†æ–‡ç°å®--&gt;</span>  <span class="hljs-comment">&lt;!-- --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;date&quot;</span>&gt;</span>    <span class="hljs-comment">&lt;!--æ—¥æœŸï¼Œå›ºå®šæ—¥æœŸæäº¤æ ¼å¼--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span>&gt;</span><span class="hljs-comment">&lt;!--æäº¤ï¼Œç”¨æ¥è§¦å‘formè¡¨å•æäº¤æ•°æ®çš„åŠ¨ä½œ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;button&quot;</span>&gt;</span><span class="hljs-comment">&lt;!--æŒ‰é’®ï¼Œæ™®é€šæŒ‰é’®ï¼Œæœ¬èº«æ²¡æœ‰åŠŸèƒ½ï¼Œä½†æ˜¯ç»“åˆjså¯ä»¥ç»‘å®šäº‹ä»¶ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;reset&quot;</span>&gt;</span><span class="hljs-comment">&lt;!--é‡ç½® --&gt;</span> <br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;radio&quot;</span>&gt;</span><span class="hljs-comment">&lt;!--å•é€‰ï¼Œ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;checkbox&quot;</span>&gt;</span><span class="hljs-comment">&lt;!--å¤šé€‰ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span>&gt;</span>    <span class="hljs-comment">&lt;!--æ–‡ä»¶ï¼Œä¸Šä¼ æ–‡ä»¶ --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;hidden&quot;</span>&gt;</span><span class="hljs-comment">&lt;!--éšè—ï¼Œéšè—å½“å‰è¾“å…¥æ¡† --&gt;</span><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹2ï¼šFormè¡¨å•ç”¨æ¥ä¸Šä¼ æ–‡ä»¶</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;en&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;UTF-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>ä¸Šä¼ å¤´åƒ<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>ä¸Šä¼ å¤´åƒ<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">form</span> <span class="hljs-attr">action</span>=<span class="hljs-string">&quot;/login&quot;</span> <span class="hljs-attr">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attr">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>å§“åï¼š <span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;username&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>å¯†ç ï¼š<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;password&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;password&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>å¤´åƒï¼š<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;file&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;avatar&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;submit&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;æäº¤&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">form</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></td></tr></table></figure><ul><li>enctype&#x3D;â€multipart&#x2F;form-dataâ€ï¼Œä¸Šä¼ æ–‡ä»¶æ¯”è¾ƒç‰¹æ®Šï¼Œéœ€è¦ä½¿ç”¨enctypeæŒ‡å®šç¼–ç </li><li><input type="file" name="avatar"></p>ï¼Œä¸Šä¼ æ–‡ä»¶çš„å­—æ®µéœ€è¦ä½¿ç”¨ç±»å‹ä¸ºfileçš„inputæ ‡ç­¾</li></ul><h1 id="6-2-Formè¡¨å•ä¸¤ç§ç¼–ç æ–¹å¼"><a href="#6-2-Formè¡¨å•ä¸¤ç§ç¼–ç æ–¹å¼" class="headerlink" title="6-2 Formè¡¨å•ä¸¤ç§ç¼–ç æ–¹å¼"></a>6-2 Formè¡¨å•ä¸¤ç§ç¼–ç æ–¹å¼</h1><p>Formè¡¨å•æäº¤æ•°æ®æœ‰ä¸¤ç§è¯·æ±‚æ–¹å¼ï¼ŒGETå’ŒPOSTã€‚</p><p>å½“ä½¿ç”¨POSTè¯·æ±‚æ—¶ï¼Œè¯·æ±‚ä½“æ•°æ®æœ‰ä¸¤ç§å¸¸ç”¨çš„ç¼–ç æ–¹å¼ï¼Œéå¸¸é‡è¦ã€‚</p><ul><li><pre><code class="html">&lt;form action=&quot;/login&quot; method=&quot;post&quot; enctype=&quot;application/x-www-form-urlencoded&quot;&gt;&lt;/form&gt;<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br>- ~~~html<br>  &lt;form <span class="hljs-attribute">action</span>=<span class="hljs-string">&quot;/login&quot;</span> <span class="hljs-attribute">method</span>=<span class="hljs-string">&quot;post&quot;</span> <span class="hljs-attribute">enctype</span>=<span class="hljs-string">&quot;multipart/form-data&quot;</span>&gt;&lt;/form&gt;<br></code></pre></td></tr></table></figure></code></pre></li></ul><p>å½“è¯·æ±‚ä½“ç¼–ç æ˜¯application&#x2F;x-www-form-urlencodedï¼Œæ­¤æ—¶ç¼–ç æ–¹å¼å’Œurlä¸­çš„æŸ¥è¯¢å‚æ•°ç¼–ç æ ¼å¼ä¸€è‡´ï¼Œä¸èƒ½ç”¨æ¥ä¸Šä¼ æ–‡ä»¶</p><p>å½“è¯·æ±‚ä½“ç¼–ç æ˜¯multipart&#x2F;form-dataæ—¶ï¼Œæ—¢å¯ä»¥ä¸Šä¼ æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥å‘é€æ™®é€šæ•°æ®ã€‚</p><h1 id="6-3-ä½¿ç”¨Formæ¥æ”¶è¡¨å•æ•°æ®"><a href="#6-3-ä½¿ç”¨Formæ¥æ”¶è¡¨å•æ•°æ®" class="headerlink" title="6-3 ä½¿ç”¨Formæ¥æ”¶è¡¨å•æ•°æ®"></a>6-3 ä½¿ç”¨Formæ¥æ”¶è¡¨å•æ•°æ®</h1><p>è¯·æ±‚ä½“æ•°æ®çš„ç¼–ç æ ¼å¼é™¤äº†å¯ä»¥JOSNï¼Œè¿˜å¯ä»¥æ˜¯ä½¿ç”¨formè¡¨å•çš„application&#x2F;x-www-form-urlencodedå’Œmultipart&#x2F;form-data</p><p>å½“å‰ç«¯ä½¿ç”¨formè¡¨å•æäº¤æ•°æ®ï¼ŒenctypeæŒ‡å®šapplication&#x2F;x-www-form-urlencodedï¼Œæ­¤æ—¶FastAPIè¯¥æ€ä¹ˆè§£ææ•°æ®å‘¢ï¼Ÿ</p><p>ç¤ºä¾‹1ï¼šä½¿ç”¨ <code>Form()</code> å‡½æ•°æ¥æ¥æ”¶urlencodedç¼–ç æ ¼å¼çš„è¡¨å•æ•°æ®</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Form<br><br>app = FastAPI()<br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/login/&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">username: <span class="hljs-built_in">str</span> = Form(<span class="hljs-params"></span>), password: <span class="hljs-built_in">str</span> = Form(<span class="hljs-params"></span>)</span>):<br>    <span class="hljs-keyword">return</span> &#123;<br>        <span class="hljs-string">&quot;username&quot;</span>: username,<br>        <span class="hljs-string">&quot;password&quot;</span>: password<br>    &#125;<br></code></pre></td></tr></table></figure><ul><li><p>è·¯å¾„å‡½æ•°ä¸­çš„å‚æ•°å¦‚æœå¸Œæœ›æ˜¯è¡¨å•å­—æ®µï¼Œå¿…é¡»ä½¿ç”¨ <code>Form()</code>ï¼Œå¦åˆ™ä¼šè¢«å½“åšæŸ¥è¯¢å‚æ•°å’Œè¯·æ±‚ä½“å‚æ•°ã€‚</p></li><li><p><code>Form()</code>å’Œå‰é¢ä»‹ç»çš„ <code>Path()</code>ã€<code>Query()</code>ã€<code>Body()</code>ã€<code>Header()</code>çš„ç”¨æ³•åŸºæœ¬ä¸€è‡´ï¼Œæ”¯æŒç±»å‹æ ¡æ ¸å’Œè½¬æ¢ã€‚</p></li><li><p>æƒ³è¦ä½¿ç”¨ <code>Form</code>æ¥æ”¶è¡¨å•æ•°æ®ï¼Œéœ€è¦å®‰è£…pythonæ‰©å±•åŒ…ï¼š<code>pip3 install python-multipart</code></p></li></ul><p>é™¤äº†ä½¿ç”¨postmanä¹Ÿå¯ä»¥ä½¿ç”¨FastAPIè‡ªå¸¦çš„apiæ–‡æ¡£è¯·æ±‚æ¥å£</p><h1 id="6-4-ä½¿ç”¨Fileä¸Šä¼ æ–‡ä»¶"><a href="#6-4-ä½¿ç”¨Fileä¸Šä¼ æ–‡ä»¶" class="headerlink" title="6-4 ä½¿ç”¨Fileä¸Šä¼ æ–‡ä»¶"></a>6-4 ä½¿ç”¨Fileä¸Šä¼ æ–‡ä»¶</h1><p>ã€å‰æã€‘ï¼šéœ€è¦æå‰ä¸‹è½½ç¬¬ä¸‰æ–¹åŒ…ï¼š<code>pip3 install python-multipart</code></p><p>ç¤ºä¾‹1ï¼šä½¿ç”¨ <code>File()</code>ç”¨æ¥æ¥æ”¶è¡¨å•å‘é€è¿‡æ¥çš„æ–‡ä»¶</p><ul><li>è·¯å¾„å‡½æ•°ä¸­å½¢å‚<code>file</code>è¦å’Œè¡¨å•ä¸­æ–‡ä»¶å­—æ®µä¿æŒä¸€è‡´ï¼Œä¸”å½¢å‚çš„ç±»å‹ä¸º <code>bytes</code>ï¼Œå€¼ä¸º<code>File()</code>ï¼Œè¿™æ ·å°±å¯ä»¥ç›´æ¥å°†æ–‡ä»¶ä¸­äºŒè¿›åˆ¶æ•°æ®ä¿å­˜åˆ°å½¢å‚<code>file</code>ä¸­ï¼Œä¹Ÿå°±æ˜¯ç›´æ¥å°†æ–‡ä»¶å†…å®¹è¯»å–åˆ°å†…å­˜ä¸­ï¼Œé€‚åˆå°æ–‡ä»¶ä¸Šä¼ ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, File<br><br><br>app = FastAPI()<br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/upload&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">upload_file</span>(<span class="hljs-params">file: <span class="hljs-built_in">bytes</span> = File(<span class="hljs-params"></span>)</span>):<br>    <span class="hljs-built_in">print</span>(file)<span class="hljs-comment"># fileä¸­ä¿å­˜çš„å°±æ˜¯æ–‡ä»¶çš„äºŒè¿›åˆ¶æ•°æ®</span><br>    <span class="hljs-comment"># æ–‡ä»¶å†…å®¹ä¿å­˜åœ¨ç¡¬ç›˜</span><br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;a.txt&quot;</span>, <span class="hljs-string">&quot;wb&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        f.write(file)<br>    <span class="hljs-keyword">return</span> file<br></code></pre></td></tr></table></figure><blockquote><p>ä½¿ç”¨apiæ–‡æ¡£å‘é€è¯·æ±‚ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨postmanå‘é€è¡¨å•è¯·æ±‚</p></blockquote><p>ç¤ºä¾‹2ï¼šå½¢å‚<code>file</code>çš„ç±»å‹ä¸èƒ½æ˜¯<code>str</code>ï¼Œä½†å¦‚æœæ²¡æœ‰ç±»å‹ï¼Œç›´æ¥ä½¿ç”¨ <code>file=File()</code>ä¹Ÿå¯ä»¥ï¼Œåªä¸è¿‡è¿™æ ·éœ€è¦ç‰¹æ®Šå¤„ç†æ‰èƒ½è·å–æ–‡ä»¶å†…å®¹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, File<br><br><br>app = FastAPI()<br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/upload&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">upload_file</span>(<span class="hljs-params">file=File(<span class="hljs-params"></span>)</span>):<br>    content = <span class="hljs-keyword">await</span> file.read()<span class="hljs-comment"># éœ€è¦ç‰¹æ®Šå¤„ç†æ‰èƒ½è¿‡å»æ–‡ä»¶çš„äºŒè¿›åˆ¶æ•°æ®</span><br>    <span class="hljs-built_in">print</span>(content)<br>    <span class="hljs-keyword">return</span> content<br></code></pre></td></tr></table></figure><p>ã€é‡è¦ã€‘ å¯¹äºä¸Šæ–‡ä»¶çš„ä¸Šä¼ éœ€æ±‚ï¼Œæ¨èä½¿ç”¨ç¤ºä¾‹1çš„æ–¹å¼ã€‚</p><p>ã€æ€»ç»“ã€‘åªè¦åœ¨è·¯å¾„æ“ä½œå‡½æ•°ä¸­å£°æ˜äº†å˜é‡çš„ç±»å‹æ˜¯<code>bytes</code>ä¸”ä½¿ç”¨äº†<code>File,</code>åˆ™fastapiä¼šå°†ä¸Šä¼ æ–‡ä»¶çš„å†…å®¹å…¨éƒ¨å»è¯»åˆ°å‚æ•°ä¸­ã€‚</p><h1 id="6-5-ä½¿ç”¨UploadFileä¸Šä¼ æ–‡ä»¶"><a href="#6-5-ä½¿ç”¨UploadFileä¸Šä¼ æ–‡ä»¶" class="headerlink" title="6-5 ä½¿ç”¨UploadFileä¸Šä¼ æ–‡ä»¶"></a>6-5 ä½¿ç”¨UploadFileä¸Šä¼ æ–‡ä»¶</h1><p>å‰æã€‘ï¼šéœ€è¦æå‰ä¸‹è½½ç¬¬ä¸‰æ–¹åŒ…ï¼š<code>pip3 install python-multipart</code></p><p>ã€éœ€æ±‚ã€‘ï¼šå¯¹äºå¤§æ–‡ä»¶ï¼Œä¸é€‚åˆç›´æ¥æŠŠæ–‡ä»¶å†…å®¹ä¸€æ¬¡æ€§è¯»å–åˆ°å†…å­˜ä¸­ï¼Œæ­¤æ—¶æ¨èä½¿ç”¨ <code>UploadFile</code></p><p>ç¤ºä¾‹1ï¼šä½¿ç”¨UploadFileç±»å‹çš„ä¸‰ä¸ªå±æ€§</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, UploadFile<br><br>app = FastAPI()<br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/upload&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">upload_file</span>(<span class="hljs-params">file: UploadFile</span>):<span class="hljs-comment"># UploadFileæ˜¯ç±»å‹ï¼Œä¸ç”¨åŠ æ‹¬å·å“¦</span><br>    <br>    content = file.file.read()<span class="hljs-comment"># å¯ä»¥ç›´æ¥ä½¿ç”¨æ–‡ä»¶çš„æ“ä½œæ–¹æ³•</span><br>    file.file.close()<br>    <br>    <span class="hljs-keyword">return</span> &#123;<br>        <span class="hljs-string">&quot;filename&quot;</span>: file.filename,<span class="hljs-comment"># filename æ˜¯æ–‡ä»¶å å¦‚ï¼ša.txt</span><br>        <span class="hljs-string">&quot;type&quot;</span>: file.content_type,<span class="hljs-comment"># content_type æ˜¯æ–‡ä»¶ç±»å‹ å¦‚ï¼štext/plain</span><br>        <span class="hljs-string">&quot;content&quot;</span>: content      <span class="hljs-comment"># fileæ˜¯æ ‡å‡†çš„Pythonæ–‡ä»¶å¯¹è±¡ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æ–‡ä»¶çš„æ“ä½œ</span><br>    &#125;<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹2ï¼šä½¿ç”¨UploadFileç±»å‹çš„å››ä¸ªæ–¹æ³•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, UploadFile<br><br>app = FastAPI()<br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/upload&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">upload_file</span>(<span class="hljs-params">file: UploadFile</span>):<br>    <br>    content = <span class="hljs-keyword">await</span> file.read()<span class="hljs-comment"># å¼‚æ­¥è¯»æ–‡ä»¶</span><br>    <span class="hljs-keyword">await</span> file.close()    <span class="hljs-comment"># å¼‚æ­¥å…³é—­æ–‡ä»¶</span><br>    <br>    <span class="hljs-comment"># await file.write()      # å¼‚æ­¥å†™æ–‡ä»¶</span><br>    <span class="hljs-comment"># await fiel.seek(1)    # å¼‚æ­¥ç§»åŠ¨å…‰æ ‡</span><br>        <br>    <span class="hljs-keyword">return</span> &#123;<br>        <span class="hljs-string">&quot;filename&quot;</span>: file.filename,<br>        <span class="hljs-string">&quot;type&quot;</span>: file.content_type,<br>        <span class="hljs-string">&quot;content&quot;</span>: content<br>    &#125;<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹3ï¼šä½¿ç”¨UploadFileçš„åŒæ—¶ä¹Ÿå¯ä»¥æ˜¯ä½¿ç”¨File</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, UploadFile, File<br><br>app = FastAPI()<br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/upload&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">upload_file</span>(<span class="hljs-params">file: UploadFile = File(<span class="hljs-params"></span>)</span>):<br><br>    <span class="hljs-keyword">return</span> &#123;<br>        <span class="hljs-string">&quot;filename&quot;</span>: file.filename,<br>        <span class="hljs-string">&quot;type&quot;</span>: file.content_type,<br>    &#125;<br></code></pre></td></tr></table></figure><p>ã€æ€»ç»“ã€‘</p><ul><li>UploadFileä¸ä¼šæŠŠæ–‡ä»¶å†…å®¹å…¨éƒ¨åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè€Œæ˜¯æ‰¹é‡è¯»å–ä¸€å®šé‡çš„æ•°æ®ï¼Œè¾¹è¯»è¾¹å­˜ç¡¬ç›˜ï¼Œé€‚åˆå¤§æ–‡ä»¶ã€‚</li><li>UploadFileç±»å‹é—®å˜é‡æœ‰3ä¸ªå±æ€§ï¼ˆfilenameã€content_typeã€fileï¼‰ï¼Œ4ä¸ªå¼‚æ­¥æ–¹æ³•ï¼ˆread\write\seek\closeï¼‰ã€‚</li></ul><h1 id="6-6-è®¾ç½®ä¸Šä¼ æ–‡ä»¶æ˜¯å¯é€‰çš„"><a href="#6-6-è®¾ç½®ä¸Šä¼ æ–‡ä»¶æ˜¯å¯é€‰çš„" class="headerlink" title="6-6 è®¾ç½®ä¸Šä¼ æ–‡ä»¶æ˜¯å¯é€‰çš„"></a>6-6 è®¾ç½®ä¸Šä¼ æ–‡ä»¶æ˜¯å¯é€‰çš„</h1><p>ç¤ºä¾‹ï¼šè®¾ç½®é»˜è®¤å€¼æ˜¯Noneå°±è¡¨ç¤ºä¸Šä¼ æ–‡ä»¶æ˜¯å¯é€‰çš„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Optional</span><br><br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, File, UploadFile<br><br>app = FastAPI()<br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/file&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_file</span>(<span class="hljs-params">file: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">bytes</span>] = File(<span class="hljs-params">default=<span class="hljs-literal">None</span></span>)</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> file:<br>        <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;No file sent&quot;</span>&#125;<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;file_size&quot;</span>: <span class="hljs-built_in">len</span>(file)&#125;<br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/uploadfile&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_upload_file</span>(<span class="hljs-params">file: <span class="hljs-type">Optional</span>[UploadFile] = <span class="hljs-literal">None</span></span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> file:<br>        <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;No upload file sent&quot;</span>&#125;<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;filename&quot;</span>: file.filename&#125;<br></code></pre></td></tr></table></figure><h1 id="6-7-ä¸Šä¼ å¤šä¸ªæ–‡ä»¶"><a href="#6-7-ä¸Šä¼ å¤šä¸ªæ–‡ä»¶" class="headerlink" title="6-7 ä¸Šä¼ å¤šä¸ªæ–‡ä»¶"></a>6-7 ä¸Šä¼ å¤šä¸ªæ–‡ä»¶</h1><p>ç¤ºä¾‹ï¼šä¸Šä¼ å¤šä¸ªæ–‡ä»¶ï¼Œæ–‡ä»¶å­—æ®µåå¯ä»¥åŒåä¹Ÿå¯ä»¥ä¸åŒå</p><ul><li>åŒåå­—æ®µæ—¶ï¼Œä¹Ÿå¯ä½¿ç”¨ <code>files: List[bytes] = File()</code></li><li>ä¸åŒåå­—æ®µï¼Œå¯ä»¥ç›´æ¥å®šä¹‰å¤šä¸ªå½¢å‚å³å¯ã€‚</li><li>å¤šæ–‡ä»¶ä¸Šä¼ ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨UploadFileï¼›ä¹Ÿå¯ä»¥åŒæ—¶ä½¿ç”¨Fileå’ŒUploadFile</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span><br><br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, File, UploadFile<br><br>app = FastAPI()<br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/files&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_files</span>(<span class="hljs-params">files: <span class="hljs-type">List</span>[<span class="hljs-built_in">bytes</span>] = File(<span class="hljs-params"></span>)</span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;file_sizes&quot;</span>: [<span class="hljs-built_in">len</span>(file) <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> files]&#125;<br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/files2&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_files</span>(<span class="hljs-params">file1: <span class="hljs-built_in">bytes</span> = File(<span class="hljs-params"></span>), file2: <span class="hljs-built_in">bytes</span> = File(<span class="hljs-params"></span>)</span>):<br>    <span class="hljs-keyword">return</span> &#123;<br>        <span class="hljs-string">&quot;file1_size&quot;</span>: <span class="hljs-built_in">len</span>(file1),<br>        <span class="hljs-string">&quot;file2_size&quot;</span>: <span class="hljs-built_in">len</span>(file2),<br>    &#125;<br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/uploadfiles&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_upload_files</span>(<span class="hljs-params">files: <span class="hljs-type">List</span>[UploadFile]</span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;filenames&quot;</span>: [file.filename <span class="hljs-keyword">for</span> file <span class="hljs-keyword">in</span> files]&#125;<br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/uploadfile2&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">upload_file_and_file</span>(<span class="hljs-params">file1: UploadFile, file2: <span class="hljs-built_in">bytes</span> = File(<span class="hljs-params"></span>)</span>):<br>    <span class="hljs-keyword">return</span> &#123;<br>        <span class="hljs-string">&quot;file1_name&quot;</span>: file1.filename,<br>        <span class="hljs-string">&quot;file2_size&quot;</span>: <span class="hljs-built_in">len</span>(file2)<br>    &#125;<br></code></pre></td></tr></table></figure><h1 id="6-8-åŒæ—¶æ¥æ”¶è¡¨å•æ•°æ®å’Œæ–‡ä»¶"><a href="#6-8-åŒæ—¶æ¥æ”¶è¡¨å•æ•°æ®å’Œæ–‡ä»¶" class="headerlink" title="6-8 åŒæ—¶æ¥æ”¶è¡¨å•æ•°æ®å’Œæ–‡ä»¶"></a>6-8 åŒæ—¶æ¥æ”¶è¡¨å•æ•°æ®å’Œæ–‡ä»¶</h1><ul><li>å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éœ€è¦åŒæ—¶æ¥æ”¶è¡¨å•æ•°æ®å’Œä¸Šä¼ çš„æ–‡ä»¶æ•°æ®ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥åŒæ—¶ä½¿ç”¨Formå’ŒFileæˆ–UploadFile</li></ul><p>ç¤ºä¾‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> typing<br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Form, File, UploadFile<br><br>app = FastAPI()<br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/register&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">register</span>(<span class="hljs-params"></span><br><span class="hljs-params">        avatar: typing.<span class="hljs-type">Optional</span>[<span class="hljs-built_in">bytes</span>] = File(<span class="hljs-params">default=<span class="hljs-literal">None</span></span>),</span><br><span class="hljs-params">        username: <span class="hljs-built_in">str</span> = Form(<span class="hljs-params"></span>),</span><br><span class="hljs-params">        password: <span class="hljs-built_in">str</span> = Form(<span class="hljs-params">min_length=<span class="hljs-number">6</span>, max_length=<span class="hljs-number">10</span></span>),</span><br><span class="hljs-params">        accessary: typing.<span class="hljs-type">Optional</span>[UploadFile] = <span class="hljs-literal">None</span></span><br><span class="hljs-params"></span>):<br>    <span class="hljs-keyword">return</span> &#123;<br>        <span class="hljs-string">&quot;username&quot;</span>: username,<br>        <span class="hljs-string">&quot;password&quot;</span>: password,<br>        <span class="hljs-string">&quot;avatar&quot;</span>: <span class="hljs-built_in">len</span>(avatar) <span class="hljs-keyword">if</span> avatar <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>,<br>        <span class="hljs-string">&quot;accessary&quot;</span>: accessary.filename <span class="hljs-keyword">if</span> accessary <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;&quot;</span><br>    &#125;<br></code></pre></td></tr></table></figure><p>ã€æ³¨æ„ã€‘ï¼š<strong>åŒæ—¶ä½¿ç”¨Formå’ŒFileæ—¶ï¼ŒFileè¦æ”¾åœ¨Formå‰é¢ã€‚</strong></p>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç¼–ç¨‹ï¼Œwebå¼€å‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€pythonã€‘FastAPIè¯·æ±‚å¤´ä½“ï¼ˆäºŒï¼‰</title>
    <link href="/2024/01/16/682FastAPI2%E8%AF%B7%E6%B1%82%E5%A4%B4%E4%BD%93/"/>
    <url>/2024/01/16/682FastAPI2%E8%AF%B7%E6%B1%82%E5%A4%B4%E4%BD%93/</url>
    
    <content type="html"><![CDATA[<h1 id="3-1ä½¿ç”¨Header-æ¥æ”¶è¯·æ±‚å¤´å‚æ•°"><a href="#3-1ä½¿ç”¨Header-æ¥æ”¶è¯·æ±‚å¤´å‚æ•°" class="headerlink" title="3-1ä½¿ç”¨Header æ¥æ”¶è¯·æ±‚å¤´å‚æ•°"></a>3-1ä½¿ç”¨Header æ¥æ”¶è¯·æ±‚å¤´å‚æ•°</h1><p><strong>éœ€æ±‚åœºæ™¯ï¼š</strong>å‡è®¾ç°åœ¨æˆ‘ä»¬æœ‰ä¸ªå›¾ä¹¦ç½‘ç«™ï¼Œéœ€è¦å®¢æˆ·ç«¯åœ¨è¯·æ±‚å¤´ä¸Šæºå¸¦æœ‰æ•ˆçš„tokenï¼Œæ‰å¯ä»¥è·å–å›¾ä¹¦æ•°æ®ï¼Œé‚£FastAPIè¯¥å¦‚ä½•è·å–å®¢æˆ·ç«¯ä¼ è¿‡æ¥çš„è¯·æ±‚å¤´å‚æ•°å‘¢ï¼Ÿ</p><p>ç¤ºä¾‹1ï¼šFastAPIè·å–ï¼ŒæŒ‡å®šè¯·æ±‚å¤´çš„å€¼ï¼ˆæ¯”å¦‚ï¼Œè¯·æ±‚å¤´çš„key æ˜¯<code>token</code>ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Header <span class="hljs-comment"># å¼•å…¥Headerç±»</span><br><br>app = FastAPI()<br>books = &#123;i: <span class="hljs-string">f&quot;å›¾ä¹¦<span class="hljs-subst">&#123;i&#125;</span>&quot;</span> <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>)&#125;<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/books/&#123;id&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_book_by_id</span>(<span class="hljs-params"><span class="hljs-built_in">id</span>: <span class="hljs-built_in">int</span>, token: <span class="hljs-built_in">str</span> = Header(<span class="hljs-params"></span>)</span>):<span class="hljs-comment"># token=Header() tokenæ˜¯Header çš„å®ä¾‹åŒ–å¯¹è±¡</span><br>    <span class="hljs-keyword">if</span> token == <span class="hljs-string">&quot;this-is-token&quot;</span>:<br>        <span class="hljs-keyword">return</span> books.get(<span class="hljs-built_in">id</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;invalid token&quot;</span><br></code></pre></td></tr></table></figure><blockquote><p>1ã€Headerå’ŒPath() Query()ç±»ä¼¼ï¼Œä¹Ÿå…·æœ‰åŸºæœ¬çš„è¯·æ±‚å¤´å‚æ•°æ ¡éªŒå’ŒAPIæ–‡æ¡£è®¾ç½®</p><p>2ã€å¦‚æœå®šä¹‰çš„å‚æ•°æ˜¯è¯·æ±‚å¤´å‚æ•°ï¼Œåˆ™å¿…é¡»ä½¿ç”¨Header() å¦åˆ™FastAPIé»˜è®¤ä¼šæŠŠè¿™ä¸ªå‚æ•°è¯†åˆ«çš„æŸ¥è¯¢å‚æ•°</p></blockquote><h1 id="3-2-ä½¿ç”¨è¯·æ±‚ä½“æäº¤æ•°æ®ã€é‡ç‚¹ã€‘"><a href="#3-2-ä½¿ç”¨è¯·æ±‚ä½“æäº¤æ•°æ®ã€é‡ç‚¹ã€‘" class="headerlink" title="3-2 ä½¿ç”¨è¯·æ±‚ä½“æäº¤æ•°æ®ã€é‡ç‚¹ã€‘"></a>3-2 ä½¿ç”¨è¯·æ±‚ä½“æäº¤æ•°æ®ã€é‡ç‚¹ã€‘</h1><p>å‘æœåŠ¡å™¨æäº¤æ•°æ®ï¼Œå¯ä»¥é€šè¿‡ä¹‹å‰å’±ä»¬å­¦çš„è·¯å¾„å‚æ•°ã€æŸ¥è¯¢å‚æ•°ã€ä¹Ÿå¯ä»¥åœ¨è¯·æ±‚ä½“ä¸­æºå¸¦æ•°æ®ï¼ˆæ¨èç”¨æ³•ï¼‰</p><p>æ¨èä½¿ç”¨è¯·æ±‚ä½“å‘æœåŠ¡å™¨æäº¤æ•°æ®çš„åŸå› ï¼š</p><ul><li>è·¯å¾„å‚æ•°å’ŒæŸ¥è¯¢å‚æ•°æºå¸¦çš„æ•°æ®é‡æœ‰é™</li><li>è·¯å¾„å‚æ•°å’ŒæŸ¥è¯¢å‚æ•°æºå¸¦æ•°æ®ä¸å®‰å…¨</li></ul><p>é‚£æˆ‘ä»¬è¯¥å¦‚ä½•ä½¿ç”¨è¯·æ±‚ä½“å‘æœåŠ¡ç«¯æäº¤æ•°æ®å‘¢ï¼Ÿä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼šã€äºŒé€‰ä¸€ã€‘</p><ul><li><p>ä½¿ç”¨POSTè¯·æ±‚ï¼Œåœ¨è¯·æ±‚ä½“ä¸­ä½¿ç”¨JSONæ ¼å¼çš„æ•°æ®ï¼›PUT&#x2F;PATCHç­‰ä¹Ÿå¯ä»¥åœ¨è¯·æ±‚ä½“ä¸­ä½¿ç”¨JSONæ ¼å¼æ•°æ®</p></li><li><p>ä½¿ç”¨POSTè¯·æ±‚ï¼Œåœ¨è¯·æ±‚ä½“ä¸­ä½¿ç”¨form-dataæ ¼å¼çš„æ•°æ®ï¼Œæäº¤æ•°æ®ï¼ˆå³å‰ç«¯çš„formè¡¨å•ï¼Œç¬¬6ç« è¯¦ç»†ä»‹ç»ï¼‰</p></li></ul><p>å®ç°æ–¹å¼ï¼š ä½¿ç”¨Pydantic æ¥æ¥æ”¶è¯·æ±‚ä½“æ•°æ®</p><p>ç¬¬ä¸€æ­¥ï¼šç»§æ‰¿Pydanticçš„<code>BaseModel</code>,å®šä¹‰æ¨¡å‹ç±»User,å†ç±»é’Ÿå®šä¹‰ä¸¤ä¸ªå’Œè¯·æ±‚ä½“å­—æ®µåŒåçš„ç±»æ•°å­¦å¹¶åšç±»å‹æç¤º</p><p>ç¬¬äºŒæ­¥ï¼šå†è·¯å¾„å‡½æ•°é’Ÿå®šä¹‰å½¢å‚user ,è®¾ç½®ç±»å‹æœªUser</p><p>ç¬¬ä¸‰æ­¥ï¼šé€šè¿‡å¯¹è±¡<code>user</code>å±æ€§<code>username</code>å’Œ<code>password</code>è·å–è¯·æ±‚ä½“å­—æ®µçš„å€¼</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel <span class="hljs-comment"># å¼•ç”¨åŸºç¡€æ¨¡å‹</span><br>app  = FastAPI()<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    username: <span class="hljs-built_in">str</span><br>    password: <span class="hljs-built_in">str</span><br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/login&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">user: User</span>):<br>    <span class="hljs-keyword">return</span> &#123;<br>        <span class="hljs-string">&quot;username&quot;</span>: user.username,<br>        <span class="hljs-string">&quot;password&quot;</span>: user.password<br>    &#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·å¯ä»¥å¸®æˆ‘ä»¬è·å–åˆ°è¯·æ±‚ä½“å‚æ•°å¹¶èµ‹å€¼åˆ°å‚æ•°<code>user</code>ï¼ŒåŒæ—¶ï¼š</p><ul><li>1ã€æŒ‰ç…§jsonæ ¼å¼æ¥è¯»å–è¯·æ±‚ä½“æ•°æ®</li><li>2ã€æŠŠç±»å‹è½¬æ¢ä¸”è¿›è¡Œç±»å‹æ ¡éªŒï¼ˆç±»å‹å¿…é¡»ç¬¦åˆUseræ ¼å¼ï¼‰</li><li>3ã€æŠŠè¯·æ±‚ä½“ä¸­æ¯ä¸ªå­—æ®µçš„å€¼èµ‹å€¼åˆ°æ¨¡å‹ç±»å¯¹è±¡çš„æ¯ä¸ªå±æ€§ï¼ˆèµ‹å€¼åˆ°Userç±»ï¼ŒåŸºç¡€è‡ªåŸºç¡€æ¨¡å‹ç±»ï¼‰</li><li>4ã€APIæ–‡æ¡£å¯ä»¥çœ‹åˆ°ç±»å‹æç¤º</li></ul><p><strong>ç»“è®º</strong>ï¼š</p><ul><li>å¦‚æœè¯·æ±‚ä½“å‚æ•°æ˜¯JSONæ ¼å¼ï¼Œå°±é€šè¿‡ç»§æ‰¿Pydanticçš„ <code>BaseModel</code> çš„æ–¹å¼æ¥è·å–æ•°æ®</li><li><code>BaseModel</code>çš„å­ç±»ä¸­å®šä¹‰çš„ç±»å±æ€§æ˜¯ç”¨æ¥åŒ¹é…è¯·æ±‚ä½“å¯¹åº”çš„å­—æ®µå€¼ï¼Œæ‰€ä»¥åå­—åŒ…ä¿æŒä¸€è‡´ï¼Œå­—æ®µçš„é¡ºåºæ²¡æœ‰è¦æ±‚</li><li>åªè¦è·¯å¾„å‡½æ•°å¼ä¸­å½¢å‚çš„ç±»å‹æ˜¯<code>BaseModel</code>çš„å­ç±»ï¼Œåˆ™FastAPIä¼šé»˜è®¤ä¼šæŠŠè¯·æ±‚ä½“æ•°æ®ä¿å­˜åœ¨è¿™ä¸ªå˜é‡ä¸­</li><li>å®šä¹‰çš„æ¨¡å‹ç±»çš„å±æ€§ï¼Œå¯ä»¥æœ‰é»˜è®¤å€¼</li></ul><h1 id="3-4-å¤šè¯·æ±‚ä½“-å…¥å‚-ä¸å¸¸ç”¨"><a href="#3-4-å¤šè¯·æ±‚ä½“-å…¥å‚-ä¸å¸¸ç”¨" class="headerlink" title="3-4 å¤šè¯·æ±‚ä½“ å…¥å‚ ä¸å¸¸ç”¨"></a>3-4 å¤šè¯·æ±‚ä½“ å…¥å‚ ä¸å¸¸ç”¨</h1><p>åŸç†æ˜¯ä¸€æ ·çš„ï¼Œå°±æ˜¯å¤šå®šä¹‰ä¸€ä¸ªæ¨¡å‹è€Œå·²ï¼Œä¸å¸¸ç”¨æ‹‰</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    username: <span class="hljs-built_in">str</span><br>    password: <span class="hljs-built_in">str</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Item</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    name: <span class="hljs-built_in">str</span><br>    description: typing.<span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span>  <span class="hljs-comment"># é€‰å¡«ç±»å‹ï¼ŒOptionalå¯é€‰çš„æ„æ€</span><br>    price: <span class="hljs-built_in">float</span><br>    tax: typing.<span class="hljs-type">Optional</span>[<span class="hljs-built_in">float</span>] = <span class="hljs-literal">None</span>  <span class="hljs-comment"># é€‰å¡«ç±»å‹ï¼ŒOptionalå¯é€‰çš„æ„æ€</span><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/login_double&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">post_login_double</span>(<span class="hljs-params">user: User, item: Item</span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;user&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;username&quot;</span>: user.username,<br>            <span class="hljs-string">&quot;password&quot;</span>: user.password,<br>        &#125;,<span class="hljs-string">&quot;item&quot;</span>: &#123;<br>            <span class="hljs-string">&quot;name&quot;</span>: item.name,<br>            <span class="hljs-string">&quot;description&quot;</span>: item.description,<br>            <span class="hljs-string">&quot;price&quot;</span>: item.price,<br>            <span class="hljs-string">&quot;tax&quot;</span>: item.tax,&#125;&#125;<br></code></pre></td></tr></table></figure><h1 id="3-5-ä½¿ç”¨Bodyæ¥æ”¶è¯·æ±‚ä½“æ•°æ®"><a href="#3-5-ä½¿ç”¨Bodyæ¥æ”¶è¯·æ±‚ä½“æ•°æ®" class="headerlink" title="3-5 ä½¿ç”¨Bodyæ¥æ”¶è¯·æ±‚ä½“æ•°æ®"></a>3-5 ä½¿ç”¨Bodyæ¥æ”¶è¯·æ±‚ä½“æ•°æ®</h1><p>å½“ä½ éœ€è¦å’Œå…¶ä»–å…¥å‚ä¸€èµ·å‘å‡ºè¯·æ±‚çš„æ—¶å€™ï¼Œæ¯”å¦‚è¯´</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python">&#123;<br>    <span class="hljs-string">&quot;item&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Foo&quot;</span>,<br>        <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;The pretender&quot;</span>,<br>        <span class="hljs-string">&quot;price&quot;</span>: <span class="hljs-number">42.0</span>,<br>        <span class="hljs-string">&quot;tax&quot;</span>: <span class="hljs-number">3.2</span><br>    &#125;,<br>    <span class="hljs-string">&quot;user&quot;</span>: &#123;<br>        <span class="hljs-string">&quot;username&quot;</span>: <span class="hljs-string">&quot;liuxu&quot;</span>,<br>        <span class="hljs-string">&quot;password&quot;</span>: <span class="hljs-string">&quot;liuxu&quot;</span><br>    &#125;,<br>    <span class="hljs-string">&quot;importance&quot;</span>: <span class="hljs-number">5</span><br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä¸¤ç§æƒ…å†µï¼Œç›´æ¥ä½¿ç”¨ç»§æ‰¿Pydanticçš„BaseModelå®šä¹‰æ¨¡å‹ç±»çš„æ–¹å¼è¡Œä¸é€šï¼Œéœ€è¦å€ŸåŠ©<code>Body()</code>å‡½æ•°æ¥å¸®å¿™</p><p>ç¤ºä¾‹1ï¼šä½¿ç”¨Body()è·å–è¯·æ±‚ä½“ä¸­å•ä¸€å­—æ®µå˜é‡ï¼Œæ¯”å¦‚éœ€æ±‚1ä¸­çš„ <code>&quot;importance&quot;: 5</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    username: <span class="hljs-built_in">int</span><br>    password: <span class="hljs-built_in">str</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Item</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    name: <span class="hljs-built_in">str</span><br>    description: typing.<span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span><br>    price: <span class="hljs-built_in">float</span><br>    tax: typing.<span class="hljs-type">Optional</span>[<span class="hljs-built_in">float</span>] = <span class="hljs-literal">None</span><br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/login&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">user: User, item: Item, importance: <span class="hljs-built_in">int</span> = Body(<span class="hljs-params"></span>)</span>):<span class="hljs-comment"># å®šä¹‰å’Œè¯·æ±‚ä½“å­—æ®µåŒåçš„å½¢å‚å¹¶ä½¿ç”¨Body()</span><br>    <span class="hljs-keyword">return</span> importance<br></code></pre></td></tr></table></figure><blockquote><p>1ã€ Body()å‡½æ•°çš„å®¤å‹å’Œå‰é¢çš„Path() Query(),Header()åŸºæœ¬ä¸€è‡´</p><p>2ã€å¦‚æœä½ ä»…ä»…éœ€è¦ä»è¯·æ±‚ä½“ä¸­è·å–importanceï¼Œå…¶ä»–å­—æ®µä¸éœ€è¦ï¼Œå¯ç›´æ¥ï¼š<code>def login(importance: int = Body()):</code></p></blockquote><h1 id="3-6-è¯·æ±‚ä½“ä½¿ç”¨Bodyæ ¡éªŒ"><a href="#3-6-è¯·æ±‚ä½“ä½¿ç”¨Bodyæ ¡éªŒ" class="headerlink" title="3.6 è¯·æ±‚ä½“ä½¿ç”¨Bodyæ ¡éªŒ"></a>3.6 è¯·æ±‚ä½“ä½¿ç”¨Bodyæ ¡éªŒ</h1><ul><li><p>Bodyå’Œå‰é¢æ¥æ”¶çš„ Pathã€Queryã€Headerä¸€æ ·ï¼Œéƒ½å¯ä»¥åšæ•°å€¼æ ¡éªŒå’Œå­—ç¬¦ä¸²çš„åŸºæœ¬æ ¡éªŒ</p></li><li><p>åªä¸è¿‡Bodyæ ¡éªŒçš„æ˜¯è¯·æ±‚ä½“ä¸­çš„<strong>å•ä¸€æ•°æ®</strong>ï¼Œæ¯”å¦‚è¯·æ±‚ä½“ä¸­åªæœ‰ä¸€ä¸ªæ•°å­—æˆ–è€…ä¸€ä¸ªå­—ç¬¦ä¸²æ‰å¯ä»¥</p></li><li><p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥è®¾ç½®è¯·æ±‚ä½“çš„ç±»å‹ï¼Œé»˜è®¤æ˜¯<code>application/json</code>ï¼Œå³JSONæ ¼å¼</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Body<br><br>app = FastAPI()<br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/login&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">name: <span class="hljs-built_in">str</span> = Body(<span class="hljs-params">min_length=<span class="hljs-number">3</span></span>), age: <span class="hljs-built_in">int</span> = Body(<span class="hljs-params">ge=<span class="hljs-number">18</span></span>)</span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;name&quot;</span>: name, <span class="hljs-string">&quot;age&quot;</span>: age&#125;<br></code></pre></td></tr></table></figure><h1 id="3-7-æ¨¡å‹ç±»åµŒå¥—"><a href="#3-7-æ¨¡å‹ç±»åµŒå¥—" class="headerlink" title="3.7 æ¨¡å‹ç±»åµŒå¥—"></a>3.7 æ¨¡å‹ç±»åµŒå¥—</h1><p>å®¢æˆ·ç«¯ä¼ è¿‡æ¥çš„è¯·æ±‚ä½“æ•°æ®ç»“æ„æ˜¯å¤æ‚çš„åµŒå¥—ç»“æ„ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ç§ï¼Œæ­¤æ—¶åç«¯è¯¥å¦‚ä½•æ¥æ”¶æ•°æ®å‘¢ï¼Ÿ</p><p>éœ€æ±‚3ï¼šåµŒå¥—åˆ—è¡¨ä¸­çš„æ¨¡å‹ç±»</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Foo&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;description&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;The pretender&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;price&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">42.0</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;tax&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3.2</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;images&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://example.com/baz.jpg&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;The Foo live&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;url&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;http://example.com/dave.jpg&quot;</span><span class="hljs-punctuation">,</span><br>            <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;The Baz&quot;</span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹3ï¼šè§£å†³ åµŒå¥—åˆ—è¡¨ä¸­çš„æ¨¡å‹ç±»</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">List</span>, <span class="hljs-type">Optional</span><br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel<br><br>app = FastAPI()<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Image</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    url: <span class="hljs-built_in">str</span><br>    name: <span class="hljs-built_in">str</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Item</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    name: <span class="hljs-built_in">str</span><br>    price: <span class="hljs-built_in">float</span><br>    images: <span class="hljs-type">Optional</span>[<span class="hljs-type">List</span>[Image]] = <span class="hljs-literal">None</span><br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/item&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_item</span>(<span class="hljs-params">item: Item</span>):<br>    <span class="hljs-keyword">return</span> item<br></code></pre></td></tr></table></figure><h1 id="3-8-è¯·æ±‚ä½“å­—æ®µä½¿ç”¨Filedæ ¡éªŒ"><a href="#3-8-è¯·æ±‚ä½“å­—æ®µä½¿ç”¨Filedæ ¡éªŒ" class="headerlink" title="3.8 è¯·æ±‚ä½“å­—æ®µä½¿ç”¨Filedæ ¡éªŒ"></a>3.8 è¯·æ±‚ä½“å­—æ®µä½¿ç”¨Filedæ ¡éªŒ</h1><p>è¯·æ±‚ä½“çš„æ¯ä¸ªå­—æ®µå¯ä»¥å•ç‹¬åšæ ¡éªŒå—ï¼Œæ¯”å¦‚ï¼š</p><ul><li><code>name</code>çš„é•¿åº¦æœ€å°‘æ˜¯3ï¼Œ</li><li><code>price</code>ä¸å°‘äº10</li><li>&#96;tagså­—æ®µé™åˆ¶å…ƒç´ ä¸é‡å¤ï¼Œé™åˆ¶å…ƒç´ çš„ä¸ªæ•°ç­‰ç­‰</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Foo&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;description&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;The pretender&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;price&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">42.0</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;tax&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3.2</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;tags&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">&quot;rock&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;metal&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-string">&quot;bar&quot;</span><span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹1ï¼šä½¿ç”¨ <code>Field</code>æ¥æ ¡éªŒæ¯ä¸ªè¯·æ±‚ä½“å­—æ®µï¼Œæ³¨æ„ï¼Œ<code>Field</code>ä¸æ˜¯ä»FastAPIå¯¼å…¥çš„ï¼Œè€Œæ˜¯ç›´æ¥ä»Pydanticå¯¼å…¥çš„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Optional</span>, <span class="hljs-type">List</span><br><br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel, Field<br><br>app = FastAPI()<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Item</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    name: <span class="hljs-built_in">str</span> = Field(min_length=<span class="hljs-number">5</span>)<br>    description: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = Field(default=<span class="hljs-literal">None</span>, max_length=<span class="hljs-number">300</span>)<br>    price: <span class="hljs-built_in">float</span> = Field(gt=<span class="hljs-number">0</span>, multiple_of=<span class="hljs-number">2</span>)<br>    tax: <span class="hljs-type">List</span>[<span class="hljs-built_in">str</span>] = Field(min_items=<span class="hljs-number">2</span>, max_items=<span class="hljs-number">5</span>, unique_items=<span class="hljs-literal">True</span>)<br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/item&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_item</span>(<span class="hljs-params">item: Item</span>):<br>    <span class="hljs-keyword">return</span> item<br><br></code></pre></td></tr></table></figure><p>æ ¡éªŒå‚æ•°æ€»ç»“ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">gt/ge/lt/le:<span class="hljs-comment"># æ•°å€¼å¤§å°æ ¡éªŒ(float)</span><br>min_length/max_length    <span class="hljs-comment"># å­—ç¬¦ä¸²é•¿åº¦æ ¡éªŒ(int)</span><br>min_items/max_items<span class="hljs-comment"># é›†åˆå…ƒç´ æ•°é‡æ ¡éªŒï¼ˆintï¼‰</span><br>unique_items<span class="hljs-comment"># é›†åˆå…ƒç´ æ˜¯å¦å¯ä»¥é‡å¤(å¸ƒå°”å€¼)</span><br>multiple_of<span class="hljs-comment"># é™åˆ¶å€¼çš„æŸä¸ªæ•°å­—çš„å€æ•°ï¼ˆfloatï¼‰</span><br><br>max_digits<span class="hljs-comment"># æœ€é•¿å¤šå°‘ä½æ•°å­—ã€bugã€‘</span><br>decimal_places<span class="hljs-comment">#ã€€æœ€å¤šå‡ ä½å°æ•°ã€bugã€‘</span><br></code></pre></td></tr></table></figure><h1 id="3-9-æ€»ç»“è·å–è¯·æ±‚ä½“æ•°æ®çš„3ç§æ–¹å¼"><a href="#3-9-æ€»ç»“è·å–è¯·æ±‚ä½“æ•°æ®çš„3ç§æ–¹å¼" class="headerlink" title="3.9 æ€»ç»“è·å–è¯·æ±‚ä½“æ•°æ®çš„3ç§æ–¹å¼"></a>3.9 æ€»ç»“è·å–è¯·æ±‚ä½“æ•°æ®çš„3ç§æ–¹å¼</h1><p><strong>ä½¿ç”¨Pydantic</strong>ã€ä¸»è¦ã€‘</p><ul><li>å®šä¹‰æ¨¡å‹ç±»BaseModleï¼Œå’Œè¯·æ±‚ä½“ä¸­çš„å­—æ®µä¿æŒä¸€è‡´ï¼Œå®šä¹‰æ¨¡å‹ç±»çš„å±æ€§å¹¶åš<strong>ç±»å‹æç¤º</strong>ï¼ˆæ”¯æŒç±»å‹æ ¡éªŒå’Œç±»å‹è½¬æ¢ï¼‰</li></ul><p><strong>ä½¿ç”¨Body()</strong></p><ul><li>æœ‰ä¸ªç‰¹æ®Šçš„è¯·æ±‚ä½“æ ¼å¼ï¼Œä½¿ç”¨Body()æ˜¾ç¤ºè·å–ï¼Œæ¯”å¦‚ï¼Œå•ä¸€å­—æ®µçš„å€¼ï¼Œå†…åµŒå­—æ®µçš„å€¼</li><li>å¯ä»¥ä¸å…¶ä»–å‚æ•°ä¸€èµ·ä½¿ç”¨ï¼š<code>Body()</code> å‡½æ•°å¯ä»¥ä¸å…¶ä»–å‚æ•°ï¼ˆå¦‚è·¯å¾„å‚æ•°ã€æŸ¥è¯¢å‚æ•°ç­‰ï¼‰ä¸€èµ·ä½¿ç”¨ï¼Œä»¥ä¾¿æ›´çµæ´»åœ°å®šä¹‰è¯·æ±‚å¤„ç†å‡½æ•°çš„å‚æ•°ã€‚</li><li>æ”¯æŒæ›´å¤šçš„å‚æ•°é…ç½®ï¼š<code>Body()</code> å‡½æ•°æ”¯æŒä¼ é€’æ›´å¤šå‚æ•°é…ç½®ï¼Œå¦‚æ•°æ®ç±»å‹ã€é»˜è®¤å€¼ç­‰ã€‚</li></ul><p><strong>ä½¿ç”¨Pythonçš„å­—å…¸ç±»å‹å’Œåˆ—è¡¨ç±»å‹</strong></p><ul><li>å®šä¹‰åœ¨è·¯å¾„å‡½æ•°å†…çš„ç‰¹æ®Šå­—æ®µä¼šé»˜è®¤è¢«è§†ä¸ºè¯·æ±‚ä½“å‚æ•°ï¼Œæ¯”å¦‚åˆ—è¡¨ï¼Œé›†åˆï¼Œå…ƒç¥–ï¼Œå­—å…¸ï¼ˆå®¹å™¨å‹æ•°æ®ï¼‰</li></ul><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/item&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_item</span>(<span class="hljs-params">item: typing.<span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">str</span>]</span>): <span class="hljs-comment"># ç›´æ¥åœ¨è·¯å¾„ä¸Š</span><br>    <span class="hljs-keyword">return</span> item<br></code></pre></td></tr></table></figure><ul><li>ä¹Ÿå¯ä»¥é€šè¿‡@dataclasses.dataclassç±»è£…é¥°å™¨è½¬è£…é¥°æˆæ•°æ®ç±»</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@dataclasses.dataclass</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>:<br>    username: <span class="hljs-built_in">str</span><br>    password: <span class="hljs-built_in">str</span><br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/item&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_item</span>(<span class="hljs-params">user: User</span>):<br>    <span class="hljs-keyword">return</span> user<br></code></pre></td></tr></table></figure><h1 id="3-10-ç»™è¯·æ±‚ä½“æä¾›èŒƒä¾‹"><a href="#3-10-ç»™è¯·æ±‚ä½“æä¾›èŒƒä¾‹" class="headerlink" title="3.10 ç»™è¯·æ±‚ä½“æä¾›èŒƒä¾‹"></a>3.10 ç»™è¯·æ±‚ä½“æä¾›èŒƒä¾‹</h1><p>æä¾›èŒƒä¾‹åï¼Œå†é˜…è¯»APIæ–‡æ¡£çš„æ—¶å€™æ›´æ–¹ä¾¿</p><p>FastAPIæä¾›äº†å¤šç§ä¸ºè¯·æ±‚ä½“æä¾›èŒƒä¾‹çš„æ–¹å¼</p><p>ç¤ºä¾‹1ï¼šåœ¨æ¨¡å‹ç±»ä¸­å®šä¹‰ <code>Config</code>ç±»</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Union</span><br><br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel<br><br>app = FastAPI()<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Item</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    name: <span class="hljs-built_in">str</span><br>    description: <span class="hljs-type">Union</span>[<span class="hljs-built_in">str</span>, <span class="hljs-literal">None</span>] = <span class="hljs-literal">None</span><br>    price: <span class="hljs-built_in">float</span><br>    tax: <span class="hljs-type">Union</span>[<span class="hljs-built_in">float</span>, <span class="hljs-literal">None</span>] = <span class="hljs-literal">None</span><br><br>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">Config</span>:<br>        schema_extra = &#123;<br>            <span class="hljs-string">&quot;example&quot;</span>: &#123;<br>                <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Foo&quot;</span>,<br>                <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;A very nice Item&quot;</span>,<br>                <span class="hljs-string">&quot;price&quot;</span>: <span class="hljs-number">35.4</span>,<br>                <span class="hljs-string">&quot;tax&quot;</span>: <span class="hljs-number">3.2</span>,<br>            &#125;<br>        &#125;<br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/item&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_item</span>(<span class="hljs-params">item: Item</span>):<br>    <span class="hljs-keyword">return</span> item<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹2ï¼šä½¿ç”¨ <code>Field(example=&quot;xxx&quot;)</code>ä¸ºæ¯ä¸ªå­—æ®µæä¾›ä¾‹å­</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Union</span><br><br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel, Field<br><br>app = FastAPI()<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Item</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    name: <span class="hljs-built_in">str</span> = Field(example=<span class="hljs-string">&quot;Foo&quot;</span>)<br>    description: <span class="hljs-type">Union</span>[<span class="hljs-built_in">str</span>, <span class="hljs-literal">None</span>] = Field(default=<span class="hljs-literal">None</span>, example=<span class="hljs-string">&quot;A very nice Item&quot;</span>)<br>    price: <span class="hljs-built_in">float</span> = Field(example=<span class="hljs-number">35.4</span>)<br>    tax: <span class="hljs-type">Union</span>[<span class="hljs-built_in">float</span>, <span class="hljs-literal">None</span>] = Field(default=<span class="hljs-literal">None</span>, example=<span class="hljs-number">3.2</span>)<br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/item&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_item</span>(<span class="hljs-params">item: Item</span>):<br>    <span class="hljs-keyword">return</span> item<br><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹3ï¼šä½¿ç”¨ <code>Body(example=&quot;ä¸€ä¸ªä¾‹å­&quot;, examples=&quot;å¤šç»„ä¾‹å­&quot;)</code>ï¼Œè¿™ç§æ–¹å¼ä¹Ÿé€‚ç”¨ï¼š<code>Path\Query\Header</code>ç­‰ç­‰ ã€ä¸å¸¸ç”¨ã€‘</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Union</span><br><br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> Body, FastAPI<br><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel<br><br>app = FastAPI()<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Item</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    name: <span class="hljs-built_in">str</span><br>    description: <span class="hljs-type">Union</span>[<span class="hljs-built_in">str</span>, <span class="hljs-literal">None</span>] = <span class="hljs-literal">None</span><br>    price: <span class="hljs-built_in">float</span><br>    tax: <span class="hljs-type">Union</span>[<span class="hljs-built_in">float</span>, <span class="hljs-literal">None</span>] = <span class="hljs-literal">None</span><br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/item&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_item</span>(<span class="hljs-params"></span><br><span class="hljs-params">    *,</span><br><span class="hljs-params">    item: Item = Body(<span class="hljs-params"></span></span><br><span class="hljs-params"><span class="hljs-params">        examples=&#123;</span></span><br><span class="hljs-params"><span class="hljs-params">            <span class="hljs-string">&quot;normal&quot;</span>: &#123;</span></span><br><span class="hljs-params"><span class="hljs-params">                <span class="hljs-string">&quot;summary&quot;</span>: <span class="hljs-string">&quot;A normal example&quot;</span>,</span></span><br><span class="hljs-params"><span class="hljs-params">                <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;A **normal** item works correctly.&quot;</span>,</span></span><br><span class="hljs-params"><span class="hljs-params">                <span class="hljs-string">&quot;value&quot;</span>: &#123;</span></span><br><span class="hljs-params"><span class="hljs-params">                    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Foo&quot;</span>,</span></span><br><span class="hljs-params"><span class="hljs-params">                    <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;A very nice Item&quot;</span>,</span></span><br><span class="hljs-params"><span class="hljs-params">                    <span class="hljs-string">&quot;price&quot;</span>: <span class="hljs-number">35.4</span>,</span></span><br><span class="hljs-params"><span class="hljs-params">                    <span class="hljs-string">&quot;tax&quot;</span>: <span class="hljs-number">3.2</span>,</span></span><br><span class="hljs-params"><span class="hljs-params">                &#125;,</span></span><br><span class="hljs-params"><span class="hljs-params">            &#125;,</span></span><br><span class="hljs-params"><span class="hljs-params">            <span class="hljs-string">&quot;converted&quot;</span>: &#123;</span></span><br><span class="hljs-params"><span class="hljs-params">                <span class="hljs-string">&quot;summary&quot;</span>: <span class="hljs-string">&quot;An example with converted data&quot;</span>,</span></span><br><span class="hljs-params"><span class="hljs-params">                <span class="hljs-string">&quot;description&quot;</span>: <span class="hljs-string">&quot;FastAPI can convert price `strings` to actual `numbers` automatically&quot;</span>,</span></span><br><span class="hljs-params"><span class="hljs-params">                <span class="hljs-string">&quot;value&quot;</span>: &#123;</span></span><br><span class="hljs-params"><span class="hljs-params">                    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Bar&quot;</span>,</span></span><br><span class="hljs-params"><span class="hljs-params">                    <span class="hljs-string">&quot;price&quot;</span>: <span class="hljs-string">&quot;35.4&quot;</span>,</span></span><br><span class="hljs-params"><span class="hljs-params">                &#125;,</span></span><br><span class="hljs-params"><span class="hljs-params">            &#125;,</span></span><br><span class="hljs-params"><span class="hljs-params">            <span class="hljs-string">&quot;invalid&quot;</span>: &#123;</span></span><br><span class="hljs-params"><span class="hljs-params">                <span class="hljs-string">&quot;summary&quot;</span>: <span class="hljs-string">&quot;Invalid data is rejected with an error&quot;</span>,</span></span><br><span class="hljs-params"><span class="hljs-params">                <span class="hljs-string">&quot;value&quot;</span>: &#123;</span></span><br><span class="hljs-params"><span class="hljs-params">                    <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;Baz&quot;</span>,</span></span><br><span class="hljs-params"><span class="hljs-params">                    <span class="hljs-string">&quot;price&quot;</span>: <span class="hljs-string">&quot;thirty five point four&quot;</span>,</span></span><br><span class="hljs-params"><span class="hljs-params">                &#125;,</span></span><br><span class="hljs-params"><span class="hljs-params">            &#125;,</span></span><br><span class="hljs-params"><span class="hljs-params">        &#125;,</span></span><br><span class="hljs-params"><span class="hljs-params">    </span>),</span><br><span class="hljs-params"></span>):<br>    <span class="hljs-keyword">return</span> item<br></code></pre></td></tr></table></figure><h1 id="æœ¬ç« å­¦ä¹ æ€»ç»“ï¼Œ"><a href="#æœ¬ç« å­¦ä¹ æ€»ç»“ï¼Œ" class="headerlink" title="æœ¬ç« å­¦ä¹ æ€»ç»“ï¼Œ"></a>æœ¬ç« å­¦ä¹ æ€»ç»“ï¼Œ</h1><ul><li><p>ä¸»è¦æ˜¯åœ¨ä¸å¯¹è¯·æ±‚å¤´Header()å’Œè¯·æ±‚ä½“Body()çš„å®šä¹‰</p></li><li><p>è¿™é‡Œçš„<code>Header</code>çš„å®šä¹‰åªæ˜¯ä¸€ä¸ªç®€å•çš„å®šä¹‰ï¼Œè¿˜æ²¡æœ‰æ³¨å…¥ä¾èµ–é¡¹ï¼ˆtokenä»¤ç‰Œç­‰ï¼‰</p></li><li><p>è¯·æ±‚ä½“çš„è¯ä¸»è¦ä½¿ç”¨<code>Pydantic</code>æ¨¡å‹ç±»BoseModelå®šä¹‰,åœ¨è·¯å¾„å‡½æ•°ä¸Šåšç±»å‹æç¤ºæ›´æ–¹ä¾¿</p></li></ul><h1 id="4-1-è®¾ç½®å“åº”çŠ¶æ€ç "><a href="#4-1-è®¾ç½®å“åº”çŠ¶æ€ç " class="headerlink" title="4-1 è®¾ç½®å“åº”çŠ¶æ€ç "></a>4-1 è®¾ç½®å“åº”çŠ¶æ€ç </h1><p>ç¤ºä¾‹1ï¼š<strong>ç›´æ¥ç»™status_codeå­—æ®µä¸€ä¸ªçŠ¶æ€ç </strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/login&quot;</span>, status_code=<span class="hljs-number">200</span></span>)</span><span class="hljs-comment"># ç›´æ¥æŒ‡å®šä¸€ä¸ªå“åº”ç </span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">user: User</span>):<br>    <span class="hljs-keyword">return</span> &#123;<br>        <span class="hljs-string">&quot;username&quot;</span>: user.username,<br>        <span class="hljs-string">&quot;password&quot;</span>: user.password<br>    &#125;<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹3ï¼š<strong>status_codeä½¿ç”¨å¸¸é‡</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Path, Header,status<br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/login&quot;</span>, status_code=status.HTTP_200_OK</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>():<br>    <span class="hljs-keyword">pass</span><br></code></pre></td></tr></table></figure><h1 id="4-2-è®¾ç½®å“åº”å¤´"><a href="#4-2-è®¾ç½®å“åº”å¤´" class="headerlink" title="4-2 è®¾ç½®å“åº”å¤´"></a>4-2 è®¾ç½®å“åº”å¤´</h1><p>æœ‰çš„æ—¶å€™ï¼Œåœ¨å“åº”å®¢æˆ·ç«¯è¯·æ±‚çš„æ—¶å€™ï¼Œéœ€è¦åœ¨å“åº”å¤´ä¸­ç»™å®¢æˆ·ç«¯è¿”å›ä¸€äº›æ•°æ®ï¼Œæ­¤æ—¶è¯¥å¦‚ä½•è®¾ç½®å“åº”å¤´å‘¢ï¼Ÿ</p><p>ç¤ºä¾‹1ï¼šåœ¨è·¯å¾„å‡½æ•°ä¸­ä½¿ç”¨ <code>Response</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Response<br><br>app = FastAPI()<br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/login&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">response: Response</span>):<br>    response.headers[<span class="hljs-string">&quot;x-jwt-token&quot;</span>] = <span class="hljs-string">&quot;this_is_jwt_token&quot;</span><br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Hello World&quot;</span>&#125;<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹2ï¼šç›´æ¥ä½¿ç”¨è¿”å›ä¸€ä¸ª<code>Response</code>ï¼Œæ¯”å¦‚ä½¿ç”¨FastAPIçš„é»˜è®¤å“åº”æ–¹å¼JSONResponse</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><span class="hljs-keyword">from</span> fastapi.responses <span class="hljs-keyword">import</span> JSONResponse<br><br>app = FastAPI()<br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/login&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>():<br>    response = JSONResponse(<br>        content=&#123;<span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Hello World&quot;</span>&#125;,<br>        headers=&#123;<span class="hljs-string">&quot;x-jwt-token&quot;</span>: <span class="hljs-string">&quot;this_is_jwt_token&quot;</span>&#125;,<br>    )<br>    <span class="hljs-keyword">return</span> response<br></code></pre></td></tr></table></figure><p>æ‰©å±•ï¼šä½¿ç”¨è¿”å›Responseçš„æ–¹å¼ï¼Œä¹Ÿå¯ä»¥è®¾ç½®å“åº”çŠ¶æ€ç ï¼Œæ‰‹åŠ¨è®¾ç½®å“åº”ä½“ï¼Œæ“ä½œcookieç­‰ç­‰</p><h1 id="4-3-å“åº”ä½“æ•°æ®"><a href="#4-3-å“åº”ä½“æ•°æ®" class="headerlink" title="4-3 å“åº”ä½“æ•°æ®"></a>4-3 å“åº”ä½“æ•°æ®</h1><p>FastAPIå“åº”æ•°æ®æ—¶ï¼Œé»˜è®¤å“åº”æ˜¯jsonçš„æ ¼å¼ï¼Œå…·ä½“ä½¿ç”¨çš„å“åº”ç±»æ˜¯ <code>JSONResponse</code></p><p>ä¸¾ä¸¤ä¸ªå“åº”ç¤ºä¾‹ï¼šä¸€ä¸ª<code>Pydantic</code>æ¨¡å‹ç±»ï¼Œä¸€ä¸ª<code>Response</code>å¯¹è±¡æˆ– <code>Response</code>çš„å­ç±»</p><p>ç¤ºä¾‹3ï¼šå“åº” åŸºäºPydanticçš„æ¨¡å‹ç±»</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel<br><span class="hljs-keyword">from</span> fastapi.responses <span class="hljs-keyword">import</span> JSONResponse<br><br>app = FastAPI(default_response_class=JSONResponse) <span class="hljs-comment"># é»˜è®¤å“åº”ç±»JSONResponse</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    username: <span class="hljs-built_in">str</span><br>    password: <span class="hljs-built_in">str</span><br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/login&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">user: User</span>):<br>    <span class="hljs-keyword">return</span> user<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹4ï¼šç›´æ¥å“åº”ä¸€ä¸ª <code>Response</code>å¯¹è±¡æˆ– <code>Response</code>çš„å­ç±»</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Response<br><span class="hljs-keyword">import</span> json<br><br>app = FastAPI()<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/books&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_books</span>():<br>    response = Response(<br>        content=json.dumps([&#123;<span class="hljs-string">&quot;id&quot;</span>: i, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">f&quot;å›¾ä¹¦<span class="hljs-subst">&#123;i&#125;</span>&quot;</span>&#125; <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">11</span>)]),<br>        media_type=<span class="hljs-string">&quot;application/json&quot;</span><br>    )<br>    <span class="hljs-keyword">return</span> response<br></code></pre></td></tr></table></figure><h1 id="4-4-ä½¿ç”¨å“åº”æ¨¡å‹response-model"><a href="#4-4-ä½¿ç”¨å“åº”æ¨¡å‹response-model" class="headerlink" title="4-4 ä½¿ç”¨å“åº”æ¨¡å‹response_model"></a>4-4 ä½¿ç”¨å“åº”æ¨¡å‹response_model</h1><p><strong>éœ€æ±‚åœºæ™¯</strong></p><ul><li>éœ€æ±‚1ï¼šç”¨æˆ·æ³¨å†Œæ¥å£ï¼ˆéœ€è¦ç”¨æˆ·åå’Œå¯†ç ï¼‰ï¼Œåç«¯å®Œæˆæ³¨å†Œåä¸€èˆ¬ä¼šå°†ç”¨æˆ·ä¿¡æ¯è¿”å›ï¼Œä½†æ­¤æ—¶ä¸èƒ½è¿”å›ç”¨æˆ·å¯†ç ï¼Œè¯¥å¦‚ä½•æ“ä½œï¼Ÿ</li><li>éœ€æ±‚2ï¼šæƒ³è®©æ¥å£è¿”å›çš„å­—æ®µæŒ‰ç…§ä¸€å®šçš„è§„èŒƒæ¥ï¼Œæœ‰æ•°æ®æ ¼å¼æ ¡éªŒå’Œè½¬æ¢ç­‰åŠŸèƒ½ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿ</li><li>éœ€æ±‚3ï¼šAPIæ–‡æ¡£å±•ç¤ºå“åº”å­—æ®µå’Œç±»å‹</li></ul><p>FastAPIæä¾›äº†<strong>å“åº”æ¨¡å‹</strong>ï¼ˆ<code>response_model</code>ï¼‰çš„æ¦‚å¿µï¼Œå°±åƒå®šä¹‰æ¨¡å‹ç±»ç”¨æ¥æ¥æ”¶è¯·æ±‚ä½“æ•°æ®ï¼Œå“åº”æ¨¡å‹ç”¨æ¥å¤„ç†å“åº”æ•°æ®ã€‚</p><p>åˆ©ç”¨å“åº”æ¨¡å‹ï¼Œå¯ä»¥å®ç°è¿”å›å­—æ®µçš„åŠ¨æ€è¿‡æ»¤ï¼Œç±»å‹æ ¡éªŒå’Œç±»å‹è½¬æ¢ç­‰ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    username: <span class="hljs-built_in">str</span><br>    password: <span class="hljs-built_in">str</span><br>    email: <span class="hljs-built_in">str</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">UserOut</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    username: <span class="hljs-built_in">str</span><br>    email: <span class="hljs-built_in">str</span><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/registe&quot;</span>, response_model=UserOut</span>)</span><span class="hljs-comment"># æŒ‡å®šäº†å“åº”æ¨¡å‹æ˜¯UserOutï¼Œåˆ™åªè¿”å›usernameå’Œemailä¸¤ä¸ªå­—æ®µ è¿‡æ»¤æ‰äº†</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">registe</span>(<span class="hljs-params">user: User</span>):<br>    <span class="hljs-keyword">return</span> user<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹3ï¼šä½¿ç”¨response_modelåšç±»å‹æ ¡éªŒå’Œç±»å‹è½¬æ¢</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> typing<br><br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><br>app = FastAPI()<br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/demo&quot;</span>, response_model=typing.<span class="hljs-type">Dict</span>[<span class="hljs-built_in">str</span>, <span class="hljs-built_in">int</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">demo</span>():<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;code&quot;</span>: <span class="hljs-number">200</span>, <span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-string">&quot;100&quot;</span>&#125;<span class="hljs-comment"># åƒä¸€ä¸ªæ•°æ®çš„å€¼ï¼Œä¼šè‡ªåŠ¨è½¬æ¢ä¸ºIntç±»å‹ è¿™é‡Œå°±åšäº†å¼ºåˆ¶çš„ç±»å‹è½¬æ¢</span><br></code></pre></td></tr></table></figure><h1 id="4-5-ç”¨äºè¿‡æ»¤å“åº”æ•°æ®çš„äº”ä¸ªå‚æ•°"><a href="#4-5-ç”¨äºè¿‡æ»¤å“åº”æ•°æ®çš„äº”ä¸ªå‚æ•°" class="headerlink" title="4-5 ç”¨äºè¿‡æ»¤å“åº”æ•°æ®çš„äº”ä¸ªå‚æ•°"></a>4-5 ç”¨äºè¿‡æ»¤å“åº”æ•°æ®çš„äº”ä¸ªå‚æ•°</h1><p>å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å“åº”æ¨¡å‹ä¸­çš„æŸäº›å­—æ®µåšä¸€ä¸ªè¿‡æ»¤æ“ä½œï¼Œæ¯”å¦‚ï¼Œ</p><ul><li>æ²¡æœ‰èµ‹å€¼çš„å­—æ®µè¿‡æ»¤æ‰</li><li>ä½¿ç”¨é»˜è®¤å€¼çš„å­—æ®µè¿‡æ»¤æ‰</li><li>æŒ‡å®šæŸäº›å­—æ®µè¿‡æ»¤æ‰</li><li>ä¿ç•™æŒ‡å®šçš„å­—æ®µç­‰ç­‰</li></ul><p>FastAPIæä¾›äº†5ä¸ªé…åˆå“åº”æ¨¡å‹ä¸€å—ä½¿ç”¨çš„å­—æ®µï¼š</p><ul><li>response_model_includeï¼Œåªå±•ç¤ºé€‰ä¸­çš„å­—æ®µ</li><li>response_model_excludeï¼Œé€‰ä¸­çš„å­—æ®µä¸å±•ç¤º</li><li>response_model_exclude_unsetï¼Œè¿‡æ»¤æ‰æ²¡æœ‰èµ‹å€¼çš„å­—æ®µ</li><li>response_model_exclude_defaultsï¼Œè¿‡æ»¤æ‰ä½¿ç”¨é»˜è®¤å€¼çš„å­—æ®µ</li><li>response_model_exclude_noneï¼Œæ’åºæ²¡æœ‰å€¼çš„å­—æ®µ</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"></span></span><br><span class="hljs-params"><span class="hljs-meta">    <span class="hljs-string">&quot;/items/&#123;name&#125;&quot;</span>,</span></span><br><span class="hljs-params"><span class="hljs-meta">    response_model=Item,</span></span><br><span class="hljs-params"><span class="hljs-meta">    response_model_include=&#123;<span class="hljs-string">&quot;name&quot;</span>&#125;, <span class="hljs-comment"># åªå±•ç¤ºé€‰ä¸­çš„</span></span></span><br><span class="hljs-params"><span class="hljs-meta">    response_model_exclude=&#123;<span class="hljs-string">&quot;tax&quot;</span>&#125;, <span class="hljs-comment"># é€‰ä¸­çš„ä¸å±•ç¤ºçš„</span></span></span><br><span class="hljs-params"><span class="hljs-meta">    response_model_exclude_unset=<span class="hljs-literal">True</span>, <span class="hljs-comment"># è¿‡æ»¤ï¼Œè¿‡æ»¤æ‰æ²¡æœ‰èµ‹å€¼çš„å­—æ®µ</span></span></span><br><span class="hljs-params"><span class="hljs-meta">    response_model_exclude_defaults=<span class="hljs-literal">True</span>, <span class="hljs-comment"># è¿‡æ»¤ï¼Œè¿‡æ»¤æ‰ä½¿ç”¨äº†é»˜è®¤å€¼å¾—å­—æ®µ</span></span></span><br><span class="hljs-params"><span class="hljs-meta">    response_model_exclude_none=<span class="hljs-literal">True</span>, <span class="hljs-comment"># æ’åºï¼Œæ’åºæ²¡æœ‰å€¼çš„å­—æ®µ</span></span></span><br><span class="hljs-params"><span class="hljs-meta"></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_item_name</span>(<span class="hljs-params">name: <span class="hljs-built_in">str</span></span>):<br>    <span class="hljs-keyword">return</span> items[name]<br></code></pre></td></tr></table></figure><h1 id="4-6-Pydanticæ¨¡å‹ç±»å¯¹è±¡çš„dictæ–¹æ³•"><a href="#4-6-Pydanticæ¨¡å‹ç±»å¯¹è±¡çš„dictæ–¹æ³•" class="headerlink" title="4-6 Pydanticæ¨¡å‹ç±»å¯¹è±¡çš„dictæ–¹æ³•"></a>4-6 Pydanticæ¨¡å‹ç±»å¯¹è±¡çš„dictæ–¹æ³•</h1><p>è¿™ä¸ªæ–¹æ³•å¥½åƒå¼ƒç”¨äº†</p><h1 id="4-7-jsonable-encoderã€å¯èƒ½æ˜¯é‡ç‚¹ã€‘"><a href="#4-7-jsonable-encoderã€å¯èƒ½æ˜¯é‡ç‚¹ã€‘" class="headerlink" title="4-7 jsonable_encoderã€å¯èƒ½æ˜¯é‡ç‚¹ã€‘"></a>4-7 jsonable_encoderã€å¯èƒ½æ˜¯é‡ç‚¹ã€‘</h1><p>å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯æäº¤çš„æ•°æ®éœ€è¦æ°¸ä¹…å­˜å‚¨ä¿å­˜æ•°æ®åº“ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±éœ€è¦ä¿è¯æ•°æ®éƒ½æ˜¯å¯åºåˆ—åŒ–çš„ï¼Œå¦‚ä½•ä¿è¯å¾…åºåˆ—åŒ–çš„æ•°æ®éƒ½æ˜¯å¯åºåˆ—åŒ–çš„å‘¢?</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> datetime <span class="hljs-keyword">import</span> datetime<br><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Union</span><br><span class="hljs-keyword">import</span> json<br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><span class="hljs-keyword">from</span> fastapi.encoders <span class="hljs-keyword">import</span> jsonable_encoder<br><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel<br><br>fake_db = &#123;&#125;<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Item</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    title: <span class="hljs-built_in">str</span><br>    timestamp: datetime<br>    description: <span class="hljs-type">Union</span>[<span class="hljs-built_in">str</span>, <span class="hljs-literal">None</span>] = <span class="hljs-literal">None</span><br><br><br>app = FastAPI()<br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/item&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_item</span>(<span class="hljs-params">item: Item</span>):<br>    json_compatible_item_data = jsonable_encoder(item) <span class="hljs-comment"># è½¬åŒ–jsonå¯åºåˆ—åŒ–</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">type</span>(json_compatible_item_data))<br>    <span class="hljs-built_in">print</span>(json_compatible_item_data)<br>    json.dumps(json_compatible_item_data)<br>    <span class="hljs-keyword">return</span> item<br></code></pre></td></tr></table></figure><h1 id="4-8-å“åº”éƒ¨åˆ†æ€»ç»“"><a href="#4-8-å“åº”éƒ¨åˆ†æ€»ç»“" class="headerlink" title="4-8 å“åº”éƒ¨åˆ†æ€»ç»“"></a>4-8 å“åº”éƒ¨åˆ†æ€»ç»“</h1><ul><li><p>å¦‚ä½•è®¾ç½®çŠ¶æ€ç ï¼šstatuc_codeã€ResponseåŠå…¶å­ç±»</p></li><li><p>å¦‚ä½•è®¾ç½®å“åº”å¤´ï¼šResponseåŠå…¶å­ç±»</p></li><li><p>å¦‚ä½•è®¾ç½®å“åº”ä½“ï¼šé»˜è®¤å“åº”ç±»æ˜¯JSONResponseï¼Œä¹Ÿå¯ä»¥æ‰‹åŠ¨è¿”å›ResponseåŠå…¶å­ç±»çš„å¯¹è±¡</p></li><li><p>ä½¿ç”¨å“åº”æ¨¡å‹åšå­—æ®µè¿‡æ»¤</p></li><li><p>å…³äºä¸åŒç±»å‹çš„å“åº”ï¼ˆä¸‹è½½æ–‡ä»¶ç­‰ï¼‰åœ¨11ç« å“åº”ä»‹ç»</p></li></ul><h1 id="5-ã€é˜¶æ®µæ€§æ€»ç»“"><a href="#5-ã€é˜¶æ®µæ€§æ€»ç»“" class="headerlink" title="5 ã€é˜¶æ®µæ€§æ€»ç»“"></a>5 ã€é˜¶æ®µæ€§æ€»ç»“</h1><h2 id="å…³äºåšå®¢çš„å¢åˆ æ”¹æŸ¥ç»ƒä¹ "><a href="#å…³äºåšå®¢çš„å¢åˆ æ”¹æŸ¥ç»ƒä¹ " class="headerlink" title="å…³äºåšå®¢çš„å¢åˆ æ”¹æŸ¥ç»ƒä¹ "></a>å…³äºåšå®¢çš„å¢åˆ æ”¹æŸ¥ç»ƒä¹ </h2><ul><li><p>5ä¸ªè¯·æ±‚æ–¹å¼çš„ä½¿ç”¨è§„èŒƒ</p></li><li><p>é”™è¯¯å¤„ç†</p></li><li><p>Restfulé£æ ¼apiè®¾è®¡</p><blockquote><p>RESTfulæ˜¯Web APIæ¥å£çš„è®¾è®¡è§„èŒƒé£æ ¼ï¼Œè¿™ç§é£æ ¼çš„ç†å¿µè®¤ä¸ºåç«¯å¼€å‘ä»»åŠ¡å°±æ˜¯æä¾›æ•°æ®çš„ï¼Œå¯¹å¤–æä¾›çš„æ˜¯æ•°æ®èµ„æºçš„è®¿é—®æ¥å£ï¼Œå°¤å…¶é€‚ç”¨äºå‰åç«¯åˆ†ç¦»çš„åº”ç”¨æ¨¡å¼ä¸­ã€‚æ‰€ä»¥åœ¨å®šä¹‰æ¥å£æ—¶ï¼Œå®¢æˆ·ç«¯è®¿é—®çš„URLè·¯å¾„å°±è¡¨ç¤ºè¿™ç§è¦æ“ä½œçš„æ•°æ®èµ„æºã€‚</p><p>ä»»ä½•ä¸€ä¸ªæ¡†æ¶éƒ½å¯ä»¥å®ç°ç¬¦åˆrestfulè§„èŒƒçš„APIæ¥å£ã€‚</p><p>RESTfulåæ¡è§„èŒƒï¼š</p><p>1 æ•°æ®çš„å®‰å…¨ä¿éšœï¼šurlé“¾æ¥ä¸€èˆ¬éƒ½é‡‡ç”¨httpsåè®®è¿›è¡Œä¼ è¾“ </p><p>2 æ¥å£ç‰¹å¾è¡¨ç°ï¼Œä¸€çœ‹å°±çŸ¥é“æ˜¯ä¸ªapiæ¥å£</p><ul><li>ç”¨apiå…³é”®å­—æ ‡è¯†æ¥å£urlï¼š<a href="https://www.baidu.com/api">https://www.baidu.com/api</a></li></ul><p>3 å¤šæ•°æ®ç‰ˆæœ¬å…±å­˜ï¼Œåœ¨urlé“¾æ¥ä¸­æ ‡è¯†æ•°æ®ç‰ˆæœ¬</p><ul><li><a href="https://api.baidu.com/v1">https://api.baidu.com/v1</a></li><li><a href="https://api.baidu.com/v2">https://api.baidu.com/v2</a></li></ul><p>!!!4 æ•°æ®å³æ˜¯èµ„æºï¼Œå‡ä½¿ç”¨åè¯ï¼ˆå¯å¤æ•°ï¼‰</p><ul><li>æ¥å£ä¸€èˆ¬éƒ½æ˜¯å®Œæˆå‰åå°æ•°æ®çš„äº¤äº’ï¼Œäº¤äº’çš„æ•°æ®æˆ‘ä»¬ç§°ä¹‹ä¸ºèµ„æº</li><li><a href="https://api.baidu.com/users">https://api.baidu.com/users</a><br> æ³¨ï¼šä¸€èˆ¬æå€¡ç”¨èµ„æºçš„å¤æ•°å½¢å¼ï¼Œåœ¨urlé“¾æ¥ä¸­å¥–åŠ±ä¸è¦å‡ºç°æ“ä½œèµ„æºçš„åŠ¨è¯</li><li>ç‰¹æ®Šçš„æ¥å£å¯ä»¥å‡ºç°åŠ¨è¯ï¼Œå› ä¸ºè¿™äº›æ¥å£ä¸€èˆ¬æ²¡æœ‰ä¸€ä¸ªæ˜ç¡®çš„èµ„æºï¼Œæˆ–æ˜¯åŠ¨è¯å°±æ˜¯æ¥å£çš„æ ¸å¿ƒå«ä¹‰</li><li><a href="https://api.baidu.com/place/search">https://api.baidu.com/place/search</a></li><li><a href="https://api.baidu.com/login">https://api.baidu.com/login</a></li></ul><p>!!!5 èµ„æºæ“ä½œç”±è¯·æ±‚æ–¹å¼å†³å®šï¼ˆmethodï¼‰</p><ul><li>æ“ä½œèµ„æºä¸€èˆ¬éƒ½ä¼šæ¶‰åŠåˆ°å¢åˆ æ”¹æŸ¥ï¼Œä½¿ç”¨è¯·æ±‚æ–¹å¼ç¡®å®šæ“ä½œç±»å‹<ul><li><a href="https://api.baidu.com/books">https://api.baidu.com/books</a> - getè¯·æ±‚ï¼šè·å–æ‰€æœ‰ä¹¦</li><li><a href="https://api.baidu.com/books/1">https://api.baidu.com/books/1</a> - getè¯·æ±‚ï¼šè·å–ä¸»é”®ä¸º1çš„ä¹¦</li><li><a href="https://api.baidu.com/books">https://api.baidu.com/books</a> - postè¯·æ±‚ï¼šæ–°å¢ä¸€æœ¬ä¹¦ä¹¦</li><li><a href="https://api.baidu.com/books/1">https://api.baidu.com/books/1</a> - putè¯·æ±‚ï¼šæ•´ä½“ä¿®æ”¹ä¸»é”®ä¸º1çš„ä¹¦</li><li><a href="https://api.baidu.com/books/1">https://api.baidu.com/books/1</a> - patchè¯·æ±‚ï¼šå±€éƒ¨ä¿®æ”¹ä¸»é”®ä¸º1çš„ä¹¦</li><li><a href="https://api.baidu.com/books/1">https://api.baidu.com/books/1</a> - deleteè¯·æ±‚ï¼šåˆ é™¤ä¸»é”®ä¸º1çš„ä¹¦</li></ul></li></ul><p>6 è¿‡æ»¤ï¼Œé€šè¿‡åœ¨urlä¸Šä¼ å‚çš„å½¢å¼ä¼ é€’æœç´¢æ¡ä»¶ï¼Œæˆ–è€…è¯´æŸ¥è¯¢å‚æ•°(query_params)</p><ul><li><a href="https://api.example.com/v1/zoos?limit=10%EF%BC%9A%E6%8C%87%E5%AE%9A%E8%BF%94%E5%9B%9E%E8%AE%B0%E5%BD%95%E7%9A%84%E6%95%B0%E9%87%8F">https://api.example.com/v1/zoos?limit=10ï¼šæŒ‡å®šè¿”å›è®°å½•çš„æ•°é‡</a></li><li><a href="https://api.example.com/v1/zoos?offset=10%EF%BC%9A%E6%8C%87%E5%AE%9A%E8%BF%94%E5%9B%9E%E8%AE%B0%E5%BD%95%E7%9A%84%E5%BC%80%E5%A7%8B%E4%BD%8D%E7%BD%AE">https://api.example.com/v1/zoos?offset=10ï¼šæŒ‡å®šè¿”å›è®°å½•çš„å¼€å§‹ä½ç½®</a></li><li><a href="https://api.example.com/v1/zoos?page=2&per_page=100%EF%BC%9A%E6%8C%87%E5%AE%9A%E7%AC%AC%E5%87%A0%E9%A1%B5%EF%BC%8C%E4%BB%A5%E5%8F%8A%E6%AF%8F%E9%A1%B5%E7%9A%84%E8%AE%B0%E5%BD%95%E6%95%B0">https://api.example.com/v1/zoos?page=2&amp;per_page=100ï¼šæŒ‡å®šç¬¬å‡ é¡µï¼Œä»¥åŠæ¯é¡µçš„è®°å½•æ•°</a></li><li><a href="https://api.example.com/v1/zoos?sortby=name&order=asc%EF%BC%9A%E6%8C%87%E5%AE%9A%E8%BF%94%E5%9B%9E%E7%BB%93%E6%9E%9C%E6%8C%89%E7%85%A7%E5%93%AA%E4%B8%AA%E5%B1%9E%E6%80%A7%E6%8E%92%E5%BA%8F%EF%BC%8C%E4%BB%A5%E5%8F%8A%E6%8E%92%E5%BA%8F%E9%A1%BA%E5%BA%8F">https://api.example.com/v1/zoos?sortby=name&amp;order=ascï¼šæŒ‡å®šè¿”å›ç»“æœæŒ‰ç…§å“ªä¸ªå±æ€§æ’åºï¼Œä»¥åŠæ’åºé¡ºåº</a></li><li><a href="https://api.example.com/v1/zoos?animal_type_id=1%EF%BC%9A%E6%8C%87%E5%AE%9A%E7%AD%9B%E9%80%89%E6%9D%A1%E4%BB%B6">https://api.example.com/v1/zoos?animal_type_id=1ï¼šæŒ‡å®šç­›é€‰æ¡ä»¶</a></li></ul><p>7 å“åº”çŠ¶æ€ç </p><p>8 é”™è¯¯å¤„ç†<br>9 è¿”å›ç»“æœï¼Œé’ˆå¯¹ä¸åŒæ“ä½œï¼ŒæœåŠ¡å™¨å‘ç”¨æˆ·è¿”å›çš„ç»“æœåº”è¯¥ç¬¦åˆä»¥ä¸‹è§„èŒƒ<br>  GET &#x2F;collectionï¼šè¿”å›èµ„æºå¯¹è±¡çš„åˆ—è¡¨ï¼ˆæ•°ç»„ï¼‰<br>  GET &#x2F;collection&#x2F;resourceï¼šè¿”å›å•ä¸ªèµ„æºå¯¹è±¡<br>  POST &#x2F;collectionï¼šè¿”å›æ–°ç”Ÿæˆçš„èµ„æºå¯¹è±¡<br>  PUT &#x2F;collection&#x2F;resourceï¼šè¿”å›å®Œæ•´çš„èµ„æºå¯¹è±¡<br>  PATCH &#x2F;collection&#x2F;resourceï¼šè¿”å›å®Œæ•´çš„èµ„æºå¯¹è±¡<br>  DELETE &#x2F;collection&#x2F;resourceï¼šè¿”å›ä¸€ä¸ªç©ºæ–‡æ¡£<br>10 éœ€è¦urlè¯·æ±‚çš„èµ„æºéœ€è¦è®¿é—®èµ„æºçš„è¯·æ±‚é“¾æ¥</p><ul><li>Hypermedia APIï¼ŒRESTful APIæœ€å¥½åšåˆ°Hypermediaï¼Œ</li><li>å³è¿”å›ç»“æœä¸­æä¾›é“¾æ¥ï¼Œè¿å‘å…¶ä»–APIæ–¹æ³•ï¼Œä½¿å¾—ç”¨æˆ·ä¸æŸ¥æ–‡æ¡£ï¼Œä¹ŸçŸ¥é“ä¸‹ä¸€æ­¥åº”è¯¥åšä»€ä¹ˆ</li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs json"> &gt;<span class="hljs-punctuation">&#123;</span><br><span class="hljs-attr">&quot;status&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;msg&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;ok&quot;</span><span class="hljs-punctuation">,</span><br><span class="hljs-attr">&quot;results&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">[</span><br>    <span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;è‚¯å¾·åŸº(ç½—é¤å…)&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;img&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;https://image.baidu.com/kfc/001.png&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">]</span><br> &gt;<span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure></blockquote></li></ul><p>æºç ç¤ºä¾‹ï¼šæ¨¡æ‹ŸRESTFulé£æ ¼çš„api</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> typing<br><br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, HTTPException, status<br><span class="hljs-keyword">from</span> fastapi.encoders <span class="hljs-keyword">import</span> jsonable_encoder<br><span class="hljs-keyword">from</span> pydantic <span class="hljs-keyword">import</span> BaseModel<br><br>app = FastAPI(title=<span class="hljs-string">&quot;Blog CRUD&quot;</span>)<br><br><br><span class="hljs-comment"># mock db</span><br>blogs = &#123;<br>    <span class="hljs-number">1</span>: &#123;<br>        <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">1</span>,<br>        <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;blog1&quot;</span>,<br>        <span class="hljs-string">&quot;body&quot;</span>: <span class="hljs-string">&quot;this is blog1&quot;</span>,<br>        <span class="hljs-string">&quot;desc&quot;</span>: <span class="hljs-string">&quot;desc&quot;</span><br>    &#125;,<br>    <span class="hljs-number">2</span>: &#123;<br>        <span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">2</span>,<br>        <span class="hljs-string">&quot;title&quot;</span>: <span class="hljs-string">&quot;blog2&quot;</span>,<br>        <span class="hljs-string">&quot;body&quot;</span>: <span class="hljs-string">&quot;this is blog2&quot;</span>,<br>        <span class="hljs-string">&quot;desc&quot;</span>: <span class="hljs-string">&quot;desc&quot;</span><br>    &#125;<br>&#125;<br><span class="hljs-comment"># blogs = [</span><br><span class="hljs-comment">#     &#123;</span><br><span class="hljs-comment">#         &quot;id&quot;: 1,</span><br><span class="hljs-comment">#         &quot;title&quot;: &quot;blog1&quot;,</span><br><span class="hljs-comment">#         &quot;body&quot;: &quot;this is blog1&quot;,</span><br><span class="hljs-comment">#         &quot;desc&quot;: &quot;desc&quot;</span><br><span class="hljs-comment">#     &#125;,</span><br><span class="hljs-comment">#     &#123;</span><br><span class="hljs-comment">#         &quot;id&quot;: 2,</span><br><span class="hljs-comment">#         &quot;title&quot;: &quot;blog2&quot;,</span><br><span class="hljs-comment">#         &quot;body&quot;: &quot;this is blog2&quot;,</span><br><span class="hljs-comment">#         &quot;desc&quot;: &quot;desc&quot;</span><br><span class="hljs-comment">#     &#125;</span><br><span class="hljs-comment"># ]</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Blog</span>(<span class="hljs-title class_ inherited__">BaseModel</span>):<br>    title: typing.<span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span><br>    body: typing.<span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span><br>    desc: <span class="hljs-built_in">str</span><br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/blogs&quot;</span>, tags=[<span class="hljs-string">&quot;Blog&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_blogs</span>(<span class="hljs-params">page: <span class="hljs-built_in">int</span> = <span class="hljs-number">1</span>, size: <span class="hljs-built_in">int</span> = <span class="hljs-number">10</span></span>):<br>    blogs_list = <span class="hljs-built_in">list</span>(blogs.values())<br>    <span class="hljs-keyword">return</span> blogs_list[(page - <span class="hljs-number">1</span>) * size:page * size]<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/blog&quot;</span>,  tags=[<span class="hljs-string">&quot;Blog&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_blog_by_id</span>(<span class="hljs-params">blog_id: <span class="hljs-built_in">int</span></span>):<br>    blog = blogs.get(blog_id)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> blog:<br>        <span class="hljs-keyword">raise</span> HTTPException(<br>            status_code=status.HTTP_404_NOT_FOUND,<br>            detail=<span class="hljs-string">f&quot;Not found the blog with id: <span class="hljs-subst">&#123;blog_id&#125;</span>&quot;</span><br>        )<br>    <span class="hljs-keyword">return</span> blog<br><br><br><span class="hljs-meta">@app.post(<span class="hljs-params"><span class="hljs-string">&quot;/blog&quot;</span>,  tags=[<span class="hljs-string">&quot;Blog&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">create_blog</span>(<span class="hljs-params">blog: Blog</span>):<br>    blog_id = <span class="hljs-built_in">len</span>(blogs) + <span class="hljs-number">1</span><br>    blogs[blog_id] = &#123;<span class="hljs-string">&quot;id&quot;</span>: blog_id, **jsonable_encoder(blog)&#125;<br>    <span class="hljs-keyword">return</span> blogs[blog_id]<br><br><br><span class="hljs-meta">@app.put(<span class="hljs-params"><span class="hljs-string">&quot;/blog&quot;</span>,  tags=[<span class="hljs-string">&quot;Blog&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">update_blog</span>(<span class="hljs-params">blog_id: <span class="hljs-built_in">int</span>, blog: Blog</span>):<br>    to_update_blog = blogs.get(blog_id)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> to_update_blog:<br>        <span class="hljs-keyword">raise</span> HTTPException(<br>            status_code=status.HTTP_404_NOT_FOUND,<br>            detail=<span class="hljs-string">f&quot;Not found the blog with id: <span class="hljs-subst">&#123;blog_id&#125;</span>&quot;</span><br>        )<br>    to_update_blog.update(jsonable_encoder(blog))<br>    blogs[blog_id] = to_update_blog<br>    <span class="hljs-keyword">return</span> to_update_blog<br><br><br><span class="hljs-meta">@app.patch(<span class="hljs-params"><span class="hljs-string">&quot;/blog&quot;</span>,  tags=[<span class="hljs-string">&quot;Blog&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">update_blog2</span>(<span class="hljs-params">blog_id: <span class="hljs-built_in">int</span>, blog: Blog</span>):<br>    to_update_blog = blogs.get(blog_id)<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> to_update_blog:<br>        <span class="hljs-keyword">raise</span> HTTPException(<br>            status_code=status.HTTP_404_NOT_FOUND,<br>            detail=<span class="hljs-string">f&quot;Not found the blog with id: <span class="hljs-subst">&#123;blog_id&#125;</span>&quot;</span><br>        )<br>    to_update_blog.update(**jsonable_encoder(blog, exclude_unset=<span class="hljs-literal">True</span>))<br>    blogs[blog_id] = to_update_blog<br>    <span class="hljs-keyword">return</span> to_update_blog<br><br><br><span class="hljs-meta">@app.delete(<span class="hljs-params"><span class="hljs-string">&quot;/blog&quot;</span>,  tags=[<span class="hljs-string">&quot;Blog&quot;</span>]</span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">delete_blog</span>(<span class="hljs-params">blog_id: <span class="hljs-built_in">int</span></span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> blogs.get(blog_id):<br>        <span class="hljs-keyword">raise</span> HTTPException(<br>            status_code=status.HTTP_404_NOT_FOUND,<br>            detail=<span class="hljs-string">f&quot;Not found the blog with id: <span class="hljs-subst">&#123;blog_id&#125;</span>&quot;</span><br>        )<br>    <span class="hljs-keyword">return</span> blogs.pop(blog_id, <span class="hljs-literal">None</span>)<br></code></pre></td></tr></table></figure><p><img src="/../img/joshua.jpg" alt="joshua"></p>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç¼–ç¨‹ï¼Œwebå¼€å‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€pythonã€‘FastAPIç®€å•å­¦ä¹ å’Œè·¯å¾„å‚æ•°ï¼ˆä¸€ï¼‰</title>
    <link href="/2024/01/15/681FastAPI1%E7%AE%80%E5%8D%95%E5%AD%A6%E4%B9%A0%E5%92%8C%E8%B7%AF%E5%BE%84%E5%8F%82%E6%95%B0/"/>
    <url>/2024/01/15/681FastAPI1%E7%AE%80%E5%8D%95%E5%AD%A6%E4%B9%A0%E5%92%8C%E8%B7%AF%E5%BE%84%E5%8F%82%E6%95%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="FastApiå­¦ä¹ "><a href="#FastApiå­¦ä¹ " class="headerlink" title="FastApiå­¦ä¹ "></a>FastApiå­¦ä¹ </h1><h1 id="ä¸€ã€å¿«é€Ÿä¸Šæ‰‹"><a href="#ä¸€ã€å¿«é€Ÿä¸Šæ‰‹" class="headerlink" title="ä¸€ã€å¿«é€Ÿä¸Šæ‰‹"></a>ä¸€ã€å¿«é€Ÿä¸Šæ‰‹</h1><h2 id="ç¬¬ä¸€ä¸ªFastApi"><a href="#ç¬¬ä¸€ä¸ªFastApi" class="headerlink" title="ç¬¬ä¸€ä¸ªFastApi"></a>ç¬¬ä¸€ä¸ªFastApi</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># main.py</span><br><span class="hljs-keyword">import</span> uvicorn<br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><br>app = FastAPI()<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">root</span>():<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">&quot;Hello World&quot;</span>&#125;<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/hello/&#123;name&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">say_hello</span>(<span class="hljs-params">name: <span class="hljs-built_in">str</span></span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;message&quot;</span>: <span class="hljs-string">f&quot;Hello <span class="hljs-subst">&#123;name&#125;</span>&quot;</span>&#125;<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/study/&#123;address&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">say_study</span>(<span class="hljs-params">address: <span class="hljs-built_in">str</span></span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;address&quot;</span>: <span class="hljs-string">f&quot;ä½åœ¨ï¼š <span class="hljs-subst">&#123;address&#125;</span> &quot;</span>&#125;<br><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    uvicorn.run(<span class="hljs-string">&quot;main:app&quot;</span>, host=<span class="hljs-string">&quot;127.0.0.1&quot;</span>, port=<span class="hljs-number">8080</span>, reload=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure><p>å¯åŠ¨æ–¹å¼æœ‰ä¸¤ç§</p><ul><li><p>1ã€å‘½ä»¤è¡Œå¯åŠ¨</p><ul><li><pre><code class="shell">uvicorn main:app --reload --host 127.0.0.1 --port 8080<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><br>  - <br><br>- 2ã€æ‰§è¡Œpython è„šæœ¬æ–‡ä»¶ä¹Ÿæ˜¯å¯ä»¥å¯åŠ¨fastapi é¡¹ç›®çš„ï¼ˆè°ƒè¯•çš„æ—¶å€™ç”¨ï¼Œä¸æ¨èï¼‰<br><br>  - ```python<br>    <span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>        uvicorn.<span class="hljs-built_in">run</span>(<span class="hljs-string">&quot;main:app&quot;</span>, <span class="hljs-attribute">host</span>=<span class="hljs-string">&quot;127.0.0.1&quot;</span>, <span class="hljs-attribute">port</span>=8080, <span class="hljs-attribute">reload</span>=<span class="hljs-literal">True</span>)<br></code></pre></td></tr></table></figure></code></pre></li></ul></li></ul><p>å››ä¸ªæ ¸å¿ƒç‚¹ï¼š</p><ul><li>è·¯å¾„æ“ä½œè£…é¥°å™¨ï¼š<code>@app.get(&quot;/&quot;)</code>ï¼Œåœ¨è¿™é‡Œå¯ä»¥å®šä¹‰æ¥å£çš„url,å¹¶æŒ‡å®šè®¿é—®è¯¥URLä½¿ç”¨çš„è¯·æ±‚æ–¹å¼ã€‚æ¯”å¦‚è¿™ä¸ªä¾‹å­é’Ÿï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªURL: <code>/</code>ä¹Ÿå°±æ˜¯æ ¹ç›®å½•ï¼Œæ ¹è·¯ç”±ï¼Œè®¿é—®æ–¹å¼æ˜¯<code>get</code>åé¢ç®€ç§°ä¸ºè·¯å¾„è£…é¥°å™¨</li><li>è·¯å¾„æ“ä½œå‡½æ•°ï¼š<code>def root()</code>è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬å®šä¹‰çš„è·¯å¾„æ“ä½œå‡½æ•°ï¼Œæˆ–è€…å¯ä»¥æŠŠä»–å«åšapiæ¥å£ï¼Œå½“åˆ«äººåœ¨æµè§ˆå™¨ä¸Šè®¿é—®URL<code>/</code>çš„æ—¶å€™ï¼Œfastapi å°±ä¼šæ‰§è¡Œè¿™ä¸ªæ¥å£ï¼ˆå¯¹å¤–å«æ¥å£ï¼Œå¯¹å†…å«å‡½æ•°ï¼‰é‡Œé¢çš„ä»£ç </li><li>æ¥å£è¿”å›å€¼ï¼š<code>return&#123;&quot;message&quot;:&quot;hello word&quot;&#125;</code>, è¿™ä¸ªå°±æ˜¯apiæ¥å£çš„è¿”å›å€¼è¿”å›å†…å®¹ï¼Œä¹Ÿå°±æ˜¯å½“æˆ‘ä»¬è®¿é—®URL<code>/</code>çš„æ—¶å€™ï¼Œæµè§ˆå™¨ä¸Šçœ‹åˆ°çš„å“åº”ç»“æœ</li></ul><h2 id="1-6è·¯å¾„å‚æ•°"><a href="#1-6è·¯å¾„å‚æ•°" class="headerlink" title="1-6è·¯å¾„å‚æ•°"></a>1-6è·¯å¾„å‚æ•°</h2><p>æˆ‘ä»¬æŠŠè¿™äº›URLç§°ä¹‹ä¸ºè·¯å¾„å‚æ•°ã€‚ä¸åŒçš„URLè¡¨ç¤ºä¸åŒçš„è·¯å¾„ï¼Œä¸åŒçš„å«ä¹‰</p><p>åœ¨FastAPIä¸­å¯ä»¥éå¸¸æ–¹ä¾¿çš„å®šä¹‰å’Œè®¾è®¡è¿™äº›URL(æˆ–è€…è¯´è·¯å¾„å‚æ•°)ï¼Œå¹¶ä¸”åŒæ—¶æ”¯æŒé™æ€è·¯å¾„å‚æ•°å’ŒåŠ¨æ€è·¯å¾„å‚æ•°</p><ul><li>é™æ€è·¯å¾„ ï¼šå†™æ­»ä¸å˜çš„URL</li><li>åŠ¨æ€è·¯å¾„ ï¼šä¸€ç»„æ ¼å¼ç›¸åŒï¼Œä½†åŒ…å«åŠ¨æ€å¯å˜çš„éƒ¨åˆ†ã€‚æ¯”å¦‚ï¼š &#x2F;books&#x2F;2 å’Œ &#x2F;books&#x2F;3 ç­‰ç­‰ï¼Œç¼–å·æ˜¯å¯å˜çš„ã€‚</li></ul><p>åœ¨å‰é¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å°±å®šä¹‰äº†ä¸€ä¸ªåŠ¨æ€è·¯å¾„ ç”¨çš„æ˜¯{}å¼•ç”¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/study/&#123;address&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">say_study</span>(<span class="hljs-params">address: <span class="hljs-built_in">str</span></span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;address&quot;</span>: <span class="hljs-string">f&quot;ä½åœ¨ï¼š <span class="hljs-subst">&#123;address&#125;</span> &quot;</span>&#125;<br></code></pre></td></tr></table></figure><h2 id="1-7æ¥å£é¡ºåº"><a href="#1-7æ¥å£é¡ºåº" class="headerlink" title="1-7æ¥å£é¡ºåº"></a>1-7æ¥å£é¡ºåº</h2><p>å¦‚ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/study/&#123;id&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">say_study</span>(<span class="hljs-params"><span class="hljs-built_in">id</span>: <span class="hljs-built_in">int</span></span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">f&quot;ç¼–å·ï¼š <span class="hljs-subst">&#123;<span class="hljs-built_in">id</span>&#125;</span> &quot;</span>&#125;<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/study/id1&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">say_study</span>():<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-string">f&quot;id = id 1&quot;</span>&#125;<br></code></pre></td></tr></table></figure><ul><li><p>å½“è¯·æ±‚çš„URLæ¥äº†ï¼ŒFastAPIä¼šä»ä¸Šå¾€ä¸‹å¼€å§‹åŒ¹é…æˆ‘ä»¬å®šä¹‰çš„æ¥å£ï¼Œ</p></li><li><p>åŠ¨æ€è·¯å¾„ä¼ å‡½æ•°ä¼ é€’æ—¶çš„ç±»å‹æ˜¯intï¼Œè€Œé™æ€è·¯å¾„å†™æ­»æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¿™ä¸ªæ—¶å€™é¿å…æŠ¥é”™</p></li></ul><p>è§£å†³æ–¹å¼æ˜¯æŠŠé™æ€çš„å†™åœ¨å‰é¢ï¼ŒåŠ¨æ€çš„å†™åœ¨åé¢</p><h2 id="1-8åˆ†é¡µæŸ¥è¯¢"><a href="#1-8åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="1-8åˆ†é¡µæŸ¥è¯¢"></a>1-8åˆ†é¡µæŸ¥è¯¢</h2><p>éœ€æ±‚åœºæ™¯ï¼š</p><p>å›¾ä¹¦åˆ—è¡¨é¡µé¢ï¼Œè¯¥é¡µé¢çš„å›¾ä¹¦æ•°æ®éƒ½æ˜¯ä»æ•°æ®åº“å–å‡ºæ¥é€šè¿‡å›¾ä¹¦æ¥å£<code>/books</code>,è¿”å›ç»™æµè§ˆå™¨</p><p>ä½†æ˜¯æ•°æ®åº“æˆåƒä¸Šä¸‡ï¼Œæµè§ˆå™¨é¡µé¢æ˜¾ç¤ºä½ç½®æœ‰é™ï¼Œé€šå¸¸ç”¨<strong>åˆ†é¡µå±•ç¤º</strong></p><ul><li>å®šä¹‰å½¢å‚ï¼š<code>page:int,size:int</code></li><li>æ³¨æ„çš„ç‚¹ï¼šURLä¸­æŸ¥è¯¢å‚æ•°é»˜è®¤éƒ½æ˜¯<strong>å­—ç¬¦ä¸²æ ¼å¼</strong>ï¼Œæ‰€ä»¥é»˜è®¤<code>page</code>å’Œ<code>size</code>éƒ½æ˜¯å­—ç¬¦ä¸²</li><li>FastAPIç‰¹æ€§ï¼šå½“æˆ‘ä»¬å†å®šä¹‰å½¢å‚æ—¶åŠ ä¸Šç±»å‹æç¤ºï¼Œæ­¤æ—¶FastAPIä¼šå¸®æˆ‘ä»¬è‡ªåŠ¨åšç±»å‹è½¬æ¢ï¼Œå¹¶ä¸”å› æ­¤è¿˜å…·å¤‡äº†ç±»å‹æ ¡éªŒçš„åŠŸèƒ½</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> uvicorn<br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><br>app = FastAPI()<br><br>books = [<br>    &#123;<span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;å›¾ä¹¦1&quot;</span>&#125;,<br>    &#123;<span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">2</span>, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;å›¾ä¹¦2&quot;</span>&#125;,<br>    &#123;<span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">3</span>, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;å›¾ä¹¦3&quot;</span>&#125;,<br>    &#123;<span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">4</span>, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;å›¾ä¹¦4&quot;</span>&#125;,<br>    &#123;<span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">5</span>, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;å›¾ä¹¦5&quot;</span>&#125;,<br>    &#123;<span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">6</span>, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;å›¾ä¹¦6&quot;</span>&#125;,<br>    &#123;<span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">7</span>, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;å›¾ä¹¦7&quot;</span>&#125;,<br>    &#123;<span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">8</span>, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;å›¾ä¹¦8&quot;</span>&#125;,<br>]<br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/books&quot;</span></span>)</span><br><span class="hljs-keyword">async</span> <span class="hljs-keyword">def</span> <span class="hljs-title function_">get_books</span>(<span class="hljs-params">page: <span class="hljs-built_in">int</span>, size: <span class="hljs-built_in">int</span></span>):<br>    <span class="hljs-comment"># åˆ—è¡¨[ç´¢å¼•1ï¼šç´¢å¼•2]å–å€¼</span><br>    <span class="hljs-keyword">return</span> books[(page - <span class="hljs-number">1</span>) * size:page * size]<br><br></code></pre></td></tr></table></figure><ul><li>æ³¨æ„ï¼š æœ€å¥½ä½¿ç”¨Postmanç­‰æ¥å£è°ƒè¯•å·¥å…·å»å¡«å†™æŸ¥è¯¢å‚æ•°å‘èµ·getè¯·æ±‚(æˆ–è€…ä½¿ç”¨æ¥å£æ–‡æ¡£è®¿é—®)</li></ul><h2 id="1-9-OpenAPIæ–‡æ¡£"><a href="#1-9-OpenAPIæ–‡æ¡£" class="headerlink" title="1-9 OpenAPIæ–‡æ¡£"></a>1-9 OpenAPIæ–‡æ¡£</h2><p>OpenAPIæ˜¯swaggerçš„åº•å±‚ï¼Œswaggerå°±æ˜¯åŸºäºOpenAPIå°è£…çš„ä¸€å±‚ï¼Œï¼Œä¸»è¦ç”¨æ¥åšæ¥å£ç®¡ç†</p><p>FastAPIè‡ªå¸¦çš„APIæ–‡æ¡£ä¸”åŠŸèƒ½å¼ºå¤§ï¼Œå¯åŠ¨æœåŠ¡åªéœ€è¦è®¿é—®ä¸¤ä¸ªURLå³å¯</p><ul><li>swagger : <code>ip:port/docs</code></li><li>redoc : <code>ip:port/redoc</code></li></ul><p>è®¾ç½®APIæ–‡æ¡£æ ‡ç­¾*(è¿˜æ˜¯ä¸Šé¢çš„ä»£ç ï¼Œåœ¨å®šä¹‰è·¯ç”±çš„åœ°æ–¹åŠ å‚æ•°)*</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/books&quot;</span>, tags=[<span class="hljs-string">&quot;Book&quot;</span>], description=<span class="hljs-string">&quot;è®¾ç½®æè¿°ä¿¡æ¯&quot;</span>, summary=<span class="hljs-string">&#x27;è®¾ç½®æ¦‚æ‹¬ä¿¡æ¯&#x27;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_books</span>(<span class="hljs-params">page: <span class="hljs-built_in">int</span>, size: <span class="hljs-built_in">int</span></span>):<br>    <span class="hljs-keyword">return</span> books[(page - <span class="hljs-number">1</span>) * size:page * size]<br></code></pre></td></tr></table></figure><p>æ‹“å±•ï¼šå…³äº<code>@app.get()</code> è£…é¥°å™¨ç”¨äºå®šä¹‰ HTTP GET è¯·æ±‚çš„å¤„ç†å‡½æ•°ã€‚å®ƒå¯ä»¥æ¥å—ä»¥ä¸‹å‚æ•°ï¼š</p><ul><li>path(å¿…éœ€)ï¼šè¡¨ç¤ºè·¯ç”±çš„è·¯å¾„ï¼Œå³è¯·æ±‚çš„ URL è·¯å¾„ã€‚ä¾‹å¦‚ï¼Œ<code>/books</code> è¡¨ç¤ºå¤„ç† <code>/books</code> è·¯å¾„çš„ GET è¯·æ±‚ã€‚</li><li><code>summary</code>ï¼ˆå¯é€‰ï¼‰ï¼šæä¾›ä¸€ä¸ªç®€è¦çš„æè¿°ï¼Œç”¨äºç”Ÿæˆ API æ–‡æ¡£ã€‚é€šå¸¸ç”¨äºæè¿°è·¯ç”±çš„ç›®çš„æˆ–åŠŸèƒ½ã€‚</li><li><code>description</code>ï¼ˆå¯é€‰ï¼‰ï¼šæä¾›æ›´è¯¦ç»†çš„æè¿°ï¼Œç”¨äºç”Ÿæˆ API æ–‡æ¡£ã€‚å¯ä»¥åœ¨è¿™é‡Œæä¾›æœ‰å…³è·¯ç”±çš„æ›´å¤šä¿¡æ¯ï¼Œå¦‚ç”¨æ³•ç¤ºä¾‹ã€å‚æ•°è¯´æ˜ç­‰ã€‚</li><li><code>response_model</code>ï¼ˆå¯é€‰ï¼‰ï¼šæŒ‡å®šè·¯ç”±çš„å“åº”æ¨¡å‹ï¼Œå³è¿”å›ç»™å®¢æˆ·ç«¯çš„æ•°æ®ç»“æ„ã€‚å¯ä»¥æ˜¯ Pydantic æ¨¡å‹ç±»ï¼Œç”¨äºéªŒè¯å’Œåºåˆ—åŒ–å“åº”æ•°æ®ï¼ˆä¸ç”¨ï¼‰</li><li><code>status_code</code>ï¼ˆå¯é€‰ï¼‰ï¼šæŒ‡å®šæˆåŠŸå“åº”çš„ HTTP çŠ¶æ€ç ã€‚é»˜è®¤ä¸º 200ã€‚</li><li><code>dependencies</code>ï¼ˆå¯é€‰ï¼‰ï¼šæŒ‡å®šç”¨äºè¯¥è·¯ç”±çš„ä¾èµ–é¡¹ã€‚å¯ä»¥æ˜¯å•ä¸ªä¾èµ–é¡¹æˆ–ä¾èµ–é¡¹åˆ—è¡¨ã€‚</li><li><code>responses</code>ï¼ˆå¯é€‰ï¼‰ï¼šæŒ‡å®šå…¶ä»–éé»˜è®¤å“åº”çš„é…ç½®ã€‚å¯ä»¥è‡ªå®šä¹‰ä¸åŒçŠ¶æ€ç çš„å“åº”ï¼Œä¾‹å¦‚é”™è¯¯å¤„ç†æˆ–å…¶ä»–ç‰¹å®šæƒ…å†µä¸‹çš„å“åº”ã€‚</li></ul><p><img src="/../img/%E6%A0%87%E7%AD%BE%E4%BF%A1%E6%81%AF.png" alt="æ ‡ç­¾ä¿¡æ¯"></p><h1 id="äºŒã€Pathå’ŒQuery"><a href="#äºŒã€Pathå’ŒQuery" class="headerlink" title="äºŒã€Pathå’ŒQuery"></a>äºŒã€Pathå’ŒQuery</h1><h2 id="2-1-è·¯å¾„è½¬æ¢å™¨"><a href="#2-1-è·¯å¾„è½¬æ¢å™¨" class="headerlink" title="2-1 è·¯å¾„è½¬æ¢å™¨"></a>2-1 è·¯å¾„è½¬æ¢å™¨</h2><p>åœ¨ FastAPI ä¸­ï¼Œè·¯å¾„è½¬æ¢å™¨æ˜¯ä¸€ç§ç”¨äºå®šä¹‰è·¯ç”±è·¯å¾„å‚æ•°çš„æœºåˆ¶ã€‚è·¯å¾„è½¬æ¢å™¨å…è®¸ä½ åœ¨è·¯ç”±è·¯å¾„ä¸­ä½¿ç”¨ç‰¹å®šçš„å‚æ•°æ¨¡å¼ï¼Œå¹¶å°†å…¶æ•è·å¹¶ä¼ é€’ç»™å¤„ç†å‡½æ•°ã€‚</p><p>å¸¸è§çš„è·¯å¾„è½¬æ¢å™¨åŒ…æ‹¬ï¼š</p><ul><li><code>&#123;variable&#125;</code>: ä½¿ç”¨èŠ±æ‹¬å·åŒ…å›´çš„å˜é‡åç§°ï¼Œä¾‹å¦‚ <code>&#123;item_id&#125;</code>ã€‚è¿™ç§å½¢å¼çš„è·¯å¾„å‚æ•°å°†åŒ¹é…è·¯å¾„ä¸­çš„ä»»ä½•å€¼ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™å¤„ç†å‡½æ•°ã€‚</li><li><code>&#123;variable:type&#125;</code>: åœ¨èŠ±æ‹¬å·ä¸­æŒ‡å®šå˜é‡çš„åç§°å’Œç±»å‹ï¼Œä¾‹å¦‚ <code>&#123;item_id:int&#125;</code>ã€‚è¿™ç§å½¢å¼çš„è·¯å¾„å‚æ•°å°†åŒ¹é…æŒ‡å®šç±»å‹çš„å€¼ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºç›¸åº”çš„æ•°æ®ç±»å‹åä¼ é€’ç»™å¤„ç†å‡½æ•°ã€‚</li></ul><p>ç¤ºä¾‹1ï¼šä½¿ç”¨è·¯å¾„è½¬æ¢å™¨int,å¯ä»¥ç›´æ¥å¸®æˆ‘ä»¬å°†è¿™ä¸ªå‚æ•°è½¬åŒ–ä¸ºintç±»å‹</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> typing<br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><br><br>app = FastAPI(title=<span class="hljs-string">&quot;è·¯å¾„è½¬åŒ–å™¨&quot;</span>)<br><br>books = &#123;<br>    <span class="hljs-number">1</span>: &#123;<span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;å›¾ä¹¦1&quot;</span>&#125;,<br>    <span class="hljs-number">2</span>: &#123;<span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">2</span>, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;å›¾ä¹¦2&quot;</span>&#125;,<br>    <span class="hljs-number">3</span>: &#123;<span class="hljs-string">&quot;id&quot;</span>: <span class="hljs-number">3</span>, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;å›¾ä¹¦3&quot;</span>&#125;,<br>&#125;<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/books/&#123;id:int&#125;&quot;</span></span>)</span><span class="hljs-comment"># æ³¨æ„ &#123;id:int&#125;  :ä¸¤è¾¹ä¸èƒ½æœ‰ç©ºæ ¼</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_books_by_id</span>(<span class="hljs-params"><span class="hljs-built_in">id</span></span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">id</span>, <span class="hljs-built_in">type</span>(<span class="hljs-built_in">id</span>))<br>    <span class="hljs-keyword">return</span> books.get(<span class="hljs-built_in">id</span>)<br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/files/&#123;file_path&#125;&quot;</span></span>) </span><span class="hljs-comment"># æ— è·¯å¾„è½¬æ¢å™¨</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_file</span>(<span class="hljs-params">file_path: <span class="hljs-built_in">str</span></span>):<br>    <span class="hljs-built_in">print</span>(file_path)<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        <span class="hljs-keyword">return</span> f.read()<br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/files/&#123;file_path:path&#125;&quot;</span></span>) </span><span class="hljs-comment"># pathè·¯å¾„è½¬æ¢å™¨</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">read_file</span>(<span class="hljs-params">file_path: <span class="hljs-built_in">str</span></span>):<br>    <span class="hljs-built_in">print</span>(file_path)<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(file_path, <span class="hljs-string">&quot;r&quot;</span>) <span class="hljs-keyword">as</span> f:<br>        <span class="hljs-keyword">return</span> f.read()<br></code></pre></td></tr></table></figure><p>æ³¨æ„1ï¼š<code>get_books_by_id(id)</code>å› ä¸ºæ­¤æ—¶<strong>æ²¡æœ‰åœ¨è·¯å¾„å‡½æ•°å†…ä½¿ç”¨ç±»å‹æç¤ºï¼Œæ‰€ä»¥openapiæ–‡æ¡£æ²¡æœ‰äº†ç±»å‹æ ¡éªŒåŠŸèƒ½</strong>ã€‚</p><p>æ³¨æ„2ï¼šå¦‚æœå‚æ•°ç±»å‹ä¸åŒ¹é…ï¼Œåˆ™ç›´æ¥è¿”å›404 Not Foundï¼Œç¨‹åºæ˜¯ä¸ä¼šæ‰§è¡Œè·¯å¾„å‡½æ•°å†…çš„ä»£ç ã€‚</p><p><strong>å†…ç½®5ç§è·¯å¾„è½¬æ¢å™¨</strong></p><ul><li><code>str</code> è¿”å›å­—ç¬¦ä¸²ï¼ˆé»˜è®¤æ¨¡å¼ï¼‰</li><li><code>int</code>ï¼šè¿”å›æ•´æ•°</li><li><code>float</code>ï¼šè¿”å›pyhonä¸­çš„floatæµ®ç‚¹æ•°</li><li><code>uuid</code> :è¿”å›pythonä¸­çš„uuid.UUID</li><li><code>path</code>è¿”å›ä¸€ä¸ªè·¯å¾„ï¼Œå¯ä»¥åŒ…å«ä»»æ„å¤šä¸ªçš„&#x2F;</li></ul><p>è¡¥å……1ï¼šè¿™äº›å†…ç½®è½¬åŒ–å™¨æ˜¯Fastapiç›´æ¥å¤ç”¨Starletteä¸­çš„è·¯å¾„è½¬åŒ–å™¨</p><p>è¡¥å……2ï¼šé™¤äº†è¿™5ä¸ªè½¬åŒ–å™¨ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è‡ªå®šä¹‰ç¬¦åˆè‡ªå·±éœ€æ±‚çš„è½¬åŒ–å™¨ï¼ˆå‚è€ƒå®˜ç½‘ä»£ç ï¼‰</p><h2 id="2-2-è·¯å¾„å‚æ•°æšä¸¾å€¼"><a href="#2-2-è·¯å¾„å‚æ•°æšä¸¾å€¼" class="headerlink" title="2-2 è·¯å¾„å‚æ•°æšä¸¾å€¼"></a>2-2 è·¯å¾„å‚æ•°æšä¸¾å€¼</h2><p>å¯ä»¥å®šä¹‰ä¸€ä¸ªæ•°æ®ç±»ï¼Œæšä¸¾å‡ºå‡ ç§å¯èƒ½æ€§ï¼Œè¿›è¡Œé™åˆ¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> enum <span class="hljs-keyword">import</span> Enum<br><br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TagName</span>(<span class="hljs-built_in">str</span>, Enum):<span class="hljs-comment"># å¤šç»§æ‰¿ï¼Œpythonç‰¹æ€§</span><br>    PYTHON = <span class="hljs-string">&quot;python&quot;</span><br>    LINUX = <span class="hljs-string">&quot;linux&quot;</span><br>    WEB = <span class="hljs-string">&quot;web&quot;</span><br><br><br>app = FastAPI()<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/blogs/&#123;tag&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_blogs_by_tag</span>(<span class="hljs-params">tag: TagName</span>): <span class="hljs-comment"># ç±»å‹æç¤º</span><br>    <span class="hljs-keyword">if</span> tag == TagName.PYTHON:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;some blogs about python&quot;</span><br><br>    <span class="hljs-keyword">if</span> tag.value == <span class="hljs-string">&quot;web&quot;</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;some blogs about web&quot;</span><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;some blogs about linux&quot;</span><br><span class="hljs-comment"># æœ‰äº†</span><br></code></pre></td></tr></table></figure><ul><li><p><code>TagName</code>ç»§æ‰¿ <code>Enum</code>æ˜¯ä¸ºäº†ä½¿ç”¨æšä¸¾ç±»å‹ï¼Œç»§æ‰¿ <code>str</code>æ˜¯ä¸ºäº†æœ‰ç±»å‹æç¤ºå’ŒAPIæ–‡æ¡£æ˜¾ç¤ºåŠŸèƒ½ã€‚ï¼ˆpython3.11å¯ä»¥ç›´æ¥ä½¿ç”¨StrEnumï¼‰</p></li><li><p>æœ‰äº†æšä¸¾ç±»å‹ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨æšä¸¾å˜é‡çš„ <code>namne</code>å’Œ <code>value</code>ä¸¤ä¸ªå±æ€§ã€‚</p><ul><li><p>nameï¼šè¡¨ç¤ºæšä¸¾å˜é‡çš„åå­—ï¼Œæ¯”å¦‚ï¼Œ PYTHON</p></li><li><p>valueï¼šè¡¨ç¤ºæšä¸¾å˜é‡çš„å€¼ï¼Œæ¯”å¦‚ï¼Œpython</p></li></ul></li><li><p>æœ‰äº†<code>TagName</code>ï¼ŒFastAPIå°±çŸ¥é“tagè¿™ä¸ªè·¯åŠ²å‚æ•°åªæœ‰ä¸‰ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„å€¼ï¼Œå¦‚æœURLä¸­æœ‰å…¶ä»–å€¼å°±ä¼šç›´æ¥æŠ¥é”™ã€‚</p></li></ul><h2 id="2-3-è·¯å¾„å‚æ•°ä½¿ç”¨Path-æ ¡éªŒ"><a href="#2-3-è·¯å¾„å‚æ•°ä½¿ç”¨Path-æ ¡éªŒ" class="headerlink" title="2-3 è·¯å¾„å‚æ•°ä½¿ç”¨Path æ ¡éªŒ"></a>2-3 è·¯å¾„å‚æ•°ä½¿ç”¨Path æ ¡éªŒ</h2><p>éœ€æ±‚åœºæ™¯ï¼š</p><p>é™åˆ¶å…¥å‚çš„é•¿åº¦ï¼Œæ¯”å¦‚è¯´å­—ç¬¦ä¸²é•¿åº¦ã€æ•°å­—å¤§å°ã€‚ä½¿ç”¨Path()å‡½æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Path<br><br><br>app = FastAPI()<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/blog/&#123;name&#125;&quot;</span></span>) </span><span class="hljs-comment"># æœ€å°3ä¸ªå­—ç¬¦ï¼Œæœ€å¤š10ä¸ªå­—ç¬¦</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_blog_by_name</span>(<span class="hljs-params">name: <span class="hljs-built_in">str</span> = Path(<span class="hljs-params">min_length=<span class="hljs-number">3</span>, max_length=<span class="hljs-number">10</span></span>)</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">f&quot;the length of this blog name is: <span class="hljs-subst">&#123;<span class="hljs-built_in">len</span>(name)&#125;</span>&quot;</span><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/blog/&#123;id&#125;&quot;</span></span>) </span><span class="hljs-comment"># æœ€å°3-10ä¹‹é—´</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_blog_by_id</span>(<span class="hljs-params"><span class="hljs-built_in">id</span>: <span class="hljs-built_in">int</span> = Path(<span class="hljs-params">ge=<span class="hljs-number">3</span>, le=<span class="hljs-number">10</span></span>)</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">id</span><br></code></pre></td></tr></table></figure><h2 id="2-4-Pathä¹‹æ¥å£æ–‡æ¡£è®¾ç½®ã€å¯ä»¥çœ‹ä¸€ä¸‹ã€‘"><a href="#2-4-Pathä¹‹æ¥å£æ–‡æ¡£è®¾ç½®ã€å¯ä»¥çœ‹ä¸€ä¸‹ã€‘" class="headerlink" title="2-4 Pathä¹‹æ¥å£æ–‡æ¡£è®¾ç½®ã€å¯ä»¥çœ‹ä¸€ä¸‹ã€‘"></a>2-4 Pathä¹‹æ¥å£æ–‡æ¡£è®¾ç½®ã€å¯ä»¥çœ‹ä¸€ä¸‹ã€‘</h2><p>Path()ä¸ä»…å¯ä»¥ç”¨æ¥åšè·¯å¾„å‚æ•°çš„æ ¡éªŒé€»è¾‘ï¼Œè¿˜å¯ä»¥ç”¨æ¥è®¾ç½®æ¥å£æ–‡æ¡£çš„å±•ç¤ºåŠŸèƒ½ï¼Œå¸¸ç”¨çš„è®¾ç½®å­—æ®µå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">alias:      <span class="hljs-comment"># è®¾ç½®åˆ«åï¼Œä¿®æ”¹æ˜¯è¦é…åˆè·¯å¾„è£…é¥°å™¨ä¸­çš„å‚æ•°åä¸€å—ä¿®æ”¹</span><br>title:      <span class="hljs-comment"># è®¾ç½®æ ‡é¢˜ï¼Œåœ¨redocä¸­æœ‰æ˜¾ç¤º</span><br>description:         <span class="hljs-comment"># è®¾ç½®å‚æ•°æè¿°ä¿¡æ¯</span><br>example:     <span class="hljs-comment"># è®¾ç½®ä¾‹å­</span><br>examples:     <span class="hljs-comment"># è®¾ç½®å¤šä¸ªä¾‹å­ï¼Œæ¯”è¾ƒå¤æ‚</span><br>deprecated:     <span class="hljs-comment"># å°†è¦åºŸå¼ƒè¯¥æ¥å£</span><br>include_in_schema:  <span class="hljs-comment"># æ˜¯å¦æŠŠschemaæ˜¾ç¤ºåœ¨apiæ–‡æ¡£</span><br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹1ï¼š examples</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Path<br><br><br>app = FastAPI()<br><br>examples = &#123;<br>    <span class="hljs-string">&quot;valid&quot;</span>: &#123;<span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-number">20</span>&#125;,<br>    <span class="hljs-string">&quot;invalid&quot;</span>: &#123;<span class="hljs-string">&quot;value&quot;</span>: <span class="hljs-number">8</span>&#125;,<br>&#125;<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/blog/&#123;id&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_blog_by_id</span>(<span class="hljs-params"><span class="hljs-built_in">id</span>: <span class="hljs-built_in">int</span> = Path(<span class="hljs-params">ge=<span class="hljs-number">10</span>, example=examples</span>)</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">id</span><br></code></pre></td></tr></table></figure><h2 id="2-5-è®¾ç½®æŸ¥è¯¢å‚æ•°-åˆ†é¡µå’Œæ’åº"><a href="#2-5-è®¾ç½®æŸ¥è¯¢å‚æ•°-åˆ†é¡µå’Œæ’åº" class="headerlink" title="2-5 è®¾ç½®æŸ¥è¯¢å‚æ•° åˆ†é¡µå’Œæ’åº"></a>2-5 è®¾ç½®æŸ¥è¯¢å‚æ•° åˆ†é¡µå’Œæ’åº</h2><p>æ¯”å¦‚ï¼Œå›¾ä¹¦åˆ—è¡¨é¡µé¢ï¼Œä½¿ç”¨pageå’Œsizeä¸¤ä¸ªæŸ¥è¯¢å‚æ•°åšåˆ†é¡µï¼Œä½†å­˜åœ¨URLä¸­æ²¡æœ‰æºå¸¦è¿™ä¿©å‚æ•°çš„æƒ…å†µï¼Œæ­¤æ—¶èƒ½å¦æœ‰é»˜è®¤å€¼å‘¢ï¼Ÿ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> random<br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI<br><br>app = FastAPI()<br><br>books = [&#123;<span class="hljs-string">&quot;id&quot;</span>: i, <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">f&quot;å›¾ä¹¦<span class="hljs-subst">&#123;i&#125;</span>&quot;</span>&#125; <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>)]<br>random.shuffle(books)<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/books&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_books</span>(<span class="hljs-params">page: <span class="hljs-built_in">int</span>, size: <span class="hljs-built_in">int</span>, sort: <span class="hljs-built_in">bool</span></span>):<br>    results = books[(page - <span class="hljs-number">1</span>) * size:page * size]<br>    <span class="hljs-keyword">if</span> sort: <span class="hljs-comment"># å¦‚æœsortæ˜¯ture</span><br>        results.sort(key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-string">&quot;id&quot;</span>]) <span class="hljs-comment"># è¿›è¡Œsort æ’åº</span><br><br>    <span class="hljs-keyword">return</span> results <span class="hljs-comment"># å¦åˆ™ç›´æ¥è¿”å›åˆ†é¡µ</span><br></code></pre></td></tr></table></figure><p>çœ‹ä¸€ä¸‹ä»–çš„è¯·æ±‚å°±çŸ¥é“äº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">http://127.0.0.1:8000/books?page=1&amp;size=5&amp;<span class="hljs-built_in">sort</span>=1<br>http://127.0.0.1:8000/books?page=1&amp;size=5&amp;<span class="hljs-built_in">sort</span>=True<br>http://127.0.0.1:8000/books?page=1&amp;size=5&amp;<span class="hljs-built_in">sort</span>=<span class="hljs-literal">true</span><br>http://127.0.0.1:8000/books?page=1&amp;size=5&amp;<span class="hljs-built_in">sort</span>=on<br>http://127.0.0.1:8000/books?page=1&amp;size=5&amp;<span class="hljs-built_in">sort</span>=<span class="hljs-built_in">yes</span><br></code></pre></td></tr></table></figure><h2 id="2-6-æŸ¥è¯¢å‚æ•°æœ‰å¤šä¸ªå€¼"><a href="#2-6-æŸ¥è¯¢å‚æ•°æœ‰å¤šä¸ªå€¼" class="headerlink" title="2-6 æŸ¥è¯¢å‚æ•°æœ‰å¤šä¸ªå€¼"></a>2-6 æŸ¥è¯¢å‚æ•°æœ‰å¤šä¸ªå€¼</h2><p>URLä¸Šå¯èƒ½æºå¸¦å¤šä¸ªç›¸åŒçš„æŸ¥è¯¢å‚æ•°ï¼Œ<code>/books?id=10&amp;id=20</code>ï¼Œæ­¤æ—¶å¦‚ä½•è·å–å¤šä¸ªidè¿™ä¸ªæŸ¥è¯¢å‚æ•°çš„å¤šä¸ªå€¼ï¼Ÿ</p><p>ç¤ºä¾‹1ï¼š<strong>åœ¨è·¯å¾„å‡½æ•°å†…å®šä¹‰å¤šä¸ªæŸ¥è¯¢å‚æ•°æ—¶ï¼Œéœ€è¦éµå¾ªPythonå½¢å‚é¡ºåºçš„åŸºæœ¬åŸåˆ™ï¼šå…ˆä½ç½®å‚æ•°ï¼Œåå…³é”®å­—å‚æ•°</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æ­£ç¡®çš„é¡ºåº</span><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/books&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_books</span>(<span class="hljs-params">page: <span class="hljs-built_in">int</span>, size: <span class="hljs-built_in">int</span> = <span class="hljs-number">4</span>, sort: <span class="hljs-built_in">bool</span> = <span class="hljs-literal">False</span></span>):<br>    results = books[(page - <span class="hljs-number">1</span>) * size:page * size]<br>    <span class="hljs-keyword">if</span> sort:<br>        results.sort(key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-string">&quot;id&quot;</span>])<br>    <span class="hljs-keyword">return</span> results<br><br><span class="hljs-comment"># é”™è¯¯çš„é¡ºåº</span><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/books&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_books</span>(<span class="hljs-params">page: <span class="hljs-built_in">int</span>, size: <span class="hljs-built_in">int</span> = <span class="hljs-number">4</span>, sort: <span class="hljs-built_in">bool</span></span>):<br>    results = books[(page - <span class="hljs-number">1</span>) * size:page * size]<br>    <span class="hljs-keyword">if</span> sort:<br>        results.sort(key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-string">&quot;id&quot;</span>])<br>    <span class="hljs-keyword">return</span> results<br></code></pre></td></tr></table></figure><p>ç¤ºä¾‹2ï¼šè·å–URLä¸­ç›¸åŒå‚æ•°çš„å¤šä¸ªå€¼ï¼Œéœ€è¦ä½¿ç”¨Query()å‡½æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> typing<br><span class="hljs-keyword">from</span> fastapi <span class="hljs-keyword">import</span> FastAPI, Query<br><br>app = FastAPI()<br><br><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/books&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_books</span>(<span class="hljs-params"><span class="hljs-built_in">id</span>: typing.<span class="hljs-type">List</span>[<span class="hljs-built_in">int</span>] = Query(<span class="hljs-params"></span>)</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">id</span><br></code></pre></td></tr></table></figure><h2 id="2-7-æŸ¥è¯¢å‚æ•°ä½¿ç”¨Queryæ ¡éªŒ"><a href="#2-7-æŸ¥è¯¢å‚æ•°ä½¿ç”¨Queryæ ¡éªŒ" class="headerlink" title="2-7 æŸ¥è¯¢å‚æ•°ä½¿ç”¨Queryæ ¡éªŒ"></a>2-7 æŸ¥è¯¢å‚æ•°ä½¿ç”¨Queryæ ¡éªŒ</h2><h2 id="2-8-è·¯å¾„å‚æ•°å’ŒæŸ¥è¯¢å‚æ•°çš„é¡ºåºé—®é¢˜"><a href="#2-8-è·¯å¾„å‚æ•°å’ŒæŸ¥è¯¢å‚æ•°çš„é¡ºåºé—®é¢˜" class="headerlink" title="2-8 è·¯å¾„å‚æ•°å’ŒæŸ¥è¯¢å‚æ•°çš„é¡ºåºé—®é¢˜"></a>2-8 è·¯å¾„å‚æ•°å’ŒæŸ¥è¯¢å‚æ•°çš„é¡ºåºé—®é¢˜</h2><p>ä½ æ˜¯å¦æœ‰ç–‘é—®ï¼šä¸€ä¸ªæ¥å£ä¸­æ—¢æœ‰è·¯å¾„å‚æ•°ï¼Œåˆæœ‰æŸ¥è¯¢å‚æ•°ï¼ŒFastAPIæ˜¯å¦‚ä½•åŒºåˆ†å®ƒä»¬çš„ï¼Œå’Œé¡ºåºæœ‰å…³ç³»å—ï¼Ÿ</p><p>ä½ æ˜¯å¦æœ‰ç–‘é—®ï¼šä¸€ä¸ªæ¥å£ä¸­çš„è·¯å¾„å‚æ•°å’ŒæŸ¥è¯¢å‚æ•°çš„é¡ºåºæœ‰å…³ç³»å—ï¼Œä¸ºä»€ä¹ˆæˆ‘å®šä¹‰å‚æ•°ä¼šæœ‰è¯­æ³•é”™è¯¯ï¼Œæ— æ³•è¿è¡Œç¨‹åºï¼Ÿ</p><p>åŸåˆ™ï¼š</p><ul><li><p><strong>è·¯å¾„å‡½æ•°å†…çš„å½¢å‚åå­—ä¸èƒ½é‡å¤</strong></p></li><li><p><strong>æ™®é€šç±»å‹çš„å‚æ•°é»˜è®¤ä¼šè¢«è¯†åˆ«ä¸ºæŸ¥è¯¢å‚æ•°ï¼Œæ¯”å¦‚ï¼š<code>int</code>, <code>float</code>, <code>str</code>, <code>bool</code>ï¼›å¤æ‚ç±»å‹éœ€è¦é…åˆQuery()æ˜¾ç¤ºå£°æ˜ä¸ºæŸ¥è¯¢å‚æ•°</strong></p></li><li><p><strong>åªè¦å½¢å‚çš„åå­—å‡ºç°åœ¨è·¯å¾„è£…é¥°å™¨ä¸­å®šä¹‰çš„å‚æ•°ï¼Œåˆ™è‚¯å®šæ˜¯è·¯å¾„å‚æ•°ï¼Œå³ä½¿ä½¿ç”¨äº†Query()</strong></p></li></ul><h2 id="2-9-é˜¶æ®µæ€»ç»“"><a href="#2-9-é˜¶æ®µæ€»ç»“" class="headerlink" title="2-9 é˜¶æ®µæ€»ç»“"></a>2-9 é˜¶æ®µæ€»ç»“</h2><ul><li>ç»“è®º1ï¼šè·¯å¾„æŒ‡çš„å°±æ˜¯è·¯ç”±æˆ–è€…è¯´URLï¼Œåˆ†é™æ€è·¯ç”±å’ŒåŠ¨æ€è·¯ç”±</li><li>ç»“è®º2ï¼šåŠ¨æ€è·¯ç”±ä¸­çš„å‚æ•°ï¼Œå°±æ˜¯è·¯å¾„å‚æ•°ï¼›åªè¦å®šä¹‰åœ¨è·¯å¾„å‡½æ•°çš„å½¢å‚å’Œè·¯å¾„è£…é¥°å™¨ä¸­çš„å‚æ•°åŒåï¼Œåˆ™è¯¥å½¢å‚å°±ä¼šè¢«æ˜¯è¢«ä¸ºè·¯å¾„å‚æ•°</li><li>ç»“è®º3ï¼š<strong>è·¯å¾„å‚æ•°é»˜è®¤æ˜¯å¿…é¡»çš„</strong>ï¼Œä¸”å‚æ•°ç±»å‹é»˜è®¤æ˜¯å­—ç¬¦ä¸²ï¼Œå¯ä»¥ä½¿ç”¨è·¯å¾„è½¬åŒ–å™¨æˆ–è€…ç±»å‹æç¤ºçš„æ–¹å¼åšç±»å‹è½¬æ¢</li><li>ç»“è®º4ï¼šè·Ÿåœ¨URL <code>?</code> åé¢çš„é”®å€¼å¯¹å‚æ•°ç§°ä¹‹ä¸º æŸ¥è¯¢å‚æ•°ï¼Œé»˜è®¤æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œå¯ä»¥ä½¿ç”¨ç±»å‹æç¤ºçš„æ–¹å¼åšç±»å‹è½¬åŒ–</li><li>ç»“è®º5ï¼šæ™®é€šç±»å‹çš„å½¢å‚ï¼ˆint&#x2F;str&#x2F;float&#x2F;boolï¼‰ï¼ŒFastAPIä¼šé»˜è®¤å®ƒä¸ºæŸ¥è¯¢å‚æ•°ï¼›ä¹Ÿå¯ä»¥ä½¿ç”¨Query()æ˜¾ç¤ºå£°æ˜</li><li>ç»“è®º6ï¼šä½¿ç”¨Path()ç»™è·¯å¾„å‚æ•°åšæ ¡éªŒï¼Œä½¿ç”¨Query()ç»™æŸ¥è¯¢å‚æ•°åšæ ¡éªŒï¼›åšAPIæ–‡æ¡£çš„è®¾ç½®</li><li>ç»“è®º7ï¼šæŸ¥è¯¢å‚æ•°å’Œè·¯è¿‡å‚æ•°çš„å®šä¹‰é¡ºåºæ— å…³ï¼ŒFastAPIèƒ½éƒ½è‡ªåŠ¨æ˜¯è¢«å®ƒä»¬</li><li>ç»“è®º8ï¼šå®šä¹‰åœ¨è·¯å¾„å‡½æ•°å†…å½¢å‚çš„é¡ºåºï¼Œéœ€è¦éµå¾ªï¼š<strong>æ²¡æœ‰é»˜è®¤å€¼çš„æ”¾åœ¨å‰é¢ï¼Œæœ‰é»˜è®¤å€¼çš„æ”¾åœ¨åé¢ï¼ˆpythonçš„è¯­æ³•è¦æ±‚ï¼‰</strong></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ç®€å•è¯´ï¼šè·¯å¾„å‚æ•°æ˜¯ä» URL è·¯å¾„ä¸­æå–çš„å‚æ•°ï¼Œåœ¨è·¯ç”±è·¯å¾„ä¸­ä½¿ç”¨èŠ±æ‹¬å· &#123;&#125; åŒ…å›´å‚æ•°åç§°æ¥å®šä¹‰ã€‚ä¾‹å¦‚ï¼Œ/users/&#123;user_id&#125; ä¸­çš„ user_id å°±æ˜¯ä¸€ä¸ªè·¯å¾„å‚æ•°ã€‚åœ¨å¤„ç†å‡½æ•°ä¸­ï¼Œä½ å¯ä»¥åƒæ™®é€šå‡½æ•°å‚æ•°ä¸€æ ·å£°æ˜è·¯å¾„å‚æ•°ï¼Œå¹¶æŒ‡å®šå…¶ç±»å‹ã€‚FastAPI å°†è‡ªåŠ¨ä»è¯·æ±‚ URL ä¸­æå–å‚æ•°çš„å€¼ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™ç›¸åº”çš„å¤„ç†å‡½æ•°ã€‚</span><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/users/&#123;user_id&#125;&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_user</span>(<span class="hljs-params">user_id: <span class="hljs-built_in">int</span></span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;user_id&quot;</span>: user_id&#125;<br><span class="hljs-comment"># æŸ¥è¯¢å‚æ•°æ˜¯ï¼ŒæŸ¥è¯¢å‚æ•°æ˜¯é™„åŠ åœ¨ URL åé¢çš„å‚æ•°ï¼Œä½¿ç”¨ ? åˆ†éš” URL å’ŒæŸ¥è¯¢å‚æ•°ï¼Œç„¶åä»¥ key=value çš„å½¢å¼æ·»åŠ åˆ° URL ä¸­ã€‚FastAPI ä¼šè‡ªåŠ¨è§£ææŸ¥è¯¢å‚æ•°ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™å¤„ç†å‡½æ•°ã€‚</span><br><span class="hljs-meta">@app.get(<span class="hljs-params"><span class="hljs-string">&quot;/items/&quot;</span></span>)</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_items</span>(<span class="hljs-params">page: <span class="hljs-built_in">int</span> = <span class="hljs-number">1</span>, limit: <span class="hljs-built_in">int</span> = <span class="hljs-number">10</span></span>):<br>    <span class="hljs-keyword">return</span> &#123;<span class="hljs-string">&quot;page&quot;</span>: page, <span class="hljs-string">&quot;limit&quot;</span>: limit&#125;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç¼–ç¨‹ï¼Œwebå¼€å‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€pythonã€‘è¯»ä¹¦ç¬”è®°ä¹‹æ€§èƒ½æµ‹ç®—å’Œå¤§Oç®—æ³•åˆ†æï¼ˆåä¸‰ï¼‰</title>
    <link href="/2024/01/11/618python%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8B%E6%80%A7%E8%83%BD%E6%B5%8B%E7%AE%97%E5%92%8C%E5%A4%A7O%E7%AE%97%E6%B3%95%E5%88%86%E6%9E%90%EF%BC%88%E5%8D%81%E4%B8%89%EF%BC%89/"/>
    <url>/2024/01/11/618python%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8B%E6%80%A7%E8%83%BD%E6%B5%8B%E7%AE%97%E5%92%8C%E5%A4%A7O%E7%AE%97%E6%B3%95%E5%88%86%E6%9E%90%EF%BC%88%E5%8D%81%E4%B8%89%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬-13-ç« -æ€§èƒ½æµ‹é‡å’Œå¤§Oç®—æ³•åˆ†æ"><a href="#ç¬¬-13-ç« -æ€§èƒ½æµ‹é‡å’Œå¤§Oç®—æ³•åˆ†æ" class="headerlink" title="ç¬¬ 13 ç« ã€€æ€§èƒ½æµ‹é‡å’Œå¤§Oç®—æ³•åˆ†æ"></a>ç¬¬ 13 ç« ã€€æ€§èƒ½æµ‹é‡å’Œå¤§Oç®—æ³•åˆ†æ</h1><blockquote><p>ã€€ã€€å¯¹äºå¤§å¤šæ•°å°å‹ç¨‹åºè€Œè¨€ï¼Œæ€§èƒ½å¯èƒ½æ²¡é‚£ä¹ˆé‡è¦ã€‚æˆ‘ä»¬ä¹Ÿè®¸ä¼šèŠ±ä¸€å°æ—¶æ¥ä¸ºä»»åŠ¡ç¼–å†™ä¸€ä¸ªè‡ªåŠ¨åŒ–è„šæœ¬ï¼Œè€Œè¿™ä¸ªè„šæœ¬åªè¦å‡ ç§’é’Ÿå°±èƒ½è¿è¡Œå®Œã€‚å°±ç®—æ—¶é—´å†é•¿ä¸€äº›ï¼Œä¹Ÿä¸è¿‡æ˜¯æˆ‘ä»¬ç«¯ç€å’–å•¡æ¯å›åˆ°åŠå…¬æ¡Œæ—çš„æ—¶é•¿ã€‚</p></blockquote><p>ã€€ã€€æœ‰äº›æƒ…å†µä¸‹ï¼Œå¯¹äºèŠ±æ—¶é—´å­¦ä¹ å¦‚ä½•æå‡è„šæœ¬é€Ÿåº¦è¦æŒè°¨æ…æ€åº¦ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦å…ˆå­¦ä¹ ç¨‹åºçš„è¿è¡Œé€Ÿåº¦æµ‹é‡æ–¹æ³•ï¼Œå¦åˆ™æ— æ³•çŸ¥é“æ‰€åšçš„ä¿®æ”¹æ˜¯å¦æå‡äº†ç¨‹åºçš„é€Ÿåº¦ã€‚è€Œè¿™å°±æ˜¯Pythonæ¨¡å—<code>timeit</code>å’Œ<code>cProfile</code>çš„ç”¨æ­¦ä¹‹åœ°ã€‚è¿™äº›æ¨¡å—ä¸ä»…å¯ä»¥æµ‹é‡ä»£ç çš„è¿è¡Œé€Ÿåº¦ï¼Œè¿˜ä¼šç”Ÿæˆä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œè¯´æ˜ä»£ç çš„å“ªäº›éƒ¨åˆ†å·²ç»è¶³å¤Ÿå¿«ï¼Œå“ªäº›éƒ¨åˆ†ä»éœ€æ”¹è¿›ã€‚</p><p>ã€€ã€€é™¤äº†æµ‹é‡ç¨‹åºçš„é€Ÿåº¦ï¼Œä½ è¿˜å°†åœ¨æœ¬ç« å­¦ä¹ å¦‚ä½•æµ‹é‡ç†è®ºä¸Šå› ç¨‹åºéœ€è¦å¤„ç†çš„æ•°æ®å¢åŠ ï¼Œç¨‹åºè¿è¡Œæ—¶é—´éšä¹‹å¢åŠ çš„å¢é€Ÿã€‚åœ¨è®¡ç®—æœºç§‘å­¦é¢†åŸŸä¸­ï¼Œå®ƒè¢«ç§°ä¸º<strong>å¤§Oè®°æ³•</strong>ã€‚ç¼ºä¹ä¼ ç»Ÿè®¡ç®—æœºç§‘å­¦èƒŒæ™¯çš„è½¯ä»¶å¼€å‘äººå‘˜å¯èƒ½æœ‰æ—¶ä¼šè§‰å¾—è‡ªå·±çš„çŸ¥è¯†å‚¨å¤‡ä¸å¤Ÿå…¨é¢ã€‚å°½ç®¡è®¡ç®—æœºç§‘å­¦æ•™è‚²é¢‡æœ‰æˆæœï¼Œä½†å¯¹è½¯ä»¶å¼€å‘çš„ç›´æ¥ä½œç”¨å¯èƒ½æœ‰é™ã€‚æˆ‘æ›¾å¼€ç©ç¬‘ï¼ˆä½†ä¹Ÿä¸æ— é“ç†ï¼‰åœ°è¯´ï¼Œå¤§Oè®°æ³•å äº†æˆ‘å­¦ä½ä¸­80%çš„æœ‰ç”¨å†…å®¹ã€‚æœ¬ç« å¯¹è¿™ä¸ªå®ç”¨è¯é¢˜è¿›è¡Œäº†ä»‹ç»ã€‚</p><h2 id="13-1-timeitæ¨¡å—"><a href="#13-1-timeitæ¨¡å—" class="headerlink" title="13.1ã€€timeitæ¨¡å—"></a>13.1ã€€<code>timeit</code>æ¨¡å—</h2><p>ã€€ã€€â€œè¿‡æ—©ä¼˜åŒ–æ˜¯ä¸‡æ¶ä¹‹æºâ€æ˜¯è½¯ä»¶å¼€å‘é¢†åŸŸä¸­çš„ä¸€å¥ä¿—è¯­ã€‚ï¼ˆè¿™å¥è¯ç»å¸¸è¢«è®¤ä¸ºæ˜¯å‡ºè‡ªè®¡ç®—æœºç§‘å­¦å®¶é«˜å¾·çº³ï¼Œä½†ä»–åˆå°†å…¶å½’åŠŸäºè®¡ç®—æœºç§‘å­¦å®¶Tony Hoareã€‚Tony Hoareåˆ™è®¤ä¸ºè¿™å½’åŠŸäºé«˜å¾·çº³ã€‚ï¼‰è¿‡æ—©ä¼˜åŒ–ï¼Œä¹Ÿå°±æ˜¯åœ¨çŸ¥é“å…·ä½“éœ€è¦ä¼˜åŒ–çš„å†…å®¹å‰ç›²ç›®åœ°è¿›è¡Œä¼˜åŒ–ï¼Œå¾€å¾€è¡¨ç°åœ¨ç¨‹åºå‘˜è¯•å›¾é€šè¿‡å·§å¦™çš„æ–¹å¼æ¥èŠ‚çœå†…å­˜æˆ–ç¼–å†™æ›´å¿«çš„ä»£ç ã€‚ä¸€ä¸ªä¾‹å­æ˜¯ä½¿ç”¨XORç®—æ³•æ¥äº¤æ¢ä¸¤ä¸ªæ•´æ•°å€¼ï¼Œè€Œä¸æ˜¯ä½¿ç”¨é¢å¤–çš„ä¸´æ—¶å˜é‡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>a, b = <span class="hljs-number">42</span>, <span class="hljs-number">101</span> <span class="hljs-comment"># è®¾ç½®ä¸¤ä¸ªå˜é‡</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(a, b)<br><span class="hljs-number">42</span> <span class="hljs-number">101</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-comment"># é€šè¿‡ä¸€ç³»åˆ— ^ XORè¿ç®—äº¤æ¢å®ƒä»¬çš„å€¼ï¼š</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>a = a ^ b<br><span class="hljs-meta">&gt;&gt;&gt; </span>b = a ^ b<br><span class="hljs-meta">&gt;&gt;&gt; </span>a = a ^ b<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(a, b) <span class="hljs-comment"># ç›®å‰ä¸¤ä¸ªå€¼å·²ç»è¢«äº¤æ¢äº†</span><br><span class="hljs-number">101</span> <span class="hljs-number">42</span><br></code></pre></td></tr></table></figure><p>ã€€ã€€å¦‚æœä½ ä¸ç†Ÿæ‚‰XORç®—æ³•ï¼ˆè¯¥ç®—æ³•ä½¿ç”¨<code>^</code>ä½è¿ç®—ç¬¦ï¼‰ï¼Œé‚£ä¹ˆè¿™æ®µä»£ç çœ‹èµ·æ¥ä¼šå¾ˆç¥ç§˜ã€‚ä½¿ç”¨å·§å¦™çš„ç¼–ç¨‹æŠ€å·§çš„å¼Šç«¯åœ¨äºå®ƒä¼šäº§ç”Ÿå¤æ‚ã€ä¸å¯è¯»çš„ä»£ç ã€‚æˆ‘ä»¬åº”è¯¥è®°ä½â€œPythonä¹‹ç¦…â€çš„åŸåˆ™ä¹‹ä¸€â€”â€”â€œå¯è¯»æ€§å¾ˆé‡è¦â€ã€‚</p><p>ã€€ã€€æ›´ç³Ÿç³•çš„æ˜¯ï¼Œè¿™å¯èƒ½åªæ˜¯ä½ è‡ªä»¥ä¸ºçš„å·§å¦™ä¹‹ä¸¾ã€‚ä½ ä¸èƒ½æ€»æ˜¯ä¸€æ‹è„‘é—¨å„¿å°±è®¤ä¸ºä¸€ä¸ªç²¾å·§çš„ç¼–ç¨‹æ–¹æ³•æ›´å¿«ï¼Œè€Œå°†è¢«å®ƒå–ä»£çš„æ—§ä»£ç å¾ˆæ…¢ã€‚åªæœ‰æµ‹é‡å¹¶æ¯”è¾ƒè¿è¡Œæ—¶é—´ï¼ˆè¿è¡Œä¸€ä¸ªç¨‹åºæˆ–ä¸€æ®µä»£ç æ‰€éœ€çš„æ—¶é—´ï¼‰æ‰æ˜¯è¯æ˜å¿«é€Ÿä¸å¦çš„å”¯ä¸€æ–¹æ³•ã€‚è¦çŸ¥é“è¿è¡Œæ—¶é—´çš„å¢åŠ æ„å‘³ç€ç¨‹åºåœ¨å˜æ…¢ï¼Œä¹Ÿå°±æ˜¯ç¨‹åºéœ€è¦æ›´å¤šçš„æ—¶é—´æ¥åšåŒæ ·çš„å·¥ä½œã€‚æœ‰ä¸€ä¸ªç±»ä¼¼çš„æ¦‚å¿µï¼Œæˆ‘ä»¬æœ‰æ—¶ä¹Ÿå°†ç¨‹åºçš„è¿è¡Œæ—¶é—´ç®€ç§°ä¸º<strong>è¿è¡Œæ—¶</strong>ï¼ˆruntimeï¼‰ã€‚â€œè¿™ä¸ªé”™è¯¯å‘ç”Ÿåœ¨è¿è¡Œæ—¶â€æ„å‘³ç€é”™è¯¯å‘ç”Ÿåœ¨ç¨‹åºè¿è¡ŒæœŸé—´ï¼Œè€Œéç¨‹åºè¢«ç¼–è¯‘æˆå­—èŠ‚ç æ—¶ã€‚</p><p>ã€€ã€€Pythonæ ‡å‡†åº“çš„<code>timeit</code>æ¨¡å—ä¼šå°†å¾…æµ‹é‡çš„ä¸€å°æ®µä»£ç è¿è¡Œæ•°åƒæ¬¡ï¼Œç”šè‡³æ•°ç™¾ä¸‡æ¬¡ï¼Œä»¥ç¡®å®šå¹³å‡è¿è¡Œæ—¶é—´ã€‚<code>timeit</code>æ¨¡å—è¿˜å¯ä»¥æš‚æ—¶ç¦ç”¨è‡ªåŠ¨åƒåœ¾å›æ”¶å™¨ï¼Œä»¥é¿å…å…¶å¯¹è¿è¡Œæ—¶é—´é€ æˆçš„å·®å¼‚ã€‚å¦‚æœæƒ³æµ‹è¯•å¤šè¡Œä»£ç ï¼Œå¯ä»¥ä¼ é€’ä¸€ä¸ªå¤šè¡Œä»£ç å­—ç¬¦ä¸²ï¼Œæˆ–è€…ä½¿ç”¨åˆ†å·åˆ†éš”å¤šè¡Œä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> timeit<br><span class="hljs-meta">&gt;&gt;&gt; </span>timeit.timeit(<span class="hljs-string">&#x27;a, b = 42, 101; a = a ^ b; b = a ^ b; a = a ^ b&#x27;</span>)<br><span class="hljs-number">0.1307766629999998</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>timeit.timeit(<span class="hljs-string">&quot;&quot;&quot;a, b = 42, 101</span><br><span class="hljs-string"><span class="hljs-meta">... </span>a = a ^ b</span><br><span class="hljs-string"><span class="hljs-meta">... </span>b = a ^ b</span><br><span class="hljs-string"><span class="hljs-meta">... </span>a = a ^ b&quot;&quot;&quot;</span>)<br><span class="hljs-number">0.13515726800000039</span><br></code></pre></td></tr></table></figure><p>ã€€ã€€åœ¨æˆ‘çš„è®¡ç®—æœºä¸Šï¼ŒXORç®—æ³•è¿è¡Œè¿™æ®µä»£ç åªéœ€è¦å¤§çº¦0.1ç§’ï¼Œè¿™ä¸ªé€Ÿåº¦å¤Ÿå¿«å—ï¼Ÿæ¥å’Œä½¿ç”¨é¢å¤–ä¸´æ—¶å˜é‡çš„æ•´æ•°äº¤æ¢ä»£ç å¯¹æ¯”ä¸€ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> timeit<br><span class="hljs-meta">&gt;&gt;&gt; </span>timeit.timeit(<span class="hljs-string">&#x27;a, b = 42, 101; temp = a; a = b; b = temp&#x27;</span>)<br><span class="hljs-number">0.027540389999998638</span><br></code></pre></td></tr></table></figure><p>ã€€ã€€å‡ºä¹æ„æ–™å§ï¼Ÿä½¿ç”¨é¢å¤–å˜é‡ä¸ä»…å¯è¯»æ€§æ›´å¥½ï¼Œè€Œä¸”é€Ÿåº¦ä¹Ÿå¿«äº†ä¸¤å€ã€‚å·§å¦™çš„XORæŠ€å·§å¯èƒ½ä¼šèŠ‚çœå‡ å­—èŠ‚çš„å†…å­˜ï¼Œä½†ä»£ä»·æ˜¯å‡æ…¢äº†é€Ÿåº¦å¹¶é™ä½äº†ä»£ç å¯è¯»æ€§ã€‚ç‰ºç‰²ä»£ç çš„å¯è¯»æ€§æ¥å‡å°‘å‡ å­—èŠ‚çš„å†…å­˜ä½¿ç”¨æˆ–è€…çº³ç§’çº§åˆ«çš„è¿è¡Œæ—¶é—´å¹¶ä¸å€¼å½“ã€‚</p><p>ã€€ã€€æ›´å¥½çš„åšæ³•æ˜¯ä½¿ç”¨å¤šé‡èµ‹å€¼æŠ€å·§äº¤æ¢ä¸¤ä¸ªå˜é‡ï¼Œä¹Ÿå«ä½œè¿­ä»£è§£åŒ…ã€‚å®ƒçš„é€Ÿåº¦æ›´å¿«ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>timeit.timeit(<span class="hljs-string">&#x27;a, b = 42, 101; a, b = b, a&#x27;</span>)<br><span class="hljs-number">0.024489236000007963</span><br></code></pre></td></tr></table></figure><p>å®ƒåœ¨å¯è¯»æ€§å’Œé€Ÿåº¦ä¸¤æ–¹é¢éƒ½æ˜¯æœ€å¥½çš„ã€‚è¿™ä¸ªç»“è®ºä¸æ˜¯æ‹è„‘é—¨å„¿æƒ³å‡ºæ¥çš„ï¼Œè€Œæ˜¯å‡ºäºå®¢è§‚çš„æµ‹é‡ã€‚</p><p>ã€€ã€€<code>timeit.timeit()</code>å‡½æ•°ä¹Ÿå¯ä»¥æ¥å—ç¬¬äºŒä¸ªå­—ç¬¦ä¸²ç±»å‹å‚æ•°ï¼Œç”¨ä½œåˆå§‹åŒ–ä»£ç ã€‚åˆå§‹åŒ–ä»£ç ä»…åœ¨æœ€åˆè¿è¡Œä¸€æ¬¡ã€‚ä¹Ÿå¯ä»¥ä¼ é€’ä¸€ä¸ªæ•´æ•°ä½œä¸ºæ•°å­—å…³é”®å­—å‚æ•°æ”¹å˜é»˜è®¤çš„è¯•éªŒæ¬¡æ•°ã€‚æ¯”å¦‚ï¼Œä¸‹é¢çš„æµ‹è¯•æµ‹é‡äº†Pythonçš„<code>random</code>æ¨¡å—ç”Ÿæˆ10 000 000ä¸ª1åˆ°100çš„éšæœºæ•°éœ€è¦å¤šé•¿æ—¶é—´ï¼ˆåœ¨æˆ‘çš„è®¡ç®—æœºä¸Šéœ€è¦å¤§çº¦10ç§’ï¼‰ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>timeit.timeit(<span class="hljs-string">&#x27;random.randint(1, 100)&#x27;</span>, <span class="hljs-string">&#x27;import random&#x27;</span>, number=<span class="hljs-number">10000000</span>)<br><span class="hljs-number">10.020913950999784</span><br></code></pre></td></tr></table></figure><p>ã€€ã€€é»˜è®¤æƒ…å†µä¸‹ï¼Œä¼ é€’ç»™<code>timeit.timeit()</code>çš„ä»£ç å­—ç¬¦ä¸²ä¸èƒ½è®¿é—®ç¨‹åºå…¶ä»–éƒ¨åˆ†çš„å˜é‡å’Œå‡½æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> timeit<br><span class="hljs-meta">&gt;&gt;&gt; </span>spam = <span class="hljs-string">&#x27;hello&#x27;</span> <span class="hljs-comment"># å®šä¹‰spamå˜é‡</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>timeit.timeit(<span class="hljs-string">&#x27;print(spam)&#x27;</span>, number=<span class="hljs-number">1</span>) <span class="hljs-comment"># æµ‹é‡æ‰“å°spamçš„æ—¶é—´</span><br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>  File <span class="hljs-string">&quot;C:\Users\Al\AppData\Local\Programs\Python\Python37\lib\timeit.py&quot;</span>,<br>line <span class="hljs-number">232</span>, <span class="hljs-keyword">in</span> timeit<br>    <span class="hljs-keyword">return</span> Timer(stmt, setup, timer, <span class="hljs-built_in">globals</span>).timeit(number)<br>  File <span class="hljs-string">&quot;C:\Users\Al\AppData\Local\Programs\Python\Python37\lib\timeit.py&quot;</span>,<br>line <span class="hljs-number">176</span>, <span class="hljs-keyword">in</span> timeit<br>    timing = self.inner(it, self.timer)<br>  File <span class="hljs-string">&quot;&lt;timeit-src&gt;&quot;</span>, line <span class="hljs-number">6</span>, <span class="hljs-keyword">in</span> inner<br>NameError: name <span class="hljs-string">&#x27;spam&#x27;</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> defined<br></code></pre></td></tr></table></figure><p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥å°†<code>globals()</code>1çš„è¿”å›å€¼ä½œä¸º<code>globals</code>å…³é”®å­—å‚æ•°ï¼š</p><p>1Pythonå†…ç½®å‡½æ•°çš„ä½œç”¨æ˜¯ä»¥å­—å…¸ç±»å‹è¿”å›å…¨éƒ¨å…¨å±€å˜é‡ã€‚â€”â€”è¯‘è€…æ³¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>timeit.timeit(<span class="hljs-string">&#x27;print(spam)&#x27;</span>, number=<span class="hljs-number">1</span>, <span class="hljs-built_in">globals</span>=<span class="hljs-built_in">globals</span>())<br>hello<br><span class="hljs-number">0.000994909999462834</span><br></code></pre></td></tr></table></figure><p>ã€€ã€€ç¼–å†™ä»£ç çš„ä¸€ä¸ªæœ‰æ•ˆå‡†åˆ™æ˜¯å…ˆè®©å®ƒè·‘èµ·æ¥ï¼Œå†è®©å®ƒå¿«èµ·æ¥ã€‚åªæœ‰å½“ä½ æœ‰äº†ä¸€ä¸ªèƒ½ç”¨çš„ç¨‹åºåï¼Œä½ æ‰éœ€è¦ä¸“æ³¨äºå®ƒçš„æ•ˆç‡ï¼Œè®©å®ƒå˜å¾—æ›´é«˜æ•ˆã€‚</p><h2 id="13-2-cProfileåˆ†æå™¨"><a href="#13-2-cProfileåˆ†æå™¨" class="headerlink" title="13.2ã€€cProfileåˆ†æå™¨"></a>13.2ã€€<code>cProfile</code>åˆ†æå™¨</h2><p>ã€€ã€€<code>timeit</code>æ¨¡å—å¯¹æµ‹é‡å°çš„ä»£ç ç‰‡æ®µå¾ˆæœ‰æ•ˆï¼Œä½†<code>cProfile</code>æ¨¡å—åœ¨åˆ†ææ•´ä¸ªå‡½æ•°æˆ–ç¨‹åºæ—¶æ›´å…·ä¼˜åŠ¿ã€‚</p><p>ã€€ã€€ç¨‹åºåˆ†æå¯ä»¥ç³»ç»Ÿæ€§åœ°åˆ†æç¨‹åºçš„è¿è¡Œé€Ÿåº¦ã€å†…å­˜ä½¿ç”¨æƒ…å†µç­‰ã€‚<code>cProfile</code>æ¨¡å—æ˜¯Pythonçš„åˆ†æå™¨ï¼Œç”¨äºæµ‹é‡ç¨‹åºçš„è¿è¡Œæ—¶é—´å’Œç¨‹åºå†…å„ä¸ªå‡½æ•°è°ƒç”¨æ¶ˆè€—çš„æ—¶é—´ã€‚è¿™äº›ä¿¡æ¯ä¸ºä»£ç æä¾›äº†æ›´ç»†ç²’åº¦çš„æµ‹é‡ç»“æœã€‚</p><p>ã€€ã€€è¦ä½¿ç”¨<code>cProfile</code>åˆ†æå™¨ï¼Œè¯·å°†å¾…æµ‹é‡çš„ä»£ç ä¸²ä¼ é€’ç»™<code>cProfile.run()</code>ã€‚æ¥çœ‹çœ‹<code>cProfile</code>æ˜¯å¦‚ä½•æµ‹é‡å’ŒæŠ¥å‘Šä¸€ä¸ªçŸ­å‡½æ•°çš„æ‰§è¡Œæƒ…å†µçš„ã€‚è¯¥å‡½æ•°çš„ä½œç”¨æ˜¯å°†1åˆ°1 000 000çš„æ•°å­—è¿›è¡Œæ±‚å’Œè¿ç®—ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time, cProfile<br><span class="hljs-keyword">def</span> <span class="hljs-title function_">addUpNumbers</span>():<br>    total = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1000001</span>):<br>        total += i<br><br>cProfile.run(<span class="hljs-string">&#x27;addUpNumbers()&#x27;</span>)<br></code></pre></td></tr></table></figure><p>è¿è¡Œè¯¥ç¨‹åºå¾—åˆ°çš„è¾“å‡ºæ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">      <span class="hljs-number">4</span> function calls <span class="hljs-keyword">in</span> <span class="hljs-number">0.064</span> seconds<br><br>Ordered by: standard name<br><br>ncalls  tottime  percall  cumtime  percall filename:lineno(function)<br>     <span class="hljs-number">1</span>    <span class="hljs-number">0.000</span>    <span class="hljs-number">0.000</span>    <span class="hljs-number">0.064</span>    <span class="hljs-number">0.064</span> &lt;string&gt;:<span class="hljs-number">1</span>(&lt;module&gt;)<br>     <span class="hljs-number">1</span>    <span class="hljs-number">0.064</span>    <span class="hljs-number">0.064</span>    <span class="hljs-number">0.064</span>    <span class="hljs-number">0.064</span> test1.py:<span class="hljs-number">2</span>(addUpNumbers)<br>     <span class="hljs-number">1</span>    <span class="hljs-number">0.000</span>    <span class="hljs-number">0.000</span>    <span class="hljs-number">0.064</span>    <span class="hljs-number">0.064</span> &#123;built-<span class="hljs-keyword">in</span> method builtins.<span class="hljs-built_in">exec</span>&#125;<br>     <span class="hljs-number">1</span>    <span class="hljs-number">0.000</span>    <span class="hljs-number">0.000</span>    <span class="hljs-number">0.000</span>    <span class="hljs-number">0.000</span> &#123;method <span class="hljs-string">&#x27;disable&#x27;</span> of <span class="hljs-string">&#x27;_lsprof.Profiler&#x27;</span> objects&#125;<br></code></pre></td></tr></table></figure><p>ã€€ã€€æ¯ä¸€è¡Œæ ‡æ³¨äº†ä¸åŒçš„å‡½æ•°èŠ±è´¹çš„æ—¶é—´ã€‚<code>cProfile.run()</code>çš„è¾“å‡ºä¸­çš„åˆ—çš„è§£é‡Šå¦‚ä¸‹ã€‚</p><ul><li>**<code>ncalls</code>**ï¼šå¯¹å‡½æ•°çš„è°ƒç”¨æ¬¡æ•°ã€‚</li><li>**<code>tottime</code>**ï¼šè¯¥å‡½æ•°èŠ±è´¹çš„æ€»æ—¶é—´ï¼Œæ³¨æ„ä¸åŒ…æ‹¬åœ¨å­å‡½æ•°ä¸­èŠ±è´¹çš„æ—¶é—´ã€‚</li><li>**<code>percall</code>**ï¼š<code>tottime</code>é™¤ä»¥è°ƒç”¨æ¬¡æ•°ã€‚</li><li>**<code>cumtime</code>**ï¼šåœ¨è¯¥å‡½æ•°åŠå…¶å­å‡½æ•°å†…èŠ±è´¹çš„ç´¯è®¡æ—¶é—´ã€‚</li><li>**<code>percall</code>**2ï¼š<code>cumtime</code>é™¤ä»¥è°ƒç”¨æ¬¡æ•°ã€‚</li><li>**<code>filename:lineno(function)</code>**ï¼šè¯¥å‡½æ•°æ‰€åœ¨çš„æ–‡ä»¶åŠè¡Œå·ã€‚</li></ul><p>2æ³¨æ„è¿™ä¸ªåå­—è·Ÿå‰é¢ä¸€æ ·ï¼Œå¹¶éå­˜åœ¨é”™è¯¯ã€‚â€”â€”è¯‘è€…æ³¨</p><p>ã€€ã€€æ¯”å¦‚ï¼Œä½ å¯ä»¥ä»No Starchçš„ç½‘ç«™ä¸Šä¸‹è½½rsaCipher.pyå’Œal_sweigart_pubkey.txtã€‚è¿™ä¸ªRSAå¯†ç ç¨‹åºåœ¨ã€ŠPythonå¯†ç å­¦ç¼–ç¨‹ã€‹ä¸­æœ‰æ‰€æåŠã€‚åœ¨äº¤äº’å¼shellä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼Œä»¥åˆ†æ<code>encryptAndWriteToFile()</code>å‡½æ•°å¯¹ç”±<code>&#39;abc&#39;*100000</code>è¡¨è¾¾å¼åˆ›å»ºçš„30ä¸‡ä¸ªå­—ç¬¦é•¿çš„ä¿¡æ¯çš„åŠ å¯†è¿‡ç¨‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> cProfile, rsaCipher<br><span class="hljs-meta">&gt;&gt;&gt; </span>cProfile.run(<span class="hljs-string">&quot;rsaCipher.encryptAndWriteToFile(&#x27;encrypted_file.txt&#x27;, &#x27;al_sweigart_pubkey. txt&#x27;, &#x27;abc&#x27;*100000)&quot;</span>)<br>         <span class="hljs-number">11749</span> function calls <span class="hljs-keyword">in</span> <span class="hljs-number">28.900</span> seconds<br><br>   Ordered by: standard name<br><br>   ncalls  tottime  percall  cumtime  percall filename:lineno(function)<br>        <span class="hljs-number">1</span>    <span class="hljs-number">0.001</span>    <span class="hljs-number">0.001</span>   <span class="hljs-number">28.900</span>   <span class="hljs-number">28.900</span> &lt;string&gt;:<span class="hljs-number">1</span>(&lt;module&gt;)<br>        <span class="hljs-number">2</span>    <span class="hljs-number">0.000</span>    <span class="hljs-number">0.000</span>    <span class="hljs-number">0.000</span>    <span class="hljs-number">0.000</span> _bootlocale.py:<span class="hljs-number">11</span>(getpreferredencoding)<br>--snip--<br>        <span class="hljs-number">1</span>    <span class="hljs-number">0.017</span>    <span class="hljs-number">0.017</span>   <span class="hljs-number">28.900</span>   <span class="hljs-number">28.900</span> rsaCipher.py:<span class="hljs-number">104</span>(encryptAndWriteToFile)<br>        <span class="hljs-number">1</span>    <span class="hljs-number">0.248</span>    <span class="hljs-number">0.248</span>    <span class="hljs-number">0.249</span>    <span class="hljs-number">0.249</span> rsaCipher.py:<span class="hljs-number">36</span>(getBlocksFromText)<br>        <span class="hljs-number">1</span>    <span class="hljs-number">0.006</span>    <span class="hljs-number">0.006</span>   <span class="hljs-number">28.873</span>   <span class="hljs-number">28.873</span> rsaCipher.py:<span class="hljs-number">70</span>(encryptMessage)<br>        <span class="hljs-number">1</span>    <span class="hljs-number">0.000</span>    <span class="hljs-number">0.000</span>    <span class="hljs-number">0.000</span>    <span class="hljs-number">0.000</span> rsaCipher.py:<span class="hljs-number">94</span>(readKeyFile)<br>--snip--<br>     <span class="hljs-number">2347</span>    <span class="hljs-number">0.000</span>    <span class="hljs-number">0.000</span>    <span class="hljs-number">0.000</span>    <span class="hljs-number">0.000</span> &#123;built-<span class="hljs-keyword">in</span> method builtins.<span class="hljs-built_in">len</span>&#125;<br>     <span class="hljs-number">2344</span>    <span class="hljs-number">0.000</span>    <span class="hljs-number">0.000</span>    <span class="hljs-number">0.000</span>    <span class="hljs-number">0.000</span> &#123;built-<span class="hljs-keyword">in</span> method builtins.<span class="hljs-built_in">min</span>&#125;<br>     <span class="hljs-number">2344</span>   <span class="hljs-number">28.617</span>    <span class="hljs-number">0.012</span>   <span class="hljs-number">28.617</span>    <span class="hljs-number">0.012</span> &#123;built-<span class="hljs-keyword">in</span> method builtins.<span class="hljs-built_in">pow</span>&#125;<br>        <span class="hljs-number">2</span>    <span class="hljs-number">0.001</span>    <span class="hljs-number">0.000</span>    <span class="hljs-number">0.001</span>    <span class="hljs-number">0.000</span> &#123;built-<span class="hljs-keyword">in</span> method io.<span class="hljs-built_in">open</span>&#125;<br>     <span class="hljs-number">4688</span>    <span class="hljs-number">0.001</span>    <span class="hljs-number">0.000</span>    <span class="hljs-number">0.001</span>    <span class="hljs-number">0.000</span> &#123;method <span class="hljs-string">&#x27;append&#x27;</span> of <span class="hljs-string">&#x27;list&#x27;</span> objects&#125;<br>--snip--<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œä¼ é€’ç»™å‡½æ•°<code>cProfile.run()</code>çš„ä»£ç å…±è¿è¡Œäº†28.9ç§’ã€‚æ³¨æ„è¿™ä¸ªç¤ºä¾‹ä¸­è¿è¡Œæ€»æ—¶é—´æœ€å¤šçš„å‡½æ•°ã€‚Pythonå†…ç½®å‡½æ•°<code>pow()</code>èŠ±äº†28.617ç§’ï¼Œå‡ ä¹ç­‰äºæ€»è€—æ—¶ï¼æˆ‘ä»¬æ²¡æ³•æ”¹å˜<code>pow()</code>çš„ä»£ç ï¼ˆå› ä¸ºå®ƒæ˜¯Pythonçš„å†…ç½®å‡½æ•°ï¼‰ï¼Œä½†ä¹Ÿè®¸å¯ä»¥æ”¹å˜ç¨‹åºçš„ä»£ç ä»¥å‡å°‘å¯¹å®ƒçš„è°ƒç”¨ã€‚</p><p>ã€€ã€€åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œè¿™æ˜¯ä¸å¯èƒ½çš„ï¼Œå› ä¸ºrsaCipher.pyå·²ç»ç»è¿‡å……åˆ†çš„ä¼˜åŒ–ã€‚ä¸è¿‡å¯¹è¿™æ®µä»£ç çš„åˆ†æè¿˜æ˜¯è®©æˆ‘ä»¬äº†è§£åˆ°<code>pow()</code>æ˜¯ä¸»è¦ç“¶é¢ˆã€‚å› æ­¤ï¼Œè¯•å›¾æ”¹è¿›<code>readKeyFile()</code>ç­‰å‡½æ•°ï¼ˆè¯¥å‡½æ•°çš„è¿è¡Œæ—¶é—´å¾ˆçŸ­ï¼Œ<code>cProfile</code>å°†å…¶æ—¶é—´æŠ¥å‘Šä¸º0ï¼‰æ˜¯æ²¡æœ‰æ„ä¹‰çš„ã€‚</p><p>ã€€ã€€<strong>é˜¿å§†è¾¾å°”å®šå¾‹</strong>ï¼ˆAmdahlâ€™s Lawï¼‰ä½“ç°äº†è¿™ä¸€æ€æƒ³ï¼Œå…¶è®¡ç®—äº†å…¶ä¸­ä¸€ä¸ªç»„ä»¶å¾—åˆ°æ”¹è¿›çš„æƒ…å†µä¸‹å¯¹æ•´ä¸ªç¨‹åºçš„è¿è¡Œé€Ÿåº¦çš„å¢ç›Šã€‚è¯¥å…¬å¼ä¸º<code>æ•´ä¸ªä»»åŠ¡çš„é€Ÿåº¦=1/((1-p)+(p/s))</code>ï¼Œå…¶ä¸­<code>s</code>æ˜¯ä¸€ä¸ªç»„ä»¶çš„é€Ÿåº¦æå‡ï¼Œ<code>p</code>æ˜¯è¯¥ç»„ä»¶åœ¨æ•´ä¸ªç¨‹åºä¸­çš„æ¯”ä¾‹ã€‚æ¯”å¦‚å°†ä¸€ä¸ªåœ¨ç¨‹åºä¸­å æ€»è¿è¡Œæ—¶é—´90%çš„ç»„ä»¶é€Ÿåº¦æå‡ä¸€å€ï¼Œç»“æœæ˜¯<code>1/((1-0.9)+(0.9/2)) = 1.818</code>ï¼Œä¹Ÿå°±æ˜¯è¯´æ•´ä¸ªç¨‹åºçš„é€Ÿåº¦æå‡äº†çº¦82%ã€‚è¿™æ¯”å°†ä¸€ä¸ªåªå æ€»è¿è¡Œæ—¶é—´25%çš„ç»„ä»¶çš„é€Ÿåº¦æå‡3å€è¦å¥½ï¼Œå®ƒçš„ç»“æœæ˜¯<code>1/((1-0.25)+(0.25/2))=1.143</code>ï¼Œä¹Ÿå°±æ˜¯æ•´ä½“é€Ÿåº¦æå‡äº†çº¦14%ã€‚ä½ ä¸éœ€è¦èƒŒæ•´ä¸ªå…¬å¼ï¼Œåªè¦è®°ä½å°†ä»£ç ä¸­è¿è¡Œæ—¶é—´é•¿çš„ä»£ç é€Ÿåº¦æå‡ä¸€å€ï¼Œè¦æ¯”å°†å·²ç»å¤Ÿå¿«çš„ä»£ç é€Ÿåº¦æå‡ä¸€å€æ›´æœ‰æ•ˆã€‚è¿™æ˜¯ä¸€ä¸ªå¸¸è¯†ï¼šæ˜‚è´µçš„æˆ¿å­æ‰“9æŠ˜è¦æ¯”ä¾¿å®œçš„é‹å­æ‰“9æŠ˜æ›´æœ‰è¯±æƒ‘åŠ›ã€‚</p><h2 id="13-3-å¤§Oç®—æ³•åˆ†æ"><a href="#13-3-å¤§Oç®—æ³•åˆ†æ" class="headerlink" title="13.3ã€€å¤§Oç®—æ³•åˆ†æ"></a>13.3ã€€å¤§Oç®—æ³•åˆ†æ</h2><p>ã€€ã€€å¤§Oæ˜¯ä¸€ç§ç®—æ³•åˆ†æå½¢å¼ï¼Œå®ƒæè¿°äº†ä»£ç å¦‚ä½•åº”å¯¹å¤„ç†è§„æ¨¡çš„å¢é•¿ã€‚å®ƒå°†ä»£ç åˆ†ä¸ºå‡ ä¸ªç­‰çº§ï¼Œç¬¼ç»Ÿåœ°æè¿°ä»£ç çš„è¿è¡Œæ—¶é—´éšç€å¤„ç†å·¥ä½œé‡çš„å¢åŠ è€Œéœ€è¦å¢åŠ çš„æ—¶é—´ã€‚Pythonå¼€å‘è€…Ned Batchelderå°†å¤§Oæè¿°ä¸ºå¯¹â€œä»£ç å¦‚ä½•éšç€æ•°æ®å¢é•¿è€Œå˜æ…¢â€çš„åˆ†æã€‚è¿™ä¹Ÿæ˜¯ä»–åœ¨PyCon 2018ä¸Šçš„æ¼”è®²ä¸»é¢˜ã€‚</p><p>ã€€ã€€å‡è®¾è¿™æ ·ä¸€ä¸ªæƒ…æ™¯ï¼šä½ æœ‰ä¸€äº›å·¥ä½œéœ€è¦ä¸€å°æ—¶æ‰èƒ½å®Œæˆï¼Œå¦‚æœå·¥ä½œé‡å¢åŠ ä¸€å€ï¼Œéœ€è¦èŠ±å¤šå°‘æ—¶é—´æ‰èƒ½å®Œæˆå·¥ä½œï¼Ÿä½ å¯èƒ½ä¼šè¯´ä¸¤å°æ—¶ï¼Œä½†å®é™…ä¸Šç­”æ¡ˆå–å†³äºå·¥ä½œçš„ç±»å‹ã€‚</p><p>ã€€ã€€å¦‚æœè¯»ä¸€æœ¬è–„ä¹¦éœ€è¦ä¸€å°æ—¶ï¼Œé‚£ä¹ˆè¯»ä¸¤æœ¬è–„ä¹¦å¤§æ¦‚å°±è¦ä¸¤å°æ—¶ã€‚å¦‚æœä½ èƒ½åœ¨ä¸€å°æ—¶å†…å°†500æœ¬ä¹¦æŒ‰ç…§ä¹¦åçš„å­—æ¯é¡ºåºæ’åˆ—ï¼Œå°†1000æœ¬ä¹¦æŒ‰ç…§å­—æ¯é¡ºåºæ’åˆ—èŠ±è´¹çš„æ—¶é—´å°±ä¸æ­¢ä¸¤å°æ—¶ï¼Œå› ä¸ºä½ å¿…é¡»åœ¨æ›´å¤§çš„å›¾ä¹¦é›†åˆä¸­ä¸ºæ¯æœ¬ä¹¦æ‰¾åˆ°æ­£ç¡®çš„ä½ç½®ã€‚å¦‚æœå·¥ä½œåªæ˜¯æ£€æŸ¥ä¹¦æ¶æ˜¯å¦æ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆä¹¦æ¶ä¸Šæ— è®ºæœ‰0æœ¬ã€10æœ¬è¿˜æ˜¯1000æœ¬éƒ½æ— æ‰€è°“ã€‚åªè¦çœ‹ä¸€çœ¼å°±ä¼šç«‹åˆ»çŸ¥é“ç­”æ¡ˆã€‚æ— è®ºæœ‰å¤šå°‘æœ¬ä¹¦ï¼Œéœ€è¦çš„æ—¶é—´éƒ½æ˜¯å·®ä¸å¤šçš„ã€‚å°½ç®¡ä¸åŒçš„äººåœ¨é˜…è¯»æˆ–è€…ç¼–æ’å­—æ¯æ—¶çš„é€Ÿåº¦å­˜åœ¨ä¸ªä½“å·®å¼‚ï¼Œä½†æ€»ä½“æ¥è¯´è¶‹åŠ¿æ˜¯ä¸€æ ·çš„ã€‚</p><p>ã€€ã€€ç®—æ³•çš„å¤§Oæè¿°äº†è¿™ç§è¶‹åŠ¿ã€‚å¤§Oæè¿°ç®—æ³•çš„æ€»ä½“è¡¨ç°ä¸æ‰§è¡Œè¯¥ç®—æ³•çš„å®é™…ç¡¬ä»¶é€Ÿåº¦çš„å¿«æ…¢æ— å…³ã€‚å¤§Oä¸ä½¿ç”¨ä»»ä½•å…·ä½“çš„å•ä½ï¼ˆæ¯”å¦‚ç§’æˆ–è€…CPUå‘¨æœŸ)æ¥æè¿°ç®—æ³•çš„è¿è¡Œæ—¶é—´ï¼Œå› ä¸ºè¿è¡Œæ—¶é—´åœ¨ä¸åŒçš„è®¡ç®—æœºæˆ–ç¼–ç¨‹è¯­è¨€ä¹‹é—´ä¼šæœ‰å·®å¼‚ã€‚</p><h2 id="13-4-å¤§Oé˜¶"><a href="#13-4-å¤§Oé˜¶" class="headerlink" title="13.4ã€€å¤§Oé˜¶"></a>13.4ã€€å¤§Oé˜¶</h2><p>ã€€ã€€å¤§Oè®°æ³•é€šå¸¸æœ‰ä»¥ä¸‹å‡ ä¸ªç­‰çº§ï¼Œå®ƒä»¬çš„é¡ºåºæ˜¯ä»ä½åˆ°é«˜ï¼Œä¹Ÿå°±æ˜¯ä»éšç€æ•°æ®é‡å¢é•¿é€Ÿåº¦å‡æ…¢æœ€å°‘çš„ä»£ç åˆ°é€Ÿåº¦å‡æ…¢æœ€å¤šçš„ä»£ç ï¼š</p><p>ã€€ã€€(1) O(1)ï¼Œæ’å®šæ—¶é—´ï¼ˆæœ€ä½)</p><p>ã€€ã€€(2) O(\log n)ï¼Œå¯¹æ•°æ—¶é—´</p><p>ã€€ã€€(3) O(n)ï¼Œçº¿æ€§æ—¶é—´</p><p>ã€€ã€€(4) O(n\log n)ï¼ŒN-Log-Næ—¶é—´</p><p>ã€€ã€€(5) O(n^2)ï¼Œå¤šé¡¹å¼æ—¶é—´</p><p>ã€€ã€€(6) O(2^n)ï¼ŒæŒ‡æ•°æ—¶é—´</p><p>ã€€ã€€(7) O(n!)ï¼Œé˜¶ä¹˜æ—¶é—´ï¼ˆæœ€é«˜ï¼‰</p><p>ã€€ã€€æ³¨æ„ï¼Œå¤§Oé˜¶ä½¿ç”¨äº†ä»¥ä¸‹ç¬¦å·ï¼šä¸€ä¸ªå¤§å†™çš„Oï¼Œåé¢æ˜¯ä¸€å¯¹å°æ‹¬å·ï¼Œæ‹¬å·ä¸­æ˜¯å¯¹é˜¶æ•°çš„æè¿°ã€‚å¤§å†™çš„Oè¡¨ç¤º<strong>é˜¶æ•°</strong>ï¼ˆorderï¼‰ã€‚nè¡¨ç¤ºä»£ç è¦å¤„ç†çš„è¾“å…¥æ•°æ®çš„å¤§å°ã€‚</p><p>ã€€ã€€ä½¿ç”¨å¤§Oè®°æ³•æ— é¡»ç†è§£å¯¹æ•°ã€å¤šé¡¹å¼ç­‰è¯çš„ç²¾ç¡®çš„æ•°å­¦æ„ä¹‰ã€‚ä¸‹ä¸€èŠ‚å°†è¯¦ç»†æè¿°è¿™äº›é˜¶æ•°ï¼Œè¿™é‡Œå…ˆç»™å‡ºç®€åŒ–çš„è§£é‡Šï¼š</p><ul><li>O(1)ç®—æ³•å’ŒO(\log n)ç®—æ³•å¾ˆå¿«ï¼›</li><li>O(n)ç®—æ³•å’ŒO(n\log n)]ç®—æ³•è¿˜ä¸é”™ï¼›</li><li>O(n^2)ç®—æ³•ã€O(2^n)ç®—æ³•å’ŒO(n!)ç®—æ³•å¾ˆæ…¢ã€‚</li></ul><p>ã€€ã€€å½“ç„¶ä½ å¯ä»¥æ‰¾å‡ºåä¾‹ï¼Œä½†å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä¸Šè¿°ç»“è®ºæ˜¯å¯¹çš„ã€‚è¿˜æœ‰å¾ˆå¤šå¤§Oé˜¶æœªè¢«åˆ—å‡ºï¼Œè¿™é‡Œç»™å‡ºçš„æ˜¯æœ€å¸¸ç”¨çš„ã€‚ç°åœ¨é€ä¸ªçœ‹çœ‹æ¯ä¸ªé˜¶æ•°æ‰€æè¿°çš„ä»»åŠ¡ç§ç±»ã€‚</p><h3 id="13-4-1-ä½¿ç”¨ä¹¦æ¶æ‰“æ¯”æ–¹æè¿°å¤§Oé˜¶"><a href="#13-4-1-ä½¿ç”¨ä¹¦æ¶æ‰“æ¯”æ–¹æè¿°å¤§Oé˜¶" class="headerlink" title="13.4.1ã€€ä½¿ç”¨ä¹¦æ¶æ‰“æ¯”æ–¹æè¿°å¤§Oé˜¶"></a>13.4.1ã€€ä½¿ç”¨ä¹¦æ¶æ‰“æ¯”æ–¹æè¿°å¤§Oé˜¶</h3><p>ã€€ã€€åœ¨ä¸‹é¢çš„å¤§Oé˜¶ä¾‹å­ä¸­ï¼Œæˆ‘å°†ç»§ç»­ä½¿ç”¨ä¹¦æ¶çš„æ¯”å–»ã€‚næŒ‡çš„æ˜¯ä¹¦æ¶ä¸Šçš„ä¹¦çš„æ•°é‡ï¼Œå¤§Oé˜¶æè¿°äº†éšç€ä¹¦çš„æ•°é‡çš„å¢åŠ ï¼Œå„ç§ä»»åŠ¡æ‰€èŠ±è´¹çš„æ—¶é—´æ˜¯å¦‚ä½•å¢åŠ çš„ã€‚</p><ol><li><p><strong>O(1)ï¼Œæ’å®šæ—¶é—´</strong></p><p>æ‰¾åˆ°â€œä¹¦æ¶æ˜¯å¦æ˜¯ç©ºçš„â€çš„ç­”æ¡ˆæ˜¯æ’å®šæ—¶é—´çš„æ“ä½œã€‚ä¹¦æ¶ä¸Šåˆ°åº•æœ‰å¤šå°‘ä¹¦å¹¶ä¸é‡è¦ï¼Œåªè¦çœ‹ä¸€çœ¼å°±èƒ½åˆ¤æ–­ä¹¦æ¶æ˜¯å¦æ˜¯ç©ºçš„ã€‚åšå‡ºè¿™ä¸ªåˆ¤æ–­æ‰€ç”¨çš„æ—¶é—´ä¸ä¹¦çš„æ•°é‡å¤šå°‘æ— å…³ï¼Œå› ä¸ºåªè¦çœ‹åˆ°ä¹¦æ¶ä¸Šæœ‰ä¸€æœ¬ä¹¦ï¼Œå°±å¯ä»¥åœæ­¢å¯»æ‰¾äº†ã€‚å› ä¸ºnå€¼ä¸æ‰§è¡Œä»»åŠ¡çš„æ—¶é—´æ— å…³ï¼Œæ‰€ä»¥O(1)ä¸­å¹¶ä¸åŒ…å«nã€‚æœ‰æ—¶ï¼Œæ’å®šæ—¶é—´ä¹Ÿè¢«å†™ä½œO(c)ã€‚</p></li><li><p><strong>O(\log n)ï¼Œå¯¹æ•°æ—¶é—´</strong></p><p>å¯¹æ•°æ˜¯æŒ‡æ•°çš„é€†è¿ç®—ï¼šæŒ‡æ•°[2^4ï¼Œä¹Ÿå°±æ˜¯2 Ã— 2 Ã— 2 Ã— 2ï¼Œç­‰äº16ã€‚è€Œå¯¹æ•° log_2(16ï¼ˆè¯»ä½œä»¥2ä¸ºåº•16çš„å¯¹æ•°ï¼‰ç­‰äº4ã€‚åœ¨ç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨2ä½œä¸ºå¯¹æ•°åŸºæ•°ï¼Œæ‰€ä»¥å°†O(\log_2nç®€å†™ä¸ºO(\log n)ã€‚</p><p>åœ¨ä¸€ä¸ªæŒ‰ç…§å­—æ¯é¡ºåºæ’åˆ—çš„ä¹¦æ¶ä¸Šæœç´¢æŸæœ¬ä¹¦æ˜¯ä¸€ä¸ªå¯¹æ•°æ—¶é—´çš„æ“ä½œã€‚ä¸ºäº†æ‰¾åˆ°ä¸€æœ¬ä¹¦ï¼Œä½ å¯ä»¥å…ˆæ£€æŸ¥åœ¨ä¹¦æ¶ä¸­é—´ä½ç½®çš„é‚£æœ¬ä¹¦ã€‚å¦‚æœå®ƒå°±æ˜¯ä½ è¦æ‰¾çš„ä¹¦ï¼Œé‚£ä¹ˆä»»åŠ¡å°±å®Œæˆäº†ã€‚å¦‚æœä¸æ˜¯ï¼Œä½ è¦ç¡®å®šæƒ³æ‰¾çš„ä¹¦æ˜¯åœ¨ä¸­é—´è¿™æœ¬ä¹¦çš„å‰é¢è¿˜æ˜¯åé¢ã€‚è¿™ä¹ˆåšå¯ä»¥æœ‰æ•ˆåœ°å°†æ‰¾ä¹¦èŒƒå›´ç¼©å‡è‡³ä¸€åŠã€‚æ¥ä¸‹æ¥ä¸æ–­é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œåœ¨ä¸€åŠèŒƒå›´å†…æ£€æŸ¥å¤„äºä¸­é—´ä½ç½®çš„ä¹¦ã€‚è¿™è¢«ç§°ä¸ºäºŒåˆ†æœç´¢ç®—æ³•ï¼Œ13.5.2èŠ‚ä¸­æœ‰ä¸€ä¸ªç¤ºä¾‹ã€‚</p><p>â€‹      </p><p>å°†ä¸€ç»„ä¹¦åˆ†ä¸ºä¸¤åŠçš„æ¬¡æ•°ä¸€å…±æ˜¯log_2næ¬¡ã€‚åœ¨ä¸€ä¸ªæœ‰16æœ¬ä¹¦çš„ä¹¦æ¶ä¸Šï¼Œæœ€å¤šéœ€è¦4æ­¥å°±èƒ½æ‰¾åˆ°æƒ³æ‰¾çš„ä¹¦ï¼Œå› ä¸ºæ¯ä¸€æ­¥éƒ½ä¼šå°†éœ€è¦ç»§ç»­æœç´¢çš„ä¹¦çš„èŒƒå›´ç¼©å‡ä¸€åŠã€‚å¦‚æœä¹¦æ¶ä¸Šçš„ä¹¦å¢åŠ ä¸€å€ï¼Œä¹Ÿåªéœ€è¦å¤šæœç´¢ä¸€æ¬¡ã€‚å¦‚æœä¸€ä¸ªä¹¦æ¶æŒ‰ç…§å­—æ¯é¡ºåºæ’åˆ—æœ‰42äº¿æœ¬ä¹¦ï¼Œä¹Ÿåªéœ€è¦32æ­¥å°±èƒ½æ‰¾åˆ°æŸæœ¬ä¹¦ã€‚</p><p>O(\log n)ç®—æ³•é€šå¸¸åŒ…æ‹¬ä¸€ä¸ªåˆ’åˆ†å’Œæ¶ˆåŒ–çš„æ­¥éª¤ï¼Œå³ä»nä¸ªè¾“å…¥ä¸­é€‰æ‹©ä¸€åŠè¿›è¡Œå¤„ç†ï¼Œå†ä»è¿™ä¸€åŠä¸­é€‰æ‹©ä¸€åŠï¼Œä»¥æ­¤ç±»æ¨ã€‚log nè¿ç®—çš„å¯æ‰©å±•æ€§å¾ˆå¥½ï¼šå·¥ä½œé‡å¢åŠ ä¸€å€ï¼Œè¿ç®—æ—¶é—´åªå¢åŠ ä¸€æ­¥ã€‚</p></li><li><p><strong>O(n)ï¼Œçº¿æ€§æ—¶é—´</strong></p><p>é˜…è¯»ä¹¦æ¶ä¸Šçš„æ‰€æœ‰ä¹¦æ˜¯ä¸€ä¸ªçº¿æ€§æ—¶é—´çš„æ“ä½œã€‚å¦‚æœä¹¦çš„åšåº¦å·®ä¸å¤šï¼Œå°†ä¹¦æ¶ä¸Šçš„ä¹¦çš„æ•°é‡å¢åŠ ä¸€å€ï¼Œé‚£ä¹ˆè¯»å®Œæ‰€æœ‰ä¹¦å°±éœ€è¦å¤§çº¦ä¸¤å€çš„æ—¶é—´ã€‚è¿ç®—æ—¶é—´ä¸ä¹¦çš„æ•°é‡næˆæ¯”ä¾‹å¢åŠ ã€‚</p></li><li><p><strong>O(n\log n)ï¼ŒN-Log-Næ—¶é—´</strong></p><p>å°†ä¸€ç»„ä¹¦æŒ‰ç…§å­—æ¯é¡ºåºæ’åºæ˜¯ä¸€ä¸ªN-Log-Næ—¶é—´çš„æ“ä½œã€‚è¿™ä¸ªé˜¶æ•°æ˜¯O(n)å’ŒO(\log n)çš„è¿è¡Œæ—¶é—´ç›¸ä¹˜çš„ç»“æœã€‚å¯ä»¥å°†O(n\log n)]çš„ä»»åŠ¡çœ‹æˆä¸€ä¸ªéœ€è¦è¢«æ‰§è¡Œnæ¬¡çš„O(\log n)ä»»åŠ¡ã€‚ä¸‹é¢å¯¹åŸå› åšä¸€ä¸ªé€šä¿—çš„è§£é‡Šã€‚</p><p>æˆ‘ä»¬æœ‰ä¸€æ‘éœ€è¦æŒ‰ç…§å­—æ¯é¡ºåºæ’åˆ—çš„ä¹¦å’Œä¸€ä¸ªç©ºä¹¦æ¶ã€‚æŒ‰ç…§å‰æ–‡æè¿°çš„äºŒåˆ†æœç´¢ç®—æ³•çš„æ­¥éª¤ï¼Œæ‰¾åˆ°ä¹¦æ¶ä¸ŠæŸæœ¬ä¹¦çš„ä½ç½®æ˜¯O(\log n)çš„æ“ä½œã€‚å¦‚æœæœ‰næœ¬ä¹¦éœ€è¦æŒ‰å­—æ¯é¡ºåºæ’åˆ—ï¼Œè€Œæ¯æœ¬ä¹¦æŒ‰ç…§å­—æ¯é¡ºåºæ’åˆ—éƒ½éœ€è¦log næ­¥ï¼ŒæŒ‰ç…§å­—æ¯é¡ºåºæ’åˆ—æ•´ä¸ªä¹¦æ¶éœ€è¦çš„æ­¥éª¤å°±æ˜¯n x log nï¼Œæˆ–è€… log n x  nã€‚å¦‚æœä¹¦çš„æ•°é‡å˜æˆåŸæ¥çš„ä¸¤å€ï¼Œå°†æ‰€æœ‰ä¹¦æŒ‰ç…§å­—æ¯é¡ºåºæ’åˆ—ä¹Ÿåªéœ€è¦ä¸¤å€å¤šä¸€ç‚¹çš„æ—¶é—´ã€‚æ‰€ä»¥O(n\log n)]ç®—æ³•çš„å¢é•¿é€Ÿåº¦æ˜¯è¾ƒæ…¢çš„ã€‚</p><p>äº‹å®ä¸Šï¼Œæ‰€æœ‰é«˜æ•ˆçš„æ’åºç®—æ³•éƒ½æ˜¯O(n\log n)]çš„ï¼šåˆå¹¶æ’åºã€å¿«é€Ÿæ’åºã€å †æ’åºå’ŒTimSortã€‚ï¼ˆTimSortæ˜¯ç”±Tim Peterså‘æ˜çš„ï¼ŒPythonçš„<code>sort()</code>æ–¹æ³•ä½¿ç”¨çš„å°±æ˜¯è¯¥ç®—æ³•ã€‚ï¼‰</p></li><li><p><strong>O(n^2)ï¼Œå¤šé¡¹å¼æ—¶é—´</strong></p><p>åœ¨ä¸€ä¸ªæ²¡æœ‰æ’åºçš„ä¹¦æ¶ä¸Šæ£€æŸ¥æ˜¯å¦å­˜åœ¨é‡å¤çš„ä¹¦æ˜¯ä¸€ä¸ªå¤šé¡¹å¼æ—¶é—´çš„æ“ä½œã€‚å¦‚æœæœ‰100æœ¬ä¹¦ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä»ç¬¬ä¸€æœ¬å¼€å§‹ï¼Œæ‹¿èµ·æ¥è·Ÿå…¶ä»–99æœ¬ä¹¦æ¯”è¾ƒï¼Œçœ‹çœ‹æ˜¯å¦ç›¸åŒã€‚æ¥ç€æ‹¿èµ·ç¬¬äºŒæœ¬ã€ç¬¬ä¸‰æœ¬â€¦â€¦åˆ†åˆ«å’Œå…¶ä»–99æœ¬ä¹¦æ¯”è¾ƒï¼Œæ£€æŸ¥ä¸€æœ¬ä¹¦æ˜¯å¦è·Ÿå…¶ä»–ä¹¦é‡å¤éœ€è¦99ä¸ªæ­¥éª¤ï¼ˆå››èˆäº”å…¥æˆ100ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªç¤ºä¾‹ä¸­çš„nï¼‰ã€‚è€Œæˆ‘ä»¬éœ€è¦å¯¹æ¯æœ¬ä¹¦éƒ½è¿›è¡Œä¸€æ¬¡æ“ä½œï¼Œä¹Ÿå°±æ˜¯ä¸€å…±100æ¬¡ã€‚å› æ­¤æ£€æŸ¥ä¹¦æ¶ä¸Šæ˜¯å¦å­˜åœ¨é‡å¤ä¹¦çš„æ­¥éª¤å¤§çº¦æ˜¯n x n ï¼Œä¹Ÿå°±æ˜¯n^2ã€‚ï¼ˆå³ä½¿æˆ‘ä»¬è¶³å¤Ÿèªæ˜ï¼Œä¸å»é‡å¤æ¯”è¾ƒï¼Œä¹Ÿéœ€è¦æ‰§è¡Œè¿‘n^2æ­¥ã€‚)</p><p>è¿è¡Œæ—¶é—´ä»¥å¢åŠ çš„å›¾ä¹¦æ•°é‡çš„å¹³æ–¹æˆæ¯”ä¾‹å¢åŠ ã€‚æ£€æŸ¥100æœ¬ä¹¦ä¸­æ˜¯å¦æœ‰é‡å¤éœ€è¦10 000æ­¥ï¼ˆ100 Ã— 100ï¼‰ã€‚è€Œæ£€æŸ¥ä¸¤å€äºè¿™ä¸ªæ•°é‡çš„ä¹¦ï¼Œä¹Ÿå°±æ˜¯200æœ¬ä¹¦ï¼Œåˆ™éœ€è¦40 000æ­¥ï¼ˆ200 Ã— 200ï¼‰ï¼Œå³ä»¥å‰çš„4å€ã€‚</p><p>æ ¹æ®æˆ‘è‡ªå·±çš„å®é™…ç¼–ç ç»éªŒï¼Œå¤§Oåˆ†ææœ€å¸¸è§çš„ç”¨é€”æ˜¯é¿å…åœ¨é—®é¢˜å­˜åœ¨O(n\log n)]æˆ–O(n)çš„ç®—æ³•æ—¶æ„å¤–åœ°ç¼–å†™ä¸€ä¸ªO(n^2)ç®—æ³•ã€‚O(n^2)é˜¶æ„å‘³ç€ç®—æ³•çš„é€Ÿåº¦éšç€è§„æ¨¡å¢åŠ æ€¥å‰§ä¸‹é™ã€‚å¦‚æœä½ çš„ä»£ç æ˜¯O(n^2)é˜¶æˆ–æ›´é«˜ï¼Œåº”è¯¥å…ˆæš‚åœï¼Œæ€è€ƒæ˜¯å¦å¯èƒ½æœ‰å¦ä¸€ç§ç®—æ³•èƒ½å¤Ÿæ›´å¿«åœ°è§£å†³é—®é¢˜ã€‚ä¸ºäº†åº”å¯¹è¿™ç§é—®é¢˜ï¼Œæ— è®ºæ˜¯åœ¨å¤§å­¦é‡Œè¿˜æ˜¯åœ¨ç½‘ä¸Šï¼Œå­¦ä¹ æ•°æ®ç»“æ„å’Œç®—æ³•è¯¾ç¨‹ä¼šæœ‰æ‰€å¸®åŠ©ã€‚</p><p>O(n^2)ä¹Ÿè¢«ç§°ä¸ºäºŒæ¬¡æ–¹æ—¶é—´ã€‚ç®—æ³•çš„å¤æ‚åº¦è¿˜å¯èƒ½æ˜¯O(n^3)ï¼Œå³ç«‹æ–¹æ—¶é—´ï¼Œæˆ–è€…O(n^4)ï¼Œå³å››æ¬¡æ–¹æ—¶é—´ï¼Œåˆæˆ–è€…æ˜¯å…¶ä»–å¤šé¡¹å¼æ—¶é—´ã€‚å®ƒä»¬çš„é€Ÿåº¦éšç€æŒ‡æ•°çš„å¢å¤§è€Œå˜æ…¢ã€‚</p></li><li><p><strong>O(2^n)ï¼ŒæŒ‡æ•°æ—¶é—´</strong></p><p>ç»™ä¹¦æ¶ä¸Šæ‰€æœ‰ä¹¦çš„ç»„åˆæ‹ç…§æ˜¯ä¸€ä¸ªæŒ‡æ•°æ—¶é—´çš„æ“ä½œã€‚æƒ³è±¡ä¸€ä¸‹ï¼šä¹¦æ¶ä¸Šçš„æ¯æœ¬ä¹¦è¦ä¹ˆåœ¨ç…§ç‰‡ä¸­ï¼Œè¦ä¹ˆä¸åœ¨ç…§ç‰‡ä¸­ã€‚å›¾13-1æ˜¾ç¤ºäº†nä¸º1ã€2ã€3æ—¶çš„æ‰€æœ‰ç»„åˆã€‚å¦‚æœnä¸º1ï¼Œä¼šæœ‰ä¸¤å¼ ç…§ç‰‡ï¼šæœ‰ä¹¦æˆ–æ²¡ä¹¦ã€‚å¦‚æœnä¸º2ï¼Œåˆ™æœ‰4å¼ ç…§ç‰‡ï¼šä¸¤æœ¬ä¹¦éƒ½åœ¨ä¹¦æ¶ä¸Šã€ä¸¤æœ¬ä¹¦éƒ½ä¸åœ¨ã€ç¬¬ä¸€æœ¬ä¹¦åœ¨è€Œç¬¬äºŒæœ¬ä¸åœ¨ã€ç¬¬äºŒæœ¬ä¹¦åœ¨è€Œç¬¬ä¸€æœ¬ä¸åœ¨ã€‚å½“æ•°é‡å¢åŠ åˆ°3æœ¬ä¹¦æ—¶ï¼Œä½ è¦åšçš„å·¥ä½œåˆå¢åŠ äº†ä¸€å€ï¼šä½ éœ€è¦å¯¹ä¸¤æœ¬ä¹¦çš„æ¯ä¸ªå­é›†ä¸­å†è€ƒè™‘ç¬¬ä¸‰æœ¬ä¹¦åœ¨ï¼ˆ4å¼ ç…§ç‰‡ï¼‰æˆ–ä¸åœ¨ï¼ˆå¦å¤–4å¼ ç…§ç‰‡ï¼‰çš„æƒ…å†µï¼ˆä¸€å…±æ˜¯8å¼ ç…§ç‰‡ï¼Œå› ä¸º2^3&#x3D;8ã€‚æ¯å¢åŠ ä¸€æœ¬ä¹¦ï¼Œå·¥ä½œé‡å°±å¢åŠ ä¸€å€ã€‚å¦‚æœæœ‰næœ¬ä¹¦ï¼Œéœ€è¦æ‹æ‘„çš„ç…§ç‰‡æ•°é‡ï¼ˆä¹Ÿå°±æ˜¯å·¥ä½œé‡ï¼‰æ˜¯2^nã€‚</p><p><img src="/./img/python/image00381.jpg" alt="image00381"></p><p><strong>å›¾13-1ã€€ä¹¦æ¶ä¸Šæœ‰ä¸€æœ¬ã€ä¸¤æœ¬ã€ä¸‰æœ¬ä¹¦æ—¶çš„æ‰€æœ‰ç»„åˆ</strong></p><p>æŒ‡æ•°çº§ä»»åŠ¡çš„è¿è¡Œæ—¶é—´å¢åŠ å¾—å¾ˆå¿«ã€‚6æœ¬ä¹¦éœ€è¦2^6å³64å¼ ç…§ç‰‡ï¼Œ32æœ¬ä¹¦åˆ™éœ€è¦2^32å³è¶…è¿‡42äº¿å¼ ç…§ç‰‡ã€‚O(2^n)ã€O(3^n)ã€O(4^n)ç­‰è™½ç„¶é˜¶æ•°ä¸åŒï¼Œä½†æ—¶é—´å¤æ‚åº¦éƒ½å±äºæŒ‡æ•°çº§ã€‚</p><p>â€‹      </p></li><li><p><strong>O(n!)ï¼Œé˜¶ä¹˜æ—¶é—´</strong></p><p>æŠŠä¹¦æ¶ä¸Šçš„ä¹¦æŒ‰ç…§æ‰€æœ‰é¡ºåºæ‹ç…§æ˜¯ä¸€ä¸ªé˜¶ä¹˜æ—¶é—´çš„æ“ä½œã€‚è¿™äº›ä¹¦çš„æ‰€æœ‰é¡ºåºè¢«ç§°ä¸ºnæœ¬ä¹¦çš„æ’åˆ—ç»„åˆï¼Œç»“æœæ˜¯n!ï¼Œä¹Ÿå°±æ˜¯nçš„é˜¶ä¹˜ã€‚ä¸€ä¸ªæ•°å­—çš„é˜¶ä¹˜æ˜¯ä¸è¶…è¿‡è¯¥æ•°çš„æ‰€æœ‰æ­£æ•´æ•°çš„ä¹˜ç§¯ã€‚æ¯”å¦‚3æ˜¯3 Ã— 2 Ã— 1ï¼Œå³6ã€‚å›¾13-2å±•ç¤ºäº†3æœ¬ä¹¦å¯èƒ½å‡ºç°çš„æ‰€æœ‰æ’åˆ—ç»„åˆã€‚</p><p><img src="/./img/python/image00388.jpg" alt="image00388"></p><p><strong>å›¾13-2ã€€ä¹¦æ¶ä¸Š3æœ¬ä¹¦çš„å…¨éƒ¨6ç§æ’åˆ—ç»„åˆ</strong></p><p>æ€è€ƒå¦‚ä½•å¾—åˆ°næœ¬ä¹¦çš„æ¯ç§æ’åˆ—ç»„åˆã€‚ç¬¬ä¸€æœ¬ä¹¦æœ‰nç§å¯èƒ½çš„é€‰æ‹©ï¼›ç¬¬äºŒæœ¬ä¹¦æœ‰n-1ç§å¯èƒ½çš„é€‰æ‹©ï¼ˆé™¤äº†ç¬¬ä¸€æœ¬ä¹¦ä¹‹å¤–çš„æ¯ä¸€æœ¬ä¹¦éƒ½å¯ä»¥è¢«é€‰ä½œç¬¬äºŒæœ¬ï¼‰ï¼›ç¬¬ä¸‰æœ¬ä¹¦æœ‰n-2ç§é€‰æ‹©ï¼Œä»¥æ­¤ç±»æ¨ã€‚å½“æœ‰6æœ¬ä¹¦æ—¶ï¼Œå°±å­˜åœ¨6!ç§é€‰æ‹©ï¼Œä¹Ÿå°±æ˜¯6 Ã— 5 Ã— 4 Ã— 3 Ã— 2 Ã— 1ï¼Œå³720å¼ ç…§ç‰‡ã€‚è€Œå†å¢åŠ ä¸€æœ¬ä¹¦ï¼Œç»“æœå°±æ˜¯7!ï¼Œå³5040å¼ ç…§ç‰‡ã€‚å³ä½¿nå€¼å¹¶ä¸å¤§ï¼Œé˜¶ä¹˜æ—¶é—´çš„ç®—æ³•ä¹Ÿå¾ˆå¿«å˜å¾—ä¸èƒ½åœ¨åˆç†æ—¶é—´å†…å®Œæˆã€‚å¦‚æœä½ æœ‰20æœ¬ä¹¦ä¾›æ’åˆ—ï¼Œå°±ç®—1å¼ ç…§ç‰‡çš„æ‹æ‘„æ—¶é—´åªæœ‰1ç§’ï¼Œå®ƒä»ç„¶éœ€è¦æ¯”å®‡å®™å­˜åœ¨çš„æ—¶é—´è¿˜è¦é•¿çš„æ—¶é—´æ‹æ‘„å®Œæ‰€æœ‰æ’åˆ—ç»„åˆã€‚</p><p>ä¸€ä¸ªè‘—åçš„O(n!)é—®é¢˜æ˜¯æ—…è¡Œå•†é—®é¢˜ã€‚ä¸€ä¸ªé”€å”®å‘˜è¦è®¿é—®nä¸ªåŸå¸‚ï¼Œå¸Œæœ›è®¡ç®—å‡ºä»–éœ€è¦è®¿é—®çš„nä¸ªåŸå¸‚ä¸åŒé¡ºåºçš„æ—…è¡Œæ€»è·ç¦»ï¼Œå†æ ¹æ®å…¶è®¡ç®—ç»“æœç¡®å®šæ—…è¡Œæ€»è·ç¦»æœ€çŸ­çš„è®¿é—®é¡ºåºã€‚åœ¨åŸå¸‚å¾ˆå¤šæ—¶ï¼Œè¯¥ä»»åŠ¡è¢«è¯æ˜æ— æ³•å¾ˆå¿«å®Œæˆï¼Œä½†å¹¸è¿çš„æ˜¯ï¼Œä¼˜åŒ–ç®—æ³•å¯ä»¥æ‰¾åˆ°ä¸€æ¡ç›¸å¯¹è·ç¦»è¾ƒçŸ­ï¼ˆä½†ä¸ä¿è¯æ˜¯æœ€çŸ­ï¼‰çš„è·¯çº¿ï¼Œè¿ç®—æ‰€ç”¨æ—¶é—´è¦æ¯”O(n!)çŸ­å¾—å¤šã€‚</p></li></ol><h3 id="13-4-2-å¤§Oæµ‹é‡çš„æ˜¯æœ€åæƒ…å†µ"><a href="#13-4-2-å¤§Oæµ‹é‡çš„æ˜¯æœ€åæƒ…å†µ" class="headerlink" title="13.4.2ã€€å¤§Oæµ‹é‡çš„æ˜¯æœ€åæƒ…å†µ"></a>13.4.2ã€€å¤§Oæµ‹é‡çš„æ˜¯æœ€åæƒ…å†µ</h3><p>ã€€ã€€å¤§Oä¸“ç”¨äºæµ‹é‡ä»»åŠ¡çš„æœ€åæƒ…å†µã€‚æ¯”å¦‚è¦åœ¨ä¸€ä¸ªæ— åºçš„ä¹¦æ¶ä¸Šæ‰¾åˆ°ä¸€æœ¬ç‰¹å®šçš„ä¹¦ï¼Œä½ éœ€è¦ä»ä¸€å¤´å¼€å§‹æœå¯»ï¼Œç›´åˆ°æ‰¾åˆ°å®ƒã€‚ä½ å¯èƒ½å¾ˆå¹¸è¿ï¼ŒæŸ¥çœ‹çš„ç¬¬ä¸€æœ¬ä¹¦å°±æ˜¯ä½ è¦æ‰¾çš„ä¹¦ã€‚ä½†ä½ ä¹Ÿå¯èƒ½ä¸èµ°è¿ï¼ŒæŸ¥çœ‹çš„æœ€åä¸€æœ¬ä¹¦æ‰æ˜¯ä½ è¦æ‰¾çš„ä¹¦ï¼Œæˆ–è€…å®ƒæ ¹æœ¬å°±ä¸åœ¨ä¹¦æ¶ä¸Šã€‚å› æ­¤ï¼Œåœ¨æœ€å¥½çš„æƒ…å†µä¸‹ï¼Œå³ä½¿ä¹¦æ¶ä¸Šæœ‰å‡ åäº¿æœ¬å¾…æœç´¢çš„ä¹¦ä¹Ÿæ— æ‰€è°“ï¼Œåæ­£ä½ ä¼šç«‹åˆ»æ‰¾åˆ°è¦æ‰¾çš„ä¹¦ã€‚ä½†æ˜¯è¿™ç§ä¹è§‚çš„æ€åº¦å¯¹ç®—æ³•åˆ†ææ¥è¯´æ¯«æ— æ„ä¹‰ã€‚å¤§Oæè¿°çš„æ˜¯åœ¨ä¸å¹¸è¿çš„æƒ…å†µä¸‹å‘ç”Ÿçš„äº‹æƒ…ï¼šå¦‚æœä¹¦æ¶ä¸Šæœ‰næœ¬ä¹¦ï¼Œé‚£ä¹ˆä½ å°†ä¸å¾—ä¸æŸ¥çœ‹å®Œæ‰€æœ‰ä¹¦ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿è¡Œæ—¶é—´çš„å¢åŠ é€Ÿåº¦ä¸ä¹¦çš„æ•°é‡å¢åŠ çš„é€Ÿåº¦ç›¸åŒã€‚</p><p>ã€€ã€€ä¸€äº›ç¨‹åºå‘˜è¿˜ä¼šä½¿ç”¨å¤§Omegaç¬¦å·æè¿°ç®—æ³•çš„æœ€ä½³æƒ…å†µã€‚æ¯”å¦‚ï¼Œä¸€ä¸ª!\mathit{\Omega}(n)ç®—æ³•åœ¨æœ€å¥½çš„æƒ…å†µä¸‹ä¼šå…·æœ‰çº¿æ€§æ•ˆç‡ã€‚è€Œåœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œå®ƒå¯èƒ½è¡¨ç°å¾—æ›´æ…¢ã€‚æœ‰äº›ç®—æ³•ä¼šé‡åˆ°ç‰¹åˆ«å¹¸è¿çš„æƒ…å†µï¼Œå³ä¸éœ€è¦åšä»»ä½•å·¥ä½œã€‚æ¯”å¦‚ï¼Œä»»åŠ¡æ˜¯æ‰¾åˆ°å‰å¾€ç›®çš„åœ°çš„é©¾é©¶è·¯çº¿ï¼Œè€Œä½ å°±åœ¨ç›®çš„åœ°ã€‚</p><p>ã€€ã€€å¤§Thetaç¬¦å·åˆ™è¡¨ç¤ºç®—æ³•çš„æœ€å¥½æƒ…å†µå’Œæœ€åæƒ…å†µä¸‹çš„é˜¶æ•°ç›¸åŒã€‚æ¯”å¦‚ï¼Œ\mathit{\Theta}(n)æè¿°äº†ä¸€ä¸ªåœ¨æœ€å¥½æƒ…å†µå’Œæœ€åæƒ…å†µä¸‹éƒ½å…·æœ‰çº¿æ€§æ•ˆç‡çš„ç®—æ³•ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ—¢æ˜¯O(n)ç®—æ³•ï¼Œä¹Ÿæ˜¯\mathit{\Omega}(n)ç®—æ³•ã€‚åœ¨è½¯ä»¶å·¥ç¨‹ä¸­ï¼Œè¿™äº›ç¬¦å·ä¸å¦‚å¤§Oå¸¸ç”¨ï¼Œä½†ä½ è¿˜æ˜¯åº”è¯¥çŸ¥é“å®ƒä»¬ã€‚</p><p>ã€€ã€€åœ¨è°ˆè®ºâ€œå¹³å‡æƒ…å†µä¸‹çš„å¤§Oâ€æ—¶ï¼Œäººä»¬æŒ‡çš„æ˜¯å¤§Thetaï¼›åœ¨è°ˆè®ºâ€œæœ€ä½³æƒ…å†µä¸‹çš„å¤§Oâ€æ—¶ï¼ŒæŒ‡çš„æ˜¯å¤§Omegaï¼Œè¿™å¹¶ä¸ç¨€å¥‡ã€‚ä»–ä»¬çš„è¯´æ³•ä¸¥æ ¼æ¥è¯´æ˜¯çŸ›ç›¾çš„ã€‚å¤§Oå…·ä½“æŒ‡çš„æ˜¯ä¸€ä¸ªç®—æ³•çš„æœ€åæƒ…å†µä¸‹çš„è¿è¡Œæ—¶é—´ã€‚ä½†å³ä½¿ä»–ä»¬çš„æªè¾åœ¨æŠ€æœ¯ä¸Šä¸æ­£ç¡®ï¼Œä½ ä¹Ÿåº”è¯¥èƒ½å¤Ÿç†è§£ä»–ä»¬çš„æ„æ€ã€‚</p><blockquote><p><strong>ç†è§£å¤§Oæ‰€éœ€çš„æ•°å­¦çŸ¥è¯†</strong></p><p>ã€€ã€€å¦‚æœä½ å¯¹ä»£æ•°ç”Ÿç–äº†ï¼Œå¤ä¹ ä»¥ä¸‹æ•°å­¦çŸ¥è¯†å°±è¶³ä»¥å¸®åŠ©ä½ è¿›è¡Œå¤§Oåˆ†æã€‚</p><ul><li>ä¹˜æ³•ï¼šåŠ æ³•çš„é‡å¤ï¼Œ2 Ã— 4 &#x3D; 8å°±ç›¸å½“äº2 + 2 + 2 + 2 &#x3D; 8ã€‚ä½¿ç”¨å˜é‡è¿›è¡ŒæŠ½è±¡ï¼Œ!n+n+nç›¸å½“äº3 x nã€‚</li><li>ä¹˜æ³•ç¬¦å·ï¼šåœ¨ä»£æ•°ä¸­ï¼Œä¹˜æ³•ç¬¦å·Ã—ç»å¸¸è¢«çœç•¥ã€‚2 x nä¼šè¢«å†™ä½œ!2nã€‚å½“æ“ä½œæ•°éƒ½æ˜¯æ•°å­—æ—¶ï¼Œ2 Ã— 3ä¼šè¢«å†™ä½œ2(3)ï¼Œå³6ã€‚</li><li>ä¹˜æ³•åŒä¸€æ€§ï¼šä¸€ä¸ªæ•°ä¹˜ä»¥1ç»“æœæ˜¯è¿™ä¸ªæ•°æœ¬èº«ã€‚å¦‚5 Ã— 1 &#x3D; 5ï¼Œ42 Ã— 1 &#x3D; 42ã€‚æ›´ç¬¼ç»Ÿçš„æè¿°æ˜¯ï¼šn x 1&#x3D;nã€‚</li><li>ä¹˜æ³•åˆ†é…å¾‹ï¼š2 Ã— (3 + 4) &#x3D; (2 Ã— 3) + (2 Ã— 4)ï¼Œç­‰å¼ä¸¤è¾¹éƒ½ç­‰äº14ã€‚æ›´ç¬¼ç»Ÿçš„æè¿°æ˜¯ï¼ša(b + c) &#x3D; ab + acã€‚</li><li>å¹‚æ˜¯é‡å¤çš„ä¹˜æ³•ï¼š[2^4&#x3D;16ï¼ˆè¯»ä½œ2çš„4æ¬¡æ–¹ç­‰äº16ï¼‰ã€‚è¿™å’Œ2 Ã— 2 Ã— 2 Ã— 2 &#x3D; 16ä¸€æ ·ã€‚è¿™ä¸ªç¤ºä¾‹ä¸­çš„2æ˜¯åŸºæ•°ï¼Œ4æ˜¯æŒ‡æ•°ã€‚ä½¿ç”¨å˜é‡è¿›è¡ŒæŠ½è±¡ï¼Œn x n x n x nç›¸å½“äºn^4]ã€‚åœ¨Pythonä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>**</code>è¿ç®—ç¬¦è¡¨ç¤ºå¹‚è¿ç®—ï¼š<code>2**4</code>çš„ç»“æœæ˜¯16ã€‚</li><li>1æ¬¡æ–¹çš„ç»“æœå°±æ˜¯åŸºæ•°æœ¬èº«ï¼Œå¦‚2^1&#x3D;2ï¼Œ9999^1&#x3D;9999ã€‚æ›´ç¬¼ç»Ÿçš„æè¿°æ˜¯ï¼šn^1&#x3D;nã€‚</li><li>0æ¬¡æ–¹çš„ç»“æœéƒ½æ˜¯1ï¼Œå¦‚2^0&#x3D;1ï¼Œ9999^0&#x3D;1ã€‚æ›´ç¬¼ç»Ÿçš„æè¿°æ˜¯ï¼šn^0&#x3D;1ã€‚</li><li>ç³»æ•°æ˜¯ä¹˜æ³•å› æ•°ï¼šåœ¨3n^2+4n+5ä¸­ï¼Œç³»æ•°æ˜¯3ã€4ã€5ã€‚å¯ä»¥çœ‹åˆ°ï¼Œ5è¢«è§†ä¸ºç³»æ•°çš„åŸå› æ˜¯å®ƒå¯ä»¥è¢«å†™ä½œ5(1)ï¼Œå³5n^0ã€‚</li><li>å¯¹æ•°æ˜¯å¹‚è¿ç®—çš„é€†è¿ç®—ï¼šç”±äº2^4&#x3D;16ï¼Œå› æ­¤\log_2(16)&#x3D;4ï¼Œå®ƒçš„å¿µæ³•æ˜¯â€œä»¥2ä¸ºåº•16çš„å¯¹æ•°æ˜¯4â€ã€‚åœ¨Pythonä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>math.log()</code>å‡½æ•°æ±‚è§£ï¼š<code>math.log(16, 2)</code>çš„ç»“æœä¸º4.0ã€‚</li></ul><p>ã€€ã€€è®¡ç®—å¤§Oæ—¶ç»å¸¸éœ€è¦é€šè¿‡åˆå¹¶åŒç±»é¡¹æ¥ç®€åŒ–æ–¹ç¨‹ã€‚é¡¹æ˜¯ä¸€äº›æ•°å­—å’Œå˜é‡ç›¸ä¹˜çš„ç»„åˆï¼šåœ¨3n^2+4n+5ä¸­ï¼Œé¡¹æ˜¯3n^2ã€4nå’Œ5ã€‚åŒç±»é¡¹æ˜¯æŒ‡å®ƒä»¬çš„å˜é‡åŠæŒ‡æ•°éƒ½ç›¸åŒã€‚åœ¨è¡¨è¾¾å¼3n^2+4n+6n+5ä¸­ï¼Œé¡¹4nå’Œ6næ˜¯åŒç±»é¡¹ã€‚å¯ä»¥å°†è¯¥è¡¨è¾¾å¼ç®€å†™æˆ3n^2+10n+5ã€‚</p><p>ã€€ã€€è¯·è®°ä½ï¼Œç”±äºn x 1&#x3D;nï¼Œåƒ3n^2+5n+4è¿™æ ·çš„è¡¨è¾¾å¼å¯ä»¥è¢«è®¤ä¸ºæ˜¯3n^2+5n+4(1)ã€‚è¿™ä¸ªè¡¨è¾¾å¼ä¸­çš„é¡¹ä¸å¤§Oé˜¶çš„O(n^2)ã€O(n)å’ŒO(1)ç±»ä¼¼ã€‚è¿™ä¸€ç‚¹åœ¨åé¢ä¸ºå¤§Oçš„è®¡ç®—èˆå¼ƒç³»æ•°æ—¶ä¼šå‡ºç°ã€‚</p><p>ã€€ã€€å½“ä½ é¦–æ¬¡å­¦ä¹ è®¡ç®—ä¸€æ®µä»£ç çš„å¤§Oæ—¶ï¼Œè¿™äº›æ•°å­¦è§„åˆ™å¯èƒ½ä¼šæ´¾ä¸Šç”¨åœºã€‚ä½†åœ¨å®Œæˆ13.5.4èŠ‚çš„å­¦ä¹ åï¼Œä½ å¯èƒ½å°±ä¸éœ€è¦å®ƒä»¬äº†ã€‚å¤§Oæ˜¯ä¸€ä¸ªç®€å•çš„æ¦‚å¿µï¼Œå³ä½¿æ²¡æœ‰ä¸¥æ ¼éµå¾ªæ•°å­¦è§„åˆ™ï¼Œä¾ç„¶èƒ½è¡¡é‡ç®—æ³•çš„å¿«æ…¢ã€‚</p></blockquote><h2 id="13-5-ç¡®å®šä»£ç çš„å¤§Oé˜¶"><a href="#13-5-ç¡®å®šä»£ç çš„å¤§Oé˜¶" class="headerlink" title="13.5ã€€ç¡®å®šä»£ç çš„å¤§Oé˜¶"></a>13.5ã€€ç¡®å®šä»£ç çš„å¤§Oé˜¶</h2><p>ã€€ã€€ç¡®å®šä¸€æ®µä»£ç çš„å¤§Oé˜¶éœ€è¦è¿›è¡Œ4é¡¹å·¥ä½œï¼šç¡®å®šnæ˜¯ä»€ä¹ˆï¼Œè®¡ç®—ä»£ç ä¸­çš„æ­¥éª¤æ•°ï¼Œå»é™¤ä½é˜¶é¡¹ï¼Œå»é™¤ç³»æ•°ã€‚</p><p>ã€€ã€€æ¯”å¦‚ï¼Œä¸ºä¸‹é¢çš„<code>readingList()</code>å‡½æ•°è®¡ç®—å¤§Oé˜¶ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs routeros">def readingList(books):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Here are the books I will read:&#x27;</span>)<br>    numberOfBooks = 0<br>    <span class="hljs-keyword">for</span> book <span class="hljs-keyword">in</span> books:<br>        <span class="hljs-built_in">print</span>(book)<br>        numberOfBooks += 1<br>    <span class="hljs-built_in">print</span>(numberOfBooks, <span class="hljs-string">&#x27;books total.&#x27;</span>)<br></code></pre></td></tr></table></figure><p>ã€€ã€€å›é¡¾ä¸€ä¸‹ï¼Œnä»£è¡¨ä»£ç å¤„ç†çš„è¾“å…¥æ•°æ®çš„è§„æ¨¡ã€‚åœ¨å‡½æ•°ä¸­ï¼Œnå‡ ä¹æ€»æ˜¯ä½œä¸ºå‚æ•°ã€‚<code>readingList()</code>å‡½æ•°çš„å”¯ä¸€å‚æ•°æ˜¯<code>books</code>ï¼Œæ‰€ä»¥<code>books</code>çš„å¤§å°ä¼¼ä¹æ˜¯nçš„ä¸€ä¸ªå¾ˆå¥½çš„å€™é€‰é¡¹ï¼Œå› ä¸º<code>books</code>è¶Šå¤§ï¼Œå‡½æ•°è¿è¡Œçš„æ—¶é—´å°±è¶Šé•¿ã€‚</p><p>ã€€ã€€æ¥ä¸‹æ¥è®¡ç®—è¿™æ®µä»£ç ä¸­çš„æ­¥éª¤æ•°ã€‚æ­¥éª¤çš„å®šä¹‰æ˜¯æ¨¡ç³Šçš„ï¼Œå°†ä¸€è¡Œä»£ç è§†ä¸ºä¸€ä¸ªæ­¥éª¤æ˜¯ä¸ªä¸é”™çš„è§„åˆ™ã€‚å¾ªç¯æœ‰å¤šå°‘æ­¥ï¼Œæœ€ç»ˆçš„æ­¥éª¤æ•°é‡å°±ç­‰äºè¿­ä»£æ¬¡æ•°ä¹˜ä»¥å¾ªç¯ä½“ä¸­çš„ä»£ç è¡Œæ•°ã€‚ä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œä¸‹é¢ç»™å‡º<code>readingList()</code>å‡½æ•°å†…çš„ä»£ç çš„æ­¥éª¤æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">readingList</span>(<span class="hljs-params">books</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Here are the books I will read:&#x27;</span>)     <span class="hljs-comment"># 1æ­¥</span><br>    numberOfBooks = <span class="hljs-number">0</span>                            <span class="hljs-comment"># 1æ­¥</span><br>    <span class="hljs-keyword">for</span> book <span class="hljs-keyword">in</span> books:                           <span class="hljs-comment"># å•æ¬¡å¾ªç¯å†…çš„æ­¥éª¤æ•° * n</span><br>        <span class="hljs-built_in">print</span>(book)                              <span class="hljs-comment"># 1æ­¥</span><br>        numberOfBooks += <span class="hljs-number">1</span>                       <span class="hljs-comment"># 1æ­¥</span><br>    <span class="hljs-built_in">print</span>(numberOfBooks, <span class="hljs-string">&#x27;books total.&#x27;</span>)         <span class="hljs-comment"># 1æ­¥</span><br></code></pre></td></tr></table></figure><p>é™¤äº†<code>for</code>å¾ªç¯ï¼Œæ¯è¡Œä»£ç éƒ½è¢«è§†ä½œä¸€ä¸ªæ­¥éª¤ã€‚<code>for</code>å¾ªç¯å¯¹äº<code>books</code>ä¸­çš„æ¯ä¸€é¡¹éƒ½ä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œå› ä¸º<code>books</code>çš„è§„æ¨¡æ˜¯nï¼Œæ‰€ä»¥å®ƒæ‰§è¡Œäº†næ­¥ã€‚ä¸ä»…å¦‚æ­¤ï¼Œ<code>for</code>å¾ªç¯å†…çš„æ‰€æœ‰æ­¥éª¤ä¹Ÿè¢«ä¸€å¹¶æ‰§è¡Œäº†næ¬¡ã€‚å› ä¸ºå¾ªç¯ä¸­å…±æœ‰ä¸¤ä¸ªæ­¥éª¤ï¼Œæ‰€ä»¥æ€»æ­¥éª¤æ•°æ˜¯2 x nã€‚å¯ä»¥è¿™æ ·æè¿°æ­¥éª¤ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">readingList</span>(<span class="hljs-params">books</span>):<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Here are the books I will read:&#x27;</span>)     <span class="hljs-comment"># 1æ­¥</span><br>    numberOfBooks = <span class="hljs-number">0</span>                            <span class="hljs-comment"># 1æ­¥</span><br>    <span class="hljs-keyword">for</span> book <span class="hljs-keyword">in</span> books:                           <span class="hljs-comment"># n * 2 æ­¥</span><br>        <span class="hljs-built_in">print</span>(book)                              <span class="hljs-comment">#ï¼ˆå·²å½’å¹¶è®¡ç®—ï¼‰</span><br>        numberOfBooks += <span class="hljs-number">1</span>                       <span class="hljs-comment">#ï¼ˆå·²å½’å¹¶è®¡ç®—ï¼‰</span><br>    <span class="hljs-built_in">print</span>(numberOfBooks, <span class="hljs-string">&#x27;books total.&#x27;</span>)         <span class="hljs-comment"># 1æ­¥</span><br></code></pre></td></tr></table></figure><p>ã€€ã€€è®¡ç®—æ€»æ­¥éª¤æ•°æ—¶ï¼Œå¾—åˆ°çš„ç»“æœå°±æ˜¯1+1+(n\times2)+1ã€‚è¿™ä¸ªè¡¨è¾¾å¼å¯ä»¥ç®€å†™ä¸º2n+3ã€‚</p><p>ã€€ã€€å¤§Oå¹¶ä¸ä¼šç”¨æ¥æè¿°å…·ä½“ç»†èŠ‚ï¼Œå®ƒåªæ˜¯ä¸€ä¸ªç¬¼ç»Ÿçš„æŒ‡æ ‡ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å»æ‰ä½é˜¶é¡¹ã€‚2n+3ä¸­çš„é˜¶æ•°åŒ…æ‹¬çº¿æ€§é˜¶(2n)å’Œå¸¸æ•°é˜¶(3)ï¼Œæˆ‘ä»¬ä¿ç•™æœ€å¤§çš„é˜¶æ•°ï¼Œä¹Ÿå°±æ˜¯2nã€‚</p><p>ã€€ã€€æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä»ä¸­å»é™¤ç³»æ•°ã€‚2nçš„ç³»æ•°æ˜¯2ï¼Œå»æ‰å®ƒåå°±åªå‰©ä¸‹nã€‚æœ€ç»ˆ<code>readingList()</code>å‡½æ•°çš„å¤§Oé˜¶æ˜¯O(n)ï¼Œä¹Ÿå°±æ˜¯çº¿æ€§æ—¶é—´å¤æ‚åº¦ã€‚</p><p>ã€€ã€€è¿™ä¸ªé˜¶æ•°åº”è¯¥æ˜¯ç»å¾—èµ·æ¨æ•²çš„ã€‚å‡½æ•°è¿è¡Œä¸­æœ‰å¾ˆå¤šæ­¥éª¤ï¼Œæ€»ä½“æ¥è¯´ï¼Œå¦‚æœ<code>books</code>åˆ—è¡¨çš„æ•°é‡å¢å¤§10å€ï¼Œè¿è¡Œæ—¶é—´ä¹Ÿä¼šå¢å¤§åˆ°10å€å·¦å³ã€‚å°†å›¾ä¹¦ä»10æœ¬å¢åŠ åˆ°100æœ¬ï¼Œå¢åŠ å‰çš„æ­¥éª¤æ•°ä¸º1 + 1 + (2 Ã— 10) + 1ï¼Œå³23æ­¥ï¼Œè€Œå¢åŠ ååˆ™ä¸º1 + 1 + (2 Ã— 100) + 1ï¼Œå³203æ­¥ã€‚203å¤§çº¦æ˜¯23çš„10å€ï¼Œæ‰€ä»¥è¿è¡Œæ—¶é—´ç¡®å®æ˜¯éšç€nçš„å¢åŠ æˆæ¯”ä¾‹åœ°å¢åŠ äº†ã€‚</p><h3 id="13-5-1-ä¸ºä»€ä¹ˆä½é˜¶é¡¹å’Œç³»æ•°ä¸é‡è¦"><a href="#13-5-1-ä¸ºä»€ä¹ˆä½é˜¶é¡¹å’Œç³»æ•°ä¸é‡è¦" class="headerlink" title="13.5.1ã€€ä¸ºä»€ä¹ˆä½é˜¶é¡¹å’Œç³»æ•°ä¸é‡è¦"></a>13.5.1ã€€ä¸ºä»€ä¹ˆä½é˜¶é¡¹å’Œç³»æ•°ä¸é‡è¦</h3><p>ã€€ã€€æˆ‘ä»¬åœ¨æ­¥éª¤çš„è®¡ç®—è¿‡ç¨‹ä¸­åˆ é™¤äº†ä½é˜¶é¡¹ï¼Œå› ä¸ºéšç€nçš„å¢é•¿ï¼Œå®ƒä»¬å˜å¾—ä¸é‚£ä¹ˆé‡è¦ã€‚å¦‚æœå°†å‰é¢æåˆ°çš„<code>readingList()</code>å‡½æ•°ä¸­çš„<code>books</code>è§„æ¨¡ä»10å¢åŠ åˆ°10 000 000 000ï¼ˆ100äº¿ï¼‰ï¼Œé‚£ä¹ˆæ­¥éª¤æ•°å°†ä»23å¢åŠ åˆ°20 000 000 003ã€‚ç”±æ­¤å¯è§ï¼Œå½“nè¶³å¤Ÿå¤§æ—¶ï¼Œé¢å¤–å¤šçš„3æ­¥å½±å“ä¸å¤§ã€‚</p><p>ã€€ã€€å½“æ•°æ®é‡å¢åŠ æ—¶ï¼Œä½é˜¶é¡¹å³ä½¿æœ‰è¾ƒå¤§çš„ç³»æ•°ä¹Ÿä¸è¶³ä»¥é€ æˆå¤ªå¤§å½±å“ã€‚å½“nçš„å€¼ä¸€å®šæ—¶ï¼Œé«˜é˜¶å¤æ‚åº¦çš„ä»£ç æ€»æ˜¯æ¯”ä½é˜¶çš„è¿ç®—æ…¢ã€‚å‡è®¾æœ‰ä¸€ä¸ªåä¸º<code>quadraticExample()</code>çš„å‡½æ•°ï¼Œå…¶ç®—æ³•å¤æ‚åº¦ä¸ºO(n^2)ï¼Œå…·ä½“æ­¥éª¤æ•°ä¸º3n^2ã€‚åŒæ—¶ï¼Œå¦æœ‰ä¸€ä¸ªåä¸º<code>linearExample()</code>çš„å‡½æ•°ï¼Œå…¶ç®—æ³•å¤æ‚åº¦ä¸ºO(n)ï¼Œå…·ä½“æ­¥éª¤æ•°ä¸º1000nã€‚ç³»æ•°1000æ¯”ç³»æ•°3å¤§ï¼Œä½†èµ·ä¸äº†ä»€ä¹ˆä½œç”¨ï¼Œéšç€nçš„å¢åŠ ï¼Œæœ€ç»ˆO(n^2)å¹³æ–¹è¿ç®—ä¼šå˜å¾—æ¯”O(n)çº¿æ€§è¿ç®—æ…¢ã€‚å®é™…ä»£ç æ˜¯ä»€ä¹ˆæ ·å¹¶ä¸é‡è¦ï¼Œå¯ä»¥å‡è®¾ä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">quadraticExample</span>(<span class="hljs-params">someData</span>):  <span class="hljs-comment"># someDataçš„è§„æ¨¡æ˜¯n</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> someData:           <span class="hljs-comment"># næ­¥</span><br>        <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> someData:       <span class="hljs-comment"># næ­¥</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Something&#x27;</span>)   <span class="hljs-comment"># 1æ­¥</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Something&#x27;</span>)   <span class="hljs-comment"># 1æ­¥</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Something&#x27;</span>)   <span class="hljs-comment"># 1æ­¥</span><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">linearExample</span>(<span class="hljs-params">someData</span>):     <span class="hljs-comment"># someDataçš„è§„æ¨¡æ˜¯n</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> someData:           <span class="hljs-comment"># n æ­¥</span><br>        <span class="hljs-keyword">for</span> k <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1000</span>):    <span class="hljs-comment"># 1 * 1000 æ­¥</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Something&#x27;</span>)   <span class="hljs-comment"># ï¼ˆå·²å½’å¹¶è®¡ç®—ï¼‰</span><br></code></pre></td></tr></table></figure><p>ä¸<code>quadraticExample()</code>çš„ç³»æ•°ï¼ˆ3ï¼‰ç›¸æ¯”ï¼Œ<code>linearExample()</code>çš„ç³»æ•°å¾ˆå¤§ï¼ˆ1000ï¼‰ã€‚å¦‚æœè¾“å…¥nçš„å¤§å°ä¸º10ï¼Œé‚£ä¹ˆO(n^2)å‡½æ•°åªéœ€è¦300æ­¥ï¼Œè€ŒO(n)å‡½æ•°åˆ™éœ€è¦10 000æ­¥ï¼Œå‰è€…å¿«å¾ˆå¤šã€‚</p><p>ã€€ã€€éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¤§Oè®°æ³•ä¸»è¦å…³æ³¨çš„æ˜¯ç®—æ³•åœ¨å·¥ä½œé‡è¾ƒå¤§æ—¶çš„æ€§èƒ½ã€‚å½“nè¾¾åˆ°334æˆ–ä»¥ä¸Šçš„è§„æ¨¡æ—¶ï¼Œ<code>quadraticExample()</code>å‡½æ•°æ€»æ˜¯æ¯”<code>linearExample()</code>å‡½æ•°æ…¢ã€‚å³ä½¿<code>linearExample()</code>æœ‰1<del>000</del>000næ­¥ï¼Œä¸€æ—¦nè¾¾åˆ°333 334ï¼Œ<code>quadraticExample()</code>å‡½æ•°ä»ç„¶ä¼šæ˜¯æ›´æ…¢çš„é‚£ä¸ªã€‚è€Œåœ¨æŸäº›æ—¶å€™ï¼ŒO(n^2)çš„è¿ç®—ä¼šæ¯”O(n)æˆ–é˜¶æ•°æ›´ä½çš„è¿ç®—æ…¢ã€‚ä¸ºäº†è¯´æ˜è¿™ç§æƒ…å†µï¼Œè¯·çœ‹å›¾13-3ä¸­çš„å¤§Oé˜¶çš„å›¾ç¤ºã€‚è¿™å¼ å›¾å±•ç¤ºäº†æ‰€æœ‰ä¸»è¦çš„å¤§Oé˜¶ã€‚xè½´ä»£è¡¨nï¼Œå³æ•°æ®çš„è§„æ¨¡ï¼Œyè½´ä»£è¡¨è¿›è¡Œè¿ç®—æ‰€éœ€è¦çš„è¿è¡Œæ—¶é—´ã€‚</p><p><img src="/./img/python/image00426.jpg" alt="image00426"></p><p><strong>å›¾13-3ã€€å¤§Oé˜¶å›¾ç¤º</strong></p><p>ã€€ã€€å¦‚å›¾13-3æ‰€ç¤ºï¼Œé«˜é˜¶å¤æ‚åº¦çš„è¿è¡Œæ—¶é—´æ¯”ä½é˜¶çš„è¿è¡Œæ—¶é—´å¢é•¿å¾—å¿«ã€‚è™½ç„¶ä½é˜¶å› æœ‰å¤§ç³»æ•°ä¼šæš‚æ—¶å¤§äºé«˜é˜¶ï¼Œä½†é«˜é˜¶çš„è¿è¡Œæ—¶é—´æœ€ç»ˆè¿˜æ˜¯ä¼šè¶…è¿‡å®ƒä»¬ã€‚</p><h3 id="13-5-2-å¤§Oåˆ†æå®ä¾‹"><a href="#13-5-2-å¤§Oåˆ†æå®ä¾‹" class="headerlink" title="13.5.2ã€€å¤§Oåˆ†æå®ä¾‹"></a>13.5.2ã€€å¤§Oåˆ†æå®ä¾‹</h3><p>ã€€ã€€è®©æˆ‘ä»¬ç¡®å®šç¤ºä¾‹å‡½æ•°çš„å¤§Oé˜¶ã€‚ç¤ºä¾‹ä¼šä½¿ç”¨ä¸€ä¸ªåä¸º<code>books</code>çš„å‚æ•°ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŒ…å«ä¹¦åå­—ç¬¦ä¸²çš„åˆ—è¡¨ã€‚</p><p>ã€€ã€€<code>countBookPoints()</code>å‡½æ•°æ ¹æ®<code>books</code>ä¸­çš„ä¹¦è®¡ç®—å‡ºä¸€ä¸ªåˆ†æ•°ã€‚å¤§å¤šæ•°çš„ä¹¦ä¸º1åˆ†ï¼ŒæŸä½ä½œè€…çš„ä¹¦ä¸º2åˆ†ï¼š</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">def countBookPoints(<span class="hljs-keyword">books):</span><br><span class="hljs-keyword"></span>    points = <span class="hljs-number">0</span>                        <span class="hljs-comment"># 1æ­¥</span><br>    for <span class="hljs-keyword">book </span>in <span class="hljs-keyword">books: </span>               <span class="hljs-comment"># å•æ¬¡å¾ªç¯å†…çš„æ­¥éª¤æ•° * n</span><br>        points += <span class="hljs-number">1</span>                   <span class="hljs-comment"># 1æ­¥</span><br><br>    for <span class="hljs-keyword">book </span>in <span class="hljs-keyword">books: </span>               <span class="hljs-comment"># å•æ¬¡å¾ªç¯å†…çš„æ­¥éª¤æ•° * n</span><br>        if <span class="hljs-string">&#x27;by Al Sweigart&#x27;</span> in <span class="hljs-keyword">book: </span> <span class="hljs-comment"># 1æ­¥</span><br>            points += <span class="hljs-number">1</span>               <span class="hljs-comment"># 1æ­¥</span><br>    return points                     <span class="hljs-comment"># 1æ­¥</span><br></code></pre></td></tr></table></figure><p>ã€€ã€€æ­¥éª¤æ•°ä¸º1+(n x 1)+(n x 2)+1ï¼Œåˆå¹¶åŒç±»é¡¹åå˜æˆ3n+2ï¼Œå»æ‰ä½é˜¶é¡¹å’Œç³»æ•°ååˆ™ä¸ºO(n)ï¼Œä¹Ÿå°±æ˜¯çº¿æ€§å¤æ‚åº¦ã€‚æ— è®ºåœ¨<code>books</code>ä¸­å¾ªç¯1æ¬¡ã€2æ¬¡è¿˜æ˜¯10äº¿æ¬¡ï¼Œå¤æ‚åº¦éƒ½æ˜¯O(n)ã€‚</p><p>ã€€ã€€åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ‰€æœ‰çš„å•å±‚å¾ªç¯ç¤ºä¾‹éƒ½å…·æœ‰çº¿æ€§å¤æ‚åº¦ï¼Œé‚£æ˜¯å› ä¸ºè¿™äº›å¾ªç¯è¿­ä»£äº†næ¬¡ã€‚ä½†æ¥ä¸‹æ¥çš„ç¤ºä¾‹ä¼šè¯´æ˜ï¼Œä»£ç ä¸­ä»…æœ‰ä¸€å±‚å¾ªç¯å¹¶ä¸æ„å‘³ç€ä¸€å®šå…·æœ‰çº¿æ€§å¤æ‚åº¦ï¼Œå°½ç®¡å¯¹æ•°æ®è¿›è¡Œè¿­ä»£çš„å¾ªç¯æœ¬èº«æ˜¯çº¿æ€§çš„ã€‚</p><p>ã€€ã€€<code>iLoveBooks()</code>å‡½æ•°æ‰“å°äº†â€œI LOVE BOOKS!!!â€å’Œâ€œBOOKS ARE GREAT!!!â€å„10æ¬¡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">iLoveBooks</span>(<span class="hljs-params">books</span>):<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">10</span>):              <span class="hljs-comment"># å•æ¬¡å¾ªç¯å†…çš„æ­¥éª¤æ•° * 10</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;I LOVE BOOKS!!!&#x27;</span>)     <span class="hljs-comment"># 1æ­¥</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;BOOKS ARE GREAT!!!&#x27;</span>)  <span class="hljs-comment"># 1æ­¥</span><br></code></pre></td></tr></table></figure><p>è¯¥å‡½æ•°æœ‰ä¸€ä¸ª<code>for</code>å¾ªç¯ï¼Œä½†å¹¶éæ˜¯å¯¹<code>books</code>åˆ—è¡¨çš„å¾ªç¯ï¼Œæ— è®º<code>books</code>çš„å¤§å°å¦‚ä½•ï¼Œå®ƒéƒ½è¦æ‰§è¡Œ20æ­¥ã€‚æˆ‘ä»¬å¯ä»¥å°†æ­¥éª¤æ•°æ”¹å†™ä¸º20(1)ï¼Œå»æ‰ç³»æ•°20åå°±å˜æˆäº†O(1)ï¼Œå³æ’å®šçš„æ—¶é—´å¤æ‚åº¦ã€‚è¿™æ˜¯å¯¹çš„ï¼Œæ— è®º<code>books</code>åˆ—è¡¨çš„å¤§å°å¦‚ä½•ï¼Œè¯¥å‡½æ•°éƒ½éœ€è¦ç›¸åŒçš„è¿è¡Œæ—¶é—´ã€‚</p><p>ã€€ã€€æ¥ä¸‹æ¥ï¼Œå‡è®¾æœ‰ä¸€ä¸ª<code>cheerForFavoriteBook()</code>å‡½æ•°ï¼Œå®ƒçš„ä½œç”¨æ˜¯åœ¨<code>books</code>ä¸­æœç´¢ä¸€æœ¬æœ€å–œæ¬¢çš„ä¹¦ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">cheerForFavoriteBook</span>(<span class="hljs-params">books, favorite</span>):<br>    <span class="hljs-keyword">for</span> book <span class="hljs-keyword">in</span> books:                            <span class="hljs-comment"># å•æ¬¡å¾ªç¯å†…çš„æ­¥éª¤æ•° * n</span><br>        <span class="hljs-built_in">print</span>(book)                               <span class="hljs-comment"># 1æ­¥</span><br>        <span class="hljs-keyword">if</span> book == favorite:                      <span class="hljs-comment"># 1æ­¥</span><br>            <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100</span>):                  <span class="hljs-comment"># å•æ¬¡å¾ªç¯å†…çš„æ­¥éª¤æ•° * 100</span><br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;THIS IS A GREAT BOOK!!!&#x27;</span>)  <span class="hljs-comment"># 1æ­¥</span><br></code></pre></td></tr></table></figure><p><code>for book</code>å¾ªç¯åœ¨<code>books</code>åˆ—è¡¨ä¸Šè¿›è¡Œè¿­ä»£ï¼Œè¿›è¡Œçš„æ­¥éª¤æ•°ä¸ºnä¹˜ä»¥æ¯æ¬¡å¾ªç¯å†…çš„æ­¥éª¤æ•°ã€‚è¯¥å¾ªç¯åˆåŒ…å«äº†ä¸€ä¸ªåµŒå¥—çš„<code>for i</code>å¾ªç¯ï¼Œå®ƒè¿­ä»£äº†100æ¬¡ã€‚è¿™æ„å‘³ç€<code>for book</code>å¾ªç¯è¿è¡Œäº†102 x næ¬¡ï¼Œä¹Ÿå°±æ˜¯102næ¬¡ã€‚å»æ‰ç³»æ•°åå¯ä»¥å‘ç°ï¼Œ<code>cheerForFavoriteBook()</code>ä»ç„¶åªæ˜¯ä¸€ä¸ªO(n)çš„çº¿æ€§æ“ä½œã€‚ç³»æ•°102çœ‹èµ·æ¥å¾ˆå¤§ï¼Œæ€ä¹ˆèƒ½å¿½ç•¥å‘¢ï¼Ÿä½†æ˜¯è¯·ä»”ç»†æƒ³æƒ³ï¼šå¦‚æœ<code>favorite</code>å‹æ ¹å„¿ä¸åœ¨<code>books</code>ä¸­ï¼Œè¿™ä¸ªå‡½æ•°å°±åªä¼šè¿è¡Œ1næ­¥ã€‚ç³»æ•°çš„å½±å“å¾ˆä¸å›ºå®šï¼Œæ‰€ä»¥å®ƒä»¬å¯¹äºç®—æ³•å¤æ‚åº¦çš„è®¡ç®—æ¥è¯´æ²¡æœ‰æ„ä¹‰ã€‚</p><p>ã€€ã€€ä¸‹ä¸€ä¸ªç¤ºä¾‹ï¼Œ<code>findDuplicateBooks()</code>å‡½æ•°ä¸ºæ¯æœ¬ä¹¦ï¼ˆçº¿æ€§æ“ä½œï¼‰åœ¨<code>books</code>åˆ—è¡¨ä¸­æœç´¢ä¸€æ¬¡ï¼ˆä¹Ÿæ˜¯çº¿æ€§æ“ä½œï¼‰ï¼š</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">def findDuplicateBooks(<span class="hljs-keyword">books):</span><br><span class="hljs-keyword"></span>    for i in range(<span class="hljs-keyword">books): </span>                    <span class="hljs-comment"># næ­¥</span><br>        for <span class="hljs-keyword">j </span>in range(i + <span class="hljs-number">1</span>, <span class="hljs-keyword">books): </span>         <span class="hljs-comment"># næ­¥</span><br>            if <span class="hljs-keyword">books[i] </span>== <span class="hljs-keyword">books[j]: </span>          <span class="hljs-comment"># 1æ­¥</span><br>                print(<span class="hljs-string">&#x27;Duplicate:&#x27;</span>, <span class="hljs-keyword">books[i]) </span> <span class="hljs-comment"># 1æ­¥</span><br></code></pre></td></tr></table></figure><p><code>for i</code>å¾ªç¯éå†æ•´ä¸ª<code>books</code>åˆ—è¡¨ï¼Œåœ¨æ¯ä¸ªå¾ªç¯å†…æ‰§è¡Œnæ­¥æ“ä½œã€‚<code>for j</code>å¾ªç¯å¯¹<code>books</code>åˆ—è¡¨çš„éƒ¨åˆ†è¿›è¡Œè¿­ä»£ï¼Œå½“å»é™¤ç³»æ•°æ—¶ï¼Œä¹Ÿå¯ä»¥å°†å…¶è§†ä¸ºçº¿æ€§æ“ä½œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>for i</code>å¾ªç¯è¿›è¡Œäº†n x næ­¥æ“ä½œï¼Œä¹Ÿå°±æ˜¯n^2ã€‚è¿™ä½¿å¾—<code>findDuplicateBooks()</code>æˆä¸ºO(n^2)çš„å¤šé¡¹å¼æ“ä½œã€‚</p><p>ã€€ã€€é‡åˆ°åµŒå¥—å¾ªç¯å¹¶ä¸éƒ½æ„å‘³ç€å®ƒå°±æ˜¯å¤šé¡¹å¼æ“ä½œï¼Œåªæœ‰å½“ä¸¤ä¸ªå¾ªç¯éƒ½è¿­ä»£næ¬¡æ—¶æ‰æ˜¯ã€‚è¿™å¯¼è‡´äº†n^2æ­¥ï¼Œä»£è¡¨è¿™æ˜¯O(n^2)çš„æ“ä½œã€‚</p><p>ã€€ã€€æ¥çœ‹ä¸€ä¸ªå…·æœ‰æŒ‘æˆ˜æ€§çš„ç¤ºä¾‹ã€‚å‰æ–‡æåˆ°è¿‡äºŒåˆ†æœç´¢ç®—æ³•ï¼Œå®ƒçš„å·¥ä½œåŸç†æ˜¯åœ¨ä¸€ä¸ªæœ‰åºåˆ—è¡¨ï¼ˆæˆ‘ä»¬ç§°ä¹‹ä¸º<code>haystack</code>ï¼‰çš„ä¸­é—´ä½ç½®æ£€æŸ¥æ˜¯å¦å­˜åœ¨æŸä¸ªç‰¹å®šçš„é¡¹ç›®ï¼ˆæˆ‘ä»¬ç§°ä¹‹ä¸º<code>needle</code>ï¼‰ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ç»§ç»­æœç´¢<code>haystack</code>çš„å‰ä¸€åŠæˆ–è€…åä¸€åŠï¼Œè¿™å–å†³äºå¾…æœç´¢é¡¹ç›®çš„ä½ç½®ç›¸è¾ƒäºä¸­é—´ä½ç½®çš„é¡¹ç›®æ˜¯æ›´é å‰è¿˜æ˜¯æ›´é åã€‚æˆ‘ä»¬ä¼šä¸åœé‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œæœç´¢ä¸€åŠçš„ä¸€åŠçš„ä¸€åŠâ€¦â€¦ç›´åˆ°æ‰¾åˆ°<code>needle</code>æˆ–è€…æ–­å®šå®ƒä¸åœ¨<code>haystack</code>ä¸­ã€‚æ³¨æ„ï¼ŒäºŒåˆ†æœç´¢åªæœ‰åœ¨åˆ—è¡¨ä¸­çš„é¡¹ç›®æ˜¯æœ‰åºçš„æ—¶å€™æ‰æœ‰æ•ˆã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">binarySearch</span>(<span class="hljs-params">needle, haystack</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> <span class="hljs-built_in">len</span>(haystack):                                        <span class="hljs-comment"># 1æ­¥</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span>                                              <span class="hljs-comment"># 1æ­¥</span><br>    startIndex = <span class="hljs-number">0</span>                                               <span class="hljs-comment"># 1æ­¥</span><br>    endIndex = <span class="hljs-built_in">len</span>(haystack) - <span class="hljs-number">1</span>                                 <span class="hljs-comment"># 1æ­¥</span><br><br>    haystack.sort()                                              <span class="hljs-comment"># ???æ­¥</span><br><br>    <span class="hljs-keyword">while</span> start &lt;= end:                                          <span class="hljs-comment"># ???æ­¥</span><br>        midIndex = (startIndex + endIndex) // <span class="hljs-number">2</span>                  <span class="hljs-comment"># 1æ­¥</span><br>        <span class="hljs-keyword">if</span> haystack[midIndex] == needle:                         <span class="hljs-comment"># 1æ­¥</span><br>            <span class="hljs-comment"># æ‰¾åˆ°needle</span><br>            <span class="hljs-keyword">return</span> midIndex                                      <span class="hljs-comment"># 1æ­¥</span><br>        <span class="hljs-keyword">elif</span> needle &lt; haystack[midIndex]:                        <span class="hljs-comment"># 1æ­¥</span><br>            <span class="hljs-comment"># æœç´¢å‰ä¸€åŠ</span><br>            endIndex = midIndex - <span class="hljs-number">1</span>                              <span class="hljs-comment"># 1æ­¥</span><br>        <span class="hljs-keyword">elif</span> needle &gt; haystack[mid]:                             <span class="hljs-comment"># 1æ­¥</span><br>            <span class="hljs-comment"># æœç´¢åä¸€åŠ</span><br>            startIndex = midIndex + <span class="hljs-number">1</span>                            <span class="hljs-comment"># 1æ­¥</span><br></code></pre></td></tr></table></figure><p>ã€€ã€€<code>binarySearch()</code>ä¸­æœ‰ä¸¤è¡Œä¸æ˜“è®¡ç®—æ­¥æ•°çš„ä»£ç ã€‚<code>haystack.sort()</code>è°ƒç”¨çš„å¤§Oé˜¶å–å†³äºPythonçš„<code>sort()</code>æ–¹æ³•å†…çš„ä»£ç ã€‚è¿™æ®µä»£ç ä¸å®¹æ˜“æ‰¾åˆ°ï¼Œä¸è¿‡è¿˜æ˜¯å¯ä»¥ç»ç½‘ä¸ŠæŸ¥æ‰¾å¾—çŸ¥å®ƒæ˜¯O(n\log n)]æ“ä½œã€‚æ‰€æœ‰ä¸€èˆ¬çš„æ’åºå‡½æ•°è‡³å°‘æ˜¯O(n\log n)]æ“ä½œã€‚13.5.3èŠ‚å°†ä»‹ç»å‡ ä¸ªå¸¸è§çš„Pythonå‡½æ•°å’Œæ–¹æ³•çš„å¤§Oé˜¶ã€‚</p><p>ã€€ã€€<code>while</code>å¾ªç¯ä¸åƒä¹‹å‰æˆ‘ä»¬çœ‹åˆ°çš„<code>for</code>å¾ªç¯é‚£æ ·å®¹æ˜“åˆ†æã€‚æˆ‘ä»¬å¿…é¡»å…ˆäº†è§£äºŒåˆ†æœç´¢ç®—æ³•ï¼Œç¡®å®šè¯¥å¾ªç¯å…±æœ‰å¤šå°‘æ¬¡è¿­ä»£ã€‚åœ¨å¾ªç¯å¼€å§‹å‰ï¼Œ<code>startIndex</code>å’Œ<code>endIndex</code>åˆ†åˆ«åœ¨<code>haystack</code>çš„å¤´å’Œå°¾ï¼Œ<code>midIndex</code>è¢«è®¾ç½®åœ¨<code>haystack</code>èŒƒå›´çš„ä¸­ç‚¹ã€‚åœ¨<code>while</code>å¾ªç¯çš„æ¯æ¬¡è¿­ä»£ä¸­ï¼Œæœ‰ä¸¤ä»¶å¯èƒ½å‘ç”Ÿçš„äº‹æƒ…ã€‚å¦‚æœ<code>haystack[midIndex] == needle</code>ï¼Œæˆ‘ä»¬å°±æ‰¾åˆ°äº†<code>needle</code>ï¼Œå‡½æ•°ä¼šè¿”å›<code>needle</code>çš„ç´¢å¼•ã€‚å¦‚æœ<code>needle &lt; haystack[midIndex]</code>æˆ–<code>needle &gt; haystack[midIndex]</code>ï¼Œåˆ™å°†<code>startIndex</code>å’Œ<code>endIndex</code>æ‰€è¦†ç›–çš„èŒƒå›´å‡åŠã€‚èŒƒå›´å‡åŠå¯ä»¥é€šè¿‡è°ƒæ•´<code>startIndex</code>æˆ–<code>endIndex</code>æ¥å®ç°ã€‚æˆ‘ä»¬å°†é•¿åº¦ä¸ºnçš„åˆ—è¡¨åˆ†ä¸ºä¸€åŠçš„æ¬¡æ•°æœ‰\log_2(n)æ¬¡ï¼ˆè¿™æ˜¯ä¸€ä¸ªæ•°å­¦å¸¸è¯†ï¼‰ã€‚å› æ­¤ï¼Œ<code>while</code>å¾ªç¯çš„é˜¶æ•°è¾ƒå¤§ï¼Œæ˜¯O(\log n)ã€‚</p><p>ã€€ã€€ç”±äº<code>haystack.sort()</code>è¡Œçš„O(n\log n)]é˜¶å¤§äºO(\log n)é˜¶ï¼Œå› æ­¤æˆ‘ä»¬èˆå»è¾ƒå°çš„O(\log n)ï¼Œæ•´ä¸ª<code>binarySearch()</code>å‡½æ•°ä¸ºO(n\log n)]é˜¶ã€‚å¦‚æœå¯ä»¥ä¿è¯<code>binarySearch()</code>åªä¼šåœ¨<code>haystack</code>ä¸ºæœ‰åºåˆ—è¡¨æ—¶è°ƒç”¨ï¼Œé‚£å°±å¯ä»¥åˆ é™¤<code>haystack.sort()</code>è¡Œï¼Œä½¿<code>binarySearch()</code>æˆä¸ºä¸€ä¸ªO(\log n)é˜¶å‡½æ•°ã€‚ä»æŠ€æœ¯ä¸Šçœ‹ï¼Œè¿™ç¡®å®æé«˜äº†å‡½æ•°çš„æ•ˆç‡ï¼Œä½†æ•´ä¸ªç¨‹åºçš„æ•ˆç‡å¹¶æœªæå‡ï¼Œå› ä¸ºè¿™ç§åšæ³•åªæ˜¯å°†å¿…è¦çš„æ’åºå·¥ä½œè½¬ç§»åˆ°äº†ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†ã€‚å¤§å¤šæ•°äºŒåˆ†æœç´¢çš„å®ç°çœç•¥äº†æ’åºçš„æ­¥éª¤ï¼Œå› æ­¤äºŒåˆ†æœç´¢ç®—æ³•è¢«è§†ä¸ºå…·æœ‰O(\log n)çš„å¤æ‚åº¦ã€‚</p><h3 id="13-5-3-å¸¸è§å‡½æ•°è°ƒç”¨çš„å¤§Oé˜¶"><a href="#13-5-3-å¸¸è§å‡½æ•°è°ƒç”¨çš„å¤§Oé˜¶" class="headerlink" title="13.5.3ã€€å¸¸è§å‡½æ•°è°ƒç”¨çš„å¤§Oé˜¶"></a>13.5.3ã€€å¸¸è§å‡½æ•°è°ƒç”¨çš„å¤§Oé˜¶</h3><p>ã€€ã€€å¯¹ä»£ç è¿›è¡Œå¤§Oåˆ†æå¿…é¡»è€ƒè™‘å®ƒè°ƒç”¨çš„ä»»ä½•å‡½æ•°çš„å¤§Oé˜¶ã€‚å¦‚æœå®ƒä»¬æ˜¯ä½ å†™çš„ï¼Œä½ å½“ç„¶å¯ä»¥ç›´æ¥åˆ†æè‡ªå·±çš„ä»£ç ã€‚ä½†å¯¹äºPythonå†…ç½®å‡½æ•°å’Œæ–¹æ³•çš„å¤§Oé˜¶ï¼Œä½ å¿…é¡»å‚è€ƒä¸‹é¢çš„åˆ—è¡¨ã€‚</p><p>ã€€ã€€è¿™ä¸ªåˆ—è¡¨åŒ…å«äº†Pythonåºåˆ—ç±»å‹ï¼Œæ¯”å¦‚å­—ç¬¦ä¸²ã€å…ƒç»„å’Œåˆ—è¡¨çš„ä¸€äº›å¸¸è§æ“ä½œçš„å¤§Oé˜¶ã€‚</p><ul><li><strong><code>s[i]</code><strong>è¯»å’Œ</strong><code>s[i] = value</code>èµ‹å€¼</strong>æ˜¯O(1)æ“ä½œã€‚</li><li>**<code>s.append(value)</code>**æ˜¯O(1)æ“ä½œã€‚</li><li>**<code>s.insert(i, value)</code>**æ˜¯O(n)æ“ä½œã€‚åœ¨ä¸€ä¸ªåºåˆ—ä¸­æ’å…¥å€¼ï¼ˆç‰¹åˆ«æ˜¯åœ¨å‰é¢ï¼‰éœ€è¦å°†ç´¢å¼•å¤§äº<code>i</code>çš„æ‰€æœ‰é¡¹åœ¨åºåˆ—ä¸­å‘åç§»åŠ¨ä¸€ä¸ªä½ç½®ã€‚</li><li>**<code>s.remove(value)</code>**æ˜¯O(n)æ“ä½œã€‚ä»ä¸€ä¸ªåºåˆ—ä¸­ç§»é™¤å€¼ï¼ˆç‰¹åˆ«æ˜¯åœ¨å‰é¢ï¼‰éœ€è¦å°†ç´¢å¼•å¤§äº<code>i</code>çš„æ‰€æœ‰é¡¹åœ¨åºåˆ—ä¸­å‘å‰ç§»åŠ¨ä¸€ä¸ªä½ç½®ã€‚</li><li>**<code>s.reverse()</code>**æ˜¯O(n)æ“ä½œï¼Œå› ä¸ºåºåˆ—ä¸­çš„æ¯ä¸€é¡¹éƒ½å¿…é¡»è¢«é‡æ–°æ’åˆ—ã€‚</li><li>**<code>s.sort()</code>**æ˜¯O(n\log n)]æ“ä½œï¼Œå› ä¸ºPythonçš„æ’åºç®—æ³•å…·æœ‰O(n\log n)]é˜¶ã€‚</li><li>**<code>value in s</code>**æ˜¯O(n)æ“ä½œï¼Œå› ä¸ºå¿…é¡»æ£€æŸ¥æ¯ä¸€é¡¹ã€‚</li><li>**<code>for value in s</code>**æ˜¯O(n)æ“ä½œã€‚</li><li>**<code>len(s)</code>**æ˜¯O(1)æ“ä½œï¼Œå› ä¸ºPythonä¼šé¢å¤–è®°å½•ä¸€ä¸ªåºåˆ—ä¸­æœ‰å¤šå°‘é¡¹ï¼Œæ‰€ä»¥å½“å®ƒè¢«ä¼ é€’ç»™<code>len()</code>æ—¶ï¼Œä¸éœ€è¦è¿›è¡Œé‡æ–°è®¡ç®—ã€‚</li></ul><p>ã€€ã€€ä¸‹é¢è¿™ä¸ªåˆ—è¡¨åŒ…å«äº†Pythonæ˜ å°„ç±»å‹ï¼Œæ¯”å¦‚å­—å…¸ã€é›†åˆå’Œä¸å¯å˜é›†åˆçš„ä¸€äº›å¸¸è§æ“ä½œçš„å¤§Oé˜¶ã€‚</p><ul><li><strong><code>m[key]</code><strong>è¯»å’Œ</strong><code>m[key] = value</code>èµ‹å€¼</strong>æ˜¯O(1)æ“ä½œã€‚</li><li>**<code>m.add(value)</code>**æ˜¯O(1)æ“ä½œã€‚</li><li>**<code>value in m</code>**å¯¹å­—å…¸è€Œè¨€æ˜¯O(1)æ“ä½œï¼Œæ¯”åœ¨åºåˆ—ä¸­ä½¿ç”¨å¿«å¾—å¤šã€‚</li><li>**<code>for key in m</code>**æ˜¯O(n)æ“ä½œã€‚</li><li>**<code>len(m)</code>**æ˜¯O(1)æ“ä½œï¼Œå› ä¸ºPythonä¼šè‡ªåŠ¨è·Ÿè¸ªæ˜ å°„ä¸­çš„é¡¹æ•°ï¼Œæ‰€ä»¥å½“å®ƒè¢«ä¼ é€’ç»™<code>len()</code>æ—¶ï¼Œä¸éœ€è¦è¿›è¡Œé‡å¤è®¡ç®—ã€‚</li></ul><p>ã€€ã€€åˆ—è¡¨éœ€è¦ä»å¤´åˆ°å°¾é€ä¸ªæœç´¢é¡¹ï¼Œè€Œå­—å…¸ä½¿ç”¨é”®è®¡ç®—å€¼çš„åœ°å€ï¼ŒæŸ¥æ‰¾æŸä¸ªé”®å¯¹åº”çš„å€¼çš„æ—¶é—´æ˜¯ä¸å˜çš„ã€‚è¿™ç§è®¡ç®—çš„è¿‡ç¨‹è¢«ç§°ä¸ºå“ˆå¸Œç®—æ³•ï¼Œè®¡ç®—æ‰€å¾—çš„åœ°å€åˆ™è¢«ç§°ä¸ºå“ˆå¸Œå€¼ã€‚å“ˆå¸Œç®—æ³•è¶…å‡ºäº†æœ¬ä¹¦çš„èŒƒå›´ï¼Œå®ƒæ˜¯è®¸å¤šæ˜ å°„æ“ä½œèƒ½ä¿æŒO(1)æ’å®šæ—¶é—´çš„åŸå› æ‰€åœ¨ã€‚é›†åˆä¹Ÿä¼šä½¿ç”¨å“ˆå¸Œç®—æ³•ï¼Œå› ä¸ºå®ƒæœ¬è´¨ä¸Šæ˜¯åªæœ‰é”®è€Œéé”®âˆ’å€¼å¯¹çš„å­—å…¸ã€‚è®°ä½ï¼Œå°†åˆ—è¡¨è½¬æ¢ä¸ºé›†åˆæ˜¯ä¸€ä¸ªO(n)æ“ä½œï¼Œæ‰€ä»¥å…ˆå°†åˆ—è¡¨è½¬æ¢ä¸ºé›†åˆï¼Œå†è®¿é—®é›†åˆä¸­çš„é¡¹å¯¹äºæå‡æ•ˆç‡è€Œè¨€æ¯«æ— æ„ä¹‰ã€‚</p><h3 id="13-5-4-ä¸€çœ¼çœ‹å‡ºå¤§Oé˜¶"><a href="#13-5-4-ä¸€çœ¼çœ‹å‡ºå¤§Oé˜¶" class="headerlink" title="13.5.4ã€€ä¸€çœ¼çœ‹å‡ºå¤§Oé˜¶"></a>13.5.4ã€€ä¸€çœ¼çœ‹å‡ºå¤§Oé˜¶</h3><p>ã€€ã€€ä¸€æ—¦ç†Ÿæ‚‰äº†å¤§Oåˆ†æï¼Œé€šå¸¸å°±ä¸ç”¨æŒ‰ç…§æ­¥éª¤ä¸€æ­¥æ­¥åšäº†ã€‚ä¸€æ®µæ—¶é—´åï¼Œä½ å°±å¯ä»¥åœ¨ä»£ç ä¸­å¯»æ‰¾ä¸€äº›è››ä¸é©¬è¿¹ä»¥å¿«é€Ÿç¡®å®šå¤§Oé˜¶ã€‚</p><p>ã€€ã€€è®°ä½ï¼Œnæ˜¯ä»£ç å¤„ç†çš„æ•°æ®é‡ã€‚è¿™é‡Œæœ‰ä¸€äº›é€šç”¨è§„åˆ™ã€‚</p><ul><li>â€‹    </li><li>å¦‚æœä»£ç ä¸è®¿é—®æ•°æ®ï¼Œé˜¶æ•°å°±æ˜¯O(1)ã€‚</li><li>â€‹    </li><li>å¦‚æœä»£ç éå†æ•°æ®ï¼Œé˜¶æ•°å°±æ˜¯O(n)ã€‚</li><li>â€‹    </li><li>å¦‚æœä»£ç æœ‰ä¸¤ä¸ªåµŒå¥—çš„å¾ªç¯ï¼Œæ¯ä¸ªå¾ªç¯éƒ½å¯¹æ•°æ®è¿›è¡Œè¿­ä»£ï¼Œé˜¶æ•°å°±æ˜¯O(n^2)ã€‚</li><li>â€‹    </li><li>å‡½æ•°è°ƒç”¨ä¸èƒ½åªç®—ä½œä¸€ä¸ªæ­¥éª¤ï¼Œè€Œæ˜¯è¦è®¡ç®—è¯¥å‡½æ•°å†…éƒ¨ä»£ç çš„æ­¥éª¤ã€‚å¯ä»¥æŸ¥é˜…13.5.3èŠ‚ã€‚</li><li>â€‹    </li><li>å¦‚æœä»£ç ä¸­å­˜åœ¨é‡å¤å°†æ•°æ®è§„æ¨¡å‡åŠå†å¤„ç†çš„æ­¥éª¤ï¼Œé˜¶æ•°å°±æ˜¯O(\log n)ã€‚</li><li>â€‹    </li><li>å¦‚æœä»£ç ä¸­å¯¹äºæ•°æ®ä¸­çš„æ¯ä¸€é¡¹éƒ½æœ‰è¿›è¡Œåˆ†æ²»å†å¤„ç†çš„æ­¥éª¤ï¼Œé˜¶æ•°å°±æ˜¯O(n\log n)]ã€‚</li><li>â€‹    </li><li>å¦‚æœä»£ç éå†æ•°æ®ä¸­æ‰€æœ‰å¯èƒ½çš„å€¼çš„ç»„åˆï¼Œé˜¶æ•°å°±æ˜¯O(2^n)æˆ–å…¶ä»–æŒ‡æ•°çº§ã€‚</li><li>â€‹    </li><li>å¦‚æœä»£ç æŸ¥çœ‹äº†æ•°æ®ä¸­æ¯ä¸ªå¯èƒ½çš„å€¼çš„æ’åˆ—ç»„åˆï¼Œé˜¶æ•°å°±æ˜¯O(n!)ã€‚</li><li>â€‹    </li><li>å¦‚æœä»£ç æ¶‰åŠå¯¹æ•°æ®æ’åºï¼Œé‚£ä¹ˆé˜¶æ•°è‡³å°‘æ˜¯O(n\log n)]ã€‚</li></ul><p>ã€€ã€€è¿™äº›è§„åˆ™å¯ä»¥å½“ä½œå¾ˆå¥½çš„åˆ†æèµ·ç‚¹ï¼Œä½†å®ƒä»¬ä¸èƒ½ä»£æ›¿å®é™…çš„å¤§Oåˆ†æã€‚éœ€è¦è®°ä½ï¼Œå¤§Oé˜¶ä¸æ˜¯å¯¹ä»£ç çš„é€Ÿåº¦å¿«æ…¢ã€æ˜¯å¦é«˜æ•ˆçš„æœ€ç»ˆåˆ¤æ–­ã€‚æ€è€ƒä¸‹é¢è¿™ä¸ª<code>waitAnHour()</code>å‡½æ•°ï¼š</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">import</span> <span class="hljs-type">time</span><br>def waitAnHour():<br>    <span class="hljs-type">time</span>.sleep(<span class="hljs-number">3600</span>)<br></code></pre></td></tr></table></figure><p>ã€€ã€€ä»æŠ€æœ¯ä¸Šè®²ï¼Œ<code>waitAnHour()</code>å‡½æ•°çš„æ—¶é—´å¤æ‚åº¦æ˜¯å›ºå®šçš„O(1)ã€‚ä¸€èˆ¬ä¼šè®¤ä¸ºå›ºå®šæ—¶é—´å¤æ‚åº¦çš„ä»£ç æ˜¯å¿«é€Ÿçš„ï¼Œä½†å®ƒçš„è¿è¡Œæ—¶é—´æ˜¯ä¸€å°æ—¶ï¼è¿™æ˜¯å¦æ„å‘³ç€è¿™æ®µä»£ç æ•ˆç‡ä½ï¼Ÿä¸ï¼Œå®é™…ä¸Šä½ ä¸å¯èƒ½ç¼–å†™å‡ºä¸€ä¸ªè¿è¡Œæ—¶é—´æ¯”ä¸€å°æ—¶è¿˜çŸ­çš„<code>waitAnHour()</code>å‡½æ•°ã€‚</p><p>ã€€ã€€å¤§Oå¹¶ä¸æ˜¯ä»£ç åˆ†æçš„å…¨éƒ¨ï¼Œå®ƒçš„æ„ä¹‰åœ¨äºä½¿ä½ äº†è§£ä»£ç åœ¨é‡åˆ°è¶Šæ¥è¶Šå¤šçš„è¾“å…¥æ•°æ®æ—¶ä¼šæœ‰æ€æ ·çš„è¡¨ç°ã€‚</p><h3 id="13-5-5-å½“nå¾ˆå°æ—¶ï¼Œå¤§Oå¹¶ä¸é‡è¦ï¼Œè€Œné€šå¸¸éƒ½å¾ˆå°"><a href="#13-5-5-å½“nå¾ˆå°æ—¶ï¼Œå¤§Oå¹¶ä¸é‡è¦ï¼Œè€Œné€šå¸¸éƒ½å¾ˆå°" class="headerlink" title="13.5.5ã€€å½“nå¾ˆå°æ—¶ï¼Œå¤§Oå¹¶ä¸é‡è¦ï¼Œè€Œné€šå¸¸éƒ½å¾ˆå°"></a>13.5.5ã€€å½“nå¾ˆå°æ—¶ï¼Œå¤§Oå¹¶ä¸é‡è¦ï¼Œè€Œné€šå¸¸éƒ½å¾ˆå°</h3><p>ã€€ã€€æŒæ¡äº†å¤§Oè®°æ³•çš„çŸ¥è¯†åï¼Œä½ å¯èƒ½è¿«ä¸åŠå¾…åœ°æƒ³å¯¹ä½ å†™çš„æ¯ä¸€æ®µä»£ç è¿›è¡Œåˆ†æã€‚åœ¨ä½ å¼€å§‹ä½¿ç”¨è¿™ä¸ªå·¥å…·æ¥æ•²æ‰çœ¼ä¸­é’‰å‰ï¼Œè¯·è®°ä½ï¼Œä»…å½“æœ‰å¤§é‡æ•°æ®éœ€è¦å¤„ç†æ—¶ï¼Œå¤§Oåˆ†ææ‰æœ‰ä»·å€¼ã€‚è€Œåœ¨ç°å®é—®é¢˜ä¸­ï¼Œæ•°æ®é‡é€šå¸¸å¾ˆå°ã€‚</p><p>ã€€ã€€åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè´¹å°½å¿ƒæ€è®¾è®¡å¤§Oé˜¶è¾ƒä½çš„å¤æ‚ç®—æ³•å¯èƒ½å¹¶ä¸å€¼å¾—ã€‚Goè¯­è¨€ç¼–ç¨‹è®¾è®¡è€…Rob Pikeæå‡ºè¿‡5æ¡å…³äºç¼–ç¨‹çš„è§„åˆ™ï¼Œå…¶ä¸­ä¸€æ¡å°±æ˜¯â€œå½“nå°çš„æ—¶å€™ï¼ŒèŠ±å“¨çš„ç®—æ³•ä¼šå¾ˆæ…¢ï¼Œè€Œné€šå¸¸æ˜¯å°çš„â€ã€‚å¤§å¤šæ•°ç¨‹åºå‘˜ä¸ä¼šé¢å¯¹å¤§è§„æ¨¡çš„æ•°æ®ä¸­å¿ƒæˆ–è€…å¤æ‚çš„è®¡ç®—ï¼Œè€Œæ˜¯å¤„ç†æ›´æ™®é€šçš„ç¨‹åºã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåœ¨åˆ†æå™¨ä¸‹è¿è¡Œä»£ç ä¼šæ¯”è¿›è¡Œå¤§Oåˆ†æäº§å‡ºæ›´å¤šæœ‰å…³ä»£ç æ€§èƒ½çš„å…·ä½“ä¿¡æ¯ã€‚</p><h2 id="13-6-å°ç»“"><a href="#13-6-å°ç»“" class="headerlink" title="13.6ã€€å°ç»“"></a>13.6ã€€å°ç»“</h2><p>ã€€ã€€Pythonæ ‡å‡†åº“ä¸­æœ‰ä¸¤ä¸ªç”¨äºåˆ†æä»£ç çš„æ¨¡å—ï¼š<code>timeit</code>å’Œ<code>cProfile</code>ã€‚<code>timeit.timeit()</code>å‡½æ•°åœ¨è¿è¡Œå¹¶å¯¹æ¯”å°æ®µä»£ç çš„é€Ÿåº¦å·®å¼‚æ—¶æ¯”è¾ƒæœ‰ä¼˜åŠ¿ã€‚è€Œ<code>cProfile.run()</code>å‡½æ•°å¯ä»¥ä¸ºè¾ƒå¤§çš„å‡½æ•°ç¼–å†™å‡ºè¯¦ç»†çš„æŠ¥å‘Šï¼ŒæŒ‡å‡ºå…¶ç“¶é¢ˆæ‰€åœ¨ã€‚</p><p>ã€€ã€€æµ‹é‡ä»£ç æ€§èƒ½å¾ˆé‡è¦ï¼Œä¸è¦è‡†æ–­ã€‚è™½ç„¶å¯ä»¥ä½¿ç”¨å·§å¦™çš„æŠ€å·§æ¥æå‡ç¨‹åºçš„æ•ˆç‡ï¼Œä½†è¿™ç§åšæ³•å¯èƒ½ä¼šè®©ç¨‹åºæ›´æ…¢ã€‚ä¸ºäº†é¿å…èŠ±è´¹ä¸å¿…è¦çš„æ—¶é—´ä¼˜åŒ–ç¨‹åºä¸­ä¸é‡è¦çš„éƒ¨åˆ†ï¼Œé˜¿å§†è¾¾å°”å®šå¾‹åœ¨æ•°å­¦ä¸Šç»™å‡ºäº†è§£å†³æ–¹æ¡ˆï¼Œè¯¥å…¬å¼æè¿°äº†ä¸€ä¸ªç»„ä»¶çš„æ•ˆç‡æå‡å¯¹æ•´ä¸ªç¨‹åºçš„å¢ç›Šã€‚</p><p>ã€€ã€€å¤§Oæ˜¯ç¨‹åºå‘˜åœ¨è®¡ç®—æœºç§‘å­¦ä¸­ä½¿ç”¨æœ€å¹¿æ³›çš„å®ç”¨æ¦‚å¿µã€‚è¿™éœ€è¦ä¸€äº›æ•°å­¦çŸ¥è¯†æ‰èƒ½ç†è§£ï¼Œä½†æ˜ç™½ä¸€äº›åŸºæœ¬æ¦‚å¿µå°±å¯ä»¥è¡¡é‡ä»£ç æ˜¯å¦‚ä½•éšç€æ•°æ®å¢é•¿è€Œå˜æ…¢çš„ï¼Œè¿™å¹¶ä¸éœ€è¦è¿›è¡Œå¤§é‡çš„æ•°å­—è¿ç®—ã€‚</p><p>ã€€ã€€å¸¸è§çš„å¤§Oé˜¶æœ‰7ç§ï¼šO(1)ï¼Œå³æ’å®šæ—¶é—´ï¼ŒæŒ‡éšç€æ•°æ®nçš„å¤§å°å¢é•¿è€Œä¸å‘ç”Ÿå˜åŒ–çš„ä»£ç ï¼›O(\log n)ï¼Œå³å¯¹æ•°æ—¶é—´ï¼ŒæŒ‡éšç€nç¿»å€è€Œå¢åŠ ä¸€æ­¥çš„ä»£ç ï¼›O(n)ï¼Œå³çº¿æ€§æ—¶é—´ï¼Œæè¿°çš„æ˜¯éšç€nçš„å¢é•¿æˆæ¯”ä¾‹å˜æ…¢çš„ä»£ç ï¼›O(n\log n)]ï¼Œå³çº¿æ€§å¯¹æ•°æ—¶é—´ï¼Œæè¿°çš„æ˜¯æ¯”O(n)æ…¢ä¸€ç‚¹çš„ä»£ç ï¼Œè®¸å¤šæ’åºç®—æ³•æ˜¯è¿™ä¸ªé˜¶æ•°ï¼›O(n^2)ï¼Œå³å¤šé¡¹å¼æ—¶é—´ï¼ˆå¹³æ–¹ï¼‰ï¼ŒæŒ‡ä»£ç çš„è¿è¡Œæ—¶é—´ä»¥nè¾“å…¥æ•°æ®çš„å¹³æ–¹å¢åŠ ï¼›O(2^n)ï¼Œå³æŒ‡æ•°æ—¶é—´ï¼›O(n!)ï¼Œå³é˜¶ä¹˜æ—¶é—´ã€‚é˜¶ä¹˜æ—¶é—´å¹¶ä¸å¸¸è§ï¼Œä½†ä¼šå‡ºç°åœ¨æ¶‰åŠç»„åˆæˆ–æ’åˆ—ç»„åˆçš„æ—¶å€™ã€‚æ›´é«˜çš„é˜¶æ•°æ„å‘³ç€æ›´æ…¢ï¼Œå› ä¸ºè¿è¡Œæ—¶é—´çš„å¢é•¿é€Ÿåº¦è¿œå¤§äºå…¶è¾“å…¥æ•°æ®çš„å¤§å°ã€‚</p><p>ã€€ã€€éœ€è¦æ³¨æ„ï¼Œå°½ç®¡å¤§Oå·²ç»æ˜¯ä¸€ä¸ªåˆ†æåˆ©å™¨äº†ï¼Œä½†å®ƒä¸èƒ½ä»£æ›¿åˆ†æå™¨ï¼Œå› ä¸ºåˆ†æå™¨å¯ä»¥è¿è¡Œä»£ç ä»¥æ‰¾å‡ºç“¶é¢ˆæ‰€åœ¨ï¼Œå®ƒä»æ˜¯ä¸å¯æˆ–ç¼ºçš„ã€‚ä½†æ˜¯ï¼Œäº†è§£å¤§Oåˆ†æä»¥åŠä»£ç å¦‚ä½•éšç€æ•°æ®å¢é•¿è€Œå˜æ…¢ï¼Œå¯ä»¥è®©ä½ é¿å…ç¼–å†™æœ¬ä¸è¯¥æ…¢çš„ä»£ç ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€pythonã€‘è¯»ä¹¦ç¬”è®°ä¹‹ç¼–å†™é«˜æ•ˆå‡½æ•°ï¼ˆåï¼‰</title>
    <link href="/2024/01/10/618python%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8B%E7%BC%96%E5%86%99%E9%AB%98%E6%95%88%E5%87%BD%E6%95%B0%EF%BC%88%E5%8D%81%EF%BC%89/"/>
    <url>/2024/01/10/618python%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8B%E7%BC%96%E5%86%99%E9%AB%98%E6%95%88%E5%87%BD%E6%95%B0%EF%BC%88%E5%8D%81%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="å-ç¼–å†™é«˜æ•ˆçš„å‡½æ•°"><a href="#å-ç¼–å†™é«˜æ•ˆçš„å‡½æ•°" class="headerlink" title="åã€€ç¼–å†™é«˜æ•ˆçš„å‡½æ•°"></a>åã€€ç¼–å†™é«˜æ•ˆçš„å‡½æ•°</h1><blockquote><p>ã€€ã€€å‡½æ•°å°±åƒæ˜¯ç¨‹åºä¸­çš„ç¨‹åºï¼Œé€šè¿‡æ‹†åˆ†å‡½æ•°å¯ä»¥å°†ä»£ç åˆ†è§£æˆæ›´å°çš„å•å…ƒã€‚å®ƒèƒ½è®©æˆ‘ä»¬ä¸å¿…ç¼–å†™é‡å¤çš„ä»£ç ï¼Œå‡å°‘é”™è¯¯çš„å‘ç”Ÿã€‚ä½†ç¼–å†™é«˜æ•ˆçš„å‡½æ•°è¦æ±‚æˆ‘ä»¬åœ¨å‘½åã€å¤§å°ã€å‚æ•°å’Œå¤æ‚æ€§ç­‰æ–¹é¢åšå‡ºå¾ˆå¤šå†³ç­–ã€‚æœ¬ç« å°†è®²è§£ç¼–å†™å‡½æ•°çš„ä¸åŒæ–¹æ³•ï¼Œåˆ†æå„ç§å–èˆçš„åˆ©å¼Šï¼Œæ·±å…¥æ¢è®¨å¦‚ä½•åœ¨å‡½æ•°çš„å¤§å°ä¹‹é—´è¿›è¡Œæƒè¡¡ï¼Œå‚æ•°æ•°é‡å¦‚ä½•å½±å“å‡½æ•°çš„å¤æ‚åº¦ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨è¿ç®—ç¬¦<code>*</code>å’Œ<code>**</code>ç¼–å†™å¯å˜å‚æ•°å‡½æ•°ã€‚æœ¬ç« è¿˜å°†è®¨è®ºå‡½æ•°å¼ç¼–ç¨‹èŒƒå¼ä»¥åŠæŒ‰è¿™ç§èŒƒå¼ç¼–å†™å‡½æ•°æœ‰ä½•ç›Šå¤„ã€‚</p></blockquote><h2 id="10-1-å‡½æ•°å"><a href="#10-1-å‡½æ•°å" class="headerlink" title="10.1ã€€å‡½æ•°å"></a>10.1ã€€å‡½æ•°å</h2><p>ã€€ã€€å‡½æ•°åç§°åº”è¯¥éµå¾ªä¸€èˆ¬æ ‡è¯†ç¬¦éµå¾ªçš„æƒ¯ä¾‹ï¼Œæ­£å¦‚ç¬¬4ç« æ‰€è¿°ã€‚å®ƒé€šå¸¸åŒ…æ‹¬ä¸€ä¸ªåŠ¨è¯ï¼Œå› ä¸ºå‡½æ•°ç»å¸¸è¢«ç”¨æ¥æ‰§è¡ŒæŸäº›åŠ¨ä½œã€‚å®ƒä¹Ÿå¯ä»¥åŒ…å«ä¸€ä¸ªåè¯ï¼Œç”¨æ¥æè¿°è¢«æ“ä½œçš„äº‹ç‰©ï¼Œæ¯”å¦‚<code>refreshConnection()</code>ã€<code>setPassword()</code>å’Œ<code>extract_version()</code>ï¼Œè¿™äº›åå­—è¯´æ˜äº†å‡½æ•°çš„ä½œç”¨å’Œç›®çš„ã€‚</p><p>ã€€ã€€å¯¹äºç±»å’Œæ¨¡å—ä¸­çš„æ–¹æ³•è€Œè¨€ï¼Œåç§°å¯èƒ½ä¸éœ€è¦åè¯ã€‚<code>SatelliteConnection</code>ä¸­çš„<code>reset()</code>æ–¹æ³•å’Œ<code>webbrowser</code>æ¨¡å—ä¸­çš„<code>open()</code>å‡½æ•°éƒ½å·²ç»æä¾›äº†å¿…è¦çš„ä¿¡æ¯ï¼Œèƒ½è®©äººæ˜ç™½resetçš„å¯¹è±¡æ˜¯å«æ˜Ÿè¿æ¥ï¼Œopençš„å¯¹è±¡æ˜¯ç½‘é¡µæµè§ˆå™¨ã€‚</p><p>ã€€ã€€å°½é‡ä½¿ç”¨é•¿çš„ã€å…·æœ‰æè¿°æ€§çš„åå­—ï¼Œè€Œä¸æ˜¯ç¼©å†™æˆ–è€…å¤ªçŸ­çš„åå­—ã€‚ä¸€ä¸ªæ•°å­¦å®¶ä¹Ÿè®¸èƒ½å¤Ÿç«‹åˆ»çŸ¥é“åä¸º<code>gcd()</code>çš„å‡½æ•°ä¼šè¿”å›ä¸¤ä¸ªæ•°å­—çš„æœ€å¤§å…¬åˆ†æ¯ï¼Œä½†å…¶ä»–äººä¼šè§‰å¾—<code>getGreatestCommonDenominator()</code>æ›´å®¹æ˜“ç†è§£ã€‚è®°ä½ï¼Œä¸è¦ä½¿ç”¨Pythonå†…ç½®çš„ä»»ä½•å‡½æ•°åæˆ–æ¨¡å—åï¼Œä¾‹å¦‚<code>all</code>ã€<code>any</code>ã€<code>date</code>ã€<code>email</code>ã€<code>file</code>ã€<code>format</code>ã€<code>hash</code>ã€<code>id</code>ã€<code>input</code>ã€<code>list</code>ã€<code>min</code>ã€<code>max</code>ã€<code>object</code>ã€<code>open</code>ã€<code>random</code>ã€<code>set</code>ã€<code>str</code>ã€<code>sum</code>ã€<code>test</code>å’Œ<code>type</code>ã€‚</p><h2 id="10-2-å‡½æ•°å¤§å°çš„æƒè¡¡"><a href="#10-2-å‡½æ•°å¤§å°çš„æƒè¡¡" class="headerlink" title="10.2ã€€å‡½æ•°å¤§å°çš„æƒè¡¡"></a>10.2ã€€å‡½æ•°å¤§å°çš„æƒè¡¡</h2><p>ã€€ã€€æœ‰äº›ç¨‹åºå‘˜è¯´ï¼Œå‡½æ•°åº”è¯¥å°½å¯èƒ½ç®€çŸ­ï¼Œä¸è¦è¶…è¿‡å±å¹•èƒ½å®¹çº³çš„é•¿åº¦ã€‚ä¸é•¿è¾¾å‡ ç™¾è¡Œçš„å‡½æ•°ç›¸æ¯”ï¼Œåªæœ‰åå‡ è¡Œçš„å‡½æ•°ç¡®å®æ¯”è¾ƒå®¹æ˜“ç†è§£ï¼Œä½†å°†å¤§å‡½æ•°æ‹†åˆ†æˆå¤šä¸ªå°å‡½æ•°ä¹Ÿæœ‰ç¼ºç‚¹ã€‚</p><p>ã€€ã€€è®©æˆ‘ä»¬å…ˆçœ‹çœ‹å°å‡½æ•°çš„ä¼˜ç‚¹ï¼š</p><ul><li>å‡½æ•°çš„ä»£ç æ›´å®¹æ˜“ç†è§£ï¼›</li><li>å‡½æ•°å¯èƒ½éœ€è¦è¾ƒå°‘çš„å‚æ•°ï¼›</li><li>å‡½æ•°ä¸å¤ªå¯èƒ½æœ‰å‰¯ä½œç”¨ï¼Œå¦‚10.4.1èŠ‚æ‰€è¿°ï¼›</li><li>å‡½æ•°æ›´å®¹æ˜“æµ‹è¯•å’Œè°ƒè¯•ï¼›</li><li>å‡½æ•°å¼•å‘çš„ä¸åŒç§ç±»çš„å¼‚å¸¸æ•°é‡è¦å°‘ã€‚</li></ul><p>ã€€ã€€ä½†å°å‡½æ•°ä¹Ÿæœ‰ç¼ºç‚¹ï¼š</p><ul><li>ç¼–å†™ç®€çŸ­çš„å‡½æ•°å¾€å¾€æ„å‘³ç€ç¨‹åºä¸­ä¼šæœ‰æ›´å¤šçš„å‡½æ•°ï¼›</li><li>æ‹¥æœ‰æ›´å¤šçš„å‡½æ•°æ„å‘³ç€ç¨‹åºæ›´åŠ å¤æ‚ï¼›</li><li>æ‹¥æœ‰æ›´å¤šçš„å‡½æ•°ä¹Ÿæ„å‘³ç€å¿…é¡»æƒ³å‡ºæ›´å¤šçš„å…·æœ‰æè¿°æ€§çš„ã€å‡†ç¡®çš„åç§°ï¼Œè¿™æ˜¯ä¸€ä¸ªéš¾é¢˜ï¼›</li><li>ä½¿ç”¨æ›´å¤šçš„å‡½æ•°éœ€è¦å†™æ›´å¤šçš„æ–‡æ¡£è¿›è¡Œè¯´æ˜ï¼›</li><li>å‡½æ•°ä¹‹é—´çš„å…³ç³»ä¼šæ›´å¤æ‚ã€‚</li></ul><p>ã€€ã€€æœ‰äº›äººæŠŠâ€œè¶ŠçŸ­è¶Šå¥½â€çš„å‡†åˆ™å‘æŒ¥åˆ°äº†æè‡´ï¼Œä»–ä»¬å£°ç§°æ‰€æœ‰çš„å‡½æ•°æœ€å¤šåªèƒ½æœ‰ä¸‰å››è¡Œä»£ç ã€‚è¿™å¤ªç–¯ç‹‚äº†ã€‚</p><h2 id="10-3-å‡½æ•°çš„å½¢å‚å’Œå®å‚"><a href="#10-3-å‡½æ•°çš„å½¢å‚å’Œå®å‚" class="headerlink" title="10.3ã€€å‡½æ•°çš„å½¢å‚å’Œå®å‚"></a>10.3ã€€å‡½æ•°çš„å½¢å‚å’Œå®å‚</h2><p>ã€€ã€€å‡½æ•°çš„å½¢å‚æ˜¯<code>def</code>è¯­å¥æ‹¬å·ä¸­çš„å˜é‡åç§°ï¼Œå®å‚åˆ™æ˜¯å‡½æ•°è°ƒç”¨æ‹¬å·ä¸­çš„æ•°å€¼ã€‚å‡½æ•°çš„å‚æ•°è¶Šå¤šï¼Œä»£ç çš„å¯é…ç½®æ€§å’Œé€šç”¨æ€§å°±è¶Šå¼ºï¼Œä½†æ›´å¤šçš„å‚æ•°ä¹Ÿæ„å‘³ç€å‡½æ•°æ›´å¤æ‚ã€‚</p><p>ã€€ã€€ä¸€ä¸ªåˆé€‚çš„å‡†åˆ™æ˜¯ä¿æŒ0ï½3ä¸ªå‚æ•°ï¼Œå‚æ•°è¶…è¿‡6ä¸ªå¯èƒ½å°±åå¤šäº†ã€‚å½“å‡½æ•°è¿‡äºå¤æ‚æ—¶ï¼Œæœ€å¥½è€ƒè™‘å°†å…¶æ‹†åˆ†æˆå‚æ•°è¾ƒå°‘çš„å¤šä¸ªå°å‡½æ•°ã€‚</p><h3 id="10-3-1-é»˜è®¤å‚æ•°"><a href="#10-3-1-é»˜è®¤å‚æ•°" class="headerlink" title="10.3.1ã€€é»˜è®¤å‚æ•°"></a>10.3.1ã€€é»˜è®¤å‚æ•°</h3><p>ã€€ã€€é™ä½å‚æ•°å¤æ‚æ€§çš„ä¸€ä¸ªæ–¹æ³•æ˜¯ä¸ºå‡½æ•°æä¾›é»˜è®¤å‚æ•°ã€‚é»˜è®¤å‚æ•°æ˜¯æŒ‡åœ¨å‡½æ•°è°ƒç”¨æ—¶å¦‚æœæ²¡æœ‰æŒ‡å®šå‚æ•°ï¼Œä¼šç”¨æ¥ä»£æ›¿å‚æ•°çš„é»˜è®¤å€¼ã€‚å°†å¤§å¤šæ•°å‡½æ•°è°ƒç”¨æ—¶ä½¿ç”¨çš„å‚æ•°å€¼ä½œä¸ºé»˜è®¤å‚æ•°å¯ä»¥é¿å…åœ¨å‡½æ•°è°ƒç”¨æ—¶é‡å¤è¾“å…¥ã€‚</p><p>ã€€ã€€é»˜è®¤å‚æ•°çš„è®¾å®šä½ç½®æ˜¯åœ¨<code>def</code>è¯­å¥ä¸­çš„å‚æ•°åç§°å’Œç­‰å·åã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸‹é¢çš„<code>introduction()</code>å‡½æ•°ä¸­ï¼Œå¦‚æœå‡½æ•°è°ƒç”¨æ—¶æ²¡æœ‰æŒ‡å®š<code>greeting</code>å‚æ•°çš„å€¼ï¼Œå®ƒçš„å€¼å°±æ˜¯é»˜è®¤å‚æ•°å€¼<code>&#39;Hello&#39;</code>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">introduction</span>(<span class="hljs-params">name, greeting=<span class="hljs-string">&#x27;Hello&#x27;</span></span>):<br><span class="hljs-meta">... </span>    <span class="hljs-built_in">print</span>(greeting + <span class="hljs-string">&#x27;, &#x27;</span> + name)<br>...<br><span class="hljs-meta">&gt;&gt;&gt; </span>introduction(<span class="hljs-string">&#x27;Alice&#x27;</span>)<br>Hello, Alice<br><span class="hljs-meta">&gt;&gt;&gt; </span>introduction(<span class="hljs-string">&#x27;Hiro&#x27;</span>, <span class="hljs-string">&#x27;Ohiyo gozaimasu&#x27;</span>)<br>Ohiyo gozaimasu, Hiro<br></code></pre></td></tr></table></figure><p>ã€€ã€€åœ¨è°ƒç”¨<code>introduction()</code>æ—¶ï¼Œå¦‚æœä¸æŒ‡å®šç¬¬2ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆå‡½æ•°ä¼šé»˜è®¤ä½¿ç”¨å­—ç¬¦ä¸²<code>&#39;Hello&#39;</code>ã€‚æ³¨æ„ï¼Œå¸¦æœ‰é»˜è®¤å€¼çš„å‚æ•°éœ€è¦æ’åˆ—åœ¨å…¶ä»–æ²¡æœ‰é»˜è®¤å€¼çš„å‚æ•°ä¹‹åã€‚</p><h3 id="10-3-2-ä½¿ç”¨-å’Œ-å‘å‡½æ•°ä¼ å‚"><a href="#10-3-2-ä½¿ç”¨-å’Œ-å‘å‡½æ•°ä¼ å‚" class="headerlink" title="10.3.2ã€€ä½¿ç”¨*å’Œ**å‘å‡½æ•°ä¼ å‚"></a>10.3.2ã€€ä½¿ç”¨<code>*</code>å’Œ<code>**</code>å‘å‡½æ•°ä¼ å‚</h3><p>ã€€ã€€å¯ä»¥ä½¿ç”¨<code>*</code>å’Œ<code>**</code>è¯­æ³•ï¼ˆé€šå¸¸è¯»ä½œstarå’Œstar starï¼‰å‘å‡½æ•°ä¼ é€’ä¸€ç»„å‚æ•°ã€‚<code>*</code>è¯­æ³•å…è®¸ä½ å°†ä¸€ä¸ªå¯è¿­ä»£å¯¹è±¡ï¼ˆæ¯”å¦‚åˆ—è¡¨æˆ–å…ƒç»„ï¼‰ä¸­çš„é¡¹ä½œä¸ºå‚æ•°é€ä¸ªä¼ å…¥ï¼Œ<code>**</code>è¯­æ³•å…è®¸ä½ å°†æ˜ å°„å¯¹è±¡ï¼ˆå¦‚å­—å…¸ï¼‰ä¸­çš„é”®âˆ’å€¼å¯¹ä½œä¸ºå‚æ•°é€ä¸ªä¼ å…¥ã€‚</p><h3 id="10-3-3-ä½¿ç”¨-åˆ›å»ºå¯å˜å‚æ•°å‡½æ•°"><a href="#10-3-3-ä½¿ç”¨-åˆ›å»ºå¯å˜å‚æ•°å‡½æ•°" class="headerlink" title="10.3.3ã€€ä½¿ç”¨*åˆ›å»ºå¯å˜å‚æ•°å‡½æ•°"></a>10.3.3ã€€ä½¿ç”¨<code>*</code>åˆ›å»ºå¯å˜å‚æ•°å‡½æ•°</h3><p>ã€€ã€€åœ¨<code>def</code>è¯­å¥ä¸­ä½¿ç”¨<code>*</code>è¯­æ³•å¯ä»¥åˆ›å»ºå¯å˜å‚æ•°å‡½æ•°ï¼Œå®ƒå¯ä»¥æ¥å—ä¸å®šæ•°é‡çš„ä½ç½®å‚æ•°ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œ<code>print()</code>å°±æ˜¯ä¸€ä¸ªå¯å˜å‚æ•°å‡½æ•°ï¼Œå› ä¸ºä½ å¯ä»¥å‘å®ƒä¼ é€’ä»»æ„æ•°é‡çš„å­—ç¬¦ä¸²ï¼Œæ¯”å¦‚<code>print(&#39;Hello!&#39;)</code>æˆ–<code>print(&#39;My name is&#39;ï¼Œname)</code>ã€‚æ³¨æ„ï¼Œ10.3.2èŠ‚æ˜¯åœ¨å‡½æ•°è°ƒç”¨ä¸­ä½¿ç”¨<code>*</code>è¯­æ³•ï¼Œè€Œæœ¬èŠ‚æ˜¯åœ¨å‡½æ•°å®šä¹‰ä¸­ä½¿ç”¨<code>*</code>è¯­æ³•ã€‚</p><p>æ¥çœ‹ä¸€ä¸ªç¤ºä¾‹ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª<code>product()</code>å‡½æ•°ï¼Œå®ƒæ¥å—ä»»æ„æ•°é‡çš„å‚æ•°ï¼Œéœ€è¦è¿”å›å®ƒä»¬çš„ä¹˜ç§¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">product</span>(<span class="hljs-params">*args</span>)ï¼š<br><span class="hljs-meta">... </span>    result = <span class="hljs-number">1</span><br><span class="hljs-meta">... </span>    <span class="hljs-keyword">for</span> num <span class="hljs-keyword">in</span> argsï¼š<br><span class="hljs-meta">... </span>        result *= num<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">return</span> result<br>...<br><span class="hljs-meta">&gt;&gt;&gt; </span>product(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>)<br><span class="hljs-number">9</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>product(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)<br><span class="hljs-number">12</span><br></code></pre></td></tr></table></figure><p>åœ¨å‡½æ•°å†…éƒ¨ï¼Œ<code>args</code>åªæ˜¯ä¸€ä¸ªåŒ…å«æ‰€æœ‰ä½ç½®å‚æ•°çš„æ™®é€šPythonå…ƒç»„ã€‚ä»æŠ€æœ¯è§’åº¦è®²ï¼Œè¿™ä¸ªå‚æ•°å¯ä»¥å«ä»»ä½•åå­—ï¼Œåªè¦ä»¥<code>*</code>å¼€å¤´å³å¯ï¼Œä½†æƒ¯ä¾‹æ˜¯å°†å…¶å‘½åä¸º<code>args</code>ã€‚</p><p>ã€€ã€€ä»€ä¹ˆæ—¶å€™ä½¿ç”¨<code>*</code>è¯­æ³•æ˜¯éœ€è¦æ€è€ƒçš„ï¼Œæ¯•ç«Ÿåˆ›å»ºå¯å˜å‚æ•°å‡½æ•°è¿˜æœ‰å¦ä¸€ä¸ªæ›¿ä»£æ–¹æ¡ˆï¼Œå³æ¥å—ä¸€ä¸ªåˆ—è¡¨ç±»å‹ï¼ˆæˆ–è€…å…¶ä»–å¯è¿­ä»£æ•°æ®ç±»å‹ï¼‰ä½œä¸ºå•ä¸€å‚æ•°ï¼Œåˆ—è¡¨å†…éƒ¨åŒ…å«æ•°é‡ä¸å®šçš„é¡¹ã€‚å†…ç½®çš„<code>sum()</code>å‡½æ•°å°±æ˜¯è¿™æ ·ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">sum</span>([<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>])<br><span class="hljs-number">8</span><br></code></pre></td></tr></table></figure><p>ã€€ã€€<code>sum()</code>å‡½æ•°æ¥å—ä¸€ä¸ªå¯è¿­ä»£å‚æ•°ï¼Œä¼ é€’å¤šä¸ªå‚æ•°æ—¶ä¼šå‡ºç°å¼‚å¸¸ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">sum</span>(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>)<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>TypeError: <span class="hljs-built_in">sum</span>() takes at most <span class="hljs-number">2</span> arguments (<span class="hljs-number">4</span> given)<br></code></pre></td></tr></table></figure><p>ã€€ã€€è€Œå†…ç½®å‡½æ•°<code>min()</code>å’Œ<code>max()</code>ï¼ˆåˆ†åˆ«ç”¨æ¥å¯»æ‰¾å¤šä¸ªå€¼ä¸­çš„æœ€å°å€¼å’Œæœ€å¤§å€¼ï¼‰æ—¢å¯ä»¥æ¥å—ä¸€ä¸ªå¯è¿­ä»£å‚æ•°ï¼Œä¹Ÿå¯ä»¥æ¥å—å¤šä¸ªç‹¬ç«‹çš„å‚æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">min</span>([<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">8</span>])<br><span class="hljs-number">1</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">min</span>(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">8</span>)<br><span class="hljs-number">1</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">max</span>([<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">8</span>])<br><span class="hljs-number">8</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">max</span>(<span class="hljs-number">2</span>, <span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">8</span>)<br><span class="hljs-number">8</span><br></code></pre></td></tr></table></figure><p>è¿™äº›å‡½æ•°éƒ½æ¥å—ä¸å®šæ•°é‡çš„å‚æ•°ï¼Œä¸ºä»€ä¹ˆå®ƒä»¬çš„å‚æ•°è®¾è®¡æˆä¸åŒçš„æ¨¡å¼ï¼Ÿä»€ä¹ˆæ—¶å€™åº”è¯¥æŠŠå‡½æ•°è®¾è®¡æˆåªæ¥å—ä¸€ä¸ªå¯è¿­ä»£å‚æ•°ï¼Œä»€ä¹ˆæ—¶å€™åˆè¯¥ä½¿ç”¨<code>*</code>è¯­æ³•æ¥å—å¤šä¸ªç‹¬ç«‹å‚æ•°å‘¢ï¼Ÿ</p><p>ã€€ã€€å¦‚ä½•è®¾è®¡å‚æ•°å–å†³äºæˆ‘ä»¬é¢„æµ‹ç¨‹åºå‘˜ä¼šå¦‚ä½•ä½¿ç”¨æˆ‘ä»¬çš„ä»£ç ã€‚<code>print()</code>å‡½æ•°ä¹‹æ‰€ä»¥éœ€è¦å¤šä¸ªå‚æ•°ï¼Œæ˜¯å› ä¸ºç¨‹åºå‘˜ç»å¸¸å‘å®ƒä¼ é€’ä¸€è¿ä¸²çš„å­—ç¬¦ä¸²æˆ–åŒ…å«å­—ç¬¦ä¸²çš„å˜é‡ï¼Œæ¯”å¦‚<code>print(&#39;My name is&#39;, name)</code>ã€‚æŠŠè¿™äº›å­—ç¬¦ä¸²å½’çº³æˆä¸€ä¸ªåˆ—è¡¨ï¼Œå†å°†åˆ—è¡¨ä¼ é€’ç»™<code>print()</code>çš„åšæ³•å¹¶ä¸å¸¸è§ã€‚<code>print()</code>å·²ç»è¢«è®¾è®¡æˆåœ¨æ¥å—åˆ—è¡¨ä½œä¸ºå‚æ•°æ—¶å®Œæ•´åœ°æ‰“å°è¯¥åˆ—è¡¨çš„å€¼ï¼Œæ‰€ä»¥ä¸èƒ½æŠŠå®ƒè®¾è®¡æˆé€ä¸ªæ‰“å°åˆ—è¡¨ä¸­çš„å•ä¸ªå€¼ã€‚</p><p>ã€€ã€€<code>sum()</code>å‡½æ•°æ²¡ç†ç”±æ¥å—ç‹¬ç«‹çš„å‚æ•°ï¼Œå› ä¸ºPythonæä¾›çš„<code>+</code>è¿ç®—ç¬¦å¯ä»¥è¾¾åˆ°åŒæ ·çš„ç›®çš„ã€‚ä½ å¯ä»¥ç›´æ¥å†™<code>2 + 4 + 8</code>è¿™æ ·çš„ä»£ç ï¼Œè€Œä¸å¿…å†™<code>sum(2, 4, 8)</code>ã€‚ä¸å®šæ•°é‡çš„å‚æ•°åªèƒ½ä½œä¸ºåˆ—è¡¨ä¼ é€’ç»™<code>sum()</code>æ˜¯åˆç†çš„ã€‚</p><p>ã€€ã€€<code>min()</code>å‡½æ•°å’Œ<code>max()</code>å‡½æ•°å…è®¸ä¸¤ç§é£æ ¼çš„ä¼ å‚ã€‚å¦‚æœåªä¼ é€’äº†ä¸€ä¸ªå‚æ•°ï¼Œè¯¥å‡½æ•°ä¼šå‡å®šå®ƒæ˜¯ä¸€ä¸ªå¾…æ£€æŸ¥çš„åˆ—è¡¨æˆ–å…ƒç»„ï¼›å¦‚æœä¼ é€’äº†å¤šä¸ªå‚æ•°ï¼Œåˆ™å‡å®šå®ƒä»¬æ˜¯å¾…æ£€æŸ¥çš„å€¼ã€‚è¿™ä¸¤ä¸ªå‡½æ•°æ—¢éœ€è¦ç”¨äºç¨‹åºè¿è¡Œæ—¶å¤„ç†å€¼çš„åˆ—è¡¨ï¼Œå¦‚å‡½æ•°è°ƒç”¨<code>min(allExpenses)</code>ï¼Œä¹Ÿéœ€è¦å¤„ç†ç¨‹åºå‘˜æŒ‘é€‰çš„å¤šä¸ªå‚æ•°ï¼Œæ¯”å¦‚<code>max(0, someNumber)</code>ã€‚æ‰€ä»¥è¿™äº›å‡½æ•°è¢«è®¾è®¡æˆæ¥å—ä¸¤ç§å‚æ•°ã€‚ä¸‹é¢çš„<code>myMinFunction()</code>æ˜¯æˆ‘å¯¹<code>min()</code>å‡½æ•°çš„å¦ä¸€ç§å®ç°ï¼Œå®ƒå±•ç¤ºäº†å¦‚ä½•åŒæ—¶å¤„ç†ä¸¤ç§é£æ ¼çš„ä¼ å‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">myMinFunction</span>(<span class="hljs-params">*args</span>):<br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(args) == <span class="hljs-number">1</span>:<br>       values = args[<span class="hljs-number">0</span>] â¶<br>    <span class="hljs-keyword">else</span>:<br>       values = args â·<br><br>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(values) == <span class="hljs-number">0</span>:<br>       <span class="hljs-keyword">raise</span> ValueError(<span class="hljs-string">&#x27;myMinFunction() args is an empty sequence&#x27;</span>) â¸<br><br>    <span class="hljs-keyword">for</span> i, value <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(values): â¹<br>        <span class="hljs-keyword">if</span> i == <span class="hljs-number">0</span> <span class="hljs-keyword">or</span> value &lt; smallestValue:<br>            smallestValue = value<br>    <span class="hljs-keyword">return</span> smallestValue<br></code></pre></td></tr></table></figure><p><code>myMinFunction()</code>ä½¿ç”¨<code>*</code>è¯­æ³•æ¥å—å…ƒç»„å½¢å¼ä¸”æ•°é‡ä¸å®šçš„å‚æ•°ã€‚å¦‚æœè¿™ä¸ªå…ƒç»„åªæœ‰ä¸€ä¸ªå€¼ï¼Œé‚£ä¹ˆæˆ‘ä»¬å‡å®šè¿™ä¸ªå€¼æ˜¯å¾…æ£€æŸ¥çš„å€¼çš„åºåˆ—â¶ã€‚å¦åˆ™ï¼Œå‡å®š<code>args</code>æ˜¯å¾…æ£€æŸ¥çš„å…ƒç»„â·ã€‚æ— è®ºä½•ç§æƒ…å†µï¼Œ<code>values</code>å˜é‡éƒ½å°†åŒ…å«ä¸€ä¸ªå€¼åºåˆ—ï¼Œä¾›åç»­ä»£ç æ£€æŸ¥ã€‚ä¸çœŸå®çš„<code>min()</code>å‡½æ•°ä¸€æ ·ï¼Œå¦‚æœè°ƒç”¨è€…æ²¡æœ‰ä¼ é€’ä»»ä½•å‚æ•°æˆ–è€…ä¼ é€’äº†ç©ºåºåˆ—ï¼Œå‡½æ•°å°±ä¼šæŠ›å‡º<code>ValueError</code>â¸ã€‚å‰©ä½™ä»£ç çš„ä½œç”¨æ˜¯éå†åºåˆ—å¹¶è¿”å›æ‰¾åˆ°çš„æœ€å°å€¼â¹ã€‚ç®€å•åœ°è¯´ï¼Œ<code>myMinFunction()</code>åªæ¥å—åˆ—è¡¨æˆ–å…ƒç»„è¿™ä¸¤ç±»åºåˆ—ï¼Œè€Œä¸æ¥å—ä»»ä½•å¯è¿­ä»£çš„å€¼ã€‚</p><p>ã€€ã€€ä½ å¯èƒ½ä¼šç–‘æƒ‘ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸æ€»æ˜¯å°†å‡½æ•°è®¾è®¡ä¸ºæ¥å—ä¸¤ç§ä¼ é€’ä¸å®šå‚æ•°çš„æ–¹å¼ã€‚æˆ‘çš„å›ç­”æ˜¯ï¼Œå‡½æ•°åº”è¯¥å°½é‡ç®€å•ã€‚é™¤éä¸¤ç§è°ƒç”¨æ–¹å¼éƒ½å¾ˆå¸¸è§ï¼Œå¦åˆ™åº”è¯¥åªæ”¯æŒä¸€ç§è€Œæ”¾å¼ƒå¦ä¸€ç§ã€‚å¦‚æœå‡½æ•°é€šå¸¸æ¥å—çš„æ˜¯ç¨‹åºè¿è¡Œæ—¶åˆ›å»ºçš„æ•°æ®ç»“æ„ï¼Œé‚£ä¹ˆæœ€å¥½è®¾è®¡æˆæ¥å—å•ä¸ªå‚æ•°ã€‚å¦‚æœé€šå¸¸æ¥å—çš„æ˜¯ç¨‹åºå‘˜åœ¨ç¼–å†™ä»£ç æ—¶æŒ‡å®šçš„å‚æ•°ï¼Œé‚£ä¹ˆæœ€å¥½ä½¿ç”¨<code>*</code>è¯­æ³•æ¥å—ä¸å®šæ•°é‡çš„å‚æ•°ã€‚</p><h3 id="10-3-4-ä½¿ç”¨-åˆ›å»ºå¯å˜å‚æ•°å‡½æ•°"><a href="#10-3-4-ä½¿ç”¨-åˆ›å»ºå¯å˜å‚æ•°å‡½æ•°" class="headerlink" title="10.3.4ã€€ä½¿ç”¨**åˆ›å»ºå¯å˜å‚æ•°å‡½æ•°"></a>10.3.4ã€€ä½¿ç”¨<code>**</code>åˆ›å»ºå¯å˜å‚æ•°å‡½æ•°</h3><p>ã€€ã€€<code>**</code>è¯­æ³•ä¹Ÿå¯ç”¨äºåˆ›å»ºå¯å˜å‚æ•°å‡½æ•°ã€‚<code>def</code>è¯­å¥ä¸­çš„<code>*</code>è¯­æ³•è¡¨ç¤ºä¸å®šæ•°é‡çš„ä½ç½®å‚æ•°ï¼Œè€Œ<code>**</code>è¯­æ³•è¡¨ç¤ºä¸å®šæ•°é‡çš„å¯é€‰å…³é”®å­—å‚æ•°ã€‚å¦‚æœä¸ä½¿ç”¨<code>**</code>è¯­æ³•å®šä¹‰æ¥å—å¤šä¸ªå…³é”®å­—å‚æ•°ï¼ˆå…¶ä¸­æœ‰å¤šä¸ªå‚æ•°æ˜¯å¯é€‰çš„ï¼‰çš„å‡½æ•°ï¼Œå°±å¾ˆéš¾ç¼–å†™<code>def</code>è¯­å¥ã€‚å‡è®¾æœ‰ä¸€ä¸ª<code>formMolecule()</code>å‡½æ•°ï¼Œå®ƒæ¥å—å·²ç»å‘ç°çš„118ç§åŒ–å­¦å…ƒç´ ä½œä¸ºå‚æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">formMolecule</span>(<span class="hljs-params">hydrogen, helium, lithium, beryllium, boron, --snip--</span><br></code></pre></td></tr></table></figure><p>ã€€ã€€å¦‚æœæŒ‡å®š<code>hydrogen</code>çš„å‚æ•°ä¸º2ï¼Œ<code>oxygen</code>çš„å‚æ•°ä¸º1ä»¥è¿”å›<code>water</code>ï¼ŒæŒ‰ç…§è¿™ç§å†™æ³•ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œå¯è¯»æ€§å·®ï¼Œå› ä¸ºå…¶ä»–çš„æ— å…³å…ƒç´ å¿…é¡»è¢«è®¾ç½®ä¸º0ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>formMolecule(<span class="hljs-number">2</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span> --snip--<br><span class="hljs-string">&#x27;water&#x27;</span><br></code></pre></td></tr></table></figure><p>ã€€ã€€ä½¿ç”¨å‘½åçš„å…³é”®å­—å‚æ•°å¯ä»¥æ›´å®¹æ˜“ç®¡ç†å‡½æ•°ï¼Œæ¯ä¸ªå‚æ•°éƒ½å¯ä»¥è®¾ç½®é»˜è®¤å€¼ï¼Œè€Œä¸å¿…åœ¨å‡½æ•°è°ƒç”¨ä¸­ä¼ é€’å‚æ•°ã€‚</p><blockquote><p><strong>æ³¨æ„</strong>ã€€å°½ç®¡æœ¯è¯­â€œå®å‚â€å’Œâ€œå½¢å‚â€çš„å®šä¹‰å¾ˆæ¸…æ¥šï¼Œä½†ç¨‹åºå‘˜æ›´å€¾å‘äºå°†â€œå…³é”®å­—å½¢å‚â€å’Œâ€œå…³é”®å­—å®å‚â€ç»Ÿç§°ä¸ºâ€œå…³é”®å­—å‚æ•°â€ã€‚</p></blockquote><h3 id="10-3-5-ä½¿ç”¨-å’Œ-åˆ›å»ºåŒ…è£…å‡½æ•°"><a href="#10-3-5-ä½¿ç”¨-å’Œ-åˆ›å»ºåŒ…è£…å‡½æ•°" class="headerlink" title="10.3.5ã€€ä½¿ç”¨*å’Œ**åˆ›å»ºåŒ…è£…å‡½æ•°"></a>10.3.5ã€€ä½¿ç”¨<code>*</code>å’Œ<code>**</code>åˆ›å»ºåŒ…è£…å‡½æ•°</h3><p>ã€€ã€€åœ¨<code>def</code>è¯­å¥ä¸­ï¼Œ<code>*</code>å’Œ<code>**</code>è¯­æ³•çš„ä¸€ä¸ªå¸¸è§ç”¨é€”æ˜¯åˆ›å»ºåŒ…è£…å‡½æ•°ã€‚åŒ…è£…å‡½æ•°ç”¨æ¥å°†æ¥å—çš„å‚æ•°ä¼ é€’ç»™å¦ä¸€ä¸ªå‡½æ•°å¹¶è¿”å›è¯¥å‡½æ•°çš„ç»“æœã€‚ä½¿ç”¨<code>*</code>å’Œ<code>**</code>è¯­æ³•å¯ä»¥å‘è¢«åŒ…è£…çš„å‡½æ•°è½¬å‘ä»»ä½•å‚æ•°ã€‚æ¯”å¦‚ï¼Œåˆ›å»ºä¸€ä¸ª<code>printLowercase()</code>å‡½æ•°æ¥åŒ…è£…å†…ç½®çš„<code>print()</code>å‡½æ•°ã€‚<code>printLowercase()</code>å‡½æ•°ä¾é <code>print()</code>å®Œæˆå®é™…å·¥ä½œï¼Œä½†ä¼šå…ˆå°†å­—ç¬¦ä¸²å‚æ•°è½¬æ¢ä¸ºå°å†™å½¢å¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">printLower</span>(<span class="hljs-params">*args, **kwargs</span>): â¶<br><span class="hljs-meta">... </span>    args = <span class="hljs-built_in">list</span>(args) â·<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">for</span> i, value <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(args):<br><span class="hljs-meta">... </span>        args[i] = <span class="hljs-built_in">str</span>(value).lower()<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">print</span>(*args, **kwargs) â¸<br>...<br><span class="hljs-meta">&gt;&gt;&gt; </span>name = <span class="hljs-string">&#x27;Albert&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>printLower(<span class="hljs-string">&#x27;Hello,&#x27;</span>, name)<br>hello, albert<br><span class="hljs-meta">&gt;&gt;&gt; </span>printLower(<span class="hljs-string">&#x27;DOG&#x27;</span>, <span class="hljs-string">&#x27;CAT&#x27;</span>, <span class="hljs-string">&#x27;MOOSE&#x27;</span>, sep=<span class="hljs-string">&#x27;, &#x27;</span>)<br>dog, cat, moose<br></code></pre></td></tr></table></figure><p>ã€€ã€€<code>printLower()</code>å‡½æ•°é€šè¿‡<code>*</code>è¯­æ³•æ¥å—<code>args</code>å‚æ•°å¯¹åº”çš„å…ƒç»„â¶ï¼Œå…¶ä¸­åŒ…å«äº†ä¸å®šæ•°é‡çš„ä½ç½®å‚æ•°ã€‚<code>**</code>è¯­æ³•åˆ™å°†æ‰€æœ‰å…³é”®å­—å‚æ•°æ•´ç†æˆä¸€ä¸ªå­—å…¸åˆ†é…ç»™<code>kwargs</code>å‚æ•°ã€‚å¦‚æœä¸€ä¸ªå‡½æ•°åŒæ—¶ä½¿ç”¨<code>*args</code>å’Œ<code>**kwargs</code>ï¼Œé‚£ä¹ˆ<code>*args</code>å‚æ•°å¿…é¡»ä½äº<code>**kwargs</code>å‚æ•°ä¹‹å‰ã€‚æˆ‘ä»¬åˆ›å»ºçš„å‡½æ•°éœ€è¦é¦–å…ˆä¿®æ”¹ä¸€äº›å‚æ•°ï¼Œå†å°†å‚æ•°ä¼ é€’ç»™è¢«åŒ…è£…çš„<code>print()</code>å‡½æ•°ï¼Œæ‰€ä»¥<code>args</code>å…ƒç»„å¯ä»¥è½¬æ¢ä¸ºåˆ—è¡¨å½¢å¼â·ã€‚</p><p>ã€€ã€€åœ¨å°†<code>args</code>ä¸­çš„å­—ç¬¦ä¸²æ”¹ä¸ºå°å†™åï¼Œä½¿ç”¨<code>*</code>å’Œ<code>**</code>è¯­æ³•å°†<code>args</code>ä¸­çš„é¡¹å’Œ<code>kwargs</code>ä¸­çš„é”®âˆ’å€¼å¯¹ä½œä¸ºä¸åŒå‚æ•°é€ä¸ªä¼ é€’ç»™<code>print()</code>â¸ã€‚<code>printLower()</code>ä¼šå°†<code>print()</code>çš„è¿”å›å€¼ä½œä¸ºè‡ªå·±çš„è¿”å›å€¼ã€‚è¿™äº›æ­¥éª¤æœ‰æ•ˆåœ°åŒ…è£…äº†<code>print()</code>å‡½æ•°ã€‚</p><h2 id="10-4-å‡½æ•°å¼ç¼–ç¨‹"><a href="#10-4-å‡½æ•°å¼ç¼–ç¨‹" class="headerlink" title="10.4ã€€å‡½æ•°å¼ç¼–ç¨‹"></a>10.4ã€€å‡½æ•°å¼ç¼–ç¨‹</h2><p>ã€€ã€€<strong>å‡½æ•°å¼ç¼–ç¨‹</strong>æ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œå®ƒå¼ºè°ƒåœ¨ä¸ä¿®æ”¹å…¨å±€å˜é‡å’Œä»»ä½•å¤–ç•ŒçŠ¶æ€ï¼ˆå¦‚ç¡¬ç›˜ä¸Šçš„æ–‡ä»¶ã€äº’è”ç½‘è¿æ¥æˆ–æ•°æ®åº“ï¼‰çš„æƒ…å†µä¸‹ç¼–å†™å‡½æ•°è¿›è¡Œè®¡ç®—ã€‚Erlangã€Lispã€Haskellç­‰ç¼–ç¨‹è¯­è¨€åœ¨å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯å›´ç»•ç€å‡½æ•°å¼ç¼–ç¨‹çš„æ¦‚å¿µè®¾è®¡çš„ã€‚å°½ç®¡Pythonå¹¶ä¸å®Œå…¨éµå¾ªå‡½æ•°å¼ç¼–ç¨‹èŒƒå¼ï¼Œä½†ä¹Ÿæœ‰ä¸€äº›å‡½æ•°å¼ç¼–ç¨‹çš„ç‰¹æ€§ã€‚Pythonç¨‹åºèƒ½ä½¿ç”¨çš„ä¸»è¦ç‰¹æ€§æœ‰ï¼šæ— å‰¯ä½œç”¨çš„å‡½æ•°ã€é«˜é˜¶å‡½æ•°å’Œlambdaå‡½æ•°ã€‚</p><h3 id="10-4-1-å‰¯ä½œç”¨"><a href="#10-4-1-å‰¯ä½œç”¨" class="headerlink" title="10.4.1ã€€å‰¯ä½œç”¨"></a>10.4.1ã€€å‰¯ä½œç”¨</h3><p>ã€€ã€€å‰¯ä½œç”¨æ˜¯æŒ‡å‡½æ•°å¯¹è‡ªèº«ä»£ç å’Œå±€éƒ¨å˜é‡ä¹‹å¤–çš„å…¶ä»–éƒ¨åˆ†æ‰€åšçš„ä»»ä½•æ”¹å˜ã€‚ä¸ºäº†è¯´æ˜ç™½è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ª<code>subtract()</code>å‡½æ•°ï¼Œå®ç°Pythonå‡æ³•è¿ç®—ç¬¦çš„åŠŸèƒ½ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">subtract</span>(<span class="hljs-params">number1, number2</span>):<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">return</span> number1 - number2<br>...<br><span class="hljs-meta">&gt;&gt;&gt; </span>subtract(<span class="hljs-number">123</span>, <span class="hljs-number">987</span>)<br>-<span class="hljs-number">864</span><br></code></pre></td></tr></table></figure><p>è¿™ä¸ª<code>subtract()</code>å‡½æ•°æ²¡æœ‰å‰¯ä½œç”¨ã€‚æ¢è¨€ä¹‹ï¼Œå®ƒä¸ä¼šå½±å“ç¨‹åºä¸­ä»»ä½•è¯¥å‡½æ•°ä»£ç ä¹‹å¤–çš„éƒ¨åˆ†ã€‚ä»ç¨‹åºæˆ–è€…è®¡ç®—æœºçš„çŠ¶æ€ä¸­æ²¡åŠæ³•æ¨æµ‹å‡º<code>subtract()</code>æ˜¯è¢«è°ƒç”¨äº†1æ¬¡ã€2æ¬¡è¿˜æ˜¯100ä¸‡æ¬¡ã€‚æ— å‰¯ä½œç”¨çš„å‡½æ•°æ˜¯å¯ä»¥ä¿®æ”¹å…¶å†…éƒ¨çš„å±€éƒ¨å˜é‡çš„ï¼Œå› ä¸ºè¿™äº›å˜åŒ–ä¸ç¨‹åºä¸­çš„å…¶ä»–éƒ¨åˆ†æ˜¯éš”ç¦»çš„ã€‚</p><p>ã€€ã€€å‡è®¾æœ‰ä¸€ä¸ª<code>addToTotal()</code>å‡½æ•°ï¼Œå®ƒçš„åŠŸèƒ½æ˜¯å°†æ•°å­—å‚æ•°æ·»åŠ åˆ°åä¸º<code>TOTAL</code>çš„å…¨å±€å˜é‡ä¸­ï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">TOTAL = <span class="hljs-number">0</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">addToTotal</span>(<span class="hljs-params">amount</span>):</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">    <span class="hljs-keyword">global</span> TOTAL</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">    TOTAL += amount</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">    <span class="hljs-keyword">return</span> TOTAL</span><br><span class="hljs-meta prompt_">...</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">addToTotal(<span class="hljs-number">10</span>)</span><br>10<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">addToTotal(<span class="hljs-number">10</span>)</span><br>20<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">addToTotal(<span class="hljs-number">9999</span>)</span><br>10019<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">TOTAL</span><br>10019<br></code></pre></td></tr></table></figure><p><code>addToTotal()</code>å‡½æ•°æœ‰ä¸€ä¸ªå‰¯ä½œç”¨ï¼Œå®ƒä¿®æ”¹äº†å­˜åœ¨äºå‡½æ•°ä¹‹å¤–çš„å…ƒç´ ï¼Œå³<code>TOTAL</code>è¿™ä¸ªå…¨å±€å˜é‡ã€‚å‰¯ä½œç”¨ä¸ä»…ä»…æŒ‡å¯¹å…¨å±€å˜é‡çš„ä¿®æ”¹ï¼Œè¿˜åŒ…æ‹¬æ›´æ–°æˆ–åˆ é™¤æ–‡ä»¶ã€åœ¨å±å¹•ä¸Šæ˜¾ç¤ºæ–‡æœ¬ã€æ‰“å¼€æ•°æ®åº“è¿æ¥ã€æœåŠ¡å™¨é‰´æƒæˆ–è€…å¯¹å‡½æ•°æœ¬èº«ä»¥å¤–åšçš„ä»»ä½•ä¿®æ”¹ã€‚å‡½æ•°è°ƒç”¨åœ¨è¿”å›åç•™ä¸‹çš„ä»»ä½•ç—•è¿¹éƒ½æ˜¯å‰¯ä½œç”¨ã€‚</p><p>ã€€ã€€å‰¯ä½œç”¨ä¹Ÿå¯ä»¥åŒ…æ‹¬å¯¹å‡½æ•°å¤–ä½¿ç”¨çš„å¯å˜å¯¹è±¡è¿›è¡Œçš„åŸåœ°æ”¹å˜ã€‚æ¯”å¦‚ï¼Œä¸‹é¢çš„<code>removeLastCatFromList()</code>å‡½æ•°åŸåœ°ä¿®æ”¹äº†åˆ—è¡¨å‚æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">removeLastCatFromList</span>(<span class="hljs-params">petSpecies</span>):<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(petSpecies) &gt; <span class="hljs-number">0</span> <span class="hljs-keyword">and</span> petSpecies[-<span class="hljs-number">1</span>] == <span class="hljs-string">&#x27;cat&#x27;</span>:<br><span class="hljs-meta">... </span>        petSpecies.pop()<br>...<br><span class="hljs-meta">&gt;&gt;&gt; </span>myPets = [<span class="hljs-string">&#x27;dog&#x27;</span>, <span class="hljs-string">&#x27;cat&#x27;</span>, <span class="hljs-string">&#x27;bird&#x27;</span>, <span class="hljs-string">&#x27;cat&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>removeLastCatFromList(myPets)<br><span class="hljs-meta">&gt;&gt;&gt; </span>myPets<br>[<span class="hljs-string">&#x27;dog&#x27;</span>, <span class="hljs-string">&#x27;cat&#x27;</span>, <span class="hljs-string">&#x27;bird&#x27;</span>]<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>myPets</code>å˜é‡å’Œ<code>petSpecies</code>å‚æ•°æŒæœ‰å¯¹åŒä¸€ä¸ªåˆ—è¡¨çš„å¼•ç”¨ã€‚åœ¨å‡½æ•°ä¸­å¯¹åˆ—è¡¨å¯¹è±¡æ‰€åšçš„ä»»ä½•åŸåœ°ä¿®æ”¹ä¹Ÿä¼šå­˜åœ¨äºå‡½æ•°å¤–ï¼Œæ‰€ä»¥è¿™ç§ä¿®æ”¹ä¼šäº§ç”Ÿå‰¯ä½œç”¨ã€‚</p><p>ã€€ã€€ä¸€ä¸ªç›¸å…³æ¦‚å¿µæ˜¯<strong>ç¡®å®šæ€§å‡½æ•°</strong>ï¼ŒæŒ‡åœ¨ç»™å®šç›¸åŒå‚æ•°çš„æƒ…å†µä¸‹æ€»æ˜¯è¿”å›ç›¸åŒå€¼çš„å‡½æ•°ã€‚æ¯”å¦‚<code>subtract(123, 987)</code>å‡½æ•°è°ƒç”¨æ€»æ˜¯è¿”å›<code>-864</code>ï¼ŒPythonå†…ç½®çš„<code>round()</code>å‡½æ•°åœ¨ä¼ é€’<code>3.14</code>ä½œä¸ºå‚æ•°æ—¶æ€»æ˜¯è¿”å›<code>3</code>ã€‚</p><p>ã€€ã€€<strong>éç¡®å®šæ€§å‡½æ•°</strong>åˆ™åœ¨ä¼ é€’ç›¸åŒå‚æ•°æ—¶ä¸ä¼šæ€»æ˜¯è¿”å›ç›¸åŒçš„å€¼ã€‚ä¾‹å¦‚ï¼Œè°ƒç”¨<code>random.randint(1, 10)</code>ä¼šè¿”å›ä¸€ä¸ª1å’Œ10ä¹‹é—´çš„éšæœºæ•´æ•°ã€‚<code>time.time()</code>å‡½æ•°è™½ç„¶æ²¡æœ‰å‚æ•°ï¼Œä½†å®ƒçš„è¿”å›å€¼å–å†³äºè°ƒç”¨å‡½æ•°æ—¶æ‰€åœ¨è®¡ç®—æœºçš„æ—¶é’Ÿè®¾ç½®ã€‚æ—¶é’Ÿæ˜¯ä¸€ç§å¤–éƒ¨èµ„æºï¼Œè·Ÿå‚æ•°ä¸€æ ·éƒ½å±äºå‡½æ•°çš„è¾“å…¥ã€‚ä¾èµ–äºå‡½æ•°å¤–éƒ¨èµ„æºï¼ˆåŒ…æ‹¬å…¨å±€å˜é‡ã€ç¡¬ç›˜ä¸Šçš„æ–‡ä»¶ã€æ•°æ®åº“å’Œäº’è”ç½‘è¿æ¥ï¼‰çš„å‡½æ•°ï¼Œéƒ½è¢«è®¤ä¸ºæ˜¯éç¡®å®šæ€§å‡½æ•°ã€‚</p><p>ã€€ã€€ç¡®å®šæ€§å‡½æ•°çš„ä¸€ä¸ªå¥½å¤„æ˜¯å®ƒä»¬çš„å€¼å¯ä»¥è¢«ç¼“å­˜ã€‚å¦‚æœ<code>subtract()</code>èƒ½å¤Ÿè®°ä½ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶çš„è¿”å›å€¼ï¼Œé‚£å°±æ²¡å¿…è¦é‡å¤è®¡ç®—123å’Œ987çš„å·®å€¼ã€‚å› æ­¤ï¼Œç¡®å®šæ€§å‡½æ•°å…è®¸æˆ‘ä»¬ç‰ºç‰²ç©ºé—´æ¢å–æ—¶é—´ï¼Œå³é€šè¿‡ä½¿ç”¨å†…å­˜ç©ºé—´ç¼“å­˜ä¹‹å‰çš„ç»“æœæ¥ç¼©çŸ­å‡½æ•°è¿è¡Œæ—¶é—´ã€‚</p><p>ã€€ã€€æ— å‰¯ä½œç”¨çš„ç¡®å®šæ€§å‡½æ•°è¢«ç§°ä¸º<strong>çº¯å‡½æ•°</strong>ã€‚å‡½æ•°å¼ç¨‹åºå‘˜å°½é‡åœ¨ç¨‹åºä¸­åªç¼–å†™çº¯å‡½æ•°ã€‚é™¤äº†ä¸Šæ–‡æåˆ°çš„ï¼Œçº¯å‡½æ•°è¿˜æœ‰ä»¥ä¸‹å¥½å¤„ï¼š</p><ul><li>é€‚åˆå•å…ƒæµ‹è¯•ï¼Œå› ä¸ºä¸éœ€è¦è®¾ç½®ä»»ä½•å¤–éƒ¨èµ„æºï¼›</li><li>é€šè¿‡ç›¸åŒå‚æ•°è°ƒç”¨çº¯å‡½æ•°ï¼Œå¾ˆå®¹æ˜“å¤ç°çº¯å‡½æ•°ä¸­çš„é”™è¯¯ï¼›</li><li>çº¯å‡½æ•°å†…è°ƒç”¨å…¶ä»–çº¯å‡½æ•°ï¼Œä»ç„¶ä¿æŒä¸ºçº¯å‡½æ•°ï¼›</li><li>åœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­ï¼Œçº¯å‡½æ•°å¼çº¿ç¨‹æ˜¯å®‰å…¨çš„ï¼Œå¯ä»¥å®‰å…¨åœ°åŒæ—¶è¿è¡Œï¼ˆå¤šçº¿ç¨‹ä¸åœ¨æœ¬ä¹¦è®¨è®ºèŒƒç•´å†…ï¼‰ï¼›</li><li>å¯¹çº¯å‡½æ•°çš„å¤šæ¬¡è°ƒç”¨å¯ä»¥åŒæ—¶åœ¨å¹¶è¡Œçš„CPUæ ¸æˆ–è€…åœ¨å¤šçº¿ç¨‹ç¨‹åºä¸Šè¿è¡Œï¼Œå› ä¸ºå®ƒä»¬ä¸ä¾èµ–äºå¯¹å…¶è¿è¡Œé¡ºåºæœ‰è¦æ±‚çš„å¤–éƒ¨èµ„æºã€‚</li></ul><p>ã€€ã€€ä½ å¯ä»¥åœ¨Pythonä¸­ç¼–å†™çº¯å‡½æ•°ï¼Œè€Œä¸”åº”è¯¥å°½é‡è¿™æ ·åšã€‚åœ¨Pythonä¸­ç¼–å†™çº¯å‡½æ•°ä»…æ˜¯ä¸€ä¸ªä¹ æƒ¯åšæ³•ï¼Œæ²¡æœ‰ä»»ä½•è®¾ç½®è®©Pythonè§£é‡Šå™¨å¼ºåˆ¶è¦æ±‚ç¨‹åºå‘˜ç¼–å†™çº¯å‡½æ•°ã€‚ç¼–å†™çº¯å‡½æ•°çš„æœ€å¸¸è§çš„æ–¹æ³•æ˜¯é¿å…åœ¨å‡½æ•°å†…éƒ¨ä½¿ç”¨å…¨å±€å˜é‡ï¼Œå¹¶ç¡®ä¿ä¸ä¸æ–‡ä»¶ã€äº’è”ç½‘ã€ç³»ç»Ÿæ—¶é’Ÿã€éšæœºæ•°æˆ–å…¶ä»–å¤–éƒ¨èµ„æºäº¤äº’ã€‚</p><h3 id="10-4-2-é«˜é˜¶å‡½æ•°"><a href="#10-4-2-é«˜é˜¶å‡½æ•°" class="headerlink" title="10.4.2ã€€é«˜é˜¶å‡½æ•°"></a>10.4.2ã€€é«˜é˜¶å‡½æ•°</h3><p>ã€€ã€€é«˜é˜¶å‡½æ•°å¯ä»¥æ¥å—å‡½æ•°ä½œä¸ºå‚æ•°æˆ–è€…ä½¿ç”¨å‚æ•°ä½œä¸ºè¿”å›å€¼ã€‚ä¾‹å¦‚ï¼Œå®šä¹‰ä¸€ä¸ªåä¸º<code>callItTwice()</code>çš„å‡½æ•°ï¼Œå®ƒå°†ä¸¤æ¬¡è°ƒç”¨ç»™å®šçš„å‡½æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">callItTwice</span>(<span class="hljs-params">func, *args, **kwargs</span>):<br><span class="hljs-meta">... </span>    func(*args, **kwargs)<br><span class="hljs-meta">... </span>    func(*args, **kwargs)<br>...<br><span class="hljs-meta">&gt;&gt;&gt; </span>callItTwice(<span class="hljs-built_in">print</span>, <span class="hljs-string">&#x27;Hello, world!&#x27;</span>)<br>Hello, world!<br>Hello, world!<br></code></pre></td></tr></table></figure><p><code>callItTwice()</code>å¯ä»¥æ¥å—ä»»ä½•ä¼ é€’è¿›æ¥çš„å‡½æ•°ã€‚åœ¨Pythonä¸­ï¼Œå‡½æ•°æ˜¯å¤´ç­‰å¯¹è±¡ï¼Œè¿™æ„å‘³ç€å®ƒå…·å¤‡å…¶ä»–ä»»ä½•å¯¹è±¡éƒ½æœ‰çš„åŠŸèƒ½ï¼šå¯ä»¥æŠŠå‡½æ•°å­˜å‚¨åœ¨å˜é‡ä¸­ï¼Œä½œä¸ºå‚æ•°ä¼ é€’ï¼Œæˆ–è€…æŠŠå®ƒä½œä¸ºè¿”å›å€¼ä½¿ç”¨ã€‚</p><h3 id="10-4-3-lambdaå‡½æ•°"><a href="#10-4-3-lambdaå‡½æ•°" class="headerlink" title="10.4.3ã€€lambdaå‡½æ•°"></a>10.4.3ã€€lambdaå‡½æ•°</h3><p>ã€€ã€€<strong>lambdaå‡½æ•°</strong>ä¹Ÿè¢«ç§°ä¸º<strong>åŒ¿åå‡½æ•°</strong>æˆ–è€…<strong>æ— åå‡½æ•°</strong>ï¼Œæ˜¯æ²¡æœ‰åå­—çš„ç®€åŒ–ç‰ˆå‡½æ•°ï¼Œå…¶ä»£ç ä»…åŒ…å«ä¸€æ¡è¿”å›è¯­å¥ã€‚åœ¨å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’ç»™å…¶ä»–å‡½æ•°æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šç”¨åˆ°lambdaå‡½æ•°ã€‚</p><p>ã€€ã€€æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªå¸¸è§„å‡½æ•°ï¼Œå®ƒæ¥å—ç”±çŸ©å½¢çš„å®½é«˜ç»„æˆçš„åˆ—è¡¨ï¼Œå…·ä½“æ¥è¯´ï¼ŒçŸ©å½¢è§„æ ¼ä¸º4ä¹˜10ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">rectanglePerimeter</span>(<span class="hljs-params">rect</span>):<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">return</span> (rect[<span class="hljs-number">0</span>] * <span class="hljs-number">2</span>) + (rect[<span class="hljs-number">1</span>] * <span class="hljs-number">2</span>)<br>...<br><span class="hljs-meta">&gt;&gt;&gt; </span>myRectangle = [<span class="hljs-number">4</span>, <span class="hljs-number">10</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>rectanglePerimeter(myRectangle)<br><span class="hljs-number">28</span><br></code></pre></td></tr></table></figure><p>ç­‰æ•ˆçš„lambdaå‡½æ•°æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">lambda</span> rect: (rect[<span class="hljs-number">0</span>] * <span class="hljs-number">2</span>) + (rect[<span class="hljs-number">1</span>] * <span class="hljs-number">2</span>)<br></code></pre></td></tr></table></figure><p>ã€€ã€€åœ¨Pythonä¸­å®šä¹‰lambdaå‡½æ•°ï¼Œéœ€è¦ä»¥<code>lambda</code>å…³é”®å­—å¼€å¤´ï¼Œåé¢æ˜¯ä¸€ä¸ªä»¥é€—å·åˆ†éš”çš„å‚æ•°åˆ—è¡¨ï¼ˆå¦‚æœæœ‰å‚æ•°çš„è¯ï¼‰ï¼Œç´§æ¥ç€æ˜¯ä¸€ä¸ªå†’å·ï¼Œæœ€åæ˜¯ä¸€ä¸ªä½œä¸ºè¿”å›å€¼çš„è¡¨è¾¾å¼ã€‚ç”±äºå‡½æ•°æ˜¯å¤´ç­‰å¯¹è±¡ï¼Œå› æ­¤ä½ å¯ä»¥æŠŠlambdaå‡½æ•°èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ï¼Œç›¸å½“äº<code>def</code>è¯­å¥çš„å¿«æ·å‰¯æœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>rectanglePerimeter = <span class="hljs-keyword">lambda</span> rect: (rect[<span class="hljs-number">0</span>] * <span class="hljs-number">2</span>) + (rect[<span class="hljs-number">1</span>] * <span class="hljs-number">2</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>rectanglePerimeter([<span class="hljs-number">4</span>, <span class="hljs-number">10</span>])<br><span class="hljs-number">28</span><br></code></pre></td></tr></table></figure><p>è¿™ä¸ªlambdaå‡½æ•°è¢«èµ‹å€¼ç»™äº†åä¸º<code>rectanglePerimeter</code>çš„å˜é‡ï¼Œæœ¬è´¨ä¸Šæ˜¯æä¾›äº†ä¸€ä¸ª<code>rectanglePerimeter()</code>å‡½æ•°ã€‚å¦‚ä½ æ‰€è§ï¼Œç”±<code>lambda</code>åˆ›å»ºçš„å‡½æ•°å’Œç”±<code>def</code>è¯­å¥åˆ›å»ºçš„å‡½æ•°æ˜¯ä¸€æ ·çš„ã€‚</p><blockquote><p><strong>æ³¨æ„</strong>ã€€åœ¨å®é™…çš„ä»£ç ä¸­ï¼Œåº”è¯¥ä½¿ç”¨<code>def</code>è¯­å¥ï¼Œè€Œéå°†lambdaå‡½æ•°èµ‹å€¼ç»™å¸¸é‡ã€‚lambdaå‡½æ•°çš„æ­£ç¡®ç”¨æ³•ä»…æ˜¯ç”¨æ¥åˆ›å»ºåŒ¿åå‡½æ•°ã€‚</p></blockquote><p>ã€€ã€€lambdaå‡½æ•°çš„è¯­æ³•ä¾¿äºå°†å°å‡½æ•°æŒ‡å®šä¸ºå…¶ä»–å‡½æ•°è°ƒç”¨çš„å‚æ•°ã€‚æ¯”å¦‚ï¼Œ<code>sorted()</code>å‡½æ•°æœ‰ä¸€ä¸ªåä¸º<code>key</code>çš„å…³é”®å­—å‚æ•°ï¼Œéœ€è¦æŒ‡å®šä¸€ä¸ªå‡½æ•°ä½œä¸ºå®å‚ã€‚å½“ä¼ å…¥<code>key</code>æ—¶ï¼Œ<code>sorted()</code>å‡½æ•°å°†ä¼šæ ¹æ®å‡½æ•°çš„è¿”å›å€¼è€Œéé¡¹æœ¬èº«çš„å€¼å¯¹åˆ—è¡¨ä¸­çš„é¡¹è¿›è¡Œæ’åºã€‚åœ¨ä¸‹é¢è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä¼ é€’ç»™<code>sorted()</code>å‡½æ•°ä¸€ä¸ªlambdaå‡½æ•°ï¼Œå‡½æ•°çš„åŠŸèƒ½æ˜¯è¿”å›ç»™å®šçŸ©å½¢çš„å‘¨é•¿ã€‚è¿™æ ·<code>sorted()</code>å‡½æ•°å°†åŸºäºæ¯ä¸ªåˆ—è¡¨é¡¹<code>[width, height]</code>æ‰€è®¡ç®—å¾—åˆ°çš„å‘¨é•¿è¿›è¡Œæ’åºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>rects = [[<span class="hljs-number">10</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>], [<span class="hljs-number">2</span>, <span class="hljs-number">4</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">9</span>], [<span class="hljs-number">10</span>, <span class="hljs-number">7</span>], [<span class="hljs-number">9</span>, <span class="hljs-number">9</span>]]<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">sorted</span>(rects, key=<span class="hljs-keyword">lambda</span> rect: (rect[<span class="hljs-number">0</span>] * <span class="hljs-number">2</span>) + (rect[<span class="hljs-number">1</span>] * <span class="hljs-number">2</span>))<br>[[<span class="hljs-number">2</span>, <span class="hljs-number">4</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">6</span>], [<span class="hljs-number">10</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">9</span>], [<span class="hljs-number">10</span>, <span class="hljs-number">7</span>], [<span class="hljs-number">9</span>, <span class="hljs-number">9</span>]]<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œè¯¥å‡½æ•°ä¸æ˜¯å¯¹æ•°å€¼<code>[10, 2]</code>å’Œ<code>[3, 6]</code>è¿›è¡Œæ’åºï¼Œè€Œæ˜¯æ ¹æ®è¿”å›çš„å‘¨é•¿æ•´æ•°å€¼24å’Œ18è¿›è¡Œæ’åºã€‚lambdaè¡¨è¾¾å¼æ˜¯ä¸€ç§ä¾¿æ·çš„è¯­æ³•ç¼©å†™å½¢å¼ï¼šä½ å¯ä»¥æŒ‡å®šä¸€ä¸ªå°çš„lambdaå‡½æ•°ï¼ˆåªæœ‰ä¸€è¡Œé•¿ï¼‰ï¼Œè€Œéä½¿ç”¨<code>def</code>è¯­å¥å®šä¹‰ä¸€ä¸ªå‘½åå‡½æ•°ã€‚</p><h3 id="10-4-4-åœ¨åˆ—è¡¨æ¨å¯¼å¼ä¸­è¿›è¡Œæ˜ å°„å’Œè¿‡æ»¤"><a href="#10-4-4-åœ¨åˆ—è¡¨æ¨å¯¼å¼ä¸­è¿›è¡Œæ˜ å°„å’Œè¿‡æ»¤" class="headerlink" title="10.4.4ã€€åœ¨åˆ—è¡¨æ¨å¯¼å¼ä¸­è¿›è¡Œæ˜ å°„å’Œè¿‡æ»¤"></a>10.4.4ã€€åœ¨åˆ—è¡¨æ¨å¯¼å¼ä¸­è¿›è¡Œæ˜ å°„å’Œè¿‡æ»¤</h3><p>ã€€ã€€<code>map()</code>å‡½æ•°å’Œ<code>filter()</code>å‡½æ•°æ˜¯Pythonæ—©æœŸç‰ˆæœ¬ä¸­å¸¸è§çš„é«˜é˜¶å‡½æ•°ï¼ŒäºŒè€…å¯ä»¥è½¬æ¢å’Œè¿‡æ»¤åˆ—è¡¨ï¼Œé€šå¸¸ä¼šç»“åˆlambdaå‡½æ•°ä½¿ç”¨ã€‚æ˜ å°„ï¼ˆmapï¼‰å¯ä»¥æ ¹æ®åŸåˆ—è¡¨çš„å€¼åˆ›å»ºæ–°åˆ—è¡¨ï¼Œè¿‡æ»¤ï¼ˆfilterï¼‰åˆ™å¯ä»¥åˆ›å»ºä¸€ä¸ªåªåŒ…å«åŸåˆ—è¡¨ä¸­ç¬¦åˆæŸç§æ ‡å‡†çš„å€¼çš„æ–°åˆ—è¡¨ã€‚</p><p>ã€€ã€€å¦‚æœä½ æƒ³å°†æ•´æ•°åˆ—è¡¨<code>[8, 16ï¼Œ18ï¼Œ19ï¼Œ12ï¼Œ1ï¼Œ6ï¼Œ7]</code>è½¬æ¢ä¸ºå­—ç¬¦ä¸²ç±»å‹çš„æ–°åˆ—è¡¨ï¼Œé‚£ä¹ˆå¯ä»¥æŠŠè¿™ä¸ªåˆ—è¡¨å’Œ<code>lambda n: str(n)</code>ä¼ é€’ç»™<code>map()</code>å‡½æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>mapObj = <span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> n: <span class="hljs-built_in">str</span>(n), [<span class="hljs-number">8</span>, <span class="hljs-number">16</span>, <span class="hljs-number">18</span>, <span class="hljs-number">19</span>, <span class="hljs-number">12</span>, <span class="hljs-number">1</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>])<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">list</span>(mapObj)<br>[<span class="hljs-string">&#x27;8&#x27;</span>, <span class="hljs-string">&#x27;16&#x27;</span>, <span class="hljs-string">&#x27;18&#x27;</span>, <span class="hljs-string">&#x27;19&#x27;</span>, <span class="hljs-string">&#x27;12&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;6&#x27;</span>, <span class="hljs-string">&#x27;7&#x27;</span>]<br></code></pre></td></tr></table></figure><p><code>map()</code>å‡½æ•°è¿”å›ä¸€ä¸ª<code>map</code>å¯¹è±¡ï¼Œå°†å…¶ä¼ é€’ç»™<code>list()</code>å‡½æ•°å³å¯å¾—åˆ°åˆ—è¡¨ã€‚æ˜ å°„åçš„åˆ—è¡¨åŒ…å«ä¸åŸåˆ—è¡¨ä¸­æ•´æ•°å€¼ç›¸å¯¹åº”çš„å­—ç¬¦ä¸²å€¼ã€‚<code>filter()</code>å‡½æ•°ä¸ä¹‹ç±»ä¼¼ï¼Œä½†å…¶ä¸­ä½œä¸ºå‚æ•°çš„lambdaå‡½æ•°çš„ä½œç”¨æ˜¯å†³å®šåˆ—è¡¨ä¸­çš„å“ªäº›é¡¹ä¼šè¢«ä¿ç•™ï¼ˆå½“lambdaå‡½æ•°è¿”å›<code>True</code>æ—¶ï¼‰ï¼Œå“ªäº›ä¼šè¢«è¿‡æ»¤ï¼ˆå½“lambdaå‡½æ•°è¿”å›<code>False</code>æ—¶ï¼‰ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>lambda n: n % 2 == 0</code>è¿‡æ»¤æ‰æ•°ç»„ä¸­çš„å¥‡æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>filterObj = <span class="hljs-built_in">filter</span>(<span class="hljs-keyword">lambda</span> n: n % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>, [<span class="hljs-number">8</span>, <span class="hljs-number">16</span>, <span class="hljs-number">18</span>, <span class="hljs-number">19</span>, <span class="hljs-number">12</span>, <span class="hljs-number">1</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>])<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">list</span>(filterObj)<br>[<span class="hljs-number">8</span>, <span class="hljs-number">16</span>, <span class="hljs-number">18</span>, <span class="hljs-number">12</span>, <span class="hljs-number">6</span>]<br></code></pre></td></tr></table></figure><p><code>filter()</code>å‡½æ•°è¿”å›ä¸€ä¸ªè¿‡æ»¤å™¨å¯¹è±¡ï¼Œå°†å…¶ä¼ é€’ç»™<code>list()</code>å‡½æ•°ï¼Œå³å¯å¾—åˆ°ä»…åŒ…å«å¶æ•°çš„åˆ—è¡¨ã€‚</p><p>ã€€ã€€ä½†ä½¿ç”¨<code>map()</code>å‡½æ•°å’Œ<code>filter()</code>å‡½æ•°æ¥åˆ›å»ºæ˜ å°„åˆ—è¡¨å’Œè¿‡æ»¤åˆ—è¡¨å·²ç»æ˜¯Pythonçš„è¿‡æ—¶åšæ³•äº†ã€‚æ›´å¥½çš„æ–¹æ³•æ˜¯ä½¿ç”¨åˆ—è¡¨æ¨å¯¼å¼åˆ›å»ºã€‚åˆ—è¡¨æ¨å¯¼å¼ä¸ä»…ä¸å¿…ç¼–å†™lambdaå‡½æ•°ï¼Œè¿˜æ¯”<code>map()</code>å’Œ<code>filter()</code>æ›´å¿«ã€‚è¿™é‡Œç»™å‡ºä¸€ä¸ªç­‰æ•ˆäº<code>map()</code>å‡½æ•°çš„åˆ—è¡¨æ¨å¯¼å¼ç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>[<span class="hljs-built_in">str</span>(n) <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> [<span class="hljs-number">8</span>, <span class="hljs-number">16</span>, <span class="hljs-number">18</span>, <span class="hljs-number">19</span>, <span class="hljs-number">12</span>, <span class="hljs-number">1</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>]]<br>[<span class="hljs-string">&#x27;8&#x27;</span>, <span class="hljs-string">&#x27;16&#x27;</span>, <span class="hljs-string">&#x27;18&#x27;</span>, <span class="hljs-string">&#x27;19&#x27;</span>, <span class="hljs-string">&#x27;12&#x27;</span>, <span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;6&#x27;</span>, <span class="hljs-string">&#x27;7&#x27;</span>]<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œåˆ—è¡¨æ¨å¯¼å¼çš„<code>str(n)</code>éƒ¨åˆ†ä¸<code>lambda n: str(n)</code>ç›¸ä¼¼ã€‚</p><p>ã€€ã€€åœ¨æ­¤ï¼Œæˆ‘ä»¬ç»™å‡ºä¸€ä¸ªç­‰æ•ˆäº<code>filter()</code>å‡½æ•°çš„åˆ—è¡¨æ¨å¯¼å¼ç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>[n <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> [<span class="hljs-number">8</span>, <span class="hljs-number">16</span>, <span class="hljs-number">18</span>, <span class="hljs-number">19</span>, <span class="hljs-number">12</span>, <span class="hljs-number">1</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>]  <span class="hljs-keyword">if</span> n % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>]<br>[<span class="hljs-number">8</span>, <span class="hljs-number">16</span>, <span class="hljs-number">18</span>, <span class="hljs-number">12</span>, <span class="hljs-number">6</span>]<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œåˆ—è¡¨æ¨å¯¼å¼çš„<code>if n % 2 == 0</code>éƒ¨åˆ†ä¸<code>lambda n: n % 2 == 0</code>ç›¸ä¼¼ã€‚</p><p>ã€€ã€€è®¸å¤šè¯­è¨€æœ‰â€œå‡½æ•°æ˜¯å¤´ç­‰å¯¹è±¡â€çš„æ¦‚å¿µï¼Œä¹Ÿæœ‰è¯¸å¦‚æ˜ å°„å‡½æ•°å’Œè¿‡æ»¤å‡½æ•°çš„é«˜é˜¶å‡½æ•°ã€‚</p><h2 id="10-5-è¿”å›å€¼çš„æ•°æ®ç±»å‹åº”è¯¥ä¸å˜"><a href="#10-5-è¿”å›å€¼çš„æ•°æ®ç±»å‹åº”è¯¥ä¸å˜" class="headerlink" title="10.5ã€€è¿”å›å€¼çš„æ•°æ®ç±»å‹åº”è¯¥ä¸å˜"></a>10.5ã€€è¿”å›å€¼çš„æ•°æ®ç±»å‹åº”è¯¥ä¸å˜</h2><p>ã€€ã€€Pythonæ˜¯åŠ¨æ€æ•°æ®ç±»å‹è¯­è¨€ï¼Œè¿™æ„å‘³ç€Pythonä¸­çš„å‡½æ•°å’Œæ–¹æ³•å¯ä»¥è‡ªç”±åœ°è¿”å›ä»»ä½•æ•°æ®ç±»å‹çš„å€¼ã€‚ä½†ä¸ºäº†è®©å‡½æ•°å…·å¤‡æ›´å¥½çš„å¯é¢„æµ‹æ€§ï¼Œåº”è¯¥å°½é‡ä»…è¿”å›å•ä¸€æ•°æ®ç±»å‹çš„å€¼ã€‚</p><p>ã€€ã€€æ¯”å¦‚è¿™é‡Œæœ‰ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒéšæœºåœ°è¿”å›æ•´æ•°å€¼æˆ–è€…å­—ç¬¦ä¸²å€¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> random<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">returnsTwoTypes</span>():<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">if</span> random.randint(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>) == <span class="hljs-number">1</span>:<br><span class="hljs-meta">... </span>        <span class="hljs-keyword">return</span> <span class="hljs-number">42</span><br><span class="hljs-meta">... </span>    <span class="hljs-keyword">else</span>:<br><span class="hljs-meta">... </span>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;forty two&#x27;</span><br></code></pre></td></tr></table></figure><p>ã€€ã€€åœ¨ç¼–å†™è¯¥å‡½æ•°çš„è°ƒç”¨ä»£ç æ—¶ï¼Œå¾ˆå¯èƒ½å¿˜è®°éœ€è¦å¤„ç†å¤šç§å¯èƒ½çš„æ•°æ®ç±»å‹ã€‚åœ¨ä¸‹é¢è¿™ä¸ªä¾‹å­ä¸­ï¼Œå‡è®¾æˆ‘ä»¬è°ƒç”¨<code>returnsTwoTypes()</code>å¹¶å¸Œæœ›æŠŠå®ƒè¿”å›çš„æ•°å­—è½¬æ¢ä¸ºåå…­è¿›åˆ¶æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>hexNum = <span class="hljs-built_in">hex</span>(returnsTwoTypes())<br><span class="hljs-meta">&gt;&gt;&gt; </span>hexNum<br><span class="hljs-string">&#x27;0x2a&#x27;</span><br></code></pre></td></tr></table></figure><p>Pythonçš„å†…ç½®å‡½æ•°<code>hex()</code>æ¥å—ä¸€ä¸ªæ•´æ•°ï¼Œè¿”å›çš„æ˜¯è¯¥æ•´æ•°å¯¹åº”çš„åå…­è¿›åˆ¶æ•°çš„å­—ç¬¦ä¸²ã€‚å½“<code>returnsTwoTypes()</code>è¿”å›æ•´æ•°æ—¶ï¼Œè¿™æ®µä»£ç èƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œï¼Œæ²¡ä»€ä¹ˆé—®é¢˜ã€‚ä½†å½“<code>returnsTwoTypes()</code>è¿”å›å­—ç¬¦ä¸²æ—¶ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>hexNum = <span class="hljs-built_in">hex</span>(returnsTwoTypes())<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>TypeError: <span class="hljs-string">&#x27;str&#x27;</span> <span class="hljs-built_in">object</span> cannot be interpreted <span class="hljs-keyword">as</span> an integer<br></code></pre></td></tr></table></figure><p>ã€€ã€€å½“ç„¶ï¼Œæˆ‘ä»¬åº”è¯¥å§‹ç»ˆè®°å¾—å¤„ç†ä»»ä½•ä¸€ç§æ•°æ®ç±»å‹çš„è¿”å›å€¼ï¼Œä½†åœ¨ç°å®ä¸­ç»å¸¸ä¼šå¿˜è®°ã€‚ä¸ºäº†é¿å…æ­¤ç±»é”™è¯¯ï¼Œåº”è¯¥å°½é‡ä½¿å‡½æ•°çš„è¿”å›å€¼åªæœ‰ä¸€ç§æ•°æ®ç±»å‹ã€‚è¿™ä¸æ˜¯ä¸€ä¸ªæ­»è§„å®šï¼Œåœ¨ä¸å¾—å·²çš„æƒ…å†µä¸‹ï¼Œå‡½æ•°å¯ä»¥è¿”å›ä¸åŒæ•°æ®ç±»å‹çš„å€¼ã€‚ä½†è¿”å›çš„æ•°æ®ç±»å‹è¶Šå°‘ï¼Œå‡½æ•°å°±è¶Šç®€å•ï¼Œä¹Ÿè¶Šä¸æ˜“å‡ºé”™ã€‚</p><p>ã€€ã€€æœ‰ä¸€ç§æƒ…å†µè¦ç‰¹åˆ«æ³¨æ„â€”â€”é™¤éå‡½æ•°çš„è¿”å›å€¼æ€»æ˜¯<code>None</code>ï¼Œå¦åˆ™ä¸è¦åœ¨æŸäº›æƒ…å†µä¸‹è¿”å›<code>None</code>ã€‚<code>None</code>å€¼æ˜¯<code>NoneType</code>æ•°æ®ç±»å‹çš„å”¯ä¸€å€¼ã€‚äººä»¬å¾ˆå®¹æ˜“é€šè¿‡è¿”å›<code>None</code>æ¥è¯´æ˜å‡½æ•°å‘ç”Ÿäº†é”™è¯¯ï¼ˆ10.6èŠ‚å°†è®¨è®ºè¿”å›é”™è¯¯ç ï¼‰ï¼Œä½†æ­£ç¡®çš„åšæ³•æ˜¯å°½é‡åªåœ¨å‡½æ•°æ— æ³•è¿”å›æœ‰æ„ä¹‰çš„å€¼æ—¶æ‰è¿”å›<code>None</code>ã€‚</p><p>ã€€ã€€é€šè¿‡è¿”å›<code>None</code>è¡¨ç¤ºé”™è¯¯é€šå¸¸æ˜¯é€ æˆä¸æ˜“æ•è·çš„<code>&#39;NoneType&#39; object has no attribute</code>è¿™ä¸€å¼‚å¸¸çš„æ ¹æºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> random<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">sometimesReturnsNone</span>():<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">if</span> random.randint(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>) == <span class="hljs-number">1</span>:<br><span class="hljs-meta">... </span>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Hello!&#x27;</span><br><span class="hljs-meta">... </span>    <span class="hljs-keyword">else</span>:<br><span class="hljs-meta">... </span>        <span class="hljs-keyword">return</span> <span class="hljs-literal">None</span><br>...<br><span class="hljs-meta">&gt;&gt;&gt; </span>returnVal = sometimesReturnsNone()<br><span class="hljs-meta">&gt;&gt;&gt; </span>returnVal.upper()<br><span class="hljs-string">&#x27;HELLO!&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>returnVal = sometimesReturnsNone()<br><span class="hljs-meta">&gt;&gt;&gt; </span>returnVal.upper()<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>AttributeError: <span class="hljs-string">&#x27;NoneType&#x27;</span> <span class="hljs-built_in">object</span> has no attribute <span class="hljs-string">&#x27;upper&#x27;</span><br></code></pre></td></tr></table></figure><p>è¿™æ®µé”™è¯¯ä¿¡æ¯éå¸¸æ¨¡ç³Šï¼Œéœ€è¦èŠ±äº›ç²¾åŠ›æ‰èƒ½å®šä½åˆ°é€šå¸¸ä¼šè¿”å›é¢„æœŸç»“æœçš„å‡½æ•°ä¸Šï¼Œè€Œé—®é¢˜å‡ºåœ¨è¿™ä¸ªå‡½æ•°åœ¨å‘ç”Ÿé”™è¯¯æ—¶è¿”å›äº†<code>None</code>ã€‚é—®é¢˜å‘ç”Ÿçš„åŸå› æ˜¯<code>sometimesReturnsNone()</code>è¿”å›<code>None</code>ï¼Œç„¶åæˆ‘ä»¬å°†å…¶èµ‹å€¼ç»™äº†<code>returnVal</code>å˜é‡ã€‚ä½†æ˜¯ï¼Œé”™è¯¯ä¿¡æ¯ä¼šè®©ä½ è¯¯ä»¥ä¸ºé—®é¢˜å‘ç”Ÿåœ¨å¯¹<code>upper()</code>æ–¹æ³•çš„è°ƒç”¨ä¸­ã€‚</p><p>ã€€ã€€åœ¨2009å¹´çš„ä¸€æ¬¡ä¼šè®®ä¸Šï¼Œè®¡ç®—æœºç§‘å­¦å®¶Tony Hoareä¸ºä»–åœ¨1965å¹´å‘æ˜äº†<code>null</code>å¼•ç”¨ï¼ˆè·ŸPythonä¸­çš„<code>None</code>å€¼ç±»ä¼¼ï¼‰è€Œé“æ­‰ã€‚ä»–è¯´ï¼šâ€œæˆ‘æŠŠ<code>null</code>å¼•ç”¨ç§°ä¸ºè‡ªå·±çš„åäº¿ç¾å…ƒé”™è¯¯â€¦â€¦æˆ‘æ²¡èƒ½æŠµåˆ¶è¯±æƒ‘ï¼ŒåŠ å…¥äº†<code>null</code>å¼•ç”¨ï¼Œä»…ä»…æ˜¯å› ä¸ºå®ƒå®ç°èµ·æ¥éå¸¸å®¹æ˜“ã€‚ä½†æ˜¯ï¼Œå®ƒå¯¼è‡´äº†æ— æ•°çš„é”™è¯¯ã€æ¼æ´å’Œç³»ç»Ÿå´©æºƒï¼Œå¯èƒ½åœ¨ä¹‹åçš„40å¹´ä¸­é€ æˆäº†åäº¿ç¾å…ƒçš„æŸå¤±ã€‚â€</p><h2 id="10-6-æŠ›å‡ºå¼‚å¸¸å’Œè¿”å›é”™è¯¯ç "><a href="#10-6-æŠ›å‡ºå¼‚å¸¸å’Œè¿”å›é”™è¯¯ç " class="headerlink" title="10.6ã€€æŠ›å‡ºå¼‚å¸¸å’Œè¿”å›é”™è¯¯ç "></a>10.6ã€€æŠ›å‡ºå¼‚å¸¸å’Œè¿”å›é”™è¯¯ç </h2><p>ã€€ã€€åœ¨Pythonä¸­ï¼Œâ€œå¼‚å¸¸â€å’Œâ€œé”™è¯¯â€è¿™ä¸¤ä¸ªè¯çš„å«ä¹‰ç›¸å·®æ— å‡ ï¼Œéƒ½æ˜¯æŒ‡ç¨‹åºä¸­çš„å¼‚å¸¸æƒ…å†µï¼Œè¡¨æ˜ç¨‹åºå­˜åœ¨é—®é¢˜ã€‚åœ¨20ä¸–çºªå…«ä¹åå¹´ä»£ï¼Œéšç€C++å’ŒJavaçš„å‡ºç°ï¼Œâ€œå¼‚å¸¸â€æˆä¸ºæµè¡Œçš„ç¼–ç¨‹è¯­è¨€ç‰¹æ€§ï¼Œå®ƒä»¬å–ä»£äº†é”™è¯¯ç ã€‚é”™è¯¯ç æ˜¯ä»å‡½æ•°ä¸­è¿”å›çš„å€¼ï¼Œè¯´æ˜ä»£ç æœ‰é—®é¢˜ã€‚ä½¿ç”¨â€œå¼‚å¸¸â€ä¸€è¯çš„å¥½å¤„æ˜¯ï¼Œå‡½æ•°è¿”å›å€¼åªä¸å‡½æ•°çš„ç›®çš„æœ‰å…³ï¼Œè€Œä¸å¿…åŒæ—¶ç”¨æ¥è¡¨æ˜å­˜åœ¨é”™è¯¯ã€‚</p><p>ã€€ã€€é”™è¯¯ç æœ‰æ—¶ä¹Ÿä¼šå¯¼è‡´ç¨‹åºé—®é¢˜ã€‚æ¯”å¦‚ï¼ŒPythonçš„<code>find()</code>é€šå¸¸ä¼šè¿”å›å­ä¸²çš„ç´¢å¼•ï¼Œåœ¨æ‰¾ä¸åˆ°æ—¶åˆ™è¿”å›<code>-1</code>ä½œä¸ºé”™è¯¯ç ã€‚ä½†<code>-1</code>ä¹Ÿå¯ä»¥ç”¨æ¥è¡¨ç¤ºå­—ç¬¦ä¸²æœ«å°¾çš„ç´¢å¼•ï¼Œæ— æ„ä¸­ä½¿ç”¨<code>-1</code>ä½œä¸ºé”™è¯¯ç å¯èƒ½ä¼šå¼•å‘é”™è¯¯ã€‚åœ¨äº¤äº’å¼shellä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&gt;&gt;&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Letters after b in &quot;Albert&quot;:&#x27;</span>, <span class="hljs-string">&#x27;Albert&#x27;</span>[<span class="hljs-string">&#x27;Albert&#x27;</span>.<span class="hljs-built_in">find</span>(<span class="hljs-string">&#x27;b&#x27;</span>) + 1:])<br>Letters after b <span class="hljs-keyword">in</span> <span class="hljs-string">&quot;Albert&quot;</span>: ert<br>&gt;&gt;&gt; <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Letters after x in &quot;Albert&quot;:&#x27;</span>, <span class="hljs-string">&#x27;Albert&#x27;</span>[<span class="hljs-string">&#x27;Albert&#x27;</span>.<span class="hljs-built_in">find</span>(<span class="hljs-string">&#x27;x&#x27;</span>) + 1:])<br>Letters after x <span class="hljs-keyword">in</span> <span class="hljs-string">&quot;Albert&quot;</span>: Albert<br></code></pre></td></tr></table></figure><p>ä»£ç ä¸­çš„<code>Albert&#39;.find(&#39;x&#39;)</code>è¢«è®¡ç®—ä¸ºé”™è¯¯ç <code>-1</code>ï¼Œè¿™å¯¼è‡´è¡¨è¾¾å¼<code>&#39;Albert&#39;[&#39;Albert&#39;.find(&#39;x&#39;) + 1:]</code>è¢«æ¨å¯¼ä¸º<code>&#39;Albert&#39;[-1 + 1: ]</code>ï¼Œæ¥ç€æ¨å¯¼ä¸º<code>Albert&#39;[0:]</code>ï¼Œæœ€ç»ˆç­‰äº<code>Albert</code>ã€‚å¾ˆæ˜¾ç„¶ï¼Œè¿™å¹¶ä¸ç¬¦åˆé¢„æœŸã€‚è°ƒç”¨<code>index()</code>è€Œé<code>find()</code>ï¼Œå°±åƒ<code>&#39;Albert&#39;[&#39;Albert&#39;.index(&#39;x&#39;) + 1:]</code>è¿™æ ·ï¼Œä¼šå¯¼è‡´å¼‚å¸¸ï¼Œä½¿ä¸å¯å¿½ç•¥çš„é—®é¢˜æš´éœ²å‡ºæ¥ã€‚</p><p>ã€€ã€€å­—ç¬¦ä¸²çš„<code>index()</code>æ–¹æ³•åœ¨æ‰¾ä¸åˆ°å­ä¸²æ—¶ä¼šæŠ›å‡º<code>ValueError</code>å¼‚å¸¸ã€‚å¦‚æœä¸å¤„ç†è¿™ä¸ªå¼‚å¸¸ï¼Œç¨‹åºå°±ä¼šå´©æºƒï¼Œæ‰€ä»¥æœ€å¥½ä¸è¦å¿½ç•¥é”™è¯¯ã€‚</p><p>ã€€ã€€å½“å¼‚å¸¸è¡¨ç¤ºä¸€ä¸ªå®é™…é”™è¯¯æ—¶ï¼Œå¼‚å¸¸ç±»çš„åç§°å¾€å¾€ä»¥Errorç»“å°¾ï¼Œæ¯”å¦‚<code>ValueError</code>ã€<code>NameError</code>æˆ–<code>SyntaxError</code>ã€‚è¡¨ç¤ºåœ¨ç‰¹æ®Šæƒ…å†µä¸‹ä¸ä¸€å®šæ˜¯é”™è¯¯çš„å¼‚å¸¸ç±»æœ‰<code>StopIteration</code>ã€<code>KeyboardInterrupt</code>å’Œ<code>SystemExit</code>ã€‚</p><h1 id="åä¸€-æ³¨é‡Šã€æ–‡æ¡£å­—ç¬¦ä¸²å’Œç±»å‹æç¤º"><a href="#åä¸€-æ³¨é‡Šã€æ–‡æ¡£å­—ç¬¦ä¸²å’Œç±»å‹æç¤º" class="headerlink" title="åä¸€ã€€æ³¨é‡Šã€æ–‡æ¡£å­—ç¬¦ä¸²å’Œç±»å‹æç¤º"></a>åä¸€ã€€æ³¨é‡Šã€æ–‡æ¡£å­—ç¬¦ä¸²å’Œç±»å‹æç¤º</h1><blockquote><p>ä»£ç çš„æ³¨é‡Šä¸æ–‡æ¡£çš„é‡è¦æ€§ä¸äºšäºä»£ç æœ¬èº«ï¼Œå› ä¸ºè½¯ä»¶æ°¸è¿œä¸ä¼šå½»åº•å®Œæˆï¼Œä½ æ€»æ˜¯éœ€è¦ä¿®æ”¹ï¼Œè¦ä¹ˆæ·»åŠ æ–°åŠŸèƒ½ï¼Œè¦ä¹ˆä¿®å¤é”™è¯¯ã€‚å¦‚æœä½ å¯¹ä»£ç ä¸å¤Ÿäº†è§£ï¼Œå°±æ— æ³•è¿›è¡Œä¿®æ”¹ï¼Œæ‰€ä»¥ä»£ç çš„å¯è¯»æ€§å¾ˆé‡è¦ã€‚æ­£å¦‚è®¡ç®—æœºç§‘å­¦å®¶Harold Abelsonã€Gerald Jay Sussmanå’ŒJulie Sussmanæ›¾å†™çš„é‚£æ ·ï¼šâ€œä»£ç æ˜¯ç”¨æ¥è®©äººè¯»çš„ï¼Œåªæ˜¯é¡ºä¾¿è®©æœºå™¨æ‰§è¡Œè€Œå·²ã€‚â€</p></blockquote><p>ã€€ã€€<strong>æ³¨é‡Š</strong>ã€<strong>æ–‡æ¡£å­—ç¬¦ä¸²</strong>å’Œ<strong>ç±»å‹æç¤º****1</strong>æœ‰åŠ©äºç»´æŠ¤ä»£ç çš„å¯è¯»æ€§ã€‚<strong>æ³¨é‡Š</strong>æ˜¯å†™åœ¨ä»£ç ä¸­ã€ä¼šè¢«è®¡ç®—æœºå¿½ç•¥çš„ç®€çŸ­è§£é‡Šã€‚æ³¨é‡Šçš„ä½œç”¨æ˜¯ä¸ºé™¤ç¼–å†™è€…ä¹‹å¤–çš„äººæä¾›æœ‰ä»·å€¼çš„è¯´æ˜ã€è­¦å‘Šå’Œæé†’ï¼Œæœ‰æ—¶å€™ç”šè‡³ä¼šå¯¹å†™è¿™æ®µä»£ç çš„äººèµ·åˆ°åŒæ ·çš„ä½œç”¨ã€‚å‡ ä¹æ¯ä¸ªç¨‹åºå‘˜éƒ½æ›¾æš—è‡ªåæ§½ï¼šâ€œåˆ°åº•æ˜¯è°å†™çš„è¿™å †ä¹±ä¸ƒå…«ç³Ÿçš„ä¸œè¥¿ï¼Ÿâ€ç»“æœå‘ç°ç­”æ¡ˆç«Ÿç„¶æ˜¯â€œè‡ªå·±â€ã€‚</p><h2 id="11-1-æ³¨é‡Š"><a href="#11-1-æ³¨é‡Š" class="headerlink" title="11.1ã€€æ³¨é‡Š"></a>11.1ã€€æ³¨é‡Š</h2><p>å’Œå¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€ä¸€æ ·ï¼ŒPythonæ”¯æŒå•è¡Œæ³¨é‡Šå’Œå¤šè¡Œæ³¨é‡Šã€‚ä»¥<code>#</code>å¼€å§‹ï¼Œç›´åˆ°è¡Œå°¾çš„æ‰€æœ‰æ–‡æœ¬éƒ½æ˜¯å•è¡Œæ³¨é‡Šã€‚å°½ç®¡Pythonæ²¡æœ‰ä¸“é—¨çš„å¤šè¡Œæ³¨é‡Šè¯­æ³•ï¼Œä½†ä½¿ç”¨ä¸‰å¼•å·çš„å¤šè¡Œå­—ç¬¦ä¸²å¯ä»¥ç”¨äºå¤šè¡Œæ³¨é‡Šã€‚æ¯•ç«Ÿï¼Œä¸€ä¸ªå­—ç¬¦ä¸²å€¼ä¸ä¼šå¯¼è‡´Pythonè§£é‡Šå™¨åšä»»ä½•äº‹æƒ…ã€‚</p><h3 id="11-1-1-æ³¨é‡Šé£æ ¼"><a href="#11-1-1-æ³¨é‡Šé£æ ¼" class="headerlink" title="11.1.1ã€€æ³¨é‡Šé£æ ¼"></a>11.1.1ã€€æ³¨é‡Šé£æ ¼</h3><p>æ¥çœ‹çœ‹ä¸€äº›éµå¾ªäº†ä¼˜ç§€æ³¨é‡Šé£æ ¼çš„å®è·µï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># è¿™æ˜¯å¯¹ä¸‹é¢ä¸€è¡Œä»£ç çš„æ³¨é‡Šï¼š â¶</span><br>someCode()<br><br><span class="hljs-comment"># è¿™æ˜¯ä¸€ä¸ªæ›´é•¿çš„å—æ³¨é‡Šï¼Œå®ƒåˆ†æ•£åœ¨å¤šè¡Œï¼Œå¹¶ä½¿ç”¨ â·</span><br><span class="hljs-comment"># å¤šä¸ªå•è¡Œæ³¨é‡Š</span><br><span class="hljs-comment"># â¸</span><br><span class="hljs-comment"># å®ƒä»¬è¢«ç§°ä¸ºå—æ³¨é‡Š</span><br><br><span class="hljs-keyword">if</span> someCondition:<br>   <span class="hljs-comment"># è¿™æ˜¯å…³äºå…¶ä»–ä»£ç çš„æ³¨é‡Šï¼š â¹</span><br>   someOtherCode() <span class="hljs-comment"># è¿™æ˜¯ä¸€ä¸ªå•è¡Œæ³¨é‡Š âº</span><br></code></pre></td></tr></table></figure><p>ã€€ã€€æ³¨é‡Šé€šå¸¸åº”è¯¥ç‹¬ç«‹æˆè¡Œï¼Œè€Œä¸æ˜¯æ”¾åœ¨ä»£ç è¡Œçš„æœ«å°¾ã€‚å¤šæ•°æƒ…å†µä¸‹ï¼Œå®ƒä»¬åº”è¯¥æ˜¯å¤§å°å†™æ­£ç¡®ä¸”å¸¦æœ‰æ ‡ç‚¹ç¬¦å·çš„å®Œæ•´å¥å­ï¼Œè€ŒéçŸ­è¯­æˆ–è€…å•è¯â¶ï¼Œé™¤éå—é™äºä»£ç è¡Œé•¿çš„é™åˆ¶ã€‚å¤šè¡Œçš„æ³¨é‡Šâ·å¯ä»¥è¿ç»­ä½¿ç”¨å¤šä¸ªå•è¡Œæ³¨é‡Šï¼Œä¹Ÿå«ä½œå—æ³¨é‡Šã€‚ç©ºç™½å•è¡Œæ³¨é‡Šå¯ä»¥ç”¨äºåˆ’åˆ†å—æ³¨é‡Šä¸­çš„æ®µè½â¸ã€‚æ³¨é‡Šçš„ç¼©è¿›æ°´å¹³åº”è¯¥è·Ÿè¢«æ³¨é‡Šçš„ä»£ç ä¸€è‡´â¹ã€‚è·Ÿåœ¨ä»£ç è¡Œå†…çš„æ³¨é‡Šè¢«ç§°ä¸ºâ€œå†…è”æ³¨é‡Šâ€âºï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œä»£ç å’Œæ³¨é‡Šä¹‹é—´åº”è¯¥è‡³å°‘ä¿ç•™ä¸¤ä¸ªç©ºæ ¼ã€‚</p><h3 id="11-1-2-å†…è”æ³¨é‡Š"><a href="#11-1-2-å†…è”æ³¨é‡Š" class="headerlink" title="11.1.2ã€€å†…è”æ³¨é‡Š"></a>11.1.2ã€€å†…è”æ³¨é‡Š</h3><p>å†…è”æ³¨é‡Šçš„ä¸€ä¸ªå¸¸è§ä¸”é€‚å®œçš„ç”¨é€”æ˜¯è§£é‡Šå˜é‡çš„ä½œç”¨ï¼Œæˆ–ä¸ºå…¶æä¾›å…¶ä»–èƒŒæ™¯ä¿¡æ¯ã€‚è¿™äº›å†…è”æ³¨é‡Šå†™åœ¨åˆ›å»ºå˜é‡çš„èµ‹å€¼è¯­å¥åï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">month = <span class="hljs-number">2</span> <span class="hljs-comment"># æœˆä»½çš„å–å€¼èŒƒå›´ä»0ï¼ˆ1æœˆï¼‰åˆ°11ï¼ˆ12æœˆï¼‰</span><br>catWeight = <span class="hljs-number">4.9</span> <span class="hljs-comment"># é‡é‡çš„å•ä½æ˜¯åƒå…‹</span><br>website = <span class="hljs-string">&#x27;ituring.cn&#x27;</span> <span class="hljs-comment"># å­—ç¬¦ä¸²ä¸è¦ä»¥&quot;https://&quot;å¼€å¤´</span><br></code></pre></td></tr></table></figure><p>ã€€ã€€é™¤éæ˜¯é€šè¿‡ç±»å‹æç¤ºçš„å½¢å¼ï¼Œå¦åˆ™å†…è”æ³¨é‡Šä¸åº”è¯¥æŒ‡å®šå˜é‡çš„æ•°æ®ç±»å‹ï¼Œå› ä¸ºæ˜¾ç„¶å¯ä»¥ä»èµ‹å€¼è¯­å¥ä¸­å¾—çŸ¥è¿™ä¸€ç‚¹ï¼Œ11.3.4èŠ‚ä¹Ÿå°†æœ‰ç›¸å…³æè¿°ã€‚</p><h3 id="11-1-3-è¯´æ˜æ€§çš„æ³¨é‡Š"><a href="#11-1-3-è¯´æ˜æ€§çš„æ³¨é‡Š" class="headerlink" title="11.1.3ã€€è¯´æ˜æ€§çš„æ³¨é‡Š"></a>11.1.3ã€€è¯´æ˜æ€§çš„æ³¨é‡Š</h3><p>ä¸€èˆ¬æ¥è¯´ï¼Œæ³¨é‡Šåº”è¯¥è§£é‡Šä¸ºä»€ä¹ˆä»£ç è¦è¿™æ ·å†™ï¼Œè€Œä¸æ˜¯è§£é‡Šä»£ç åšäº†ä»€ä¹ˆæˆ–æ€ä¹ˆåšçš„ã€‚å³ä½¿æ»¡è¶³äº†è‰¯å¥½çš„ä»£ç é£æ ¼å’Œç¬¬3ã€4ç« æåŠçš„æœ‰ç”¨çš„å‘½åçº¦æŸï¼Œä»£ç ä¹Ÿä¸èƒ½å¾ˆå¥½åœ°è§£é‡Šæœ€åˆç¼–å†™è€…çš„æ„å›¾ã€‚å³ä½¿æ˜¯ä½ è‡ªå·±å†™çš„ä»£ç ï¼Œå‡ å‘¨åä¹Ÿå¯èƒ½å¿˜è®°å…¶ä¸­çš„ç»†èŠ‚ã€‚ä½ åº”è¯¥å†™ç¿”å®çš„ä»£ç æ³¨é‡Šï¼Œè€Œä¸æ˜¯è®©ä»¥åçš„ä½ â€œéª‚â€è¿‡å»çš„è‡ªå·±ã€‚</p><p>ã€€ã€€æ¯”å¦‚ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªæ²¡æ„ä¹‰çš„æ³¨é‡Šï¼Œå®ƒè§£é‡Šäº†ä»£ç åšäº†ä»€ä¹ˆï¼ˆè¿™æ˜¯æ˜¾è€Œæ˜“è§çš„ï¼‰ï¼Œä½†å¹¶æ²¡æœ‰è¯´æ˜ä»£ç çš„åŠ¨æœºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>currentWeekWages *= <span class="hljs-number">1.5</span> <span class="hljs-comment"># å°†currentWeekWagesä¹˜ä»¥1.5</span><br></code></pre></td></tr></table></figure><p>ã€€ã€€è¿™æ¡æ³¨é‡Šè¿˜ä¸å¦‚æ²¡æœ‰ã€‚ä»ä»£ç ä¸­å°±èƒ½çœ‹å‡ºå˜é‡<code>currentWeekWages</code>è¢«ä¹˜ä»¥1.5ï¼Œç›´æ¥åˆ é™¤è¿™è¡Œæ³¨é‡Šä¼šè®©ä»£ç æ›´ç®€æ´ã€‚ä¸‹é¢çš„æ³¨é‡Šè¦å¥½å¾—å¤šï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>currentWeekWages *= <span class="hljs-number">1.5</span> <span class="hljs-comment"># æ˜¯å·¥èµ„çš„1.5å€</span><br></code></pre></td></tr></table></figure><p>ã€€ã€€è¿™è¡Œæ³¨é‡Šè§£é‡Šäº†ä»£ç èƒŒåçš„æ„å›¾ï¼Œè€Œä¸æ˜¯é‡è¿°ä»£ç è¦åšä»€ä¹ˆã€‚æ— è®ºä»£ç å†™å¾—å¤šå¥½ï¼Œä¹Ÿæ— æ³•æä¾›è¿™æ ·çš„èƒŒæ™¯ä¿¡æ¯ã€‚</p><h3 id="11-1-4-æ€»ç»“æ€§çš„æ³¨é‡Š"><a href="#11-1-4-æ€»ç»“æ€§çš„æ³¨é‡Š" class="headerlink" title="11.1.4ã€€æ€»ç»“æ€§çš„æ³¨é‡Š"></a>11.1.4ã€€æ€»ç»“æ€§çš„æ³¨é‡Š</h3><p>ã€€ã€€æ³¨é‡Šä¸ä»…ä»…å¯ä»¥ç”¨äºè¯´æ˜ç¨‹åºå‘˜çš„æ„å›¾ï¼Œä½¿ç”¨ç®€çŸ­çš„æ³¨é‡Šæ€»ç»“å¤šè¡Œä»£ç è¿˜å¯ä»¥ä½¿é˜…è¯»è€…ä¸çœ‹ä»£ç å°±èƒ½å¯¹å®ƒçš„ä½œç”¨æœ‰å¤§æ¦‚çš„è®¤è¯†ã€‚ç¨‹åºå‘˜ç»å¸¸ç”¨ç©ºè¡Œåˆ’åˆ†ä»£ç çš„â€œæ®µè½â€ï¼Œè€Œæ€»ç»“æ€§çš„æ³¨é‡Šé€šå¸¸åœ¨è¿™äº›æ®µè½çš„èµ·å§‹è¡Œã€‚ä¸åŒäºè§£é‡Šå•è¡Œä»£ç çš„å•è¡Œæ³¨é‡Šï¼Œæ€»ç»“æ€§æ³¨é‡Šåœ¨æ›´é«˜çš„æŠ½è±¡å±‚æ¬¡ä¸Šèµ·åˆ°è§£é‡Šä»£ç çš„ä½œç”¨ã€‚</p><p>ã€€ã€€æ¯”å¦‚ï¼Œé€šè¿‡é˜…è¯»ä»¥ä¸‹4è¡Œä»£ç ï¼Œå¯ä»¥å¾—çŸ¥å®ƒä»¬å°†<code>playerTurn</code>å˜é‡è®¾ç½®ä¸ºä»£è¡¨å¯¹é¢ç©å®¶çš„å€¼ã€‚ç®€æ´çš„æ³¨é‡Šå¯ä»¥ä½¿è¯»è€…ä¸å¿…é˜…è¯»å’Œæ¨æ•²ä»£ç å°±èƒ½ç†è§£ä»£ç çš„ç›®çš„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># è½®åˆ°å¯¹æ‰‹ï¼š</span><br><span class="hljs-keyword">if</span> playerTurn == PLAYER_X:<br>    playerTurn = PLAYER_O<br><span class="hljs-keyword">elif</span> playerTurn == PLAYER_O:<br>    playerTurn = PLAYER_X<br></code></pre></td></tr></table></figure><p>ã€€ã€€åœ¨ä»£ç ä¸­æ”¾ç½®è¿™äº›æ€»ç»“æ€§æ³¨é‡Šå¯ä»¥å¢å¼ºä»£ç çš„å¯è¯»æ€§ã€‚ç¨‹åºå‘˜å¯ä»¥å€Ÿç”±å®ƒä»¬è·³åˆ°æ„Ÿå…´è¶£çš„åœ°æ–¹åšæ·±å…¥äº†è§£ã€‚æ€»ç»“æ€§æ³¨é‡Šä¹Ÿå¯ä»¥é˜²æ­¢ç¨‹åºå‘˜å¯¹ä»£ç çš„ä½œç”¨äº§ç”Ÿè¯¯è§£ã€‚ä¸€ä¸ªç®€æ´çš„æ€»ç»“æ€§æ³¨é‡Šå¯ä»¥ç¡®ä¿å¼€å‘äººå‘˜æ­£ç¡®ç†è§£ä»£ç çš„å·¥ä½œåŸç†ã€‚</p><h3 id="11-1-5-â€œç»éªŒä¹‹è°ˆâ€çš„æ³¨é‡Š"><a href="#11-1-5-â€œç»éªŒä¹‹è°ˆâ€çš„æ³¨é‡Š" class="headerlink" title="11.1.5ã€€â€œç»éªŒä¹‹è°ˆâ€çš„æ³¨é‡Š"></a>11.1.5ã€€â€œç»éªŒä¹‹è°ˆâ€çš„æ³¨é‡Š</h3><p>ã€€ã€€ä¹‹å‰åœ¨è½¯ä»¶å…¬å¸å·¥ä½œæ—¶ï¼Œæˆ‘æœ‰ä¸€æ¬¡è¢«è¦æ±‚é€‚é…ä¸€ä¸ªå›¾å½¢åº“ï¼Œä½¿å…¶æ”¯æŒåŒ…å«æ•°ç™¾ä¸‡æ•°æ®ç‚¹çš„å›¾è¡¨å®æ—¶æ›´æ–°ã€‚æˆ‘ä»¬å½“æ—¶ä½¿ç”¨çš„åº“å¯ä»¥å®æ—¶æ›´æ–°å›¾è¡¨ï¼Œä¹Ÿå¯ä»¥æ”¯æŒæœ‰æ•°ç™¾ä¸‡æ•°æ®ç‚¹çš„å›¾è¡¨ï¼Œä½†ä¸èƒ½åŒæ—¶åšåˆ°ä¸¤è€…ã€‚ä¸€å¼€å§‹ï¼Œæˆ‘ä»¥ä¸ºç”¨å‡ å¤©æ—¶é—´å°±èƒ½å®Œæˆè¿™é¡¹ä»»åŠ¡ã€‚ä½†æ˜¯åˆ°äº†ç¬¬3å‘¨ï¼Œæˆ‘ä»ç„¶æ„Ÿè§‰è¿˜è¦è¿‡å‡ å¤©æ‰èƒ½å®Œæˆã€‚æ¯å¤©ï¼Œæˆ‘éƒ½è§‰å¾—è§£å†³æ–¹æ¡ˆå·²ç»è¿‘åœ¨çœ¼å‰äº†ï¼Œä½†ç›´åˆ°ç¬¬5å‘¨ï¼Œæˆ‘æ‰å¼„å‡ºäº†ä¸€ä¸ªèƒ½ç”¨å¾—ä¸Šçš„åŸå‹ã€‚</p><p>ã€€ã€€åœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘äº†è§£äº†å¤§é‡çš„å›¾å½¢åº“å·¥ä½œåŸç†ã€å…¶èƒ½åŠ›åŠé™åˆ¶ã€‚æˆ‘èŠ±äº†å‡ å°æ—¶æŠŠè¿™äº›ç»†èŠ‚å†™æˆäº†ä¸€æ•´é¡µçš„æ³¨é‡Šï¼Œå¹¶æŠŠå®ƒæ”¾åœ¨äº†ä»£ç ä¸­ã€‚æˆ‘çŸ¥é“ä»»ä½•ä¸€ä¸ªå¯¹ä»£ç è¿›è¡Œåç»­ä¿®æ”¹çš„äººéƒ½ä¼šåƒæˆ‘ä¸€æ ·ï¼Œé‡åˆ°çœ‹ä¼¼ç®€å•å®é™…ä¸Šæ£˜æ‰‹çš„é—®é¢˜ï¼Œè€Œæˆ‘å†™çš„è¿™ä»½æ–‡æ¡£å°†èŠ‚çœä»–ä»¬æ•°å‘¨çš„å·¥ä½œé‡ã€‚</p><p>ã€€ã€€æˆ‘å°†æ­¤ç±»æ³¨é‡Šç§°ä¸ºâ€œç»éªŒä¹‹è°ˆâ€çš„æ³¨é‡Šï¼Œå®ƒä»¬å¯èƒ½é•¿è¾¾å‡ æ®µï¼Œä»¥è‡³äºåœ¨ä»£ç æ–‡ä»¶ä¸­çœ‹èµ·æ¥å¾ˆçªå…€ã€‚ä½†å®ƒä»¬åŒ…å«çš„ä¿¡æ¯å¯¹äºä»»ä½•éœ€è¦ç»´æŠ¤è¿™äº›ä»£ç çš„äººè€Œè¨€éƒ½æ˜¯å®è—ã€‚ä¸è¦å®³æ€•åœ¨ä»£ç æ–‡ä»¶ä¸­å†™å¤§æ®µçš„ç”¨äºè§£é‡ŠæŸäº›å·¥ä½œåŸç†çš„è¯¦ç»†æ³¨é‡Šã€‚å¯¹äºç¨‹åºå‘˜è€Œè¨€ï¼Œå¾ˆå¤šç»†èŠ‚æ˜¯æœªçŸ¥çš„ï¼Œå¯èƒ½è¢«è¯¯è§£æˆ–è€…è¢«å¿½ç•¥ã€‚å¦‚æœå¼€å‘äººå‘˜ä¸éœ€è¦è¿™äº›æ³¨é‡Šï¼Œé‚£è·³è¿‡å®ƒä»¬å°±å¥½ï¼Œè€Œéœ€è¦å®ƒä»¬çš„å¼€å‘äººå‘˜ä¼šè°¢å¤©è°¢åœ°ã€‚è¯·è®°ä½ï¼Œâ€œç»éªŒä¹‹è°ˆâ€çš„æ³¨é‡Šè·Ÿä¸Šé¢ä¸¤ç±»æ³¨é‡Šä¸ä¸€æ ·ï¼Œå®ƒä¸åŒäºæ¨¡å—æˆ–è€…å‡½æ•°æ–‡æ¡£ï¼ˆè¿™æ˜¯æ–‡æ¡£å­—ç¬¦ä¸²è¦åšçš„ï¼‰ï¼Œå®ƒä¹Ÿä¸æ˜¯é’ˆå¯¹è½¯ä»¶ç”¨æˆ·çš„æ•™ç¨‹æˆ–æ“ä½œæŒ‡å—ï¼Œè€Œæ˜¯æä¾›ç»™å¼€å‘äººå‘˜çš„ã€‚</p><p>ã€€ã€€æˆ‘çš„â€œç»éªŒä¹‹è°ˆâ€æ³¨é‡Šä¸å¼€æºå›¾å½¢åº“æœ‰å…³ï¼Œå¯èƒ½ä¼šå¯¹å…¶ä»–äººæœ‰å¸®åŠ©ï¼Œæ‰€ä»¥æˆ‘èŠ±äº†äº›æ—¶é—´å°†å…¶æ•´ç†ä¸ºä¸€æ¡ç­”æ¡ˆå‘å¸ƒåˆ°å…¬å…±é—®ç­”ç½‘ç«™ä¸Šäº†ï¼Œä»¥ä¾¿æœ‰ç±»ä¼¼é—®é¢˜çš„äººå¯ä»¥æ‰¾åˆ°ã€‚</p><h3 id="11-1-8-ä»£ç æ ‡ç­¾å’ŒTODOæ³¨é‡Š"><a href="#11-1-8-ä»£ç æ ‡ç­¾å’ŒTODOæ³¨é‡Š" class="headerlink" title="11.1.8ã€€ä»£ç æ ‡ç­¾å’ŒTODOæ³¨é‡Š"></a>11.1.8ã€€ä»£ç æ ‡ç­¾å’ŒTODOæ³¨é‡Š</h3><p>ã€€ã€€ç¨‹åºå‘˜æœ‰æ—¶å€™ä¼šç•™ä¸‹ç®€çŸ­çš„æ³¨é‡Šï¼Œæé†’è‡ªå·±è¿˜æœ‰å“ªäº›å·¥ä½œè¦åšï¼Œé€šå¸¸æ˜¯ä»¥ä»£ç æ ‡ç­¾çš„å½¢å¼ï¼šä»¥å…¨å¤§å†™å­—æ¯æ ‡ç­¾å¼€å¤´ï¼Œåé¢æ˜¯ç®€çŸ­æè¿°çš„æ³¨é‡Šã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œä½ ä¼šä½¿ç”¨é¡¹ç›®ç®¡ç†å·¥å…·æ¥è¿½è¸ªè¿™ç±»é—®é¢˜ï¼Œè€Œä¸åªæ˜¯å†™åœ¨ä»£ç ä¸­ã€‚ä½†å¯¹äºæ²¡æœ‰ä½¿ç”¨è¿™äº›å·¥å…·çš„å°å‹ä¸ªäººé¡¹ç›®è€Œè¨€ï¼Œå°‘é‡çš„TODOæ³¨é‡Šå¯ä»¥èµ·åˆ°æé†’çš„ä½œç”¨ã€‚è¯·çœ‹ä¸‹é¢è¿™ä¸ªç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">_chargeIonFluxStream() <span class="hljs-comment"># TODOï¼šæ’æŸ¥ä¸ºä»€ä¹ˆæ¯å‘¨äºŒéƒ½ä¼šå¤±è´¥</span><br></code></pre></td></tr></table></figure><p>ã€€ã€€å¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ ‡ç­¾ä»¥èµ·åˆ°ä¸åŒç±»å‹çš„æé†’ä½œç”¨ã€‚</p><blockquote><p>ã€€ã€€TODOï¼šæç¤ºéœ€è¦å®Œæˆçš„å·¥ä½œã€‚</p><p>ã€€ã€€FIXMEï¼šæç¤ºè¿™éƒ¨åˆ†ä»£ç è¿˜ä¸èƒ½æ­£å¸¸å·¥ä½œã€‚</p><p>ã€€ã€€HACKï¼šæç¤ºè¿™éƒ¨åˆ†ä»£ç å¯ä»¥å·¥ä½œï¼Œä½†å¯èƒ½æœ‰äº›å‹‰å¼ºï¼Œéœ€è¦åšå‡ºæ”¹è¿›ã€‚</p><p>ã€€ã€€XXXï¼šé€šå¸¸ç”¨äºæç¤ºé«˜åº¦ä¸¥é‡çš„é—®é¢˜ã€‚</p></blockquote><p>ã€€ã€€ä½ åº”è¯¥åœ¨è¿™äº›æ€»æ˜¯å¤§å†™çš„æ ‡ç­¾ååŠ ä¸Šå¯¹æ‰‹å¤´ä»»åŠ¡æˆ–é—®é¢˜æ›´åŠ å…·ä½“çš„æè¿°ã€‚ç¨åï¼Œå¯ä»¥åœ¨æºä»£ç ä¸­æœç´¢è¿™äº›æ ‡ç­¾ï¼Œæ‰¾åˆ°éœ€è¦ä¿®æ­£çš„ä»£ç ã€‚ç¼ºç‚¹æ˜¯å®ƒä»¬å¾ˆå®¹æ˜“è¢«é—å¿˜ï¼Œé™¤éä½ æ­£å¥½åœ¨é˜…è¯»å®ƒä»¬æ‰€å¤„çš„ä»£ç æ®µè½ã€‚ä»£ç æ ‡ç­¾ä¸åº”è¯¥å–ä»£æ­£å¼çš„é—®é¢˜è·Ÿè¸ªå·¥å…·æˆ–è€…é”™è¯¯æŠ¥å‘Šå·¥å…·ã€‚å¦‚æœä½ ç¡®å®æƒ³åœ¨ä»£ç ä¸­ä½¿ç”¨ä»£ç æ ‡ç­¾ï¼Œæˆ‘å»ºè®®æŠŠè¿™ä¸ªå·¥ä½œå¤„ç†å¾—ç®€å•ä¸€äº›ï¼šåªä½¿ç”¨TODOï¼Œæ”¾å¼ƒåˆ«çš„æ ‡ç­¾ã€‚</p><h2 id="11-2-æ–‡æ¡£å­—ç¬¦ä¸²"><a href="#11-2-æ–‡æ¡£å­—ç¬¦ä¸²" class="headerlink" title="11.2ã€€æ–‡æ¡£å­—ç¬¦ä¸²"></a>11.2ã€€æ–‡æ¡£å­—ç¬¦ä¸²</h2><p>ã€€ã€€<strong>æ–‡æ¡£å­—ç¬¦ä¸²</strong>æ˜¯å‡ºç°åœ¨æ¨¡å—çš„.pyæºä»£ç æ–‡ä»¶é¡¶éƒ¨æˆ–è€…åœ¨ç±»æˆ–<code>def</code>è¯­å¥ä¹‹åçš„å¤šè¡Œæ³¨é‡Šã€‚å®ƒä»¬æä¾›å…³äºè¢«å®šä¹‰çš„æ¨¡å—ã€ç±»ã€å‡½æ•°æˆ–æ–¹æ³•çš„æ–‡æ¡£ã€‚è‡ªåŠ¨æ–‡æ¡£ç”Ÿæˆå·¥å…·å¯ä»¥ä½¿ç”¨è¿™äº›æ–‡æ¡£å­—ç¬¦ä¸²ç”Ÿæˆå¤–éƒ¨æ–‡æ¡£ï¼Œæ¯”å¦‚å¸®åŠ©æ–‡æ¡£æˆ–ç½‘é¡µã€‚</p><p>ã€€æ–‡æ¡£å­—ç¬¦ä¸²å¿…é¡»ä½¿ç”¨ä¸‰å¼•å·çš„å¤šè¡Œæ³¨é‡Šï¼Œä¸èƒ½ä½¿ç”¨ä»¥<code>#</code>å¼€å¤´çš„å•è¡Œæ³¨é‡Šã€‚æ–‡æ¡£å­—ç¬¦ä¸²åº”è¯¥å§‹ç»ˆä½¿ç”¨3ä¸ªåŒå¼•å·ï¼Œè€Œé3ä¸ªå•å¼•å·è¿›è¡ŒåŒ…è£¹ã€‚ä¾‹å¦‚ï¼Œè¿™é‡Œæ˜¯æµè¡Œçš„<code>requests</code>æ¨¡å—ä¸­session.pyæ–‡ä»¶çš„ä¸€éƒ¨åˆ†ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*- â¶</span><br><br><span class="hljs-string">&quot;&quot;&quot; â·</span><br><span class="hljs-string">requests.session</span><br><span class="hljs-string">~~~~~~~~~~~~~~~~</span><br><span class="hljs-string"></span><br><span class="hljs-string">This module provides a Session object to manage and persist settings across requests (cookies, auth,</span><br><span class="hljs-string">proxies).</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br>--snipâ€”<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Session</span>(<span class="hljs-title class_ inherited__">SessionRedirectMixin</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;A Requests session. â¸</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Provides cookie persistence, connection-pooling, and configuration.</span><br><span class="hljs-string"></span><br><span class="hljs-string">    Basic Usage::</span><br><span class="hljs-string"></span><br><span class="hljs-string">      &gt;&gt;&gt; import requests</span><br><span class="hljs-string">      &gt;&gt;&gt; s = requests.Session()</span><br><span class="hljs-string">      &gt;&gt;&gt; s.get(&#x27;https://httpbin.org/get&#x27;)</span><br><span class="hljs-string">      &lt;Response [200]&gt;</span><br><span class="hljs-string">--snip--</span><br><span class="hljs-string"></span><br><span class="hljs-string">    def get(self, url, **kwargs):</span><br><span class="hljs-string">        r&quot;&quot;&quot;</span>Sends a GET request. Returns :<span class="hljs-keyword">class</span>:`Response` <span class="hljs-built_in">object</span>. â¹<br><br>        :param url: URL <span class="hljs-keyword">for</span> the new :<span class="hljs-keyword">class</span>:`Request` <span class="hljs-built_in">object</span>.<br>        :param \*\*kwargs: <span class="hljs-type">Optional</span> arguments that request takes.<br>        :rtype: requests.Response<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">--snip--</span><br></code></pre></td></tr></table></figure><p>ã€€ã€€session.pyæ–‡ä»¶åŒ…æ‹¬è¯¥æ¨¡å—æœ¬èº«çš„æ–‡æ¡£å­—ç¬¦ä¸²â·ã€<code>Session</code>ç±»â¸åŠå…¶<code>get()</code>æ–¹æ³•â¹çš„æ–‡æ¡£å­—ç¬¦ä¸²ã€‚æ³¨æ„ï¼Œå°½ç®¡æ¨¡å—çš„æ–‡æ¡£å­—ç¬¦ä¸²åº”è¯¥æ˜¯æ¨¡å—ä¸­å‡ºç°çš„ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½†è¿˜æ˜¯åº”è¯¥è·Ÿåœ¨ç¥å¥‡çš„æ³¨é‡Šä¹‹åï¼Œæ¯”å¦‚shebangè¡Œæˆ–è€…ç¼–ç å®šä¹‰è¡Œâ¶ã€‚</p><p>ä¸€èˆ¬è€Œè¨€ï¼Œæ–‡æ¡£å­—ç¬¦ä¸²åº”è¯¥åŒ…å«ä¸€ä¸ªç”¨äºæ¦‚è¿°æ¨¡å—ã€ç±»æˆ–è€…å‡½æ•°çš„è¡Œï¼Œåé¢æœ‰ä¸€ä¸ªç©ºè¡Œï¼Œç©ºè¡Œåå†æä¾›æ›´è¯¦ç»†çš„ä¿¡æ¯ã€‚å¯¹äºå‡½æ•°å’Œæ–¹æ³•ï¼Œå¯ä»¥åŒ…å«å…³äºå‚æ•°ã€è¿”å›å€¼ã€å‰¯ä½œç”¨çš„ä¿¡æ¯ã€‚æˆ‘ä»¬ç¼–å†™çš„æ–‡æ¡£è¯´æ˜ä¸æ˜¯ç»™è½¯ä»¶çš„ä½¿ç”¨è€…çœ‹çš„ï¼Œè€Œæ˜¯ç»™ç¨‹åºå‘˜çœ‹çš„ã€‚å› æ­¤ï¼Œå®ƒä»¬åº”è¯¥åŒ…å«æŠ€æœ¯ä¿¡æ¯ï¼Œè€Œéä½¿ç”¨æ•™ç¨‹ã€‚</p><p>ã€€ã€€æ–‡æ¡£å­—ç¬¦ä¸²çš„å¦ä¸€ä¸ªé‡è¦ä¼˜ç‚¹æ˜¯å®ƒä»¬å°†æ–‡æ¡£é›†æˆåˆ°äº†æºä»£ç ä¸­ã€‚åˆ†å¼€ç¼–å†™æ–‡æ¡£å’Œä»£ç æ—¶ï¼Œå¾ˆå®¹æ˜“ç›´æ¥å¿˜è®°ç¼–å†™æ–‡æ¡£è¿™å›äº‹ã€‚ä½†ç”±äºæ–‡æ¡£å­—ç¬¦ä¸²è¢«æ”¾ç½®åœ¨æ¨¡å—ã€ç±»å’Œå‡½æ•°çš„é¡¶éƒ¨ï¼Œå› æ­¤è¿™äº›ä¿¡æ¯å¾ˆå®¹æ˜“è¢«æ³¨æ„åˆ°ï¼Œä¹Ÿæ–¹ä¾¿æ›´æ–°ã€‚</p><p>ã€€ã€€å½“ä»£ç è¿˜æœªå†™å®Œæ—¶ï¼Œä½ ä¸ä¸€å®šèƒ½å†™å‡ºç”¨æ¥æè¿°å®ƒçš„æ–‡æ¡£å­—ç¬¦ä¸²ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥åœ¨æ–‡æ¡£å­—ç¬¦ä¸²ä¸­åŠ å…¥ä¸€ä¸ªTODOæ³¨é‡Šï¼Œæé†’ä¹‹åå¡«è¡¥å‰©ä½™çš„ç»†èŠ‚ã€‚æ¯”å¦‚ï¼Œä¸‹é¢è¿™ä¸ªè™šæ„çš„<code>reverseCatPolarity()</code>å‡½æ•°æœ‰ä¸€ä¸ªä¸å¤ªå¥½çš„æ–‡æ¡£å­—ç¬¦ä¸²ï¼Œå®ƒå‘ˆç°äº†æ˜¾è€Œæ˜“è§çš„äº‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">reverseCatPolarity</span>(<span class="hljs-params">catId, catQuantumPhase, catVoltage</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;Reverses the polarity of a cat.</span><br><span class="hljs-string"></span><br><span class="hljs-string">    TODO Finish this docstring.&quot;&quot;&quot;</span><br>--snip--<br></code></pre></td></tr></table></figure><p>ã€€ã€€ç”±äºæ¯ä¸ªç±»ã€å‡½æ•°å’Œæ–¹æ³•éƒ½è¦æ±‚æœ‰æ–‡æ¡£å­—ç¬¦ä¸²ï¼Œå› æ­¤ä½ å¯èƒ½æƒ³å°½å¯èƒ½å°‘å†™æ–‡æ¡£ï¼Œå…ˆæ¨è¿›æ•´ä½“å·¥ä½œè¿›åº¦ã€‚å¦‚æœæ²¡æœ‰TODOæ³¨é‡Šï¼Œå¾ˆå®¹æ˜“å¿˜è®°éœ€è¦åæœŸé‡å†™è¿™ä¸ªæ–‡æ¡£å­—ç¬¦ä¸²ã€‚</p><p>ã€€ã€€PEP 257åŒ…å«äº†æ›´å¤šå…³äºæ–‡æ¡£å­—ç¬¦ä¸²çš„è¯´æ˜ï¼Œå¯ä»¥åœ¨Pythonå®˜ç½‘ä¸ŠæŸ¥é˜…ã€‚</p><h2 id="11-3-ç±»å‹æç¤º"><a href="#11-3-ç±»å‹æç¤º" class="headerlink" title="11.3ã€€ç±»å‹æç¤º"></a>11.3ã€€ç±»å‹æç¤º</h2><p>ã€€ã€€è®¸å¤šç¼–ç¨‹è¯­è¨€æ˜¯<strong>é™æ€ç±»å‹</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç¨‹åºå‘˜å¿…é¡»åœ¨ä»£ç ä¸­å£°æ˜æ‰€æœ‰å˜é‡ã€å‚æ•°ã€è¿”å›å€¼çš„æ•°æ®ç±»å‹ã€‚å®ƒçš„ä½œç”¨æ˜¯å…è®¸è§£é‡Šå™¨æˆ–ç¼–è¯‘å™¨åœ¨ç¨‹åºè¿è¡Œå‰æ£€æŸ¥ä»£ç æ˜¯å¦æ­£ç¡®ä½¿ç”¨äº†æ‰€æœ‰å¯¹è±¡ã€‚Pythonæ˜¯<strong>åŠ¨æ€ç±»å‹</strong>ï¼šå˜é‡ã€å‚æ•°å’Œè¿”å›å€¼å¯ä»¥æ˜¯ä»»ä½•æ•°æ®ç±»å‹ï¼Œç”šè‡³å¯ä»¥åœ¨ç¨‹åºè¿è¡Œæ—¶æ”¹å˜æ•°æ®ç±»å‹ã€‚åŠ¨æ€è¯­è¨€é€šå¸¸æ›´å®¹æ˜“ç¼–ç¨‹ï¼Œå› ä¸ºå®ƒä»¬ä¸éœ€è¦éµå¾ªå¾ˆå¤šé™åˆ¶ï¼Œä½†åŠ¨æ€è¯­è¨€ç¼ºä¹é™æ€è¯­è¨€æ‰€å…·æœ‰çš„é¿å…è¿è¡Œæ—¶é”™è¯¯çš„ä¼˜åŠ¿ã€‚æ¯”å¦‚ï¼Œå†™äº†ä¸€è¡ŒPythonä»£ç <code>round(&#39;42&#39;)</code>ï¼Œä½ å¯èƒ½æ²¡æ³¨æ„åˆ°æŠŠå­—ç¬¦ä¸²ä¼ é€’ç»™äº†åªæ¥å—<code>int</code>å‚æ•°æˆ–<code>float</code>å‚æ•°çš„å‡½æ•°ï¼Œç›´åˆ°è¿è¡Œä»£ç å‡ºé”™æ—¶æ‰æ„è¯†åˆ°è¿™ä¸€ç‚¹ã€‚å½“ä½ èµ‹äº†é”™è¯¯ç±»å‹çš„å€¼ï¼Œæˆ–ä¼ é€’äº†é”™è¯¯ç±»å‹çš„å‚æ•°æ—¶ï¼Œé™æ€ç±»å‹çš„è¯­è¨€ä¼šåœ¨è¿è¡Œå‰å‘å‡ºè­¦å‘Šã€‚</p><p>ã€€ã€€Pythoné€šè¿‡<strong>ç±»å‹æç¤º</strong>æä¾›äº†å¯é€‰çš„é™æ€ç±»å‹æ”¯æŒã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œç±»å‹æç¤ºç”¨ç²—ä½“æ ‡æ³¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">describeNumber</span>(<span class="hljs-params">number: <span class="hljs-built_in">int</span></span>) -&gt; <span class="hljs-built_in">str</span>:<br>    <span class="hljs-keyword">if</span> number % <span class="hljs-number">2</span> == <span class="hljs-number">1</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;An odd number. &#x27;</span><br>    <span class="hljs-keyword">elif</span> number == <span class="hljs-number">42</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;The answer. &#x27;</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Yes, that is a number. &#x27;</span><br><br>myLuckyNumber: <span class="hljs-built_in">int</span> = <span class="hljs-number">42</span><br><span class="hljs-built_in">print</span>(describeNumber(myLuckyNumber))<br></code></pre></td></tr></table></figure><p>ã€€ã€€æ­£å¦‚ä½ çœ‹åˆ°çš„ï¼Œç±»å‹æç¤ºä½¿ç”¨å†’å·æ¥åˆ†éš”å‚æ•°å’Œå˜é‡çš„åç§°ä¸ç±»å‹ã€‚å¯¹äºè¿”å›å€¼ï¼Œç±»å‹æç¤ºä½¿ç”¨ç®­å¤´ï¼ˆ<code>-&gt;</code>ï¼‰åˆ†éš”<code>def</code>è¯­å¥çš„é—­åˆæ‹¬å·å’Œç±»å‹ã€‚<code>describeNumber()</code>çš„ç±»å‹æç¤ºæ˜¾ç¤ºå®ƒçš„<code>number</code>å‚æ•°éœ€è¦æ•´æ•°å€¼ï¼Œè¿”å›å€¼æ˜¯å­—ç¬¦ä¸²ã€‚</p><p>ã€€ã€€ä¸å¿…ä¸ºç¨‹åºä¸­çš„æ¯ä¸€æ¡æ•°æ®éƒ½åŠ ä¸Šç±»å‹æç¤ºã€‚å¯ä»¥é‡‡ç”¨æ¸è¿›å¼ç±»å‹åŒ–æ–¹æ³•ï¼Œåªå¯¹æŸäº›å˜é‡ã€å‚æ•°å’Œè¿”å›å€¼è®¾ç½®ç±»å‹æç¤ºï¼Œè¿™æ˜¯åŠ¨æ€ç±»å‹çš„çµæ´»æ€§å’Œé™æ€ç±»å‹çš„å®‰å…¨æ€§ä¹‹é—´çš„ä¸€ä¸ªæŠ˜ä¸­ã€‚ä½†ç¨‹åºä¸­çš„ç±»å‹æç¤ºè¶Šå¤šï¼Œé™æ€ä»£ç åˆ†æå·¥å…·å°±èƒ½æœ‰æ›´å¤šçš„ä¿¡æ¯å‘ç°ç¨‹åºä¸­çš„æ½œåœ¨é”™è¯¯ã€‚</p><p>ã€€ã€€æ³¨æ„åœ¨å‰é¢çš„ä¾‹å­ä¸­ï¼ŒæŒ‡å®šç±»å‹çš„åç§°ä¸<code>int()</code>å’Œ<code>str()</code>æ„é€ å‡½æ•°çš„åç§°ä¸€è‡´ã€‚åœ¨Pythonä¸­ï¼Œç±»ã€ç±»å‹å’Œæ•°æ®ç±»å‹çš„å«ä¹‰ç›¸åŒã€‚å¯¹äºä»»ä½•ç”±ç±»æ„æˆçš„å®ä¾‹ï¼Œéƒ½åº”è¯¥ä½¿ç”¨ç±»çš„åç§°ä½œä¸ºç±»å‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> datetime<br>noon: datetime.time = datetime.time(<span class="hljs-number">12</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>) â¶<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CatTail</span>:<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, length: <span class="hljs-built_in">int</span>, color: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-literal">None</span>:<br>        self.length = length<br>        self.color = color<br><br>zophieTail: CatTail = CatTail(<span class="hljs-number">29</span>, <span class="hljs-string">&#x27;grey&#x27;</span>) â·<br></code></pre></td></tr></table></figure><p>ã€€ã€€<code>noon</code>å˜é‡çš„ç±»å‹æç¤ºæ˜¯<code>datetime.time</code>â¶ï¼Œå› ä¸ºå®ƒæ˜¯ä¸€ä¸ªæ—¶é—´å¯¹è±¡ï¼ˆåœ¨<code>datetime</code>æ¨¡å—ä¸­å®šä¹‰ï¼‰ã€‚åŒæ ·ï¼Œ<code>zophieTail</code>å¯¹è±¡çš„ç±»å‹æç¤ºæ˜¯<code>CatTail</code>â·ï¼Œå› ä¸ºå®ƒæ˜¯æˆ‘ä»¬ç”¨ç±»è¯­å¥åˆ›å»ºçš„<code>CatTail</code>ç±»çš„ä¸€ä¸ªå¯¹è±¡ã€‚ç±»å‹æç¤ºé€‚ç”¨äºæŒ‡å®šç±»å‹çš„æ‰€æœ‰å­ç±»ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå…·æœ‰ç±»å‹æç¤º<code>dict</code>çš„å˜é‡å¯ä»¥è¢«è®¾ç½®ä¸ºä»»ä½•å­—å…¸ç±»å‹çš„å€¼ï¼Œä¹Ÿå¯ä»¥è¢«è®¾ç½®ä¸º<code>collections.OrderedDict</code>ç±»å‹æˆ–è€…<code>collections.defaultdict</code>ç±»å‹çš„å€¼ï¼Œå› ä¸ºè¿™äº›ç±»æ˜¯<code>dict</code>çš„å­ç±»ã€‚</p><h3 id="11-3-2-ä¸ºå¤šç§ç±»å‹è®¾ç½®ç±»å‹æç¤º"><a href="#11-3-2-ä¸ºå¤šç§ç±»å‹è®¾ç½®ç±»å‹æç¤º" class="headerlink" title="11.3.2ã€€ä¸ºå¤šç§ç±»å‹è®¾ç½®ç±»å‹æç¤º"></a>11.3.2ã€€ä¸ºå¤šç§ç±»å‹è®¾ç½®ç±»å‹æç¤º</h3><p>ã€€ã€€Pythonçš„å˜é‡ã€å‚æ•°å’Œè¿”å›å€¼å¯ä»¥æœ‰å¤šç§å¯èƒ½çš„æ•°æ®ç±»å‹ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œå¯ä»¥ä»å†…ç½®çš„<code>typing</code>æ¨¡å—å¯¼å…¥<code>Union</code>ä»¥æŒ‡å®šå¤šç±»å‹çš„ç±»å‹æç¤ºã€‚åœ¨<code>Union</code>ç±»åç§°åé¢çš„ä¸­æ‹¬å·å†…æŒ‡å®šç±»å‹èŒƒå›´ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> typing <span class="hljs-keyword">import</span> <span class="hljs-type">Union</span><br>spam: <span class="hljs-type">Union</span>[<span class="hljs-built_in">int</span>, <span class="hljs-built_in">str</span>, <span class="hljs-built_in">float</span>] = <span class="hljs-number">42</span><br>spam = <span class="hljs-string">&#x27;hello&#x27;</span><br>spam = <span class="hljs-number">3.14</span><br></code></pre></td></tr></table></figure><p>ã€€ã€€åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œç±»å‹æç¤º<code>Union[int, str, float]</code>æŒ‡å®š<code>spam</code>å¯ä»¥è¢«è®¾ç½®ä¸ºæ•´æ•°ã€å­—ç¬¦ä¸²æˆ–æµ®ç‚¹æ•°ã€‚æ³¨æ„ï¼Œæœ€å¥½ä½¿ç”¨<code>from typing import *X*</code>çš„å½¢å¼ï¼Œè€Œé<code>import typing</code>çš„å½¢å¼ï¼Œè¿™æ ·åœ¨è¿›è¡Œç±»å‹æç¤ºæ—¶å°±ä¸å¿…åˆ°å¤„å†™æˆå†—é•¿çš„<code>typing.*X*</code>ã€‚</p><p>ã€€ã€€åœ¨æŒ‡å®šå˜é‡æˆ–è¿”å›å€¼æœ‰å¤šç§æ•°æ®ç±»å‹æ—¶ï¼Œå¦‚æœæƒ³åœ¨é™¤æ™®é€šç±»å‹ä¹‹å¤–è¿˜åŒ…æ‹¬<code>NoneType</code>ï¼Œä¹Ÿå°±æ˜¯<code>None</code>å€¼çš„ç±»å‹ï¼Œéœ€è¦åœ¨ä¸­æ‹¬å·å†…æ·»åŠ <code>None</code>ï¼Œè€Œé<code>NoneType</code>ã€‚ï¼ˆä»æŠ€æœ¯ä¸Šè®²ï¼Œ<code>NoneType</code>ä¸<code>int</code>æˆ–<code>str</code>ä¸åŒï¼Œå®ƒä¸æ˜¯å†…ç½®æ ‡è¯†ç¬¦ã€‚ï¼‰</p><p>ã€€ã€€æ›´å¥½çš„æ–¹å¼æ˜¯ä»<code>typing</code>æ¨¡å—ä¸­å¼•å…¥<code>Optional</code>ï¼Œä½¿ç”¨<code>Optional[str]</code>çš„å†™æ³•æ›¿ä»£<code>Union[str, None]</code>ã€‚è¿™ç§ç±»å‹æç¤ºæ„å‘³ç€å‡½æ•°æˆ–æ–¹æ³•é™¤äº†è¿”å›é¢„æœŸç±»å‹çš„å€¼ï¼Œè¿˜å¯ä»¥è¿”å›<code>None</code>ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªç¤ºä¾‹ï¼š</p><p><code>typing</code>æ¨¡å—å¯¹äºæ¯ç§å®¹å™¨ç±»å‹éƒ½æœ‰å•ç‹¬çš„ç±»å‹åˆ«åã€‚ä»¥ä¸‹åˆ—å‡ºäº†Pythonä¸­å¸¸è§çš„å®¹å™¨ç±»å‹çš„ç±»å‹åˆ«åï¼š</p><ul><li><code>List</code>æŒ‡åˆ—è¡¨ï¼ˆ<code>list</code>ï¼‰æ•°æ®ç±»å‹ï¼›</li><li><code>Tuple</code>æŒ‡å…ƒç»„ï¼ˆ<code>tuple</code>ï¼‰æ•°æ®ç±»å‹ï¼›</li><li><code>Dict</code>æŒ‡å­—å…¸ï¼ˆ<code>dict</code>ï¼‰æ•°æ®ç±»å‹ï¼›</li><li><code>Set</code>æŒ‡é›†åˆï¼ˆ<code>set</code>ï¼‰æ•°æ®ç±»å‹ï¼›</li><li><code>FrozenSet</code>æŒ‡ä¸å¯å˜é›†åˆï¼ˆ<code>frozenset</code>ï¼‰æ•°æ®ç±»å‹ï¼›</li><li><code>Sequence</code>æŒ‡åˆ—è¡¨ã€å…ƒç»„æˆ–ä»»ä½•å…¶ä»–åºåˆ—æ•°æ®ç±»å‹ï¼›</li><li><code>Mapping</code>æŒ‡å­—å…¸ã€é›†åˆã€ä¸å¯å˜é›†åˆæˆ–è€…ä»»ä½•å…¶ä»–æ˜ å°„æ•°æ®ç±»å‹ï¼›</li><li><code>ByteString</code>æŒ‡<code>bytes</code>ã€<code>bytearray</code>å’Œ<code>memoryview</code>ç±»å‹ã€‚</li></ul><p>ã€€ã€€ä½ å¯ä»¥åœ¨Pythonå®˜ç½‘ä¸Šæ‰¾åˆ°è¿™äº›ç±»å‹çš„å®Œæ•´åˆ—è¡¨ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€linuxã€‘Linuxå¸¸ç”¨å‘½ä»¤</title>
    <link href="/2024/01/09/Linux%E5%B8%B8%E7%94%A8%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/"/>
    <url>/2024/01/09/Linux%E5%B8%B8%E7%94%A8%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€-å…³æœº"><a href="#ä¸€-å…³æœº" class="headerlink" title="ä¸€ å…³æœº"></a>ä¸€ å…³æœº</h1><h2 id="1-1-å…³æœºé‡å¯ç›¸å…³æ“ä½œå‘½ä»¤"><a href="#1-1-å…³æœºé‡å¯ç›¸å…³æ“ä½œå‘½ä»¤" class="headerlink" title="1.1 å…³æœºé‡å¯ç›¸å…³æ“ä½œå‘½ä»¤"></a>1.1 å…³æœºé‡å¯ç›¸å…³æ“ä½œå‘½ä»¤</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">shutdown -h now<br>shutdown -h 5<br>poweroff <br><span class="hljs-meta prompt_"># </span><span class="language-bash">é‡å¯</span><br>shutdown -r now <br>shutdown -r 5<br>reboot <br></code></pre></td></tr></table></figure><h1 id="äºŒ-ç›®å½•æ“ä½œå‘½ä»¤"><a href="#äºŒ-ç›®å½•æ“ä½œå‘½ä»¤" class="headerlink" title="äºŒ ç›®å½•æ“ä½œå‘½ä»¤"></a>äºŒ ç›®å½•æ“ä½œå‘½ä»¤</h1><h2 id="2-1-å¢åˆ æ”¹æŸ¥"><a href="#2-1-å¢åˆ æ”¹æŸ¥" class="headerlink" title="2.1 å¢åˆ æ”¹æŸ¥"></a>2.1 å¢åˆ æ”¹æŸ¥</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell">cd  # è¿›å…¥<br>ls # æŸ¥çœ‹<br>mkdir # å¢ åˆ›å»º<br>rm -rf # åˆ é™¤<br>mv [é€‰é¡¹] [æºæ–‡ä»¶è·¯å¾„][ç›®æ ‡æ–‡ä»¶è·¯å¾„]#æºç›®å½• #æ–°ç›®å½•  #è¿˜æœ‰é‡å‘½å ç§»åŠ¨åŠŸèƒ½<br>cp [é€‰é¡¹] [æºæ–‡ä»¶è·¯å¾„][ç›®æ ‡æ–‡ä»¶è·¯å¾„] #æºæ–‡ä»¶ #ç›®æ ‡ç›®å½•æ–‡ä»¶<br>scp [é€‰é¡¹] [æºæ–‡ä»¶è·¯å¾„][ç›®æ ‡æ–‡ä»¶è·¯å¾„]<br>scp user@remote:/path/on/remote /path/to/local/directory # è¿œç¨‹åˆ°æœ¬åœ° åŠ -ræ˜¯é€’å½’<br>scp /path/to/local/file user@remote:/path/on/remote  # ä»æœ¬åœ°å¤åˆ¶æ–‡ä»¶åˆ°è¿œç¨‹ä¸»æœºï¼š<br>find [ç›®å½•] [å‚æ•°] [æ–‡ä»¶åç§°]<br>find /usr/tmp -name &#x27;a*&#x27;    æŸ¥æ‰¾/usr/tmpç›®å½•ä¸‹çš„æ‰€æœ‰ä»¥aå¼€å¤´çš„ç›®å½•æˆ–æ–‡ä»¶<br></code></pre></td></tr></table></figure><h1 id="ä¸‰-æ–‡ä»¶æ“ä½œå‘½ä»¤"><a href="#ä¸‰-æ–‡ä»¶æ“ä½œå‘½ä»¤" class="headerlink" title="ä¸‰ æ–‡ä»¶æ“ä½œå‘½ä»¤"></a>ä¸‰ æ–‡ä»¶æ“ä½œå‘½ä»¤</h1><h2 id="3-1-å¢åˆ æ”¹æŸ¥"><a href="#3-1-å¢åˆ æ”¹æŸ¥" class="headerlink" title="3.1 å¢åˆ æ”¹æŸ¥"></a>3.1 å¢åˆ æ”¹æŸ¥</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">toch æ–‡ä»¶å # åˆ›å»ºï¼Œä¸è¿‡ä¸€èˆ¬ç”¨vimåˆ›å»º<br>rm -rf [æ–‡ä»¶å] # åˆ <br>vim æ”¹<br></code></pre></td></tr></table></figure><h2 id="3-1-2-vim"><a href="#3-1-2-vim" class="headerlink" title="3.1.2 vim"></a>3.1.2 vim</h2><ul><li><p>æ¨¡å¼ï¼š</p></li><li><p>å‘½ä»¤æ¨¡å¼ï¼ˆcommand mode ï¼‰ï¼šå‘½ä»¤æ¨¡å¼å°±æ˜¯æœ€å¼€å§‹å•¥éƒ½ä¸æŒ‰çš„æ¨¡å¼ï¼Œå…‰æ ‡ç§»åŠ¨ï¼ŒæŸ¥çœ‹æ–‡ä»¶çš„</p><ul><li>å¯ä»¥æ§åˆ¶å±å¹•å…‰æ ‡çš„ç§»åŠ¨ï¼Œå­—ç¬¦ã€å­—æˆ–è€…è¡Œçš„æŸ¥æ‰¾åˆ é™¤å’Œç§»åŠ¨ ä¹Ÿå¯ä»¥åœ¨æŒ‡å®šå…‰æ ‡ä¸‹è¿›å…¥æ’å…¥æ¨¡å¼</li><li><strong>æ§åˆ¶å…‰æ ‡ç§»åŠ¨ï¼šâ†‘ï¼Œâ†“ï¼Œ</strong><ul><li><strong>h å·¦j ä¸Šk ä¸‹l å³</strong></li><li><strong>Ctrl + fä¸Šç¿»é¡µCtrl + bä¸‹ç¿»é¡µ Ctrl + u&#96;ä¸Šç¿»åŠé¡µCtrl + dä¸‹ç¿»åŠé¡µ</strong></li></ul></li><li><strong>æ”¹ï¼šæŒ‰ i è¿›å…¥æ’å…¥æ¨¡å¼ æ”¹ä¹Ÿæ˜¯ä¸€ä¸ªæ„æ€</strong></li><li><strong>åˆ é™¤ï¼š æŒ‰dd åˆ é™¤å½“å‰è¡Œï¼Œdd dGæ˜¯æ¸…ç©ºæ‰€æœ‰</strong></li><li><strong>å¤åˆ¶ï¼šæŒ‰yyå¤åˆ¶å½“å‰è¡Œ</strong></li><li><strong>ç²˜è´´ï¼šæŒ‰pp ç²˜è´´åˆšåˆšå¤åˆ¶çš„æ–‡æœ¬</strong></li><li><strong>æ’¤é”€ï¼šæŒ‰uuæ’¤é”€ä¸Šä¸€æ­¥</strong></li></ul></li><li><p><strong>æ’å…¥æ¨¡å¼ï¼ˆinsert modeï¼‰</strong>ï¼š</p><ul><li>i  ï¼šåœ¨å…‰æ ‡å­—ç¬¦å‰å¼€å§‹æ’å…¥</li><li><strong>a ï¼šåœ¨å…‰æ ‡å­—ç¬¦åå¼€å§‹æ’å…¥</strong></li><li><strong>o ï¼š åœ¨å…‰æ ‡æ‰€åœ¨çš„è¡Œä¸‹é¢</strong></li></ul></li><li><p>åº•è¡Œæ¨¡å¼ï¼š å†’å·qå’Œwqå’Œï¼</p></li><li><p>å¦‚æœè¦åŒ¹é…ï¼ˆæœç´¢ï¼‰å¯¹åº”çš„æ–‡æœ¬ï¼Œç”¨<code>/</code></p><ul><li>æ¯”å¦‚è¯´<code>/con</code></li><li>æŒ‰å›è½¦è¿›å…¥æ–‡ï¼ŒæŒ‰n æŸ¥æ‰¾ä¸‹ä¸€ä¸ªï¼ŒæŒ‰Shift+nè¿›å…¥ä¸Šä¸€ä¸ª</li></ul></li><li><p>è¿›å…¥å‘½ä»¤æ¨¡å¼ï¼šæŒ‰ä¸‹ <code>Esc</code> é”®ç¡®ä¿å¤„äºæ­£å¸¸æ¨¡å¼ï¼ˆNormal modeï¼‰ã€‚</p></li><li><p>è¾“å…¥ä»¥ä¸‹å‘½ä»¤ä¹‹ä¸€æ¥åˆ‡æ¢è¡Œå·æ˜¾ç¤ºï¼š</p><ul><li>æ˜¾ç¤ºç»å¯¹è¡Œå·ï¼šè¾“å…¥ <code>:set number</code> å¹¶æŒ‰ä¸‹ Enter é”®ã€‚</li><li>æ˜¾ç¤ºç›¸å¯¹è¡Œå·ï¼šè¾“å…¥ <code>:set relativenumber</code> å¹¶æŒ‰ä¸‹ Enter é”®ã€‚</li></ul></li></ul><h2 id="3-1-3-æ–‡ä»¶æŸ¥çœ‹"><a href="#3-1-3-æ–‡ä»¶æŸ¥çœ‹" class="headerlink" title="3.1.3 æ–‡ä»¶æŸ¥çœ‹"></a>3.1.3 æ–‡ä»¶æŸ¥çœ‹</h2><ul><li><p>cat ç›´æ¥çœ‹</p></li><li><p>more ï¼šä¼šæ˜¾ç¤ºç™¾åˆ†æ¯”ã€‚è·Ÿvimçš„å‘½ä»¤æ¨¡å¼å·®ä¸å¤šï¼Œå¯ä»¥Ctrl +f b u d ç¿»é¡µ </p><ul><li><strong>ä¹Ÿå¯ä»¥å›è½¦ç©ºæ ¼å‘ä¸‹ç¿»ã€è¿™ä¸ªå¥½ç”¨ã€‘</strong></li></ul></li><li><p>lessï¼šæœªæ‰¾åˆ°å‘½ä»¤ï¼Œè¦å®‰è£…çš„ï¼Œå…ˆä¸å­¦</p></li><li><p>taill ï¼š æŒ‡å®šè¡Œæ•°æˆ–è€…åŠ¨æ€æŸ¥çœ‹ </p><ul><li>ä¸€èˆ¬çœ‹æ—¥å¿—ç”¨çš„ï¼Œtail -f 100 [æ–‡ä»¶å]</li></ul></li></ul><h2 id="3-2-æƒé™çš„è§£è¯»è·Ÿä¿®æ”¹åŠç”¨æˆ·ç®¡ç†"><a href="#3-2-æƒé™çš„è§£è¯»è·Ÿä¿®æ”¹åŠç”¨æˆ·ç®¡ç†" class="headerlink" title="3.2 æƒé™çš„è§£è¯»è·Ÿä¿®æ”¹åŠç”¨æˆ·ç®¡ç†"></a>3.2 æƒé™çš„è§£è¯»è·Ÿä¿®æ”¹åŠç”¨æˆ·ç®¡ç†</h2><p>æŸ¥çœ‹è¯¦æƒ…ï¼šllæˆ–è€… ls -l</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell">ll # æˆ–è€…ls -l <br>-rw-r--r-- 1 user group  4096 Jan  1 10:00 file.txt<br>drwxr-xr-x 2 user group  4096 Jan  1 10:00 directory<br>d # ä»£è¡¨æ˜¯ç›®å½•<br>rwx #ç¬¬ä¸€ç»„ï¼ˆrwxï¼‰ è¡¨ç¤ºæ‰€æœ‰è€…çš„æƒé™ï¼Œrè¯» wå†™ xæ‰§è¡Œ<br>xr # ç¬¬äºŒç»„ï¼ˆxrï¼‰åŒç»„ç”¨æˆ·çš„æƒé™<br>x # ç¬¬ä¸‰ç»„(x) è¡¨ç¤ºå…¶ä»–ç”¨æˆ·ï¼ŒéåŒç»„ç”¨æˆ·çš„æƒé™<br>user # æ‰€å±ç”¨æˆ·<br>group # ç”¨æˆ·æ‰€å±ç»„<br>chmod +x # æ·»åŠ æ‰§è¡Œæƒé™<br>chmod 777  # æ·»åŠ æ‰€æœ‰æƒé™<br></code></pre></td></tr></table></figure><p>æ·»åŠ ç®¡ç†ç”¨æˆ·</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">useradd user1 # æ·»åŠ ç”¨æˆ·1<br>id user1 # æŸ¥çœ‹ç”¨æˆ·æ‰€å±ä¿¡æ¯<br>uid=1001(user1) gid=1001(user1) ç»„=1001(user1),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),122(lpadmin),135(lxd),1000(wang),136(sambashare)<br>useradd -g root user2 # ä¸ºæ–°æ·»åŠ çš„ç”¨æˆ·æ·»åŠ ç»„<br>useradd -d /etc/nologin -g apache -s /bin/false user1<br>passwd user3 # æ›´æ”¹æˆ–è€…è®¾ç½®ç”¨æˆ·å¯†ç <br></code></pre></td></tr></table></figure><h1 id="å››ã€å‹ç¼©æ–‡ä»¶æ“ä½œ"><a href="#å››ã€å‹ç¼©æ–‡ä»¶æ“ä½œ" class="headerlink" title="å››ã€å‹ç¼©æ–‡ä»¶æ“ä½œ"></a>å››ã€å‹ç¼©æ–‡ä»¶æ“ä½œ</h1><h2 id="4-1-æ‰“åŒ…å’Œå‹ç¼©"><a href="#4-1-æ‰“åŒ…å’Œå‹ç¼©" class="headerlink" title="4.1 æ‰“åŒ…å’Œå‹ç¼©"></a>4.1 æ‰“åŒ…å’Œå‹ç¼©</h2><p>linux ä¸­ä¸€èˆ¬éƒ½æ˜¯æ‰“åŒ…tar æ–‡ä»¶  å‹ç¼©å°±æ˜¯gzæ–‡ä»¶</p><p>è€Œä¸€èˆ¬æƒ…å†µä¸‹æ‰“åŒ…ç›’å‹ç¼©æ˜¯ä¸€èµ·è¿›è¡Œçš„ï¼Œæ‰“åŒ…å¹¶ä¸”å‹ç¼©åçš„æ–‡ä»¶çš„åç¼€åä¸€èˆ¬æ˜¯.tar.gz</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">tar -zcvf [æ‰“åŒ…åçš„æ–‡ä»¶å.tar] [è¦æ‰“åŒ…çš„æ–‡ä»¶] # æ‰“åŒ…<br>-z # zå°±æ˜¯gz è°ƒç”¨gzip å‹ç¼©å‘½ä»¤è¿›è¡Œå‹ç¼©<br>-c # æ‰“åŒ…æ–‡ä»¶ å°±æ˜¯tarçš„ä½œç”¨<br>-v # æ˜¾ç¤ºæ‰“åŒ…è¿è¡Œçš„è¿‡ç¨‹ï¼ˆè·‘ä»£ç ï¼‰<br>-f # æŒ‡å®šæ–‡ä»¶å<br>tar -zcvf test.tar test.py<br><span class="hljs-meta prompt_"># </span><span class="language-bash">è§£å‹</span><br>tar -zxvf [å‹ç¼©æ–‡ä»¶å] <br>-x # x å°±æ˜¯è§£å‹ç¼©è´¨é‡<br></code></pre></td></tr></table></figure><h1 id="äº”ã€æŸ¥æ‰¾å‘½ä»¤åŠä¸‰å‰‘å®¢ã€é‡ç‚¹ã€‘"><a href="#äº”ã€æŸ¥æ‰¾å‘½ä»¤åŠä¸‰å‰‘å®¢ã€é‡ç‚¹ã€‘" class="headerlink" title="äº”ã€æŸ¥æ‰¾å‘½ä»¤åŠä¸‰å‰‘å®¢ã€é‡ç‚¹ã€‘"></a>äº”ã€æŸ¥æ‰¾å‘½ä»¤åŠä¸‰å‰‘å®¢ã€é‡ç‚¹ã€‘</h1><h2 id="5-1-grep-å¼ºå¤§çš„æ–‡æœ¬æœç´¢å·¥å…·"><a href="#5-1-grep-å¼ºå¤§çš„æ–‡æœ¬æœç´¢å·¥å…·" class="headerlink" title="5.1 grep å¼ºå¤§çš„æ–‡æœ¬æœç´¢å·¥å…·"></a>5.1 grep å¼ºå¤§çš„æ–‡æœ¬æœç´¢å·¥å…·</h2><h2 id="5-2-sed-ï¼ˆStream-Editorï¼‰ç®€å•ä»‹ç»"><a href="#5-2-sed-ï¼ˆStream-Editorï¼‰ç®€å•ä»‹ç»" class="headerlink" title="5.2 sed ï¼ˆStream Editorï¼‰ç®€å•ä»‹ç»"></a>5.2 sed ï¼ˆStream Editorï¼‰ç®€å•ä»‹ç»</h2><p>Stream Editor æµç¼–è¾‘å™¨ ï¼Œç”¨äºå¯¹æ–‡æœ¬è¿›è¡Œè½¬æ¢ã€æ›¿æ¢ã€åˆ é™¤ã€æ’å…¥å’Œæ‰“å°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">sed æœ‰ä¸¤ç§æ¨¡å¼ -e ä¸ä¿®æ”¹ç”Ÿäº§æ–°æ–‡æœ¬ -iä¿®æ”¹æ–‡ä»¶å†…å®¹</span><br>sed -e &#x27;æ—§å†…å®¹ æ–°å†…å®¹&#x27; xxæ–‡ä»¶ # ä¸ä¿®æ”¹æ–‡ä»¶å†…å®¹ ç”¨-e<br>sed -i &#x27;æ—§å†…å®¹ æ–°å†…å®¹&#x27; xxæ–‡ä»¶ # ä¿®æ”¹æ–‡ä»¶å†…å®¹ ç”¨-i<br>sed -e åé¢å¯ä»¥æ¥æŒ‡ä»¤<br>a # æ–°å¢<br>c # å–ä»£<br>d #ã€€åˆ é™¤<br>i # æ’å…¥<br>p # æ‰“å°<br>Reading the configuration file, at line 416 &#x27;locale-collate &quot;&quot;&#x27;<br><br></code></pre></td></tr></table></figure><h2 id="5-3-awk-åˆ‡ç‰‡ï¼Œå¼ºå¤§çš„æ–‡æœ¬å¤„ç†ã€é‡ç‚¹ã€‘"><a href="#5-3-awk-åˆ‡ç‰‡ï¼Œå¼ºå¤§çš„æ–‡æœ¬å¤„ç†ã€é‡ç‚¹ã€‘" class="headerlink" title="5.3 awk  åˆ‡ç‰‡ï¼Œå¼ºå¤§çš„æ–‡æœ¬å¤„ç†ã€é‡ç‚¹ã€‘"></a>5.3 <strong>awk  åˆ‡ç‰‡ï¼Œå¼ºå¤§çš„æ–‡æœ¬å¤„ç†ã€é‡ç‚¹ã€‘</strong></h2><p>ä¸»è¦ç”¨æ¥å°†æ•°æ®è¿›è¡Œåˆ‡ç‰‡è¾“å‡ºçš„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">awk &#x27;&#123;print $1&#125;&#x27; # ç”¨awkå¯¹å†…å®¹è¿›è¡Œè¿›è¡Œåˆ‡ç‰‡ï¼Œæ¯ä¸€è¡Œï¼Œå–ç¬¬ä¸€ä¸ªå­—æ®µï¼Œä»¥ç©ºæ ¼è¿›è¡Œåˆ†éš”<br>address: cosmos1g920yuxdmqtfxg4w8a0j9sgaazfryr2cx0d755<br><span class="hljs-meta prompt_"># </span><span class="language-bash">å–å‡ºaddressçš„å€¼</span><br>awk â€˜/address/&#123;print $2&#125;â€™  #å¾—åˆ°cosmos1g920yuxdmqtfxg4w8a0j9sgaazfryr2cx0d755<br>åŸç†æ˜¯ï¼šå…¶ä¸­ `/address/` è¡¨ç¤ºåŒ¹é…åŒ…å« `address` çš„è¡Œï¼Œ`&#123;print $2&#125;` è¡¨ç¤ºè¾“å‡ºè¯¥è¡Œçš„ç¬¬äºŒä¸ªå­—æ®µã€‚è¾“å‡ºç»“æœä¸º `cosmos1g920yuxdmqtfxg4w8a0j9sgaazfryr2cx0d755`<br><span class="hljs-meta prompt_">$</span><span class="language-bash">2 é‡Œé¢çš„2å¯ä»¥æ¢æˆ1ã€3ã€4ç­‰ä»»ä½•æ•°å­—ï¼Œæ•°å­—è¡¨ç¤ºä½ åŒ¹é…åˆ°çš„å­—æ®µçš„åå‡ ä½å¼€å§‹çš„æ•°æ®ï¼Œä¾‹å¦‚ä½ åŒ¹é…åˆ°çš„cosmosxxxxxxæ˜¯åœ¨addressçš„åé¢çš„3ä¸ªå­—ç¬¦åæ‰å‡ºç°çš„ï¼Œé‚£å°±æ˜¯<span class="hljs-variable">$3</span> ç¬¬å››ä¸ªå­—ç¬¦å‡ºç°çš„å°±æ˜¯<span class="hljs-variable">$4</span>ï¼Œä»¥æ­¤ç±»æ¨</span><br></code></pre></td></tr></table></figure><p>æ¯”å¦‚ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker ps <br>CONTAINER ID   IMAGE                             COMMAND                   CREATED       STATUS                  PORTS                                                           NAMES<br>a7a584dfd04a   django-vue-admin_dvadmin-django   &quot;/backend/docker_staâ€¦&quot;   13 days ago   Up Less than a second   0.0.0.0:8000-&gt;8000/tcp, :::8000-&gt;8000/tcp                       dvadmin-django<br>286cc8be5d9f   mysql:5.7                         &quot;docker-entrypoint.sâ€¦&quot;   13 days ago   Up Less than a second   0.0.0.0:3306-&gt;3306/tcp, :::3306-&gt;3306/tcp, 33060/tcp            dvadmin-mysql<br>1cb7df749dec   mysql:8.0.30                      &quot;docker-entrypoint.sâ€¦&quot;   2 weeks ago   Up Less than a second   33060/tcp, 0.0.0.0:3307-&gt;3306/tcp, :::3307-&gt;3306/tcp            django_mysql<br>93b06a5f97a1   portainer/portainer-ce:latest     &quot;/portainer&quot;              2 weeks ago   Up Less than a second   8000/tcp, 9443/tcp, 0.0.0.0:1009-&gt;9000/tcp, :::1009-&gt;9000/tcp   portainer<br><br>docker ps | awk &#x27;&#123;print $1&#125;&#x27; # ä½¿ç”¨ awk å·¥å…·å¯¹å‰ä¸€ä¸ªå‘½ä»¤çš„è¾“å‡ºè¿›è¡Œå¤„ç†ï¼Œæå–æ¯è¡Œçš„ç¬¬ä¸€ä¸ªå­—æ®µï¼ˆä»¥ç©ºæ ¼ä¸ºåˆ†éš”ç¬¦ï¼‰ï¼Œå¹¶å°†å…¶æ‰“å°å‡ºæ¥<br>CONTAINER<br>a7a584dfd04a<br>286cc8be5d9f<br>1cb7df749dec<br>93b06a5f97a1<br>docker ps | awk &#x27;&#123;print $1&#125;&#x27;|tail +2  # ä»ç¬¬äºŒä¸ªå¼€å§‹å–<br>a7a584dfd04a<br>286cc8be5d9f<br>1cb7df749dec<br>93b06a5f97a1<br>docker stop $(docker ps | awk &#x27;&#123;print $1&#125;&#x27;|tail +2) # åœæ­¢å®¹å™¨<br></code></pre></td></tr></table></figure><h2 id="5-4-find-æ‰¾æ–‡ä»¶"><a href="#5-4-find-æ‰¾æ–‡ä»¶" class="headerlink" title="5.4 find æ‰¾æ–‡ä»¶"></a>5.4 find æ‰¾æ–‡ä»¶</h2><p>findå‘½ä»¤å†ç›®å½•ç»“æ„ä¸­æœç´¢æ–‡ä»¶ï¼Œå¹¶å¯¹æœç´¢ç»“æœè¿›è¡ŒçŸ¥é“çš„æ“ä½œ</p><p>find é»˜è®¤æœç´¢å½“å‰ç›®å½•æœºå™¨å­ç›®å½•ï¼Œå¹¶ä¸”<strong>ä¸è¿‡æ»¤ä»»ä½•ç»“æœï¼ˆä¹Ÿå°±æ˜¯è¿”å›æ‰€æœ‰æ–‡ä»¶ï¼‰</strong>å°†å®ƒä»¬å…¨éƒ¨æ˜¾ç¤ºå†å…¬å±ä¸Š</p><p>æ‰€ä»¥ä½¿ç”¨findçš„æ—¶å€™æœ€å¥½è¦è·Ÿä¸€ä¸‹ç›®æ ‡ç›®å½• ä¸€èˆ¬ç”¨**-lsæŸ¥æ‰¾å½“å‰ç›®å½•**</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">find . -name &quot;*.log&quot; -ls  åœ¨å½“å‰ç›®å½•æŸ¥æ‰¾ä»¥.logç»“å°¾çš„æ–‡ä»¶ï¼Œå¹¶æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯ã€‚ <br>find /root/ -perm 600   æŸ¥æ‰¾/root/ç›®å½•ä¸‹æƒé™ä¸º600çš„æ–‡ä»¶ <br>find . -type f -name &quot;*.log&quot;  æŸ¥æ‰¾å½“ç›®å½•ï¼Œä»¥.logç»“å°¾çš„æ™®é€šæ–‡ä»¶ <br>find . -type d | sort   æŸ¥æ‰¾å½“å‰æ‰€æœ‰ç›®å½•å¹¶æ’åº <br>find . -size +100M  æŸ¥æ‰¾å½“å‰ç›®å½•å¤§äº100Mçš„æ–‡ä»¶<br></code></pre></td></tr></table></figure><h2 id="5-5-which"><a href="#5-5-which" class="headerlink" title="5.5 which"></a>5.5 which</h2><p>whichå‘½ä»¤çš„ä½œç”¨å®åœ¨PATHå˜é‡æŒ‡å®šçš„è·¯å¾„é’Ÿï¼Œæœç´¢æŸä¸€ä¸ªç³»ç»Ÿå‘½ä»¤çš„ä½ç½®ï¼Œå¹¶ä¸”è¿”å›ç¬¬ä¸€ä¸ªæœç´¢ç»“æœä¸€èˆ¬ç”¨äºæŸ¥æ‰¾æŸä¸ªæŒ‡ä»¤æ‰€åœ¨çš„ä½ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">which pwd # æŸ¥æ‰¾pwd å‘½ä»¤æ‰€åœ¨çš„è·¯å¾„<br>which java # æŸ¥æ‰¾PATHä¸­javaæ‰€åœ¨çš„è·¯å¾„<br>which python # æŸ¥æ‰¾PATHä¸­pythonæ‰€åœ¨çš„è·¯å¾„<br></code></pre></td></tr></table></figure><h2 id="5-6whereis-æ²¡ç”¨è¿‡"><a href="#5-6whereis-æ²¡ç”¨è¿‡" class="headerlink" title="5.6whereis æ²¡ç”¨è¿‡"></a>5.6whereis æ²¡ç”¨è¿‡</h2><p>whereiså‘½ä»¤æ˜¯å®šä½å¯æ‰§è¡Œæ–‡ä»¶ã€æºä»£ç æ–‡ä»¶ã€å¸®åŠ©æ–‡ä»¶åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä½ç½®ã€‚è¿™äº›æ–‡ä»¶çš„å±æ€§åº”å±äºåŸå§‹ä»£ç ï¼ŒäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæˆ–æ˜¯å¸®åŠ©æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">whereis ls    å°†å’Œlsæ–‡ä»¶ç›¸å…³çš„æ–‡ä»¶éƒ½æŸ¥æ‰¾å‡ºæ¥<br></code></pre></td></tr></table></figure><h2 id="5-7-locate-æ²¡ç”¨è¿‡-è®°ç¬”è®°"><a href="#5-7-locate-æ²¡ç”¨è¿‡-è®°ç¬”è®°" class="headerlink" title="5.7 locate æ²¡ç”¨è¿‡ è®°ç¬”è®°"></a>5.7 locate æ²¡ç”¨è¿‡ è®°ç¬”è®°</h2><h1 id="å…­-su-å’Œsudo"><a href="#å…­-su-å’Œsudo" class="headerlink" title="å…­ su å’Œsudo"></a>å…­ su å’Œsudo</h1><h1 id="ä¸ƒã€ç³»ç»ŸæœåŠ¡"><a href="#ä¸ƒã€ç³»ç»ŸæœåŠ¡" class="headerlink" title="ä¸ƒã€ç³»ç»ŸæœåŠ¡"></a>ä¸ƒã€ç³»ç»ŸæœåŠ¡</h1><h2 id="7-1-systemctl"><a href="#7-1-systemctl" class="headerlink" title="7.1 systemctl"></a>7.1 systemctl</h2><p><code>systemctl</code> å‘½ä»¤ç”¨äºç®¡ç† systemd ç³»ç»Ÿå’ŒæœåŠ¡ç®¡ç†å™¨ã€‚å®ƒå¯ä»¥å¯åŠ¨ã€åœæ­¢ã€é‡å¯ã€é‡æ–°åŠ è½½å’ŒæŸ¥è¯¢ç³»ç»ŸæœåŠ¡çš„çŠ¶æ€ã€‚ä¸€äº›å¸¸ç”¨çš„ <code>systemctl</code> å‘½ä»¤åŒ…æ‹¬ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl start service_name # å¯åŠ¨æœåŠ¡<br>systemctl stop service_name # åœæ­¢æœåŠ¡<br>systemctl restart service_name # é‡å¯æœåŠ¡<br>systemctl status service_name # æŸ¥çœ‹æœåŠ¡ä¿¡æ¯<br></code></pre></td></tr></table></figure><p>ä¹Ÿå¯ä»¥ç”¨ service ï¼Œä¸€æ ·çš„æ„æ€</p><h2 id="7-2-service"><a href="#7-2-service" class="headerlink" title="7.2 service"></a>7.2 service</h2><h2 id="7-3-ps"><a href="#7-3-ps" class="headerlink" title="7.3 ps"></a>7.3 ps</h2><p>ps æŸ¥çœ‹å½“å‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">ps -e | grep process_name # æŸ¥çœ‹æŒ‡å®šè¿›ç¨‹å<br>ps -ef  # åˆ—å‡ºå½“å‰çš„æ‰€æœ‰è¿›ç¨‹ï¼Œé™æ€çš„<br>ps -aux | grep  process_name # aux æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹åŠå…¶è¯¦æƒ…ä¿¡æ¯åŒ…æ‹¬å…¶ä»–ç”¨æˆ·çš„è¿›ç¨‹ï¼Œä¸€èˆ¬é…åˆgrep  <br><span class="hljs-meta prompt_"># </span><span class="language-bash">ä¸‰ä¸ªå‘½ä»¤ä¸€æ ·çš„</span><br></code></pre></td></tr></table></figure><h2 id="7-4-ç«¯å£"><a href="#7-4-ç«¯å£" class="headerlink" title="7.4 ç«¯å£"></a>7.4 ç«¯å£</h2><p><code>netstat</code>ï¼š<code>netstat</code> å‘½ä»¤ç”¨äºæ˜¾ç¤ºç½‘ç»œè¿æ¥ã€è·¯ç”±è¡¨å’Œç½‘ç»œæ¥å£ä¿¡æ¯ã€‚ä½ å¯ä»¥ä½¿ç”¨ä¸åŒçš„é€‰é¡¹æ¥è¿‡æ»¤å’Œæ˜¾ç¤ºç‰¹å®šçš„ç½‘ç»œä¿¡æ¯ã€‚ä¸€äº›å¸¸ç”¨çš„ <code>netstat</code> å‘½ä»¤é€‰é¡¹åŒ…æ‹¬ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">netstat -tuln # æ˜¾ç¤ºæ‰€æœ‰æ­£åœ¨ç›‘å¬çš„tcp å’Œ udp ç«¯å£ å¯ä»¥é…åˆgrep port_number æŸ¥æ‰¾ç‰¹å®šç«¯å£çš„ç›‘å¬è¿›ç¨‹<br></code></pre></td></tr></table></figure><p><strong>lsof</strong>ï¼š <code>losf</code>å‘½ä»¤ç”¨äºåˆ—å‡ºæ‰“å¼€æ–‡ä»¶å’Œç½‘ç»œé“¾æ¥çš„è¿›ç¨‹ ã€å¸¸ç”¨ã€‘</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">lsof -i:8000 # æŸ¥çœ‹8000ç«¯å£æœ‰æ²¡æœ‰è¢«å ç”¨ï¼Œè°å ç”¨ï¼Œæ˜¾ç¤ºç«¯å£è¯¦ç»†ä¿¡æ¯<br>losf -i TCP:prot_number # æ˜¾ç¤ºå¯¹åº”çš„TCPç«¯å£è¯¦æƒ…<br>losf -i UDP:prot_number # æ˜¾ç¤ºå¯¹åº”çš„UDPç«¯å£è¯¦æƒ…<br></code></pre></td></tr></table></figure><p>ss:<code>ss</code>å‘½ä»¤ç”¨æˆ·æ˜¾ç¤ºå¥—æ¥å­—ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç›‘å¬ç«¯å£å’Œä¸ä¹‹ç›¸å…³çš„è¿›ç¨‹ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">ss -tuln # æ˜¾ç¤ºæ‰€æœ‰æ­£åœ¨ç›‘å¬çš„TCPå’ŒUDPç«¯å£<br></code></pre></td></tr></table></figure><h2 id="7-4-å†…å­˜-CPUç›‘æ§ä¹‹topæˆ–è€…htopï¼ˆå½©è‰²ï¼‰"><a href="#7-4-å†…å­˜-CPUç›‘æ§ä¹‹topæˆ–è€…htopï¼ˆå½©è‰²ï¼‰" class="headerlink" title="7.4 å†…å­˜&#x2F;CPUç›‘æ§ä¹‹topæˆ–è€…htopï¼ˆå½©è‰²ï¼‰"></a>7.4 å†…å­˜&#x2F;CPUç›‘æ§ä¹‹topæˆ–è€…htopï¼ˆå½©è‰²ï¼‰</h2><p><code>top</code>å¼ºå¤§çš„å®æ—¶ç›‘æ§ç³»ç»Ÿå·¥å…·ï¼Œç”¨äºæŸ¥çœ‹å’Œç®¡ç†æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ä»¥åŠç³»ç»Ÿçš„æ€§èƒ½æŒ‡æ ‡ï¼Œ</p><p>è§£è¯»æ‰€å±•ç¤ºå‚æ•°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">top <br>è¿›ç¨‹å· USER      PR  NI    VIRT    RES    SHR    %CPU  %MEM     TIME+ COMMAND<br> 87753 wang      20   0   48.8g 240336  79328 R  10.9   0.7   1141:51 com.ali+ <br> VIRT # è™šæ‹Ÿå†…å­˜å ç”¨å¤§å°<br> RES # ç‰©ç†å†…å­˜å ç”¨å¤§å°<br> SHR # å…±äº«å†…å­˜å ç”¨å¤§å°<br><span class="hljs-meta prompt_"> % </span><span class="language-bash"><span class="hljs-comment"># å ç”¨ç™¾åˆ†æ¯”</span></span><br> TIME+ # è¿›ç¨‹ç´¯è®¡CPUæ—¶é—´<br> <br></code></pre></td></tr></table></figure><p>ã€é‡ç‚¹ã€‘top -p PID_number æŸ¥çœ‹æŒ‡å®šçš„è¿›ç¨‹çš„å®æ—¶å ç”¨æƒ…å†µ</p><h2 id="7-5-å†…å­˜-CPUç›‘æ§ä¹‹free-å’Œvmstat"><a href="#7-5-å†…å­˜-CPUç›‘æ§ä¹‹free-å’Œvmstat" class="headerlink" title="7.5 å†…å­˜&#x2F;CPUç›‘æ§ä¹‹free å’Œvmstat"></a>7.5 å†…å­˜&#x2F;CPUç›‘æ§ä¹‹free å’Œvmstat</h2><p>free :<code>free</code>å‘½ä»¤ç”¨äºæ˜¾ç¤ºç³»ç»Ÿçš„å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œå®ƒä¼šæ˜¾ç¤ºæ€»å†…å­˜ã€å·²ä½¿ç”¨å†…å­˜ã€ç©ºé—²å†…å­˜ç­‰ä¿¡æ¯ã€‚</p><p>å¯ä»¥ä½¿ç”¨free -h ä»¥æ›´å‹å¥½çš„æ–¹å¼æ˜¾ç¤ºå†…å­˜å¤§å°ï¼ˆå•ä½ç”¨Gï¼Œé»˜è®¤å•ä½æ˜¯Mï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">free<br>          total        used        free      shared  buff/cache   available<br>å†…å­˜ï¼š   32595208    18936688     1550264     2450668    12108256    10649300<br>äº¤æ¢ï¼š   15999996     2212136    13787860<br>free -h <br>           total        used        free      shared  buff/cache   available<br>å†…å­˜ï¼š       31Gi        17Gi       1.5Gi       2.4Gi        11Gi        10Gi<br>äº¤æ¢ï¼š       15Gi       2.1Gi        13Gi<br><br></code></pre></td></tr></table></figure><p><code>vmstat</code>ï¼š<code>vmstat</code> å‘½ä»¤ç”¨äºæ˜¾ç¤ºè™šæ‹Ÿå†…å­˜çš„ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬å†…å­˜ã€CPUã€ç£ç›˜ã€äº¤æ¢ç­‰ã€‚è¿è¡Œ <code>vmstat 1</code> å¯ä»¥æ¯ç§’æ›´æ–°ä¸€æ¬¡ç»Ÿè®¡ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">vmstat<br>-----------memory---------- ---swap-- -----io---- -system-- ------cpu-----<br> r  b äº¤æ¢ ç©ºé—² ç¼“å†² ç¼“å­˜   si   so    bi    bo   in   cs us sy id wa st<br> 0  0 2212136 1595296 1335748 10787504    0    0     2    14    2    1  3  1 96  0  0<br></code></pre></td></tr></table></figure><h2 id="7-6-ä½¿ç”¨ç½‘ç»œæµé‡ç»Ÿè®¡"><a href="#7-6-ä½¿ç”¨ç½‘ç»œæµé‡ç»Ÿè®¡" class="headerlink" title="7.6 ä½¿ç”¨ç½‘ç»œæµé‡ç»Ÿè®¡"></a>7.6 ä½¿ç”¨ç½‘ç»œæµé‡ç»Ÿè®¡</h2><p>ifconfig : <code>ifconfig</code>ç”¨äºæŸ¥çœ‹ç½‘ç»œæ¥å£é…ç½®ä¿¡æ¯ï¼Œä¹Ÿå¯ä»¥æŸ¥çœ‹å‘é€ã€ä¸Šä¼ ã€‘å’Œæ¥æ”¶ã€ä¸‹è½½ã€‘æ•°æ®åŒ…çš„å€¼</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs shell">ifconfig<br>enp4s0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500<br>        inet 192.168.0.120  netmask 255.255.255.0  broadcast 192.168.0.255<br>        inet6 fe80::5a11:22ff:fe47:c52e  prefixlen 64  scopeid 0x20&lt;link&gt;<br>        ether 58:11:22:47:c5:2e  txqueuelen 1000  (ä»¥å¤ªç½‘)<br>        RX packets 22011398  bytes 12495616225 (12.4 GB)<br>        RX errors 0  dropped 154785  overruns 0  frame 0<br>        TX packets 11342485  bytes 5780291167 (5.7 GB)<br>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br>enp4s0 # ç½‘ç»œæ¥å£åç§°ï¼Œç½‘å¡åç§°<br>flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt; <br><span class="hljs-meta prompt_">#</span><span class="language-bash">4163æ ‡å¿— upå¯åŠ¨ï¼ŒBROADCASTå¹¿æ’­ï¼ŒRUNNINGè¿è¡Œï¼ŒMULTICASTæ¥å£æ”¯æŒå¤šå¹¿æ’­</span><br>inet 192.168.0.120 # æœ¬æœºip ä¹Ÿå°±æ˜¯æ¥å£çš„IPv4åœ°å€<br>netmask 255.255.255.0 # æ¥å£å­æœ›æ©ç ï¼Œç”¨äºç¡®å®šç½‘ç»œåœ°å€å’Œä¸»æœºåœ°å€çš„ç•Œé™<br>broadcast 192.168.0.255 # æ¥å£çš„å¹¿æ’­åœ°å€ï¼Œç”¨äºå‘åŒä¸€å­ç½‘ä¸­çš„æ‰€æœ‰ä¸»æœºå‘é€å¹¿æ’­æ¶ˆæ¯ã€‚<br>ether 58:11:22:47:c5:2e  # æœ¬æœºmacåœ°å€ï¼Œç‰©ç†åœ°å€<br>txqueuelen 1000(ä»¥å¤ªç½‘)ï¼š# å‘é€é˜Ÿåˆ—é•¿åº¦ï¼ŒæŒ‡å®šæ¥å£å‘é€æ•°æ®åŒ…çš„é˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦<br>RX packets 22011398  # RXæ˜¯æ¥æ”¶ï¼Œæ¥æ”¶åŒ…çš„æ•°é‡ æ¥æ”¶å°±æ˜¯ã€ä¸‹è½½ã€‘<br>bytes 12495616225 (12.4 GB) # æ¥å—åŒ…çš„å­—èŠ‚æ•°ï¼Œä¹Ÿå°±æ˜¯æ¥æ”¶åŒ…è€—æµé‡ ã€ä¸‹è½½ã€‘<br>RX errors 0  # æ¥æ”¶è¿‡ç¨‹ä¸­çš„é”™è¯¯æ•°<br>dropped 154785 # æ¥æ”¶è¿‡ç¨‹ä¸­çš„ä¸¢åŒ…æ•°<br>overruns 0 # æ¥æ”¶è¿‡ç¨‹ä¸­çš„æº¢å‡ºæ•°æ®åŒ…æ•°<br>frame 0 # æ¥æ”¶è¿‡ç¨‹ä¸­çš„å¸§é”™è¯¯æ•°é‡<br>TX packets 11342485  # TXæ˜¯å‘é€ï¼Œå‘é€åŒ…çš„æ•°é‡ ã€ä¸Šä¼ ã€‘<br>bytes 5780291167 (5.7 GB) # æ¥å—åŒ…çš„å­—èŠ‚æ•°ï¼Œä¹Ÿå°±æ˜¯æ¥å—åŒ…è€—æµé‡ã€ä¸Šä¼ ã€‘<br>TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0<br><br><br></code></pre></td></tr></table></figure><p><strong>netstat -i</strong> ï¼š <code>netstat -i</code> ç”¨äºæ˜¾ç¤ºç½‘ç»œæ¥å£çš„ç»Ÿè®¡ä¿¡æ¯ã€‚å®ƒä¼šåˆ—å‡ºç³»ç»Ÿä¸Šæ‰€æœ‰ç½‘ç»œæ¥å£çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ¥å£åç§°ã€MTUï¼ˆæœ€å¤§ä¼ è¾“å•å…ƒï¼‰ã€æ¥æ”¶å’Œå‘é€çš„æ•°æ®åŒ…æ•°é‡ã€é”™è¯¯æ•°é‡ç­‰ã€é‡ç‚¹ã€‘ã€ç»Ÿè®¡ç”¨ã€‘</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell">netstat -i  # è¿™ä¸ªçœ‹çš„æ›´ç›´è§‚<br>Kernel Interface table<br>Iface      MTU    RX-OK RX-ERR RX-DRP RX-OVR    TX-OK TX-ERR TX-DRP TX-OVR Flg<br>br-0bc39  1500        0      0      0 0            73      0      0      0 BMU<br>br-31a15  1500        0      0      0 0             0      0      0      0 BMU<br>br-701c9  1500        0      0      0 0             0      0      0      0 BMU<br>br-cbf44  1500        0      0      0 0            71      0      0      0 BMU<br>docker0   1500    23665      0      0 0         41823      0      0      0 BMRU<br>enp4s0    1500 22050803      0 155200 0      11352806      0      0      0 BMRU<br>lo       65536  8078343      0      0 0       8078343      0      0      0 LRU<br>veth9712  1500    18992      0      0 0         35983      0      0      0 BMRU<br></code></pre></td></tr></table></figure><p>ip a ç°åœ¨ä¸ç”¨ifconfig è¿™ä¸ªå‘½ä»¤æ¯”è¾ƒè€ï¼Œç”¨ip a ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œå› ä¸ºip é›†æˆäº†å¾ˆå¤šä¸œè¥¿åœ¨é‡Œé¢</p><p>nethogs : <code>nethogs</code>å¯ä»¥å®æ—¶ç›‘æ§ç½‘ç»œæµé‡ï¼Œä¼šåƒæŠ“åŒ…ä¸€æ ·å®æ—¶çš„æ˜¾ç¤ºæ¯ä¸ªè¿›ç¨‹çš„ç½‘ç»œä½¿ç”¨æƒ…å†µï¼Œè¿™ä¸ªè¦è£…çš„</p><p>iftop:<code>iftop</code>å·¥å…·å¯ä»¥å®æ—¶ç›‘å¬å½“å‰ç½‘ç»œæµé‡å’Œç»Ÿè®¡å‘é€æ¥æ”¶æ€»é‡</p><p>sudo iftop -P -F <process_id > :å®æ—¶ç›‘å¬å¯¹åº”è¿›ç¨‹çš„ç½‘ç»œæµé‡å’Œç»Ÿè®¡å‘é€æ¥æ”¶æ€»é‡</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo iftop  # ç›‘å¬å’Œç»Ÿè®¡å…¨éƒ¨æµé‡<br>sudo iftop -P -F 4785 # ç›‘å¬å’Œç»Ÿè®¡å•ä¸ªè¿›ç¨‹çš„æµç¨‹æ•°æ®<br></code></pre></td></tr></table></figure><p>tcpdump ï¼š<code>tcpdump</code> æŠ“åŒ…æœ¬æœºæ‰€æœ‰ç½‘ç»œè¯·æ±‚æ¥æ”¶ï¼Œå¦‚æœè¦æŠ“åŒ…ç­›é€‰çš„è¯ï¼Œå¯ä»¥ç”¨Wiresharkå·¥å…·</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">tshark -r capture.pcap -Y &quot;&lt;filter_expression&gt;&quot;<br><span class="hljs-meta prompt_"># </span><span class="language-bash">å°† `&lt;filter_expression&gt;` æ›¿æ¢ä¸ºä½ æƒ³è¦ä½¿ç”¨çš„è¿‡æ»¤è¡¨è¾¾å¼ï¼Œä¾‹å¦‚ `http.request` æˆ– `tcp.port == 80`ã€‚ä½ è¿˜å¯ä»¥æ·»åŠ è¿›ç¨‹åç§°æˆ–è¿›ç¨‹ ID è¿‡æ»¤æ¡ä»¶ï¼Œä»¥é™åˆ¶ç»“æœåªåŒ…å«ç‰¹å®šè¿›ç¨‹çš„æµé‡ã€‚</span><br></code></pre></td></tr></table></figure><h3 id="æµç•…åº¦-ã€è¿™ä¸ªè¦å»çœ‹ä¸€ä¸‹è¯¦è§£ååšç¬”è®°ã€‘"><a href="#æµç•…åº¦-ã€è¿™ä¸ªè¦å»çœ‹ä¸€ä¸‹è¯¦è§£ååšç¬”è®°ã€‘" class="headerlink" title="æµç•…åº¦ ã€è¿™ä¸ªè¦å»çœ‹ä¸€ä¸‹è¯¦è§£ååšç¬”è®°ã€‘"></a>æµç•…åº¦ ã€è¿™ä¸ªè¦å»çœ‹ä¸€ä¸‹è¯¦è§£ååšç¬”è®°ã€‘</h3><h3 id="åŠŸè€—-ã€è¿™ä¸ªè¦å»çœ‹ä¸€ä¸‹è¯¦è§£ååšç¬”è®°ã€‘"><a href="#åŠŸè€—-ã€è¿™ä¸ªè¦å»çœ‹ä¸€ä¸‹è¯¦è§£ååšç¬”è®°ã€‘" class="headerlink" title="åŠŸè€— ã€è¿™ä¸ªè¦å»çœ‹ä¸€ä¸‹è¯¦è§£ååšç¬”è®°ã€‘"></a>åŠŸè€— ã€è¿™ä¸ªè¦å»çœ‹ä¸€ä¸‹è¯¦è§£ååšç¬”è®°ã€‘</h3><h3 id="ç½‘ç»œæŠ“åŒ…tcpdumpã€è¿™ä¸ªè¦å»çœ‹ä¸€ä¸‹è¯¦è§£ååšç¬”è®°ã€‘"><a href="#ç½‘ç»œæŠ“åŒ…tcpdumpã€è¿™ä¸ªè¦å»çœ‹ä¸€ä¸‹è¯¦è§£ååšç¬”è®°ã€‘" class="headerlink" title="ç½‘ç»œæŠ“åŒ…tcpdumpã€è¿™ä¸ªè¦å»çœ‹ä¸€ä¸‹è¯¦è§£ååšç¬”è®°ã€‘"></a>ç½‘ç»œæŠ“åŒ…tcpdumpã€è¿™ä¸ªè¦å»çœ‹ä¸€ä¸‹è¯¦è§£ååšç¬”è®°ã€‘</h3><h1 id="å…«ã€ç½‘ç»œç®¡ç†"><a href="#å…«ã€ç½‘ç»œç®¡ç†" class="headerlink" title="å…«ã€ç½‘ç»œç®¡ç†"></a>å…«ã€ç½‘ç»œç®¡ç†</h1><h1 id="ä¹ã€å®šæ—¶ä»»åŠ¡"><a href="#ä¹ã€å®šæ—¶ä»»åŠ¡" class="headerlink" title="ä¹ã€å®šæ—¶ä»»åŠ¡"></a>ä¹ã€å®šæ—¶ä»»åŠ¡</h1><h1 id="åã€å…¶ä»–"><a href="#åã€å…¶ä»–" class="headerlink" title="åã€å…¶ä»–"></a>åã€å…¶ä»–</h1><p><img src="/../img/pexels.jpg" alt="pexels"></p>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ç¬”è®°</tag>
      
      <tag>other</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€pythonã€‘è¯»ä¹¦ç¬”è®°ä¹‹å¸¸è§é™·é˜±ï¼ˆå…«ï¼‰</title>
    <link href="/2024/01/08/618python%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%B8%B8%E8%A7%81%E9%99%B7%E9%98%B1%EF%BC%88%E5%85%AB%EF%BC%89/"/>
    <url>/2024/01/08/618python%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%B8%B8%E8%A7%81%E9%99%B7%E9%98%B1%EF%BC%88%E5%85%AB%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="å…«-å¸¸è§çš„Pythoné™·é˜±"><a href="#å…«-å¸¸è§çš„Pythoné™·é˜±" class="headerlink" title="å…«ã€€å¸¸è§çš„Pythoné™·é˜±"></a>å…«ã€€å¸¸è§çš„Pythoné™·é˜±</h1><h2 id="8-1-å¾ªç¯åˆ—è¡¨çš„åŒæ—¶ä¸è¦å¢åˆ å…¶ä¸­çš„å…ƒç´ "><a href="#8-1-å¾ªç¯åˆ—è¡¨çš„åŒæ—¶ä¸è¦å¢åˆ å…¶ä¸­çš„å…ƒç´ " class="headerlink" title="8.1ã€€å¾ªç¯åˆ—è¡¨çš„åŒæ—¶ä¸è¦å¢åˆ å…¶ä¸­çš„å…ƒç´ "></a>8.1ã€€å¾ªç¯åˆ—è¡¨çš„åŒæ—¶ä¸è¦å¢åˆ å…¶ä¸­çš„å…ƒç´ </h2><p>ä½¿ç”¨<code>for</code>æˆ–<code>while</code>åœ¨åˆ—è¡¨ä¸Šè¿›è¡Œå¾ªç¯ï¼ˆä¹Ÿå°±æ˜¯è¿­ä»£ï¼‰çš„åŒæ—¶å¢åˆ å…¶ä¸­çš„å…ƒç´ å¾ˆå¯èƒ½ä¼šå¯¼è‡´é”™è¯¯ã€‚æƒ³æƒ³è¿™ç§æƒ…å†µï¼šä½ è¦è¿­ä»£ä¸€ä¸ªåŒ…å«å„ç§æè¿°è¡£æœçš„å­—ç¬¦ä¸²çš„åˆ—è¡¨ï¼Œå¸Œæœ›æ¯æ¬¡å‘ç°<code>&#39;sock&#39;</code>æ—¶æ’å…¥å¦ä¸€ä¸ª<code>&#39;sock&#39;</code>ï¼Œä»è€Œä¿è¯åˆ—è¡¨ä¸­çš„<code>&#39;sock&#39;</code>æ•°æ˜¯å¶æ•°ã€‚è¿™ä¸ªä»»åŠ¡çœ‹èµ·æ¥å¾ˆç®€å•ï¼šéå†åˆ—è¡¨ä¸­çš„å­—ç¬¦ä¸²ï¼Œå½“å‘ç°æŸä¸ªå­—ç¬¦ä¸²åŒ…å«<code>&#39;sock&#39;</code>æ—¶ï¼ˆæ¯”å¦‚<code>&#39;red sock&#39;</code>ï¼‰ï¼Œåœ¨åˆ—è¡¨åæ·»åŠ å¦å¤–ä¸€ä¸ª<code>&#39;red sock&#39;</code>å­—ç¬¦ä¸²ã€‚</p><p>ä½†ä»¥ä¸‹è¿™æ®µä»£ç å¹¶ä¸å¥æ•ˆã€‚å®ƒé™·å…¥äº†æ­»å¾ªç¯ï¼Œå¿…é¡»ä½¿ç”¨CTRL-Cæ‰èƒ½ä¸­æ–­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>clothes = [<span class="hljs-string">&#x27;skirt&#x27;</span>, <span class="hljs-string">&#x27;red sock&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">for</span> clothing <span class="hljs-keyword">in</span> clothes: <span class="hljs-comment"># è¿­ä»£åˆ—è¡¨</span><br><span class="hljs-meta">... </span>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;sock&#x27;</span> <span class="hljs-keyword">in</span> clothing: <span class="hljs-comment"># å¯»æ‰¾å«æœ‰&#x27;sock&#x27;çš„å­—ç¬¦ä¸²</span><br><span class="hljs-meta">... </span>        clothes.append(clothing) <span class="hljs-comment"># æ·»åŠ &#x27;sock&#x27;</span><br><span class="hljs-meta">... </span>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Added a sock:&#x27;</span>, clothing) <span class="hljs-comment"># å‘ŠçŸ¥ç”¨æˆ·</span><br>...<br>Added a sock: red sock<br>Added a sock: red sock<br>Added a sock: red sock<br>--snip--<br>Added a sock: red sock<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">3</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>KeyboardInterrupt<br></code></pre></td></tr></table></figure><p>ã€€ã€€é—®é¢˜åœ¨äºï¼Œå½“ä½ æŠŠ<code>&#39;red sock&#39;</code>è¿½åŠ åˆ°<code>clothes</code>åˆ—è¡¨ä¸­æ—¶ï¼Œåˆ—è¡¨å¤šå‡ºäº†ç¬¬3é¡¹ï¼Œéœ€è¦è¢«è¿­ä»£çš„åˆ—è¡¨å˜æˆäº†<code>[&#39;skirt&#39;, &#39;red sock&#39;, &#39;red sock&#39;]</code>ã€‚åœ¨ä¸‹ä¸€æ¬¡è¿­ä»£ä¸­ï¼Œ<code>for</code>å¾ªç¯éå†åˆ°äº†ç¬¬2ä¸ª<code>&#39;red sock&#39;</code>ï¼ŒåŒæ ·çš„æ•…äº‹ç»§ç»­é‡æ¼”ï¼Œå®ƒåˆè¿½åŠ äº†ä¸€ä¸ª<code>&#39;red sock&#39;</code>å­—ç¬¦ä¸²ï¼Œåˆ—è¡¨å˜ä¸º<code>[&#39;skirt&#39;, &#39;red sock&#39;, &#39;red sock&#39;ï¼Œ&#39;red sock&#39;]</code>ã€‚è¿™æ ·ä¸€æ¥ï¼ŒPythonåˆéœ€è¦å¤šéå†ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¦‚å›¾8-1æ‰€ç¤ºã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬çœ‹åˆ°æ§åˆ¶å°æ€»æ˜¯è¾“å‡º<code>&quot;Added a sock: red sock&quot;</code>ã€‚è¿™ç§å¾ªç¯åªæœ‰åœ¨è®¡ç®—æœºå†…å­˜è€—å°½ä»¥è‡³äºç¨‹åºå´©æºƒæˆ–è€…æŒ‰CTRL-Cä¸­æ–­æ—¶æ‰ä¼šåœæ­¢ã€‚</p><p><strong>åœ¨<code>for</code>å¾ªç¯çš„æ¯ä¸€æ¬¡è¿­ä»£ä¸­ï¼Œéƒ½æœ‰ä¸€ä¸ªæ–°çš„<code>&#39;red sock&#39;</code>è¢«è¿½åŠ åˆ°åˆ—è¡¨ä¸­ï¼Œä½œä¸ºä¸‹ä¸€æ¬¡è¿­ä»£çš„æŒ‡å‘ï¼Œå½¢æˆæ­»å¾ªç¯</strong></p><p>ã€€ã€€è¦ç‚¹æ˜¯ä¸è¦åœ¨è¿­ä»£åˆ—è¡¨çš„æ—¶å€™å°†å…ƒç´ æ·»åŠ è¿›åˆ—è¡¨ã€‚åº”è¯¥ä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„åˆ—è¡¨ä½œä¸ºä¿®æ”¹åçš„åˆ—è¡¨ï¼Œæ¯”å¦‚è¿™ä¸ªä¾‹å­ä¸­çš„<code>newClothes</code>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>clothes = [<span class="hljs-string">&#x27;skirt&#x27;</span>, <span class="hljs-string">&#x27;red sock&#x27;</span>, <span class="hljs-string">&#x27;blue sock&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>newClothes = []<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">for</span> clothing <span class="hljs-keyword">in</span> clothes:<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;sock&#x27;</span> <span class="hljs-keyword">in</span> clothing:<br><span class="hljs-meta">... </span>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Appending:&#x27;</span>, clothing)<br><span class="hljs-meta">... </span>        newClothes.append(clothing) <span class="hljs-comment"># æˆ‘ä»¬ä¿®æ”¹newClothesåˆ—è¡¨ï¼Œè€Œéclothesåˆ—è¡¨</span><br>...<br>Appending: red sock<br>Appending: blue sock<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(newClothes)<br>[<span class="hljs-string">&#x27;red sock&#x27;</span>, <span class="hljs-string">&#x27;blue sock&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>clothes.extend(newClothes) <span class="hljs-comment"># å°†newClothesä¸­çš„é¡¹æ·»åŠ åˆ°clothesä¸­</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(clothes)<br>[<span class="hljs-string">&#x27;skirt&#x27;</span>, <span class="hljs-string">&#x27;red sock&#x27;</span>, <span class="hljs-string">&#x27;blue sock&#x27;</span>, <span class="hljs-string">&#x27;red sock&#x27;</span>, <span class="hljs-string">&#x27;blue sock&#x27;</span>]<br></code></pre></td></tr></table></figure><p><strong>å½“å¾ªç¯åˆ é™¤<code>&#39;mello&#39;</code>æ—¶ï¼Œåˆ—è¡¨ä¸­çš„å…ƒç´ ç´¢å¼•å‡1ï¼Œå¯¼è‡´ç´¢å¼•<code>i</code>è·³è¿‡äº†<code>&#39;yello&#39;</code></strong></p><p>ã€€ã€€æ­£ç¡®çš„åšæ³•æ˜¯å¤åˆ¶ä¸æƒ³åˆ é™¤çš„é¡¹åˆ°ä¸€ä¸ªæ–°çš„åˆ—è¡¨ï¼Œå†ç”¨å®ƒæ›¿æ¢åŸæ¥çš„åˆ—è¡¨ã€‚åœ¨äº¤äº’å¼shellä¸­è¾“å…¥ä»¥ä¸‹ä»£ç ï¼Œå¯ä»¥å¾—åˆ°å‰ä¸€ä¸ªä¾‹å­çš„æ­£ç¡®ç‰ˆæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>greetings = [<span class="hljs-string">&#x27;hello&#x27;</span>, <span class="hljs-string">&#x27;hello&#x27;</span>, <span class="hljs-string">&#x27;mello&#x27;</span>, <span class="hljs-string">&#x27;yello&#x27;</span>, <span class="hljs-string">&#x27;hello&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>newGreetings = []<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> greetings:<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">if</span> word == <span class="hljs-string">&#x27;hello&#x27;</span>: <span class="hljs-comment"># å¤åˆ¶æ˜¯&#x27;hello&#x27;çš„æ¯ä¸€é¡¹</span><br><span class="hljs-meta">... </span>        newGreetings.append(word)<br>...<br><span class="hljs-meta">&gt;&gt;&gt; </span>greetings = newGreetings <span class="hljs-comment"># æ›¿æ¢åŸæ¥çš„åˆ—è¡¨</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(greetings)<br>[<span class="hljs-string">&#x27;hello&#x27;</span>, <span class="hljs-string">&#x27;hello&#x27;</span>, <span class="hljs-string">&#x27;hello&#x27;</span>]<br></code></pre></td></tr></table></figure><p>ã€€ã€€è¿™æ®µä»£ç åªæ˜¯ä¸€ä¸ªç”¨æ¥åˆ›å»ºåˆ—è¡¨çš„ç®€å•å¾ªç¯ï¼Œé€šè¿‡åˆ—è¡¨æ¨å¯¼å¼ä¹Ÿå¯ä»¥åšåˆ°ã€‚åˆ—è¡¨æ¨å¯¼å¼åœ¨è¿è¡Œé€Ÿåº¦å’Œå†…å­˜ä½¿ç”¨ä¸Šå¹¶ä¸å ä¼˜åŠ¿ï¼Œä½†å¯ä»¥åœ¨ä¸æŸå¤±å¯è¯»æ€§çš„å‰æä¸‹å°½å¯èƒ½ç¼©çŸ­æ‰“å­—æ—¶é—´ã€‚åœ¨äº¤äº’å¼shellä¸­è¾“å…¥ä¸Šä¸€ä¸ªç¤ºä¾‹çš„ç­‰æ•ˆä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>greetings = [<span class="hljs-string">&#x27;hello&#x27;</span>, <span class="hljs-string">&#x27;hello&#x27;</span>, <span class="hljs-string">&#x27;mello&#x27;</span>, <span class="hljs-string">&#x27;yello&#x27;</span>, <span class="hljs-string">&#x27;hello&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>greetings = [word <span class="hljs-keyword">for</span> word <span class="hljs-keyword">in</span> greetings <span class="hljs-keyword">if</span> word == <span class="hljs-string">&#x27;hello&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(greetings)<br>[<span class="hljs-string">&#x27;hello&#x27;</span>, <span class="hljs-string">&#x27;hello&#x27;</span>, <span class="hljs-string">&#x27;hello&#x27;</span>]<br></code></pre></td></tr></table></figure><p>ã€€ã€€åˆ—è¡¨æ¨å¯¼å¼ä¸ä»…æ›´ç®€æ´ï¼Œè¿˜é¿å…äº†åœ¨è¿­ä»£æ—¶ä¿®æ”¹åˆ—è¡¨æ‰€å¼•å‘çš„â€œé™·é˜±â€</p><blockquote><p><strong>å¼•ç”¨ã€å†…å­˜ä½¿ç”¨å’Œ<code>sys.getsizeof()</code></strong></p><p>ã€€ã€€åˆ›å»ºä¸€ä¸ªæ–°åˆ—è¡¨çœ‹èµ·æ¥æ¯”ä¿®æ”¹åŸæœ‰åˆ—è¡¨æ›´æ¶ˆè€—å†…å­˜ã€‚ä½†æ˜¯ï¼Œæ­£å¦‚å˜é‡åŒ…å«çš„åªæ˜¯å€¼çš„å¼•ç”¨è€Œéå®é™…å€¼ï¼Œåˆ—è¡¨åŒ…å«çš„ä¹Ÿæ˜¯å€¼çš„å¼•ç”¨ã€‚åœ¨å‰é¢çš„ä»£ç ä¸­ï¼Œ<code>newGreetings.append(word)</code>å¹¶æ²¡æœ‰å¤åˆ¶<code>word</code>å˜é‡ä¸­çš„å­—ç¬¦ä¸²ï¼Œè€Œåªæ˜¯å¤åˆ¶äº†å¯¹è¯¥å­—ç¬¦ä¸²çš„å¼•ç”¨ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼Œè¿™ä¸ªå¼•ç”¨æ¯”å®é™…çš„å­—ç¬¦ä¸²å°å¾ˆå¤šã€‚</p><p>ã€€ã€€ä½¿ç”¨<code>sys.getsizeof()</code>å‡½æ•°å¯ä»¥è¯å®è¿™ä¸€ç‚¹ã€‚è¯¥å‡½æ•°çš„è¿”å›å€¼æ˜¯å‚æ•°å¯¹è±¡åœ¨å†…å­˜ä¸­å ç”¨çš„å­—èŠ‚æ•°ã€‚åœ¨è¿™ä¸ªäº¤äº’å¼shellç¤ºä¾‹ä¸­ï¼Œå¯ä»¥çœ‹åˆ°çŸ­å­—ç¬¦ä¸²<code>&#39;cat&#39;</code>å ç”¨äº†52å­—èŠ‚ï¼Œè€Œé•¿å­—ç¬¦ä¸²å ç”¨äº†85å­—èŠ‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> sys<br><span class="hljs-meta">&gt;&gt;&gt; </span>sys.getsizeof(<span class="hljs-string">&#x27;cat&#x27;</span>)<br><span class="hljs-number">52</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>sys.getsizeof(<span class="hljs-string">&#x27;a much longer string than just &quot;cat&quot;&#x27;</span>)<br><span class="hljs-number">85</span><br></code></pre></td></tr></table></figure><p>ã€€ã€€åœ¨æˆ‘ä½¿ç”¨çš„Pythonç‰ˆæœ¬ä¸­ï¼Œå­—ç¬¦ä¸²å¯¹è±¡å›ºæœ‰çš„å¼€é”€å 49å­—èŠ‚ï¼Œè€Œå­—ç¬¦ä¸²ä¸­æ¯ä¸ªå®é™…å­—ç¬¦å†å ç”¨1å­—èŠ‚ã€‚ä½†åŒ…å«äº†ä»»æ„å­—ç¬¦ä¸²çš„åˆ—è¡¨åªå ç”¨72å­—èŠ‚ï¼Œæ— è®ºå­—ç¬¦ä¸²æœ‰å¤šé•¿ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>sys.getsizeof([<span class="hljs-string">&#x27;cat&#x27;</span>])<br><span class="hljs-number">72</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>sys.getsizeof([<span class="hljs-string">&#x27;a much longer string than just &quot;cat&quot;&#x27;</span>])<br><span class="hljs-number">72</span><br></code></pre></td></tr></table></figure><p>ã€€ã€€åŸå› åœ¨äºï¼Œä»æŠ€æœ¯åŸç†ä¸Šè®²ï¼Œåˆ—è¡¨å¹¶ä¸åŒ…å«å­—ç¬¦ä¸²ï¼Œè€ŒåªåŒ…å«å¯¹å­—ç¬¦ä¸²çš„å¼•ç”¨ã€‚æ— è®ºå¼•ç”¨çš„æ•°æ®æœ‰å¤šå¤§ï¼Œå¼•ç”¨æœ¬èº«çš„å¤§å°æ˜¯ä¸€æ ·çš„ã€‚åƒ<code>newGreetings.append(word)</code>è¿™æ ·çš„ä»£ç å¹¶ä¸æ˜¯åœ¨å¤åˆ¶<code>word</code>ä¸­çš„å­—ç¬¦ä¸²ï¼Œè€Œæ˜¯å¤åˆ¶å¯¹å­—ç¬¦ä¸²çš„å¼•ç”¨ã€‚Pythonæ ¸å¿ƒå¼€å‘è€…Raymond Hettingerç¼–å†™äº†ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥ç”¨æ¥äº†è§£ä¸€ä¸ªå¯¹è±¡åŠå…¶å¼•ç”¨çš„å…¨éƒ¨å¯¹è±¡å ç”¨çš„å†…å­˜ã€‚</p><p>ã€€ã€€æ‰€ä»¥ä½ ä¸å¿…è§‰å¾—ä¸è¿­ä»£åˆ—è¡¨æ—¶å¯¹å…¶è¿›è¡Œä¿®æ”¹ç›¸æ¯”ï¼Œåˆ›å»ºæ–°åˆ—è¡¨ä¼šæµªè´¹å†…å­˜ã€‚å³ä½¿åœ¨ä¿®æ”¹è¿­ä»£åˆ—è¡¨æ—¶ä¸å‡ºé”™ï¼Œå®ƒä¹Ÿå¯èƒ½éšè—ç€æŸäº›ä¸æ˜“å¯Ÿè§‰çš„bugï¼Œéœ€è¦å¾ˆé•¿æ—¶é—´æ‰èƒ½æ’æŸ¥å’Œä¿®å¤ã€‚ç¨‹åºå‘˜çš„æ—¶é—´è¦æ¯”è®¡ç®—æœºçš„å†…å­˜å€¼é’±å¾—å¤šã€‚</p></blockquote><p>ã€€ã€€è™½ç„¶åœ¨è¿­ä»£åˆ—è¡¨ï¼ˆæˆ–è€…ä»»ä½•å¯è¿­ä»£å¯¹è±¡ï¼‰æ—¶ä¸åº”è¯¥ä»ä¸­å¢åˆ å…ƒç´ ï¼Œä½†ä¿®æ”¹åˆ—è¡¨çš„æŸé¡¹å†…å®¹æ˜¯è¢«å…è®¸çš„ã€‚æ¯”å¦‚æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²å½¢å¼çš„æ•°å­—åˆ—è¡¨<code>[&#39;1&#39;, &#39;2&#39;, &#39;3&#39;, &#39;4&#39;, &#39;5&#39;]</code>ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿­ä»£åˆ—è¡¨çš„åŒæ—¶å°†å…¶è½¬æ¢æˆæ•´æ•°åˆ—è¡¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>numbers = [<span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>, <span class="hljs-string">&#x27;4&#x27;</span>, <span class="hljs-string">&#x27;5&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">for</span> i, number <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(numbers):<br><span class="hljs-meta">... </span>    numbers[i] = <span class="hljs-built_in">int</span>(number)<br>...<br><span class="hljs-meta">&gt;&gt;&gt; </span>numbers<br>[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]<br></code></pre></td></tr></table></figure><p>ã€€ã€€ä¿®æ”¹åˆ—è¡¨ä¸­çš„å…ƒç´ æ˜¯å¯ä»¥çš„ï¼Œæ”¹å˜åˆ—è¡¨ä¸­çš„å…ƒç´ ä¸ªæ•°æ‰å®¹æ˜“å¯¼è‡´é—®é¢˜ã€‚</p><h2 id="8-2-å¤åˆ¶å¯å˜å€¼æ—¶åŠ¡å¿…ä½¿ç”¨copy-copy-å’Œcopy-deepcopy"><a href="#8-2-å¤åˆ¶å¯å˜å€¼æ—¶åŠ¡å¿…ä½¿ç”¨copy-copy-å’Œcopy-deepcopy" class="headerlink" title="8.2ã€€å¤åˆ¶å¯å˜å€¼æ—¶åŠ¡å¿…ä½¿ç”¨copy.copy()å’Œcopy.deepcopy()"></a>8.2ã€€å¤åˆ¶å¯å˜å€¼æ—¶åŠ¡å¿…ä½¿ç”¨<code>copy.copy()</code>å’Œ<code>copy.deepcopy()</code></h2><p>ã€€ã€€æœ€å¥½æŠŠå˜é‡çœ‹ä½œæŒ‡å‘å¯¹è±¡çš„æ ‡ç­¾æˆ–è€…ä»£å·ï¼Œè€Œä¸æ˜¯åŒ…å«å¯¹è±¡çš„ç›’å­ã€‚è¿™ç§æ¨¡å‹åœ¨æ¶‰åŠä¿®æ”¹å¯å˜å¯¹è±¡æ—¶ç‰¹åˆ«æœ‰ç”¨ï¼Œæ¯”å¦‚åˆ—è¡¨ã€å­—å…¸å’Œé›†åˆç­‰å¯¹è±¡çš„å€¼æ˜¯å¯ä»¥æ”¹å˜çš„ã€‚ä¸€ä¸ªå¸¸è§çš„é”™è¯¯æ˜¯å¤åˆ¶æŒ‡å‘æŸä¸ªå¯¹è±¡çš„å˜é‡åˆ°å¦ä¸€ä¸ªå˜é‡æ—¶ï¼Œè¯¯ä»¥ä¸ºæ˜¯åœ¨å¤åˆ¶å®é™…çš„å¯¹è±¡ã€‚åœ¨Pythonä¸­ï¼Œèµ‹å€¼è¯­å¥ä»æ¥éƒ½ä¸ä¼šå¤åˆ¶å¯¹è±¡ï¼Œè€Œåªä¼šå¤åˆ¶å¯¹è±¡çš„å¼•ç”¨ã€‚å…³äºè¿™ä¸ªé—®é¢˜ï¼ŒPythonå¼€å‘è€…Ned Batchelderåœ¨PyCon 2015ä¸Šå‘è¡¨äº†ä¸€åœºç²¾å½©çš„æ¼”è®²ï¼Œé¢˜ä¸ºâ€œFacts and Myths about Python Names and Valuesâ€ï¼ˆå…³äºPythonåç§°å’Œå€¼çš„äº‹å®ä¸è°¬è¯¯ï¼‰ã€‚</p><p>ã€€ã€€æ¥çœ‹ä¸€ä¸ªç¤ºä¾‹ã€‚åœ¨äº¤äº’å¼shellä¸­è¾“å…¥ä»¥ä¸‹ä»£ç ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå°½ç®¡æˆ‘ä»¬åªæ”¹å˜äº†<code>spam</code>å˜é‡ï¼Œä½†<code>cheese</code>å˜é‡ä¹Ÿå‘ç”Ÿäº†å˜åŒ–ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>spam = [<span class="hljs-string">&#x27;cat&#x27;</span>, <span class="hljs-string">&#x27;dog&#x27;</span>, <span class="hljs-string">&#x27;eel&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>cheese = spam<br><span class="hljs-meta">&gt;&gt;&gt; </span>spam<br>[<span class="hljs-string">&#x27;cat&#x27;</span>, <span class="hljs-string">&#x27;dog&#x27;</span>, <span class="hljs-string">&#x27;eel&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>cheese<br>[<span class="hljs-string">&#x27;cat&#x27;</span>, <span class="hljs-string">&#x27;dog&#x27;</span>, <span class="hljs-string">&#x27;eel&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>spam[<span class="hljs-number">2</span>] = <span class="hljs-string">&#x27;MOOSE&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>spam<br>[<span class="hljs-string">&#x27;cat&#x27;</span>, <span class="hljs-string">&#x27;dog&#x27;</span>, <span class="hljs-string">&#x27;MOOSE&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>cheese<br>[<span class="hljs-string">&#x27;cat&#x27;</span>, <span class="hljs-string">&#x27;dog&#x27;</span>, <span class="hljs-string">&#x27;MOOSE&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">id</span>(cheese), <span class="hljs-built_in">id</span>(spam)<br><span class="hljs-number">2356896337288</span>, <span class="hljs-number">2356896337288</span><br></code></pre></td></tr></table></figure><p>ã€€ã€€å¦‚æœè¯¯è®¤ä¸º<code>cheese = spam</code>å¤åˆ¶äº†<code>list</code>å¯¹è±¡ï¼Œé‚£ä¹ˆä½ å¯èƒ½ä¼šæƒŠè®¶äºå°½ç®¡åªä¿®æ”¹äº†<code>spam</code>ï¼Œä½†<code>cheese</code>ä¹Ÿå‘ç”Ÿäº†å˜åŒ–ã€‚èµ‹å€¼è¯­å¥ä»æ¥ä¸å¤åˆ¶å¯¹è±¡ï¼Œè€Œåªå¤åˆ¶å¯¹è±¡çš„å¼•ç”¨ã€‚èµ‹å€¼è¯­å¥<code>cheese = spam</code>ä½¿<code>cheese</code>åœ¨è®¡ç®—æœºå†…å­˜ä¸­å¼•ç”¨äº†ä¸<code>spam</code>ç›¸åŒçš„åˆ—è¡¨å¯¹è±¡ï¼Œè€Œéå¤åˆ¶äº†åˆ—è¡¨å¯¹è±¡ã€‚è¿™å°±æ˜¯æ”¹å˜äº†<code>spam</code>ï¼Œ<code>cheese</code>ä¹Ÿéšä¹‹æ”¹å˜çš„åŸå› ï¼šä¸¤ä¸ªå˜é‡æŒ‡å‘äº†åŒä¸€ä¸ªåˆ—è¡¨å¯¹è±¡ã€‚</p><p>ã€€ã€€åŒæ ·çš„åŸåˆ™ä¹Ÿé€‚ç”¨äºä½œä¸ºå‡½æ•°è°ƒç”¨å‚æ•°çš„å¯å˜å¯¹è±¡ã€‚åœ¨äº¤äº’å¼shellä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼Œæ³¨æ„å…¨å±€å˜é‡<code>spam</code>å’Œå±€éƒ¨å˜é‡ï¼Œå‚æ•°ï¼ˆå‚æ•°æ˜¯åœ¨å‡½æ•°çš„<code>def</code>è¯­å¥ä¸­å®šä¹‰çš„å˜é‡ï¼‰<code>theList</code>æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">printIdOfParam</span>(<span class="hljs-params">theList</span>):<br><span class="hljs-meta">... </span>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">id</span>(theList))<br>...<br><span class="hljs-meta">&gt;&gt;&gt; </span>eggs = [<span class="hljs-string">&#x27;cat&#x27;</span>, <span class="hljs-string">&#x27;dog&#x27;</span>, <span class="hljs-string">&#x27;eel&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(<span class="hljs-built_in">id</span>(eggs))<br><span class="hljs-number">2356893256136</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>printIdOfParam(eggs)<br><span class="hljs-number">2356893256136</span><br></code></pre></td></tr></table></figure><p>ã€€ã€€æ³¨æ„<code>id(eggs)</code>å’Œ<code>id(theList)</code>è¿”å›çš„èº«ä»½æ˜¯ä¸€æ ·çš„ï¼Œæ„å‘³ç€è¿™ä¸¤ä¸ªå˜é‡æŒ‡å‘åŒä¸€ä¸ªåˆ—è¡¨å¯¹è±¡ã€‚<code>eggs</code>å˜é‡å¯¹åº”çš„åˆ—è¡¨å¯¹è±¡å¹¶æ²¡æœ‰è¢«å¤åˆ¶åˆ°<code>theList</code>ä¸­ï¼Œè€Œæ˜¯å¤åˆ¶äº†å¯¹è±¡çš„å¼•ç”¨ã€‚ä¸€ä¸ªå¼•ç”¨åªæœ‰å‡ å­—èŠ‚å¤§å°ã€‚å‡è®¾Pythonå¤åˆ¶äº†åˆ—è¡¨è€Œéå¼•ç”¨ï¼Œä¼šå¦‚ä½•å‘¢ï¼Ÿå¦‚æœ<code>eggs</code>ä¸æ­¢3é¡¹ï¼Œè€Œæœ‰10äº¿é¡¹ï¼Œé‚£ä¹ˆæŠŠå®ƒä¼ é€’ç»™<code>printIdOfParam()</code>æ—¶éœ€è¦å¤åˆ¶è¿™ä¸ªå·¨å¤§çš„åˆ—è¡¨ã€‚ä»…ä»…æ˜¯ä¸€ä¸ªç®€å•çš„å‡½æ•°è°ƒç”¨ï¼Œå°±å°†æ¶ˆè€—å‡ åƒå…†å­—èŠ‚çš„å†…å­˜ã€‚è¿™å°±æ˜¯Pythonèµ‹å€¼åªå¤åˆ¶å¼•ç”¨è€Œä¸å¤åˆ¶å¯¹è±¡çš„åŸå› ã€‚</p><p>ã€€ã€€å¦‚æœä½ çœŸçš„æƒ³å¤åˆ¶è¿™ä¸ªåˆ—è¡¨å¯¹è±¡ï¼ˆè€Œä¸ä»…ä»…æ˜¯å¼•ç”¨ï¼‰ï¼Œé‚£ä¹ˆä¸€ä¸ªå¯è¡Œçš„æ–¹æ¡ˆæ˜¯ä½¿ç”¨<code>copy.copy()</code>å‡½æ•°å¤åˆ¶å¯¹è±¡ã€‚åœ¨äº¤äº’å¼shellä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> copy<br><span class="hljs-meta">&gt;&gt;&gt; </span>bacon = [<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">8</span>, <span class="hljs-number">16</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>ham = copy.copy(bacon)<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">id</span>(bacon), <span class="hljs-built_in">id</span>(ham)<br>(<span class="hljs-number">2356896337352</span>, <span class="hljs-number">2356896337480</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>bacon[<span class="hljs-number">0</span>] = <span class="hljs-string">&#x27;CHANGED&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>bacon<br>[<span class="hljs-string">&#x27;CHANGED&#x27;</span>, <span class="hljs-number">4</span>, <span class="hljs-number">8</span>, <span class="hljs-number">16</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>ham<br>[<span class="hljs-number">2</span>, <span class="hljs-number">4</span>, <span class="hljs-number">8</span>, <span class="hljs-number">16</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">id</span>(bacon), <span class="hljs-built_in">id</span>(ham)<br>(<span class="hljs-number">2356896337352</span>, <span class="hljs-number">2356896337480</span>)<br></code></pre></td></tr></table></figure><p>ã€€ã€€<code>ham</code>å˜é‡æŒ‡å‘äº†å¤åˆ¶çš„åˆ—è¡¨å¯¹è±¡ï¼Œè€Œé<code>bacon</code>æ‰€æŒ‡å‘çš„åŸå§‹åˆ—è¡¨å¯¹è±¡ï¼Œæ‰€ä»¥ä¸ä¼šå› ä¸ºå¤åˆ¶å¼•ç”¨è€Œå¯¼è‡´é”™è¯¯ã€‚</p><p>ã€€ã€€ä½†æ­£å¦‚ä¹‹å‰çš„æ¯”å–»æ‰€è§£é‡Šçš„ï¼Œå˜é‡åƒæ˜¯æ ‡ç­¾è€ŒéåŒ…å«å¯¹è±¡çš„ç›’å­ï¼Œåˆ—è¡¨åŒ…å«çš„ä¹Ÿæ˜¯æŒ‡å‘å¯¹è±¡çš„æ ‡ç­¾è€Œéå®é™…çš„å¯¹è±¡ã€‚å¦‚æœåˆ—è¡¨ä¸­åµŒå¥—äº†å…¶ä»–åˆ—è¡¨ï¼Œé‚£ä¹ˆ<code>copy.copy()</code>åªä¼šå¤åˆ¶è¢«åµŒå¥—åˆ—è¡¨é¡¹çš„å¼•ç”¨ã€‚åœ¨äº¤äº’å¼shellä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> copy<br><span class="hljs-meta">&gt;&gt;&gt; </span>bacon = [[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>]]<br><span class="hljs-meta">&gt;&gt;&gt; </span>ham = copy.copy(bacon)<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">id</span>(bacon), <span class="hljs-built_in">id</span>(ham)<br>(<span class="hljs-number">2356896466248</span>, <span class="hljs-number">2356896375368</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>bacon.append(<span class="hljs-string">&#x27;APPENDED&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>bacon<br>[[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>], <span class="hljs-string">&#x27;APPENDED&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>ham<br>[[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>]]<br><span class="hljs-meta">&gt;&gt;&gt; </span>bacon[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = <span class="hljs-string">&#x27;CHANGED&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>bacon<br>[[<span class="hljs-string">&#x27;CHANGED&#x27;</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>], <span class="hljs-string">&#x27;APPENDED&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>ham<br>[[<span class="hljs-string">&#x27;CHANGED&#x27;</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>]]<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">id</span>(bacon[<span class="hljs-number">0</span>]), <span class="hljs-built_in">id</span>(ham[<span class="hljs-number">0</span>])<br>(<span class="hljs-number">2356896337480</span>, <span class="hljs-number">2356896337480</span>)<br></code></pre></td></tr></table></figure><p>ã€€ã€€è™½ç„¶<code>bacon</code>å’Œ<code>ham</code>æ˜¯ä¸åŒçš„åˆ—è¡¨å¯¹è±¡ï¼Œä½†å®ƒä»¬éƒ½åŒ…å«äº†ä¸¤ä¸ªåŒæ ·çš„å†…éƒ¨åˆ—è¡¨<code>[1, 2]</code>å’Œ<code>[3, 4]</code>ã€‚ä½¿ç”¨<code>copy.copy()</code>å¹¶ä¸èƒ½å¤„ç†è¿™ç§æƒ…å†µ1ï¼Œæ­£ç¡®çš„æ–¹æ³•æ˜¯ä½¿ç”¨<code>copy.deepcopy()</code>ï¼Œå®ƒå°†å¤åˆ¶åˆ—è¡¨å¯¹è±¡å†…éƒ¨çš„å­åˆ—è¡¨å¯¹è±¡ï¼ˆå‡å¦‚å­åˆ—è¡¨è¿˜æœ‰å­åˆ—è¡¨ï¼Œä¹Ÿä¼šå±‚å±‚é€’å½’ï¼‰ã€‚åœ¨äº¤äº’å¼shellä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><p>1å®ƒåªèƒ½è¿”å›æœ€å¤–å±‚å¯¹è±¡çš„å‰¯æœ¬ã€‚â€”â€”è¯‘è€…æ³¨</p><h2 id="8-3-ä¸è¦ç”¨å¯å˜å€¼ä½œä¸ºé»˜è®¤å‚æ•°"><a href="#8-3-ä¸è¦ç”¨å¯å˜å€¼ä½œä¸ºé»˜è®¤å‚æ•°" class="headerlink" title="8.3ã€€ä¸è¦ç”¨å¯å˜å€¼ä½œä¸ºé»˜è®¤å‚æ•°"></a>8.3ã€€ä¸è¦ç”¨å¯å˜å€¼ä½œä¸ºé»˜è®¤å‚æ•°</h2><p>Pythonå…è®¸ä¸ºå‡½æ•°è®¾ç½®é»˜è®¤å‚æ•°ã€‚å½“ç”¨æˆ·æ²¡æœ‰æ˜ç¡®è®¾å®šå‚æ•°æ—¶ï¼Œå‡½æ•°å°†ä½¿ç”¨é»˜è®¤å‚æ•°æ‰§è¡Œã€‚å½“å‡½æ•°çš„å¤§å¤šæ•°è°ƒç”¨ä½¿ç”¨ç›¸åŒçš„å‚æ•°æ—¶ï¼Œé»˜è®¤å‚æ•°å¾ˆæœ‰ç”¨ï¼Œå› ä¸ºç”¨æˆ·åœ¨æŸäº›æƒ…å†µä¸‹å¯ä»¥ä¸å¿…å¡«å†™å‚æ•°ã€‚æ¯”å¦‚åœ¨<code>split()</code>æ–¹æ³•ä¸­ä¼ é€’<code>None</code>ä¼šä½¿å®ƒåœ¨é‡åˆ°ç©ºç™½å­—ç¬¦æ—¶è¿›è¡Œåˆ†å‰²ã€‚<code>None</code>ä¹Ÿæ˜¯<code>split()</code>å‡½æ•°çš„é»˜è®¤å‚æ•°ï¼šè°ƒç”¨<code>&#39;cat dog&#39;.split()</code>ç­‰æ•ˆäºè°ƒç”¨<code>&#39;cat dog&#39;.split(None)</code>ã€‚å¦‚æœè°ƒç”¨è€…ä¸ä¼ å…¥å‚æ•°ï¼Œå‡½æ•°å°±ä¼šä½¿ç”¨å¯¹åº”çš„é»˜è®¤å‚æ•°ã€‚</p><p>ã€€ã€€ä½†æ°¸è¿œä¸è¦æŠŠä¸€ä¸ªå¯å˜å¯¹è±¡ï¼ˆæ¯”å¦‚åˆ—è¡¨æˆ–è€…å­—å…¸ï¼‰è®¾ç½®ä¸ºé»˜è®¤å‚æ•°ï¼Œå› ä¸ºå®ƒå¾ˆå®¹æ˜“å¯¼è‡´é”™è¯¯ã€‚ä¸‹é¢çš„ä¾‹å­è¿›è¡Œäº†è¯´æ˜ã€‚è¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ª<code>addIngredient()</code>å‡½æ•°ï¼Œå®ƒçš„ä½œç”¨æ˜¯ä¸ºä¸€ä¸ªä»£è¡¨ä¸‰æ˜æ²»çš„åˆ—è¡¨æ·»åŠ æŸç§è°ƒæ–™å­—ç¬¦ä¸²ã€‚å› ä¸ºè¿™ä¸ªåˆ—è¡¨çš„æœ€å‰å’Œæœ€åä¸€é¡¹é€šå¸¸æ˜¯<code>&#39;bread&#39;</code>ï¼Œæ‰€ä»¥å®ƒä½¿ç”¨äº†å¯å˜åˆ—è¡¨<code>[&#39;bread&#39;, &#39;bread&#39;]</code>ä½œä¸ºé»˜è®¤å‚æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">addIngredient</span>(<span class="hljs-params">ingredient, sandwich=[<span class="hljs-string">&#x27;bread&#x27;</span>, <span class="hljs-string">&#x27;bread&#x27;</span>]</span>):<br><span class="hljs-meta">... </span>    sandwich.insert(<span class="hljs-number">1</span>, ingredient)<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">return</span> sandwich<br>...<br><span class="hljs-meta">&gt;&gt;&gt; </span>mySandwich = addIngredient(<span class="hljs-string">&#x27;avocado&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>mySandwich<br>[<span class="hljs-string">&#x27;bread&#x27;</span>, <span class="hljs-string">&#x27;avocado&#x27;</span>, <span class="hljs-string">&#x27;bread&#x27;</span>]<br></code></pre></td></tr></table></figure><p>ã€€ã€€ä½†ä½¿ç”¨åƒ<code>[&#39;bread&#39;, &#39;bread&#39;]</code>åˆ—è¡¨è¿™ç§å¯å˜å¯¹è±¡ä½œä¸ºé»˜è®¤å‚æ•°ä¼šå¯¼è‡´ä¸€ä¸ªä¸æ˜“å¯Ÿè§‰çš„é—®é¢˜ï¼šè¿™ä¸ªåˆ—è¡¨æ˜¯åœ¨å‡½æ•°çš„<code>def</code>è¯­å¥æ‰§è¡Œæ—¶è¢«åˆ›å»ºçš„2ï¼Œè€Œä¸æ˜¯åœ¨æ¯æ¬¡å‡½æ•°è°ƒç”¨æ—¶è¢«åˆ›å»ºçš„ã€‚è¿™æ„å‘³ç€åªæœ‰ä¸€ä¸ª<code>[&#39;bread&#39;, &#39;bread&#39;]</code>åˆ—è¡¨å¯¹è±¡è¢«åˆ›å»ºï¼Œå› ä¸ºæˆ‘ä»¬åªå®šä¹‰äº†ä¸€æ¬¡<code>addIngredient()</code>å‡½æ•°ã€‚æ¯æ¬¡è°ƒç”¨å‡½æ•°éƒ½ä¼šé‡å¤ä½¿ç”¨åŒä¸€ä¸ªåˆ—è¡¨ï¼Œè¿™å°±å¯¼è‡´äº†æ„æƒ³ä¸åˆ°çš„è¡Œä¸ºï¼Œæ¯”å¦‚ä¸‹é¢è¿™ç§æƒ…å†µï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>mySandwich = addIngredient(<span class="hljs-string">&#x27;avocado&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>mySandwich<br>[<span class="hljs-string">&#x27;bread&#x27;</span>, <span class="hljs-string">&#x27;avocado&#x27;</span>, <span class="hljs-string">&#x27;bread&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>anotherSandwich = addIngredient(<span class="hljs-string">&#x27;lettuce&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>anotherSandwich<br>[<span class="hljs-string">&#x27;bread&#x27;</span>, <span class="hljs-string">&#x27;lettuce&#x27;</span>, <span class="hljs-string">&#x27;avocado&#x27;</span>, <span class="hljs-string">&#x27;bread&#x27;</span>]<br></code></pre></td></tr></table></figure><p>ã€€ã€€å› ä¸º<code>addIngredient(&#39;lettuce&#39;)</code>ä½¿ç”¨äº†ä¸ä¹‹å‰è°ƒç”¨ç›¸åŒçš„é»˜è®¤å‚æ•°åˆ—è¡¨ï¼Œè€Œè¿™ä¸ªé»˜è®¤å‚æ•°å·²ç»åŠ å…¥äº†<code>&#39;avocado&#39;</code>ï¼Œæ‰€ä»¥è¿™ä¸ªå‡½æ•°è¿”å›çš„å¹¶ä¸æ˜¯é¢„æƒ³çš„<code>[&#39;bread&#39;, &#39;lettuce&#39;, &#39;bread&#39;]</code>ï¼Œè€Œæ˜¯<code>[&#39;bread&#39;, &#39;lettuce&#39;, &#39;avocado&#39;, &#39;bread&#39;]</code>ã€‚<code>&#39;avocado&#39;</code>å­—ç¬¦ä¸²åœ¨æ–°çš„è°ƒç”¨ç»“æœä¸­åˆå‡ºç°äº†ï¼Œå› ä¸º<code>sandwich</code>å‚æ•°çš„åˆ—è¡¨ä¸ä¸Šä¸€æ¬¡è°ƒç”¨æ—¶æ˜¯åŒä¸€ä¸ªã€‚ç”±äº<code>def</code>è¯­å¥åªæ‰§è¡Œäº†ä¸€æ¬¡ï¼Œæ‰€ä»¥<code>[&#39;bread&#39;, &#39;bread&#39;]</code>åˆ—è¡¨åªè¢«åˆ›å»ºäº†ä¸€æ¬¡ï¼Œè€Œéæ¯æ¬¡å‡½æ•°è°ƒç”¨æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„åˆ—è¡¨ã€‚</p><p>å½“éœ€è¦åˆ—è¡¨æˆ–è€…å­—å…¸ä½œä¸ºé»˜è®¤å‚æ•°æ—¶ï¼ŒPythonçš„è§£å†³æ–¹æ³•æ˜¯å°†é»˜è®¤å‚æ•°è®¾ç½®ä¸º<code>None</code>ï¼Œç„¶åé€šè¿‡ä»£ç æ£€æŸ¥å‚æ•°æ˜¯å¦ä¸º<code>None</code>ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™åœ¨å‡½æ•°æ¯æ¬¡è°ƒç”¨æ—¶æä¾›ä¸€ä¸ªæ–°çš„åˆ—è¡¨æˆ–è€…å­—å…¸ã€‚è¿™ä¹ˆåšå¯ä»¥ç¡®ä¿æ¯æ¬¡è°ƒç”¨å‡½æ•°æ—¶éƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„å¯å˜å¯¹è±¡ï¼Œè€Œä¸æ˜¯åªåœ¨å®šä¹‰æ—¶åˆ›å»ºä¸€æ¬¡ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªç¤ºä¾‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">def</span> <span class="hljs-title function_">addIngredient</span>(<span class="hljs-params">ingredient,sandwich=<span class="hljs-literal">None</span></span>):<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">if</span> sandwich <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:<br><span class="hljs-meta">... </span>        sandwich = [<span class="hljs-string">&#x27;bread&#x27;</span>,<span class="hljs-string">&#x27;bread&#x27;</span>]<br><span class="hljs-meta">... </span>    sandwich.insert(<span class="hljs-number">1</span>,ingredient)<br><span class="hljs-meta">... </span>    <span class="hljs-keyword">return</span> sandwich<br>...<br><span class="hljs-meta">&gt;&gt;&gt; </span>firstSandwich = addIngredient(<span class="hljs-string">&#x27;cranberries&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>firstSandwich<br>[<span class="hljs-string">&#x27;bread&#x27;</span>, <span class="hljs-string">&#x27;cranberries&#x27;</span>, <span class="hljs-string">&#x27;bread&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>secondSandwich = addIngredient(<span class="hljs-string">&#x27;lettuce&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>secondSandwich<br>[<span class="hljs-string">&#x27;bread&#x27;</span>, <span class="hljs-string">&#x27;lettuce&#x27;</span>, <span class="hljs-string">&#x27;bread&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">id</span>(firstSandwich) == <span class="hljs-built_in">id</span>(secondSandwich)<br><span class="hljs-literal">False</span> â¶<br></code></pre></td></tr></table></figure><p>ã€€ã€€æ³¨æ„ï¼Œ<code>firstSandwich</code>å’Œ<code>secondSandwich</code>å¹¶ä¸å…±äº«ç›¸åŒçš„åˆ—è¡¨å¼•ç”¨â¶ï¼Œè¿™æ˜¯å› ä¸º<code>sandwich = [&#39;bread&#39;, &#39;bread&#39;]</code>è¿™è¡Œä»£ç åœ¨æ¯æ¬¡è°ƒç”¨<code>addIngredient()</code>æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„åˆ—è¡¨å¯¹è±¡ï¼Œè€Œä¸æ˜¯ä»…åœ¨å‡½æ•°å®šä¹‰æ—¶åˆ›å»ºä¸€æ¬¡ã€‚</p><p>ã€€ã€€å¯å˜æ•°æ®ç±»å‹åŒ…æ‹¬åˆ—è¡¨ã€å­—å…¸ã€é›†åˆï¼Œä»¥åŠç”±ç±»è¯­å¥åˆ›å»ºçš„å¯¹è±¡ï¼Œä¸è¦æŠŠè¿™äº›ç±»å‹çš„å¯¹è±¡ä½œä¸º<code>def</code>è¯­å¥ä¸­çš„é»˜è®¤å‚æ•°ã€‚</p><h2 id="8-4-ä¸è¦é€šè¿‡å­—ç¬¦ä¸²è¿æ¥åˆ›å»ºå­—ç¬¦ä¸²"><a href="#8-4-ä¸è¦é€šè¿‡å­—ç¬¦ä¸²è¿æ¥åˆ›å»ºå­—ç¬¦ä¸²" class="headerlink" title="8.4ã€€ä¸è¦é€šè¿‡å­—ç¬¦ä¸²è¿æ¥åˆ›å»ºå­—ç¬¦ä¸²"></a>8.4ã€€ä¸è¦é€šè¿‡å­—ç¬¦ä¸²è¿æ¥åˆ›å»ºå­—ç¬¦ä¸²</h2><p>åœ¨Pythonä¸­ï¼Œå­—ç¬¦ä¸²æ˜¯ä¸å¯å˜çš„å¯¹è±¡ã€‚è¿™æ„å‘³ç€å­—ç¬¦ä¸²å€¼ä¸èƒ½è¢«æ”¹å˜ï¼Œé‚£äº›çœ‹èµ·æ¥åƒæ˜¯ä¿®æ”¹å­—ç¬¦ä¸²çš„ä»£ç å®é™…ä¸Šéƒ½æ˜¯åœ¨åˆ›å»ºä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²å¯¹è±¡ã€‚æ¯”å¦‚ï¼Œä¸‹é¢çš„æ“ä½œæ”¹å˜äº†<code>spam</code>å˜é‡çš„å†…å®¹ï¼Œå¹¶éæ˜¯é€šè¿‡æ”¹å˜å­—ç¬¦ä¸²çš„å€¼ï¼Œè€Œæ˜¯ç”¨ä¸€ä¸ªæ–°çš„å…·æœ‰ä¸åŒèº«ä»½çš„å­—ç¬¦ä¸²å€¼æ›¿æ¢äº†å®ƒï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>spam = <span class="hljs-string">&#x27;Hello&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">id</span>(spam), spam<br>(<span class="hljs-number">38330864</span>, <span class="hljs-string">&#x27;Hello&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>spam = spam + <span class="hljs-string">&#x27; world!&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">id</span>(spam), spam<br>(<span class="hljs-number">38329712</span>, <span class="hljs-string">&#x27;Hello world!&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>spam = spam.upper()<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">id</span>(spam), spam<br>(<span class="hljs-number">38329648</span>, <span class="hljs-string">&#x27;HELLO WORLD!&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>spam = <span class="hljs-string">&#x27;Hi&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">id</span>(spam), spam<br>(<span class="hljs-number">38395568</span>, <span class="hljs-string">&#x27;Hi&#x27;</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>spam = <span class="hljs-string">f&#x27;<span class="hljs-subst">&#123;spam&#125;</span> world!&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">id</span>(spam), spam<br>(<span class="hljs-number">38330864</span>, <span class="hljs-string">&#x27;Hi world!&#x27;</span>)<br></code></pre></td></tr></table></figure><p>ã€€ã€€æ³¨æ„ï¼Œæ¯æ¬¡è°ƒç”¨<code>id(spam)</code>éƒ½è¿”å›äº†ä¸€ä¸ªä¸åŒçš„èº«ä»½ï¼Œå› ä¸º<code>spam</code>ä¸­çš„å­—ç¬¦ä¸²å¯¹è±¡å¹¶ä¸æ˜¯è¢«ä¿®æ”¹äº†ï¼Œè€Œæ˜¯è¢«ä¸€ä¸ªå…¨æ–°çš„ã€æ‹¥æœ‰ä¸åŒèº«ä»½çš„å­—ç¬¦ä¸²å¯¹è±¡å–ä»£äº†ã€‚é€šè¿‡ä½¿ç”¨f-stringã€å­—ç¬¦ä¸²çš„<code>format()</code>æ–¹æ³•æˆ–è€…<code>%s</code>æ ¼å¼æ ‡è¯†ç¬¦è·Ÿä½¿ç”¨<code>+</code>è¿›è¡Œå­—ç¬¦ä¸²æ‹¼æ¥ä¸€æ ·ï¼Œéƒ½ä¼šåˆ›å»ºæ–°çš„å­—ç¬¦ä¸²å¯¹è±¡ã€‚è¿™ä¸€ç‚¹é€šå¸¸æ— å…³ç´§è¦ã€‚Pythonæ˜¯ä¸€ç§é«˜çº§ç¨‹åºè¯­è¨€ï¼Œå®ƒå¤„ç†äº†è®¸å¤šç±»ä¼¼çš„ç»†èŠ‚ï¼Œä»¥ä¾¿ä½ ä¸“æ³¨ç¨‹åºå¼€å‘è€ŒéæŠ€æœ¯ç»†èŠ‚ã€‚</p><p>ä½†ä½¿ç”¨å¤§é‡çš„å­—ç¬¦ä¸²è¿æ¥æ„å»ºå­—ç¬¦ä¸²ä¼šä½¿ä½ çš„ç¨‹åºå˜æ…¢ã€‚å¾ªç¯çš„æ¯ä¸€æ¬¡è¿­ä»£éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œå¹¶ä¸¢å¼ƒæ—§çš„å­—ç¬¦ä¸²å¯¹è±¡ã€‚è¿™ç§ä»£ç ä¸€èˆ¬æ˜¯<code>for</code>æˆ–<code>while</code>å¾ªç¯å†…çš„å­—ç¬¦ä¸²è¿æ¥ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>finalString = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">100000</span>):<br><span class="hljs-meta">... </span>    finalString += <span class="hljs-string">&#x27;spam &#x27;</span><br>...<br><span class="hljs-meta">&gt;&gt;&gt; </span>finalString<br>spam spam spam spam spam spam spam spam spam spam spam spam --snip--<br></code></pre></td></tr></table></figure><p>ã€€ã€€å› ä¸º<code>finalString += &#39;spam&#39;</code>åœ¨å¾ªç¯ä¸­é‡å¤æ‰§è¡Œäº†100 000æ¬¡ï¼Œæ‰€ä»¥Pythonè¿›è¡Œäº†100 000æ¬¡å­—ç¬¦ä¸²è¿æ¥ã€‚CPUéœ€è¦åšçš„å·¥ä½œæ˜¯ï¼šè¿æ¥å½“å‰<code>finalString</code>å’Œ<code>&#39;spam&#39;</code>ä»¥åˆ›å»ºä¸€ä¸ªä¸´æ—¶å­—ç¬¦ä¸²ï¼Œå°†å…¶æ”¾åœ¨å†…å­˜é‡Œï¼Œåœ¨ä¸‹ä¸€ä¸ªè¿­ä»£ä¸­åˆç«‹å³ä¸¢æ‰å®ƒã€‚è¿™åšäº†å¤§é‡çš„æ— ç”¨åŠŸï¼Œå› ä¸ºæˆ‘ä»¬åªå…³å¿ƒæœ€ç»ˆçš„å­—ç¬¦ä¸²ï¼Œå¹¶ä¸å…³å¿ƒä¸´æ—¶å­—ç¬¦ä¸²ã€‚</p><p>é€šè¿‡<code>append</code>å½¢æˆåˆ—è¡¨çš„æ–¹æ³•è¦æ¯”å­—ç¬¦ä¸²è¿æ¥çš„æ–¹æ³•å¿«10å€ï¼ˆç¬¬13ç« ä»‹ç»äº†å¦‚ä½•æµ‹é‡ç¨‹åºçš„è¿è¡Œé€Ÿåº¦ï¼‰ã€‚<code>for</code>å¾ªç¯çš„è¿­ä»£æ¬¡æ•°è¶Šå¤šï¼Œä¸¤è€…çš„é€Ÿåº¦å·®å¼‚å°±è¶Šå¤§ã€‚å½“<code>range(100000)</code>æ”¹ä¸º<code>range(100)</code>æµ‹é‡æ—¶ï¼Œå°½ç®¡å­—ç¬¦ä¸²è¿æ¥æ³•è¿˜æ˜¯æ¯”åˆ—è¡¨æ·»åŠ æ³•æ…¢ï¼Œä½†å·®å¼‚å¾®ä¹å…¶å¾®ã€‚ä¸å¿…æ¯æ¬¡éƒ½åšå†³é¿å…ä½¿ç”¨å­—ç¬¦ä¸²è¿æ¥ã€f-stringã€å­—ç¬¦ä¸²<code>format()</code>æ–¹æ³•æˆ–<code>%s</code>æ ¼å¼æ ‡è¯†ç¬¦ã€‚åªæœ‰åœ¨è¿›è¡Œå¤§é‡çš„å­—ç¬¦ä¸²è¿æ¥æ—¶ï¼Œä½¿ç”¨å®ƒä»¬æ‰ä¼šæ˜æ˜¾å˜æ…¢ã€‚</p><p>ã€€ã€€Pythonèƒ½å¤Ÿè®©ç¨‹åºå‘˜ä¸å¿…è€ƒè™‘åº•å±‚ç»†èŠ‚ï¼Œä»è€Œèƒ½æ›´å¿«åœ°ç¼–å†™è½¯ä»¶ã€‚æ­£å¦‚å‰é¢æåˆ°çš„ï¼Œç¨‹åºå‘˜çš„æ—¶é—´æ¯”CPUçš„æ—¶é—´å®è´µå¾—å¤šã€‚ä½†åœ¨æœ‰äº›æƒ…å†µä¸‹ï¼Œäº†è§£ä¸€äº›ç»†èŠ‚ï¼ˆæ¯”å¦‚äº†è§£ä¸å¯å˜çš„å­—ç¬¦ä¸²å’Œå¯å˜çš„åˆ—è¡¨ä¹‹é—´çš„åŒºåˆ«ï¼‰æ˜¯æœ‰å¿…è¦çš„ï¼Œå®ƒå¯ä»¥é¿å…ä½ å å…¥â€œé™·é˜±â€ï¼Œæ¯”å¦‚ä½¿ç”¨è¿æ¥æ–¹æ³•æ¥åˆ›å»ºå­—ç¬¦ä¸²è¿™ç§å¹¶ä¸èªæ˜çš„åšæ³•ã€‚</p><h2 id="8-5-ä¸è¦æŒ‡æœ›sort-æŒ‰ç…§å­—æ¯é¡ºåºæ’åº"><a href="#8-5-ä¸è¦æŒ‡æœ›sort-æŒ‰ç…§å­—æ¯é¡ºåºæ’åº" class="headerlink" title="8.5ã€€ä¸è¦æŒ‡æœ›sort()æŒ‰ç…§å­—æ¯é¡ºåºæ’åº"></a>8.5ã€€ä¸è¦æŒ‡æœ›<code>sort()</code>æŒ‰ç…§å­—æ¯é¡ºåºæ’åº</h2><p>ç¾å›½ä¿¡æ¯äº¤æ¢æ ‡å‡†ä»£ç ï¼ˆASCIIï¼Œå‘éŸ³ä¸ºask-eeï¼‰æ˜¯æ–‡æœ¬å­—ç¬¦ä¸æ•°å­—ä»£ç ï¼ˆè¢«ç§°ä¸º<strong>ç ä½</strong>æˆ–åºå·ï¼‰ä¹‹é—´çš„æ˜ å°„ã€‚<code>sort()</code>æ–¹æ³•é‡‡ç”¨ASCII-beticalæ’åºæ–¹æ³•ï¼ˆä¸€ä¸ªå¸¸è§æœ¯è¯­ï¼Œæ„ä¸ºæŒ‰ç…§åºå·æ’åºï¼‰è€Œéå­—æ¯åºã€‚åœ¨ASCIIç³»ç»Ÿä¸­ï¼Œâ€œAâ€ç”¨ç ä½65è¡¨ç¤ºï¼Œâ€œBâ€ç”¨66è¡¨ç¤ºï¼Œä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°â€œZâ€ç”¨90è¡¨ç¤ºã€‚å°å†™å­—æ¯â€œaâ€åˆ™ç”±ç ä½97è¡¨ç¤ºï¼Œâ€œbâ€ç”±98è¡¨ç¤ºï¼Œä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°â€œzâ€ç”±122è¡¨ç¤ºã€‚å½“æŒ‰ASCIIè¿›è¡Œæ’åºæ—¶ï¼Œå¤§å†™å­—æ¯â€œZâ€ï¼ˆç ä½90ï¼‰æ’åœ¨å°å†™å­—æ¯â€œaâ€ï¼ˆç ä½97ï¼‰ä¹‹å‰ã€‚</p><h2 id="8-6-ä¸è¦å‡è®¾æµ®ç‚¹æ•°æ˜¯å®Œå…¨å‡†ç¡®çš„"><a href="#8-6-ä¸è¦å‡è®¾æµ®ç‚¹æ•°æ˜¯å®Œå…¨å‡†ç¡®çš„" class="headerlink" title="8.6ã€€ä¸è¦å‡è®¾æµ®ç‚¹æ•°æ˜¯å®Œå…¨å‡†ç¡®çš„"></a>8.6ã€€ä¸è¦å‡è®¾æµ®ç‚¹æ•°æ˜¯å®Œå…¨å‡†ç¡®çš„</h2><p>è®¡ç®—æœºåªèƒ½å­˜å‚¨äºŒè¿›åˆ¶æ•°å­—ï¼Œä¹Ÿå°±æ˜¯1å’Œ0ã€‚ä¸ºäº†è¡¨ç¤ºäººç±»ç†Ÿæ‚‰çš„åè¿›åˆ¶æ•°å­—ï¼Œæˆ‘ä»¬éœ€è¦å°†3.14è¿™ç±»æ•°å­—è½¬æ¢æˆäºŒè¿›åˆ¶çš„0å’Œ1çš„åºåˆ—ã€‚æ ¹æ®ç”µæ°”ç”µå­å·¥ç¨‹å¸ˆå­¦ä¼šï¼ˆIEEEï¼Œå‘éŸ³ä¸ºeye triple-eeï¼‰å‘å¸ƒçš„IEEE 754æ ‡å‡†ï¼Œè®¡ç®—æœºå°†åšè¿™æ ·çš„è½¬æ¢ã€‚ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œè¿™äº›ç»†èŠ‚å¯¹ç¨‹åºå‘˜æ˜¯éšè—çš„ï¼Œå¯ä»¥ç›´æ¥è¾“å…¥å¸¦æœ‰å°æ•°ç‚¹çš„åè¿›åˆ¶æ•°å­—ï¼Œä¸å¿…å…³å¿ƒåè¿›åˆ¶æ•°å­—åˆ°äºŒè¿›åˆ¶æ•°å­—çš„è½¬æ¢è¿‡ç¨‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-number">0.3</span><br><span class="hljs-number">0.3</span><br></code></pre></td></tr></table></figure><p>ã€€ã€€æµ®ç‚¹æ•°çš„IEEE 754è¡¨ç¤ºæ³•å¹¶ä¸æ€»æ˜¯ä¸åè¿›åˆ¶çš„æ•°å­—å®Œå…¨ç­‰åŒã€‚è™½ç„¶å¯¹å…·ä½“ç¤ºä¾‹è¿›è¡Œè¯¦ç»†è®²è§£è¶…å‡ºäº†æœ¬ä¹¦çš„èŒƒå›´ï¼Œä½†è¿˜æ˜¯åœ¨è¿™é‡Œä¸¾ä¸€ä¸ªç»å…¸ç¤ºä¾‹â€”â€”0.1é—®é¢˜ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-number">0.1</span> + <span class="hljs-number">0.1</span> + <span class="hljs-number">0.1</span><br><span class="hljs-number">0.30000000000000004</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-number">0.3</span> == (<span class="hljs-number">0.1</span> + <span class="hljs-number">0.1</span> + <span class="hljs-number">0.1</span>)<br><span class="hljs-literal">False</span><br></code></pre></td></tr></table></figure><p>ã€€ã€€è¿™ä¸ªå’Œæ­£ç¡®ç»“æœå­˜åœ¨ç»†å¾®å·®å¼‚çš„å¥‡æ€ªçš„ç»“æœæ˜¯è®¡ç®—æœºè¡¨ç¤ºå’Œå¤„ç†æµ®ç‚¹æ•°çš„æ–¹å¼å­˜åœ¨èˆå…¥è¯¯å·®é€ æˆçš„ã€‚è¿™ä¸æ˜¯Pythonçš„é—®é¢˜ï¼Œè€Œæ˜¯IEEE 754æ ‡å‡†çš„é—®é¢˜ï¼Œå®ƒæ˜¯ä¸€ä¸ªåœ¨CPUæµ®ç‚¹ç”µè·¯ä¸­å®ç°çš„ç¡¬ä»¶æ ‡å‡†ï¼Œè€ŒéæŸç§è¯­è¨€çš„è½¯ä»¶æ ‡å‡†ã€‚ä½¿ç”¨C++æˆ–JavaScriptï¼Œç”šè‡³æ‰€æœ‰åœ¨ä½¿ç”¨IEEE 754æ ‡å‡†çš„CPUä¸Šè¿è¡Œçš„è¯­è¨€ï¼ˆå®é™…ä¸Šä¸–ç•Œä¸Šæ‰€æœ‰çš„CPUéƒ½éµå¾ªè¿™ä¸€æ ‡å‡†ï¼‰ï¼Œéƒ½ä¼šå¾—åˆ°ç›¸åŒçš„ç»“æœã€‚</p><p>æœéœ€è¦åšåˆ°å‡†ç¡®ï¼Œä¾‹å¦‚è¿›è¡Œç§‘å­¦è®¡ç®—æˆ–è€…é‡‘èè®¡ç®—ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨Pythonå†…ç½®çš„<code>decimal</code>æ¨¡å—ã€‚å°½ç®¡åè¿›åˆ¶å¯¹è±¡çš„è®¡ç®—é€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œä½†å¥½å¤„æ˜¯èƒ½å¤Ÿç²¾ç¡®åœ°æ›¿ä»£æµ®ç‚¹å€¼ã€‚æ¯”å¦‚<code>decimal.Decimal(&#39;0.1&#39;)</code>å¯ä»¥åˆ›å»ºä¸€ä¸ªç²¾ç¡®è¡¨ç¤ºæ•°å­—0.1çš„å€¼ï¼Œä¸ä¼šå­˜åœ¨æµ®ç‚¹æ•°çš„èˆå…¥é”™è¯¯ã€‚</p><h2 id="8-7-ä¸è¦ä½¿ç”¨é“¾å¼-è¿ç®—ç¬¦"><a href="#8-7-ä¸è¦ä½¿ç”¨é“¾å¼-è¿ç®—ç¬¦" class="headerlink" title="8.7ã€€ä¸è¦ä½¿ç”¨é“¾å¼!=è¿ç®—ç¬¦"></a>8.7ã€€ä¸è¦ä½¿ç”¨é“¾å¼<code>!=</code>è¿ç®—ç¬¦</h2><p>é“¾å¼æ¯”è¾ƒè¿ç®—ç¬¦ï¼Œå¦‚<code>18 &lt; age &lt; 35</code>ï¼Œæˆ–é“¾å¼èµ‹å€¼è¿ç®—ç¬¦ï¼Œæ¯”å¦‚<code>six = halfDozen = 6</code>ï¼Œåˆ†åˆ«æ˜¯<code>(18 &lt; age) and (age &lt; 35)</code>ä»¥åŠ<code>six = 6; halfDozen = 6</code>çš„ç®€å†™ã€‚</p><p>ã€€ã€€ä½†ä¸è¦ä½¿ç”¨é“¾å¼æ¯”è¾ƒè¿ç®—ç¬¦<code>!=</code>ã€‚ä½ ä¹Ÿè®¸ä»¥ä¸ºä¸‹é¢è¿™æ®µä»£ç æ˜¯åœ¨æ£€æŸ¥3ä¸ªå˜é‡æ˜¯å¦æœ‰ä¸åŒçš„å€¼ï¼Œå› ä¸ºå®ƒçš„ç»“æœä¸º<code>True</code>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>a = <span class="hljs-string">&#x27;cat&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>b = <span class="hljs-string">&#x27;dog&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>c = <span class="hljs-string">&#x27;moose&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>a != b != c<br><span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure><p>ã€€ã€€ä½†å®é™…ä¸Šï¼Œå®ƒç›¸å½“äº<code>(a != b) and (b != c)</code>ï¼Œè¿™æ„å‘³ç€å³ä½¿<code>a</code>ç­‰äº<code>c</code>ï¼Œè¡¨è¾¾å¼<code>a != b != c</code>çš„ç»“æœä»ç„¶ä¸º<code>True</code>ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>a = <span class="hljs-string">&#x27;cat&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>b = <span class="hljs-string">&#x27;dog&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>c = <span class="hljs-string">&#x27;cat&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>a != b != c<br><span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure><p>ã€€ã€€è¿™ä¸ªé”™è¯¯å¾ˆéš¾æ’æŸ¥ï¼Œä»£ç ä¹Ÿå¾ˆè¯¯å¯¼äººï¼Œæ‰€ä»¥æœ€å¥½å½»åº•é¿å…ä½¿ç”¨é“¾å¼<code>!=</code>è¿ç®—ç¬¦ã€‚</p><h2 id="8-8-ä¸è¦å¿˜è®°åœ¨ä»…æœ‰ä¸€é¡¹çš„å…ƒç»„ä¸­æ·»åŠ é€—å·"><a href="#8-8-ä¸è¦å¿˜è®°åœ¨ä»…æœ‰ä¸€é¡¹çš„å…ƒç»„ä¸­æ·»åŠ é€—å·" class="headerlink" title="8.8ã€€ä¸è¦å¿˜è®°åœ¨ä»…æœ‰ä¸€é¡¹çš„å…ƒç»„ä¸­æ·»åŠ é€—å·"></a>8.8ã€€ä¸è¦å¿˜è®°åœ¨ä»…æœ‰ä¸€é¡¹çš„å…ƒç»„ä¸­æ·»åŠ é€—å·</h2><p>åœ¨ä»£ç ä¸­å†™å…ƒç»„å­—é¢é‡æ—¶è¦è®°ä½ï¼ŒåŠ¡å¿…ä¸ºä»…æœ‰ä¸€é¡¹çš„å…ƒç»„æ·»åŠ æ‹–å°¾é€—å·ã€‚<code>(42,)</code>æ˜¯ä¸€ä¸ªåŒ…å«æ•´æ•°42çš„å…ƒç»„ï¼Œè€Œ<code>(42)</code>åªæ˜¯æ•´æ•°42ã€‚<code>(42)</code>ä¸­çš„æ‹¬å·ç±»ä¼¼äºè¡¨è¾¾å¼<code>(20 + 1) * 2</code>ä¸­çš„æ‹¬å·ï¼Œæ˜¯ä¸€ä¸ªæ·»åŠ äº†æ‹¬å·çš„è¡¨è¾¾å¼ï¼Œå®ƒçš„å€¼ä¸ºæ•´æ•°42ã€‚</p><h1 id="ä¹-Pythonçš„å¥‡ç‰¹éš¾æ‡‚ä¹‹å¤„"><a href="#ä¹-Pythonçš„å¥‡ç‰¹éš¾æ‡‚ä¹‹å¤„" class="headerlink" title="ä¹ã€€Pythonçš„å¥‡ç‰¹éš¾æ‡‚ä¹‹å¤„"></a>ä¹ã€€Pythonçš„å¥‡ç‰¹éš¾æ‡‚ä¹‹å¤„</h1><h2 id="9-1-ä¸ºä»€ä¹ˆ256æ˜¯256ï¼Œè€Œ257ä¸æ˜¯257"><a href="#9-1-ä¸ºä»€ä¹ˆ256æ˜¯256ï¼Œè€Œ257ä¸æ˜¯257" class="headerlink" title="9.1ã€€ä¸ºä»€ä¹ˆ256æ˜¯256ï¼Œè€Œ257ä¸æ˜¯257"></a>9.1ã€€ä¸ºä»€ä¹ˆ256æ˜¯256ï¼Œè€Œ257ä¸æ˜¯257</h2><p>ã€€ã€€<code>==</code>è¿ç®—ç¬¦æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å€¼æ˜¯å¦ç›¸ç­‰ï¼Œ<code>is</code>è¿ç®—ç¬¦åˆ™æ¯”è¾ƒå®ƒä»¬çš„èº«ä»½æ˜¯å¦ç›¸åŒã€‚å°½ç®¡æ•´æ•°<code>42</code>å’Œæµ®ç‚¹æ•°<code>42.0</code>çš„å€¼æ˜¯ç›¸ç­‰çš„ï¼Œä½†å®ƒä»¬æ˜¯ä¸åŒçš„å¯¹è±¡ï¼Œä¿å­˜åœ¨è®¡ç®—æœºå†…å­˜çš„ä¸åŒä½ç½®ã€‚é€šè¿‡<code>id()</code>å‡½æ•°æ£€æŸ¥å®ƒä»¬çš„IDæ˜¯å¦ç›¸åŒå¯ä»¥ç¡®è®¤è¿™ä¸€ç‚¹ï¼š</p><p>å½“ç„¶ï¼Œç°å®ä¸­çš„ç¨‹åºä¸€èˆ¬åªä¼šç”¨åˆ°æ•´æ•°çš„å€¼ï¼Œä¸ä¼šåœ¨ä¹å®ƒçš„èº«ä»½ï¼Œæ ¹æœ¬ä¸ä¼šä½¿ç”¨<code>is</code>è¿ç®—ç¬¦æ¯”è¾ƒæ•´æ•°ã€æµ®ç‚¹æ•°ã€å­—ç¬¦ä¸²ã€å¸ƒå°”å‹æˆ–è€…å…¶ä»–ç®€å•æ•°æ®ç±»å‹çš„å€¼ã€‚æœ‰ä¸ªä¾‹å¤–ï¼šå½“åˆ¤æ–­<code>None</code>æ—¶è¦ä½¿ç”¨<code>is None</code>è€Œé<code>== None</code>ï¼Œæ­£å¦‚6.4.3èŠ‚æ‰€æåˆ°çš„ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä½ å‡ ä¹ä¸ä¼šé‡åˆ°è¿™ä¸ªé—®é¢˜ã€‚</p><h2 id="9-4-ä¼ é€’ç©ºåˆ—è¡¨ç»™all"><a href="#9-4-ä¼ é€’ç©ºåˆ—è¡¨ç»™all" class="headerlink" title="9.4ã€€ä¼ é€’ç©ºåˆ—è¡¨ç»™all()"></a>9.4ã€€ä¼ é€’ç©ºåˆ—è¡¨ç»™<code>all()</code></h2><p>å†…ç½®å‡½æ•°<code>all()</code>æ¥å—ä¸€ä¸ªåºåˆ—å€¼ï¼Œæ¯”å¦‚åˆ—è¡¨ã€‚å¦‚æœè¯¥åºåˆ—ä¸­çš„æ‰€æœ‰å€¼éƒ½æ˜¯çœŸå€¼ï¼Œåˆ™è¿”å›<code>True</code>ï¼Œå¦‚æœå…¶ä¸­å­˜åœ¨å‡å€¼ï¼Œåˆ™è¿”å›<code>False</code>ã€‚å¯ä»¥è®¤ä¸º<code>all([Falseï¼ŒTrueï¼ŒTrue])</code>ç­‰æ•ˆäºè¡¨è¾¾å¼<code>False and True and True</code>ã€‚</p><p>ã€€ã€€ä½ å¯ä»¥å°†<code>all()</code>å’Œåˆ—è¡¨æ¨å¯¼å¼ç»“åˆèµ·æ¥ä½¿ç”¨ã€‚é¦–å…ˆåŸºäºåˆ—è¡¨åˆ›å»ºä¸€ä¸ªå¸ƒå°”å€¼çš„åˆ—è¡¨ï¼Œç„¶åä½¿ç”¨<code>all()</code>è®¡ç®—ã€‚æ¯”å¦‚ï¼Œåœ¨äº¤äº’å¼shellä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><p>æœ€å¥½æŠŠ<code>all([])</code>çœ‹ä½œåœ¨è®¡ç®—â€œè¿™ä¸ªåˆ—è¡¨ä¸­ä¸å­˜åœ¨å‡å€¼â€ï¼Œè€Œä¸æ˜¯â€œè¿™ä¸ªåˆ—è¡¨ä¸­éƒ½æ˜¯çœŸå€¼â€ï¼Œå¦åˆ™ä¼šå¾—åˆ°ä¸€äº›å¥‡æ€ªçš„ç»“æœã€‚åœ¨äº¤äº’å¼shellä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><h2 id="9-5-å¸ƒå°”å€¼æ˜¯æ•´æ•°å€¼"><a href="#9-5-å¸ƒå°”å€¼æ˜¯æ•´æ•°å€¼" class="headerlink" title="9.5ã€€å¸ƒå°”å€¼æ˜¯æ•´æ•°å€¼"></a>9.5ã€€å¸ƒå°”å€¼æ˜¯æ•´æ•°å€¼</h2><p>Pythonè®¤ä¸ºæµ®ç‚¹æ•°42.0ç­‰äºæ•´æ•°å€¼42ï¼ŒåŒæ—¶ä¹Ÿè®¤ä¸ºå¸ƒå°”å€¼<code>True</code>å’Œ<code>False</code>åˆ†åˆ«ç­‰äº1å’Œ0ã€‚åœ¨Pythonä¸­ï¼Œ<code>bool</code>æ•°æ®ç±»å‹æ˜¯<code>int</code>æ•°æ®ç±»å‹çš„ä¸€ä¸ªå­ç±»ï¼ˆç¬¬16ç« å°†è®¨è®ºç±»å’Œå­ç±»ï¼‰ã€‚ä½ å¯ä»¥ä½¿ç”¨<code>int()</code>å°†å¸ƒå°”å€¼è½¬æ¢ä¸ºæ•´æ•°ï¼š</p>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€otherã€‘dockerç›¸å…³åŸºç¡€ä»‹ç»</title>
    <link href="/2024/01/08/docker%E7%9B%B8%E5%85%B3%E5%9F%BA%E7%A1%80%E4%BB%8B%E7%BB%8D/"/>
    <url>/2024/01/08/docker%E7%9B%B8%E5%85%B3%E5%9F%BA%E7%A1%80%E4%BB%8B%E7%BB%8D/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€ã€dockeråŸºç¡€ä»‹ç»"><a href="#ä¸€ã€dockeråŸºç¡€ä»‹ç»" class="headerlink" title="ä¸€ã€dockeråŸºç¡€ä»‹ç»"></a>ä¸€ã€dockeråŸºç¡€ä»‹ç»</h1><h2 id="1-1-docker-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1-1-docker-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1.1 docker æ˜¯ä»€ä¹ˆï¼Ÿ"></a>1.1 docker æ˜¯ä»€ä¹ˆï¼Ÿ</h2><ul><li>docker æ˜¯ä¸€ä¸ªå¼€æºçš„åº”ç”¨å®¹å™¨<code>å¼•æ“</code></li><li>docker è¯ç”Ÿäº2013å¹´ï¼ŒåŸºäºGoè¯­è¨€å®ç°ï¼Œ</li><li>dockerå¯ä»¥è®©å¼€å‘è€…æ‰“åŒ…ä»–ä»¬çš„åº”ç”¨ä»¥åŠä¾èµ–åŒ…åˆ°ä¸€ä¸ªè½»é‡çº§ã€å¯ç§»æ¤çš„å®¹å™¨ä¸­ï¼Œç„¶åå‘å¸ƒåˆ°ä»»ä½•æµè¡Œçš„Linuxæœºå™¨ä¸Šï¼Œç°åœ¨ä¹Ÿæ”¯æŒWindows å’Œ Mac OS</li><li>å®¹å™¨æ˜¯å®Œå…¨ä½¿ç”¨æ²™ç®±æœºåˆ¶ï¼Œç›¸äº’éš”ç¦»</li><li>å®¹å™¨æ€§èƒ½å¼€é”€æä½</li></ul><h3 id="1-2-docker-å®‰è£…"><a href="#1-2-docker-å®‰è£…" class="headerlink" title="1.2 docker å®‰è£…"></a>1.2 docker å®‰è£…</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs shell">1. å…ˆå¸è½½æ—§ç‰ˆæœ¬çš„docke<br>sudo apt-get remove docker docker-engine docker.io<br>2. æ›´æ–°ä¸€ä¸‹apt-getæº<br>sudo apt-get update<br>3. å®‰è£…GPGè¯ä¹¦<br><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ«å¿˜äº†æœ€åçš„â€œ-â€</span><br>curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -<br>4. å†™å…¥è½¯ä»¶æºä¿¡æ¯<br>sudo add-apt-repository &quot;deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable&quot;<br>5. åˆ—å‡ºå¯ç”¨ç‰ˆæœ¬<br>sudo apt-cache madison docker-ce<br>6. æ›´æ–°å¹¶å®‰è£… Docker-CE<br>sudo apt-get update<br>sudo apt-get install docker-ce=5:23.0.5-1~ubuntu.20.04~focal<br>sudo apt-get install docker-ce=5:24.0.9-1~ubuntu.22.04~jammy<br>7. å¼€å¯dockeræœåŠ¡ï¼ŒæŸ¥çœ‹dockerçŠ¶æ€<br>sudo service docker start<br>sudo service docker status<br>systemctl restart docker<br>8.ä½¿ç”¨dockerçš„å‘½ä»¤ï¼ŒæŸ¥çœ‹ç°æœ‰é•œåƒå’Œæ­£åœ¨è¿è¡Œçš„å®¹å™¨<br>docker images<br>docker ps<br><span class="hljs-meta prompt_"># </span><span class="language-bash">docker composeå®‰è£…</span><br>curl -L &quot;https://github.com/docker/compose/releases/download/1.29.0/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose<br><br>sudo apt-get update<br>sudo apt-get install apt-transport-https ca-certificates curl gnupg-agent software-properties-common<br>curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -<br>sudo add-apt-repository &quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable&quot;<br><br><br>sudo apt-get update<br>sudo apt-get install docker-ce docker-ce-cli containerd.io<br><br>docker -v<br></code></pre></td></tr></table></figure><p>2ã€æ¢æº</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@localhost henryhzy]# vim /etc/docker/daemon.json  # åˆ›å»ºæˆ–ä¿®æ”¹ /etc/docker/daemon.json æ–‡ä»¶ï¼Œä¿®æ”¹ä¸ºå¦‚ä¸‹å½¢å¼<br>&#123;<br>    &quot;registry-mirrors&quot; : [<br>    &quot;https://docker.mirrors.ustc.edu.cn&quot;,<br>    &quot;http://hub-mirror.c.163.com&quot;,<br>    &quot;https://cr.console.aliyun.com/&quot;<br>  ]<br>&#125;<br><span class="hljs-meta prompt_">$ </span><span class="language-bash">systemctl daemon-reload</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">systemctl restart docker</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker info</span><br></code></pre></td></tr></table></figure><h3 id="1-3-Docker-æ¶æ„"><a href="#1-3-Docker-æ¶æ„" class="headerlink" title="1.3 Docker æ¶æ„"></a>1.3 Docker æ¶æ„</h3><ul><li>é•œåƒï¼ˆImageï¼‰ï¼šDockeré•œåƒï¼ˆImageï¼‰ï¼Œå°±ç›¸å½“äºæ˜¯ä¸€ä¸ªrootæ–‡ä»¶ç³»ç»Ÿã€‚æ¯”å¦‚å®˜æ–¹é•œåƒ ubuntu:16.04å°±åŒ…å«äº†å®Œæ•´çš„ä¸€å¥—Ubuntu16.04æœ€å°ç³»ç»Ÿçš„rootæ–‡ä»¶ç³»ç»Ÿ</li><li>å®¹å™¨ï¼ˆContainerï¼‰ï¼šé•œåƒï¼ˆImageï¼‰å’Œå®¹å™¨ï¼ˆContainerï¼‰çš„å…³ç³»ï¼Œå°±åƒæ˜¯é¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ä¸­çš„ç±»å’Œå¯¹è±¡ä¸€æ ·ï¼Œé•œåƒæ˜¯é™æ€çš„å®šä¹‰ï¼Œå®¹å™¨æ˜¯é•œåƒè¿è¡Œæ—¶çš„å®ä½“ã€‚å®¹å™¨å¯ä»¥è¢«åˆ›å»ºã€å¯åŠ¨ã€åœæ­¢ã€åˆ é™¤ã€æš‚åœç­‰</li><li>ä»“åº“ï¼ˆRepositoryï¼‰ï¼šä»“åº“å¯ä»¥çœ‹æˆä¸€ä¸ªä»£ç æ§åˆ¶ä¸­å¿ƒï¼Œç”¨æ¥ä¿å­˜é•œåƒ</li></ul><p>æ‹‰å–é•œåƒä¸‹æ¥ï¼Œç›¸å½“äºæ‹‰äº†è¿™ä¸ªç³»ç»Ÿï¼Œç„¶åå¯åŠ¨å®¹å™¨ï¼Œå°±æ˜¯è¿è¡Œè¿™ä¸ªé•œåƒï¼Œä¸€ä¸ªé•œåƒå¯ä»¥å¯åŠ¨å¤šä¸ªå®¹å™¨ï¼Œå®¹å™¨å¿…é¡»è¦åŸºä¸é•œåƒå»å¯åŠ¨ã€‚</p><p>ä»“åº“ï¼Œå°±æ¯”å¦‚è¯´dockerå®˜æ–¹ä»“åº“ï¼Œä½ ä¹Ÿå¯ä»¥ç§äººæ–°å»ºä¸€ä¸ªä»“åº“ã€‚</p><h3 id="1-4-docker-å†…çš„ç½‘ç»œé€šä¿¡ï¼Œå››ç§ç½‘ç»œæ¨¡å¼"><a href="#1-4-docker-å†…çš„ç½‘ç»œé€šä¿¡ï¼Œå››ç§ç½‘ç»œæ¨¡å¼" class="headerlink" title="1.4 docker å†…çš„ç½‘ç»œé€šä¿¡ï¼Œå››ç§ç½‘ç»œæ¨¡å¼"></a>1.4 docker å†…çš„ç½‘ç»œé€šä¿¡ï¼Œå››ç§ç½‘ç»œæ¨¡å¼</h3><table><thead><tr><th align="left">Docker ç½‘ç»œæ¨¡å¼</th><th>é…ç½®</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td align="left">host æ¨¡å¼</td><td>-net&#x3D;host</td><td>ä¸»æœºç½‘ç»œæ¨¡å¼ï¼Œå®¹å™¨å’Œä¹¦ä¸»æœºå…±äº«Network name</td></tr><tr><td align="left">containeræ¨¡å¼</td><td>-net&#x3D;container&#x3D;NAME_or_ID</td><td>å®¹å™¨ç½‘ç»œæ¨¡å¼ï¼Œå®¹å™¨å’Œå¦å¤–ä¸€ä¸ªå®¹å™¨å…±äº«Network namespaceã€‚kubernetesä¸­podå°±æ˜¯å¤šä¸ªå®¹å™¨å…±äº«ä¸€ä¸ªNetwork namespaceã€‚</td></tr><tr><td align="left">none æ¨¡å¼</td><td>-net&#x3D;none</td><td>å®¹å™¨æœ‰ç‹¬ç«‹çš„Network namespace,ä½†ç—…ç­æœ‰å¯¹é½è¿›è¡Œä»»ä½•ç½‘ç»œè®¾ç½®ï¼Œå¦‚åˆ†é…vetn pairå’Œç½‘æ¡¥é“¾æ¥ ipç­‰</td></tr><tr><td align="left">bridge æ¨¡å¼ ï¼ˆæ¡¥ï¼‰é»˜è®¤</td><td>-net&#x3D;bridge</td><td>æ¡¥æ¥ç½‘ç»œæ¨¡å¼ è¿™ä¸ªæ˜¯é»˜è®¤æ¨¡å¼ï¼Œ</td></tr></tbody></table><ol><li><p>æ¡¥æ¥ç½‘ç»œæ¨¡å¼ï¼ˆBridge Network Modeï¼‰ï¼šâ€”-<code>æ¯”è¾ƒé€šç”¨æ¯”è¾ƒå¸¸è§„çš„æ–¹å¼ï¼Œé»˜è®¤ä½¿ç”¨</code></p><ul><li>é»˜è®¤æƒ…å†µä¸‹ï¼ŒDockerå®¹å™¨ä½¿ç”¨æ¡¥æ¥ç½‘ç»œæ¨¡å¼ã€‚</li><li>åœ¨æ¡¥æ¥ç½‘ç»œæ¨¡å¼ä¸‹ï¼ŒDockerå®ˆæŠ¤è¿›ç¨‹ä¼šä¸ºæ¯ä¸ªå®¹å™¨åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿç½‘æ¡¥ï¼Œå¹¶å°†å®¹å™¨è¿æ¥åˆ°è¯¥ç½‘æ¡¥ä¸Šã€‚</li><li>å®¹å™¨å¯ä»¥é€šè¿‡æ¡¥æ¥ç½‘ç»œç›¸äº’é€šä¿¡ï¼Œä¹Ÿå¯ä»¥ä¸å®¿ä¸»æœºè¿›è¡Œé€šä¿¡ã€‚</li><li>æ¡¥æ¥ç½‘ç»œæ¨¡å¼<strong>é€‚ç”¨äºå¤šä¸ªå®¹å™¨éœ€è¦åœ¨ç›¸åŒçš„ç½‘ç»œä¸­è¿›è¡Œé€šä¿¡çš„åœºæ™¯</strong>ï¼Œ<strong>æ¯”å¦‚åº”ç”¨ç¨‹åºçš„åˆ†å¸ƒå¼éƒ¨ç½²</strong>ã€‚</li></ul></li><li><p>ä¸»æœºç½‘ç»œæ¨¡å¼ï¼ˆHost Network Modeï¼‰ï¼šâ€”-<code>ä¸ä¸»æœºåŒç½‘ï¼Œæ€§èƒ½é«˜</code></p><ul><li>åœ¨ä¸»æœºç½‘ç»œæ¨¡å¼ä¸‹ï¼Œ<strong>å®¹å™¨ä¸å®¿ä¸»æœºå…±äº«ç›¸åŒçš„ç½‘ç»œå‘½åç©ºé—´</strong>ï¼Œå®¹å™¨ç›´æ¥ä½¿ç”¨å®¿ä¸»æœºçš„ç½‘ç»œæ ˆã€‚</li><li><strong>å®¹å™¨ä¸å®¿ä¸»æœºä¹‹é—´æ²¡æœ‰ç½‘ç»œéš”ç¦»</strong>ï¼Œå®¹å™¨çš„ç½‘ç»œæ“ä½œä¸å®¿ä¸»æœºä¸€è‡´ã€‚</li><li>ä¸»æœºç½‘ç»œæ¨¡å¼<strong>é€‚ç”¨äºå¯¹ç½‘ç»œæ€§èƒ½è¦æ±‚è¾ƒé«˜çš„åœºæ™¯</strong>ï¼Œæ¯”å¦‚<strong>éœ€è¦å®¹å™¨ä¸å®¿ä¸»æœºå…±äº«ç½‘ç»œç«¯å£</strong>æˆ–è€…<strong>éœ€è¦æœ€å¤§åŒ–ç½‘ç»œååé‡</strong>çš„åº”ç”¨ã€‚</li></ul></li><li><p>å®¹å™¨ç½‘ç»œæ¨¡å¼ï¼ˆ<strong>Container</strong> Network Modeï¼‰ï¼šâ€”â€“<code>æ›´é€‚åˆé€‚åˆå®¹å™¨ä¹‹é—´é€šè®¯</code></p><ul><li>åœ¨å®¹å™¨ç½‘ç»œæ¨¡å¼ä¸‹ï¼Œ<strong>å¤šä¸ªå®¹å™¨å¯ä»¥å…±äº«åŒä¸€ä¸ªç½‘ç»œæ ˆ</strong>ã€‚</li><li><strong>å®¹å™¨å¯ä»¥é€šè¿‡å®¹å™¨åç§°è¿›è¡Œé€šä¿¡</strong>ï¼Œè€Œæ— éœ€ä½¿ç”¨IPåœ°å€ã€‚</li><li><strong>å®¹å™¨ç½‘ç»œæ¨¡å¼é€‚ç”¨äºéœ€è¦åœ¨å¤šä¸ªå®¹å™¨ä¹‹é—´å»ºç«‹ä¸“ç”¨ç½‘ç»œçš„åœºæ™¯</strong>ï¼Œ<strong>æ¯”å¦‚å¤šä¸ªåº”ç”¨å®¹å™¨éœ€è¦ä¸æ•°æ®åº“å®¹å™¨è¿›è¡Œé€šä¿¡ã€‚</strong></li></ul></li><li><p>æ— ç½‘ç»œæ¨¡å¼ï¼ˆNone Network Modeï¼‰ï¼š</p><ul><li>åœ¨æ— ç½‘ç»œæ¨¡å¼ä¸‹ï¼Œå®¹å™¨æ²¡æœ‰ä»»ä½•ç½‘ç»œè¿æ¥ã€‚</li><li>å®¹å™¨æ— æ³•é€šè¿‡ç½‘ç»œè®¿é—®å¤–éƒ¨ç³»ç»Ÿï¼Œä¹Ÿæ— æ³•ä»å¤–éƒ¨ç³»ç»Ÿè®¿é—®å®¹å™¨ã€‚</li><li>æ— ç½‘ç»œæ¨¡å¼é€‚ç”¨äºå¯¹ç½‘ç»œå®Œå…¨éš”ç¦»çš„åœºæ™¯ï¼Œæ¯”å¦‚å®‰å…¨æ€§è¦æ±‚é«˜çš„å®¹å™¨ç¯å¢ƒã€‚</li></ul></li></ol><p>è¿™äº›ç½‘ç»œæ¨¡å¼æä¾›äº†ä¸åŒçš„ç½‘ç»œé…ç½®é€‰é¡¹ï¼Œå¯ä»¥æ ¹æ®å…·ä½“çš„åº”ç”¨éœ€æ±‚é€‰æ‹©åˆé€‚çš„ç½‘ç»œæ¨¡å¼ã€‚é€šè¿‡é€‚å½“é€‰æ‹©ç½‘ç»œæ¨¡å¼ï¼Œå¯ä»¥æ»¡è¶³å®¹å™¨ä¹‹é—´çš„é€šä¿¡éœ€æ±‚ï¼Œæä¾›ç½‘ç»œéš”ç¦»å’Œå®‰å…¨æ€§ï¼Œå¹¶ä¼˜åŒ–ç½‘ç»œæ€§èƒ½ã€‚</p><h1 id="äºŒã€Docker-å‘½ä»¤"><a href="#äºŒã€Docker-å‘½ä»¤" class="headerlink" title="äºŒã€Docker  å‘½ä»¤"></a>äºŒã€Docker  å‘½ä»¤</h1><h3 id="2-1-Docker-æœåŠ¡ç›¸å…³å‘½ä»¤"><a href="#2-1-Docker-æœåŠ¡ç›¸å…³å‘½ä»¤" class="headerlink" title="2.1 Docker æœåŠ¡ç›¸å…³å‘½ä»¤"></a>2.1 Docker æœåŠ¡ç›¸å…³å‘½ä»¤</h3><ul><li><p>å¯åŠ¨docker æœåŠ¡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl start docker<br></code></pre></td></tr></table></figure></li><li><p>åœæ­¢docker æœåŠ¡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl stop docker<br></code></pre></td></tr></table></figure></li><li><p>é‡å¯docker æœåŠ¡ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl restart docker<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹docker æœåŠ¡çŠ¶æ€ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl status docker<br></code></pre></td></tr></table></figure></li><li><p>è®¾ç½®å¼€æœºå¯åŠ¨dockerï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">systemctl enable docker<br></code></pre></td></tr></table></figure></li><li><p>å…¶ä»–docker å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker version<br>docker info<br>docker --help<br>docker pull --help<br></code></pre></td></tr></table></figure></li></ul><h3 id="2-2-Docker-é•œåƒç›¸å…³å‘½ä»¤"><a href="#2-2-Docker-é•œåƒç›¸å…³å‘½ä»¤" class="headerlink" title="2.2 Docker é•œåƒç›¸å…³å‘½ä»¤"></a>2.2 Docker é•œåƒç›¸å…³å‘½ä»¤</h3><ul><li><p>æŸ¥çœ‹é•œåƒï¼šæŸ¥çœ‹æœ¬åœ°æ‰€æœ‰çš„é•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker images<br>docker images -q #æŸ¥çœ‹æ‰€æœ‰é•œåƒçš„id<br></code></pre></td></tr></table></figure></li><li><p>æœç´¢é•œåƒï¼šä»ç½‘ç»œä¸­æŸ¥æ‰¾éœ€è¦çš„é•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker search é•œåƒåç§°<br></code></pre></td></tr></table></figure></li><li><p>æ‹‰å–é•œåƒï¼šä»Docker ä»“åº“ä¸‹è½½é•œåƒåˆ°æœ¬åœ°ï¼Œé•œåƒåç§°æ ¼å¼ä¸º<code>åç§°:ç‰ˆæœ¬å·</code>ï¼Œå¦‚æœç‰ˆæœ¬å·ä¸æŒ‡å®šåˆ™æ˜¯æœ€æ–°çš„ç‰ˆæœ¬ã€‚å¦‚æœä¸çŸ¥é“é•œåƒç‰ˆæœ¬ï¼Œå¯ä»¥å»docker hub æœç´¢å¯¹åº”é•œåƒæŸ¥çœ‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker pull é•œåƒåç§°<br></code></pre></td></tr></table></figure></li><li><p>åˆ é™¤é•œåƒï¼šåˆ é™¤æœ¬åœ°é•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker rmi é•œåƒid/åç§°å·:ç‰ˆæœ¬å· #åˆ é™¤æŒ‡å®šæœ¬åœ°é•œåƒ<br>docker rmi &#x27;docker images -q&#x27; #åˆ é™¤æ‰€æœ‰æœ¬åœ°é•œåƒ<br></code></pre></td></tr></table></figure></li><li><p>ä¿å­˜é•œåƒï¼šå°†æˆ‘ä»¬çš„é•œåƒ ä¿å­˜ä¸ºtar å‹ç¼©æ–‡ä»¶ è¿™æ ·æ–¹ä¾¿é•œåƒè½¬ç§»å’Œä¿å­˜ ,ç„¶å å¯ä»¥åœ¨ä»»ä½•ä¸€å°å®‰è£…äº†dockerçš„æœåŠ¡å™¨ä¸Š åŠ è½½è¿™ä¸ªé•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker save é•œåƒå/é•œåƒID -o é•œåƒä¿å­˜åœ¨å“ªä¸ªä½ç½®ä¸åå­—<br>docker save tomcat -o /myimg.tar<br><span class="hljs-meta prompt_"># </span><span class="language-bash">åŠ è½½é•œåƒ</span><br>docker load -i é•œåƒä¿å­˜æ–‡ä»¶ä½ç½®<br></code></pre></td></tr></table></figure></li></ul><h3 id="2-3-Docker-å®¹å™¨ç›¸å…³å‘½ä»¤"><a href="#2-3-Docker-å®¹å™¨ç›¸å…³å‘½ä»¤" class="headerlink" title="2.3 Docker å®¹å™¨ç›¸å…³å‘½ä»¤"></a>2.3 Docker å®¹å™¨ç›¸å…³å‘½ä»¤</h3><ul><li><p>æŸ¥çœ‹å®¹å™¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker ps #æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨<br>docker ps -a #æŸ¥çœ‹æ‰€æœ‰å®¹å™¨<br></code></pre></td></tr></table></figure></li><li><p>åˆ›å»ºå¹¶å¯åŠ¨å®¹å™¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run å‚æ•° ç‰ˆæœ¬:ç‰ˆæœ¬å· &lt;/bin/bash&gt;#é»˜è®¤ä¸º/bin/bash<br></code></pre></td></tr></table></figure><ul><li><p>å‚æ•°è¯´æ˜ï¼š</p><ul><li><code>-i</code>ï¼šä¿æŒå®¹å™¨è¿è¡Œã€‚é€šå¸¸ä¸<code>-t</code>åŒæ—¶ä½¿ç”¨ã€‚åŠ å…¥<code>it</code>è¿™ä¸¤ä¸ªå‚æ•°åï¼Œå®¹å™¨åˆ›å»ºåè‡ªåŠ¨è¿›å…¥å®¹å™¨ä¸­ï¼Œé€€å‡ºå®¹å™¨åï¼Œå®¹å™¨è‡ªåŠ¨å…³é—­</li><li><code>-t</code>ï¼šä¸ºå®¹å™¨é‡æ–°åˆ†é…ä¸€ä¸ªä¼ªè¾“å…¥ç»ˆç«¯ï¼Œé€šå¸¸ä¸<code>-i</code>åŒæ—¶ä½¿ç”¨</li><li><code>-d</code>ï¼šä»¥å®ˆæŠ¤ï¼ˆåå°ï¼‰æ¨¡å¼è¿è¡Œå®¹å™¨ã€‚åˆ›å»ºä¸€ä¸ªå®¹å™¨åœ¨åå°è¿è¡Œï¼Œéœ€è¦ä½¿ç”¨<code>docker exec</code>è¿›å…¥å®¹å™¨<code>docker exec -it c2 /bin/bash</code>ã€‚é€€å‡ºåï¼Œå®¹å™¨ä¸ä¼šå…³é—­</li><li><code>-it</code>åˆ›å»ºçš„å®¹å™¨ä¸€èˆ¬ç§°ä¸ºäº¤äº’å¼å®¹å™¨ï¼›<code>-id</code>åˆ›å»ºçš„å®¹å™¨ä¸€èˆ¬ç§°ä¸ºå®ˆæŠ¤å¼å®¹å™¨</li><li><code>--name</code>ï¼šä¸ºåˆ›å»ºçš„å®¹å™¨å‘½å</li></ul></li></ul></li><li><p>è¿›å…¥å®¹å™¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker exec å‚æ•° #é€€å‡ºå®¹å™¨ï¼Œå®¹å™¨ä¸ä¼šå…³é—­<br>docker exec -it &lt;å®¹å™¨åç§°æˆ– ID&gt; /bin/bash<br></code></pre></td></tr></table></figure></li><li><p>åœæ­¢å®¹å™¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker stop å®¹å™¨åç§° <br></code></pre></td></tr></table></figure></li><li><p>å¯åŠ¨å®¹å™¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker start å®¹å™¨åç§°<br></code></pre></td></tr></table></figure></li><li><p>åˆ é™¤å®¹å™¨ï¼šå¦‚æœå®¹å™¨æ˜¯è¿è¡ŒçŠ¶æ€åˆ™åˆ é™¤å¤±è´¥ï¼Œéœ€è¦åœæ­¢å®¹å™¨å‚èƒ½åˆ é™¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker rm å®¹å™¨åç§°<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹å®¹å™¨ä¿¡æ¯</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker inspect å®¹å™¨åç§°<br></code></pre></td></tr></table></figure></li><li><p><strong>æŸ¥çœ‹å®¹å™¨æ—¥å¿—</strong>-è¿™ä¸ªå¾ˆæœ‰ç”¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker logs å®¹å™¨åç§°<br></code></pre></td></tr></table></figure></li></ul><h1 id="ä¸‰ã€-Docker-å®¹å™¨çš„æ•°æ®å·"><a href="#ä¸‰ã€-Docker-å®¹å™¨çš„æ•°æ®å·" class="headerlink" title="ä¸‰ã€ Docker å®¹å™¨çš„æ•°æ®å·"></a>ä¸‰ã€ Docker å®¹å™¨çš„æ•°æ®å·</h1><h3 id="3-1-æ•°æ®å·æ¦‚å¿µåŠä½œç”¨"><a href="#3-1-æ•°æ®å·æ¦‚å¿µåŠä½œç”¨" class="headerlink" title="3.1 æ•°æ®å·æ¦‚å¿µåŠä½œç”¨"></a>3.1 æ•°æ®å·æ¦‚å¿µåŠä½œç”¨</h3><p><strong>è¯•ç€æƒ³ä¸€ä¸‹ï¼š</strong></p><ul><li>Docker å®¹å™¨åˆ é™¤åï¼Œåœ¨å®¹å™¨ä¸­äº§ç”Ÿçš„æ•°æ®è¿˜åœ¨å—ï¼Ÿâ€”æ˜¯æŒä¹…åŒ–çš„å­˜å‚¨å—ï¼Ÿ</li><li>Docker å®¹å™¨å’Œå¤–éƒ¨æœºå™¨å¯ä»¥äº¤æ¢æ–‡ä»¶å—ï¼Ÿ  â€”â€”â€“å®¹å™¨ä¸å¤–éƒ¨é€šè®¯ ï¼Ÿ</li><li>å®¹å™¨ä¹‹é—´æƒ³è¦è¿›è¡Œæ•°æ®äº¤äº’ï¼Ÿâ€”â€”â€”â€”å®¹å™¨ä¸å®¹å™¨ä¹‹é—´é€šè®¯ ï¼Ÿ</li></ul><p><strong>è¿™é‡Œå°±æœ‰ä¸€ä¸ª<code>æ•°æ®å·</code>çš„æ¦‚å¿µäº†ï¼š</strong></p><ul><li>æ•°æ®å·æ˜¯å®¿ä¸»æœºï¼ˆè¿è¡Œçš„ç‰©ç†è®¾å¤‡ï¼‰ä¸­çš„ä¸€ä¸ªç›®å½•æˆ–æ–‡ä»¶</li><li>å½“å®¹å™¨ç›®å½•å’Œæ•°æ®å·ç›®å½•ç»‘å®šåï¼Œå¯¹æ–¹çš„ä¿®æ”¹ä¼šç«‹å³åŒæ­¥â€”â€”ç»‘å®šæœ¬æœºå¯¹åº”ç›®å½•</li><li>ä¸€ä¸ªæ•°æ®å·å¯ä»¥è¢«å¤šä¸ªå®¹å™¨åŒæ—¶æŒ‚è½½â€”â€”â€”ä¸€ä¸ªç›®å½•æ˜ å°„å¤šä¸ªå®¹å™¨</li><li>ä¸€ä¸ªå®¹å™¨ä¹Ÿå¯ä»¥è¢«æŒ‚è½½å¤šä¸ªæ•°æ®å·â€”â€”â€”-ä¸€ä¸ªå®¹å™¨æ˜ å°„å¤šä¸ªç›®å½•</li></ul><p><strong>æ•°æ®å·çš„ä½œç”¨å°±å‡ºæ¥äº†ï¼š</strong></p><ul><li>å®¹å™¨æ•°æ®æŒä¹…åŒ–</li><li>å¤–éƒ¨è®¡ä»·å™¨å’Œå®¹å™¨é—´æ¥é€šä¿¡</li><li>å®¹å™¨ä¹‹é—´æ•°æ®äº¤æ¢</li></ul><h3 id="3-2-é…ç½®æ•°æ®å·"><a href="#3-2-é…ç½®æ•°æ®å·" class="headerlink" title="3.2 é…ç½®æ•°æ®å·"></a>3.2 é…ç½®æ•°æ®å·</h3><ul><li><p>åˆ›å»ºå¯åŠ¨å®¹å™¨æ—¶ï¼Œä½¿ç”¨<code>-v</code>å‚æ•° è®¾ç½®æ•°æ®å·</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run ... -v å®¿ä¸»æœºç›®å½•(æ–‡ä»¶):å®¹å™¨å†…ç›®å½•(æ–‡ä»¶) ...<br></code></pre></td></tr></table></figure><ul><li>-v å°±æ˜¯ -Volumes å·çš„æ„æ€</li></ul></li><li><p>æ³¨æ„äº‹é¡¹ï¼š</p><ol><li>ç›®å½•å¿…é¡»æ˜¯ç»å¯¹è·¯å¾„â€”-&#x2F;home&#x2F;user&#x2F;user1&#x2F;docker&#x2F;mysql</li><li>å¦‚æœç›®å½•ä¸å­˜åœ¨ï¼Œä¼šè‡ªåŠ¨åˆ›å»º</li><li>å¯ä»¥æŒ‚è½½å¤šä¸ªæ•°æ®å·</li></ol></li></ul><h3 id="3-3-é…ç½®æ•°æ®å·å®¹å™¨"><a href="#3-3-é…ç½®æ•°æ®å·å®¹å™¨" class="headerlink" title="3.3 é…ç½®æ•°æ®å·å®¹å™¨"></a>3.3 é…ç½®æ•°æ®å·å®¹å™¨</h3><p>â€‹    å¤šå®¹å™¨è¿›è¡Œæ•°æ®äº¤æ¢ï¼š</p><ol><li>å¤šä¸ªå®¹å™¨æŒ‚è½½åŒä¸€ä¸ªæ•°æ®å·</li><li>æ•°æ®å·å®¹å™¨</li></ol><p>â€‹    <strong>é…ç½®æ•°æ®å·å®¹å™¨ï¼š</strong></p><ol><li><p>åˆ›å»ºå¯åŠ¨c3æ•°æ®å·å®¹å™¨ï¼Œä½¿ç”¨<code>-v</code>å‚æ•° è®¾ç½®æ•°æ®å·</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -it --name=c3 -v /volume centos:7 /bin/bash<br></code></pre></td></tr></table></figure></li><li><p>åˆ›å»ºå¯åŠ¨c1 c2å®¹å™¨ï¼Œä½¿ç”¨<code>--volumes-from</code>å‚æ•° è®¾ç½®æ•°æ®å·</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -it --name=c1 --volumes-from c3 centos:7 /bin/bash<br>docker run -it --name=c2 --volumes-from c3 centos:7 /bin/bash<br></code></pre></td></tr></table></figure></li></ol><h1 id="å››ã€Docker-åº”ç”¨éƒ¨ç½²"><a href="#å››ã€Docker-åº”ç”¨éƒ¨ç½²" class="headerlink" title="å››ã€Docker åº”ç”¨éƒ¨ç½²"></a>å››ã€Docker åº”ç”¨éƒ¨ç½²</h1><h2 id="4-1-MySQLéƒ¨ç½²"><a href="#4-1-MySQLéƒ¨ç½²" class="headerlink" title="4.1 MySQLéƒ¨ç½²"></a>4.1 MySQLéƒ¨ç½²</h2><h5 id="4-1-1æ¡ˆä¾‹ï¼šéœ€æ±‚"><a href="#4-1-1æ¡ˆä¾‹ï¼šéœ€æ±‚" class="headerlink" title="4.1.1æ¡ˆä¾‹ï¼šéœ€æ±‚"></a>4.1.1æ¡ˆä¾‹ï¼šéœ€æ±‚</h5><ul><li>åœ¨Docker å®¹å™¨ä¸­éƒ¨ç½²MySQLï¼Œå¹¶é€šè¿‡å¤–éƒ¨MySQL å®¢æˆ·ç«¯æ“ä½œMySQL Server</li></ul><h5 id="4-1-2-æ¡ˆä¾‹ï¼šå®ç°"><a href="#4-1-2-æ¡ˆä¾‹ï¼šå®ç°" class="headerlink" title="4.1.2 æ¡ˆä¾‹ï¼šå®ç°"></a>4.1.2 æ¡ˆä¾‹ï¼šå®ç°</h5><ol><li>æœç´¢mysqlé•œåƒ</li><li>æ‹‰å–mysqlé•œåƒ</li><li>åˆ›å»ºå®¹å™¨</li><li>æ“ä½œå®¹å™¨ä¸­çš„mysql</li></ol><h5 id="4-1-3-é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ"><a href="#4-1-3-é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ" class="headerlink" title="4.1.3 é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ"></a>4.1.3 é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ</h5><ul><li>å®¹å™¨å†…çš„ç½‘ç»œæœåŠ¡å’Œå¤–éƒ¨æœºå™¨ä¸èƒ½ç›´æ¥é€šä¿¡</li><li>å¤–éƒ¨æœºå™¨å’Œå®¿ä¸»æœºå¯ä»¥ç›´æ¥é€šä¿¡</li><li>å®¿ä¸»æœºå’Œå®¹å™¨å¯ä»¥ç›´æ¥é€šä¿¡</li><li>å½“å®¹å™¨ä¸­çš„ç½‘ç»œæœåŠ¡éœ€è¦è¢«å¤–éƒ¨æœºå™¨è®¿é—®æ—¶ï¼Œå¯ä»¥å°†å®¹å™¨ä¸­æä¾›æœåŠ¡çš„ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœºçš„ç«¯å£ä¸Šã€‚å¤–éƒ¨æœºå™¨è®¿é—®å®¿ä¸»æœºçš„ç«¯å£ï¼Œä»è€Œé—´æ¥è®¿é—®å®¹å™¨çš„æœåŠ¡</li><li>è¿™ç§æ“ä½œç§°ä¸ºï¼šç«¯å£æ˜ å°„</li></ul><h5 id="4-1-4-éƒ¨ç½²MySQL"><a href="#4-1-4-éƒ¨ç½²MySQL" class="headerlink" title="4.1.4 éƒ¨ç½²MySQL"></a>4.1.4 éƒ¨ç½²MySQL</h5><ol><li><p>æœç´¢mysqlé•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker search mysql<br></code></pre></td></tr></table></figure></li><li><p>æ‹‰å–mysqlé•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker pull mysql:5.6<br></code></pre></td></tr></table></figure></li><li><p>åˆ›å»ºå®¹å™¨ï¼Œè®¾ç½®ç«¯å£æ˜ å°„ã€ç›®å½•æ˜ å°„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">åœ¨/rootç›®å½•ä¸‹åˆ›å»ºmysqlç›®å½•ç”¨äºå­˜å‚¨mysqlæ•°æ®ä¿¡æ¯</span><br>mkdir ~/mysql<br>cd ~/mysql<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -id \<br>-p 3307:3306 \<br>--name=c_mysql \<br>-v $PWD/conf:/etc/mysql/conf.d \<br>-v $PWD/logs:/logs \<br>-v $PWD/data:/var/lib/mysql \<br>-e MYSQL_ROOT_PASSWORD=123456 \<br>mysql:5.6<br></code></pre></td></tr></table></figure><ul><li>å‚æ•°è¯´æ˜<ul><li><code>-p 3307:3306</code>ï¼šå°†å®¹å™¨çš„3306ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœºçš„3307ç«¯å£</li><li><code>--v $PWD/conf:/etc/mysql/conf.d</code>ï¼šå°†ä¸»æœºå½“å‰ç›®å½•ä¸‹çš„<code>conf/my.cnf</code>æŒ‚è½½åˆ°å®¹å™¨<code>/etc/mysql/my.cnf</code>é…ç½®ç›®å½•</li><li><code>-v $PWD/logs:/logs</code>ï¼šå°†ä¸»æœºå½“å‰ç›®å½•ä¸‹çš„<code>logs</code>ç›®å½•æŒ‚è½½åˆ°å®¹å™¨çš„<code>/logs</code>ç›®å½•æ—¥å¿—</li><li><code>-v $PWD/data:/var/lib/mysql</code>ï¼šå°†ä¸»æœºå½“å‰ç›®å½•ä¸‹çš„<code>data</code>ç›®å½•æŒ‚è½½åˆ°å®¹å™¨çš„<code>/var/lib/mysql</code>æ•°æ®ç›®å½•</li><li><code>-e MYSQL_ROOT_PASSWORD=123456</code>ï¼šåˆå§‹åŒ–root ç”¨æˆ·å¯†ç </li></ul></li></ul></li><li><p>ä½¿ç”¨å¤–éƒ¨æœºå™¨è®¿é—®MySQL</p></li><li><p>è¿›å…¥mysqlå®¹å™¨åˆ›å»ºæ•°æ®åº“</p></li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker exec -it å®¹å™¨id:cecb37dc3872 /bin/bash<br><span class="hljs-meta prompt_"># </span><span class="language-bash">è¿›å…¥mysql</span><br>root@cecb37dc3872:/# mysql -u root -p<br><span class="hljs-meta prompt_">#</span><span class="language-bash">è¾“å…¥å¯†ç åè¿›å…¥äº†</span><br><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash">CREATE DATABASE kinit; <span class="hljs-comment"># # åˆ›å»ºæ•°æ®åº“</span></span><br>Query OK, 1 row affected (0.00 sec)<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å¦‚æœä½ æƒ³ä¸º <span class="hljs-string">&quot;kinit&quot;</span> æ•°æ®åº“è®¾ç½®ä¸€ä¸ªé»˜è®¤å­—ç¬¦é›†å’Œæ’åºè§„åˆ™ï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</span><br>CREATE DATABASE kinit CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;# è¿™å°†åˆ›å»ºä¸€ä¸ªä½¿ç”¨ UTF-8 ç¼–ç çš„æ•°æ®åº“ï¼Œå¹¶ä½¿ç”¨é€‚å½“çš„æ’åºè§„åˆ™<br><span class="hljs-meta prompt_"># </span><span class="language-bash">ç¡®è®¤æ•°æ®åº“æ˜¯å¦æˆåŠŸåˆ›å»ºï¼Œä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ—å‡ºæ‰€æœ‰æ•°æ®åº“ï¼š</span><br>SHOW DATABASES;<br><span class="hljs-meta prompt_">mysql&gt; </span><span class="language-bash">SHOW DATABASES;</span><br>+--------------------+<br>| Database           |<br>+--------------------+<br>| information_schema |<br>| kinit              |<br>| mysql              |<br>| performance_schema |<br>+--------------------+<br>4 rows in set (0.00 sec)<br><br></code></pre></td></tr></table></figure><h3 id="4-2-Tomcatéƒ¨ç½²"><a href="#4-2-Tomcatéƒ¨ç½²" class="headerlink" title="4.2 Tomcatéƒ¨ç½²"></a>4.2 Tomcatéƒ¨ç½²</h3><ol><li><p>æœç´¢Tomcat é•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker search tomcat<br></code></pre></td></tr></table></figure></li><li><p>æ‹‰å–mysqlé•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker pull tomcat<br></code></pre></td></tr></table></figure></li><li><p>åˆ›å»ºå®¹å™¨ï¼Œè®¾ç½®ç«¯å£æ˜ å°„ã€ç›®å½•æ˜ å°„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åœ¨/rootç›®å½•ä¸‹åˆ›å»ºtomcatç›®å½•ç”¨äºå­˜æ”¾tomcatæ•°æ®ä¿¡æ¯</span><br>mkdir ~/tomcat<br>cd ~/tomcat<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker run -id --name=c_tomcat \<br>-p 8080:8080 \<br>-v $PWD:/usr/local/tomcat/webapps \<br>tomcat<br></code></pre></td></tr></table></figure><ul><li>å‚æ•°è¯´æ˜ï¼š<ul><li><code>-p 8080:8080</code>ï¼šå°†å®¹å™¨çš„8080ç«¯å£æ˜ å°„åˆ°ä¸»æœºçš„8080ç«¯å£</li><li><code>-v $PWD:/usr/local/tomcat/webapps</code>ï¼šå°†ä¸»æœºä¸­å½“å‰ç›®å½•æŒ‚è½½åˆ°å®¹å™¨çš„<code>webapps</code></li></ul></li></ul></li><li><p>æœ€åä½¿ç”¨å¤–éƒ¨æœºå™¨è®¿é—®tomcat</p></li></ol><h3 id="4-3-Nginxéƒ¨ç½²"><a href="#4-3-Nginxéƒ¨ç½²" class="headerlink" title="4.3 Nginxéƒ¨ç½²"></a>4.3 Nginxéƒ¨ç½²</h3><ol><li><p>æœç´¢Nginx é•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker search nginx<br></code></pre></td></tr></table></figure></li><li><p>æ‹‰å–mysqlé•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker pull nginx<br></code></pre></td></tr></table></figure></li><li><p>åˆ›å»ºå®¹å™¨ï¼Œè®¾ç½®ç«¯å£æ˜ å°„ã€ç›®å½•æ˜ å°„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">åœ¨/rootç›®å½•ä¸‹åˆ›å»ºnginxç›®å½•ç”¨äºå­˜å‚¨nginxæ•°æ®ä¿¡æ¯</span><br>mkdir ~/nginx<br>cd ~/nginx<br>mkdir conf<br>cd conf<br><span class="hljs-meta prompt_">#</span><span class="language-bash">åœ¨~/nginx/conf/ä¸‹åˆ›å»ºnginx.confæ–‡ä»¶ï¼Œç²˜è´´ä¸‹é¢ä»£ç å—çš„å†…å®¹</span><br>vim nginx.conf<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs shel">user  nginx;<br>worker_processes  1;<br><br>error_log  /var/log/nginx/error.log warn;<br>pid        /var/run/nginx.pid;<br><br>events &#123;<br>    worker_connections  1024;<br>&#125;<br><br>http &#123;<br>    include       /etc/nginx/mime.types;<br>    default_type  application/octet-stream;<br><br>    log_format  main  &#x27;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &#x27;<br>                      &#x27;$status $body_bytes_sent &quot;$http_referer&quot; &#x27;<br>                      &#x27;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&#x27;;<br><br>    access_log  /var/log/nginx/access.log  main;<br><br>    sendfile        on;<br>    #tcp_nopush     on;<br><br>    keepalive_timeout  65;<br><br>    #gzip  on;<br><br>    include /etc/nginx/conf.d/*.conf;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker -run -id --name=c_nginx \<br>-p 80:800 \<br>-v $PWD/conf/nginx.conf:/etc/nginx/nginx.conf \<br>-v $PWD/logs:/var/log/nginx \<br>-v $PWD/html:/usr/share/nginx/html \<br>nginx<br></code></pre></td></tr></table></figure><ul><li>å‚æ•°è¯´æ˜ï¼š<ul><li><code>-p 80:800</code>ï¼šå°†å®¹å™¨çš„80ç«¯å£æ˜ å°„åˆ°å®¿ä¸»æœºçš„80ç«¯å£</li><li><code>-v $PWD/conf/nginx.conf:/etc/nginx/nginx.conf</code>ï¼šå°†ä¸»æœºå½“å‰ç›®å½•ä¸‹çš„<code>/conf/nginx.conf</code>æŒ‚è½½åˆ°å®¹å™¨çš„<code>:/etc/nginx/nginx.conf</code>é…ç½®ç›®å½•</li><li><code>-v $PWD/html:/usr/share/nginx/html</code>ï¼šå°†ä¸»æœºå½“å‰ç›®å½•æŒ‚è½½åˆ°å®¹å™¨çš„<code>/val/log/nginx</code>æ—¥å¿—ç›®å½•</li></ul></li></ul></li><li><p>ä½¿ç”¨å¤–éƒ¨æœºå™¨è®¿é—®nginx</p></li></ol><h3 id="4-4-Rediséƒ¨ç½²"><a href="#4-4-Rediséƒ¨ç½²" class="headerlink" title="4.4 Rediséƒ¨ç½²"></a>4.4 Rediséƒ¨ç½²</h3><ol><li><p>æœç´¢Redis é•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker search redis<br></code></pre></td></tr></table></figure></li><li><p>æ‹‰å–Redis é•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker pull redis:5.0<br></code></pre></td></tr></table></figure></li><li><p>åˆ›å»ºå®¹å™¨ï¼Œè®¾ç½®ç«¯å£æ˜ å°„ã€ç›®å½•æ˜ å°„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">åˆ›å»º redis é…ç½®å­˜æ”¾ç›®å½•</span><br>mkdir -p redis_kinit/conf &amp;&amp; chmod 777 redis_kinit/conf<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">åˆ›å»º redis æ•°æ®å­˜æ”¾ç›®å½•</span><br>mkdir -p redis_kinit/data &amp;&amp; chmod 777 redis_kinit/data<br><span class="hljs-meta prompt_"># </span><span class="language-bash">å¯åŠ¨</span><br>docker run -id --name=c_redis -p 6379:6379 redis:5.0<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è¦å…ˆå»å®˜ç½‘ä¸‹è½½å¯¹åº”çš„é…ç½®æ–‡ä»¶ https://raw.githubusercontent.com/redis/redis/7.0/redis.conf</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è‡ªå®šä¹‰å¯åŠ¨ redis</span><br>docker run -d -p 6379:6379 \<br>--name redis_kinit \<br>--restart=always \<br>-v $PWD/redis_kinit/data:/data \<br>-v $PWD/redis_kinit/conf/redis.conf:/etc/redis/redis.conf \<br>redis:7.0.4 \<br>redis-server /etc/redis/redis.conf \<br>--appendonly yes \<br>--requirepass 123456<br><br><br>docker run -itd -p 6378:6379 \<br>--name redis_kinit2 \<br>--restart=always \<br>-v $PWD/data:/data \<br>-v $PWD/conf/redis.conf:/etc/redis/redis.conf \<br>redis:7.0.4 \<br><br></code></pre></td></tr></table></figure></li><li><p>ä½¿ç”¨å¤–éƒ¨æœºå™¨è¿æ¥redis</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs shell">redis-cli.exe -h 192.168.187.129 -p 6379<br><span class="hljs-meta prompt_"># </span><span class="language-bash">éªŒè¯ä¸€ä¸‹æ˜¯å¦éƒ¨ç½²æˆåŠŸ</span><br>docker exec -it &lt;å®¹å™¨åç§°æˆ–ID&gt; redis-cli<br>docker exec -it 73f59ae7be56 redis-cli<br>ç„¶åå¦‚æœæç¤º(error) NOAUTH Authentication required.<br>å°±AUTHéªŒè¯ä½ çš„å¯†ç ï¼Œå†è¯•è¯•<br><span class="hljs-meta prompt_"># </span><span class="language-bash">è¾“å…¥ping</span> <br><span class="hljs-meta prompt_"># </span><span class="language-bash">çœ‹ä¼šä¸ä¼šè¿”å› pong</span><br></code></pre></td></tr></table></figure></li></ol><h3 id="4-5-mongoéƒ¨ç½²"><a href="#4-5-mongoéƒ¨ç½²" class="headerlink" title="4.5 mongoéƒ¨ç½²"></a>4.5 mongoéƒ¨ç½²</h3><ol><li><p>æœç´¢Redis é•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker search mongo<br></code></pre></td></tr></table></figure></li><li><p>æ‹‰å–Redis é•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker pull mongo<br></code></pre></td></tr></table></figure></li><li><p>åˆ›å»ºå®¹å™¨ï¼Œè®¾ç½®ç«¯å£æ˜ å°„ã€ç›®å½•æ˜ å°„</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">åˆ›å»º mongo æ•°æ®å­˜æ”¾ç›®å½•</span><br>mkdir -p /mongo_kinit/data &amp;&amp; chmod 777 /mongo_kinit/data<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å¯åŠ¨</span><br>docker run \<br>--name kinit_mongo \<br>-p 27017:27017  \<br>-v $PWD/data:/data/db \<br>-d mongo \<br>--auth<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">è¿›å…¥</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker <span class="hljs-built_in">exec</span> -it mongo mongosh admin</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">åˆ›å»ºä¸€ä¸ªåä¸º adminï¼Œå¯†ç ä¸º 123456 çš„ç”¨æˆ·ã€‚</span><br><span class="hljs-meta prompt_">&gt; </span><span class="language-bash"> db.createUser(&#123; user:<span class="hljs-string">&#x27;admin&#x27;</span>,<span class="hljs-built_in">pwd</span>:<span class="hljs-string">&#x27;123456&#x27;</span>,roles:[ &#123; role:<span class="hljs-string">&#x27;userAdminAnyDatabase&#x27;</span>, db: <span class="hljs-string">&#x27;admin&#x27;</span>&#125;,<span class="hljs-string">&quot;readWriteAnyDatabase&quot;</span>]&#125;);</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">å°è¯•ä½¿ç”¨ä¸Šé¢åˆ›å»ºçš„ç”¨æˆ·ä¿¡æ¯è¿›è¡Œè¿æ¥ã€‚</span><br><span class="hljs-meta prompt_">&gt; </span><span class="language-bash">db.auth(<span class="hljs-string">&#x27;admin&#x27;</span>, <span class="hljs-string">&#x27;123456&#x27;</span>)</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">åˆ›å»º</span><br>use kinit # åˆ›å»ºæ•°æ®åº“<br>db.createUser(&#123; user: &#x27;admin&#x27;, pwd: &#x27;123456&#x27;, roles: [ &#123; role: &quot;userAdminAnyDatabase&quot;, db: &quot;admin&quot; &#125; ] &#125;);<br>db.auth(&#x27;admin&#x27;, &#x27;011023&#x27;) # å°è¯•ä½¿ç”¨ä¸Šé¢åˆ›å»ºçš„ç”¨æˆ·ä¿¡æ¯è¿›è¡Œè¿æ¥ã€‚<br>exit # åˆ›å»ºæˆåŠŸåå¯é€€å‡º<br><br>db.createUser(&#123; user: &#x27;kinit&#x27;, pwd: &#x27;123456&#x27;, roles: [ &#123; role: &quot;readWrite&quot;, db: &quot;kinit&quot; &#125; ] &#125;)<br>db.auth(&quot;kinit&quot;,&quot;123456&quot;) # éªŒè¯æ˜¯å¦åˆ›å»ºæˆåŠŸ<br>exit<br>mongodb://admin:123456@127.0.0.1:27017<br><br></code></pre></td></tr></table></figure></li><li></li></ol><h1 id="äº”ã€docker-fileï¼ˆåç»­æœ‰ç©ºè¡¥å……ï¼‰"><a href="#äº”ã€docker-fileï¼ˆåç»­æœ‰ç©ºè¡¥å……ï¼‰" class="headerlink" title="äº”ã€docker fileï¼ˆåç»­æœ‰ç©ºè¡¥å……ï¼‰"></a>äº”ã€docker fileï¼ˆåç»­æœ‰ç©ºè¡¥å……ï¼‰</h1><h3 id="5-1-Docker-é•œåƒåŸç†"><a href="#5-1-Docker-é•œåƒåŸç†" class="headerlink" title="5.1 Docker é•œåƒåŸç†"></a>5.1 Docker é•œåƒåŸç†</h3><p>â€‹    æ€è€ƒï¼š</p><ul><li>Docker é•œåƒçš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ<ul><li>æ˜¯ä¸€ä¸ª<strong>åˆ†å±‚</strong>çš„æ–‡ä»¶ç³»ç»Ÿ</li></ul></li><li>Docker ä¸­ä¸€ä¸ªCentOS é•œåƒä¸ºä»€ä¹ˆåªæœ‰200MBï¼Œè€Œä¸€ä¸ªCentOS æ“ä½œç³»ç»Ÿçš„iso æ–‡ä»¶è¦å‡ ä¸ªGï¼Ÿ<ul><li>CentOSçš„isoé•œåƒæ–‡ä»¶åŒ…å«bootfså’Œrootfsï¼Œè€ŒDockerçš„CentOSé•œåƒå¤ç”¨æ“ä½œç³»ç»Ÿçš„bootfsï¼Œåªæœ‰rootfså’Œå…¶ä»–é•œåƒå±‚</li></ul></li><li>Docker ä¸­ä¸€ä¸ªTomcat é•œåƒä¸ºä»€ä¹ˆæœ‰500MBï¼Œè€Œä¸€ä¸ªTomcat å®‰è£…åŒ…åªæœ‰70å¤šMBï¼Ÿ<ul><li>ç”±äºDockerä¸­é•œåƒæ˜¯åˆ†å±‚çš„ï¼Œtomcatè™½ç„¶åªæœ‰70å¤šMBï¼Œä½†ä»–éœ€è¦ä¾èµ–äº<strong>çˆ¶é•œåƒå’ŒåŸºç¡€é•œåƒ</strong>ï¼Œæ‰€ä»¥æ•´ä¸ªå¯¹å¤–æš´éœ²çš„tomcaté•œåƒå¤§å°500å¤šMB</li></ul></li></ul><p><strong>æ“ä½œç³»ç»Ÿç»„æˆéƒ¨åˆ†</strong>ï¼š</p><ul><li><strong>è¿›ç¨‹è°ƒåº¦</strong>å­ç³»ç»Ÿ</li><li><strong>è¿›ç¨‹é€šä¿¡</strong>å­ç³»ç»Ÿ</li><li><strong>å†…å­˜ç®¡ç†</strong>å­ç³»ç»Ÿ</li><li><strong>è®¾å¤‡ç®¡ç†</strong>å­ç³»ç»Ÿ</li><li><strong>æ–‡ä»¶ç®¡ç†</strong>å­ç³»ç»Ÿ</li><li><strong>ç½‘ç»œé€šä¿¡</strong>å­ç³»ç»Ÿ</li><li><strong>ä½œä¸šæ§åˆ¶</strong>å­ç³»ç»Ÿ</li></ul><p>Linuxæ–‡ä»¶ç³»ç»Ÿç”±bootfs å’Œrootfs ä¸¤éƒ¨åˆ†ç»„æˆ</p><ul><li>bootfsï¼šåŒ…å«bootloaderï¼ˆå¼•å¯¼åŠ è½½ç¨‹åºï¼‰å’Œkernelï¼ˆå†…æ ¸ï¼‰</li><li>rootfsï¼šrootæ–‡ä»¶ç³»ç»Ÿï¼ŒåŒ…å«çš„å°±æ˜¯å…¸å‹çš„Linux ç³»ç»Ÿä¸­çš„&#x2F;devã€&#x2F;procã€&#x2F;binç­‰æ ‡å‡†ç›®å½•å’Œæ–‡ä»¶</li><li>ä¸åŒçš„Linux å‘è¡Œç‰ˆï¼Œbootfs åŸºæœ¬ä¸€æ ·ï¼Œè€Œrootfs ä¸åŒï¼Œå¦‚ubuntuï¼ŒCentOSç­‰</li></ul><p><strong>Docker é•œåƒåŸç†ï¼š</strong></p><ul><li>Docker é•œåƒæ˜¯ç”±ç‰¹æ®Šçš„æ–‡ä»¶ç³»ç»Ÿå åŠ è€Œæˆ</li><li>æœ€ä½ç«¯æ˜¯bootfsï¼Œå¹¶ä½¿ç”¨å®¿ä¸»æœºçš„bootfs</li><li>ç¬¬äºŒå±‚æ˜¯root æ–‡ä»¶ç³»ç»Ÿrootfs ï¼Œç§°ä¸ºbase iamge</li><li>ç„¶åå†å¾€ä¸Šå¯ä»¥å åŠ å…¶ä»–çš„é•œåƒæ–‡ä»¶</li><li>ç»Ÿä¸€æ–‡ä»¶ç³»ç»Ÿï¼ˆUnion File Systemï¼‰æŠ€æœ¯èƒ½å¤Ÿå°†ä¸åŒçš„å±‚æ•´åˆæˆä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œä¸ºè¿™äº›å±‚æä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„è§†è§’ï¼Œè¿™æ ·å°±éšè—äº†å¤šå±‚çš„å­˜åœ¨ï¼Œåœ¨ç”¨æˆ·çš„è§’åº¦çœ‹æ¥ï¼Œåªå­˜åœ¨ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿ</li><li>ä¸€ä¸ªé•œåƒå¯ä»¥æ”¾åœ¨å¦ä¸€ä¸ªé•œåƒçš„ä¸Šé¢ã€‚ä½äºä¸‹é¢çš„é•œåƒç§°ä¸ºçˆ¶é•œåƒï¼Œæœ€åº•éƒ¨çš„é•œåƒç§°ä¸ºåŸºç¡€é•œåƒ</li><li>å½“ä»ä¸€ä¸ªé•œåƒå¯åŠ¨å®¹å™¨æ—¶ï¼ŒDockerä¼šåœ¨æœ€é¡¶å±‚åŠ è½½ä¸€ä¸ªè¯»å†™æ–‡ä»¶ç³»ç»Ÿä½œä¸ºå®¹å™¨</li></ul><p><strong>é•œåƒåˆ¶ä½œï¼š</strong></p><ul><li><p>å®¹å™¨è½¬ä¸ºé•œåƒ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker commit  å®¹å™¨id é•œåƒåç§°:ç‰ˆæœ¬å·<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shel">docker save -o å‹ç¼©æ–‡ä»¶åç§° é•œåƒåç§°:ç‰ˆæœ¬å·<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker load -i å‹ç¼©æ–‡ä»¶åç§°<br></code></pre></td></tr></table></figure></li></ul><h3 id="5-2-Dockerfile-æ¦‚å¿µåŠä½œç”¨"><a href="#5-2-Dockerfile-æ¦‚å¿µåŠä½œç”¨" class="headerlink" title="5.2 Dockerfile æ¦‚å¿µåŠä½œç”¨"></a>5.2 Dockerfile æ¦‚å¿µåŠä½œç”¨</h3><p><strong>Dockerfile æ¦‚å¿µ</strong></p><ul><li>Dockerfile æ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶</li><li>åŒ…å«äº†ä¸€æ¡æ¡çš„æŒ‡ä»¤</li><li>æ¯ä¸€æ¡æŒ‡ä»¤æ„å»ºä¸€å±‚ï¼Œ<strong>åŸºäºåŸºç¡€é•œåƒï¼Œæœ€ç»ˆæ„å»ºå‡ºä¸€ä¸ªæ–°çš„é•œåƒ</strong></li><li>å¯¹äºå¼€å‘äººå‘˜ï¼Œå¯ä»¥<strong>ä¸ºå¼€å‘å›¢é˜Ÿæä¾›ä¸€ä¸ªå®Œå…¨ä¸€è‡´çš„å¼€å‘ç¯å¢ƒ</strong></li><li>å¯¹äºæµ‹è¯•äººå‘˜ï¼Œå¯ä»¥<strong>ç›´æ¥æ‹¿å¼€å‘æ—¶æ‰€æ„å»ºçš„é•œåƒæˆ–è€…é€šè¿‡Dockerfile æ–‡ä»¶æ„å»ºä¸€ä¸ªæ–°çš„é•œåƒ</strong>å¼€å§‹å·¥ä½œäº†</li><li>å¯¹äºè¿ç»´äººå‘˜ï¼Œåœ¨éƒ¨ç½²æ—¶ï¼Œ<strong>å¯ä»¥å®ç°åº”ç”¨çš„æ— ç¼ç§»æ¤</strong></li></ul><h3 id="5-3-Dockerfile-å…³é”®å­—"><a href="#5-3-Dockerfile-å…³é”®å­—" class="headerlink" title="5.3 Dockerfile å…³é”®å­—"></a>5.3 Dockerfile å…³é”®å­—</h3><table><thead><tr><th>å…³é”®å­—</th><th>ä½œç”¨</th><th align="left">å¤‡æ³¨</th></tr></thead><tbody><tr><td>FROM</td><td>æŒ‡å®šçˆ¶é•œåƒ</td><td align="left">æŒ‡å®šdockerfileåŸºäºå“ªä¸ªimagesæ„å»º</td></tr><tr><td>MAINTAINER</td><td>ä½œè€…ä¿¡æ¯</td><td align="left">ç”¨æ¥æ ‡æ˜è¿™ä¸ªdockerfile è°å†™çš„</td></tr><tr><td>LABEL</td><td>æ ‡ç­¾</td><td align="left">ç”¨æ¥æŒ‡æ˜dockerfile çš„æ ‡ç­¾ï¼Œå¯ä»¥ä½¿ç”¨Labelä»£æ›¿Maintainer æœ€ç»ˆéƒ½æ˜¯åœ¨docker imageåŸºæœ¬ä¿¡æ¯ä¸­å—¯å¯ä»¥æŸ¥çœ‹</td></tr><tr><td>RUN</td><td>æ‰§è¡Œå‘½ä»¤</td><td align="left">æ‰§è¡Œä¸€æ®µå‘½ä»¤ é»˜è®¤æ˜¯<code>/bin/sh</code> æ ¼å¼ï¼š<code>RUN command</code> æˆ–è€… <code>RUN [&quot;command&quot;,&quot;param1&quot;,&quot;param2&quot;]</code></td></tr><tr><td>CMD</td><td>å®¹å™¨å¯åŠ¨å‘½ä»¤</td><td align="left">æä¾›å¯åŠ¨å®¹å™¨æ—¶å€™çš„é»˜è®¤å‘½ä»¤å’ŒENTRYPOINTé…åˆä½¿ç”¨ã€‚æ ¼å¼ï¼š<code>CMD command param1 param2</code>æˆ–è€…<code>CMD [&quot;command&quot;,&quot;param1&quot;,&quot;param2&quot;]</code></td></tr><tr><td>ENTRYPOINT</td><td>å…¥å£</td><td align="left">ä¸€èˆ¬åœ¨åˆ¶ä½œä¸€äº›æ‰§è¡Œå°±å…³é—­çš„å®¹å™¨ä¸­ä¼šä½¿ç”¨</td></tr><tr><td>COPY</td><td>å¤åˆ¶æ–‡ä»¶</td><td align="left">build çš„æ—¶å€™å¤åˆ¶æ–‡ä»¶åˆ°imageä¸­</td></tr><tr><td>ADD</td><td>æ·»åŠ æ–‡ä»¶</td><td align="left">build çš„æ—¶å€™æ·»åŠ æ–‡ä»¶åˆ°iamge ä¸­ï¼Œä¸ä»…ä»…å±€é™äºå½“å‰build ä¸Šä¸‹æ–‡ å¯ä»¥æ¥æºäºè¿œç¨‹æœåŠ¡</td></tr><tr><td>ENV</td><td>ç¯å¢ƒå˜é‡</td><td align="left">æŒ‡å®šbuild æ—¶å€™çš„ç¯å¢ƒå˜é‡ å¯ä»¥åœ¨å¯åŠ¨å®¹å™¨çš„æ—¶å€™ é€šè¿‡<code>-e</code>è¦†ç›–  æ ¼å¼ï¼š<code>ENV name = value</code></td></tr><tr><td>ARG</td><td>æ„å»ºå‚æ•°</td><td align="left">æ„å»ºå‚æ•° åªåœ¨æ„å»ºçš„æ—¶å€™ä½¿ç”¨å‚æ—¶ å¦‚æœæœ‰ENV é‚£ä¹ˆENV çš„ç›¸åŒåå­—çš„å€¼å§‹ç»ˆè¦†ç›–ARG çš„å€¼</td></tr><tr><td>VOLUME</td><td>å®šä¹‰å¤–éƒ¨å¯ä»¥æŒ‚è½½çš„æ•°æ®å·</td><td align="left">æŒ‡å®šbuild çš„image é‚£äº›ç›®å½•å¯ä»¥å¯åŠ¨çš„æ—¶å€™æŒ‚è½½åˆ°æ–‡ä»¶ç³»ç»Ÿä¸­ å¯åŠ¨å®¹å™¨çš„æ—¶å€™ä½¿ç”¨<code>-v</code>ç»‘å®š æ ¼å¼ï¼š<code>VOLUME [&quot;ç›®å½•&quot;]</code></td></tr><tr><td>EXPOSE</td><td>æš´éœ²ç«¯å£</td><td align="left">å®šä¹‰å®¹å™¨è¿è¡Œçš„æ—¶å€™ç›‘å¬çš„ç«¯å£ å¯åŠ¨å®¹å™¨çš„ä½¿ç”¨<code>-p</code>æ¥ç»‘å®šæš´éœ²ç«¯å£ æ ¼å¼ï¼š<code>EXPOSE 8080</code>æˆ–è€…<code>EXPOSE 8080/udp</code></td></tr><tr><td>WORKDIR</td><td>å·¥ä½œç›®å½•</td><td align="left">æŒ‡å®šå®¹å™¨å†…éƒ¨çš„å·¥ä½œç›®å½• å¦‚æœæ²¡æœ‰åˆ›å»ºåˆ™è‡ªåŠ¨åˆ›å»º å¦‚æœæŒ‡å®š&#x2F;ä½¿ç”¨æ˜¯ç»å¯¹åœ°å€ å¦‚æœä¸æ˜¯&#x2F;å¼€å¤´é‚£ä¹ˆå®åœ¨ä¸Šä¸€æ¡workdir çš„è·¯å¾„çš„ç›¸å¯¹è·¯å¾„</td></tr><tr><td>USER</td><td>æŒ‡å®šæ‰§è¡Œç”¨æˆ·</td><td align="left">æŒ‡å®šbuild æˆ–è€…å¯åŠ¨çš„æ—¶å€™ ç”¨æˆ· åœ¨RUN CMD ENTRYPOINTæ‰§è¡Œçš„æ—¶å€™çš„ç”¨æˆ·</td></tr><tr><td>HEALTHCHECK</td><td>å¥åº·æ£€æŸ¥</td><td align="left">æŒ‡å®šç›‘æµ‹å½“å‰å®¹å™¨çš„å¥åº·æµ‹è¯•çš„å‘½ä»¤ åŸºæœ¬ä¸Šæ²¡æœ‰ å› ä¸ºå¾ˆå¤šæ—¶å€™ åº”ç”¨æœ¬èº«ç”±å¥åº·ç›‘æµ‹æœºåˆ¶</td></tr><tr><td>ONBUILD</td><td>è§¦å‘å™¨</td><td align="left">å½“å­˜åœ¨ONBUILD å…³é”®å­—çš„é•œåƒä½œä¸ºåŸºç¡€é•œåƒçš„æ—¶å€™ å½“æ‰§è¡ŒFROM å®Œæˆä¹‹å ä¼šæ‰§è¡ŒONBUILDçš„å‘½ä»¤ ä½†æ˜¯ä¸å½±å“å½“å‰é•œåƒ ç”¨å¤„ä¹Ÿä¸æ€ä¹ˆå¤§</td></tr><tr><td>STOPSIGNAL</td><td>å‘é€ä¿¡æ¯é‡åˆ°å®¿ä¸»æœº</td><td align="left">è¯¥STOPSIGNALæŒ‡ä»¤è®¾ç½®å°†å‘é€åˆ°å®¹å™¨çš„ç³»ç»Ÿè°ƒç”¨ä¿¡å·ä»¥é€€å‡º</td></tr><tr><td>SHELL</td><td>æŒ‡å®šæ‰§è¡Œè„šæœ¬çš„shell</td><td align="left">æŒ‡å®šRUN CMD ENTRYPOINT æ‰§è¡Œå‘½ä»¤çš„æ—¶å€™ ä½¿ç”¨çš„shell</td></tr></tbody></table><h3 id="5-4-æ¡ˆä¾‹"><a href="#5-4-æ¡ˆä¾‹" class="headerlink" title="5.4 æ¡ˆä¾‹"></a>5.4 æ¡ˆä¾‹</h3><h4 id="5-4-1-æ¡ˆä¾‹ä¸€"><a href="#5-4-1-æ¡ˆä¾‹ä¸€" class="headerlink" title="5.4.1 æ¡ˆä¾‹ä¸€"></a>5.4.1 æ¡ˆä¾‹ä¸€</h4><p>éœ€æ±‚ï¼š</p><p>â€‹    è‡ªå®šä¹‰CentOS7é•œåƒã€‚è¦æ±‚ï¼š</p><ol><li>é»˜è®¤ç™»å½•è·¯å¾„ä¸º<code>/usr</code></li><li>å¯ä»¥ä½¿ç”¨vim</li></ol><p>å®ç°æ­¥éª¤ï¼š</p><ol><li>å®šä¹‰çˆ¶é•œåƒï¼š<code>FROM centos:7</code></li><li>å®šä¹‰ä½œè€…ä¿¡æ¯ï¼š<code>MAINTAINER crisp077 &lt;www.crisp077.xyz&gt;</code></li><li>æ‰§è¡Œå®‰è£…vimå‘½ä»¤ï¼š<code>RUN yum install -y vim</code></li><li>å®šä¹‰é»˜è®¤çš„å·¥ä½œç›®å½•ï¼š<code>WORKDIR /usr</code></li><li>å®šä¹‰å®¹å™¨å¯åŠ¨æ‰§è¡Œçš„å‘½ä»¤ï¼š<code>CMD /bin/bash</code></li></ol><p>åˆ›å»ºä½¿ç”¨dockerfileçš„é•œåƒï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker build -f ./centos_docker -t crisp_centos:1 .<br></code></pre></td></tr></table></figure><h4 id="5-4-2-æ¡ˆä¾‹äºŒ"><a href="#5-4-2-æ¡ˆä¾‹äºŒ" class="headerlink" title="5.4.2 æ¡ˆä¾‹äºŒ"></a>5.4.2 æ¡ˆä¾‹äºŒ</h4><p>éœ€æ±‚ï¼š</p><p>â€‹    å®šä¹‰dockerfileï¼Œå‘å¸ƒspringboot é¡¹ç›®</p><p>å®ç°æ­¥éª¤ï¼š</p><ol><li>å®šä¹‰çˆ¶é•œåƒï¼š<code>FROM java:8</code></li><li>å®šä¹‰ä½œè€…ä¿¡æ¯ï¼š<code>MAINTAINER crisp077 &lt;www.crisp077.xyz&gt;</code></li><li>å°†jaråŒ…æ·»åŠ åˆ°å®¹å™¨ï¼š<code>ADD springboot.jar app.jar</code></li><li>å®šä¹‰å®¹å™¨å¯åŠ¨æ‰§è¡Œçš„å‘½ä»¤ï¼š<code>CMD java -jar app.jar</code></li><li>é€šè¿‡dockerfile æ„å»ºé•œåƒï¼š<code>docker build -f dockerfileæ–‡ä»¶è·¯å¾„ -t é•œåƒåç§°:ç‰ˆæœ¬</code></li></ol><h1 id="å…­ã€docker-compose-ï¼ˆç®€å•ä»‹ç»ï¼‰"><a href="#å…­ã€docker-compose-ï¼ˆç®€å•ä»‹ç»ï¼‰" class="headerlink" title="å…­ã€docker compose ï¼ˆç®€å•ä»‹ç»ï¼‰"></a>å…­ã€docker compose ï¼ˆç®€å•ä»‹ç»ï¼‰</h1><h2 id="6-1-æœåŠ¡ç¼–æ’çš„æ¦‚å¿µ"><a href="#6-1-æœåŠ¡ç¼–æ’çš„æ¦‚å¿µ" class="headerlink" title="6.1 æœåŠ¡ç¼–æ’çš„æ¦‚å¿µ"></a>6.1 æœåŠ¡ç¼–æ’çš„æ¦‚å¿µ</h2><p>â€‹    å¾®æœåŠ¡æ¶æ„çš„åº”ç”¨ç³»ç»Ÿä¸­ä¸€èˆ¬åŒ…å«è‹¥å¹²ä¸ªå¾®æœåŠ¡ï¼Œæ¯ä¸ªå¾®æœåŠ¡éƒ½ä¼šéƒ¨ç½²å¤šä¸ªå®ä¾‹ï¼Œå¦‚æœæ¯ä¸ªå¾®æœåŠ¡éƒ½è¦æ‰‹åŠ¨å¯åŠ¨ï¼Œç»´æŠ¤å·¥ä½œé‡ä¼šå¾ˆå¤§</p><ul><li>è¦ä»Dockerfile build image æˆ–è€…å» dockerhub æ‹‰å–image</li><li>è¦åˆ›å»ºå¤šä¸ªcontainer</li><li>è¦ç®¡ç†è¿™äº›containerï¼ˆå¯åŠ¨åœæ­¢åˆ é™¤ï¼‰</li></ul><p><strong>æœåŠ¡ç¼–æ’ï¼š</strong></p><p>â€‹    æŒ‰ç…§ä¸€å®šçš„ä¸šåŠ¡è§„åˆ™æ‰¹é‡ç®¡ç†å®¹å™¨</p><h2 id="6-2-Dockers-Compose-æ¦‚è¿°"><a href="#6-2-Dockers-Compose-æ¦‚è¿°" class="headerlink" title="6.2 Dockers Compose æ¦‚è¿°"></a>6.2 Dockers Compose æ¦‚è¿°</h2><p>â€‹    Docker Compose æ˜¯ä¸€ä¸ªç¼–æ’å¤šå®¹å™¨åˆ†å¸ƒå¼éƒ¨ç½²çš„å·¥å…·ï¼Œæä¾›å‘½ä»¤é›†ç®¡ç†å™¨åŒ–åº”ç”¨çš„å®Œæ•´å¼€å‘æœŸï¼ŒåŒ…æ‹¬æœåŠ¡æ„å»ºï¼Œå¯åŠ¨å’Œåœæ­¢ã€‚ä½¿ç”¨æ­¥éª¤ï¼š</p><ol><li>åˆ©ç”¨ Dockerfile å®šä¹‰è¿è¡Œç¯å¢ƒé•œåƒ</li><li>ä½¿ç”¨ docker-compose.yml å®šä¹‰ç»„æˆåº”ç”¨çš„å„æœåŠ¡</li><li>è¿è¡Œ docker-compose up å¯åŠ¨åº”ç”¨</li></ol><h5 id="6-2-1-å®‰è£…Docker-Compose"><a href="#6-2-1-å®‰è£…Docker-Compose" class="headerlink" title="6.2.1 å®‰è£…Docker Compose"></a>6.2.1 å®‰è£…Docker Compose</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">Compose ç›®å‰å·²ç»å®Œå…¨æ”¯æŒLinuxã€MAC OSã€Windowsï¼Œåœ¨å®‰è£…Composeä¹‹å‰ï¼Œéœ€è¦å…ˆå®‰è£…Dockerã€‚ä¸‹é¢ä»¥ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶åŒ…æ–¹å¼å®‰è£…åœ¨Linuxä¸­</span><br>curl -L &quot;https://github.com/docker/compose/releases/download/1.29.2/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose<br><span class="hljs-meta prompt_">#</span><span class="language-bash">è®¾ç½®æ–‡ä»¶å¯æ‰§è¡Œæƒé™</span><br>chmod +x /usr/local/bin/docker-compose<br><span class="hljs-meta prompt_">#</span><span class="language-bash">æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯</span><br>docker-compose -version<br></code></pre></td></tr></table></figure><h5 id="6-2-2-å¸è½½Docker-Compose"><a href="#6-2-2-å¸è½½Docker-Compose" class="headerlink" title="6.2.2 å¸è½½Docker Compose"></a>6.2.2 å¸è½½Docker Compose</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">äºŒè¿›åˆ¶åŒ…æ–¹å¼å®‰è£…çš„ï¼Œåˆ é™¤äºŒè¿›åˆ¶æ–‡ä»¶å³å¯</span><br>rm /usr/local/bin/docker-compose<br></code></pre></td></tr></table></figure><h2 id="6-3-æ¡ˆä¾‹"><a href="#6-3-æ¡ˆä¾‹" class="headerlink" title="6.3 æ¡ˆä¾‹"></a>6.3 æ¡ˆä¾‹</h2><p><strong>ä½¿ç”¨docker composeç¼–æ’nginx+springbooté¡¹ç›®</strong></p><ol><li><p>åˆ›å»ºdocker-composeç›®å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir ~/docker-compose<br>cd ~/docker-compose<br></code></pre></td></tr></table></figure></li><li><p>ç¼–å†™<code>docker-compose.yml</code>æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs shell">version: &#x27;3&#x27;<br>services:<br>  nginx:<br>   iamge: nginx<br>   ports:<br>    - 80:80<br>   links:<br>    - app<br>   volumes:<br>       - ./nginx/conf.d:/etc/nginx/conf.d<br>   app:<br>     image: app<br>     expose:<br>       - &quot;8080&quot;<br></code></pre></td></tr></table></figure></li><li><p>åˆ›å»º<code>./nginx/conf.d</code>ç›®å½•</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">mkdir -p ./nginx/conf.d<br></code></pre></td></tr></table></figure></li><li><p>åœ¨<code>./nginx/conf.d</code>ç›®å½•ä¸‹ç¼–å†™<code>crisp.conf</code>æ–‡ä»¶</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell">server &#123;<br>    listen 80;<br>    acess_log off;<br><br>    location / &#123;<br>        proxy_pass https://app:8080;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>åœ¨<code>~/docker-compose</code>ç›®å½•ä¸‹ ä½¿ç”¨dockers-compose å¯åŠ¨å®¹å™¨</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker-compose up<br></code></pre></td></tr></table></figure></li><li><p>æµ‹è¯•è®¿é—®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">http://192.168.187.129/hello<br></code></pre></td></tr></table></figure></li></ol><h2 id="6-4-docker-composeä»‹ç»ã€æ–°ã€‘"><a href="#6-4-docker-composeä»‹ç»ã€æ–°ã€‘" class="headerlink" title="6.4 docker composeä»‹ç»ã€æ–°ã€‘"></a>6.4 docker composeä»‹ç»ã€æ–°ã€‘</h2><p>docker compose æœ€å¼€å§‹æ˜¯ä¸€ä¸ªæ’ä»¶ï¼Œåæ¥å®˜æ–¹é‡‡çº³äº†è¿™ä¸ªå¼€å‘è€…å¼€å‘çš„å¼€æºæ’ä»¶</p><ol><li>ç”¨äºå®šä¹‰å’Œè¿è¡Œå¤šå®¹å™¨docker åº”ç”¨ç¨‹åºçš„å·¥å…·ï¼Œå®ƒä½¿ç”¨YAMLæ–‡ä»¶æ¥é…ç½®åº”ç”¨ç¨‹åºçš„æœåŠ¡ã€ç½‘ç»œå’Œæ•°æ®å·ç­‰ç»„ä»¶ï¼Œå¹¶é€šè¿‡ä¸€äº›ç®€å•çš„å‘½ä»¤æä¾›ä¸€ç§ç»Ÿä¸€çš„æ–¹å¼æ¥ç®¡ç†å’Œæ“ä½œè¿™äº›å®¹å™¨</li><li>å¤šå®¹å™¨åº”ç”¨ï¼šDocker Composeé€‚ç”¨äºæ„å»ºå’Œç®¡ç†å¤šå®¹å™¨çš„åº”ç”¨ç¨‹åºã€‚ä½ å¯ä»¥åœ¨åŒä¸€ä¸ªComposeæ–‡ä»¶ä¸­å®šä¹‰å’Œç®¡ç†åº”ç”¨ç¨‹åºä¸­çš„å¤šä¸ªæœåŠ¡ï¼Œè¿™äº›æœåŠ¡å¯ä»¥ç›¸äº’é€šä¿¡å’Œåä½œã€‚</li><li>å£°æ˜å¼é…ç½®ï¼šé€šè¿‡ä½¿ç”¨YAMLæ–‡ä»¶æ¥å®šä¹‰Composeé…ç½®ï¼Œä½ å¯ä»¥ä»¥å£°æ˜å¼çš„æ–¹å¼æè¿°åº”ç”¨ç¨‹åºçš„ç»“æ„å’Œé…ç½®ã€‚è¿™ä½¿å¾—é…ç½®æ˜“äºé˜…è¯»ã€ç†è§£å’Œç»´æŠ¤ï¼Œå¹¶ä¸”å¯ä»¥è½»æ¾åœ°é‡ç°æ•´ä¸ªåº”ç”¨ç¨‹åºç¯å¢ƒã€‚</li><li>ç®€åŒ–çš„éƒ¨ç½²å’Œç®¡ç†ï¼šä½¿ç”¨Docker Composeï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€æ¡ç®€å•çš„å‘½ä»¤æ¥å¯åŠ¨ã€åœæ­¢ã€é‡å¯å’Œåˆ é™¤æ•´ä¸ªåº”ç”¨ç¨‹åºã€‚è¿™ä½¿å¾—åº”ç”¨ç¨‹åºçš„éƒ¨ç½²å’Œç®¡ç†å˜å¾—æ›´åŠ ç®€å•å’Œä¸€è‡´ã€‚</li><li>ç½‘ç»œå’Œå·é…ç½®ï¼šDocker Composeå…è®¸ä½ å®šä¹‰åº”ç”¨ç¨‹åºä¸­çš„ç½‘ç»œå’Œå·é…ç½®ã€‚ä½ å¯ä»¥åˆ›å»ºè‡ªå®šä¹‰ç½‘ç»œï¼Œä½¿å¾—Composeä¸­çš„æœåŠ¡å¯ä»¥ç›¸äº’é€šä¿¡ã€‚ä½ è¿˜å¯ä»¥å®šä¹‰å·æŒ‚è½½ï¼Œç”¨äºæŒä¹…åŒ–æ•°æ®æˆ–åœ¨å®¹å™¨ä¹‹é—´å…±äº«æ–‡ä»¶ã€‚</li><li>æ‰©å±•å’Œè¦†ç›–ï¼šComposeé…ç½®æ”¯æŒæ‰©å±•å’Œè¦†ç›–ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥åœ¨ä¸åŒçš„ç¯å¢ƒä¸­ä½¿ç”¨ç›¸åŒçš„Composeæ–‡ä»¶ï¼Œåªéœ€æ ¹æ®éœ€è¦è¦†ç›–æŸäº›é…ç½®ã€‚è¿™ä½¿å¾—åœ¨å¼€å‘ã€æµ‹è¯•å’Œç”Ÿäº§ç¯å¢ƒä¹‹é—´åˆ‡æ¢å˜å¾—æ›´åŠ å®¹æ˜“ã€‚</li></ol><p>æœåŠ¡å®šä¹‰ï¼šä½¿ç”¨Docker Composeï¼Œä½ å¯ä»¥å®šä¹‰åº”ç”¨ç¨‹åºä¸­çš„å„ä¸ªæœåŠ¡ã€‚æ¯ä¸ªæœåŠ¡éƒ½å¯ä»¥ç”±ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨ç»„æˆï¼Œå¯ä»¥è®¾ç½®å®¹å™¨çš„æ˜ åƒã€ç«¯å£æ˜ å°„ã€ç¯å¢ƒå˜é‡ã€å·æŒ‚è½½ç­‰é…ç½®</p><blockquote><p> ç®€å•è¯´å°±æ˜¯ï¼šå°†ä½ çš„æŸä¸ªåº”ç”¨ç¨‹åºæ‰€éœ€è¦çš„æœåŠ¡ï¼Œéƒ½ç¼–æ’åˆ°ä¸€ä¸ªé˜Ÿåˆ—ä¸Šå»ï¼Œé€šè¿‡docker composeæ¥åŒä¸€ç®¡ç†ï¼Œè¿™ä¸ªæ—¶å€™ä½ çš„è¿™ä¸ªcomposeå†…çš„å®¹å™¨éƒ½ä¼šå¤„äºåŒä¸€ä¸ªbridgeæ¡¥ç½‘ç»œä¸‹ï¼Œ</p><p>æä¾›äº†ä¸€ç§ç®€å•ä¸”ä¸€è‡´çš„æ–¹å¼æ¥ç»„ç»‡å’Œæ“ä½œå®¹å™¨åŒ–çš„åº”ç”¨ç¨‹åºï¼Œå¹¶ä½¿å¾—åœ¨ä¸åŒç¯å¢ƒé’Ÿéƒ¨ç½²å’Œè¿è¡Œåº”ç”¨ç¨‹åºå˜å¾—æ›´åŠ å®¹æ˜“</p></blockquote><h3 id="6-1-1-docker-compose-ç›¸å…³å‘½ä»¤"><a href="#6-1-1-docker-compose-ç›¸å…³å‘½ä»¤" class="headerlink" title="6.1.1 docker compose ç›¸å…³å‘½ä»¤"></a>6.1.1 docker compose ç›¸å…³å‘½ä»¤</h3><p>æ„å»ºé•œåƒï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker-compose build<br>```<br>è¿™ä¸ªå‘½ä»¤å°†æ ¹æ®Composeæ–‡ä»¶ä¸­å®šä¹‰çš„æœåŠ¡æ„å»ºé•œåƒã€‚å¦‚æœé•œåƒå·²ç»å­˜åœ¨ï¼Œå®ƒå°†è·³è¿‡æ„å»ºæ­¥éª¤ã€‚<br></code></pre></td></tr></table></figure><p>å¯åŠ¨å®¹å™¨ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker-compose up<br>```<br>è¿™ä¸ªå‘½ä»¤å°†ä½¿ç”¨Composeæ–‡ä»¶å¯åŠ¨å®šä¹‰çš„æœåŠ¡ã€‚å¦‚æœComposeæ–‡ä»¶ä¸å­˜åœ¨ï¼Œå®ƒå°†è‡ªåŠ¨æ„å»ºé•œåƒå¹¶å¯åŠ¨å®¹å™¨ã€‚<br></code></pre></td></tr></table></figure><p>å¯åŠ¨å®¹å™¨ï¼ˆåå°æ¨¡å¼ï¼‰</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker-compose up -d<br>```<br>è¿™ä¸ªå‘½ä»¤å°†ä»¥åå°æ¨¡å¼å¯åŠ¨å®¹å™¨ï¼Œå¹¶å°†è¾“å‡ºé‡å®šå‘åˆ°ç»ˆç«¯ã€‚<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹ComposeæœåŠ¡çŠ¶æ€ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker-compose config<br>```<br>è¿™ä¸ªå‘½ä»¤å°†éªŒè¯Composeæ–‡ä»¶çš„è¯­æ³•å¹¶æ˜¾ç¤ºè§£æåçš„é…ç½®ã€‚<br></code></pre></td></tr></table></figure><p>åœæ­¢å®¹å™¨ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker-compose down<br>```<br>è¿™ä¸ªå‘½ä»¤å°†åœæ­¢å¹¶åˆ é™¤Composeæ–‡ä»¶å®šä¹‰çš„æ‰€æœ‰å®¹å™¨ã€ç½‘ç»œå’Œå·ã€‚<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹Composeæ–‡ä»¶é…ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker-compose config<br>```<br>è¿™ä¸ªå‘½ä»¤å°†éªŒè¯Composeæ–‡ä»¶çš„è¯­æ³•å¹¶æ˜¾ç¤ºè§£æåçš„é…ç½®ã€‚<br></code></pre></td></tr></table></figure><p>æ‰§è¡ŒComposeæœåŠ¡å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">docker-compose exec &lt;service_name&gt; &lt;command&gt;<br>```<br>è¿™ä¸ªå‘½ä»¤å°†åœ¨æŒ‡å®šçš„æœåŠ¡å®¹å™¨ä¸­æ‰§è¡Œç»™å®šçš„å‘½ä»¤ã€‚<br></code></pre></td></tr></table></figure><p>æŸ¥çœ‹ComposeæœåŠ¡æ—¥å¿—ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹Composeçš„æœåŠ¡æ—¥å¿—ï¼š</span><br>docker-compose logs<br>```<br>è¿™ä¸ªå‘½ä»¤å°†æ˜¾ç¤ºComposeæ–‡ä»¶ä¸­å®šä¹‰çš„æ‰€æœ‰æœåŠ¡çš„æ—¥å¿—è¾“å‡ºã€‚<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹Composeçš„å®æ—¶æ—¥å¿—ï¼š</span><br>docker-compose logs -f<br>```<br>è¿™ä¸ªå‘½ä»¤å°†ä»¥å®æ—¶æ–¹å¼æ˜¾ç¤ºComposeæ–‡ä»¶ä¸­å®šä¹‰çš„æ‰€æœ‰æœåŠ¡çš„æ—¥å¿—è¾“å‡ºã€‚ä½ å¯ä»¥é€šè¿‡æŒ‰ä¸‹`Ctrl + C`æ¥åœæ­¢å®æ—¶æ—¥å¿—è¾“å‡ºã€‚<br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹ç‰¹å®šæœåŠ¡çš„æ—¥å¿—</span><br>docker-compose logs &lt;service_name&gt;<br>```<br>è¿™ä¸ªå‘½ä»¤å°†æ˜¾ç¤ºæŒ‡å®šæœåŠ¡çš„æ—¥å¿—è¾“å‡ºã€‚ä½ å¯ä»¥æ›¿æ¢`&lt;service_name&gt;`ä¸ºComposeæ–‡ä»¶ä¸­å®šä¹‰çš„æœåŠ¡åç§°ã€‚<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">æŸ¥çœ‹æŒ‡å®šæœåŠ¡çš„å®æ—¶æ—¥å¿—ï¼š</span><br>docker-compose logs -f &lt;service_name&gt;<br>```<br>è¿™ä¸ªå‘½ä»¤å°†ä»¥å®æ—¶æ–¹å¼æ˜¾ç¤ºæŒ‡å®šæœåŠ¡çš„æ—¥å¿—è¾“å‡ºã€‚ä½ å¯ä»¥æ›¿æ¢`&lt;service_name&gt;`ä¸ºComposeæ–‡ä»¶ä¸­å®šä¹‰çš„æœåŠ¡åç§°ã€‚<br></code></pre></td></tr></table></figure><h2 id="6-2-Kubernetes-K8S-ç®€å•ä»‹ç»"><a href="#6-2-Kubernetes-K8S-ç®€å•ä»‹ç»" class="headerlink" title="6.2 Kubernetes(K8S)ç®€å•ä»‹ç»"></a>6.2 Kubernetes(K8S)ç®€å•ä»‹ç»</h2><blockquote><p>å¼€å‘åªè´Ÿè´£å¼€å‘ï¼ˆæ‹”æ‰å¼€å‘çš„ç½‘çº¿ï¼‰ï¼Œå…¶ä»–æ‚ä¸ƒæ‚å…«çš„æœåŠ¡æœ‰è¿ç»´é€šè¿‡K8Sç»Ÿä¸€ç®¡ç†</p><p>æ¯”å¦‚è¯´ï¼šå¼€å‘è¿æ¥æ•°æ®åº“æŸ¥è¯¢æ•°æ®ï¼šåªè´Ÿè´£127.0.0.1æœ¬åœ°è¿æ¥å³å¯ï¼Œè¿ç»´ä¼šåœ¨è·¯ç”±é‚£é‡Œç»Ÿä¸€é…ç½®</p></blockquote><h3 id="6-2-2-Kubernetesä»‹ç»"><a href="#6-2-2-Kubernetesä»‹ç»" class="headerlink" title="6.2.2 Kubernetesä»‹ç»"></a>6.2.2 Kubernetesä»‹ç»</h3><p>Kubernetesï¼ˆé€šå¸¸ç®€ç§°ä¸ºK8sï¼‰æ˜¯ä¸€ä¸ªå¼€æºçš„å®¹å™¨ç¼–æ’å¹³å°ï¼Œç”¨äºè‡ªåŠ¨åŒ–éƒ¨ç½²ã€æ‰©å±•å’Œç®¡ç†å®¹å™¨åŒ–åº”ç”¨ç¨‹åºã€‚å®ƒæä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·é›†ï¼Œç”¨äºç®¡ç†å’Œç¼–æ’å®¹å™¨åŒ–åº”ç”¨ç¨‹åºçš„å„ä¸ªæ–¹é¢ï¼Œå¦‚éƒ¨ç½²ã€æ‰©ç¼©å®¹ã€è´Ÿè½½å‡è¡¡ã€æœåŠ¡å‘ç°ã€è‡ªæ„ˆæ€§ç­‰ã€‚</p><p>ä»¥ä¸‹æ˜¯ç½‘ä¸ŠæŠ„çš„Kubernetesçš„ä¸€äº›å…³é”®æ¦‚å¿µå’Œç‰¹ç‚¹ï¼š</p><ol><li>å®¹å™¨ç¼–æ’ï¼šKubernetesè®¾è®¡ç”¨äºç®¡ç†å®¹å™¨åŒ–åº”ç”¨ç¨‹åºã€‚å®ƒå¯ä»¥è‡ªåŠ¨éƒ¨ç½²å’Œç®¡ç†å®¹å™¨ï¼Œç¡®ä¿å®ƒä»¬åœ¨é›†ç¾¤ä¸­æ­£ç¡®è¿è¡Œï¼Œå¹¶æ ¹æ®éœ€è¦è¿›è¡Œæ‰©å±•å’Œæ”¶ç¼©ã€‚</li><li>é«˜å¯ç”¨æ€§ï¼šKubernetesæä¾›é«˜å¯ç”¨æ€§çš„æ¶æ„ï¼Œé€šè¿‡åœ¨é›†ç¾¤ä¸­çš„å¤šä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œå®¹å™¨å‰¯æœ¬ï¼Œå¹¶è‡ªåŠ¨é‡æ–°è°ƒåº¦æ•…éšœå®¹å™¨ï¼Œç¡®ä¿åº”ç”¨ç¨‹åºçš„å¯ç”¨æ€§ã€‚</li><li>è‡ªåŠ¨åŒ–æ‰©ç¼©å®¹ï¼šKuberneteså…è®¸æ ¹æ®åº”ç”¨ç¨‹åºçš„è´Ÿè½½æƒ…å†µè‡ªåŠ¨æ‰©å±•æˆ–æ”¶ç¼©å®¹å™¨çš„æ•°é‡ã€‚è¿™æ ·ï¼Œä½ å¯ä»¥æ ¹æ®éœ€æ±‚å¿«é€Ÿé€‚åº”æµé‡å˜åŒ–ï¼Œæé«˜åº”ç”¨ç¨‹åºçš„å¼¹æ€§å’Œæ€§èƒ½ã€‚</li><li>æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ï¼šKubernetesæä¾›å†…å»ºçš„æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡æœºåˆ¶ã€‚å®ƒå¯ä»¥è‡ªåŠ¨åˆ†é…ç¨³å®šçš„ç½‘ç»œåœ°å€ç»™å®¹å™¨ï¼Œå¹¶å°†æµé‡å‡åŒ€åˆ†å‘åˆ°åç«¯æœåŠ¡ï¼Œç¡®ä¿åº”ç”¨ç¨‹åºçš„å¯è®¿é—®æ€§å’Œé«˜å¯ç”¨æ€§ã€‚</li><li>çŠ¶æ€ç®¡ç†ï¼šKuberneteså…è®¸ä½ å£°æ˜æ€§åœ°å®šä¹‰åº”ç”¨ç¨‹åºçš„çŠ¶æ€å’Œè¦æ±‚ã€‚å®ƒå¯ä»¥ç®¡ç†åº”ç”¨ç¨‹åºçš„éƒ¨ç½²ã€æ›´æ–°å’Œå›æ»šæ“ä½œï¼Œç¡®ä¿åº”ç”¨ç¨‹åºæŒ‰ç…§é¢„æœŸè¿è¡Œã€‚</li><li>é…ç½®å’Œå­˜å‚¨ç®¡ç†ï¼šKubernetesæä¾›é…ç½®ç®¡ç†å’Œå­˜å‚¨ç®¡ç†åŠŸèƒ½ã€‚å®ƒå¯ä»¥ç®¡ç†åº”ç”¨ç¨‹åºçš„é…ç½®æ–‡ä»¶å’Œæ•æ„Ÿä¿¡æ¯ï¼Œå¹¶æ”¯æŒå„ç§å­˜å‚¨é€‰é¡¹ï¼Œå¦‚æŒä¹…å·å’Œåˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿã€‚</li><li>å¥åº·æ£€æŸ¥å’Œè‡ªæ„ˆæ€§ï¼šKuberneteså¯ä»¥å¯¹å®¹å™¨è¿›è¡Œå¥åº·æ£€æŸ¥ï¼Œå¹¶åœ¨å®¹å™¨å‡ºç°æ•…éšœæ—¶è‡ªåŠ¨é‡æ–°è°ƒåº¦æˆ–æ›¿æ¢å®ƒä»¬ã€‚è¿™æé«˜äº†åº”ç”¨ç¨‹åºçš„å¯é æ€§å’Œç¨³å®šæ€§ã€‚</li><li>æ’ä»¶ç”Ÿæ€ç³»ç»Ÿï¼šKubernetesæ‹¥æœ‰ä¸°å¯Œçš„æ’ä»¶ç”Ÿæ€ç³»ç»Ÿï¼Œæ”¯æŒå„ç§åŠŸèƒ½å’Œæ‰©å±•ï¼Œå¦‚æ—¥å¿—ç®¡ç†ã€ç›‘æ§ã€å®‰å…¨æ€§ã€ç½‘ç»œç­–ç•¥ç­‰ã€‚</li></ol><p>é€šè¿‡ä½¿ç”¨Kubernetesï¼Œä½ å¯ä»¥æ›´æ–¹ä¾¿åœ°ç®¡ç†å’Œæ‰©å±•å®¹å™¨åŒ–åº”ç”¨ç¨‹åºï¼Œæé«˜åº”ç”¨ç¨‹åºçš„å¯é æ€§å’Œå¼¹æ€§ã€‚å®ƒæä¾›äº†ä¸€ä¸ªç»Ÿä¸€çš„å¹³å°ï¼Œç”¨äºè‡ªåŠ¨åŒ–ç®¡ç†å®¹å™¨çš„å„ä¸ªæ–¹é¢ï¼Œå¹¶æ”¯æŒåœ¨å¤šäº‘ã€æ··åˆäº‘å’Œæœ¬åœ°ç¯å¢ƒä¸­çš„éƒ¨ç½²ã€‚+</p><h1 id="ä¸ƒã€Docker-ç§æœ‰ä»“åº“ã€æœªå®Œå¾…ç»­ã€‘"><a href="#ä¸ƒã€Docker-ç§æœ‰ä»“åº“ã€æœªå®Œå¾…ç»­ã€‘" class="headerlink" title="ä¸ƒã€Docker ç§æœ‰ä»“åº“ã€æœªå®Œå¾…ç»­ã€‘"></a>ä¸ƒã€Docker ç§æœ‰ä»“åº“ã€æœªå®Œå¾…ç»­ã€‘</h1><p>â€¦â€¦â€¦â€¦â€¦â€¦</p><p><img src="/../img/unsplash(1).jpg" alt="images1"></p>]]></content>
    
    
    <categories>
      
      <category>other</category>
      
    </categories>
    
    
    <tags>
      
      <tag>other</tag>
      
      <tag>docker</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€pythonã€‘è¯»ä¹¦ç¬”è®°ä¹‹ç¼–ç¨‹æœ¯è¯­ï¼ˆä¸ƒï¼‰</title>
    <link href="/2024/01/07/617python%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8B%E7%BC%96%E7%A8%8B%E6%9C%AF%E8%AF%AD%EF%BC%88%E4%B8%83%EF%BC%89/"/>
    <url>/2024/01/07/617python%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8B%E7%BC%96%E7%A8%8B%E6%9C%AF%E8%AF%AD%EF%BC%88%E4%B8%83%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬-7-ç« -ç¼–ç¨‹æœ¯è¯­"><a href="#ç¬¬-7-ç« -ç¼–ç¨‹æœ¯è¯­" class="headerlink" title="ç¬¬ 7 ç« ã€€ç¼–ç¨‹æœ¯è¯­"></a>ç¬¬ 7 ç« ã€€ç¼–ç¨‹æœ¯è¯­</h1><h3 id="7-1-1-ä½œä¸ºè¯­è¨€çš„Pythonå’Œä½œä¸ºè§£é‡Šå™¨çš„Python"><a href="#7-1-1-ä½œä¸ºè¯­è¨€çš„Pythonå’Œä½œä¸ºè§£é‡Šå™¨çš„Python" class="headerlink" title="7.1.1ã€€ä½œä¸ºè¯­è¨€çš„Pythonå’Œä½œä¸ºè§£é‡Šå™¨çš„Python"></a>7.1.1ã€€ä½œä¸ºè¯­è¨€çš„Pythonå’Œä½œä¸ºè§£é‡Šå™¨çš„Python</h3><p>Pythonè¿™ä¸ªè¯æœ‰å¾ˆå¤šå«ä¹‰ã€‚Pythonç¼–ç¨‹è¯­è¨€çš„åå­—æ¥è‡ªäºè‹±å›½å–œå‰§å›¢ä½“Monty Pythonï¼Œè€Œä¸æ˜¯â€œèŸ’è›‡â€ï¼ˆå°½ç®¡å¸‚é¢ä¸Šçš„Pythonæ•™ç¨‹å’Œæ–‡æ¡£æœ‰ç”¨â€œèŸ’è›‡â€æ¥è¿›è¡Œè§£é‡Šçš„ï¼‰ã€‚åŒæ ·ï¼ŒPythonåœ¨è®¡ç®—æœºç¼–ç¨‹æ–¹é¢ä¹Ÿæœ‰ä¸¤ç§å«ä¹‰ã€‚</p><p>æˆ‘ä»¬è¯´â€œPythonè¿è¡Œä¸€ä¸ªç¨‹åºâ€æˆ–è€…â€œPythonå°†æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸â€æ—¶ï¼Œæˆ‘ä»¬æ˜¯åœ¨è°ˆè®ºPythonè§£é‡Šå™¨â€”â€”å®ƒæ˜¯çœŸå®å­˜åœ¨çš„è½¯ä»¶ï¼Œç”¨æ¥è¯»å–.pyæ–‡ä»¶çš„æ–‡æœ¬å¹¶æ‰§è¡ŒæŒ‡ä»¤ã€‚å½“æˆ‘ä»¬è¯´â€œPythonè§£é‡Šå™¨â€æ—¶ï¼Œç»å¤§å¤šæ•°æƒ…å†µä¸‹æ˜¯æŒ‡CPythonï¼Œå®ƒæ˜¯ç”±Pythonè½¯ä»¶åŸºé‡‘ä¼šç»´æŠ¤çš„Pythonè§£é‡Šå™¨ï¼Œå¯ä»¥åœ¨Pythonå®˜ç½‘ä¸Šæ‰¾åˆ°ã€‚CPythonæ˜¯Pythonè¯­è¨€çš„ä¸€ä¸ªå®ç°ï¼Œæ¢è¨€ä¹‹ï¼Œå®ƒæ˜¯æŒ‰ç…§Pythonè¯­è¨€è§„èŒƒå®ç°çš„è½¯ä»¶ï¼Œä½†Pythonå¹¶éä»…æ­¤ä¸€ç§å®ç°ã€‚CPythonæ˜¯ç”¨Cè¯­è¨€ç¼–å†™çš„ï¼ŒJythonåˆ™æ˜¯ç”¨Javaç¼–å†™çš„ï¼Œç”¨äºè¿è¡Œå’ŒJavaç¨‹åºäº¤äº’çš„Pythonè„šæœ¬ã€‚PyPyæ˜¯ç”¨Pythonè¯­è¨€ç¼–å†™çš„1ï¼Œå®ƒæ˜¯åœ¨ç¨‹åºæ‰§è¡Œæ—¶è¿›è¡Œå³æ—¶ç¼–è¯‘çš„ç¼–è¯‘å™¨ã€‚</p><p>1ç”¨ä¸€ç§è¯­è¨€æœ¬èº«ç¼–å†™è¯¥è¯­è¨€çš„è§£é‡Šå™¨æˆ–ç¼–è¯‘å™¨ç§°ä¸ºè‡ªä¸¾ã€‚â€”â€”è¯‘è€…æ³¨</p><p>æ‰€æœ‰è¿™äº›å®ç°éƒ½èƒ½è¿è¡Œç”¨Pythonç¼–ç¨‹è¯­è¨€ç¼–å†™çš„æºä»£ç ã€‚å½“æåŠâ€œè¿™æ˜¯ä¸€ä¸ªPythonç¨‹åºâ€æˆ–è€…â€œæˆ‘æ­£åœ¨å­¦ä¹ Pythonâ€æ—¶ï¼Œå…¶ä¸­çš„Pythonå°±æ˜¯æŒ‡Pythonç¼–ç¨‹è¯­è¨€ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œç”¨Pythonè¯­è¨€ç¼–å†™çš„ä»»ä½•æºä»£ç éƒ½åº”è¯¥èƒ½è¢«ä»»ä½•Pythonè§£é‡Šå™¨è¿è¡Œï¼Œä½†å®é™…ä¸Šï¼Œè§£é‡Šå™¨ä¹‹é—´ä¼šæœ‰ä¸€äº›å°çš„ä¸å…¼å®¹é—®é¢˜å’Œç»†å¾®å·®å¼‚ã€‚CPythonè¢«ç§°ä¸ºPythonè¯­è¨€çš„å‚è€ƒå®ç°ï¼Œå¦‚æœå…¶ä»–è§£é‡Šå™¨åœ¨è§£é‡ŠPythonä»£ç æ—¶è·ŸCPythonå­˜åœ¨å·®å¼‚ï¼Œé‚£ä¹ˆä¸€èˆ¬è®¤ä¸ºCPythonçš„è¡Œä¸ºæ˜¯åˆè§„å’Œæ­£ç¡®çš„ã€‚</p><h3 id="7-1-2-åƒåœ¾å›æ”¶"><a href="#7-1-2-åƒåœ¾å›æ”¶" class="headerlink" title="7.1.2ã€€åƒåœ¾å›æ”¶"></a>7.1.2ã€€åƒåœ¾å›æ”¶</h3><p>Pythonä½¿ç”¨<strong>åƒåœ¾å›æ”¶</strong>æœºåˆ¶é¿å…æ­¤ç±»é”™è¯¯ï¼Œè¿™æ˜¯ä¸€ç§å†…å­˜è‡ªåŠ¨ç®¡ç†æ–¹å¼ï¼Œå®ƒæŒç»­è·Ÿè¸ªå’Œåˆ¤æ–­å†…å­˜åº”è¯¥ä½•æ—¶åˆ†é…å’Œé‡Šæ”¾ï¼Œç¨‹åºå‘˜ä¸å†ä¸ºæ­¤è´¹åŠ›ã€‚åƒåœ¾å›æ”¶å°±æ˜¯å†…å­˜çš„å›æ”¶ï¼Œå®ƒçš„ä½œç”¨æ˜¯é‡Šæ”¾å†…å­˜ï¼Œè®©æ–°æ•°æ®ä½¿ç”¨ã€‚</p><h3 id="7-1-5-å¯¹è±¡ã€å€¼ã€å®ä¾‹å’Œèº«ä»½"><a href="#7-1-5-å¯¹è±¡ã€å€¼ã€å®ä¾‹å’Œèº«ä»½" class="headerlink" title="7.1.5ã€€å¯¹è±¡ã€å€¼ã€å®ä¾‹å’Œèº«ä»½"></a>7.1.5ã€€å¯¹è±¡ã€å€¼ã€å®ä¾‹å’Œèº«ä»½</h3><p>ã€€<strong>å¯¹è±¡</strong>æ˜¯ä¸€æ¡æ•°æ®çš„å‘ˆç°ï¼Œæ¯”å¦‚æ•°å­—ã€æ–‡æœ¬ï¼Œæˆ–è€…æ›´å¤æ‚çš„æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚åˆ—è¡¨æˆ–å­—å…¸ã€‚æ‰€æœ‰å¯¹è±¡éƒ½å¯ä»¥å­˜å‚¨åœ¨å˜é‡ä¸­ï¼Œä½œä¸ºå‚æ•°ä¼ é€’ç»™å‡½æ•°è°ƒç”¨å¹¶ä½œä¸ºå‡½æ•°è°ƒç”¨çš„è¿”å›å†…å®¹ã€‚</p><p>ã€€ã€€æ¯ä¸ªå¯¹è±¡éƒ½æœ‰è‡ªå·±çš„å€¼ã€èº«ä»½å’Œæ•°æ®ç±»å‹ã€‚<strong>å€¼</strong>æ˜¯å¯¹è±¡æ‰€ä»£è¡¨çš„æ•°æ®ï¼Œæ¯”å¦‚æ•´æ•°<code>42</code>æˆ–è€…å­—ç¬¦ä¸²<code>&#39;hello&#39;</code>ã€‚è™½ç„¶è¿™æœ‰äº›ä»¤äººå›°æƒ‘ï¼Œä½†æœ‰äº›ç¨‹åºå‘˜ä½¿ç”¨æœ¯è¯­â€œå€¼â€å½“ä½œâ€œå¯¹è±¡â€çš„åŒä¹‰è¯ï¼Œç‰¹åˆ«æ˜¯å¯¹äºç®€å•çš„æ•°æ®ç±»å‹ï¼Œæ¯”å¦‚æ•´æ•°æˆ–å­—ç¬¦ä¸²ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå¯¹åº”å€¼ä¸º<code>42</code>çš„å˜é‡ï¼Œæ—¢å¯ä»¥è¢«è§£é‡Šä¸ºåŒ…å«æ•´æ•°å€¼42çš„å˜é‡ï¼Œä¹Ÿå¯ä»¥è¢«è§£é‡Šä¸ºåŒ…å«ä¸€ä¸ªå€¼ä¸º42çš„æ•´æ•°å¯¹è±¡çš„å˜é‡ã€‚</p><p><strong>å˜é‡çš„æ¯”å–»ï¼šç›’å­è¿˜æ˜¯æ ‡ç­¾</strong></p><p>è®¸å¤šå…¥é—¨ä¹¦å°†å˜é‡æ¯”å–»ä¸ºä¸€ä¸ªç›’å­ï¼Œè¿™ç§æ¯”å–»å®é™…ä¸Šè¿‡åˆ†ç®€åŒ–äº†é—®é¢˜ã€‚æŠŠå˜é‡çœ‹ä½œå­˜å‚¨æ•°å€¼çš„ç›’å­å¾ˆå®¹æ˜“ç†è§£ï¼Œä½†è¿™ç§æ¯”å–»å¹¶ä¸èƒ½é˜è¿°æ¸…æ¥šå˜é‡å’Œå€¼çš„å¼•ç”¨å…³ç³»ã€‚ä»¥å‰é¢çš„<code>spam</code>å’Œ<code>eggs</code>ä¸ºä¾‹ï¼Œå®ƒä»¬å¹¶ä¸å­˜å‚¨ä¸åŒçš„å­—å…¸ï¼Œè€Œæ˜¯è®¡ç®—æœºå†…å­˜ä¸­åŒä¸€ä¸ªå­—å…¸çš„å¼•ç”¨ã€‚</p><p><strong>è®¸å¤šä¹¦è®¤ä¸ºå¯ä»¥æŠŠå˜é‡è§†ä¸ºåŒ…å«æ•°å€¼çš„ç›’å­</strong></p><p>åœ¨Pythonä¸­ï¼Œæ— è®ºå“ªç§æ•°æ®ç±»å‹çš„å˜é‡ä»æŠ€æœ¯è§’åº¦ä¸Šè®²éƒ½æ˜¯å¯¹å€¼çš„å¼•ç”¨ï¼Œè€Œéå€¼çš„å®¹å™¨ã€‚ç›’å­çš„æ¯”å–»å¾ˆç®€å•æ˜“æ‡‚ï¼Œä½†ä¸å®Œç¾ã€‚ä¸å…¶æŠŠå˜é‡æƒ³è±¡æˆç›’å­ï¼Œä¸å¦‚æŠŠå®ƒæƒ³è±¡æˆå†…å­˜ä¸­å¯¹è±¡çš„æ ‡ç­¾ã€‚</p><p><strong>å˜é‡å¯ä»¥è¢«è§†ä¸ºå€¼çš„æ ‡ç­¾</strong></p><p>å¤šä¸ªå˜é‡å¯ä»¥å¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡ï¼Œåè¿‡æ¥è¯´ï¼Œè¿™ä¸ªå¯¹è±¡è¢«â€œå­˜å‚¨â€åœ¨å¤šä¸ªå˜é‡ä¸­ã€‚è€Œç”¨ç›’å­åšæ¯”å–»ï¼Œæ²¡æ³•è¡¨ç°å¤šä¸ªç›’å­å­˜å‚¨åŒä¸€ä¸ªå¯¹è±¡çš„æƒ…å†µã€‚å› æ­¤ï¼Œæ ‡ç­¾çš„æ¯”å–»å¯èƒ½æ›´å®¹æ˜“ç†è§£</p><p>å¦‚æœä¸ç†è§£<code>=</code>èµ‹å€¼è¿ç®—ç¬¦æ˜¯åœ¨å¤åˆ¶å¼•ç”¨è€Œéå¯¹è±¡æœ¬èº«ï¼Œä½ å¯èƒ½ä¼šå› æ­¤è€ŒçŠ¯é”™ã€‚å¹¸è¿çš„æ˜¯ï¼Œæ•´æ•°ã€å­—ç¬¦ä¸²å’Œå…ƒç»„ä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼Œå…·ä½“åŸå› è¯¦è§7.1.7èŠ‚ã€‚</p><p>ã€€ã€€ä½ å¯ä»¥ä½¿ç”¨<code>is</code>è¿ç®—ç¬¦æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„èº«ä»½æ˜¯å¦ç›¸åŒï¼Œè€Œ<code>==</code>è¿ç®—ç¬¦åªæ£€æŸ¥å®ƒä»¬çš„å€¼æ˜¯å¦ç›¸åŒã€‚<code>x is y</code>å¯è¢«è§†ä¸º<code>id(x) == id(y)</code>çš„ç®€å†™ã€‚åœ¨äº¤äº’å¼shellä¸­ï¼Œå¯ä»¥è¾“å…¥ä»¥ä¸‹å†…å®¹æŸ¥çœ‹<code>is</code>å’Œ<code>==</code>çš„ä¸åŒä¹‹å¤„ï¼š</p><h3 id="7-1-6-é¡¹"><a href="#7-1-6-é¡¹" class="headerlink" title="7.1.6ã€€é¡¹"></a>7.1.6ã€€é¡¹</h3><p>ã€€ã€€åœ¨Pythonä¸­ï¼Œå®¹å™¨å¯¹è±¡ï¼ˆæ¯”å¦‚åˆ—è¡¨æˆ–å­—å…¸ï¼‰ä¸­çš„å­å¯¹è±¡è¢«ç§°ä¸ºâ€œé¡¹â€æˆ–è€…â€œå…ƒç´ â€ã€‚æ¯”å¦‚åˆ—è¡¨<code>[&#39;dog&#39;, &#39;cat&#39;, &#39;moose&#39;]</code>ä¸­çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œä¹Ÿè¢«ç§°ä½œâ€œé¡¹â€ã€‚</p><h3 id="7-1-7-å¯å˜å’Œä¸å¯å˜"><a href="#7-1-7-å¯å˜å’Œä¸å¯å˜" class="headerlink" title="7.1.7ã€€å¯å˜å’Œä¸å¯å˜"></a>7.1.7ã€€å¯å˜å’Œä¸å¯å˜</h3><p><strong>å°½ç®¡å…ƒç»„ä¸­çš„å¯¹è±¡æ˜¯ä¸èƒ½æ”¹å˜çš„ï¼Œå¯¹è±¡æœ¬èº«å´æ˜¯å¯ä»¥æ”¹å˜çš„</strong></p><p>å‡ ä¹æ‰€æœ‰Pythonä¸“å®¶å’Œæˆ‘éƒ½æŠŠå…ƒç»„è§†ä¸ºä¸å¯å˜çš„ã€‚ä½†å®é™…ä¸Šï¼Œæœ‰äº›å…ƒç»„æ˜¯å¦å¯ä»¥ç®—æ˜¯å¯å˜çš„å–å†³äºä½ çš„å®šä¹‰</p><h3 id="7-1-8-ç´¢å¼•ã€é”®å’Œå“ˆå¸Œå€¼"><a href="#7-1-8-ç´¢å¼•ã€é”®å’Œå“ˆå¸Œå€¼" class="headerlink" title="7.1.8ã€€ç´¢å¼•ã€é”®å’Œå“ˆå¸Œå€¼"></a>7.1.8ã€€ç´¢å¼•ã€é”®å’Œå“ˆå¸Œå€¼</h3><p>Pythonçš„åˆ—è¡¨å’Œå­—å…¸æ˜¯ä¸€ç±»å¯ä»¥åŒ…å«å¤šä¸ªå…¶ä»–å€¼çš„å€¼ã€‚ä¸ºäº†è®¿é—®è¿™äº›å­å€¼ï¼Œä½ å¯ä»¥ä½¿ç”¨<strong>ç´¢å¼•è¿ç®—ç¬¦</strong>ï¼Œå®ƒç”±ä¸€å¯¹ä¸­æ‹¬å·ï¼ˆ<code>[ ]</code>ï¼‰å’Œä¸€ä¸ªè¢«ç§°ä¸º<strong>ç´¢å¼•</strong>çš„æ•´æ•°ç»„æˆã€‚ç´¢å¼•ç”¨äºæŒ‡å®šè¦è®¿é—®å“ªä¸ªå€¼ã€‚åœ¨äº¤äº’å¼shellä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼ŒæŸ¥çœ‹ç´¢å¼•æ˜¯å¦‚ä½•åœ¨åˆ—è¡¨ä¸­å·¥ä½œçš„ï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">spam = [<span class="hljs-string">&#x27;cat&#x27;</span>, <span class="hljs-string">&#x27;dog&#x27;</span>, <span class="hljs-string">&#x27;moose&#x27;</span>]</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">spam[<span class="hljs-number">0</span>]</span><br>&#x27;cat&#x27;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">spam[-<span class="hljs-number">2</span>]</span><br>&#x27;dog&#x27;<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ<code>0</code>æ˜¯ç´¢å¼•ã€‚æœ€å°çš„ç´¢å¼•æ˜¯0è€Œä¸æ˜¯1ï¼Œå› ä¸ºPythonï¼ˆä»¥åŠç»å¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€ï¼‰ä½¿ç”¨åŸºäº0çš„ç´¢å¼•æœºåˆ¶ã€‚ä½¿ç”¨åŸºäº1çš„ç´¢å¼•æœºåˆ¶çš„è¯­è¨€å¾ˆå°‘ï¼Œå…¶ä¸­æœ€è‘—åçš„æ˜¯Luaå’ŒRè¯­è¨€ã€‚Pythonè¿˜æ”¯æŒè´Ÿæ•°ç´¢å¼•ï¼Œæ¯”å¦‚<code>-1</code>æŒ‡çš„æ˜¯åˆ—è¡¨çš„æœ€åä¸€é¡¹ï¼Œ<code>-2</code>æŒ‡çš„æ˜¯åˆ—è¡¨çš„å€’æ•°ç¬¬äºŒé¡¹ï¼Œä»¥æ­¤ç±»æ¨ã€‚ä½ å¯ä»¥æŠŠè´Ÿæ•°ç´¢å¼•<code>spam[-n]</code>çœ‹ä½œ<code>spam[len(spam)-n]</code>ã€‚</p><blockquote><p><strong>æ³¨æ„</strong>ã€€è®¡ç®—æœºç§‘å­¦å®¶ã€æ­Œæ‰‹ã€è¯æ›²ä½œè€…Stan Kelly-Bootleæ›¾å¼€ç©ç¬‘è¯´ï¼šâ€œæ•°ç»„ç´¢å¼•åº”è¯¥ä»0å¼€å§‹è¿˜æ˜¯ä»1å¼€å§‹å‘¢ï¼Ÿæˆ‘æè®®çš„å¦¥åæ–¹æ¡ˆæ˜¯0.5ï¼Œå¯æƒœä»–ä»¬æœªäºˆè®¤çœŸè€ƒè™‘ä¾¿ä¸€å£å›ç»äº†ã€‚â€</p></blockquote><p>ã€€ã€€ä½ ä¹Ÿå¯ä»¥åœ¨åˆ—è¡¨å­—é¢é‡ä¸Šä½¿ç”¨ç´¢å¼•è¿ç®—ç¬¦ï¼Œä¸è¿‡è¿™äº›ä¸­æ‹¬å·åœ¨å®é™…çš„ä»£ç ä¸­ä»¤äººå›°æƒ‘ï¼Œçœ‹èµ·æ¥ä¹Ÿæ²¡æœ‰å¿…è¦ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs prolog">&gt;&gt;&gt; [<span class="hljs-string">&#x27;cat&#x27;</span>, <span class="hljs-string">&#x27;dog&#x27;</span>, <span class="hljs-string">&#x27;moose&#x27;</span>][<span class="hljs-number">2</span>]<br><span class="hljs-string">&#x27;moose&#x27;</span><br></code></pre></td></tr></table></figure><p>ã€€ã€€ç´¢å¼•ä¹Ÿå¯ä»¥è¢«ç”¨äºé™¤åˆ—è¡¨ä¹‹å¤–çš„å…¶ä»–å€¼ï¼Œæ¯”å¦‚åœ¨å­—ç¬¦ä¸²ä¸Šè·å–æŸä¸ªå­—ç¬¦ï¼š</p><figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs prolog">&gt;&gt;&gt; <span class="hljs-string">&#x27;Hello, world&#x27;</span>[<span class="hljs-number">0</span>]<br><span class="hljs-string">&#x27;H&#x27;</span><br></code></pre></td></tr></table></figure><p>ã€€ã€€Pythonçš„å­—å…¸æ˜¯é”®âˆ’å€¼å¯¹ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">spam = &#123;<span class="hljs-string">&#x27;name&#x27;</span>: <span class="hljs-string">&#x27;Zophie&#x27;</span>&#125;</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">spam[<span class="hljs-string">&#x27;name&#x27;</span>]</span><br>&#x27;Zophie&#x27;<br></code></pre></td></tr></table></figure><p>ã€€ã€€è™½ç„¶Pythonçš„åˆ—è¡¨ç´¢å¼•åªèƒ½æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œä½†å­—å…¸çš„ç´¢å¼•è¿ç®—ç¬¦æ˜¯ä¸€ä¸ª<strong>é”®</strong>ï¼Œå¯ä»¥æ˜¯ä»»ä½•å¯å“ˆå¸Œçš„å¯¹è±¡ã€‚<strong>å“ˆå¸Œå€¼</strong>æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œå®ƒå°±åƒæ˜¯æŸä¸ªå€¼çš„â€œæŒ‡çº¹â€ã€‚ä¸€ä¸ªå¯¹è±¡çš„å“ˆå¸Œå€¼åœ¨è¿™ä¸ªå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸå†…æ°¸è¿œä¸ä¼šæ”¹å˜ï¼Œä¸”å…·æœ‰ç›¸åŒå€¼çš„å¯¹è±¡å¿…é¡»æœ‰ç›¸åŒçš„å“ˆå¸Œå€¼ã€‚åœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œå­—ç¬¦ä¸²<code>&#39;name&#39;</code>æ˜¯å€¼<code>&#39;Zophie&#39;</code>å¯¹åº”çš„é”®ã€‚<code>hash()</code>å‡½æ•°å¯ä»¥è¿”å›å¯å“ˆå¸Œå¯¹è±¡çš„å“ˆå¸Œå€¼ã€‚å­—ç¬¦ä¸²ã€æ•´æ•°ã€æµ®ç‚¹æ•°å’Œå…ƒç»„ç­‰ä¸å¯å˜å¯¹è±¡éƒ½æ˜¯å¯å“ˆå¸Œçš„ï¼Œè€Œåˆ—è¡¨ç­‰å¯å˜å¯¹è±¡æ˜¯ä¸å¯å“ˆå¸Œçš„ã€‚åœ¨äº¤äº’å¼shellä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">hash</span>(<span class="hljs-string">&#x27;hello&#x27;</span>)</span><br>-1734230105925061914<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">hash</span>(<span class="hljs-number">42</span>)</span><br>42<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">hash</span>(<span class="hljs-number">3.14</span>)</span><br>322818021289917443<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">hash</span>((<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>))</span><br>2528502973977326415<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">hash</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>])</span><br>Traceback (most recent call last):<br>  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;<br>TypeError: unhashable type: &#x27;list&#x27;<br></code></pre></td></tr></table></figure><p>ã€€ã€€é”®çš„å“ˆå¸Œå€¼ä¼šè¢«ç”¨æ¥å¯»æ‰¾å­˜å‚¨åœ¨å­—å…¸å’Œé›†åˆæ•°æ®ç±»å‹ä¸­çš„é¡¹ï¼Œå…·ä½“ç»†èŠ‚ä¸åœ¨æœ¬ä¹¦è®²è¿°èŒƒå›´ä¹‹å†…ã€‚å› ä¸ºåˆ—è¡¨æ˜¯å¯å˜ç±»å‹ï¼Œä¸èƒ½è¢«å“ˆå¸Œï¼Œæ‰€ä»¥ä¸èƒ½è¢«å½“ä½œå­—å…¸çš„é”®ï¼š</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs lua">&gt;&gt;&gt; d = &#123;&#125;<br>&gt;&gt;&gt; d<span class="hljs-string">[[1, 2, 3]]</span> = <span class="hljs-string">&#x27;some value&#x27;</span><br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;stdin&gt;&quot;</span>, line <span class="hljs-number">1</span>, <span class="hljs-keyword">in</span> &lt;<span class="hljs-built_in">module</span>&gt;<br>TypeError: unhashable <span class="hljs-built_in">type</span>: <span class="hljs-string">&#x27;list&#x27;</span><br></code></pre></td></tr></table></figure><p>ã€€ã€€å“ˆå¸Œå€¼ä¸åŒäºèº«ä»½ã€‚ä¸¤ä¸ªå…·æœ‰ç›¸åŒå€¼çš„ä¸åŒå¯¹è±¡çš„èº«ä»½æ˜¯ä¸åŒçš„ï¼Œä½†å®ƒä»¬çš„å“ˆå¸Œå€¼æ˜¯ç›¸åŒçš„ã€‚åœ¨äº¤äº’å¼shellä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">a = (<span class="hljs-string">&#x27;cat&#x27;</span>, <span class="hljs-string">&#x27;dog&#x27;</span>, <span class="hljs-string">&#x27;moose&#x27;</span>)</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">b = (<span class="hljs-string">&#x27;cat&#x27;</span>, <span class="hljs-string">&#x27;dog&#x27;</span>, <span class="hljs-string">&#x27;moose&#x27;</span>)</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">id</span>(a), <span class="hljs-built_in">id</span>(b)</span><br>(37111992, 37112136)<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">id</span>(a) == <span class="hljs-built_in">id</span>(b) â¶</span><br>False<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">hash</span>(a), <span class="hljs-built_in">hash</span>(b) â·</span><br>(-3478972040190420094, -3478972040190420094)<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">hash</span>(a) == <span class="hljs-built_in">hash</span>(b)</span><br>True<br></code></pre></td></tr></table></figure><p><code>a</code>å’Œ<code>b</code>æ‰€æŒ‡å‘çš„å…ƒç»„æœ‰ä¸åŒçš„èº«ä»½â¶ï¼Œä½†å®ƒä»¬çš„å€¼ç›¸åŒï¼Œæ‰€ä»¥æœ‰ç›¸åŒçš„å“ˆå¸Œå€¼â·ã€‚æ³¨æ„ï¼Œå¦‚æœå…ƒç»„åªåŒ…å«å¯å“ˆå¸Œçš„é¡¹ï¼Œè¿™ä¸ªå…ƒç»„å°±æ˜¯å¯å“ˆå¸Œçš„ï¼Œå¦åˆ™å°±æ˜¯ä¸å¯å“ˆå¸Œçš„ã€‚å› ä¸ºå­—å…¸ä¸­çš„é”®å¿…é¡»æ˜¯å¯å“ˆå¸Œçš„ï¼Œæ‰€ä»¥ä¸èƒ½å°†åŒ…å«ä¸å¯å“ˆå¸Œåˆ—è¡¨çš„å…ƒç»„å½“ä½œé”®ã€‚åœ¨äº¤äº’å¼shellä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">tuple1 = (<span class="hljs-string">&#x27;cat&#x27;</span>, <span class="hljs-string">&#x27;dog&#x27;</span>)</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">tuple2 = (<span class="hljs-string">&#x27;cat&#x27;</span>, [<span class="hljs-string">&#x27;apple&#x27;</span>, <span class="hljs-string">&#x27;orange&#x27;</span>])</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">spam = &#123;&#125;</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">spam[tuple1] = <span class="hljs-string">&#x27;a value&#x27;</span> â¶</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">spam[tuple2] = <span class="hljs-string">&#x27;another value&#x27;</span> â·</span><br>Traceback (most recent call last):<br>  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;<br>TypeError: unhashable type: &#x27;list&#x27;<br></code></pre></td></tr></table></figure><p>ã€€ã€€æ³¨æ„ï¼Œ<code>tuple1</code>æ˜¯å¯å“ˆå¸Œçš„â¶ï¼Œä½†<code>tuple2</code>å«æœ‰ä¸å¯å“ˆå¸Œçš„åˆ—è¡¨â·ï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸å¯å“ˆå¸Œçš„ã€‚</p><h3 id="7-1-9-å®¹å™¨ã€åºåˆ—ã€æ˜ å°„å’Œé›†åˆç±»å‹"><a href="#7-1-9-å®¹å™¨ã€åºåˆ—ã€æ˜ å°„å’Œé›†åˆç±»å‹" class="headerlink" title="7.1.9ã€€å®¹å™¨ã€åºåˆ—ã€æ˜ å°„å’Œé›†åˆç±»å‹"></a>7.1.9ã€€å®¹å™¨ã€åºåˆ—ã€æ˜ å°„å’Œé›†åˆç±»å‹</h3><p>ã€€ã€€<strong>å®¹å™¨</strong>ã€<strong>åºåˆ—</strong>ã€<strong>æ˜ å°„</strong>è¿™å‡ ä¸ªè¯åœ¨Pythonä¸­çš„å«ä¹‰ä¸ä¸€å®šç­‰åŒäºåœ¨å…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸­çš„å«ä¹‰ã€‚åœ¨Pythonä¸­ï¼Œå®¹å™¨æ˜¯å¯ä»¥åŒ…å«å¤šä¸ªä»»æ„ç±»å‹å¯¹è±¡çš„å¯¹è±¡ã€‚å¸¸è§çš„å®¹å™¨ç±»å‹åŒ…æ‹¬åˆ—è¡¨å’Œå­—å…¸ã€‚</p><p>ã€€ã€€<strong>åºåˆ—</strong>æ˜¯å®¹å™¨æ•°æ®ç±»å‹çš„å¯¹è±¡ï¼Œå®ƒçš„å…ƒç´ æœ‰åºä¸”å¯ä»¥é€šè¿‡æ•´æ•°ç´¢å¼•è®¿é—®ã€‚å­—ç¬¦ä¸²ã€å…ƒç»„ã€åˆ—è¡¨å’Œå­—èŠ‚å¯¹è±¡éƒ½å±äºåºåˆ—ã€‚è¿™å‡ ç§ç±»å‹çš„å¯¹è±¡å¯ä»¥é€šè¿‡ç´¢å¼•è®¿é—®å¯¹åº”æ•°å€¼ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™<code>len()</code>å‡½æ•°ã€‚æœ‰åºæŒ‡çš„æ˜¯åºåˆ—ä¸­æœ‰ç¬¬ä¸€ä¸ªå€¼ã€ç¬¬äºŒä¸ªå€¼ï¼Œä»¥æ­¤ç±»æ¨ã€‚æ¯”å¦‚ï¼Œä¸‹é¢ä¸¤ä¸ªåˆ—è¡¨è¢«è®¤ä¸ºæ˜¯ä¸ç›¸ç­‰çš„ï¼Œå› ä¸ºå®ƒä»¬çš„å€¼çš„é¡ºåºä¸åŒï¼š</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs inform7">&gt;&gt;&gt; <span class="hljs-comment">[1, 2, 3]</span> == <span class="hljs-comment">[3, 2, 1]</span><br>False<br></code></pre></td></tr></table></figure><p>ã€€ã€€<strong>æ˜ å°„</strong>ä¹Ÿæ˜¯å®¹å™¨æ•°æ®ç±»å‹çš„å¯¹è±¡ï¼Œå®ƒä½¿ç”¨é”®è€Œéç´¢å¼•è®¿é—®ã€‚æ˜ å°„æ—¢å¯ä»¥æ˜¯æœ‰åºçš„ï¼Œä¹Ÿå¯ä»¥æ˜¯æ— åºçš„ã€‚åœ¨Python 3.4å’Œæ›´æ—©çš„ç‰ˆæœ¬ä¸­ï¼Œå­—å…¸æ˜¯æ— åºçš„ï¼Œå› ä¸ºå®ƒæ²¡æœ‰æ‰€è°“çš„ç¬¬ä¸€ä¸ªé”®âˆ’å€¼å¯¹å’Œæœ€åä¸€ä¸ªé”®âˆ’å€¼å¯¹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>spam = &#123;<span class="hljs-string">&#x27;a&#x27;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;b&#x27;</span>: <span class="hljs-number">2</span>, <span class="hljs-string">&#x27;c&#x27;</span>: <span class="hljs-number">3</span>, <span class="hljs-string">&#x27;d&#x27;</span>: <span class="hljs-number">4</span>&#125; <span class="hljs-comment"># è¿™æ˜¯åœ¨CPython 3.5ä¸­è¿è¡Œçš„</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">list</span>(spam.keys())<br>[<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>spam[<span class="hljs-string">&#x27;e&#x27;</span>] = <span class="hljs-number">5</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">list</span>(spam.keys())<br>[<span class="hljs-string">&#x27;e&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>]<br></code></pre></td></tr></table></figure><p>ã€€ã€€Pythonçš„æ—©æœŸç‰ˆæœ¬ä¸èƒ½ä¿è¯ä»å­—å…¸ä¸­è·å–é¡¹çš„é¡ºåºã€‚ç”±äºå­—å…¸çš„æ— åºæ€§ï¼Œä¸¤ä¸ªé”®âˆ’å€¼å¯¹é¡ºåºä¸åŒçš„å­—å…¸å­—é¢é‡ä»ç„¶è¢«è®¤ä¸ºæ˜¯ç›¸ç­‰çš„ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>&#123;<span class="hljs-string">&#x27;a&#x27;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;b&#x27;</span>: <span class="hljs-number">2</span>, <span class="hljs-string">&#x27;c&#x27;</span>: <span class="hljs-number">3</span>&#125; == &#123;<span class="hljs-string">&#x27;c&#x27;</span>: <span class="hljs-number">3</span>, <span class="hljs-string">&#x27;a&#x27;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;b&#x27;</span>: <span class="hljs-number">2</span>&#125;<br><span class="hljs-literal">True</span><br></code></pre></td></tr></table></figure><p>ã€€ã€€ä½†æ˜¯ä»Cpython 3.6å¼€å§‹ï¼Œå­—å…¸ä¿ç•™äº†é”®âˆ’å€¼å¯¹çš„æ’å…¥é¡ºåºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>spam = &#123;<span class="hljs-string">&#x27;a&#x27;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;b&#x27;</span>: <span class="hljs-number">2</span>, <span class="hljs-string">&#x27;c&#x27;</span>: <span class="hljs-number">3</span>, <span class="hljs-string">&#x27;d&#x27;</span>: <span class="hljs-number">4</span>&#125; <span class="hljs-comment"># è¯¥ä»£ç éœ€è¦åœ¨Cpython 3.6ä¸­è¿è¡Œ</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">list</span>(spam)<br>[<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>spam[<span class="hljs-string">&#x27;e&#x27;</span>] = <span class="hljs-number">5</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">list</span>(spam)<br>[<span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;d&#x27;</span>, <span class="hljs-string">&#x27;e&#x27;</span>]<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯CPython 3.6è§£é‡Šå™¨çš„ä¸€ä¸ªç‰¹æ€§ï¼Œå®ƒä¸å­˜åœ¨äºå…¶ä»–Python 3.6è§£é‡Šå™¨ä¸­ã€‚ä½†ä»Python 3.7å¼€å§‹ï¼Œè¿™ä¸€ç‰¹æ€§æˆä¸ºPythonè¯­è¨€æ ‡å‡†ï¼Œæ‰€æœ‰Python 3.7è§£é‡Šå™¨éƒ½æ”¯æŒäº†æœ‰åºå­—å…¸ã€‚ä½†å­—å…¸çš„æœ‰åºæ€§å¹¶ä¸æ„å‘³ç€å®ƒçš„é¡¹å¯ä»¥é€šè¿‡æ•°å­—ç´¢å¼•è·å–ï¼š<code>spam[0]</code>å¹¶ä¸ä¼šè¿”å›æœ‰åºå­—å…¸ä¸­çš„ç¬¬ä¸€é¡¹ï¼ˆé™¤éå‡‘å·§ç¬¬ä¸€é¡¹çš„é”®æ­£å¥½ä¸º0ï¼‰ã€‚å¦‚æœä¸¤ä¸ªæœ‰åºå­—å…¸åŒ…å«ç›¸åŒçš„é”®âˆ’å€¼å¯¹ï¼Œä½†é”®âˆ’å€¼å¯¹çš„é¡ºåºä¸åŒï¼Œé‚£ä¹ˆä¹Ÿä¼šè¢«è®¤ä¸ºæ˜¯ç›¸ç­‰çš„ã€‚</p><p>ã€€ã€€<code>collections</code>æ¨¡å—åŒ…å«å¾ˆå¤šå…¶ä»–æ˜ å°„ç±»å‹ï¼Œæ¯”å¦‚<code>OrderedDict</code>ã€<code>ChainMap</code>ã€<code>Counter</code>å’Œ<code>UserDict</code>ã€‚åœ¨Pythonå®˜ç½‘ä¸Šå¯ä»¥æ‰¾åˆ°ä»¥ä¸Šæ˜ å°„ç±»å‹çš„ä»‹ç»ã€‚</p><h3 id="7-1-10-ç‰¹æ®Šæ–¹æ³•"><a href="#7-1-10-ç‰¹æ®Šæ–¹æ³•" class="headerlink" title="7.1.10ã€€ç‰¹æ®Šæ–¹æ³•"></a>7.1.10ã€€ç‰¹æ®Šæ–¹æ³•</h3><p>ã€€ã€€<strong>ç‰¹æ®Šæ–¹æ³•</strong>ï¼ˆdunder methodï¼‰ä¹Ÿè¢«ç§°ä¸º<strong>é­”æœ¯æ–¹æ³•</strong>ï¼Œæ˜¯æŒ‡Pythonä¸­åç§°ä»¥ä¸¤ä¸ªä¸‹åˆ’çº¿å¼€å¤´å’Œç»“å°¾çš„ç‰¹æ®Šæ–¹æ³•ã€‚è¿™äº›æ–¹æ³•ç”¨äºè¿ç®—ç¬¦é‡è½½ã€‚dunderæ˜¯double underscoreï¼ˆåŒä¸‹åˆ’çº¿ï¼‰çš„ç¼©å†™ã€‚æœ€ä¸ºäººç†ŸçŸ¥çš„ç‰¹æ®Šæ–¹æ³•æ˜¯<code>__init__</code>ï¼ˆè¯»ä½œdunder init dunderï¼Œä¹Ÿå¯ä»¥ç›´æ¥è¯»ä½œinitï¼‰ï¼Œå…¶ä½œç”¨æ˜¯åˆå§‹åŒ–å¯¹è±¡ã€‚Pythonæœ‰å‡ åä¸ªç‰¹æ®Šæ–¹æ³•ï¼Œç¬¬17ç« å°†è¯¦ç»†è§£é‡Šã€‚</p><h3 id="7-1-11-æ¨¡å—å’ŒåŒ…"><a href="#7-1-11-æ¨¡å—å’ŒåŒ…" class="headerlink" title="7.1.11ã€€æ¨¡å—å’ŒåŒ…"></a>7.1.11ã€€æ¨¡å—å’ŒåŒ…</h3><p>ã€€ã€€<strong>æ¨¡å—</strong>æ˜¯å¯ä»¥è¢«å…¶ä»–Pythonç¨‹åºå¯¼å…¥ï¼Œå°†ä»£ç æä¾›ç»™å¯¼å…¥è€…ä½¿ç”¨çš„ç¨‹åºã€‚Pythonè‡ªå¸¦çš„æ¨¡å—è¢«ç»Ÿç§°ä¸ºPythonæ ‡å‡†åº“ï¼Œä½ ä¹Ÿå¯ä»¥åˆ›å»ºè‡ªå·±çš„æ¨¡å—ã€‚å¦‚æœä¸€ä¸ªç¨‹åºè¢«ä¿å­˜ä¸ºspam.pyï¼Œé‚£ä¹ˆå…¶ä»–ç¨‹åºå¯ä»¥è¿è¡Œ<code>import spam</code>æ¥è®¿é—®spam.pyç¨‹åºçš„å‡½æ•°ã€ç±»å’Œæœ€ä¸Šå±‚çš„å˜é‡ã€‚</p><p>ã€€ã€€<strong>åŒ…</strong>æ˜¯æ¨¡å—çš„é›†åˆï¼Œé€šè¿‡åœ¨æ–‡ä»¶å¤¹ä¸­æ”¾ç½®ä¸€ä¸ªåä¸º<code>__init__.py</code>çš„æ–‡ä»¶å°±å¯ä»¥å½¢æˆä¸€ä¸ªåŒ…ã€‚è¿™ä¸ªæ–‡ä»¶å¤¹çš„åç§°å°±æ˜¯åŒ…çš„åç§°ã€‚åŒ…å¯ä»¥åŒ…å«å¤šä¸ªæ¨¡å—ï¼ˆä¹Ÿå°±æ˜¯.pyæ–‡ä»¶ï¼‰æˆ–å…¶ä»–åŒ…ï¼ˆåŒ…å«<code>__init__.py</code>æ–‡ä»¶çš„å…¶ä»–æ–‡ä»¶å¤¹ï¼‰ã€‚</p><p>ã€€ã€€å…³äºæ¨¡å—å’ŒåŒ…çš„æ›´å¤šè§£é‡Šå’Œç»†èŠ‚ï¼Œè¯·æŸ¥çœ‹Pythonå®˜ç½‘ä¸Šçš„ç›¸å…³æ–‡æ¡£ã€‚</p><h3 id="7-1-12-å¯è°ƒç”¨å¯¹è±¡å’Œå¤´ç­‰å¯¹è±¡"><a href="#7-1-12-å¯è°ƒç”¨å¯¹è±¡å’Œå¤´ç­‰å¯¹è±¡" class="headerlink" title="7.1.12ã€€å¯è°ƒç”¨å¯¹è±¡å’Œå¤´ç­‰å¯¹è±¡"></a>7.1.12ã€€å¯è°ƒç”¨å¯¹è±¡å’Œå¤´ç­‰å¯¹è±¡</h3><p>ã€€ã€€åœ¨Pythonä¸­å¯è°ƒç”¨çš„ä¸åªæœ‰å‡½æ•°å’Œæ–¹æ³•ã€‚<strong>å¯è°ƒç”¨å¯¹è±¡</strong>æ˜¯æŒ‡å®ç°äº†å¯è°ƒç”¨è¿ç®—ç¬¦ï¼ˆä¸€å¯¹æ‹¬å·<code>()</code>ï¼‰çš„å¯¹è±¡ã€‚å‡è®¾ä½ æœ‰ä¸€æ¡<code>def hello():</code>è¯­å¥ï¼Œå¯ä»¥æŠŠè¿™æ®µä»£ç è§†ä¸ºæœ‰ä¸€ä¸ªåä¸º<code>hello</code>çš„å˜é‡ï¼Œå®ƒçš„å€¼ä¸ºä¸€ä¸ªå‡½æ•°å¯¹è±¡ï¼Œåœ¨è¿™ä¸ªå˜é‡ä¸Šä½¿ç”¨å¯è°ƒç”¨è¿ç®—ç¬¦ä¼šè°ƒç”¨<code>hello</code>å˜é‡å¯¹åº”çš„å‡½æ•°ã€‚</p><p>ã€€ã€€ç±»æ˜¯ä¸€ä¸ªOOPæ¦‚å¿µã€‚ç±»å°±æ˜¯å¯è°ƒç”¨å¯¹è±¡çš„ä¾‹å­ï¼Œå®ƒå¹¶éå‡½æ•°æˆ–æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œ<code>datetime</code>æ¨¡å—ä¸­çš„<code>date</code>ç±»ï¼Œåœ¨<code>datetime.date(2020, 1, 1)</code>ä¸­é€šè¿‡å¯è°ƒç”¨è¿ç®—ç¬¦è°ƒç”¨ã€‚å½“ç±»å¯¹è±¡è¢«è°ƒç”¨æ—¶ï¼Œè¿™ä¸ªç±»çš„<code>__init__</code>æ–¹æ³•ä¸­çš„ä»£ç ä¼šè¢«è¿è¡Œã€‚ç¬¬15ç« å°†ä»‹ç»ç±»çš„æ›´å¤šç»†èŠ‚ã€‚</p><p>ã€€ã€€å‡½æ•°æ˜¯Pythonä¸­çš„å¤´ç­‰å¯¹è±¡ï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥æŠŠå®ƒä»¬å­˜å‚¨åœ¨å˜é‡ä¸­ï¼Œåœ¨å‡½æ•°è°ƒç”¨ä¸­ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œä½œä¸ºå‡½æ•°è°ƒç”¨çš„è¿”å›å€¼ï¼Œä¹Ÿå¯ä»¥åšä»»ä½•èƒ½å¯¹å¯¹è±¡åšçš„äº‹æƒ…ã€‚å¯ä»¥æŠŠ<code>def</code>è¯­å¥çœ‹ä½œå°†ä¸€ä¸ªå‡½æ•°å¯¹è±¡èµ‹å€¼ç»™å˜é‡ã€‚æ¯”å¦‚ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ª<code>spam()</code>å‡½æ•°ï¼Œç„¶åè°ƒç”¨å®ƒï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">spam</span>():</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Spam! Spam! Spam!&#x27;</span>)</span><br><span class="hljs-meta prompt_">...</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">spam()</span><br>Spam! Spam! Spam!<br></code></pre></td></tr></table></figure><p>ã€€ã€€ä¹Ÿå¯ä»¥å°†<code>spam()</code>å‡½æ•°èµ‹å€¼ç»™å…¶ä»–å˜é‡ã€‚å½“è°ƒç”¨è¿™ä¸ªå˜é‡æ—¶ï¼ŒPythonå°†æ‰§è¡Œ<code>spam()</code>å‡½æ•°ï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">eggs = spam</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">eggs()</span><br>Spam! Spam! Spam!<br></code></pre></td></tr></table></figure><p>è¿™äº›è¢«ç§°ä¸º<strong>åˆ«å</strong>ï¼Œæ˜¯ä¸ºå·²å­˜åœ¨çš„å‡½æ•°èµ·çš„å…¶ä»–åç§°ã€‚é€šå¸¸åœ¨é‡å‘½åå‡½æ•°æ—¶ä¼šç”¨åˆ°åˆ«åã€‚ä½†å¦‚æœæ—§çš„åå­—è¢«å¤§é‡å·²æœ‰ä»£ç ä½¿ç”¨ï¼Œé‚£ä¹ˆä¿®æ”¹åå­—çš„å·¥ä½œé‡å¾ˆå¤§ã€‚</p><p>ã€€ã€€å¤´ç­‰å¯¹è±¡æœ€å¸¸è§çš„ç”¨é€”æ˜¯æŠŠå‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’ç»™å…¶ä»–å‡½æ•°ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ª<code>callTwice()</code>å‡½æ•°ï¼Œå®ƒå¯ä»¥æ¥å—ä¸€ä¸ªéœ€è¦è¢«è°ƒç”¨ä¸¤æ¬¡çš„å‡½æ•°ä½œä¸ºå‚æ•°ï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">callTwice</span>(<span class="hljs-params">func</span>):</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">    func()</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">    func()</span><br><span class="hljs-meta prompt_">...</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">callTwice(spam)</span><br>Spam! Spam! Spam!<br>Spam! Spam! Spam!<br></code></pre></td></tr></table></figure><p>ã€€ã€€å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ç›´æ¥åœ¨ä»£ç ä¸­å†™ä¸¤æ¬¡<code>spam()</code>ã€‚ä½¿ç”¨è¿™ç§æ–¹å¼çš„å¥½å¤„æ˜¯å¯ä»¥å°†<code>callTwice()</code>å‡½æ•°ä¼ é€’ç»™ä»»ä½•ä¸€ä¸ªåœ¨è¿è¡Œçš„å‡½æ•°ï¼Œè€Œä¸å¿…åœ¨æºä»£ç ä¸­é¢„å…ˆè¾“å…¥ä¸¤æ¬¡å‡½æ•°è°ƒç”¨è¯­å¥ã€‚</p><h2 id="7-2-ç»å¸¸è¢«æ··æ·†çš„æœ¯è¯­"><a href="#7-2-ç»å¸¸è¢«æ··æ·†çš„æœ¯è¯­" class="headerlink" title="7.2ã€€ç»å¸¸è¢«æ··æ·†çš„æœ¯è¯­"></a>7.2ã€€ç»å¸¸è¢«æ··æ·†çš„æœ¯è¯­</h2><p>ã€€ã€€æœ¯è¯­æœ¬å°±å¤Ÿè®©äººå›°æƒ‘çš„äº†ï¼Œç‰¹åˆ«æ˜¯é‚£äº›å«ä¹‰ä¸Šæœ‰å…³è”ä½†åˆä¸åŒçš„å®šä¹‰ã€‚æ›´ç³Ÿç³•çš„æ˜¯ï¼Œç¼–ç¨‹è¯­è¨€ã€æ“ä½œç³»ç»Ÿã€è®¡ç®—æœºé¢†åŸŸè¿™ä¸‰è€…å¯èƒ½ä¼šä½¿ç”¨ä¸åŒçš„æœ¯è¯­æ¥è¡¨ç¤ºåŒä¸€ä¸ªäº‹ç‰©ï¼Œæˆ–è€…ç”¨ç›¸åŒçš„æœ¯è¯­è¡¨ç¤ºä¸åŒçš„äº‹ç‰©ã€‚ä¸ºäº†èƒ½ä¸å…¶ä»–ä¸“ä¸šäººå‘˜æ¸…æ¥šåœ°äº¤æµï¼Œä½ éœ€è¦å­¦ä¹ ä»¥ä¸‹æœ¯è¯­çš„åŒºåˆ«ã€‚</p><h3 id="7-2-1-è¯­å¥å’Œè¡¨è¾¾å¼"><a href="#7-2-1-è¯­å¥å’Œè¡¨è¾¾å¼" class="headerlink" title="7.2.1ã€€è¯­å¥å’Œè¡¨è¾¾å¼"></a>7.2.1ã€€è¯­å¥å’Œè¡¨è¾¾å¼</h3><p>ã€€ã€€<strong>è¡¨è¾¾å¼</strong>æ˜¯ç”±è¿ç®—ç¬¦å’Œå€¼ç»„æˆçš„æŒ‡ä»¤ï¼Œå¯ä»¥æ¨å¯¼å‡ºå•ä¸€çš„å€¼ã€‚è¿™ä¸ªå€¼å¯ä»¥æ˜¯å˜é‡ï¼ˆåŒ…å«å€¼ï¼‰æˆ–è€…å‡½æ•°è°ƒç”¨ï¼ˆè¿”å›å€¼ï¼‰ã€‚æŒ‰ç…§è¿™ä¸ªå®šä¹‰ï¼Œ<code>2 + 2</code>æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå®ƒçš„ç»“æœæ˜¯<code>4</code>ã€‚<code>len(myName) &gt; 4</code>ã€<code>myName.isupper()</code>ã€<code>myName == &#39;Zophie&#39;</code>ä¹Ÿæ˜¯è¡¨è¾¾å¼ã€‚ä¸€ä¸ªå€¼æœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå®ƒçš„ç»“æœå°±æ˜¯å®ƒè‡ªå·±ã€‚</p><p>ã€€ã€€<strong>è¯­å¥</strong>å®é™…ä¸Šæ˜¯Pythonä¸­çš„æ‰€æœ‰å…¶ä»–æŒ‡ä»¤ï¼ŒåŒ…æ‹¬<code>if</code>è¯­å¥ã€<code>for</code>è¯­å¥ã€<code>def</code>è¯­å¥å’Œ<code>return</code>è¯­å¥ç­‰ã€‚è¯­å¥å¹¶ä¸èƒ½æ¨å¯¼å¾—åˆ°ä¸€ä¸ªå€¼ã€‚ä¸€äº›è¯­å¥å¯èƒ½åŒ…å«è¡¨è¾¾å¼ï¼Œæ¯”å¦‚èµ‹å€¼è¯­å¥<code>spam = 2 + 2</code>ï¼Œæˆ–è€…<code>if</code>è¯­å¥<code>if myName == &#39;Zophie&#39;:</code>ã€‚</p><p>ã€€ã€€Python 3ä½¿ç”¨<code>print()</code>å‡½æ•°ï¼ŒPython 2åˆ™ä½¿ç”¨<code>print</code>è¯­å¥ã€‚çœ‹èµ·æ¥åªæ˜¯åŠ äº†ä¸€å¯¹æ‹¬å·ï¼Œä½†æ›´é‡è¦çš„åŒºåˆ«åœ¨äºPython 3çš„<code>print()</code>å‡½æ•°å…·æœ‰è¿”å›å€¼ï¼ˆè™½ç„¶æ€»æ˜¯<code>None</code>ï¼‰ï¼Œå¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’ç»™å…¶ä»–å‡½æ•°ï¼Œä¹Ÿå¯ä»¥è¢«èµ‹å€¼ç»™ä¸€ä¸ªå˜é‡ã€‚è¯­å¥æ˜¯ä¸èƒ½åšè¿™äº›æ“ä½œçš„ã€‚ä¸è¿‡åœ¨Python 2ä¸­ä¹Ÿå¯ä»¥åœ¨<code>print</code>åæ·»åŠ ä¸€å¯¹æ‹¬å·ï¼Œå°±åƒä¸‹é¢è¿™ä¸ªäº¤äº’å¼shellç¤ºä¾‹ï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;Hello, world!&#x27;</span> <span class="hljs-comment"># åœ¨Python 2ä¸­è¿è¡Œ</span></span><br>Hello, world!<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Hello, world!&#x27;</span>) <span class="hljs-comment"># åœ¨Python 2ä¸­è¿è¡Œ â¶</span></span><br>Hello, world!<br></code></pre></td></tr></table></figure><p>å°½ç®¡å®ƒçœ‹èµ·æ¥åƒæ˜¯å‡½æ•°è°ƒç”¨â¶ï¼Œä½†å®é™…ä¸Šè¿˜æ˜¯ä¸€ä¸ªç”¨æ‹¬å·åŒ…è£¹ç€å­—ç¬¦ä¸²å€¼çš„<code>print</code>è¯­å¥ï¼Œå°±åƒèµ‹å€¼è¯­å¥<code>spam = (2 + 2)</code>å®é™…ä¸Šç­‰æ•ˆäº<code>spam = 2 + 2</code>ä¸€æ ·ã€‚åœ¨Python 2å’ŒPython 3ä¸­ï¼Œå¯ä»¥å°†å¤šä¸ªå€¼ä¼ é€’ç»™<code>print</code>è¯­å¥æˆ–è€…<code>print()</code>å‡½æ•°ï¼Œå°±åƒä¸‹é¢è¿™æ ·ï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Hello&#x27;</span>, <span class="hljs-string">&#x27;world&#x27;</span>) <span class="hljs-comment"># åœ¨Python 3ä¸­è¿è¡Œ</span></span><br>Hello world<br></code></pre></td></tr></table></figure><p>ã€€ã€€ä½†åœ¨Python 2ä¸­ä½¿ç”¨åŒæ ·çš„ä»£ç ä¼šè¢«è§£é‡Šä¸ºåœ¨<code>print</code>è¯­å¥ä¸­ä¼ é€’ä¸€ä¸ªåŒ…å«ä¸¤ä¸ªå­—ç¬¦ä¸²å€¼çš„å…ƒç»„ï¼Œè¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Hello&#x27;</span>, <span class="hljs-string">&#x27;world&#x27;</span>) <span class="hljs-comment"># åœ¨Python 2ä¸­è¿è¡Œ</span><br>(<span class="hljs-string">&#x27;Hello&#x27;</span>, <span class="hljs-string">&#x27;world&#x27;</span>)<br></code></pre></td></tr></table></figure><p>ã€€ã€€è¯­å¥å’Œç”±å‡½æ•°è°ƒç”¨ç»„æˆçš„è¡¨è¾¾å¼ä¹‹é—´çš„å·®å¼‚è™½ç„¶å¾®å¦™ï¼Œä½†åˆ‡å®å­˜åœ¨ã€‚</p><h3 id="7-2-2-å—ã€å­å¥å’Œä¸»ä½“"><a href="#7-2-2-å—ã€å­å¥å’Œä¸»ä½“" class="headerlink" title="7.2.2ã€€å—ã€å­å¥å’Œä¸»ä½“"></a>7.2.2ã€€å—ã€å­å¥å’Œä¸»ä½“</h3><p>ã€€ã€€æœ¯è¯­<strong>å—</strong>ã€<strong>å­å¥</strong>ã€<strong>ä¸»ä½“</strong>ç»å¸¸æ··ç”¨ï¼Œç”¨æ¥æŒ‡ä»£ä¸€ç»„PythonæŒ‡ä»¤ã€‚å—ä»¥ç¼©è¿›å¼€å§‹ï¼Œå½“ç¼©è¿›å›é€€æ—¶ç»“æŸï¼Œæ¯”å¦‚åœ¨<code>if</code>è¯­å¥æˆ–<code>for</code>è¯­å¥åçš„ä»£ç è¢«ç§°ä¸ºè¯¥è¯­å¥çš„å—ã€‚ä»¥å†’å·ç»“å°¾çš„è¯­å¥åä¼šè·Ÿç€ä¸€ä¸ªæ–°å—ï¼Œæ¯”å¦‚<code>if</code>ã€<code>else</code>ã€<code>for</code>ã€<code>while</code>ã€<code>def</code>ã€<code>class</code>ç­‰ã€‚</p><p>ã€€ã€€Pythonä¹Ÿæ”¯æŒå•è¡Œå—ï¼Œè™½ç„¶æ˜¯æœ‰æ•ˆçš„ï¼Œä½†å¹¶ä¸æ¨èã€‚è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-variable"><span class="hljs-keyword">if</span></span> <span class="hljs-variable">name</span> == <span class="hljs-string">&#x27;Zophie&#x27;</span>: <span class="hljs-function"><span class="hljs-title">print</span>(<span class="hljs-string">&#x27;Hello, kitty!&#x27;</span>)</span><br></code></pre></td></tr></table></figure><p>é€šè¿‡ä½¿ç”¨åˆ†å·ï¼Œä»¥ä¸‹è¿™æ¡<code>if</code>è¯­å¥çš„å—ä¸­è¿˜å¯ä»¥æœ‰å¤šæ¡æŒ‡ä»¤ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-keyword">if</span> name == <span class="hljs-string">&#x27;Zophie&#x27;</span>: <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Hello, kitty!&#x27;</span>); <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Do you want a treat?&#x27;</span>)<br></code></pre></td></tr></table></figure><p>ä½†åœ¨å•è¡Œå—ä¸­ä¸èƒ½å‡ºç°å…¶ä»–éœ€è¦æ–°å—çš„è¯­å¥ã€‚ä»¥ä¸‹æ˜¯æ— æ•ˆçš„Pythonä»£ç ï¼š</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-variable"><span class="hljs-keyword">if</span></span> <span class="hljs-variable">name</span> == <span class="hljs-string">&#x27;Zophie&#x27;</span>: <span class="hljs-variable"><span class="hljs-keyword">if</span></span> <span class="hljs-variable">age</span> &lt; <span class="hljs-number">2</span>: <span class="hljs-function"><span class="hljs-title">print</span>(<span class="hljs-string">&#x27;Hello, kitten!&#x27;</span>)</span><br></code></pre></td></tr></table></figure><p>è¿™ä¹‹æ‰€ä»¥æ˜¯æ— æ•ˆçš„ï¼Œæ˜¯å› ä¸ºä¸‹ä¸€è¡Œçš„<code>else</code>è¯­å¥æ— æ³•å‡†ç¡®åœ°å¯¹åº”åˆ°<code>if</code>è¯­å¥ã€‚Pythonå®˜æ–¹æ–‡æ¡£æ›´å€¾å‘ä½¿ç”¨æœ¯è¯­â€œå­å¥â€è€Œéâ€œå—â€ï¼Œä¸‹é¢çš„ä»£ç å°±æ˜¯ä¸€ä¸ªå­å¥ï¼š</p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-variable"><span class="hljs-keyword">if</span></span> <span class="hljs-variable">name</span> == <span class="hljs-string">&#x27;Zophie&#x27;</span>:<br>    <span class="hljs-function"><span class="hljs-title">print</span>(<span class="hljs-string">&#x27;Hello, kitty!&#x27;</span>)</span><br>    <span class="hljs-function"><span class="hljs-title">print</span>(<span class="hljs-string">&#x27;Do you want a treat?&#x27;</span>)</span><br></code></pre></td></tr></table></figure><p><code>if</code>è¯­å¥æ˜¯å­å¥çš„å¤´ï¼Œ<code>if</code>è¯­å¥å†…çš„ä¸¤ä¸ª<code>print()</code>è°ƒç”¨æ˜¯å­å¥çš„å†…å®¹ï¼Œä¹Ÿè¢«ç§°ä¸ºâ€œä¸»ä½“â€ã€‚Pythonå®˜æ–¹æ–‡æ¡£ä½¿ç”¨â€œå—â€æ¥æŒ‡ä»¥å•å…ƒå½¢å¼æ‰§è¡Œçš„ä¸€æ®µä»£ç ï¼Œæ¯”å¦‚ä¸€ä¸ªæ¨¡å—ã€ä¸€ä¸ªå‡½æ•°ï¼Œæˆ–è€…ä¸€ä¸ªç±»çš„å®šä¹‰ã€‚</p><h3 id="7-2-3-å˜é‡å’Œç‰¹æ€§"><a href="#7-2-3-å˜é‡å’Œç‰¹æ€§" class="headerlink" title="7.2.3ã€€å˜é‡å’Œç‰¹æ€§"></a>7.2.3ã€€å˜é‡å’Œç‰¹æ€§</h3><p>ã€€ã€€<strong>å˜é‡</strong>æ˜¯æŒ‡å‘å¯¹è±¡çš„ä¸€ä¸ªåå­—ã€‚æ´å¼•å®˜æ–¹æ–‡æ¡£ï¼Œç‰¹æ€§åˆ™æ˜¯æŒ‡â€œ.ï¼ˆç‚¹ï¼‰åé¢çš„ä»»ä½•åå­—â€ã€‚ç‰¹æ€§æ˜¯è·Ÿå¯¹è±¡ï¼ˆç‚¹ä¹‹å‰çš„åå­—ï¼‰ç›¸å…³è”çš„ã€‚ä¾‹å¦‚ï¼Œåœ¨äº¤äº’å¼shellä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">import</span> datetime</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">spam = datetime.datetime.now()</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">spam.year</span><br>2018<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">spam.month</span><br>1<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä»£ç ç¤ºä¾‹ä¸­ï¼Œ<code>spam</code>æ˜¯ä¸€ä¸ªå€¼ä¸º<code>datetime</code>å¯¹è±¡ï¼ˆ<code>datetime.datetime.now()</code>çš„è¿”å›å€¼ï¼‰çš„å˜é‡ï¼Œ<code>year</code>å’Œ<code>month</code>éƒ½æ˜¯è¿™ä¸ªå¯¹è±¡çš„ç‰¹æ€§ã€‚å†ä¸¾ä¸ªä¾‹å­ï¼Œ<code>sys.exit()</code>ä¸­çš„<code>exit()</code>å‡½æ•°ä¹Ÿè¢«è§†ä¸ºæ˜¯<code>sys</code>æ¨¡å—å¯¹è±¡çš„ä¸€ä¸ªç‰¹æ€§ã€‚</p><p>ã€€ã€€åœ¨å…¶ä»–è¯­è¨€ä¸­ï¼Œç‰¹æ€§ä¹Ÿè¢«å«ä½œå­—æ®µã€å±æ€§æˆ–æˆå‘˜å˜é‡ã€‚</p><h3 id="7-2-4-å‡½æ•°å’Œæ–¹æ³•"><a href="#7-2-4-å‡½æ•°å’Œæ–¹æ³•" class="headerlink" title="7.2.4ã€€å‡½æ•°å’Œæ–¹æ³•"></a>7.2.4ã€€å‡½æ•°å’Œæ–¹æ³•</h3><p>ã€€ã€€å‡½æ•°æ˜¯åœ¨è°ƒç”¨æ—¶è¢«æ‰§è¡Œçš„ä»£ç çš„é›†åˆã€‚æ–¹æ³•æ˜¯ä¸ç±»ç›¸å…³è”çš„å‡½æ•°ï¼ˆæˆ–è€…å«ä½œä¸€ä¸ªå¯è°ƒç”¨çš„å‡½æ•°ï¼Œç¬¬8ç« å°†å¯¹æ­¤è¯´æ˜ï¼‰ï¼Œå°±åƒç‰¹æ€§æ˜¯ä¸å¯¹è±¡ç›¸å…³è”çš„å˜é‡ã€‚å‡½æ•°åŒ…æ‹¬å†…ç½®å‡½æ•°å’Œæ¨¡å—å†…çš„å‡½æ•°ã€‚åœ¨äº¤äº’å¼shellä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">len</span>(<span class="hljs-string">&#x27;Hello&#x27;</span>)</span><br>5<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-string">&#x27;Hello&#x27;</span>.upper()</span><br>&#x27;HELLO&#x27;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">import</span> math</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">math.sqrt(<span class="hljs-number">25</span>)</span><br>5.0<br></code></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œ<code>len()</code>æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè€Œ<code>upper()</code>æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ–¹æ³•ã€‚æ–¹æ³•ä¹Ÿè¢«è§†ä¸ºå®ƒä»¬æ‰€ç»‘å®šçš„å¯¹è±¡çš„ä¸€ä¸ªç‰¹æ€§ã€‚æ³¨æ„ï¼Œå‡ºç°å¥ç‚¹å¹¶ä¸æ„å‘³ç€ä½¿ç”¨çš„å°±ä¸€å®šæ˜¯æ–¹æ³•è€Œéå‡½æ•°ã€‚<code>sqrt()</code>å‡½æ•°å¤„äº<code>math</code>æ¨¡å—ä¸­ï¼Œè€Œ<code>math</code>å¹¶ä¸æ˜¯ä¸€ä¸ªç±»ï¼Œæ‰€ä»¥<code>sqrt()</code>è‡ªç„¶ä¹Ÿä¸æ˜¯ç±»çš„æ–¹æ³•ã€‚</p><h3 id="7-2-5-å¯è¿­ä»£å¯¹è±¡å’Œè¿­ä»£å™¨"><a href="#7-2-5-å¯è¿­ä»£å¯¹è±¡å’Œè¿­ä»£å™¨" class="headerlink" title="7.2.5ã€€å¯è¿­ä»£å¯¹è±¡å’Œè¿­ä»£å™¨"></a>7.2.5ã€€å¯è¿­ä»£å¯¹è±¡å’Œè¿­ä»£å™¨</h3><p>ã€€ã€€Pythonçš„<code>for</code>å¾ªç¯æ˜¯ä¸ªå¤šé¢æ‰‹ã€‚è¯­å¥<code>for i in range(3):</code>ä¼šå°†å—å†…çš„ä»£ç æ‰§è¡Œ3æ¬¡ã€‚<code>range(3)</code>è°ƒç”¨ä¸ä»…ä»…æ˜¯Pythonå‘Šè¯‰<code>for</code>å¾ªç¯â€œé‡å¤æ‰§è¡Œä»£ç 3æ¬¡â€ã€‚è°ƒç”¨<code>range(3)</code>ä¼šè¿”å›ä¸€ä¸ªèŒƒå›´å¯¹è±¡ï¼Œå°±åƒè°ƒç”¨<code>list(&#39;cat&#39;)</code>ä¼šè¿”å›ä¸€ä¸ªåˆ—è¡¨å¯¹è±¡ä¸€æ ·ï¼Œä¸¤è€…éƒ½æ˜¯<strong>å¯è¿­ä»£å¯¹è±¡</strong>ã€‚</p><p>ã€€ã€€<code>for</code>å¾ªç¯ä¼šä½¿ç”¨å¯è¿­ä»£å¯¹è±¡ã€‚åœ¨äº¤äº’å¼shellä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼ŒæŸ¥çœ‹<code>for</code>å¾ªç¯å¦‚ä½•å¯¹èŒƒå›´å¯¹è±¡å’Œåˆ—è¡¨å¯¹è±¡è¿›è¡Œè¿­ä»£ï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>):</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">  <span class="hljs-built_in">print</span>(i) <span class="hljs-comment"># forå¾ªç¯çš„å†…å®¹</span></span><br><span class="hljs-meta prompt_">...</span><br>0<br>1<br>2<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> [<span class="hljs-string">&#x27;c&#x27;</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;t&#x27;</span>]:</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">  <span class="hljs-built_in">print</span>(i) <span class="hljs-comment"># forå¾ªç¯çš„å†…å®¹</span></span><br><span class="hljs-meta prompt_">...</span><br>c<br>a<br>t<br></code></pre></td></tr></table></figure><p>ã€€ã€€æ‰€æœ‰çš„åºåˆ—ç±»å‹éƒ½æ˜¯è¿­ä»£å™¨ï¼Œæ¯”å¦‚èŒƒå›´ã€åˆ—è¡¨ã€å…ƒç»„ã€å­—ç¬¦ä¸²å¯¹è±¡ã€‚ä¸€äº›å®¹å™¨å¯¹è±¡ä¹Ÿæ˜¯è¿­ä»£å™¨ï¼Œæ¯”å¦‚å­—å…¸ã€é›†åˆå’Œæ–‡ä»¶å¯¹è±¡ã€‚</p><p>ã€€ã€€<code>for</code>å¾ªç¯çš„èƒŒåå®é™…ä¸Šæœ‰å¾ˆå¤šæŠ€æœ¯ç»†èŠ‚ã€‚åœ¨å¹•åï¼Œ<code>for</code>å¾ªç¯ä¼šè°ƒç”¨Pythonå†…ç½®çš„<code>iter()</code>å‡½æ•°å’Œ<code>next()</code>å‡½æ•°ã€‚å½“<code>for</code>å¾ªç¯è¿è¡Œæ—¶ï¼Œå¯è¿­ä»£å¯¹è±¡è¢«ä¼ é€’ç»™å†…ç½®çš„<code>iter()</code>å‡½æ•°ï¼Œä½œä¸ºè¿­ä»£å™¨å¯¹è±¡è¢«è¿”å›ã€‚è¿­ä»£å™¨å¯¹è±¡ä¼šä¸€ç›´è·Ÿè¸ªå¾ªç¯ä¸­ä½¿ç”¨çš„å¯è¿­ä»£å¯¹è±¡çš„ä¸‹ä¸€é¡¹ã€‚åœ¨å¾ªç¯çš„æ¯ä¸€æ¬¡è¿­ä»£ä¸­ï¼Œå°†è¿­ä»£å™¨å¯¹è±¡ä¼ é€’ç»™å†…ç½®çš„<code>next()</code>å°±å¯ä»¥è¿”å›è¿­ä»£å™¨ä¸­çš„ä¸‹ä¸€é¡¹ã€‚æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨è°ƒç”¨<code>iter()</code>å‡½æ•°å’Œ<code>next()</code>å‡½æ•°ç›´è§‚åœ°æŸ¥çœ‹<code>for</code>å¾ªç¯çš„å·¥ä½œåŸç†ã€‚åœ¨äº¤äº’å¼shellä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼Œæ‰§è¡Œä¸ä¸Šä¸ªå¾ªç¯ç¤ºä¾‹ç›¸åŒçš„æŒ‡ä»¤ï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">iterableObj = <span class="hljs-built_in">range</span>(<span class="hljs-number">3</span>)</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">iterableObj</span><br>range(0, 3)<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">iteratorObj = <span class="hljs-built_in">iter</span>(iterableObj)</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">i = <span class="hljs-built_in">next</span>(iteratorObj)</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">print</span>(i) <span class="hljs-comment"># å¾ªç¯çš„å†…å®¹</span></span><br>0<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">i = <span class="hljs-built_in">next</span>(iteratorObj)</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">print</span>(i) <span class="hljs-comment"># å¾ªç¯çš„å†…å®¹</span></span><br>1<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">i = <span class="hljs-built_in">next</span>(iteratorObj)</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">print</span>(i) <span class="hljs-comment"># å¾ªç¯çš„å†…å®¹</span></span><br>2<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">i = <span class="hljs-built_in">next</span>(iteratorObj)</span><br>Traceback (most recent call last):<br>  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;<br>StopIteration â¶<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œå½“è¿­ä»£å™¨è¿”å›äº†æœ€åä¸€é¡¹åè¿˜ç»§ç»­è°ƒç”¨<code>next()</code>ï¼ŒPythonä¼šæŠ›å‡º<code>StopIteration</code>å¼‚å¸¸â¶ã€‚ä¸è¿‡ç¨‹åºå¹¶ä¸ä¼šå´©æºƒå¹¶æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ã€‚å®ƒæ˜¯Pythonå†…ç½®ç”¨æ¥ä½¿<code>for</code>å¾ªç¯åˆ¤æ–­ä½•æ—¶åœæ­¢å¾ªç¯çš„æ¡ä»¶ã€‚</p><p>ã€€ã€€ä¸€ä¸ªè¿­ä»£å™¨åªèƒ½åœ¨ä¸€ä¸ªå¯è¿­ä»£é¡¹ä¸Šè¿­ä»£ä¸€æ¬¡ã€‚ç±»ä¼¼äºåªèƒ½ç”¨<code>open()</code>å’Œ<code>readlines()</code>è¯»å–ä¸€æ¬¡æ–‡ä»¶çš„å†…å®¹ï¼Œå¦‚æœæƒ³å†æ¬¡è¯»å–ï¼Œéœ€è¦é‡æ–°æ‰“å¼€æ–‡ä»¶ã€‚å¦‚æœæƒ³å†æ¬¡éå†å¯è¿­ä»£å¯¹è±¡ï¼Œå¿…é¡»å†æ¬¡è°ƒç”¨<code>iter()</code>ï¼Œä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„è¿­ä»£å™¨ã€‚åªè¦ä½ æ„¿æ„ï¼Œå¯ä»¥åˆ›å»ºå¤šä¸ªè¿­ä»£å™¨å¯¹è±¡ï¼Œæ¯ä¸ªè¿­ä»£å™¨å¯¹è±¡ä¼šç‹¬ç«‹åœ°è¿½è¸ªä¸‹ä¸€ä¸ªè¿”å›çš„é¡¹ã€‚åœ¨äº¤äº’å¼shellä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼Œè§‚å¯Ÿè¿è¡Œæƒ…å†µï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">iterableObj = <span class="hljs-built_in">list</span>(<span class="hljs-string">&#x27;cat&#x27;</span>)</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">iterableObj</span><br>[&#x27;c&#x27;, &#x27;a&#x27;, &#x27;t&#x27;]<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">iteratorObj1 = <span class="hljs-built_in">iter</span>(iterableObj)</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">iteratorObj2 = <span class="hljs-built_in">iter</span>(iterableObj)</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">next</span>(iteratorObj1)</span><br>&#x27;c&#x27;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">next</span>(iteratorObj1)</span><br>&#x27;a&#x27;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">next</span>(iteratorObj2)</span><br>&#x27;c&#x27;<br></code></pre></td></tr></table></figure><p>è¦ç‚¹åœ¨äºå¯è¿­ä»£å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’ç»™<code>iter()</code>å‡½æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡ã€‚è¿­ä»£å™¨å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’ç»™<code>next()</code>å‡½æ•°ã€‚å½“ä½ ä½¿ç”¨<code>class</code>è¯­å¥åˆ›å»ºè‡ªå®šä¹‰çš„æ•°æ®ç±»å‹æ—¶ï¼Œåªè¦å®ç°<code>__iter__</code>å’Œ<code>__next__</code>è¿™ä¸¤ä¸ªç‰¹æ®Šæ–¹æ³•ï¼Œå°±èƒ½ä½¿ç”¨<code>for</code>å¾ªç¯éå†å¯¹è±¡ã€‚</p><h3 id="7-2-6-è¯­æ³•é”™è¯¯ã€è¿è¡Œæ—¶é”™è¯¯å’Œè¯­ä¹‰é”™è¯¯"><a href="#7-2-6-è¯­æ³•é”™è¯¯ã€è¿è¡Œæ—¶é”™è¯¯å’Œè¯­ä¹‰é”™è¯¯" class="headerlink" title="7.2.6ã€€è¯­æ³•é”™è¯¯ã€è¿è¡Œæ—¶é”™è¯¯å’Œè¯­ä¹‰é”™è¯¯"></a>7.2.6ã€€è¯­æ³•é”™è¯¯ã€è¿è¡Œæ—¶é”™è¯¯å’Œè¯­ä¹‰é”™è¯¯</h3><p>ã€€ã€€é”™è¯¯çš„åˆ†ç±»æ–¹å¼æ•°ä¸èƒœæ•°ã€‚ä½†å¤§ä½“ä¸Šçœ‹ï¼Œæ‰€æœ‰çš„ç¼–ç¨‹é”™è¯¯éƒ½å¯ä»¥è¢«åˆ†ä¸º3ç±»ï¼šè¯­æ³•é”™è¯¯ã€è¿è¡Œæ—¶é”™è¯¯å’Œè¯­ä¹‰é”™è¯¯ã€‚</p><p>ã€€ã€€<strong>è¯­æ³•</strong>æ˜¯æŸç§ç¼–ç¨‹è¯­è¨€ä¸­æœ‰æ•ˆæŒ‡ä»¤çš„è§„åˆ™é›†ã€‚ç¼ºå°‘å°æ‹¬å·ã€ç”¨å¥ç‚¹é”™è¯¯åœ°ä»£æ›¿äº†é€—å·æˆ–è€…æ‹¼å†™é”™è¯¯éƒ½æ˜¯<strong>è¯­æ³•é”™è¯¯</strong>ï¼Œç¨‹åºä¼šåœ¨è¿è¡Œæ—¶å³åˆ»æŠ›å‡º<code>SyntaxError</code>ã€‚</p><p>ã€€ã€€è¯­æ³•é”™è¯¯ä¹Ÿè¢«ç§°ä¸º<strong>è§£æé”™è¯¯</strong>ï¼Œå½“PythonæŒ‡ä»¤ä¸èƒ½å°†æºä»£ç çš„æ–‡æœ¬è§£ææˆæœ‰æ•ˆçš„æŒ‡ä»¤æ—¶ï¼Œå°±ä¼šå‘ç”Ÿè¯­æ³•é”™è¯¯ã€‚æ‹¿äººç±»è¯­è¨€æ‰“æ¯”æ–¹çš„è¯ï¼Œè¯­æ³•é”™è¯¯ç›¸å½“äºè¯­æ³•ä¸æ­£ç¡®æˆ–è€…å°†ä¸€è¿ä¸²æ²¡æœ‰æ„ä¹‰çš„è¯ç»„æ‹¼å‡‘æˆå¥å­ï¼Œæ¯”å¦‚â€œæœªå—æ±¡æŸ“çš„å¥¶é…ªè‚¯å®šå®ƒæ˜¯â€ã€‚3</p><p>3æ­£ç¡®çš„è¯­å¥æ˜¯â€œå®ƒè‚¯å®šæ˜¯æœªå—æ±¡æŸ“çš„å¥¶é…ªâ€ã€‚â€”â€”è¯‘è€…æ³¨</p><p>ã€€ã€€è®¡ç®—æœºä¸èƒ½è¯»æ‡‚ç¨‹åºå‘˜çš„å†…å¿ƒæƒ³æ³•ï¼Œå®ƒéœ€è¦å…·ä½“çš„æŒ‡ä»¤ï¼Œè€Œå­˜åœ¨è¯­æ³•é”™è¯¯æ—¶ï¼Œè®¡ç®—æœºæ— æ³•æ˜ç¡®è¦åšä»€ä¹ˆï¼Œæ‰€ä»¥ç¨‹åºæ ¹æœ¬ä¸ä¼šè¿è¡Œã€‚</p><p>ã€€<strong>è¿è¡Œæ—¶é”™è¯¯</strong>æ˜¯æŒ‡è¿è¡Œä¸­çš„ç¨‹åºä¸èƒ½æ‰§è¡ŒæŸäº›ä»»åŠ¡ï¼Œæ¯”å¦‚è¯•å›¾æ‰“å¼€ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶æˆ–è€…å°†ä¸€ä¸ªæ•°å­—é™¤ä»¥0ã€‚æ‹¿äººç±»è¯­è¨€æ‰“æ¯”æ–¹çš„è¯ï¼Œè¿è¡Œæ—¶é”™è¯¯ç›¸å½“äºç»™å‡ºä¸€ä¸ªä¸å¯èƒ½çš„æŒ‡ä»¤ï¼Œåƒæ˜¯â€œç”»ä¸€ä¸ªæœ‰ä¸‰æ¡è¾¹çš„æ­£æ–¹å½¢â€ã€‚è¿è¡Œæ—¶é”™è¯¯å¦‚æœæ²¡æœ‰è¢«å¤„ç†ï¼Œç¨‹åºå°±ä¼šå´©æºƒå¹¶æ˜¾ç¤ºå›æº¯ä¿¡æ¯ã€‚å¯ä»¥ä½¿ç”¨<code>try-except</code>è¯­å¥æ•è·è¿è¡Œæ—¶é”™è¯¯å¹¶è¿›è¡Œé”™è¯¯å¤„ç†ã€‚åœ¨äº¤äº’å¼shellä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">slices = <span class="hljs-number">8</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">eaters = <span class="hljs-number">0</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Each person eats&#x27;</span>, slices / eaters, <span class="hljs-string">&#x27;slices.&#x27;</span>)</span><br></code></pre></td></tr></table></figure><p>è¿™æ®µä»£ç åœ¨è¿è¡Œæ—¶ä¼šå±•ç¤ºä»¥ä¸‹å›æº¯ä¿¡æ¯ï¼š</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs vim">Traceback (most recent <span class="hljs-keyword">call</span> <span class="hljs-keyword">last</span>):<br>  File <span class="hljs-string">&quot;&lt;pyshell#4&gt;&quot;</span>, <span class="hljs-built_in">line</span> <span class="hljs-number">1</span>, in <span class="hljs-symbol">&lt;module&gt;</span><br>    <span class="hljs-keyword">print</span>(<span class="hljs-string">&#x27;Each person eats&#x27;</span>, slices / eaters, <span class="hljs-string">&#x27;slices.&#x27;</span>)<br>ZeroDivisionError: division by zero<br></code></pre></td></tr></table></figure><p>ã€€ã€€è¦çŸ¥é“å›æº¯ä¿¡æ¯ä¸­æåˆ°çš„è¡Œå·åªæ˜¯Pythonè§£é‡Šå™¨æ£€æŸ¥åˆ°é”™è¯¯çš„åœ°æ–¹ï¼Œé€ æˆé”™è¯¯çš„çœŸæ­£åŸå› å¯èƒ½æ˜¯åœ¨å‰ä¸€è¡Œä»£ç ï¼Œç”šè‡³æ˜¯æ›´é å‰çš„åœ°æ–¹ã€‚æ˜ç™½è¿™ä¸€ç‚¹éå¸¸é‡è¦ã€‚</p><p>ã€€ã€€ä¸€èˆ¬è€Œè¨€ï¼Œæºä»£ç ä¸­çš„è¯­æ³•é”™è¯¯ä¼šåœ¨ç¨‹åºè¿è¡Œå‰è¢«è§£é‡Šå™¨æ•è·ï¼Œä½†è¯­æ³•é”™è¯¯ä¹Ÿæœ‰å¯èƒ½åœ¨è¿è¡Œæ—¶å‘ç”Ÿã€‚<code>eval()</code>å‡½æ•°å¯ä»¥æ¥å—ä¸€ä¸²Pythonä»£ç å¹¶è¿è¡Œï¼Œè¿™å°±å¯èƒ½å¯¼è‡´è¿è¡Œæ—¶äº§ç”Ÿ<code>SyntaxError</code>ã€‚ä¾‹å¦‚ï¼Œ<code>eval(&#39;print(&quot;Hello, world)&#39;)</code>ç¼ºå°‘äº†æ ‡è®°å­—ç¬¦ä¸²ç»“æŸçš„åŒå¼•å·ï¼Œè€Œç¨‹åºåœ¨è°ƒç”¨<code>eval()</code>ä¹‹å‰ä¸ä¼šå¯Ÿè§‰åˆ°é”™è¯¯ã€‚</p><p>ã€€ã€€<strong>è¯­ä¹‰é”™è¯¯</strong>ï¼ˆä¹Ÿç§°ä¸º<strong>é€»è¾‘é”™è¯¯</strong>ï¼‰æ˜¯ä¸€ç§æ›´ä¸ºå¾®å¦™çš„é”™è¯¯ã€‚è¯­ä¹‰é”™è¯¯å¹¶ä¸ä¼šæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯æˆ–è€…å¯¼è‡´å´©æºƒï¼Œä½†è®¡ç®—æœºæ‰§è¡ŒæŒ‡ä»¤çš„æ–¹å¼ä¼šè·Ÿç¨‹åºå‘˜é¢„æƒ³çš„ä¸åŒã€‚æ‹¿äººç±»è¯­è¨€æ‰“æ¯”æ–¹çš„è¯ï¼Œè¯­ä¹‰é”™è¯¯ç›¸å½“äºå‘Šè¯‰è®¡ç®—æœºï¼šâ€œä»å•†åº—ä¹°ä¸€ç›’ç‰›å¥¶ï¼Œå¦‚æœæœ‰é¸¡è›‹ï¼Œä¹°ä¸€æ‰“ã€‚â€ç»“æœæ˜¯è®¡ç®—æœºä¼šä¹°13ç›’ç‰›å¥¶ã€‚ï¼ˆè®¡ç®—æœºç†è§£çš„æ˜¯ï¼Œå…ˆä¹°ä¸€ç›’ç‰›å¥¶ï¼Œå› ä¸ºå•†åº—æœ‰é¸¡è›‹ï¼Œæ‰€ä»¥åˆä¹°ä¸€æ‰“ç‰›å¥¶ï¼Œä¸€å…±13ç›’ã€‚ï¼‰è®¡ç®—æœºæ— æ³•åˆ¤æ–­å¯¹é”™ï¼Œåªä¼šåŸåŸæœ¬æœ¬åœ°æŒ‰ç…§ä½ çš„æŒ‡ç¤ºå»åšã€‚åœ¨äº¤äº’å¼shellä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;The sum of 4 and 2 is&#x27;</span>, <span class="hljs-string">&#x27;4&#x27;</span> + <span class="hljs-string">&#x27;2&#x27;</span>)</span><br></code></pre></td></tr></table></figure><p>ä½ ä¼šå¾—åˆ°ä»¥ä¸‹è¾“å‡ºï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">The</span> sum of <span class="hljs-number">4</span> and <span class="hljs-number">2</span> is <span class="hljs-number">42</span><br></code></pre></td></tr></table></figure><p>æ˜¾ç„¶42æ˜¯ä¸ªé”™è¯¯ç­”æ¡ˆã€‚ä½†è¯·æ³¨æ„ï¼Œç¨‹åºå¹¶æ²¡æœ‰å´©æºƒã€‚Pythonçš„<code>+</code>è¿ç®—ç¬¦æ—¢å¯ä»¥è®¡ç®—æ•´æ•°ä¹‹å’Œï¼Œä¹Ÿå¯ä»¥ç”¨æ¥è¿æ¥å­—ç¬¦ä¸²ã€‚é”™è¯¯åœ°ä½¿ç”¨å­—ç¬¦ä¸²<code>&#39;4&#39;</code>å’Œ<code>&#39;2&#39;</code>è€Œéæ•´æ•°ç±»å‹çš„<code>4</code>å’Œ<code>2</code>å¯¼è‡´äº†è¿™ä¸€é”™è¯¯ã€‚</p><h3 id="7-2-7-å½¢å‚å’Œå®å‚"><a href="#7-2-7-å½¢å‚å’Œå®å‚" class="headerlink" title="7.2.7ã€€å½¢å‚å’Œå®å‚"></a>7.2.7ã€€å½¢å‚å’Œå®å‚</h3><p>ã€€ã€€<strong>å½¢å‚</strong>æ˜¯<code>def</code>è¯­å¥ä¸­æ‹¬å·å†…çš„å˜é‡åç§°ã€‚<strong>å®å‚</strong>æ˜¯å‡½æ•°è°ƒç”¨ä¸­å®é™…ä¼ é€’çš„å€¼ï¼Œä¼šè¢«èµ‹ç»™å½¢å‚ã€‚åœ¨äº¤äº’å¼shellä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">greeting</span>(<span class="hljs-params">name, species</span>): â¶</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">    <span class="hljs-built_in">print</span>(name + <span class="hljs-string">&#x27; is a &#x27;</span> + description)</span><br><span class="hljs-meta prompt_">...</span><br>&gt;&gt;  greeting(&#x27;Zophie&#x27;, &#x27;cat&#x27;) â·<br>Zophie is a cat<br></code></pre></td></tr></table></figure><p>åœ¨<code>def</code>è¯­å¥ä¸­ï¼Œ<code>name</code>å’Œ<code>species</code>éƒ½æ˜¯å½¢å‚â¶ã€‚åœ¨å‡½æ•°è°ƒç”¨è¯­å¥ä¸­ï¼Œ<code>&#39;Zophie&#39;</code>å’Œ<code>&#39;cat&#39;</code>æ˜¯å®å‚â·ã€‚è¿™ä¸¤ä¸ªæœ¯è¯­ç»å¸¸è¢«æ··ç”¨ï¼Œç»Ÿç§°ä¸º<strong>å‚æ•°</strong>ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œå½¢å‚å¯¹åº”çš„å°±æ˜¯å˜é‡ï¼Œå®å‚å¯¹åº”çš„å°±æ˜¯å€¼ã€‚</p><h3 id="7-2-8-æ˜¾å¼ç±»å‹è½¬æ¢å’Œéšå¼ç±»å‹è½¬æ¢"><a href="#7-2-8-æ˜¾å¼ç±»å‹è½¬æ¢å’Œéšå¼ç±»å‹è½¬æ¢" class="headerlink" title="7.2.8ã€€æ˜¾å¼ç±»å‹è½¬æ¢å’Œéšå¼ç±»å‹è½¬æ¢"></a>7.2.8ã€€æ˜¾å¼ç±»å‹è½¬æ¢å’Œéšå¼ç±»å‹è½¬æ¢</h3><p>ã€€ã€€ä½ å¯ä»¥å°†ä¸€ä¸ªç±»å‹çš„å¯¹è±¡è½¬æ¢ä¸ºå¦ä¸€ä¸ªç±»å‹ã€‚æ¯”å¦‚ï¼Œ<code>int(&#39;42&#39;)</code>ä¼šæŠŠå­—ç¬¦ä¸²<code>&#39;42&#39;</code>è½¬æ¢æˆæ•´æ•°<code>42</code>ã€‚å®é™…ä¸Šï¼Œå¹¶éæ˜¯å­—ç¬¦ä¸²å¯¹è±¡<code>&#39;42&#39;</code>æœ¬èº«è¢«è½¬æ¢äº†ï¼Œè€Œæ˜¯<code>int()</code>å‡½æ•°åŸºäºåŸå¯¹è±¡åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„æ•´æ•°å¯¹è±¡ã€‚è™½ç„¶ç¨‹åºå‘˜éƒ½å°†è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºå¯¹è±¡è½¬æ¢ï¼Œä½†å®é™…ä¸Šè¿™ç§è½¬æ¢çš„åŸç†æ˜¯åŸºäºä¸€ä¸ªæ¨¡å­åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚</p><p>ã€€ã€€Pythonç»å¸¸éšå«åœ°è¿›è¡Œç±»å‹è½¬æ¢ï¼Œæ¯”å¦‚åœ¨è®¡ç®—è¡¨è¾¾å¼<code>2 + 3.0 = 5.0</code>æ—¶ï¼Œæ•°å€¼<code>2</code>å’Œ<code>3.0</code>è¢«å¼ºåˆ¶è½¬æ¢æˆäº†<code>+</code>è¿ç®—ç¬¦å¯ä»¥å¤„ç†çš„ç›¸åŒæ•°æ®ç±»å‹ã€‚è¿™ç§è½¬æ¢è¢«ç§°ä¸º<strong>éšå¼è½¬æ¢</strong>ã€‚</p><p>ã€€ã€€éšå¼è½¬æ¢æœ‰æ—¶å¯èƒ½å¯¼è‡´æ„æƒ³ä¸åˆ°çš„ç»“æœã€‚Pythonä¸­çš„å¸ƒå°”å€¼<code>True</code>å’Œ<code>False</code>å¯ä»¥åˆ†åˆ«è¢«å¼ºåˆ¶è½¬æ¢æˆæ•´æ•°å€¼<code>1</code>å’Œ<code>0</code>ã€‚è¿™æ„å‘³ç€è¡¨è¾¾å¼<code>True + False + True</code>ç­‰æ•ˆäº<code>1 + 0 + 1</code>ï¼Œç»“æœä¸º<code>2</code>ï¼Œä¸è¿‡å®é™…çš„ä»£ç ä¸€èˆ¬ä¸ä¼šè¿™æ ·å†™ã€‚åœ¨å­¦åˆ°è¿™ä¸ªçŸ¥è¯†ç‚¹åï¼Œä½ å¯èƒ½ä¼šæœ‰ä¸€ä¸ªæœ‰è¶£çš„æƒ³æ³•ï¼šæŠŠå¸ƒå°”åˆ—è¡¨ä¼ é€’ç»™<code>sum()</code>å¯ä»¥è®¡ç®—å‡ºåˆ—è¡¨ä¸­çœŸå€¼çš„æ•°é‡ã€‚ä¸è¿‡ï¼Œè°ƒç”¨åˆ—è¡¨çš„<code>count()</code>æ–¹æ³•é€Ÿåº¦ä¼šæ›´å¿«ã€‚</p><h3 id="7-2-9-å±æ€§å’Œç‰¹æ€§"><a href="#7-2-9-å±æ€§å’Œç‰¹æ€§" class="headerlink" title="7.2.9ã€€å±æ€§å’Œç‰¹æ€§"></a>7.2.9ã€€å±æ€§å’Œç‰¹æ€§</h3><p>ã€€ã€€åœ¨è®¸å¤šè¯­è¨€ä¸­ï¼Œæœ¯è¯­<strong>å±æ€§</strong>å’Œ<strong>ç‰¹æ€§</strong>æ˜¯åŒä¹‰è¯ï¼Œä½†åœ¨Pythonä¸­æ˜¯æœ‰åŒºåˆ«çš„ã€‚7.2.3èŠ‚å°†â€œç‰¹æ€§â€è§£é‡Šä¸ºä¸å¯¹è±¡ç»‘å®šçš„ä¸€ä¸ªåå­—ã€‚ç‰¹æ€§åŒ…æ‹¬å¯¹è±¡çš„æˆå‘˜å˜é‡å’Œæ–¹æ³•ã€‚</p><p>ã€€ã€€æœ‰äº›è¯­è¨€ï¼ˆå¦‚Javaï¼‰çš„ç±»æœ‰getteræ–¹æ³•å’Œsetteræ–¹æ³•ï¼Œç¨‹åºä¸èƒ½ç›´æ¥å¯¹æŸä¸ªå±æ€§èµ‹å€¼ï¼ˆä¸ºäº†é¿å…è¢«èµ‹äºˆæ— æ•ˆå€¼ï¼‰ï¼Œè€Œæ˜¯éœ€è¦è°ƒç”¨setteræ–¹æ³•è®¾ç½®å±æ€§ã€‚setteræ–¹æ³•å¯ä»¥ç¡®ä¿æˆå‘˜å˜é‡ä¸ä¼šè¢«åˆ†é…åˆ°æ— æ•ˆå€¼ã€‚getteræ–¹æ³•è¯»å–ç‰¹æ€§çš„å€¼ã€‚å¦‚æœä¸€ä¸ªç‰¹æ€§çš„åç§°ä¸º<code>accountBalance</code>ï¼Œé‚£ä¹ˆå®ƒçš„setteræ–¹æ³•å’Œgetteræ–¹æ³•é€šå¸¸è¢«åˆ†åˆ«å‘½åä¸º<code>setAcccountBalance()</code>å’Œ<code>getAccountBalance()</code>ã€‚</p><p>ã€€ã€€Pythonä¸­çš„å±æ€§å…è®¸ç¨‹åºå‘˜é€šè¿‡æ›´ç®€æ´çš„è¯­æ³•ä½¿ç”¨getterå’Œsetterã€‚ç¬¬17ç« å°†å¯¹Pythonçš„å±æ€§è¿›è¡Œè¯¦ç»†çš„æ¢è®¨ã€‚</p><h3 id="7-2-10-å­—èŠ‚ç å’Œæœºå™¨ç "><a href="#7-2-10-å­—èŠ‚ç å’Œæœºå™¨ç " class="headerlink" title="7.2.10ã€€å­—èŠ‚ç å’Œæœºå™¨ç "></a>7.2.10ã€€å­—èŠ‚ç å’Œæœºå™¨ç </h3><p>ã€€ã€€æºä»£ç è¢«ç¼–è¯‘æˆä¸€ç§å«ä½œ<strong>æœºå™¨ç </strong>çš„æŒ‡ä»¤å½¢å¼ï¼Œç”±CPUç›´æ¥æ‰§è¡Œã€‚æœºå™¨ç ç”±CPU<strong>æŒ‡ä»¤é›†</strong>ï¼ˆæœºå™¨å†…ç½®çš„æŒ‡ä»¤é›†åˆï¼‰çš„æŒ‡ä»¤ç»„æˆã€‚ç”±æœºå™¨ç ç»„æˆçš„ç¼–è¯‘ç¨‹åºè¢«ç§°ä¸º<strong>äºŒè¿›åˆ¶ç¨‹åº</strong>ã€‚åƒCè¿™æ ·ç»å…¸çš„è¯­è¨€æœ‰å¯ä»¥å°†Cæºä»£ç ç¼–è¯‘æˆå‡ ä¹æ‰€æœ‰CPUéƒ½å¯ä»¥ä½¿ç”¨çš„äºŒè¿›åˆ¶æ–‡ä»¶çš„ç¼–è¯‘å™¨è½¯ä»¶ã€‚å¦‚æœåƒPythonè¿™æ ·çš„è¯­è¨€ä¹Ÿæƒ³åœ¨åŒæ ·çš„CPUä¸Šè¿è¡Œï¼Œå°±å¿…é¡»ä¸ºæ¯ä¸€ä¸ªCPUç¼–å†™ä¸€ä¸ªPythonç¼–è¯‘å™¨ï¼Œè€Œè¿™å·¥ä½œé‡å¤ªå¤§äº†ã€‚</p><p>ã€€ã€€é™¤äº†åˆ›å»ºç›´æ¥ç”±CPUç¡¬ä»¶æ‰§è¡Œçš„æœºå™¨ç ï¼Œè¿˜æœ‰å¦å¤–ä¸€ç§å°†æºä»£ç è½¬åŒ–ä¸ºæœºå™¨å¯ä½¿ç”¨çš„ä»£ç çš„æ–¹æ³•ï¼Œé‚£å°±æ˜¯åˆ›å»º<strong>å­—èŠ‚ç </strong>ï¼Œä¹Ÿå«ä½œ<strong>å¯ç§»æ¤ä»£ç </strong>ã€‚å­—èŠ‚ç ç”±è§£é‡Šå™¨ç¨‹åºæ‰§è¡Œï¼Œè€Œéç›´æ¥ç”±CPUæ‰§è¡Œã€‚Pythonçš„å­—èŠ‚ç æ˜¯ç”±ä¸€ä¸ªæŒ‡ä»¤é›†ä¸­çš„æŒ‡ä»¤ç»„æˆçš„ï¼Œä½†å®ƒå¹¶éæ˜¯çœŸçš„CPUçš„æŒ‡ä»¤é›†ã€‚Pythonçš„å­—èŠ‚ç ä¸.pyæ–‡ä»¶å­˜æ”¾åœ¨åŒä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œæ–‡ä»¶æ‰©å±•åä¸º.pycã€‚CPythonè§£é‡Šå™¨æ˜¯ç”¨Cè¯­è¨€ç¼–å†™çš„ï¼Œå®ƒå¯ä»¥å°†Pythonæºä»£ç ç¼–è¯‘æˆPythonå­—èŠ‚ç ï¼Œç„¶åæ‰§è¡Œè¿™äº›æŒ‡ä»¤ã€‚ï¼ˆJavaè™šæ‹Ÿæœºä¹Ÿæ˜¯è¿™æ ·ï¼Œå®ƒæ‰§è¡Œçš„æ˜¯Javaå­—èŠ‚ç ã€‚ï¼‰å› ä¸ºå®ƒæ˜¯ç”¨Cè¯­è¨€ç¼–å†™çš„ï¼Œæ‰€ä»¥å¯ä»¥ä¸ºCè¯­è¨€å·²ç»é€‚é…çš„ä»»ä½•CPUç¼–è¯‘ã€‚</p><p>ã€€ã€€å¯ä»¥çœ‹çœ‹Scott Sandersonå’ŒJoe Jevnikåœ¨PyCon 2016ä¸Šå‘è¡¨çš„æ¼”è®²â€œPlaying with Python Bytecodeâ€ï¼ˆå’ŒPythonå­—èŠ‚ç çš„æ¸¸æˆï¼‰ï¼Œè¿™æ˜¯å­¦ä¹ è¿™ä¸€çŸ¥è¯†ç‚¹çš„ä¼˜ç§€èµ„æºã€‚</p><h3 id="7-2-11-è„šæœ¬å’Œç¨‹åºï¼Œä»¥åŠè„šæœ¬è¯­è¨€å’Œç¼–ç¨‹è¯­è¨€"><a href="#7-2-11-è„šæœ¬å’Œç¨‹åºï¼Œä»¥åŠè„šæœ¬è¯­è¨€å’Œç¼–ç¨‹è¯­è¨€" class="headerlink" title="7.2.11ã€€è„šæœ¬å’Œç¨‹åºï¼Œä»¥åŠè„šæœ¬è¯­è¨€å’Œç¼–ç¨‹è¯­è¨€"></a>7.2.11ã€€è„šæœ¬å’Œç¨‹åºï¼Œä»¥åŠè„šæœ¬è¯­è¨€å’Œç¼–ç¨‹è¯­è¨€</h3><p>ã€€ã€€è„šæœ¬å’Œç¨‹åºï¼Œä»¥åŠè„šæœ¬è¯­è¨€å’Œç¼–ç¨‹è¯­è¨€çš„åŒºåˆ«ä¸€å‘æ˜¯æ¨¡ç³Šçš„ï¼Œå…·æœ‰éšæ„æ€§ã€‚åº”è¯¥è¯´ï¼Œæ‰€æœ‰çš„è„šæœ¬éƒ½æ˜¯ç¨‹åºï¼Œæ‰€æœ‰çš„è„šæœ¬è¯­è¨€éƒ½æ˜¯ç¼–ç¨‹è¯­è¨€ã€‚ä½†æ˜¯è„šæœ¬è¯­è¨€ä¸€èˆ¬è¢«è§†ä¸ºæ›´å®¹æ˜“çš„æˆ–è€…â€œä¸å¤ªå¤Ÿèµ„æ ¼â€çš„ç¼–ç¨‹è¯­è¨€ã€‚åŒºåˆ†è„šæœ¬å’Œç¨‹åºçš„ä¸€ä¸ªæ–¹æ³•æ˜¯æ ¹æ®ä»£ç çš„æ‰§è¡Œæ–¹å¼ã€‚è„šæœ¬è¯­è¨€ç¼–å†™çš„è„šæœ¬æ˜¯ç›´æ¥ä»æºä»£ç è§£é‡Šè¿è¡Œçš„ï¼Œè€Œç¼–ç¨‹è¯­è¨€ç¼–å†™çš„ç¨‹åºåˆ™è¦è¢«ç¼–è¯‘æˆäºŒè¿›åˆ¶æ–‡ä»¶å†æ‰§è¡Œã€‚å°½ç®¡Pythonç¨‹åºè¿è¡Œæ—¶ä¼šæœ‰ç¼–è¯‘å­—èŠ‚ç çš„æ­¥éª¤ï¼Œä½†å®ƒé€šå¸¸è¢«è®¤ä¸ºæ˜¯ä¸€ç§è„šæœ¬è¯­è¨€ã€‚è€ŒJavaè·ŸPythonä¸€æ ·ç”Ÿæˆå­—èŠ‚ç è€Œéæœºå™¨ç äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä½†å®ƒä¸€èˆ¬ä¸è¢«è§†ä¸ºè„šæœ¬è¯­è¨€ã€‚ä»æŠ€æœ¯è§’åº¦æ¥è®²ï¼Œè¯­è¨€æœ¬èº«å¹¶ä¸å­˜åœ¨ç¼–è¯‘å‹æˆ–è€…è§£é‡Šå‹çš„åŒºåˆ«ï¼Œè€Œæ˜¯æœ‰ç¼–è¯‘å™¨æˆ–è€…è§£é‡Šå™¨çš„å®ç°ã€‚å®é™…ä¸Šï¼Œä»»ä½•è¯­è¨€éƒ½å¯ä»¥æœ‰è§£é‡Šå™¨æˆ–è€…ç¼–è¯‘å™¨ã€‚</p><p>ã€€ã€€è¿™ç§å·®å¼‚å¯ä»¥æ‹¿æ¥äº‰è®ºï¼Œä½†å¹¶æ— å¤ªå¤§æ„ä¹‰ã€‚è„šæœ¬è¯­è¨€ä¸ä¸€å®šä¸å¤Ÿå¼ºå¤§ï¼Œç¼–ç¨‹è¯­è¨€ä¹Ÿä¸ä¸€å®šå°±æ›´éš¾è¿ç”¨ã€‚</p><h3 id="7-2-12-åº“ã€æ¡†æ¶ã€SDKã€å¼•æ“ã€API"><a href="#7-2-12-åº“ã€æ¡†æ¶ã€SDKã€å¼•æ“ã€API" class="headerlink" title="7.2.12ã€€åº“ã€æ¡†æ¶ã€SDKã€å¼•æ“ã€API"></a>7.2.12ã€€åº“ã€æ¡†æ¶ã€SDKã€å¼•æ“ã€API</h3><p>ã€€ã€€ä½¿ç”¨åˆ«äººçš„ä»£ç å¯ä»¥èŠ‚çœå¤§é‡æ—¶é—´ã€‚ä½ å¯èƒ½ç»å¸¸ä¼šæ‰¾æ‰“åŒ…å¥½çš„åº“ã€æ¡†æ¶ã€SDKã€å¼•æ“æˆ–APIæ¥ä½¿ç”¨ã€‚å®ƒä»¬çš„åŒºåˆ«å¾ˆå¾®å¦™ä½†å¾ˆé‡è¦ã€‚</p><p>ã€€ã€€<strong>åº“</strong>æ˜¯ä¸€ä¸ªé€šç”¨æœ¯è¯­ï¼Œç”¨æ¥æŒ‡ç¬¬ä¸‰æ–¹åˆ¶ä½œçš„ä»£ç é›†åˆã€‚åº“å¯ä»¥åŒ…å«ä¾›å¼€å‘äººå‘˜ä½¿ç”¨çš„å‡½æ•°ã€ç±»æˆ–è€…å…¶ä»–ä»£ç ç‰‡æ®µã€‚Pythonåº“å¯èƒ½åŒ…å«ä¸€ä¸ªæˆ–ä¸€ç»„åŒ…ï¼Œç”šè‡³åªæ˜¯ä¸€ä¸ªæ¨¡å—ã€‚åº“é€šå¸¸æ˜¯é™äºç‰¹å®šè¯­è¨€çš„ã€‚å¼€å‘äººå‘˜ä¸éœ€è¦çŸ¥é“åº“çš„ä»£ç å¦‚ä½•å·¥ä½œï¼Œåªéœ€è¦çŸ¥é“å¦‚ä½•è°ƒç”¨æˆ–è€…æ¥å…¥åº“ä¸­çš„ä»£ç ã€‚æ ‡å‡†åº“ï¼ˆæ¯”å¦‚Pythonæ ‡å‡†åº“ï¼‰æ˜¯æŒ‡é€‚ç”¨äºè¯¥è¯­è¨€çš„æ‰€æœ‰å®ç°çš„ä»£ç åº“ã€‚</p><p>ã€€ã€€<strong>æ¡†æ¶</strong>æ˜¯ä»£ç çš„é›†åˆï¼Œé€šè¿‡<strong>æ§åˆ¶åè½¬</strong>çš„æ–¹å¼è¿è¡Œã€‚æ¡†æ¶ä¼šæ ¹æ®éœ€è¦è°ƒç”¨å¼€å‘äººå‘˜åˆ›å»ºçš„å‡½æ•°ï¼Œè€Œä¸æ˜¯å¼€å‘äººå‘˜è°ƒç”¨æ¡†æ¶ä¸­çš„å‡½æ•°ã€‚æ§åˆ¶åè½¬çš„ä¸€ç§é€šä¿—æè¿°æ˜¯ï¼šâ€œä¸è¦ç»™æˆ‘ä»¬æ‰“ç”µè¯ï¼Œæˆ‘ä»¬ä¼šç»™ä½ æ‰“ç”µè¯ã€‚â€ä¸¾ä¾‹æ¥è¯´ï¼Œä½¿ç”¨Webåº”ç”¨æ¡†æ¶ç¼–å†™ä»£ç æ—¶éœ€è¦ä¸ºç½‘é¡µåˆ›å»ºå‡½æ•°ï¼Œä»¥ä¾¿Webè¯·æ±‚è¿›å…¥æ—¶æ¡†æ¶ä¼šè°ƒç”¨è¿™äº›å‡½æ•°ã€‚</p><p>ã€€ã€€<strong>è½¯ä»¶å¼€å‘å¥—ä»¶</strong>ï¼ˆsoftware development kitï¼ŒSDKï¼‰åŒ…æ‹¬ä»£ç åº“ã€æ–‡æ¡£å’Œè½¯ä»¶å·¥å…·ï¼Œå®ƒä»¬ç”¨æ¥ååŠ©ä¸ºç‰¹å®šçš„æ“ä½œç³»ç»Ÿæˆ–å¹³å°åˆ›å»ºåº”ç”¨ç¨‹åºã€‚æ¯”å¦‚Android SDKå’ŒiOS SDKåˆ†åˆ«ç”¨äºä¸ºAndroidå’ŒiOSåˆ›å»ºç§»åŠ¨åº”ç”¨ç¨‹åºï¼ŒJavaå¼€å‘å·¥å…·åŒ…ï¼ˆJDKï¼‰æ˜¯Javaè™šæ‹Ÿæœºåˆ›å»ºåº”ç”¨ç¨‹åºçš„SDKã€‚</p><p>ã€€ã€€<strong>å¼•æ“</strong>æ˜¯ä¸€ä¸ªå¤§å‹ã€ç‹¬ç«‹çš„ç³»ç»Ÿï¼Œå¼€å‘äººå‘˜çš„è½¯ä»¶å¯ä»¥å¯¹å…¶è¿›è¡Œå¤–éƒ¨æ§åˆ¶ã€‚å¼€å‘äººå‘˜é€šå¸¸è°ƒç”¨å¼•æ“ä¸­çš„å‡½æ•°æ‰§è¡Œå¤§å‹çš„å¤æ‚ä»»åŠ¡ã€‚å¼•æ“åŒ…æ‹¬æ¸¸æˆå¼•æ“ã€ç‰©ç†å¼•æ“ã€æ¨èå¼•æ“ã€æ•°æ®åº“å¼•æ“ã€å›½é™…è±¡æ£‹å¼•æ“å’Œæœç´¢å¼•æ“ç­‰ã€‚</p><p>ã€€ã€€<strong>åº”ç”¨ç¨‹åºæ¥å£</strong>ï¼ˆapplication programming interfaceï¼ŒAPIï¼‰æ˜¯åº“ã€SDKã€æ¡†æ¶æˆ–å¼•æ“çš„å¯¹å¤–æ¥å£ã€‚APIè§„å®šäº†å¦‚ä½•è°ƒç”¨å‡½æ•°æˆ–å‘åº“æå‡ºè®¿é—®èµ„æºçš„è¯·æ±‚ã€‚åº“çš„ä½œè€…ä¼šæä¾›ï¼ˆå¸Œæœ›å¦‚æ­¤ï¼‰APIæ–‡æ¡£ã€‚è®¸å¤šæµè¡Œçš„ç¤¾äº¤ç±»æˆ–å…¶ä»–ç±»å‹çš„ç½‘ç«™æä¾›äº†HTTP APIï¼Œå…è®¸ç¨‹åºè®¿é—®å®ƒä»¬çš„æœåŠ¡ï¼Œè€Œä¸æ˜¯ç”±äººä½¿ç”¨æµè§ˆå™¨è®¿é—®ã€‚ä½¿ç”¨è¿™äº›APIï¼Œä½ å¯ä»¥ç¼–å†™å‡ºèƒ½å¤Ÿè‡ªåŠ¨å‘å¸ƒFacebookä¿¡æ¯æˆ–è€…é˜…è¯»Twitterçš„æœ€æ–°æ¶ˆæ¯çš„ç¨‹åºã€‚</p>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€pythonã€‘è¯»ä¹¦ç¬”è®°ä¹‹pythonä¹‹ç¦…ï¼ˆå…­ï¼‰</title>
    <link href="/2024/01/06/616python%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8Bpython%E4%B9%8B%E7%A6%85%EF%BC%88%E5%85%AD%EF%BC%89/"/>
    <url>/2024/01/06/616python%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8Bpython%E4%B9%8B%E7%A6%85%EF%BC%88%E5%85%AD%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬-6-ç« -ç¼–å†™Pythoné£æ ¼çš„ä»£ç "><a href="#ç¬¬-6-ç« -ç¼–å†™Pythoné£æ ¼çš„ä»£ç " class="headerlink" title="ç¬¬ 6 ç« ã€€ç¼–å†™Pythoné£æ ¼çš„ä»£ç "></a>ç¬¬ 6 ç« ã€€ç¼–å†™Pythoné£æ ¼çš„ä»£ç </h1><blockquote><p>å¯¹äºç¼–ç¨‹è¯­è¨€æ¥è¯´ï¼Œâ€œå¼ºå¤§â€æ˜¯ä¸€ä¸ªæ¯«æ— æ„ä¹‰çš„å½¢å®¹è¯ã€‚æ¯ä¸€ç§ç¼–ç¨‹è¯­è¨€éƒ½ç§°è‡ªå·±æ˜¯å¼ºå¤§çš„ã€‚å®˜æ–¹çš„Pythonæ•™ç¨‹ä¸€å¼€å§‹å°±è¯´â€œPythonæ˜¯ä¸€ç§æ˜“äºå­¦ä¹ ã€åŠŸèƒ½å¼ºå¤§çš„ç¼–ç¨‹è¯­è¨€â€ï¼Œä½†æ²¡æœ‰å“ªç§ç®—æ³•åªèƒ½ç”¨æŸç§ç‰¹å®šçš„è¯­è¨€ç¼–å†™ï¼Œä¹Ÿæ²¡æœ‰å“ªç§è¡¡é‡å•ä½æ¥é‡åŒ–æŸç§ç¼–ç¨‹è¯­è¨€çš„â€œå‰å®³ç¨‹åº¦â€ï¼ˆå°½ç®¡å¯ä»¥è¡¡é‡ç¨‹åºå‘˜ä¸ºä»–ä»¬æœ€å–œæ¬¢çš„ç¼–ç¨‹è¯­è¨€äº‰å–åœ°ä½çš„å£°éŸ³å¤§å°ï¼‰ã€‚</p></blockquote><p>ã€€ã€€æ¯ç§è¯­è¨€éƒ½æœ‰è‡ªå·±çš„è®¾è®¡æ¨¡å¼å’Œç¼ºé™·ï¼Œå®ƒä»¬æ„æˆäº†è¯­è¨€çš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿ã€‚è¦æƒ³åƒä¸€ä¸ªçœŸæ­£çš„Pythonå¤§å¸ˆä¸€æ ·ç¼–å†™ä»£ç ï¼Œä½ éœ€è¦æ‡‚çš„ä¸ä»…ä»…æ˜¯è¯­æ³•å’Œæ ‡å‡†åº“ï¼Œè¿˜è¦å­¦ä¹ å®ƒçš„ä¹ æƒ¯ç”¨æ³•ï¼Œæˆ–Pythonç‰¹å®šçš„ç¼–ç¨‹æ–¹æ³•ã€‚Pythonè¯­è¨€çš„æŸäº›ç‰¹æ€§æœ‰åŠ©äºç¼–å†™Pythoné£æ ¼çš„ä»£ç ã€‚</p><p>ã€€ã€€åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘å°†æä¾›å‡ ç§ç¼–å†™Pythoné£æ ¼ä»£ç çš„æ–¹æ³•ï¼Œä»¥åŠä¸ä¹‹å¯¹åº”çš„éPythoné£æ ¼çš„å†™æ³•ã€‚å¯¹Pythoné£æ ¼çš„ç†è§£å¯èƒ½å› äººè€Œå¼‚ï¼Œä½†é€šå¸¸åŒ…æ‹¬æœ¬ç« æ‰€å‘ˆç°çš„ç¤ºä¾‹å’Œå®è·µã€‚æœ‰ç»éªŒçš„ç¨‹åºå‘˜éƒ½ä¼šä½¿ç”¨è¿™äº›æŠ€æœ¯ï¼Œç†Ÿæ‚‰è¿™äº›æŠ€æœ¯å¯ä»¥è®©ä½ ä¸€çœ¼çœ‹æ‡‚å®é™…çš„å·¥ç¨‹ä»£ç ã€‚</p><h2 id="6-1-Pythonä¹‹ç¦…"><a href="#6-1-Pythonä¹‹ç¦…" class="headerlink" title="6.1ã€€Pythonä¹‹ç¦…"></a>6.1ã€€Pythonä¹‹ç¦…</h2><p>ã€€ã€€Tim Petersçš„â€œPythonä¹‹ç¦…â€æ±‡é›†äº†Pythonè¯­è¨€è®¾è®¡å’ŒPythonç¼–ç¨‹çš„20æ¡å‡†åˆ™ã€‚ä½ çš„Pythonä»£ç ä¸ä¸€å®šå¿…é¡»éµå¾ªè¿™äº›å‡†åˆ™ï¼Œä½†å®ƒä»¬ä¸æ— è£¨ç›Šã€‚â€œPythonä¹‹ç¦…â€ä¹Ÿæ˜¯ä¸€ä¸ªå¤æ´»èŠ‚å½©è›‹ï¼Œæˆ–è€…è¯´æ˜¯éšè—çš„ç¬‘è¯ï¼Œå½“è¿è¡Œ<code>import this</code>æ—¶å°±ä¼šå‡ºç°ã€‚</p><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs fortran">&gt;&gt;&gt; <span class="hljs-keyword">import</span> this<br>The Zen of Python, by Tim Peters<br><br>Beautiful is better than ugly.<br>Explicit is better than <span class="hljs-keyword">implicit</span>.<br>--snip--<br></code></pre></td></tr></table></figure><blockquote><p><strong>æ³¨æ„</strong>ã€€ç¥å¥‡çš„æ˜¯ï¼Œå®é™…ä¸Šåªæœ‰19æ¡å‡†åˆ™å†™äº†å‡ºæ¥ã€‚æ®Pythonä¹‹çˆ¶Guido van Rossumæ‰€è¯´ï¼Œç¼ºå¤±çš„ç¬¬20æ¡ç®´è¨€æ˜¯Tim Petersçš„ææ€ªçš„è¡Œå†…ç¬‘è¯ï¼ŒTimç•™å‡ºåœ°æ–¹è®©Guidoæ¥å†™ï¼Œä½†çœ‹èµ·æ¥ä»–ä¸€ç›´æ²¡åšåˆ°ã€‚</p></blockquote><p>ã€€ã€€æ€»ä½“æ¥è¯´ï¼Œè¿™äº›å‡†åˆ™æ˜¯ç¨‹åºå‘˜å¯ä»¥æ”¯æŒæˆ–è€…åå¯¹çš„è§‚ç‚¹ã€‚å°±åƒä¸€äº›ä¼˜ç§€çš„é“å¾·å‡†åˆ™ä¸€æ ·ï¼Œå®ƒä»¬åœ¨ä¸€å®šç¨‹åº¦ä¸Šæœ‰äº›è‡ªç›¸çŸ›ç›¾ï¼Œä½†èƒ½æä¾›æ›´å¤§çš„çµæ´»æ€§ã€‚ä»¥ä¸‹æ˜¯æˆ‘å¯¹è¿™äº›ç®´è¨€çš„è§£é‡Šã€‚</p><blockquote><p>ã€€ã€€ã€€ã€€<strong>ç¾ä¸½èƒœäºä¸‘é™‹ã€‚</strong>ç¾ä¸½çš„ä»£ç æŒ‡æ˜“äºé˜…è¯»å’Œç†è§£çš„ä»£ç ã€‚ç¨‹åºå‘˜ç»å¸¸å¿«é€Ÿç¼–å†™ä»£ç ï¼Œä¸è€ƒè™‘å¯è¯»æ€§ã€‚è™½ç„¶è®¡ç®—æœºä¼šè¿è¡Œå¯è¯»æ€§ä¸å¼ºçš„ä»£ç ï¼Œä½†è¿™æ ·çš„ä»£ç å¯¹äºç¨‹åºå‘˜è€Œè¨€ä¸å®¹æ˜“ç»´æŠ¤å’Œè°ƒè¯•ã€‚è™½ç„¶ç¾æ˜¯ä¸»è§‚çš„ï¼Œä½†ä¸è€ƒè™‘å¯è¯»æ€§çš„ä»£ç åœ¨åˆ«äººçœ‹æ¥å¾€å¾€æ˜¯ä¸‘é™‹çš„ã€‚Pythonä¹‹æ‰€ä»¥å—æ¬¢è¿ï¼Œæ˜¯å› ä¸ºå®ƒçš„è¯­æ³•ä¸åƒå…¶ä»–è¯­è¨€é‚£æ ·å……æ–¥ç€ç¥ç§˜çš„æ ‡ç‚¹ç¬¦å·ï¼ŒPythonå¾ˆå®¹æ˜“ç¼–å†™ã€‚</p><p>ã€€ã€€ã€€ã€€<strong>æ˜ç¡®èƒœäºéšå«ã€‚</strong>å¦‚æœæˆ‘ç»™è¿™æ¡ç®´è¨€çš„è§£é‡Šæ˜¯â€œè¿™æ˜¯ä¸è¨€è€Œå–»çš„â€ï¼Œé‚£å®ƒå°±æ˜¯ä¸€ä¸ªç³Ÿç³•çš„è§£é‡Šã€‚ä»£ç åº”è¯¥æ˜¯è¯¦ç»†æ˜ç¡®çš„ï¼Œåº”é¿å…æŠŠä»£ç çš„åŠŸèƒ½éšåŒ¿åœ¨æ™¦æ¶©çš„ã€ä¸”éœ€è¦å¯¹è¯­è¨€éå¸¸ç†Ÿæ‚‰æ‰èƒ½ç†è§£çš„è¯­è¨€ç‰¹æ€§ä¸­ã€‚</p><p>ã€€ã€€ã€€ã€€<strong>ç®€å•èƒœäºå¤æ‚ã€‚å¤æ‚èƒœäºæ›´å¤æ‚ã€‚</strong>è¿™ä¸¤å¥ç®´è¨€å‘Šè¯‰æˆ‘ä»¬ï¼Œä»»ä½•ä¸œè¥¿éƒ½æ—¢å¯ä»¥ç”¨ç®€å•çš„æŠ€æœ¯å»ºé€ ï¼Œä¹Ÿå¯ä»¥ç”¨å¤æ‚çš„æŠ€æœ¯å»ºé€ ã€‚å¦‚æœä½ æœ‰ä¸€ä¸ªå°é—®é¢˜ç”¨é“²å­å°±å¯ä»¥è§£å†³ï¼Œä½¿ç”¨50å¨çº§çš„æ¶²å‹æ¨åœŸæœºå°±æœ‰äº›å¤§æå°ç”¨ã€‚ä½†å¦‚æœæ˜¯ä¸ªå¤§å·¥ç¨‹ï¼Œé‚£ä¹ˆæ“ä½œä¸€å°æ¨åœŸæœºæ¯”åè°ƒ100åé“²è¿å·¥è¦ç®€å•å¾—å¤šã€‚æ‰€ä»¥ï¼Œè¦é€‰æ‹©ç®€å•è€Œéå¤æ‚ï¼Œä½†ä¹Ÿè¦çŸ¥é“ç®€å•æ–¹æ¡ˆçš„å±€é™æ€§ã€‚</p><p>ã€€ã€€ã€€ã€€<strong>æ‰å¹³èƒœäºåµŒå¥—ã€‚</strong>ç¨‹åºå‘˜å–œæ¬¢å°†ä»£ç æŒ‰ç…§ç±»åˆ«è¿›è¡Œç»„ç»‡ï¼Œç‰¹åˆ«æ˜¯ç±»åˆ«åˆåŒ…å«å­ç±»åˆ«ï¼Œè€Œå­ç±»åˆ«åˆåŒ…å«æ›´ç»†çš„å­ç±»åˆ«ã€‚è¿™äº›å±‚çº§ç»“æ„å¾€å¾€å¹¶ä¸ä¼šå¢å¼ºä»£ç çš„ç»„ç»‡æ€§ï¼Œè€Œæ˜¯å¢å¼ºäº†å®˜åƒšæ€§ã€‚åªåœ¨ä¸€ä¸ªé¡¶å±‚æ¨¡å—æˆ–è€…æ•°æ®ç»“æ„ä¸­ç¼–å†™ä»£ç å¹¶æ— ä¸å¦¥ã€‚å¦‚æœä½ çš„ä»£ç çœ‹èµ·æ¥åƒ<code>spam.eggs.bacon.ham()</code>æˆ–<code>spam[&#39;eggs&#39;][&#39;bacon&#39;][&#39;ham&#39;]</code>ï¼Œé‚£å®ƒå°±å¤ªè¿‡å¤æ‚äº†ã€‚</p><p>ã€€ã€€ã€€ã€€<strong>ç¨€ç–èƒœäºå¯†é›†ã€‚</strong>ç¨‹åºå‘˜ç»å¸¸å–œæ¬¢æŠŠå°½å¯èƒ½å¤šçš„åŠŸèƒ½å¡è¿›å°½å¯èƒ½å°‘çš„ä»£ç ä¸­ï¼Œå°±åƒä¸‹é¢è¿™ä¸€è¡Œï¼š<code>print(&#39;\n&#39;.join(&quot;%i bytes = %i bits which has %i possiblevalues.&quot; % (j, j*8, 256**j-1) for j in (1 &lt;&lt; i for i in range(8))))</code>ã€‚å°½ç®¡è¿™æ ·çš„ä»£ç å¯ä»¥ç»™æœ‹å‹ç•™ä¸‹æ·±åˆ»å°è±¡ï¼Œä½†ä¼šæƒ¹æ€’åŒäº‹ï¼Œå› ä¸ºä»–ä»¬å¾—è´¹å°½å¿ƒæ€ç†è§£è¿™æ®µä»£ç ã€‚ä¸è¦è®©ä»£ç ä¸€æ¬¡åšå¤ªå¤šçš„äº‹æƒ…ã€‚åˆ†æ•£åœ¨å¤šè¡Œçš„ä»£ç å¾€å¾€æ¯”å¯†é›†çš„å•è¡Œä»£ç æ›´å®¹æ˜“é˜…è¯»ã€‚è¿™å¥ç®´è¨€ä¸â€œç®€å•èƒœäºå¤æ‚â€ç±»ä¼¼ã€‚</p><p>ã€€ã€€â€‹<strong>å¯è¯»æ€§å¾ˆé‡è¦ã€‚</strong>å°½ç®¡å¯¹äºé‚£äº›ä»1970å¹´å°±å¼€å§‹ç”¨Cè¯­è¨€ç¼–ç¨‹çš„äººè€Œè¨€ï¼Œ<code>strcmp()</code>æ˜¾è€Œæ˜“è§æŒ‡çš„æ˜¯â€œstring compareâ€ï¼ˆå­—ç¬¦ä¸²æ¯”è¾ƒï¼‰å‡½æ•°ï¼Œä½†ç°ä»£è®¡ç®—æœºçš„å†…å­˜è¶³ä»¥è®©ä½ ç¼–å†™å®Œæ•´çš„å‡½æ•°åç§°ã€‚ä¸è¦ä»å®Œæ•´çš„åç§°ä¸­åˆ é™¤æŸäº›å­—æ¯æˆ–è€…å†™è¿‡åˆ†ç®€æ´çš„ä»£ç ã€‚èŠ±ç‚¹æ—¶é—´ä¸ºå˜é‡å’Œå‡½æ•°æƒ³å‡ºå…·æœ‰æè¿°æ€§ä¸”å…·ä½“çš„åç§°ã€‚ä»£ç å„ä¸ªéƒ¨åˆ†ä¹‹é—´çš„ç©ºè¡Œä¸ä¹¦ä¸­èµ·åˆ†éš”ä½œç”¨çš„æ®µè½ä¸€æ ·ï¼Œå¯ä»¥è®©è¯»è€…çŸ¥é“å“ªäº›éƒ¨åˆ†åº”è¯¥æ”¾åœ¨ä¸€èµ·é˜…è¯»ã€‚è¿™å¥ç®´è¨€ä¸â€œç¾ä¸½èƒœäºä¸‘é™‹â€ç±»ä¼¼ã€‚</p><p>ã€€ã€€ã€€ã€€<strong>ç‰¹æ®Šæƒ…å†µå¹¶æ²¡æœ‰ç‰¹æ®Šåˆ°æ‰“ç ´è§„åˆ™çš„åœ°æ­¥ã€‚ä¸è¿‡ï¼Œå®ç”¨æ€§èƒœäºçº¯ç²¹æ€§ã€‚</strong>è¿™ä¸¤å¥ç®´è¨€çœ‹èµ·æ¥ç›¸äº’çŸ›ç›¾ã€‚åœ¨ç¼–ç¨‹è¿‡ç¨‹ä¸­ï¼Œæœ‰å¾ˆå¤šâ€œæœ€ä½³å®è·µâ€å€¼å¾—ç¨‹åºå‘˜åŠªåŠ›è·µè¡Œã€‚ä¸€æ–¹é¢ï¼Œç»•è¿‡è¿™äº›å®è·µï¼Œå¿«é€Ÿå®ç°éœ€æ±‚çš„æƒ³æ³•ä¹Ÿè®¸å¾ˆè¯±äººï¼Œä½†å¯èƒ½ä¼šå¯¼è‡´ä¸€å †ä¸ä¸€è‡´ã€ä¸å¯è¯»çš„ä»£ç çƒ‚æ‘Šå­ã€‚å¦ä¸€æ–¹é¢ï¼Œå¦¥åéµå®ˆä¸€äº›è§„åˆ™å¯èƒ½ä¼šå¯¼è‡´é«˜åº¦æŠ½è±¡ã€ä¸å¯è¯»çš„ä»£ç ã€‚æ¯”å¦‚ï¼ŒJavaè¯•å›¾è®©æ‰€æœ‰ä»£ç éƒ½ç¬¦åˆé¢å‘å¯¹è±¡çš„èŒƒå¼ï¼Œè¿™å¾€å¾€ä¼šå¯¼è‡´å³ä½¿å¾ˆå°çš„ç¨‹åºä¹Ÿæœ‰å¾ˆå¤šæ¨¡æ¿ä»£ç ã€‚éšç€ç»éªŒä¸æ–­ç§¯ç´¯ï¼Œä½ åœ¨è¿™ä¸¤æ¡ç®´è¨€ä¹‹é—´å–èˆå°†ä¼šå˜å¾—è¶Šæ¥è¶Šå®¹æ˜“ã€‚æ—¶é—´é•¿äº†ï¼Œä½ ä¸ä»…å¯ä»¥å­¦ä¼šéµå¾ªè§„åˆ™ï¼Œè€Œä¸”å°†å­¦ä¼šä½•æ—¶æ‰“ç ´è§„åˆ™ã€‚</p><p>ã€€ã€€ã€€ã€€<strong>é™¤éå¿…è¦ï¼Œå¦åˆ™é”™è¯¯ä¸è¯¥è¢«æ‚„æ— å£°æ¯åœ°å¿½ç•¥ã€‚</strong>ç¨‹åºå‘˜ç»å¸¸å¿½ç•¥é”™è¯¯ä¿¡æ¯ï¼Œä½†è¿™å¹¶ä¸æ„å‘³ç€ç¨‹åºä¹Ÿæ˜¯è¿™æ ·ã€‚å½“å‡½æ•°è¿”å›é”™è¯¯ä»£ç æˆ–<code>None</code>è€Œä¸æ˜¯æç¤ºå¼‚å¸¸æ—¶ï¼Œâ€œæ— å£°çš„é”™è¯¯â€å°±ä¼šå‘ç”Ÿã€‚è¿™æ¡ç®´è¨€çš„æ„æ€æ˜¯ï¼Œç¨‹åºå¿«é€Ÿå¤±è´¥å’Œå´©æºƒè¦æ¯”ä¸æç¤ºé”™è¯¯å¹¶ç»§ç»­è¿è¡Œå¥½ã€‚åæ¥å‘ç”Ÿçš„ä¸å¯é¿å…çš„é”™è¯¯å°†æ›´åŠ éš¾ä»¥è°ƒè¯•ï¼Œå› ä¸ºå®ƒä»¬æ˜¯åœ¨å‡ºç°æºå¤´é—®é¢˜ä¹‹åå¾ˆä¹…æ‰è¢«å‘ç°çš„ã€‚å°½ç®¡ä½ éšæ—¶å¯ä»¥å¿½ç•¥ç¨‹åºå¼•èµ·çš„é”™è¯¯ï¼Œä½†è¦ç¡®ä¿è¿™æ ·åšæœ‰å……è¶³çš„ç†ç”±ã€‚</p><p>ã€€ã€€ã€€ã€€<strong>é¢å¯¹æ¨¡æ£±ä¸¤å¯çš„é—®é¢˜ï¼Œä¸è¦çŒœæµ‹ã€‚</strong>è®¡ç®—æœºä½¿äººç±»å˜å¾—è¿·ä¿¡ï¼Œæœ‰å¥è¯æ˜¯â€œé‡å¯è®¡ç®—æœºï¼ŒåŒ…æ²»ç™¾ç—…â€ã€‚ä½†è®¡ç®—æœºæ²¡æœ‰ç¥å¥‡çš„é­”æ³•ã€‚ä»£ç æœªèƒ½æ­£å¸¸æ‰§è¡Œæ˜¯æœ‰æ˜ç¡®åŸå› çš„ï¼Œåªæœ‰é€šè¿‡ä»”ç»†ã€æ‰¹åˆ¤æ€§çš„æ€è€ƒæ‰èƒ½è§£å†³é—®é¢˜ã€‚æ‹’ç»é€šè¿‡ç›²ç›®å°è¯•æ¥è§£å†³é—®é¢˜ï¼Œè¿™æ ·åšå¾€å¾€åªä¼šæ©ç›–é—®é¢˜ï¼Œè€Œä¸èƒ½çœŸæ­£è§£å†³é—®é¢˜ã€‚</p><p>ã€€ã€€ã€€ã€€<strong>åº”è¯¥æœ‰ä¸€ä¸ªï¼Œæœ€å¥½åªæœ‰ä¸€ä¸ªæ˜æ˜¾çš„æ–¹æ³•èƒ½ä½¿ç”¨ã€‚</strong>è¿™æ˜¯å¯¹Perlç¼–ç¨‹è¯­è¨€çš„åº§å³é“­â€œæœ‰ä¸æ­¢ä¸€ç§æ–¹æ³•èƒ½ç”¨â€çš„æŠ¨å‡»ã€‚äº‹å®è¯æ˜ï¼Œæœ‰ä¸‰å››ç§æ–¹æ³•å®ŒæˆåŒæ ·çš„ä»»åŠ¡æ˜¯ä¸€æŠŠåŒåˆƒå‰‘ï¼šåå¤„æ˜¯ä¸ºäº†èƒ½è¯»æ‡‚å…¶ä»–äººå†™çš„ä»£ç ï¼Œä½ ä¸å¾—ä¸å­¦ä¼šæ‰€æœ‰å¯èƒ½çš„å†™æ³•ï¼›å¥½å¤„æ˜¯åœ¨ç¼–å†™ä»£ç æ—¶ï¼Œä½ å¯ä»¥çµæ´»åœ°ä½¿ç”¨å¤šç§å†™æ³•ã€‚ä¸è¿‡ï¼Œè¿™ç§çµæ´»æ€§æ˜¯å¾—ä¸å¿å¤±çš„ï¼Œæœ€å¥½åªæœ‰ä¸€ä¸ªæ˜æ˜¾çš„æ–¹æ³•èƒ½ä½¿ç”¨ã€‚</p><p>ã€€ã€€ã€€ã€€<strong>é™¤éä½ æ˜¯è·å…°äººï¼Œå¦åˆ™è¿™ç§æ–¹æ³•å¯èƒ½å¹¶ä¸é‚£ä¹ˆæ˜¾è€Œæ˜“è§ã€‚</strong>è¿™æ˜¯ä¸€å¥ç©ç¬‘è¯ã€‚Pythonçš„åˆ›é€ è€…Guido van Rossumæ˜¯è·å…°äººã€‚<strong>1</strong></p><p>ã€€ã€€ã€€<strong>æœ‰æ€»æ¯”æ²¡æœ‰å¥½ã€‚ç„¶è€Œä¸ç»æ€è€ƒå°±åšè¿˜ä¸å¦‚ä¸åšã€‚****2</strong>è¿™ä¸¤å¥ç®´è¨€æ˜¯è¯´ï¼Œè¿è¡Œé€Ÿåº¦æ…¢çš„ä»£ç æ˜¾ç„¶æ¯”ä¸ä¸Šè¿è¡Œé€Ÿåº¦å¿«çš„ä»£ç ã€‚ä½†æ˜¯ï¼Œå¤šç­‰å¾…ç¨‹åºè¿è¡Œä¸€ä¼šå„¿æ€»æ¯”ç¨‹åºå°½å¿«è¿è¡Œå®Œå´å‘ç°ç»“æœæ˜¯é”™çš„è¦å¥½ã€‚</p><p>ã€€ã€€ã€€ã€€<strong>å¦‚æœå®ç°å¾ˆéš¾è§£é‡Šï¼Œå®ƒå°±æ˜¯ä¸ªåä¸»æ„ï¼›å¦‚æœå®ç°å¾ˆå®¹æ˜“è§£é‡Šï¼Œè¿™å¯èƒ½æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ã€‚</strong>è®¸å¤šäº‹æƒ…éšç€æ—¶é—´çš„æ¨ç§»å˜å¾—è¶Šæ¥è¶Šå¤æ‚ï¼Œæ¯”å¦‚ç¨æ³•ã€æ‹çˆ±å…³ç³»ã€Pythonç¼–ç¨‹ä¹¦ã€‚è½¯ä»¶ä¹Ÿä¸ä¾‹å¤–ã€‚è¿™å¥ç®´è¨€æé†’æˆ‘ä»¬ï¼Œå¦‚æœä»£ç å¤æ‚åˆ°è®©ä¸“ä¸šäººå‘˜æ— æ³•ç†è§£å’Œè°ƒè¯•çš„ç¨‹åº¦ï¼Œé‚£å°±æ˜¯åä»£ç ã€‚ä½†æ˜¯ï¼Œå¾ˆå®¹æ˜“è¢«è§£é‡Šçš„ä»£ç ä¹Ÿä¸ä¸€å®šå°±æ˜¯å¥½ä»£ç ã€‚é—æ†¾çš„æ˜¯ï¼Œå†™å‡ºå°½å¯èƒ½ç®€å•çš„ä»£ç å¹¶éæ˜“äº‹ã€‚</p><p>ã€€ã€€ã€€ã€€<strong>å‘½åç©ºé—´æ˜¯ä¸€ä¸ªå¾ˆæ£’çš„ä¸»æ„ï¼Œå¯ä»¥å¤šç”¨ã€‚</strong>å‘½åç©ºé—´æ˜¯æ ‡è¯†ç¬¦çš„ç‹¬ç«‹å®¹å™¨ï¼Œç”¨æ¥é˜²æ­¢å‘½åå†²çªã€‚ä¾‹å¦‚ï¼Œå†…ç½®å‡½æ•°<code>open()</code>å’Œ<code>webbrowser.open()</code>å‡½æ•°æœ‰ç›¸åŒçš„åå­—ï¼Œä½†å¯¹åº”ä¸åŒçš„å‡½æ•°ã€‚å¯¼å…¥<code>webbrowser</code>ä¸ä¼šè¦†ç›–å†…ç½®çš„<code>open()</code>å‡½æ•°ï¼Œå› ä¸ºè¿™ä¸¤ä¸ª<code>open()</code>å‡½æ•°å­˜åœ¨äºä¸åŒçš„å‘½åç©ºé—´ï¼Œåˆ†åˆ«æ˜¯å†…ç½®å‘½åç©ºé—´å’Œ<code>webbrowser</code>æ¨¡å—çš„å‘½åç©ºé—´ã€‚ä½†è¦è®°ä½ï¼Œæ‰å¹³èƒœäºåµŒå¥—ã€‚å°½ç®¡å‘½åç©ºé—´ç¡®å®å¾ˆå¥½ï¼Œä½†ä½ åº”è¯¥åªä¸ºé˜²æ­¢å‘½åå†²çªè€Œä½¿ç”¨å‘½åç©ºé—´ï¼Œè€Œä¸æ˜¯æ·»åŠ ä¸å¿…è¦çš„åˆ†</p></blockquote><h2 id="6-2-å­¦ç€å–œæ¬¢å¼ºåˆ¶ç¼©è¿›"><a href="#6-2-å­¦ç€å–œæ¬¢å¼ºåˆ¶ç¼©è¿›" class="headerlink" title="6.2ã€€å­¦ç€å–œæ¬¢å¼ºåˆ¶ç¼©è¿›"></a>6.2ã€€å­¦ç€å–œæ¬¢å¼ºåˆ¶ç¼©è¿›</h2><h2 id="6-3-ä½¿ç”¨timeitæ¨¡å—è¡¡é‡æ€§èƒ½"><a href="#6-3-ä½¿ç”¨timeitæ¨¡å—è¡¡é‡æ€§èƒ½" class="headerlink" title="6.3ã€€ä½¿ç”¨timeitæ¨¡å—è¡¡é‡æ€§èƒ½"></a>6.3ã€€ä½¿ç”¨<code>timeit</code>æ¨¡å—è¡¡é‡æ€§èƒ½</h2><h2 id="6-4-å¸¸è¢«è¯¯ç”¨çš„è¯­æ³•"><a href="#6-4-å¸¸è¢«è¯¯ç”¨çš„è¯­æ³•" class="headerlink" title="6.4ã€€å¸¸è¢«è¯¯ç”¨çš„è¯­æ³•"></a>6.4ã€€å¸¸è¢«è¯¯ç”¨çš„è¯­æ³•</h2><p>ã€€ã€€å¦‚æœPythonä¸æ˜¯ä½ çš„ç¬¬ä¸€é—¨ç¼–ç¨‹è¯­è¨€ï¼Œé‚£ä¹ˆä½ å¯èƒ½ä¼šç”¨å…¶ä»–ç¼–ç¨‹è¯­è¨€çš„ä»£ç ç¼–å†™ç­–ç•¥æ¥å†™Pythonä»£ç ã€‚æˆ–è€…å› ä¸ºä¸çŸ¥é“æœ‰æ›´å¤šæ—¢å®šçš„æœ€ä½³å®è·µï¼Œä½ å­¦äº†ä¸€ç§å¹¶ä¸å¸¸è§çš„Pythonç¼–å†™æ–¹å¼ã€‚è¿™ç§ä¸ä¼˜é›…çš„ä»£ç ä¹Ÿèƒ½ç”¨ï¼Œä½†ä½ å¯ä»¥å­¦ä¹ æ›´å¤šç¼–å†™Pythonä»£ç çš„æ ‡å‡†æ–¹æ³•ä»¥èŠ‚çœæ—¶é—´å’Œç²¾åŠ›ã€‚æœ¬èŠ‚è®²è¿°äº†ç¨‹åºå‘˜å¸¸è§çš„é”™è¯¯ï¼Œä»¥åŠè¯¥å¦‚ä½•ç¼–å†™ä»£ç ã€‚</p><h3 id="6-4-1-ä½¿ç”¨enumerate-è€Œä¸æ˜¯range"><a href="#6-4-1-ä½¿ç”¨enumerate-è€Œä¸æ˜¯range" class="headerlink" title="6.4.1ã€€ä½¿ç”¨enumerate()è€Œä¸æ˜¯range()"></a>6.4.1ã€€ä½¿ç”¨<code>enumerate()</code>è€Œä¸æ˜¯<code>range()</code></h3><p>ã€€ã€€å½“åœ¨ä¸€ä¸ªåˆ—è¡¨æˆ–è€…å…¶ä»–åºåˆ—ä¸Šå¾ªç¯æ—¶ï¼Œä¸€äº›ç¨‹åºå‘˜ä½¿ç”¨<code>range()</code>å‡½æ•°å’Œ<code>len()</code>å‡½æ•°ç”Ÿæˆä»0åˆ°åºåˆ—é•¿åº¦âˆ’1çš„ç´¢å¼•æ•´æ•°ã€‚åœ¨è¿™äº›<code>for</code>å¾ªç¯ä¸­é€šå¸¸ä½¿ç”¨å˜é‡<code>i</code>ï¼ˆä»£è¡¨indexï¼‰ã€‚ä¾‹å¦‚åœ¨äº¤äº’å¼shellä¸­è¾“å…¥ä¸‹é¢è¿™ä¸ªä¸ç¬¦åˆPythoné£æ ¼çš„ç¤ºä¾‹ï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">animals = [<span class="hljs-string">&#x27;cat&#x27;</span>, <span class="hljs-string">&#x27;dog&#x27;</span>, <span class="hljs-string">&#x27;moose&#x27;</span>]</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(animals)):</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">    <span class="hljs-built_in">print</span>(i, animals[i])</span><br><span class="hljs-meta prompt_">...</span><br>0 cat<br>1 dog<br>2 moose<br></code></pre></td></tr></table></figure><p><code>range(len())</code>çš„ä¼ ç»Ÿå†™æ³•æ¯”è¾ƒç›´æ¥ï¼Œä½†ä¸å¤Ÿç†æƒ³ï¼Œå› ä¸ºå®ƒçš„å¯è¯»æ€§ä¸å¥½ã€‚æ›´å¥½çš„åšæ³•æ˜¯å°†åˆ—è¡¨æˆ–è€…åºåˆ—ä¼ é€’ç»™å†…ç½®çš„<code>enumerate()</code>å‡½æ•°ï¼Œå®ƒå°†è¿”å›ç´¢å¼•çš„æ•´æ•°å€¼å’Œå½“å‰ç´¢å¼•å¯¹åº”çš„é¡¹ã€‚æ¯”å¦‚ï¼Œå¯ä»¥ç¼–å†™ä¸‹é¢è¿™ç§Pythoné£æ ¼çš„ä»£ç ï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-comment"># Pythoné£æ ¼çš„ç¤ºä¾‹</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">animals = [<span class="hljs-string">&#x27;cat&#x27;</span>, <span class="hljs-string">&#x27;dog&#x27;</span>, <span class="hljs-string">&#x27;moose&#x27;</span>]</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">for</span> i, animal <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(animals):</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">    <span class="hljs-built_in">print</span>(i, animal)</span><br><span class="hljs-meta prompt_">...</span><br>0 cat<br>1 dog<br>2 moos<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨<code>enumerate()</code>æ›¿ä»£<code>range(len())</code>å¯ä»¥è®©ä½ çš„ä»£ç æ•´æ´ä¸€ç‚¹ã€‚å¦‚æœä½ åªéœ€è¦åˆ—è¡¨ä¸­çš„é¡¹è€Œä¸éœ€è¦ç´¢å¼•ï¼Œå¯ä»¥ç”¨ä¸‹é¢è¿™ç§Pythoné£æ ¼çš„æ–¹å¼è¿­ä»£åˆ—è¡¨ï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-comment"># Pythoné£æ ¼çš„ç¤ºä¾‹</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">animals = [<span class="hljs-string">&#x27;cat&#x27;</span>, <span class="hljs-string">&#x27;dog&#x27;</span>, <span class="hljs-string">&#x27;moose&#x27;</span>]</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">for</span> animal <span class="hljs-keyword">in</span> animals:</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">    <span class="hljs-built_in">print</span>(animal)</span><br><span class="hljs-meta prompt_">...</span><br>cat<br>dog<br>moose<br></code></pre></td></tr></table></figure><p>è°ƒç”¨<code>enumerate()</code>å¹¶ç›´æ¥åœ¨ä¸€ä¸ªåºåˆ—ä¸Šè¿›è¡Œè¿­ä»£è¦æ¯”ä½¿ç”¨ä¼ ç»Ÿçš„<code>range(len())</code>æ–¹å¼å¥½ã€‚</p><h3 id="6-4-2-ä½¿ç”¨withè¯­å¥ä»£æ›¿open-å’Œclose"><a href="#6-4-2-ä½¿ç”¨withè¯­å¥ä»£æ›¿open-å’Œclose" class="headerlink" title="6.4.2ã€€ä½¿ç”¨withè¯­å¥ä»£æ›¿open()å’Œclose()"></a>6.4.2ã€€ä½¿ç”¨<code>with</code>è¯­å¥ä»£æ›¿<code>open()</code>å’Œ<code>close()</code></h3><p>ã€€ã€€<code>open()</code>å‡½æ•°å°†è¿”å›ä¸€ä¸ªæ–‡ä»¶å¯¹è±¡ï¼Œè¯¥å¯¹è±¡åŒ…å«è¯»å–å’Œå†™å…¥æ–‡ä»¶çš„æ–¹æ³•ã€‚å½“æ“ä½œå®Œæˆåéœ€è¦è°ƒç”¨<code>close()</code>æ–¹æ³•é‡Šæ”¾æ–‡ä»¶ï¼Œä»¥ä¾¿å…¶ä»–ç¨‹åºè¯»å–å’Œå†™å…¥ã€‚ä½ å¯ä»¥å•ç‹¬ä½¿ç”¨è¿™äº›å‡½æ•°ï¼Œä½†è¿™æ ·åšä¸ç¬¦åˆPythoné£æ ¼ã€‚æ¯”å¦‚ï¼Œå°†æ–‡æœ¬â€œHello, world!â€å†™å…¥ä¸€ä¸ªåä¸ºspam.txtçš„æ–‡ä»¶ä¸­ï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-comment"># ä¸ç¬¦åˆPythoné£æ ¼çš„ç¤ºä¾‹</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">fileObj = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;spam.txt&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>)</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">fileObj.write(<span class="hljs-string">&#x27;Hello, world!&#x27;</span>)</span><br>13<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">fileObj.close()</span><br></code></pre></td></tr></table></figure><p>è¿™æ ·ç¼–å†™ä»£ç å¯èƒ½ä¼šå¯¼è‡´æ–‡ä»¶æœªè¢«å…³é—­ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªç¤ºä¾‹ï¼Œå¦‚æœ<code>try</code>å—ä¸­å‡ºç°äº†å¼‚å¸¸ï¼Œç¨‹åºå°±ä¼šè·³è¿‡<code>close()</code>è°ƒç”¨ï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-comment"># ä¸ç¬¦åˆPythoné£æ ¼çš„ç¤ºä¾‹</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">try</span>:</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">    fileObj = <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;spam.txt&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>)</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">    eggs = <span class="hljs-number">42</span> / <span class="hljs-number">0</span>    <span class="hljs-comment"># è¿™é‡Œä¼šäº§ç”Ÿä»¥0ä¸ºé™¤æ•°çš„é”™è¯¯</span></span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">    fileObj.close()  <span class="hljs-comment"># è¿™ä¸€è¡Œæ°¸è¿œä¸ä¼šè¢«æ‰§è¡Œ</span></span><br><span class="hljs-meta prompt_">...</span> <span class="language-python"><span class="hljs-keyword">except</span>:</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Some error occurred.&#x27;</span>)</span><br>Some error occurred.<br></code></pre></td></tr></table></figure><p>åœ¨é‡åˆ°ä»¥0ä¸ºé™¤æ•°çš„é”™è¯¯æ—¶ï¼Œç¨‹åºä¼šè½¬ç§»åˆ°<code>except</code>å—æ‰§è¡Œï¼Œè·³è¿‡äº†<code>close()</code>è°ƒç”¨ï¼Œä¸”æ–‡ä»¶ä¸€ç›´ä¿æŒæ‰“å¼€çŠ¶æ€ã€‚è¿™å¯èƒ½ä¼šå¯¼è‡´æ–‡ä»¶å‡ºç°æŸåï¼Œè€Œè¿™ä¸ªé”™è¯¯å¾ˆéš¾è¢«è¿½æº¯åˆ°<code>try</code>å—ä¸Šã€‚æ›´å¥½çš„åšæ³•æ˜¯ä½¿ç”¨<code>with</code>è¯­å¥ï¼Œå®ƒå¯ä»¥åœ¨æ‰§è¡Œé¡ºåºç¦»å¼€<code>with</code>è¯­å¥å—æ—¶è‡ªåŠ¨è°ƒç”¨<code>close()</code>ã€‚ä¸‹é¢çš„Pythoné£æ ¼çš„ç¤ºä¾‹å’Œæœ¬èŠ‚ç¬¬ä¸€ä¸ªç¤ºä¾‹æœ‰ç›¸åŒçš„ä½œç”¨ï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-comment"># Pythoné£æ ¼çš„ç¤ºä¾‹</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&#x27;spam.txt&#x27;</span>, <span class="hljs-string">&#x27;w&#x27;</span>) <span class="hljs-keyword">as</span> fileObj:</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">    fileObj.write(<span class="hljs-string">&#x27;Hello, world!&#x27;</span>)</span><br><span class="hljs-meta prompt_">...</span><br></code></pre></td></tr></table></figure><p>å°½ç®¡æ²¡æœ‰æ˜ç¡®åœ°è°ƒç”¨<code>close()</code>ï¼Œä½†å½“æ‰§è¡Œé¡ºåºç¦»å¼€è¿™ä¸ªå—çš„æ—¶å€™ï¼Œ<code>with</code>è¯­å¥ä¼šè‡ªåŠ¨è°ƒç”¨å®ƒã€‚</p><h3 id="6-4-3-ç”¨isè·ŸNoneåšæ¯”è¾ƒè€Œä¸ç”¨"><a href="#6-4-3-ç”¨isè·ŸNoneåšæ¯”è¾ƒè€Œä¸ç”¨" class="headerlink" title="6.4.3ã€€ç”¨isè·ŸNoneåšæ¯”è¾ƒè€Œä¸ç”¨=="></a>6.4.3ã€€ç”¨<code>is</code>è·Ÿ<code>None</code>åšæ¯”è¾ƒè€Œä¸ç”¨<code>==</code></h3><p>ã€€ã€€<code>==</code>ç›¸ç­‰è¿ç®—ç¬¦æ˜¯æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„å€¼ï¼Œè€Œ<code>is</code>èº«ä»½è¿ç®—ç¬¦æ˜¯æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡çš„èº«ä»½ã€‚ç¬¬7ç« å°†è§£é‡Šå€¼å’Œèº«ä»½çš„åŒºåˆ«ã€‚ä¸¤ä¸ªå¯¹è±¡å¯ä»¥å­˜å‚¨ç›¸åŒçš„å€¼ï¼Œä½†å®ƒä»¬æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„å¯¹è±¡ï¼Œæ‹¥æœ‰ä¸åŒçš„èº«ä»½ã€‚å°†æŸä¸ªå€¼è·Ÿ<code>None</code>æ¯”è¾ƒæ—¶ï¼Œç»å¤§å¤šæ•°æƒ…å†µä¸‹åº”ä½¿ç”¨<code>is</code>ï¼Œè€Œé<code>==</code>ã€‚</p><p>ã€€ã€€åœ¨ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œå¦‚æœä½¿ç”¨äº†<strong>è¿ç®—ç¬¦é‡è½½</strong>ï¼Œå³ä½¿<code>spam</code>æŒ‡å‘<code>None</code>ï¼Œè¡¨è¾¾å¼<code>spam == None</code>ä¹Ÿä¼šç­‰äº<code>True</code>ã€‚<code>spam is None</code>å°†æ£€æŸ¥<code>spam</code>å˜é‡ä¸­çš„å€¼æ˜¯å¦çœŸçš„æ˜¯<code>None</code>ï¼Œç”±äº<code>None</code>æ˜¯<code>NoneType</code>æ•°æ®ç±»å‹å”¯ä¸€çš„å€¼ï¼Œå› æ­¤åœ¨ä»»ä½•Pythonç¨‹åºä¸­åªæœ‰ä¸€ä¸ª<code>None</code>å¯¹è±¡ã€‚å½“å˜é‡æŒ‡å‘<code>None</code>æ—¶ï¼Œ<code>is None</code>æ¯”è¾ƒè¡¨è¾¾å¼æ€»æ˜¯ä¸º<code>True</code>ã€‚ç¬¬17ç« å°†æè¿°<code>==</code>è¿ç®—ç¬¦é‡è½½çš„å…·ä½“ç»†èŠ‚ï¼Œå¯å…ˆçœ‹çœ‹è¿™ä¸ªç¤ºä¾‹ï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SomeClass</span>:</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__eq__</span>(<span class="hljs-params">self, other</span>):</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">        <span class="hljs-keyword">if</span> other <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span>:</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">            <span class="hljs-keyword">return</span> <span class="hljs-literal">True</span></span><br><span class="hljs-meta prompt_">...</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">spam = SomeClass()</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">spam == <span class="hljs-literal">None</span></span><br>True<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">spam <span class="hljs-keyword">is</span> <span class="hljs-literal">None</span></span><br>False<br></code></pre></td></tr></table></figure><p>å¾ˆå°‘ä¼šä»¥è¿™ç§æ–¹å¼é‡è½½<code>==</code>è¿ç®—ç¬¦ï¼Œä½†ä¸ºäº†ä»¥é˜²ä¸‡ä¸€ï¼Œæ¨èä¸€ç›´ä½¿ç”¨<code>is None</code>è€Œé<code>== None</code>ï¼Œè¿™æ˜¯Pythonçš„æƒ¯ç”¨å†™æ³•ã€‚</p><p>ã€€ã€€è€Œä¸”ï¼Œä¸åº”è¯¥åœ¨å€¼ä¸º<code>True</code>å’Œ<code>False</code>çš„æƒ…å†µä¸‹ä½¿ç”¨<code>is</code>è¿ç®—ç¬¦ã€‚å¯ä»¥ä½¿ç”¨<code>==</code>ç›¸ç­‰è¿ç®—ç¬¦å°†å€¼ä¸<code>True</code>æˆ–è€…<code>False</code>æ¯”è¾ƒï¼Œæ¯”å¦‚<code>spam == True</code>æˆ–è€…<code>spam == False</code>ã€‚æ›´å¸¸è§çš„æ˜¯æ ¹æœ¬ä¸ä½¿ç”¨è¿ç®—ç¬¦å’Œå¸ƒå°”å€¼ï¼ŒæŠŠä»£ç å†™æˆ<code>if spam:</code>æˆ–è€…<code>if not spam:</code>ï¼Œè€Œä¸æ˜¯<code>if spam == True</code>æˆ–<code>if spam == False</code>ã€‚</p><h2 id="6-5-æ ¼å¼åŒ–å­—ç¬¦ä¸²"><a href="#6-5-æ ¼å¼åŒ–å­—ç¬¦ä¸²" class="headerlink" title="6.5ã€€æ ¼å¼åŒ–å­—ç¬¦ä¸²"></a>6.5ã€€æ ¼å¼åŒ–å­—ç¬¦ä¸²</h2><p>ã€€ã€€å‡ ä¹æ¯ä¸ªä½¿ç”¨ä¸åŒç¼–ç¨‹è¯­è¨€ç¼–å†™çš„è®¡ç®—æœºç¨‹åºä¸­éƒ½æœ‰å­—ç¬¦ä¸²ã€‚è¿™ç§æ•°æ®ç±»å‹å¾ˆå¸¸è§ï¼Œæ‰€ä»¥Pythonä¸­æœ‰è®¸å¤šæ“ä½œå’Œæ ¼å¼åŒ–å­—ç¬¦ä¸²çš„æ–¹æ³•ã€‚æœ¬èŠ‚å°†é‡ç‚¹ä»‹ç»ä¸€äº›æœ€ä½³å®è·µã€‚</p><h3 id="6-5-1-å¦‚æœå­—ç¬¦ä¸²æœ‰å¾ˆå¤šåæ–œæ ï¼Œè¯·ä½¿ç”¨åŸå§‹å­—ç¬¦ä¸²"><a href="#6-5-1-å¦‚æœå­—ç¬¦ä¸²æœ‰å¾ˆå¤šåæ–œæ ï¼Œè¯·ä½¿ç”¨åŸå§‹å­—ç¬¦ä¸²" class="headerlink" title="6.5.1ã€€å¦‚æœå­—ç¬¦ä¸²æœ‰å¾ˆå¤šåæ–œæ ï¼Œè¯·ä½¿ç”¨åŸå§‹å­—ç¬¦ä¸²"></a>6.5.1ã€€å¦‚æœå­—ç¬¦ä¸²æœ‰å¾ˆå¤šåæ–œæ ï¼Œè¯·ä½¿ç”¨åŸå§‹å­—ç¬¦ä¸²</h3><p>ã€€ã€€è½¬ä¹‰å­—ç¬¦å…è®¸ä½ åœ¨å­—ç¬¦ä¸²å­—é¢é‡ä¸­æ’å…¥åŸæœ¬ä¸èƒ½åŒ…å«çš„æ–‡æœ¬ã€‚ä¾‹å¦‚åœ¨<code>&#39;Zophie\&#39;s chair&#39;</code>ä¸­ï¼Œéœ€è¦åæ–œæ <code>\</code>ï¼Œè¿™æ ·ä¼šä½¿ç¬¬äºŒä¸ªå•å¼•å·æˆä¸ºå­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯è¡¨ç¤ºå­—ç¬¦ä¸²åˆ°æ­¤ç»“æŸã€‚å› ä¸ºåæ–œæ å…·æœ‰è¿™ç§ç‰¹æ®Šçš„è½¬ä¹‰ä½œç”¨ï¼Œæ‰€ä»¥å¦‚æœçœŸçš„æƒ³åœ¨å­—ç¬¦ä¸²ä¸­æ”¾å…¥ä¸€ä¸ªåæ–œæ å­—ç¬¦ï¼Œé‚£ä¹ˆå¿…é¡»ä»¥<code>\\</code>çš„å½¢å¼è¾“å…¥ã€‚</p><p>ã€€ã€€<strong>åŸå§‹å­—ç¬¦ä¸²</strong>æ˜¯å…·æœ‰<code>r</code>å‰ç¼€çš„å­—ç¬¦ä¸²å­—é¢é‡ï¼Œå®ƒä»¬ä¸æŠŠåæ–œæ è§†ä¸ºè½¬ä¹‰å­—ç¬¦ï¼Œè€Œæ˜¯ä½œä¸ºæ™®é€šå­—ç¬¦ã€‚æ¯”å¦‚ä¸‹é¢è¿™ä¸ªWindowsæ–‡ä»¶è·¯å¾„çš„å­—ç¬¦ä¸²éœ€è¦å¤šä¸ªè½¬ä¹‰çš„åæ–œæ ï¼Œè¿™å’ŒPythoné£æ ¼ä¸åŒï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-comment"># ä¸ç¬¦åˆPythoné£æ ¼çš„ç¤ºä¾‹</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;The file is in C:\\Users\\Al\\Desktop\\Info\\Archive\\Spam&#x27;</span>)</span><br>The file is in C:\Users\Al\Desktop\Info\Archive\Spam<br></code></pre></td></tr></table></figure><p>è€Œä¸‹é¢è¿™ä¸ªåŸå§‹å­—ç¬¦ä¸²ï¼ˆæ³¨æ„å¸¦æœ‰<code>r</code>å‰ç¼€ï¼‰æä¾›ç›¸åŒçš„å­—ç¬¦ä¸²å€¼ï¼Œå®ƒçš„å¯è¯»æ€§æ›´å¥½ï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-comment"># Pythoné£æ ¼çš„ç¤ºä¾‹</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">print</span>(<span class="hljs-string">r&#x27;The file is in C:\Users\Al\Desktop\Info\Archive\Spam&#x27;</span>)</span><br>The file is in C:\Users\Al\Desktop\Info\Archive\Spam<br></code></pre></td></tr></table></figure><p>ã€€ã€€åŸå§‹å­—ç¬¦ä¸²å¹¶ä¸æ˜¯ä¸€ç§ä¸åŒçš„å­—ç¬¦ä¸²æ•°æ®ç±»å‹ï¼Œå®ƒåªæ˜¯ç”¨æ¥è¾“å…¥åŒ…å«å¤šä¸ªåæ–œæ å­—ç¬¦çš„å­—ç¬¦ä¸²å­—é¢é‡çš„ä¾¿æ·æ–¹å¼ã€‚å®ƒå¸¸ç”¨æ¥è¾“å…¥æ­£åˆ™è¡¨è¾¾å¼æˆ–è€…Windowsæ–‡ä»¶è·¯å¾„çš„å­—ç¬¦ä¸²ã€‚è¿™äº›å­—ç¬¦ä¸²ä¸­ç»å¸¸æœ‰å¤šä¸ªåæ–œæ å­—ç¬¦ï¼Œå¦‚æœé€ä¸ªä½¿ç”¨<code>\\</code>è½¬ä¹‰ä¼šè´¹æ—¶è´¹åŠ›ã€‚</p><h3 id="6-5-2-ä½¿ç”¨f-stringæ ¼å¼åŒ–å­—ç¬¦ä¸²"><a href="#6-5-2-ä½¿ç”¨f-stringæ ¼å¼åŒ–å­—ç¬¦ä¸²" class="headerlink" title="6.5.2ã€€ä½¿ç”¨f-stringæ ¼å¼åŒ–å­—ç¬¦ä¸²"></a>6.5.2ã€€ä½¿ç”¨f-stringæ ¼å¼åŒ–å­—ç¬¦ä¸²</h3><p>ã€€ã€€<strong>å­—ç¬¦ä¸²æ ¼å¼åŒ–</strong>ï¼Œä¹Ÿè¢«ç§°ä¸º<strong>å­—ç¬¦ä¸²æ’å€¼</strong>ï¼Œç”¨æ¥åˆ›å»ºåµŒå¥—å…¶ä»–å­—ç¬¦ä¸²çš„å­—ç¬¦ä¸²ï¼Œæ­¤æ–¹æ³•çš„å‘å±•å†å²å¾ˆé•¿ã€‚<strong>3</strong>æœ€åˆæ˜¯ä½¿ç”¨<code>+</code>è¿ç®—ç¬¦å°†å­—ç¬¦ä¸²è¿æ¥åœ¨ä¸€èµ·ï¼Œä½†è¿™å¯¼è‡´ä»£ç ä¸­å‡ºç°å¾ˆå¤šå¼•å·å’ŒåŠ å·ï¼Œæ¯”å¦‚<code>&#39;Hello, &#39; + name + &#39;. Today is &#39; + day + &#39; and it is &#39; + weather + &#39;.&#39;</code>ï¼Œè€Œ<code>%s</code>è½¬æ¢æ ¼å¼ç¬¦çš„å‡ºç°åˆ™ç®€åŒ–äº†è¯­æ³•ï¼š<code>&#39;Hello, %s. Today is %s and it is %s.&#39; % (name, day, weather)</code>ã€‚è¿™ä¸¤ç§æ–¹æ³•éƒ½å°†<code>name</code>ã€<code>day</code>å’Œ<code>weather</code>å˜é‡ä¸­çš„å­—ç¬¦ä¸²æ’å…¥åˆ°å­—ç¬¦ä¸²å­—é¢é‡ä¸­ä»¥å¾—åˆ°ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²å€¼ï¼Œæ¯”å¦‚<code>&#39;Hello, Al. Today is Sunday and it is sunny.&#39;</code>ã€‚</p><p><strong>3</strong>ä¼´éšç€Pythonçš„å‘å±•ï¼ŒPythonæå‡ºäº†å¤šç§å­—ç¬¦ä¸²æ ¼å¼åŒ–æ–¹æ³•ã€‚â€”â€”è¯‘è€…æ³¨</p><p><code>format()</code>å­—ç¬¦ä¸²æ–¹æ³•æ·»åŠ äº†æ ¼å¼è§„èŒƒè¿·ä½ è¯­è¨€ï¼Œå®ƒä½¿ç”¨<code>&#123;&#125;</code>æ‹¬å·å¯¹ï¼Œä¸<code>%s</code>è½¬æ¢æ ¼å¼ç¬¦ä½¿ç”¨æ–¹å¼ç±»ä¼¼ã€‚ä¸è¿‡è¿™ä¸ªæ–¹æ³•æœ‰äº›å¤æ‚ï¼Œå¯èƒ½ä¼šäº§ç”Ÿä¸å¯è¯»çš„ä»£ç ï¼Œæ‰€ä»¥æˆ‘ä¸æ¨èä½¿ç”¨å®ƒã€‚</p><p>ã€€ã€€ä»Python 3.6å¼€å§‹ï¼Œ<strong>f-string</strong>ï¼ˆformat stringçš„ç¼©å†™ï¼‰æä¾›äº†ä¸€ç§æ›´æ–¹ä¾¿çš„æ–¹æ³•æ¥åˆ›å»ºåµŒå¥—å…¶ä»–å­—ç¬¦ä¸²çš„å­—ç¬¦ä¸²ã€‚ç±»ä¼¼äºåŸå§‹å­—ç¬¦ä¸²ä¼šåœ¨ç¬¬ä¸€ä¸ªå¼•å·å‰ä½¿ç”¨å‰ç¼€<code>r</code>ï¼Œf-stringä½¿ç”¨å‰ç¼€<code>f</code>ã€‚å¯ä»¥åœ¨f-stringçš„å¤§æ‹¬å·ä¸­åŠ å…¥å˜é‡åç§°ï¼Œä»¥æ’å…¥å­˜å‚¨åœ¨è¿™äº›å˜é‡ä¸­çš„å­—ç¬¦ä¸²ï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">name, day, weather = <span class="hljs-string">&#x27;Al&#x27;</span>, <span class="hljs-string">&#x27;Sunday&#x27;</span>, <span class="hljs-string">&#x27;sunny&#x27;</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-string">f&#x27;Hello, <span class="hljs-subst">&#123;name&#125;</span>. Today is <span class="hljs-subst">&#123;day&#125;</span> and it is <span class="hljs-subst">&#123;weather&#125;</span>.&#x27;</span></span><br>&#x27;Hello, Al. Today is Sunday and it is sunny.&#x27;<br></code></pre></td></tr></table></figure><p>å¤§æ‹¬å·ä¸­ä¹Ÿå¯ä»¥åŒ…å«å®Œæ•´çš„è¡¨è¾¾å¼ï¼š</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs maxima">&gt;&gt;&gt; <span class="hljs-built_in">width</span>, <span class="hljs-built_in">length</span> = <span class="hljs-number">10</span>, <span class="hljs-number">12</span><br>&gt;&gt;&gt; f&#x27;A &#123;<span class="hljs-built_in">width</span>&#125; by &#123;<span class="hljs-built_in">length</span>&#125; <span class="hljs-built_in">room</span> has an area of &#123;<span class="hljs-built_in">width</span> * <span class="hljs-built_in">length</span>&#125;.&#x27;<br>&#x27;A <span class="hljs-number">10</span> by <span class="hljs-number">12</span> <span class="hljs-built_in">room</span> has an area of <span class="hljs-number">120</span>.&#x27;<br></code></pre></td></tr></table></figure><p>ã€€ã€€å¦‚æœè¦åœ¨f-stringä¸­åŒ…å«å¤§æ‹¬å·å­—ç¬¦ï¼Œå¯ä»¥ä½¿ç”¨é¢å¤–çš„æ‹¬å·æ¥è½¬ä¹‰å®ƒï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">spam = <span class="hljs-number">42</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-string">f&#x27;This prints the value in spam: <span class="hljs-subst">&#123;spam&#125;</span>&#x27;</span></span><br>&#x27;This prints the value in spam: 42&#x27;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-string">f&#x27;This prints literal curly braces: &#123;&#123;spam&#125;&#125;&#x27;</span></span><br>&#x27;This prints literal curly braces: &#123;spam&#125;&#x27;<br></code></pre></td></tr></table></figure><p>ã€€ã€€ç”±äºå¯ä»¥æŠŠå˜é‡åå’Œè¡¨è¾¾å¼ç›´æ¥å†™åœ¨å­—ç¬¦ä¸²å†…ï¼Œå› æ­¤ä»£ç çš„å¯è¯»æ€§æ¯”æ—§çš„å­—ç¬¦ä¸²æ ¼å¼åŒ–æ–¹æ³•å¼ºã€‚</p><p>ã€€ã€€æ ¼å¼åŒ–å­—ç¬¦ä¸²æœ‰è¿™ä¹ˆå¤šæ–¹æ³•ï¼Œè¿™ä¼¼ä¹è¿èƒŒäº†â€œPythonä¹‹ç¦…â€çš„ç®´è¨€ï¼šâ€œåº”è¯¥æœ‰ä¸€ä¸ªï¼Œæœ€å¥½åªæœ‰ä¸€ä¸ªæ˜æ˜¾çš„æ–¹æ³•èƒ½ä½¿ç”¨ã€‚â€ä½†åœ¨æˆ‘çœ‹æ¥ï¼Œf-stringæ˜¯å¯¹è¯­è¨€çš„ä¸€ç§æ”¹è¿›ï¼Œè€Œä¸”æ­£å¦‚å¦ä¸€æ¡å‡†åˆ™æ‰€è¯´ï¼Œâ€œå®ç”¨æ€§èƒœäºçº¯ç²¹æ€§â€ï¼Œæ‰€ä»¥å®ƒæ— å¯åšéã€‚å¦‚æœä½ åªç”¨Python 3.6æˆ–è€…æ›´é«˜ç‰ˆæœ¬ç¼–å†™ä»£ç ï¼Œè¯·ä½¿ç”¨f-stringã€‚å¦‚æœä½ å†™çš„ä»£ç æ˜¯ç”±æ—©æœŸçš„Pythonç‰ˆæœ¬è¿è¡Œï¼Œé‚£å°±ç»§ç»­ç”¨<code>format()</code>æ–¹æ³•æˆ–è€…<code>%s</code>è½¬æ¢æ ¼å¼ç¬¦ã€‚</p><h2 id="6-6-åˆ¶ä½œåˆ—è¡¨çš„æµ…å‰¯æœ¬"><a href="#6-6-åˆ¶ä½œåˆ—è¡¨çš„æµ…å‰¯æœ¬" class="headerlink" title="6.6ã€€åˆ¶ä½œåˆ—è¡¨çš„æµ…å‰¯æœ¬"></a>6.6ã€€åˆ¶ä½œåˆ—è¡¨çš„æµ…å‰¯æœ¬</h2><p>ã€€ã€€ä½¿ç”¨<code>slice</code>è¯­æ³•å¯ä»¥å¾ˆå®¹æ˜“åœ°åŸºäºç°æœ‰çš„å­—ç¬¦ä¸²æˆ–è€…åˆ—è¡¨åˆ›å»ºæ–°çš„å­—ç¬¦ä¸²æˆ–åˆ—è¡¨ã€‚åœ¨äº¤äº’å¼shellä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹çœ‹ä¸€ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;Hello, world!&#x27;</span>[<span class="hljs-number">7</span>:<span class="hljs-number">12</span>] <span class="hljs-comment"># åŸºäºé•¿å­—ç¬¦ä¸²åˆ›å»ºçŸ­å­—ç¬¦ä¸²</span><br><span class="hljs-string">&#x27;world&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-string">&#x27;Hello, world!&#x27;</span>[:<span class="hljs-number">5</span>] <span class="hljs-comment"># åŸºäºé•¿å­—ç¬¦ä¸²åˆ›å»ºçŸ­å­—ç¬¦ä¸²</span><br><span class="hljs-string">&#x27;Hello&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>[<span class="hljs-string">&#x27;cat&#x27;</span>, <span class="hljs-string">&#x27;dog&#x27;</span>, <span class="hljs-string">&#x27;rat&#x27;</span>, <span class="hljs-string">&#x27;eel&#x27;</span>][<span class="hljs-number">2</span>:] <span class="hljs-comment"># åŸºäºé•¿åˆ—è¡¨åˆ›å»ºçŸ­åˆ—è¡¨</span><br>[<span class="hljs-string">&#x27;rat&#x27;</span>, <span class="hljs-string">&#x27;eel&#x27;</span>]<br></code></pre></td></tr></table></figure><p>è¦ä½¿ç”¨å†’å·å¯¹å¼€å§‹ç´¢å¼•ä½ç½®å’Œç»“æŸç´¢å¼•ä½ç½®è¿›è¡Œåˆ†éš”ï¼Œä»¥ä½¿å†…å®¹ä»æ—§åˆ—è¡¨å¤åˆ¶åˆ°æ–°åˆ—è¡¨ä¸­ã€‚å½“çœç•¥å†’å·å‰çš„èµ·å§‹ç´¢å¼•æ—¶ï¼Œæ¯”å¦‚<code>&#39;Hello, world!&#39;[:5]</code>ï¼Œèµ·å§‹ç´¢å¼•é»˜è®¤ä¸º0ã€‚åŒç†ï¼Œå½“çœç•¥å†’å·åçš„ç»“æŸç´¢å¼•æ—¶ï¼Œæ¯”å¦‚<code>[&#39;cat&#39;,&#39;dog&#39;,&#39;rat&#39;,&#39;eel&#39;][2:]</code>ï¼Œç»“æŸç´¢å¼•é»˜è®¤ä¸ºåˆ—è¡¨ç»“å°¾ã€‚</p><p>ã€€ã€€å¦‚æœä¸¤ä¸ªç´¢å¼•éƒ½è¢«çœç•¥ï¼Œèµ·å§‹ç´¢å¼•æ˜¯0ï¼ˆåˆ—è¡¨å¼€å¤´ï¼‰ï¼Œç»“æŸç´¢å¼•æ˜¯åˆ—è¡¨ç»“å°¾ï¼Œè¿™å®é™…ä¸Šä¼šåˆ›å»ºä¸€ä¸ªåˆ—è¡¨çš„å‰¯æœ¬ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>spam = [<span class="hljs-string">&#x27;cat&#x27;</span>, <span class="hljs-string">&#x27;dog&#x27;</span>, <span class="hljs-string">&#x27;rat&#x27;</span>, <span class="hljs-string">&#x27;eel&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span>eggs = spam[:]<br><span class="hljs-meta">&gt;&gt;&gt; </span>eggs<br>[<span class="hljs-string">&#x27;cat&#x27;</span>, <span class="hljs-string">&#x27;dog&#x27;</span>, <span class="hljs-string">&#x27;rat&#x27;</span>, <span class="hljs-string">&#x27;eel&#x27;</span>]<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">id</span>(spam) == <span class="hljs-built_in">id</span>(eggs)<br><span class="hljs-literal">False</span><br></code></pre></td></tr></table></figure><p>ã€€ã€€æ³¨æ„ï¼Œ<code>spam</code>å’Œ<code>eggs</code>æŒ‡å‘çš„åˆ—è¡¨å¯¹è±¡çš„èº«ä»½æ˜¯ä¸åŒçš„ã€‚<code>eggs = spam[:]</code>åˆ›å»ºäº†<code>spam</code>åˆ—è¡¨çš„æµ…å‰¯æœ¬ã€‚è€Œ<code>eggs = spam</code>åªå¤åˆ¶äº†åˆ—è¡¨çš„å¼•ç”¨ã€‚<code>[:]</code>è¿™ç§å†™æ³•çœ‹èµ·æ¥æœ‰äº›å¥‡æ€ªï¼Œè€Œä½¿ç”¨<code>copy</code>æ¨¡å—çš„<code>copy()</code>å‡½æ•°åˆ›å»ºåˆ—è¡¨çš„æµ…å‰¯æœ¬ä¼šæœ‰æ›´å¥½çš„å¯è¯»æ€§ï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-comment"># Pythoné£æ ¼çš„ç¤ºä¾‹</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">import</span> copy</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">spam = [<span class="hljs-string">&#x27;cat&#x27;</span>, <span class="hljs-string">&#x27;dog&#x27;</span>, <span class="hljs-string">&#x27;rat&#x27;</span>, <span class="hljs-string">&#x27;eel&#x27;</span>]</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">eggs = copy.copy(spam)</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">id</span>(spam) == <span class="hljs-built_in">id</span>(eggs)</span><br>False<br></code></pre></td></tr></table></figure><p>ä½ åº”è¯¥äº†è§£è¿™ä¸ªå¥‡æ€ªçš„è¯­æ³•ï¼Œä»¥é¿å…åœ¨è¯»åˆ°è¿™æ ·çš„Pythonä»£ç æ—¶æ„Ÿåˆ°è´¹è§£ï¼Œä½†æˆ‘ä¸å»ºè®®åœ¨ä»£ç ä¸­ä½¿ç”¨å®ƒï¼Œå› ä¸º<code>[:]</code>å’Œ<code>copy.copy()</code>éƒ½èƒ½åˆ›å»ºæµ…å‰¯æœ¬ã€‚</p><h2 id="6-7-ä»¥Pythoné£æ ¼ä½¿ç”¨å­—å…¸"><a href="#6-7-ä»¥Pythoné£æ ¼ä½¿ç”¨å­—å…¸" class="headerlink" title="6.7ã€€ä»¥Pythoné£æ ¼ä½¿ç”¨å­—å…¸"></a>6.7ã€€ä»¥Pythoné£æ ¼ä½¿ç”¨å­—å…¸</h2><p>ã€€ã€€å­—å…¸çš„é”®âˆ’å€¼å¯¹ï¼ˆç¬¬7ç« å°†è¿›ä¸€æ­¥è®¨è®ºï¼‰å¯ä»¥ç»´æŠ¤ä¸€ä»½æ•°æ®åˆ°å¦ä¸€ä»½æ•°æ®çš„æ˜ å°„ï¼Œè¿™ç§çµæ´»æ€§ä½¿å…¶æˆä¸ºå¾ˆå¤šPythonç¨‹åºçš„å¸¸ç”¨æ•°æ®ç±»å‹ã€‚å› æ­¤ï¼Œäº†è§£Pythonä»£ç ä¸­å¸¸ç”¨çš„å­—å…¸ç”¨æ³•å¤§æœ‰ç›Šå¤„ã€‚</p><p>ã€€ã€€å¦‚æœæƒ³è¿›ä¸€æ­¥äº†è§£å­—å…¸ï¼Œå¯ä»¥å‚è€ƒBrandon Rhodesçš„å…³äºä»€ä¹ˆæ˜¯å­—å…¸ï¼Œä»¥åŠå®ƒå¦‚ä½•å·¥ä½œçš„æ¼”è®²ã€‚ä»–åœ¨PyConå¤§ä¼šä¸Šæ‰€åšçš„â€œThe Mighty Dictionaryâ€ï¼ˆå¼ºå¤§çš„å­—å…¸ï¼‰å’Œâ€œThe Dictionary Even Mightierâ€ï¼ˆæ›´å¼ºå¤§çš„å­—å…¸ï¼‰æ¼”è®²åº”è¯¥å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚</p><h3 id="6-7-1-åœ¨å­—å…¸ä¸­ä½¿ç”¨get-å’Œsetdefault"><a href="#6-7-1-åœ¨å­—å…¸ä¸­ä½¿ç”¨get-å’Œsetdefault" class="headerlink" title="6.7.1ã€€åœ¨å­—å…¸ä¸­ä½¿ç”¨get()å’Œsetdefault()"></a>6.7.1ã€€åœ¨å­—å…¸ä¸­ä½¿ç”¨<code>get()</code>å’Œ<code>setdefault()</code></h3><p>ã€€ã€€è¯•å›¾è®¿é—®ä¸€ä¸ªä¸å­˜åœ¨çš„å­—å…¸é”®ä¼šå¯¼è‡´<code>KeyError</code>ã€‚ä¸ºäº†é¿å…å®ƒï¼Œç¨‹åºå‘˜ç»å¸¸ä¼šå†™å‡ºä¸€äº›ä¸ç¬¦åˆPythoné£æ ¼çš„ä»£ç ï¼Œæ¯”å¦‚è¿™æ ·ï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-comment"># ä¸ç¬¦åˆPythoné£æ ¼çš„ç¤ºä¾‹</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">numberOfPets = &#123;<span class="hljs-string">&#x27;dogs&#x27;</span>: <span class="hljs-number">2</span>&#125;</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;cats&#x27;</span> <span class="hljs-keyword">in</span> numberOfPets: <span class="hljs-comment"># æ£€æŸ¥å…¶ä¸­æ˜¯å¦æœ‰catsé”®</span></span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;I have&#x27;</span>, numberOfPets[<span class="hljs-string">&#x27;cats&#x27;</span>], <span class="hljs-string">&#x27;cats.&#x27;</span>)</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python"><span class="hljs-keyword">else</span>:</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;I have 0 cats.&#x27;</span>)</span><br><span class="hljs-meta prompt_">...</span><br>I have 0 cats.<br></code></pre></td></tr></table></figure><p>è¿™æ®µä»£ç æ£€æŸ¥<code>numberOfPets</code>å­—å…¸ä¸­æ˜¯å¦å­˜åœ¨ä¸€ä¸ªä¸ºå­—ç¬¦ä¸²â€œcatsâ€çš„é”®ã€‚å¦‚æœå­˜åœ¨ï¼Œ<code>print()</code>è°ƒç”¨ä¼šè·å–<code>numberOfPets[&#39;cats&#39;]</code>çš„å€¼ä½œä¸ºä¿¡æ¯çš„ä¸€éƒ¨åˆ†å±•ç¤ºç»™ç”¨æˆ·ã€‚å¦‚æœä¸å­˜åœ¨ï¼Œå¦ä¸€ä¸ª<code>print()</code>è°ƒç”¨ä¸ä¼šè®¿é—®<code>numberOfPets[&#39;cats&#39;]</code>ï¼Œè€Œæ˜¯å±•ç¤ºå…¶ä»–å­—ç¬¦ä¸²ï¼Œè¿™æ ·å°±ä¸ä¼šæ˜¾ç¤º<code>KeyError</code>ã€‚</p><p>ã€€ã€€ç”±äºè¿™ç§ä»£ç æ¨¡å¼å¾ˆå¸¸è§ï¼Œå› æ­¤å­—å…¸æä¾›äº†<code>get()</code>æ–¹æ³•ï¼Œå…è®¸å½“é”®ä¸å­˜åœ¨çš„æ—¶å€™è¿”å›æŒ‡å®šçš„é»˜è®¤å€¼ã€‚ä¸‹é¢è¿™æ®µPythoné£æ ¼çš„ä»£ç è·Ÿå‰é¢çš„ä»£ç åŠŸæ•ˆç›¸åŒï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-comment"># Pythoné£æ ¼çš„ç¤ºä¾‹</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">numberOfPets = &#123;<span class="hljs-string">&#x27;dogs&#x27;</span>: <span class="hljs-number">2</span>&#125;</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;I have&#x27;</span>, numberOfPets.get(<span class="hljs-string">&#x27;cats&#x27;</span>, <span class="hljs-number">0</span>), <span class="hljs-string">&#x27;cats.&#x27;</span>)</span><br>I have 0 cats.<br></code></pre></td></tr></table></figure><p><code>numberOfPets.get(&#39;cats&#39;, 0)</code>è¿™ä¸ªè°ƒç”¨ä¼šæ£€æŸ¥<code>numberOfPets</code>å­—å…¸æ˜¯å¦å­˜åœ¨<code>&#39;cats&#39;</code>é”®ã€‚å¦‚æœå­˜åœ¨ï¼Œè¯¥æ–¹æ³•è¿”å›<code>&#39;cats&#39;</code>é”®å¯¹åº”çš„å€¼ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¿”å›ç¬¬äºŒä¸ªå‚æ•°ï¼Œä¹Ÿå°±æ˜¯<code>0</code>ã€‚ä½¿ç”¨<code>get()</code>æ–¹æ³•æŒ‡å®šé”®ä¸å­˜åœ¨æ—¶è¿”å›çš„é»˜è®¤å€¼ï¼Œè¦æ¯”ä½¿ç”¨<code>if-else</code>è¯­å¥ç®€å•æ˜äº†ã€‚</p><p>ã€€ã€€å¦ä¸€ç§æƒ…å†µæ˜¯ï¼Œå½“é”®ä¸å­˜åœ¨æ—¶ï¼Œä¸ºå…¶è®¾ç½®é»˜è®¤å€¼ã€‚å¦‚æœå­—å…¸<code>numberOfPets</code>æ²¡æœ‰<code>&#39;cats&#39;</code>é”®ï¼Œ<code>numberOfPets[&#39;cats&#39;] += 10</code>ä¼šå¯¼è‡´<code>KeyError</code>ã€‚ä½ å¯èƒ½æƒ³é¢„å…ˆæ£€æŸ¥é”®æ˜¯å¦ç¼ºå¤±ï¼Œå¦‚æœç¼ºå¤±åˆ™ä¸ºå…¶è®¾ç½®é»˜è®¤å€¼ï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-comment"># ä¸ç¬¦åˆPythoné£æ ¼çš„ç¤ºä¾‹</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">numberOfPets = &#123;<span class="hljs-string">&#x27;dogs&#x27;</span>: <span class="hljs-number">2</span>&#125;</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;cats&#x27;</span> <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> numberOfPets:</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">    numberOfPets[<span class="hljs-string">&#x27;cats&#x27;</span>] = <span class="hljs-number">0</span></span><br><span class="hljs-meta prompt_">...</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">numberOfPets[<span class="hljs-string">&#x27;cats&#x27;</span>] += <span class="hljs-number">10</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">numberOfPets[<span class="hljs-string">&#x27;cats&#x27;</span>]</span><br>10<br></code></pre></td></tr></table></figure><p>è¿™ç§æ¨¡å¼ä¹Ÿå¾ˆå¸¸è§ï¼Œå­—å…¸æä¾›äº†ä¸€ä¸ªç¬¦åˆPythoné£æ ¼çš„<code>setdefault()</code>æ–¹æ³•ã€‚ä¸‹é¢è¿™æ®µä»£ç ä¸å‰ä¸€æ®µç­‰æ•ˆï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-comment"># Pythoné£æ ¼çš„ç¤ºä¾‹</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">numberOfPets = &#123;<span class="hljs-string">&#x27;dogs&#x27;</span>: <span class="hljs-number">2</span>&#125;</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">numberOfPets.setdefault(<span class="hljs-string">&#x27;cats&#x27;</span>, <span class="hljs-number">0</span>) <span class="hljs-comment"># å¦‚æœ&#x27;cats&#x27;é”®å­˜åœ¨ï¼Œåˆ™ä»€ä¹ˆä¹Ÿä¸åš</span></span><br>0<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">workDetails[<span class="hljs-string">&#x27;cats&#x27;</span>] += <span class="hljs-number">10</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">workDetails[<span class="hljs-string">&#x27;cats&#x27;</span>]</span><br>10<br></code></pre></td></tr></table></figure><p>å¦‚æœä½ è¿˜åœ¨ç”¨<code>if</code>è¯­å¥æ£€æŸ¥å­—å…¸ä¸­æ˜¯å¦å­˜åœ¨æŸä¸ªé”®ï¼Œåœ¨é”®ä¸å­˜åœ¨æ—¶è®¾ç½®é»˜è®¤å€¼ï¼Œè¯·ä½¿ç”¨<code>setdefault()</code>ä»£æ›¿ã€‚</p><h3 id="6-7-2-ä½¿ç”¨collections-defaultdict-è®¾ç½®é»˜è®¤å€¼"><a href="#6-7-2-ä½¿ç”¨collections-defaultdict-è®¾ç½®é»˜è®¤å€¼" class="headerlink" title="6.7.2ã€€ä½¿ç”¨collections.defaultdict()è®¾ç½®é»˜è®¤å€¼"></a>6.7.2ã€€ä½¿ç”¨<code>collections.defaultdict()</code>è®¾ç½®é»˜è®¤å€¼</h3><p>ã€€ã€€ä½¿ç”¨<code>collections.defaultdict()</code>å¯ä»¥å½»åº•é¿å…<code>KeyError</code>ã€‚å¯¼å…¥<code>collections</code>æ¨¡å—å¹¶è°ƒç”¨<code>collections.defaultdict()</code>ï¼Œä¼ é€’æ•°æ®ç±»å‹ä½œä¸ºé»˜è®¤å€¼ï¼Œå°±å¯ä»¥åˆ›å»ºä¸€ä¸ªé»˜è®¤çš„å­—å…¸ã€‚æ¯”å¦‚ï¼Œé€šè¿‡å‘<code>collections.defaultdict()</code>ä¼ é€’<code>int</code>å¯ä»¥åˆ›å»ºä¸€ä¸ªç±»ä¼¼å­—å…¸çš„å¯¹è±¡ï¼Œå½“é”®ä¸å­˜åœ¨æ—¶ï¼Œä½¿ç”¨0ä½œä¸ºé»˜è®¤å€¼ã€‚åœ¨äº¤äº’å¼shellä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> collections<br><span class="hljs-meta">&gt;&gt;&gt; </span>scores = collections.defaultdict(<span class="hljs-built_in">int</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>scores<br>defaultdict(&lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;int&#x27;</span>&gt;, &#123;&#125;)<br><span class="hljs-meta">&gt;&gt;&gt; </span>scores[<span class="hljs-string">&#x27;Al&#x27;</span>] += <span class="hljs-number">1</span> <span class="hljs-comment"># ä¸éœ€è¦æå‰è®¾ç½®&#x27;Al&#x27;é”®çš„å€¼</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>scores<br>defaultdict(&lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;int&#x27;</span>&gt;, &#123;<span class="hljs-string">&#x27;Al&#x27;</span>: <span class="hljs-number">1</span>&#125;)<br><span class="hljs-meta">&gt;&gt;&gt; </span>scores[<span class="hljs-string">&#x27;Zophie&#x27;</span>] <span class="hljs-comment"># ä¸éœ€è¦æå‰è®¾ç½®&#x27;Zophie&#x27;é”®çš„å€¼</span><br><span class="hljs-number">0</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>scores[<span class="hljs-string">&#x27;Zophie&#x27;</span>] += <span class="hljs-number">40</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>scores<br>defaultdict(&lt;<span class="hljs-keyword">class</span> <span class="hljs-string">&#x27;int&#x27;</span>&gt;, &#123;<span class="hljs-string">&#x27;Al&#x27;</span>: <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;Zophie&#x27;</span>: <span class="hljs-number">40</span>&#125;)<br></code></pre></td></tr></table></figure><p>æ³¨æ„ï¼Œä½ æ˜¯åœ¨ä¼ é€’<code>int()</code>å‡½æ•°ï¼Œè€Œä¸æ˜¯è°ƒç”¨å®ƒï¼Œæ‰€ä»¥è¦çœç•¥<code>int()</code>ä¸­çš„æ‹¬å·ã€‚æ­£ç¡®çš„å†™æ³•æ˜¯<code>collections.defaultdict(int)</code>ã€‚ä¹Ÿå¯ä»¥ä¼ é€’<code>list</code>ï¼Œä½¿ç”¨ç©ºåˆ—è¡¨ä½œä¸ºé»˜è®¤å€¼ã€‚åœ¨äº¤äº’å¼shellä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">import</span> collections</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">booksReadBy = collections.defaultdict(<span class="hljs-built_in">list</span>)</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">booksReadBy[<span class="hljs-string">&#x27;Al&#x27;</span>].append(<span class="hljs-string">&#x27;Oryx and Crake&#x27;</span>)</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">booksReadBy[<span class="hljs-string">&#x27;Al&#x27;</span>].append(<span class="hljs-string">&#x27;American Gods&#x27;</span>)</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">len</span>(booksReadBy[<span class="hljs-string">&#x27;Al&#x27;</span>])</span><br>2<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">len</span>(booksReadBy[<span class="hljs-string">&#x27;Zophie&#x27;</span>]) <span class="hljs-comment"># é»˜è®¤å€¼æ˜¯ä¸€ä¸ªç©ºåˆ—è¡¨</span></span><br>0<br></code></pre></td></tr></table></figure><p>å¦‚æœéœ€è¦å¯¹ä»»æ„ä¸€ä¸ªé”®è®¾ç½®é»˜è®¤å€¼ï¼Œä½¿ç”¨<code>collections.defaultdict()</code>è¦æ¯”ä½¿ç”¨å¸¸è§„å­—å…¸å†åå¤è°ƒç”¨<code>setdefault()</code>æ–¹ä¾¿å¾—å¤šã€‚</p><h3 id="6-7-3-ä½¿ç”¨å­—å…¸ä»£æ›¿switchè¯­å¥"><a href="#6-7-3-ä½¿ç”¨å­—å…¸ä»£æ›¿switchè¯­å¥" class="headerlink" title="6.7.3ã€€ä½¿ç”¨å­—å…¸ä»£æ›¿switchè¯­å¥"></a>6.7.3ã€€ä½¿ç”¨å­—å…¸ä»£æ›¿<code>switch</code>è¯­å¥</h3><p>Javaä¹‹ç±»çš„è¯­è¨€æœ‰<code>switch</code>è¯­å¥ï¼Œä¸<code>if-elif-else</code>ç±»ä¼¼ï¼Œç”¨æ¥æ ¹æ®å˜é‡æ˜¯å¤šä¸ªå¯èƒ½å€¼ä¸­çš„å“ªä¸€ä¸ªæ¥æ‰§è¡Œä¸åŒçš„ä»£ç ã€‚Pythonæ²¡æœ‰<code>switch</code>è¯­å¥ï¼Œæ‰€ä»¥Pythonç¨‹åºå‘˜æœ‰æ—¶ä¼šå†™å‡ºä¸‹é¢è¿™ä¸ªç¤ºä¾‹ä¸­çš„ä»£ç ã€‚è¿™æ®µä»£ç æ ¹æ®<code>season</code>å˜é‡çš„ä¸åŒå€¼æ¥æ‰§è¡Œä¸åŒçš„èµ‹å€¼è¯­å¥ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ä¸‹åˆ—ifå’Œelifæ¡ä»¶è¯­å¥ä¸­éƒ½æœ‰â€œseason ==â€ï¼š</span><br><span class="hljs-keyword">if</span> season == <span class="hljs-string">&#x27;Winter&#x27;</span>:<br>    holiday = <span class="hljs-string">&#x27;New Year\&#x27;s Day&#x27;</span><br><span class="hljs-keyword">elif</span> season == <span class="hljs-string">&#x27;Spring&#x27;</span>:<br>    holiday = <span class="hljs-string">&#x27;May Day&#x27;</span><br><span class="hljs-keyword">elif</span> season == <span class="hljs-string">&#x27;Summer&#x27;</span>:<br>    holiday = <span class="hljs-string">&#x27;Juneteenth&#x27;</span><br><span class="hljs-keyword">elif</span> season == <span class="hljs-string">&#x27;Fall&#x27;</span>:<br>    holiday = <span class="hljs-string">&#x27;Halloween&#x27;</span><br><span class="hljs-keyword">else</span>:<br>    holiday = <span class="hljs-string">&#x27;Personal day off&#x27;</span><br></code></pre></td></tr></table></figure><p>è¿™æ®µä»£ç ç¬¦åˆPythoné£æ ¼ï¼Œä½†æ˜¯æœ‰ç‚¹å•°å”†ã€‚Javaçš„<code>switch</code>è¯­å¥é»˜è®¤ä¼šæœ‰fall-throughç‰¹æ€§ï¼Œå¦‚æœå—ä¸ç”¨<code>break</code>è¯­å¥ç»“æŸï¼Œå°±ä¼šç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªå—ã€‚å¿˜è®°æ·»åŠ <code>break</code>è¯­å¥æ˜¯ä¸ªå¸¸è§çš„é”™è¯¯æ¥æºã€‚è¿™ä¸ªPythonç¤ºä¾‹ä¸­æ‰€æœ‰<code>if-elif</code>è¯­å¥çš„åŠŸèƒ½éƒ½æ¯”è¾ƒç±»ä¼¼ï¼Œå¯¹äºè¿™ç§æƒ…å†µï¼Œä¸€äº›Pythonç¨‹åºå‘˜æ›´å–œæ¬¢é€šè¿‡å­—å…¸æ¥åšè¿™ç§å·¥ä½œã€‚ä¸‹é¢è¿™æ®µç®€æ´çš„ä»£ç ä¸ä¸Šä¸€ä¸ªç¤ºä¾‹åŠŸæ•ˆä¸€è‡´ï¼š</p><figure class="highlight sml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs sml">holiday = &#123;<span class="hljs-symbol">&#x27;Winter&#x27;</span>: <span class="hljs-symbol">&#x27;New</span> <span class="hljs-type">Year</span>\<span class="hljs-symbol">&#x27;s</span> <span class="hljs-type">Day&#x27;</span>,<br>           <span class="hljs-symbol">&#x27;Spring&#x27;</span>: <span class="hljs-symbol">&#x27;May</span> <span class="hljs-type">Day&#x27;</span>,<br>           <span class="hljs-symbol">&#x27;Summer&#x27;</span>: <span class="hljs-symbol">&#x27;Juneteenth&#x27;</span>,<br>           <span class="hljs-symbol">&#x27;Fall&#x27;</span>:   <span class="hljs-symbol">&#x27;Halloween&#x27;</span>&#125;.get(season, <span class="hljs-symbol">&#x27;Personal</span> day off&#x27;)<br></code></pre></td></tr></table></figure><p>è¿™æ®µä»£ç åªæ˜¯ä¸€ä¸ªç®€å•çš„èµ‹å€¼è¯­å¥ã€‚<code>holiday</code>ä¸­å­˜å‚¨çš„å€¼æ˜¯<code>get()</code>æ–¹æ³•è°ƒç”¨çš„ç»“æœã€‚å¦‚æœå­—å…¸ä¸­å­˜åœ¨<code>season</code>çš„å€¼å¯¹åº”çš„é”®ï¼Œåˆ™è¿”å›å¯¹åº”çš„å€¼ï¼Œä¸å­˜åœ¨æ—¶åˆ™è¿”å›<code>&#39;Personal day off&#39;</code>ã€‚ä½¿ç”¨å­—å…¸ä¼šè®©ä»£ç æ›´åŠ ç®€æ´ï¼Œä½†ä¹Ÿå¯èƒ½é™ä½å¯è¯»æ€§ã€‚æ‰€ä»¥ï¼Œæ˜¯å¦ä½¿ç”¨è¿™ç§ä¹ æƒ¯ç”¨æ³•å–å†³äºä½ ã€‚</p><h2 id="6-8-æ¡ä»¶è¡¨è¾¾å¼ï¼šPythonâ€œä¸‘é™‹â€çš„ä¸‰å…ƒè¿ç®—ç¬¦"><a href="#6-8-æ¡ä»¶è¡¨è¾¾å¼ï¼šPythonâ€œä¸‘é™‹â€çš„ä¸‰å…ƒè¿ç®—ç¬¦" class="headerlink" title="6.8ã€€æ¡ä»¶è¡¨è¾¾å¼ï¼šPythonâ€œä¸‘é™‹â€çš„ä¸‰å…ƒè¿ç®—ç¬¦"></a>6.8ã€€æ¡ä»¶è¡¨è¾¾å¼ï¼šPythonâ€œä¸‘é™‹â€çš„ä¸‰å…ƒè¿ç®—ç¬¦</h2><p>ã€€ã€€<strong>ä¸‰å…ƒè¿ç®—ç¬¦</strong>ï¼ˆåœ¨Pythonä¸­çš„æ­£å¼è¯´æ³•æ˜¯<strong>æ¡ä»¶è¡¨è¾¾å¼</strong>ï¼Œæœ‰æ—¶ä¹Ÿè¢«ç§°ä¸º<strong>ä¸‰å…ƒé€‰æ‹©è¡¨è¾¾å¼</strong>ï¼‰æ˜¯æ ¹æ®æ¡ä»¶å°†æŸä¸ªè¡¨è¾¾å¼æ¨å¯¼ä¸ºä¸¤ä¸ªå€¼ä¸­çš„æŸä¸€ä¸ªå€¼ã€‚é€šå¸¸ï¼Œå®ƒæ˜¯ä½¿ç”¨Pythoné£æ ¼çš„<code>if-else</code>è¯­å¥å®ç°çš„ï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-comment"># Pythoné£æ ¼çš„ç¤ºä¾‹</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">condition = <span class="hljs-literal">True</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">if</span> condition:</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">    message = <span class="hljs-string">&#x27;Access granted&#x27;</span></span><br><span class="hljs-meta prompt_">...</span> <span class="language-python"><span class="hljs-keyword">else</span>:</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">    message = <span class="hljs-string">&#x27;Access denied&#x27;</span></span><br><span class="hljs-meta prompt_">...</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">message</span><br>&#x27;Access granted&#x27;<br></code></pre></td></tr></table></figure><p>ã€€ã€€â€œä¸‰å…ƒâ€çš„æœ¬æ„æ˜¯è¿ç®—ç¬¦æœ‰3ä¸ªè¾“å…¥ï¼Œä½†å®ƒåœ¨ç¼–ç¨‹ä¸­çš„å«ä¹‰ç±»ä¼¼äºæ¡ä»¶è¡¨è¾¾å¼ã€‚æ¡ä»¶è¡¨è¾¾å¼ä¹Ÿèƒ½ä¸ºè¿™ç§æ¨¡å¼æä¾›ä¸€ä¸ªæ›´ç®€æ´çš„ä¸€è¡Œä»£ç ç‰ˆæœ¬ã€‚åœ¨Pythonä¸­ï¼Œå®ƒä»¬æ˜¯é€šè¿‡å…³é”®å­—<code>if</code>å’Œ<code>else</code>çš„å¥‡ç‰¹ç»„åˆå®ç°çš„ï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">valueIfTrue = <span class="hljs-string">&#x27;Access granted&#x27;</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">valueIfFalse = <span class="hljs-string">&#x27;Access denied&#x27;</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">condition = <span class="hljs-literal">True</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">message = valueIfTrue <span class="hljs-keyword">if</span> condition <span class="hljs-keyword">else</span> valueIfFalse â¶</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">message</span><br>&#x27;Access granted&#x27;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">print</span>(valueIfTrue <span class="hljs-keyword">if</span> condition <span class="hljs-keyword">else</span> valueIfFalse) â·</span><br>&#x27;Access granted&#x27;<br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">condition = <span class="hljs-literal">False</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">message = valueIfTrue <span class="hljs-keyword">if</span> condition <span class="hljs-keyword">else</span> valueIfFalse</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">message</span><br>&#x27;Access denied&#x27;<br></code></pre></td></tr></table></figure><p><code>valueIfTrue if condition else valueIfFalse</code>â¶è¿™æ®µè¡¨è¾¾å¼åœ¨<code>condition</code>å€¼ä¸º<code>True</code>æ—¶ç»“æœä¸º<code>valueIfTrue</code>ï¼Œåœ¨<code>condition</code>å€¼ä¸º<code>False</code>æ—¶å€¼ä¸º<code>valueIfFalse</code>ã€‚Guido van Rossumå¼€ç©ç¬‘åœ°å°†è¿™ç§è¯­æ³•è®¾è®¡ç§°ä½œâ€œæ•…æ„çš„ä¸‘é™‹â€ã€‚å¤§å¤šæ•°è¯­è¨€çš„ä¸‰å…ƒè¿ç®—ç¬¦æ˜¯å…ˆåˆ—å‡ºæ¡ä»¶ï¼Œä¹‹åå†æ˜¯æ¡ä»¶ä¸ºçœŸæ—¶çš„å€¼å’Œæ¡ä»¶ä¸ºå‡æ—¶çš„å€¼ã€‚ä»»ä½•ä½¿ç”¨è¡¨è¾¾å¼æˆ–è€…å€¼çš„åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨æ¡ä»¶è¡¨è¾¾å¼ï¼ŒåŒ…æ‹¬ä½œä¸ºå‡½æ•°è°ƒç”¨çš„å‚æ•°â·ã€‚</p><p>ã€€ã€€ä¸ºä»€ä¹ˆPythonä¼šåœ¨2.5ç‰ˆæœ¬ä¸­å¼•å…¥è¿™ç§è¯­æ³•ï¼Œå³ä½¿è¿èƒŒäº†â€œç¾ä¸½èƒœäºä¸‘é™‹â€è¿™æ¡å‡†åˆ™ï¼Ÿå› ä¸ºè™½ç„¶è¿™ç§å†™æ³•å¯è¯»æ€§ä¸å¼ºï¼Œä½†å¾ˆå¤šç¨‹åºå‘˜ä½¿ç”¨ä¸‰å…ƒè¿ç®—ç¬¦ï¼Œå¹¶å¸Œæœ›Pythonä¹Ÿæ”¯æŒè¿™ç§è¯­æ³•ã€‚å·§ç”¨å¸ƒå°”è¿ç®—ç¬¦çš„çŸ­è·¯è¿ç®—å¯ä»¥åˆ›å»ºä¸€ç§ä¸‰å…ƒè¿ç®—ç¬¦ã€‚è¡¨è¾¾å¼<code>condition and valueIfTrue or valueIfFalse</code>ï¼Œåœ¨<code>condition</code>ä¸º<code>True</code>æ—¶ç»“æœä¸º<code>valueIfTrue</code>ï¼Œåä¹‹ä¸º<code>valueIfFalse</code>ï¼ˆå®é™…ä¸Šæœ‰ä¸€é‡è¦çš„ä¾‹å¤–ï¼Œä¸‹é¢ä¼šè®²åˆ°ï¼‰ã€‚åœ¨äº¤äº’å¼shellä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-comment"># ä¸ç¬¦åˆPythoné£æ ¼çš„ç¤ºä¾‹</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">valueIfTrue = <span class="hljs-string">&#x27;Access granted&#x27;</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">valueIfFalse = <span class="hljs-string">&#x27;Access denied&#x27;</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">condition = <span class="hljs-literal">True</span></span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">condition <span class="hljs-keyword">and</span> valueIfTrue <span class="hljs-keyword">or</span> valueIfFalse</span><br>&#x27;Access granted&#x27;<br></code></pre></td></tr></table></figure><p>è¿™ç§<code>condition and valueIfTrue or valueIfFalse</code>é£æ ¼çš„ä¼ªä¸‰å…ƒè¿ç®—ç¬¦æœ‰ä¸€ä¸ªä¸æ˜“å¯Ÿè§‰çš„é”™è¯¯ï¼šå¦‚æœ<code>valueIfTrue</code>æ˜¯ä¸€ä¸ªå‡å€¼ï¼ˆå¦‚<code>0</code>ã€<code>False</code>ã€<code>None</code>æˆ–ç©ºç™½å­—ç¬¦ä¸²ï¼‰ï¼Œå³ä½¿æ¡ä»¶ä¸º<code>True</code>ï¼Œè¡¨è¾¾å¼çš„ç»“æœè¿˜æ˜¯ä¼šä¸º<code>valueIfFalse</code>ã€‚ä½†è¿™ç§ä¼ªä¸‰å…ƒè¿ç®—ç¬¦è¿˜åœ¨è¢«ç¨‹åºå‘˜ä½¿ç”¨ã€‚â€œä¸ºä»€ä¹ˆPythonæ²¡æœ‰ä¸‰å…ƒè¿ç®—ç¬¦ï¼Ÿâ€è¿™æ˜¯Pythonæ ¸å¿ƒå¼€å‘è€…ç»å¸¸è¢«é—®åˆ°çš„é—®é¢˜ã€‚æ¡ä»¶è¡¨è¾¾å¼çš„å‡ºç°å°±æ˜¯ä¸ºäº†å“åº”ç¨‹åºå‘˜æƒ³è¦ä¸‰å…ƒè¿ç®—ç¬¦çš„å‘¼å£°ï¼Œé¿å…ç¨‹åºå‘˜ç»§ç»­ä½¿ç”¨å®¹æ˜“å‡ºé”™çš„ä¼ªä¸‰å…ƒè¿ç®—ç¬¦ã€‚ä½†ç¨‹åºå‘˜ä¹Ÿä¸æ„¿æ„ä½¿ç”¨â€œä¸‘é™‹â€çš„æ¡ä»¶è¿ç®—ç¬¦ã€‚å°½ç®¡â€œç¾ä¸½èƒœäºä¸‘é™‹â€ï¼Œä½†â€œå®ç”¨æ€§èƒœäºçº¯ç²¹æ€§â€ï¼Œè¿™å°±æ˜¯Pythonâ€œä¸‘é™‹çš„ä¸‰å…ƒè¿ç®—ç¬¦â€ä½“ç°çš„ä»·å€¼ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€pythonã€‘è¯»ä¹¦ç¬”è®°ä¹‹ä»£ç çš„åå‘³é“ï¼ˆäº”ï¼‰</title>
    <link href="/2024/01/03/615python%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8B%E4%BB%A3%E7%A0%81%E7%9A%84%E5%9D%8F%E5%91%B3%E9%81%93%EF%BC%88%E4%BA%94%EF%BC%89/"/>
    <url>/2024/01/03/615python%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8B%E4%BB%A3%E7%A0%81%E7%9A%84%E5%9D%8F%E5%91%B3%E9%81%93%EF%BC%88%E4%BA%94%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="Python-è¯»ä¹¦ç¬”è®°ä¹‹ä»£ç çš„åå‘³é“"><a href="#Python-è¯»ä¹¦ç¬”è®°ä¹‹ä»£ç çš„åå‘³é“" class="headerlink" title="Python è¯»ä¹¦ç¬”è®°ä¹‹ä»£ç çš„åå‘³é“"></a>Python è¯»ä¹¦ç¬”è®°ä¹‹ä»£ç çš„åå‘³é“</h1><h1 id="2-ã€æ–‡ä»¶ç³»ç»Ÿ"><a href="#2-ã€æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="2 ã€æ–‡ä»¶ç³»ç»Ÿ"></a>2 ã€æ–‡ä»¶ç³»ç»Ÿ</h1><p>2.1.1æ–‡ä»¶ç³»ç»Ÿ</p><p>åœ¨Windowsä¸Šï¼Œæ–‡ä»¶å¤¹å’Œæ–‡ä»¶åä½¿ç”¨åæ–œæ ï¼ˆ\ï¼‰åˆ†éš”ï¼›åœ¨macOSå’ŒLinuxä¸Šï¼Œåˆ™æ˜¯ä½¿ç”¨æ­£æ–œæ ï¼ˆ&#x2F;ï¼‰åˆ†éš”ã€‚ä¸ºäº†ä½¿Pythonè„šæœ¬è·¨å¹³å°å…¼å®¹ï¼Œå¯ä»¥ä½¿ç”¨<code>pathlib</code>æ¨¡å—å’Œ<code>/</code>è¿ç®—ç¬¦ã€‚</p><p>å¯¼å…¥<code>pathlib</code>çš„å…¸å‹æ–¹æ³•æ˜¯ä½¿ç”¨è¯­å¥<code>from pathlib import Path</code>ã€‚å› ä¸º<code>Path</code>æ˜¯<code>pathlib</code>ä¸­æœ€å¸¸ç”¨çš„ç±»ï¼Œæ‰€ä»¥ä½¿ç”¨è¿™ç§å½¢å¼å¯¼å…¥å¯ä»¥è®©ä½ åœ¨åç»­åªéœ€è¦è¾“å…¥<code>Path</code>ï¼Œè€Œä¸æ˜¯<code>pathlib.Path</code>ã€‚åœ¨è¡¨è¾¾å¼æœ€å·¦è¾¹è¾“å…¥ä¸€ä¸ª<code>Path</code>å¯¹è±¡ï¼Œåœ¨åé¢ä½¿ç”¨<code>/</code>æŠŠ<code>Path</code>å¯¹è±¡æˆ–å­—ç¬¦ä¸²è¿æ¥æˆä¸€æ¡å®Œæ•´è·¯å¾„ã€‚åœ¨äº¤äº’å¼shellä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; from pathlib import Path</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Path(<span class="hljs-string">&#x27;spam&#x27;</span>) / <span class="hljs-string">&#x27;bacon&#x27;</span> / <span class="hljs-string">&#x27;eggs&#x27;</span></span><br>WindowsPath(&#x27;spam/bacon/eggs&#x27;)<br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Path(<span class="hljs-string">&#x27;spam&#x27;</span>) / Path(<span class="hljs-string">&#x27;bacon/eggs&#x27;</span>)</span><br>WindowsPath(&#x27;spam/bacon/eggs&#x27;)<br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Path(<span class="hljs-string">&#x27;spam&#x27;</span>) / Path(<span class="hljs-string">&#x27;bacon&#x27;</span>, <span class="hljs-string">&#x27;eggs&#x27;</span>)</span><br>WindowsPath(&#x27;spam/bacon/eggs&#x27;)<br></code></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œå› ä¸ºæˆ‘æ˜¯åœ¨Windowsæœºå™¨ä¸Šè¿è¡Œè¿™æ®µä»£ç çš„ï¼Œæ‰€ä»¥<code>Path</code>è¿”å›äº†<code>WindowsPath</code>å¯¹è±¡ã€‚è€Œåœ¨macOSå’ŒLinuxä¸Šåˆ™ä¼šè¿”å›<code>PosixPath</code>å¯¹è±¡ã€‚ï¼ˆPOSIXæ˜¯ç±»Unixæ“ä½œç³»ç»Ÿçš„ä¸€ç»„æ ‡å‡†ï¼Œå…³äºå®ƒçš„å†…å®¹ä¸åœ¨æœ¬ä¹¦è®¨è®ºèŒƒå›´å†…ã€‚ï¼‰å¯¹æˆ‘ä»¬è€Œè¨€ï¼Œæ— é¡»ç†è§£ä¸¤è€…çš„åŒºåˆ«ã€‚</p><p>ã€€ã€€å¯ä»¥å°†<code>Path</code>å¯¹è±¡ä¼ é€’ç»™Pythonæ ‡å‡†åº“ä¸­ä»»ä½•ä¸€ä¸ªä»¥æ–‡ä»¶åä½œä¸ºå‚æ•°çš„å‡½æ•°ã€‚ä¾‹å¦‚ï¼Œå‡½æ•°è°ƒç”¨<code>open(Path(&#39;C:\\&#39;) / &#39;Users&#39; / &#39;Al&#39; / &#39;Desktop&#39; / &#39;spam.py&#39;)</code>ç­‰åŒäº<code>open(r&#39;C:\Users\Al\ Desktop\spam.py&#39;)</code>ã€‚</p><h3 id="2-1-2ä¸»ç›®å½•"><a href="#2-1-2ä¸»ç›®å½•" class="headerlink" title="2.1.2ä¸»ç›®å½•"></a>2.1.2ä¸»ç›®å½•</h3><p>æ‰€æœ‰ç”¨æˆ·åœ¨è®¡ç®—æœºä¸Šéƒ½æœ‰ä¸€ä¸ªè¢«ç§°ä¸º<strong>ä¸»ç›®å½•</strong>æˆ–<strong>ä¸»æ–‡ä»¶å¤¹</strong>çš„æ–‡ä»¶å¤¹ï¼Œç”¨äºå­˜æ”¾è¯¥ç”¨æˆ·è‡ªå·±çš„æ–‡ä»¶ã€‚å¯ä»¥é€šè¿‡è°ƒç”¨<code>Path.home()</code>æ¥è·å–ä¸»ç›®å½•çš„<code>Path</code>å¯¹è±¡ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Path.home()</span><br>WindowsPath(&#x27;C:/Users/Al&#x27;)<br></code></pre></td></tr></table></figure><p>ä¸»ç›®å½•çš„ä½ç½®å–å†³äºæ“ä½œç³»ç»Ÿã€‚</p><ul><li>åœ¨Windowsä¸Šï¼Œä¸»ç›®å½•ä½äºC:\Usersä¸‹ã€‚</li><li>åœ¨macOSä¸Šï¼Œä¸»ç›®å½•ä½äº&#x2F;Usersä¸‹ã€‚</li><li>åœ¨Linuxä¸Šï¼Œä¸»ç›®å½•é€šå¸¸ä½äº&#x2F;homeä¸‹ã€‚</li></ul><h2 id="2-1-3-å½“å‰å·¥ä½œç›®å½•"><a href="#2-1-3-å½“å‰å·¥ä½œç›®å½•" class="headerlink" title="2.1.3 å½“å‰å·¥ä½œç›®å½•"></a>2.1.3 å½“å‰å·¥ä½œç›®å½•</h2><p>è®¡ç®—æœºè¿è¡Œçš„æ¯ä¸ªç¨‹åºéƒ½æœ‰è‡ªå·±çš„<strong>å½“å‰å·¥ä½œç›®å½•</strong>ï¼ˆè‹±æ–‡ä¸ºcwdï¼Œæ˜¯current working directoryçš„é¦–å­—æ¯ç¼©å†™ï¼‰ã€‚ä»»ä½•ä¸ä»¥æ ¹ç›®å½•å¼€å¤´çš„æ–‡ä»¶åæˆ–è·¯å¾„éƒ½æ˜¯ç›¸å¯¹äºå½“å‰å·¥ä½œç›®å½•è€Œè¨€çš„ç›¸å¯¹è·¯å¾„ã€‚å°½ç®¡â€œç›®å½•â€æ˜¯â€œæ–‡ä»¶å¤¹â€çš„è¿‡æ—¶è¯´æ³•ï¼Œä½†â€œå½“å‰å·¥ä½œç›®å½•â€ï¼ˆä¹Ÿå¯ä»¥ç®€ç§°ä¸ºå·¥ä½œç›®å½•ï¼‰æ˜¯æ ‡å‡†æœ¯è¯­ï¼Œä¸èƒ½ä½¿ç”¨â€œå½“å‰å·¥ä½œæ–‡ä»¶å¤¹â€ä»£æ›¿ã€‚</p><p>å¯ä»¥ä½¿ç”¨<code>Path.cwd()</code>å‡½æ•°å°†cwdä½œä¸ºä¸€ä¸ª<code>Path</code>å¯¹è±¡æ¥è·å–ï¼Œå¹¶ä½¿ç”¨<code>os.chdir()</code>ä¿®æ”¹å®ƒã€‚åœ¨äº¤äº’å¼shellä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; from pathlib import Path</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; import os</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Path.cwd() â¶</span><br>WindowsPath(&#x27;C:/Users/Al/AppData/Local/Programs/Python/Python38&#x27;)<br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; os.chdir(<span class="hljs-string">&#x27;C:\\Windows\\System32&#x27;</span>) â·</span><br><span class="hljs-meta prompt_">&gt;</span><span class="language-bash">&gt;&gt; Path.cwd()</span><br>WindowsPath(&#x27;C:/Windows/System32&#x27;)<br></code></pre></td></tr></table></figure><p>åœ¨è¿™æ®µä»£ç ä¸­ï¼Œcwdè¢«è®¾ç½®ä¸º<code>C:\Users\Al\AppData\Local\Programs\Python\Python38</code>â¶ï¼Œæ‰€ä»¥æ–‡ä»¶åproject.docxå®é™…æŒ‡å‘C:\Users\Al\AppData\Local\Programs\Python\Python38\project.docxã€‚å¦‚æœæŠŠcwdä¿®æ”¹ä¸ºC:\Windows\System32â·ï¼Œæ–‡ä»¶åproject.docxåˆ™æŒ‡å‘C:\Windows\System32\project.docxã€‚</p><p>åœ¨<code>pathlib</code>æ¨¡å—å‡ºç°ä¹‹å‰ï¼Œäººä»¬å¸¸ä½¿ç”¨<code>os</code>æ¨¡å—ä¸­çš„<code>os.getcwd()</code>å‡½æ•°è·å–cwdè·¯å¾„å­—ç¬¦ä¸²</p><h3 id="2-1-4-ç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„"><a href="#2-1-4-ç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„" class="headerlink" title="2.1.4ã€€ç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„"></a>2.1.4ã€€ç»å¯¹è·¯å¾„å’Œç›¸å¯¹è·¯å¾„</h3><p>æŒ‡å®šæ–‡ä»¶è·¯å¾„æœ‰ä¸¤ç§æ–¹æ³•ã€‚</p><ul><li>ç»å¯¹è·¯å¾„ï¼Œæ˜¯ä»¥æ ¹ç›®å½•ä¸ºèµ·ç‚¹çš„è·¯å¾„</li><li>ç›¸å¯¹è·¯å¾„ï¼Œæ˜¯ç›¸å¯¹äºç¨‹åºçš„å½“å‰å·¥ä½œç›®å½•çš„è·¯å¾„</li></ul><p>ã€€ã€€å€¼å¾—ä¸€æçš„è¿˜æœ‰<code>.</code>æ–‡ä»¶å¤¹å’Œ<code>..</code>æ–‡ä»¶å¤¹ï¼Œå®ƒä»¬å¹¶éçœŸæ­£çš„æ–‡ä»¶å¤¹ï¼Œè€Œæ˜¯å¯ä»¥åœ¨è·¯å¾„ä¸­ä½¿ç”¨çš„ç‰¹æ®Šæ ‡è®°ç¬¦ã€‚ä¸€ä¸ªç‚¹ï¼ˆ<code>.</code>ï¼‰æŒ‡ä»£å½“å‰ç›®å½•ï¼Œä¸¤ä¸ªç‚¹ï¼ˆ<code>..</code>ï¼‰æŒ‡ä»£çˆ¶ç›®å½•ã€‚</p><h1 id="ç¬¬-4-ç« -é€‰æ‹©æ˜“æ‡‚çš„åç§°"><a href="#ç¬¬-4-ç« -é€‰æ‹©æ˜“æ‡‚çš„åç§°" class="headerlink" title="ç¬¬ 4 ç« ã€€é€‰æ‹©æ˜“æ‡‚çš„åç§°"></a>ç¬¬ 4 ç« ã€€é€‰æ‹©æ˜“æ‡‚çš„åç§°</h1><blockquote><p>â€œè®¡ç®—æœºç§‘å­¦ä¸­æœ‰ä¸¤å¤§éš¾é¢˜ï¼šå‘½åã€ç¼“å­˜å¤±æ•ˆå’Œå·®ä¸€é”™è¯¯ã€‚â€è¿™ä¸ªç»å…¸ç¬‘è¯æ˜¯Leon Bambrickæ ¹æ®Phil Karltonè¯´çš„è¯æ”¹ç¼–çš„ï¼Œå®ƒæ­ç¤ºäº†ä¸€ä¸ªçœŸç†â€”â€”ä¸ºå˜é‡ã€å‡½æ•°ã€ç±»ç­‰ç¼–ç¨‹ä¸­çš„å…ƒç´ èµ·åï¼ˆæ­£å¼çš„è¯´æ³•å«ä½œæ ‡è¯†ç¬¦ï¼‰å¾ˆéš¾ã€‚ç®€æ´è€Œæœ‰æè¿°æ„ä¹‰çš„åç§°èƒ½å¤Ÿå¤§å¤§æå‡ç¨‹åºä»£ç çš„å¯è¯»æ€§ã€‚</p></blockquote><p>ã€€ã€€ä½†æ˜¯èµ·åå­—è¯´èµ·æ¥å®¹æ˜“åšèµ·æ¥éš¾ã€‚å‡å¦‚ä½ è¦æ¬å®¶ï¼ŒæŠŠç²˜è´´åœ¨æ‰€æœ‰åŒ…è£…ç®±ä¸Šçš„æ ‡ç­¾å†™æˆâ€œç‰©å“â€è™½ç„¶å¾ˆç®€æ´ï¼Œä½†ä¸å…·å¤‡æè¿°æ€§ã€‚è€Œå°†ä¸€æœ¬ç¼–ç¨‹ä¹¦èµ·åä¸ºã€Šç”¨Pythonå‘æ˜ä½ è‡ªå·±çš„è®¡ç®—æœºæ¸¸æˆã€‹è™½ç„¶å…·å¤‡äº†æè¿°æ€§ï¼Œä½†åˆå¤ªè¿‡å•°å”†ã€‚</p><p>ã€€ã€€é™¤éç¼–å†™çš„ä»£ç æ˜¯â€œä¸€æ¬¡æ€§â€çš„ï¼Œä»…éœ€è¿è¡Œä¸€æ¬¡ï¼Œä¸éœ€è¦é•¿æœŸç»´æŠ¤ï¼Œå¦åˆ™åº”è¯¥åœ¨å‘½åè¿™ä»¶äº‹ä¸ŠèŠ±äº›å·¥å¤«ã€‚å¦‚æœåªæ˜¯ç®€å•åœ°ç”¨<code>a</code>ã€<code>b</code>ã€<code>c</code>ä½œä¸ºå˜é‡åï¼Œå°†æ¥ä¼šèŠ±è´¹ä¸å¿…è¦çš„å¿ƒåŠ›å›å¿†å½“åˆè¿™äº›å˜é‡çš„ä½œç”¨ã€‚</p><p>ã€€ã€€å‘½åæ˜¯å¿…é¡»è¦åšçš„ä¸€ä¸ªä¸»è§‚é€‰æ‹©ï¼Œè€Œè‡ªåŠ¨æ ¼å¼åŒ–å·¥å…·ï¼ˆæ¯”å¦‚ç¬¬3ç« ä»‹ç»çš„Blackï¼‰æ— æ³•ä¸ºå˜é‡èµ·åã€‚æœ¬ç« æä¾›äº†ä¸€äº›æŒ‡å¯¼åŸåˆ™ï¼Œå¸®åŠ©ä½ é€‰æ‹©å¥½çš„åå­—ï¼Œè§„é¿ç³Ÿç³•çš„åå­—ã€‚å½“ç„¶ï¼Œè¿™äº›åŸåˆ™å¹¶éé‡‘è§„é“å¾‹ï¼Œä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„åˆ¤æ–­å†³å®šä»€ä¹ˆæ—¶å€™åº”ç”¨å®ƒä»¬ã€‚</p><h2 id="4-1-å‘½åé£æ ¼"><a href="#4-1-å‘½åé£æ ¼" class="headerlink" title="4.1ã€€å‘½åé£æ ¼"></a>4.1ã€€å‘½åé£æ ¼</h2><p>Pythonçš„æ ‡è¯†ç¬¦åŒºåˆ†å¤§å°å†™ï¼Œä¸”ä¸èƒ½åŒ…å«ç©ºæ ¼ã€‚å½“æ ‡è¯†ç¬¦ä¸­å­˜åœ¨å¤šä¸ªå•è¯æ—¶ï¼Œç¨‹åºå‘˜å¯ä»¥åº”ç”¨ä»¥ä¸‹å‡ ç§å‘½åé£æ ¼ã€‚</p><ul><li>è›‡å½¢å‘½åæ³•ï¼ˆ<code>snake_case</code>ï¼‰ï¼šç”¨ä¸‹åˆ’çº¿åˆ†éš”å•è¯ï¼Œä¸¤ä¸ªå•è¯ä¹‹é—´çš„è¿æ¥çœ‹èµ·æ¥åƒè›‡ä¸€æ ·ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæ‰€æœ‰å­—æ¯éƒ½æ˜¯å°å†™çš„ï¼Œä½†å¸¸é‡åç»å¸¸é‡‡ç”¨å¤§å†™ï¼Œç±»ä¼¼äº<code>UPPER_SNAKE_CASE</code>ã€‚</li><li>é©¼å³°å‘½åæ³•ï¼ˆ<code>camelCase</code>ï¼‰ï¼šä»ç¬¬äºŒä¸ªå•è¯å¼€å§‹ï¼Œæ¯ä¸ªå•è¯ä½¿ç”¨é¦–å­—æ¯å¤§å†™è¿›è¡Œåˆ†éš”ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç¬¬ä¸€ä¸ªå•è¯é¦–å­—æ¯å°å†™ï¼Œåé¢çš„å•è¯çš„å¤§å†™å­—æ¯çœ‹èµ·æ¥åƒé©¼å³°ã€‚</li><li>Pascalå‘½åæ³•ï¼ˆ<code>PascalCase</code>ï¼‰ï¼šå› å…¶åœ¨Pascalç¼–ç¨‹è¯­è¨€ä¸­çš„ä½¿ç”¨è€Œå¾—åã€‚å®ƒè·Ÿé©¼å³°å‘½åæ³•ç±»ä¼¼ï¼Œä½†ç¬¬ä¸€ä¸ªå•è¯çš„é¦–å­—æ¯ä¹Ÿè¦å¤§å†™ã€‚</li></ul><p>ã€€ã€€æœ€å¸¸è§çš„æ˜¯è›‡å½¢å‘½åæ³•å’Œé©¼å³°å‘½åæ³•ã€‚é€‰æ‹©å“ªä¸€ç§éƒ½æ— å…³ç´§è¦ï¼Œåªè¦ä¸åœ¨é¡¹ç›®ä¸­æ··ç”¨å°±å¥½ã€‚</p><h2 id="4-2-PEP-8çš„å‘½åé£æ ¼"><a href="#4-2-PEP-8çš„å‘½åé£æ ¼" class="headerlink" title="4.2ã€€PEP 8çš„å‘½åé£æ ¼"></a>4.2ã€€PEP 8çš„å‘½åé£æ ¼</h2><p>ç¬¬3ç« ä¸­ä»‹ç»çš„PEP 8æ–‡æ¡£å¯¹Pythonçš„å‘½åè§„åˆ™æå‡ºäº†ä¸€äº›å»ºè®®ã€‚</p><ul><li>æ‰€æœ‰çš„å­—æ¯åº”æ˜¯ASCIIå­—æ¯ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰é‡éŸ³ç¬¦å·çš„å¤§å†™å’Œå°å†™çš„è‹±æ–‡å­—æ¯ã€‚</li><li>æ¨¡å—ååº”è¯¥ç®€çŸ­ï¼Œéƒ½æ˜¯å°å†™å­—æ¯ã€‚</li><li>ç±»ååº”ä½¿ç”¨Pascalå‘½åæ³•ã€‚</li><li>å¸¸é‡ååº”ä½¿ç”¨å¤§å†™å­—æ¯çš„è›‡å½¢å‘½åæ³•ã€‚</li><li>å‡½æ•°åã€æ–¹æ³•åå’Œå˜é‡ååº”ä½¿ç”¨å°å†™å­—æ¯çš„è›‡å½¢å‘½åæ³•ã€‚</li><li>æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°åº”æ€»æ˜¯å‘½åä¸ºå°å†™çš„<code>self</code>ã€‚</li><li>ç±»æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°åº”æ€»æ˜¯å‘½åä¸ºå°å†™çš„<code>cls</code>ã€‚</li><li>ç±»ä¸­çš„ç§æœ‰å±æ€§åº”æ€»æ˜¯ä»¥ä¸‹åˆ’çº¿ï¼ˆ<code>_</code>ï¼‰å¼€å¤´ã€‚</li><li>ç±»ä¸­çš„å…¬å…±å±æ€§ä¸åº”ä»¥ä¸‹åˆ’çº¿ï¼ˆ<code>_</code>ï¼‰å¼€å¤´ã€‚</li></ul><h2 id="4-3-é€‚å½“çš„åç§°é•¿åº¦"><a href="#4-3-é€‚å½“çš„åç§°é•¿åº¦" class="headerlink" title="4.3ã€€é€‚å½“çš„åç§°é•¿åº¦"></a>4.3ã€€é€‚å½“çš„åç§°é•¿åº¦</h2><p>æ˜¾ç„¶ï¼Œåç§°çš„é•¿åº¦åº”è¯¥é€‚ä¸­ã€‚é•¿çš„å˜é‡åè¾“å…¥èµ·æ¥å¾ˆéº»çƒ¦ï¼ŒçŸ­çš„å˜é‡ååˆ™å¯èƒ½è®©äººäº§ç”Ÿå›°æƒ‘ã€‚å› ä¸ºä»£ç è¢«é˜…è¯»çš„æ¬¡æ•°æ¯”è¢«ç¼–å†™çš„æ¬¡æ•°è¦å¤šï¼Œæ‰€ä»¥ç›¸æ¯”ä¹‹ä¸‹ï¼Œå®æ„¿åç§°åé•¿ä¹Ÿä¸è¦åçŸ­ã€‚ä¸‹é¢å°†åˆ—ä¸¾ä¸€äº›åç§°å¤ªçŸ­æˆ–è€…å¤ªé•¿çš„ä¾‹å­ã€‚</p><h3 id="4-3-1-å¤ªçŸ­çš„åç§°"><a href="#4-3-1-å¤ªçŸ­çš„åç§°" class="headerlink" title="4.3.1ã€€å¤ªçŸ­çš„åç§°"></a>4.3.1ã€€å¤ªçŸ­çš„åç§°</h3><p>æœ€å¸¸è§çš„å‘½åé”™è¯¯æ˜¯é€‰æ‹©å¤ªçŸ­çš„åç§°ã€‚åœ¨åˆšèµ·åçš„æ—¶å€™ï¼Œä½ è¿˜èƒ½è®°å¾—ä½çŸ­åç§°çš„å«ä¹‰ï¼Œå‡ å¤©æˆ–è€…å‡ å‘¨åå¯èƒ½å°±è®°ä¸èµ·æ¥äº†ã€‚çŸ­åç§°æœ‰ä»¥ä¸‹å‡ ç§å¸¸è§ç±»å‹ã€‚</p><ul><li>åç§°ä¸ºä¸€ä¸ªæˆ–ä¸¤ä¸ªå­—æ¯ï¼Œåƒæ˜¯<code>g</code>ï¼Œæœ¬æ„æ˜¯ç”¨æ¥æŒ‡ä»£ä»¥<code>g</code>å¼€å¤´çš„æŸä¸ªå•è¯ï¼Œä½†è¿™æ ·çš„å•è¯å¤ªå¤šäº†ã€‚åªæœ‰ä¸€ä¸¤ä¸ªå­—æ¯çš„é¦–å­—æ¯ç•¥ç¼©è¯å¯¹å†™ä»£ç çš„äººè€Œè¨€å¾ˆçœäº‹ï¼Œä½†å¯¹åˆ«äººè€Œè¨€å¾ˆéš¾è¯»æ‡‚ã€‚</li><li>ç¼©å†™åç§°æ¯”å¦‚<code>mon</code>ï¼Œå¯ä»¥ç”¨æ¥ä»£è¡¨ç›‘è§†å™¨ã€æœˆä»½ã€æ€ªç‰©ç­‰å•è¯ã€‚</li><li>å•ä¸ªè¯è¯­åƒæ˜¯<code>start</code>ï¼Œæ„æ€æ¯”è¾ƒæ¨¡ç³Šâ€”â€”æ˜¯ä»€ä¹ˆçš„å¼€å§‹ï¼Ÿæ­¤ç±»åç§°å¯èƒ½æ˜¯å…¶ä»–äººåœ¨é˜…è¯»æ—¶æ²¡æœ‰æ³¨æ„åˆ°çš„ä¸ä¸Šä¸‹æ–‡ç›¸å…³çš„éšå«æ„æ€ã€‚</li></ul><p>ã€€ã€€ä¸€ä¸ªæˆ–ä¸¤ä¸ªå­—æ¯ã€ç¼©å†™ã€å•ä¸ªè¯è¯­å¯¹ä½ è€Œè¨€å¯èƒ½å¥½ç†è§£ï¼Œä½†è¯·å§‹ç»ˆç‰¢è®°ï¼Œå…¶ä»–ç¨‹åºå‘˜ï¼ˆç”šè‡³æ˜¯å‡ å‘¨åçš„è‡ªå·±ï¼‰å¾ˆéš¾ç†è§£å®ƒä»¬çš„å«ä¹‰ã€‚</p><p>ã€€ã€€æœ‰äº›ä¾‹å¤–æƒ…å†µå¯ä»¥é‡‡ç”¨ç®€çŸ­çš„å˜é‡åã€‚ä¾‹å¦‚ä½¿ç”¨<code>for</code>å¾ªç¯éå†æ•°å­—èŒƒå›´æˆ–è¡¨ç¤ºåˆ—è¡¨çš„ç´¢å¼•æ—¶ï¼Œé€šå¸¸ä¼šä½¿ç”¨<code>i</code>ï¼ˆindexçš„ç¼©å†™ï¼ŒæŒ‡ä»£ç´¢å¼•ï¼‰ä½œä¸ºå˜é‡åã€‚å¦‚æœå‡ºç°åµŒå¥—å¾ªç¯ï¼Œä¼šä¾æ­¤ä½¿ç”¨<code>j</code>ã€<code>k</code>ï¼ˆå› ä¸ºåœ¨å­—æ¯åºåˆ—ä¸­ï¼Œjå’Œkæ’åœ¨iä¹‹åï¼‰ï¼š</p><p><strong>DNâ€™T DRP LTTRS FRM YR SRC CD</strong></p><p>Donâ€™t drop letters from your source codeï¼ˆä¸è¦ä»æºä»£ç ä¸­åˆ å‡æŸäº›å­—æ¯ï¼‰ã€‚å°½ç®¡åƒæ˜¯<code>memcpy</code>ï¼ˆmemory copyï¼‰å’Œ<code>strcmp</code>ï¼ˆstring compareï¼‰è¿™ç§åˆ å‡å­—æ¯çš„å†™æ³•åœ¨20ä¸–çºª90å¹´ä»£å‰çš„Cè¯­è¨€ä¸­å¾ˆæµè¡Œï¼Œä½†å¦‚ä»Šå®ƒä»¬è¢«è§†ä¸ºä¸å¯è¯»çš„å‘½åé£æ ¼ï¼Œä¸è¯¥å†è¢«ä½¿ç”¨ã€‚è¿™ç±»ä¸å®¹æ˜“å‘éŸ³çš„åç§°å¾ˆéš¾è¢«ç†è§£ã€‚</p><p>ã€€ã€€æ­¤å¤–ï¼Œå¯ä»¥å¤§èƒ†ä½¿ç”¨é€šä¿—æ˜“æ‡‚çš„è‹±è¯­çŸ­è¯­ä½œä¸ºä»£ç æ–‡å­—ï¼Œæ¯”å¦‚<code>number_of_trials</code>å°±æ¯”ä»…ä»…å†™æˆ<code>number_trials</code>æ›´å…·å¯è¯»æ€§ã€‚</p><h3 id="4-3-2-å¤ªé•¿çš„åç§°"><a href="#4-3-2-å¤ªé•¿çš„åç§°" class="headerlink" title="4.3.2ã€€å¤ªé•¿çš„åç§°"></a>4.3.2ã€€å¤ªé•¿çš„åç§°</h3><p>åç§°è¶Šé•¿ï¼Œæè¿°æ€§é€šå¸¸ä¹Ÿè¶Šå¼ºã€‚åƒ<code>payment</code>è¿™æ ·çš„çŸ­åç§°åœ¨å•ä¸€ã€è¾ƒçŸ­çš„å‡½æ•°ä¸­ä½œä¸ºå±€éƒ¨å˜é‡æ˜¯ä¸é”™çš„ã€‚ä½†å¦‚æœæ˜¯ä½œä¸ºä¸€ä¸ªé•¿è¾¾10 000è¡Œçš„ç¨‹åºä¸­çš„å…¨å±€å˜é‡ï¼Œé‚£<code>payment</code>çš„æè¿°æ€§å°±ä¸å¤ªå¤Ÿäº†ï¼Œå› ä¸ºè¿™æ ·ä¸€ä¸ªåºå¤§çš„ç¨‹åºå¯èƒ½ä¼šå¤„ç†å¤šç§æ”¯ä»˜æ•°æ®ã€‚ä¸€ä¸ªæ›´å…·æè¿°æ€§çš„åç§°ï¼Œæ¯”å¦‚<code>salesClientMonthlyPayment</code>æˆ–<code>annual_electric_bill_payment</code>å¯èƒ½æ›´åˆé€‚ã€‚åç§°ä¸­çš„é™„åŠ è¯æä¾›äº†æ›´å¤šçš„è¯­å¢ƒä¿¡æ¯ï¼Œå¯ä»¥é¿å…æ­§ä¹‰ã€‚è¿‡åº¦æè¿°æ€»æ¯”ä¸æè¿°è¦å¥½ã€‚è¿™é‡Œæä¾›äº†ä¸€äº›ç”¨äºåˆ¤æ–­åç§°æ˜¯å¦è¿‡é•¿çš„å‡†åˆ™ã€‚</p><ol><li><p><strong>åç§°ä¸­çš„å‰ç¼€</strong></p><p>åœ¨åç§°ä¸­ä½¿ç”¨å¸¸è§çš„å‰ç¼€å¯èƒ½ä¼šæä¾›ä¸å¿…è¦å‘ˆç°çš„ç»†èŠ‚ä¿¡æ¯ã€‚å¯¹äºç±»çš„ç‰¹æ€§åç§°è€Œè¨€ï¼Œå‰ç¼€å¯èƒ½ä¼šæä¾›ä¸éœ€è¦åœ¨å˜é‡åä¸­å‡ºç°çš„ä¿¡æ¯ã€‚æ¯”å¦‚ä¸€ä¸ªåŒ…å«é‡é‡ç‰¹æ€§çš„çŒ«çš„ç±»ï¼Œæ˜¾ç„¶é‡é‡æŒ‡çš„å°±æ˜¯çŒ«çš„ä½“é‡ã€‚å› æ­¤<code>catWeight</code>è¿™ä¸ªåç§°å°±æ˜¾å¾—æè¿°æ€§è¿‡å¼ºï¼Œä¸”è¿‡é•¿ã€‚</p><p>åŒæ ·ï¼Œä¸€ä¸ªè¿‡æ—¶çš„åšæ³•æ˜¯ä½¿ç”¨åŒˆç‰™åˆ©å‘½åæ³•ï¼Œä¹Ÿå°±æ˜¯åœ¨åç§°ä¸­åŒ…å«æ•°æ®ç±»å‹ç¼©å†™çš„åšæ³•ã€‚ä¾‹å¦‚<code>strName</code>è¿™ä¸ªåç§°è¡¨æ˜å˜é‡ç±»å‹æ˜¯å­—ç¬¦ä¸²ï¼Œè€Œ<code>iVacationDays</code>è¡¨æ˜å˜é‡ç±»å‹æ˜¯æ•´æ•°ã€‚ç°ä»£ç¼–ç¨‹è¯­è¨€å’ŒIDEå¯ä»¥å‘ç¨‹åºå‘˜ä¼ è¾¾æ•°æ®ç±»å‹ä¿¡æ¯ï¼Œä¸å†éœ€è¦è¿™äº›å‰ç¼€ï¼Œè¿™ä½¿å¾—åŒˆç‰™åˆ©å‘½åæ³•å¦‚ä»Šå·²ç»æ²¡æœ‰ä½¿ç”¨çš„å¿…è¦æ€§ã€‚æ‰€ä»¥ï¼Œå¦‚æœåç§°ä¸­æœ‰æ•°æ®ç±»å‹å‰ç¼€ï¼Œè¿˜è¯·åˆ é™¤ã€‚</p><p>å¯¹äºåŒ…å«å¸ƒå°”å€¼çš„å˜é‡æˆ–è€…è¿”å›å¸ƒå°”å€¼çš„å‡½æ•°å’Œæ–¹æ³•ï¼Œ<code>is</code>å’Œ<code>has</code>å‰ç¼€èƒ½å¤Ÿå¢å¼ºåç§°çš„å¯è¯»æ€§ã€‚æ€è€ƒä»¥ä¸‹ä½¿ç”¨åä¸º<code>is_vehicle</code>çš„å˜é‡å’Œåä¸º<code>has_key()</code>çš„æ–¹æ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">if item_under_repair.has_key(&#x27;tires&#x27;):<br>  is_vehicle = True<br><br></code></pre></td></tr></table></figure><p><code>has_key()</code>æ–¹æ³•å’Œ<code>is_vehicle</code>å˜é‡å¯ä»¥å¸®åŠ©è¯»è€…å¯¹ä»£ç è¿›è¡Œé€šä¿—çš„è‹±æ–‡è§£è¯»ï¼šâ€œå¦‚æœè¢«ä¿®ç†çš„ç‰©å“æœ‰ä¸€ä¸ªåä¸ºè½®èƒçš„å±æ€§ï¼Œé‚£ä¹ˆè¯¥ç‰©å“å°±æ˜¯ä¸€è¾†è½¦ã€‚â€</p><p>åŒæ ·ï¼Œåœ¨åç§°ä¸­åŠ å…¥è®¡é‡å•ä½å¯ä»¥æä¾›æœ‰ç”¨çš„ä¿¡æ¯ã€‚ä¸€ä¸ªå­˜å‚¨æµ®ç‚¹æ•°çš„é‡é‡å˜é‡ä¼šå­˜åœ¨æ­§ä¹‰ï¼šé‡é‡çš„å•ä½æ˜¯ç£…ã€å…¬æ–¤ï¼Œè¿˜æ˜¯å¨ï¼Ÿè®¡é‡å•ä½ä¿¡æ¯ä¸æ˜¯ä¸Šæ–‡æ‰€è¯´çš„æ•°æ®ç±»å‹ï¼Œæ‰€ä»¥åŒ…å«<code>kg</code>ã€<code>lbs</code>ã€<code>tons</code>çš„å‰ç¼€æˆ–è€…åç¼€å¹¶ä¸åŒäºåŒˆç‰™åˆ©å‘½åæ³•ã€‚å¦‚æœæ²¡æœ‰ä½¿ç”¨åŒ…å«å•ä½ä¿¡æ¯çš„ç‰¹å®šé‡é‡çš„æ•°æ®ç±»å‹ï¼Œå¯å°†å˜é‡å‘½åä¸º<code>weight_kg</code>ä¹‹ç±»çš„åç§°ï¼Œè¿™æ ·åšå¯èƒ½æ›´æ…é‡ä¸€äº›ã€‚äº‹å®ä¸Šï¼Œç”±äº1999å¹´æ´›å…‹å¸Œå¾·Â·é©¬ä¸å…¬å¸æä¾›çš„è½¯ä»¶ä½¿ç”¨äº†è‹±åˆ¶æ ‡å‡†å•ä½çš„è®¡ç®—ç»“æœï¼Œè€ŒNASAç³»ç»Ÿä½¿ç”¨çš„æ˜¯å…¬åˆ¶è®¡é‡å•ä½ï¼Œå› æ­¤æ•°æ®æ¢ç®—é”™è¯¯å¯¼è‡´äº†è½¨é“é”™è¯¯ï¼Œé€ æˆç«æ˜Ÿæ°”å€™è½¨é“é£è¡Œå™¨ä¸¢å¤±ã€‚æ®æŠ¥é“ï¼Œè¯¥èˆªå¤©å™¨çš„é€ ä»·é«˜è¾¾1.25äº¿ç¾å…ƒã€‚</p></li><li><p><strong>åç§°ä¸­çš„è¿ç»­æ•°å­—åç¼€</strong></p><p>åç§°ä¸­çš„è¿ç»­æ•°å­—åç¼€è¡¨æ˜å¯èƒ½éœ€è¦æ”¹å˜å˜é‡çš„æ•°æ®ç±»å‹ï¼Œæˆ–è€…åœ¨åç§°ä¸­æ·»åŠ ä¸åŒçš„ç»†èŠ‚æè¿°ã€‚å•çº¯çš„æ•°å­—å¾€å¾€ä¸èƒ½æä¾›è¶³å¤Ÿçš„ä¿¡æ¯æ¥åŒºåˆ«è¿™äº›åç§°ã€‚</p><p>åƒ<code>payment1</code>ã€<code>payment2</code>ã€<code>payment3</code>è¿™æ ·çš„å˜é‡åç§°å¹¶æ²¡æœ‰å‘Šè¯‰ä½ è¿™äº›å€¼ä¹‹é—´çš„åŒºåˆ«ã€‚ä¹Ÿè®¸è¿™3ä¸ªå˜é‡ååº”è¯¥è¢«é‡æ„ä¸ºä¸€ä¸ªåä¸º<code>payments</code>çš„å˜é‡ï¼ŒåŒ…å«3ä¸ªå€¼çš„åˆ—è¡¨æˆ–è€…å…ƒç»„ã€‚</p><p>åƒ<code>makePayment1(amount)</code>ã€<code>makePayment2(amount)</code>è¿™æ ·çš„å‡½æ•°ä¹Ÿè®¸è¯¥è¢«é‡æ„ä¸ºæ¥å—æ•´æ•°å‚æ•°çš„å•ä¸ªå‡½æ•°ï¼š<code>makePayment(1, amount)</code>ã€<code>makePayment(2, amount)</code>ç­‰ã€‚å¦‚æœè¿™äº›å‡½æ•°çš„è¡Œä¸ºæ˜¯ä¸åŒçš„ï¼Œç¡®å®è¦ä½¿ç”¨ä¸åŒçš„å‡½æ•°ï¼Œåˆ™åº”è¯¥åœ¨åç§°ä¸­è¯´æ˜æ•°å­—èƒŒåçš„æ„ä¹‰ï¼Œä¾‹å¦‚<code>makeLowPriorityPayment(amount)</code>å’Œ<code>makeHighPriorityPayment(amount)</code>ï¼Œæˆ–<code>make1stQuarterPayment(amount)</code>å’Œ<code>make2ndQuarterPayment(amount)</code>ã€‚</p><p>å¦‚æœæœ‰å……åˆ†çš„ç†ç”±é€‰æ‹©å¸¦æœ‰è¿ç»­æ•°å­—åç¼€çš„åç§°ï¼Œä¹Ÿå¹¶éä¸å¯ä»¥ã€‚ä½†æ˜¯ï¼Œå¦‚æœä»…ä»…æ˜¯å› ä¸ºå·æ‡’ï¼Œè¿˜è¯·æ…é‡è€ƒè™‘ã€‚</p></li></ol><h2 id="4-4-èµ·æ˜“äºæœç´¢çš„åç§°"><a href="#4-4-èµ·æ˜“äºæœç´¢çš„åç§°" class="headerlink" title="4.4ã€€èµ·æ˜“äºæœç´¢çš„åç§°"></a>4.4ã€€èµ·æ˜“äºæœç´¢çš„åç§°</h2><p>ã€€ã€€é™¤éæ˜¯éå¸¸å°çš„ç¨‹åºï¼Œå¦åˆ™å¯èƒ½éœ€è¦ä½¿ç”¨ç¼–è¾‘å™¨æˆ–è€…IDEçš„CTRL-FæŸ¥æ‰¾åŠŸèƒ½æ¥å®šä½å˜é‡æˆ–è€…å‡½æ•°è¢«å¼•ç”¨çš„ä½ç½®ã€‚å¦‚æœå˜é‡åè¾ƒçŸ­ä¸”å¸¸è§ï¼Œæ¯”å¦‚<code>num</code>æˆ–<code>a</code>ï¼Œé‚£ä¹ˆä¼šå¾—åˆ°å¾ˆå¤šé”™è¯¯çš„åŒ¹é…ã€‚ä¸ºäº†èƒ½å¿«é€Ÿæœç´¢ï¼Œè¯·ä½¿ç”¨åŒ…å«å…·ä½“ç»†èŠ‚çš„è¾ƒé•¿ä¸”ç‰¹æ®Šçš„åç§°ã€‚</p><p>ã€€ã€€ä¸€äº›IDEå¸¦æœ‰é‡æ„åŠŸèƒ½ï¼Œå¯ä»¥æ ¹æ®ç¨‹åºå¯¹å˜é‡çš„ä½¿ç”¨æ–¹å¼è¯†åˆ«ä¸åŒçš„åç§°ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªå¸¸è§çš„åŠŸèƒ½æ˜¯é‡å‘½åå·¥å…·ï¼Œå®ƒå¯ä»¥åŒºåˆ†åä¸º<code>num</code>å’Œ<code>number</code>çš„å˜é‡ï¼Œä»¥åŠå±€éƒ¨å˜é‡<code>num</code>å’Œå…¨å±€å˜é‡<code>num</code>ã€‚ä½†èµ·åå­—æ—¶ä¸è¦æƒ³ç€ä¾èµ–è¿™äº›å·¥å…·ã€‚</p><p>ã€€ã€€ç‰¢è®°è¿™ä¸€åŸåˆ™å¯ä»¥å¸®åŠ©ä½ æŒ‘é€‰æè¿°æ€§å¼ºçš„åç§°ï¼Œè€Œéå¸¸è§çš„åç§°ã€‚<code>email</code>è¿™ä¸ªåç§°è¿‡äºæ¨¡ç³Šï¼Œæ‰€ä»¥åº”è¯¥è€ƒè™‘æ›´å…·æè¿°æ€§çš„åç§°ï¼Œæ¯”å¦‚<code>emailAddress</code>ã€<code>downloadEmailAttachment</code>ã€<code>emailMessage</code>æˆ–<code>replyToAddress</code>ã€‚è¿™æ ·çš„åç§°ä¸ä»…æ›´å‡†ç¡®ï¼Œè€Œä¸”åœ¨æºä»£ç æ–‡ä»¶ä¸­ä¹Ÿæ›´å®¹æ˜“è¢«æœåˆ°ã€‚</p><h2 id="4-5-é¿å…ç¬‘è¯ã€åŒå…³è¯­å’Œéœ€è¦æ–‡åŒ–èƒŒæ™¯æ‰èƒ½ç†è§£çš„è¯æ±‡"><a href="#4-5-é¿å…ç¬‘è¯ã€åŒå…³è¯­å’Œéœ€è¦æ–‡åŒ–èƒŒæ™¯æ‰èƒ½ç†è§£çš„è¯æ±‡" class="headerlink" title="4.5ã€€é¿å…ç¬‘è¯ã€åŒå…³è¯­å’Œéœ€è¦æ–‡åŒ–èƒŒæ™¯æ‰èƒ½ç†è§£çš„è¯æ±‡"></a>4.5ã€€é¿å…ç¬‘è¯ã€åŒå…³è¯­å’Œéœ€è¦æ–‡åŒ–èƒŒæ™¯æ‰èƒ½ç†è§£çš„è¯æ±‡</h2><h2 id="4-6-ä¸è¦è¦†ç›–å†…ç½®åç§°"><a href="#4-6-ä¸è¦è¦†ç›–å†…ç½®åç§°" class="headerlink" title="4.6ã€€ä¸è¦è¦†ç›–å†…ç½®åç§°"></a>4.6ã€€ä¸è¦è¦†ç›–å†…ç½®åç§°</h2><p>ä¸€äº›å¸¸è¢«è¦†ç›–çš„Pythonåç§°æœ‰ï¼š<code>all</code>ã€<code>any</code>ã€<code>date</code>ã€<code>email</code>ã€<code>file</code>ã€<code>format</code>ã€<code>hash</code>ã€<code>id</code>ã€<code>input</code>ã€<code>list</code>ã€<code>min</code>ã€<code>max</code>ã€<code>object</code>ã€<code>open</code>ã€<code>random</code>ã€<code>set</code>ã€<code>str</code>ã€<code>sum</code>ã€<code>test</code>å’Œ<code>type</code>ã€‚ä¸è¦ä½¿ç”¨è¿™äº›åç§°ä½œä¸ºæ ‡è¯†ç¬¦ã€‚</p><p>ã€€ã€€<code>data</code>æ˜¯ä¸€ä¸ªç³Ÿç³•çš„å˜é‡åï¼Œå› ä¸ºæ‰€æœ‰å˜é‡éƒ½åŒ…å«æ•°æ®ã€‚ç»™å˜é‡å‘½åä¸º<code>var</code>ä¹Ÿæ˜¯ä¸€æ ·ï¼Œè¿™å¥½æ¯”ä½ ç»™å® ç‰©ç‹—èµ·åå«â€œç‹—â€ã€‚<code>temp</code>è¿™ä¸ªåç§°å¯¹äºä¸´æ—¶æŒæœ‰æ•°æ®çš„å˜é‡è€Œè¨€å¾ˆå¸¸è§ï¼Œä½†è¿™ä¹Ÿéè‰¯é€‰ã€‚æ¯•ç«Ÿä»æŸç§è§’åº¦æ¥çœ‹ï¼Œæ‰€æœ‰çš„å˜é‡éƒ½æ˜¯ä¸´æ—¶çš„ã€‚é—æ†¾çš„æ˜¯ï¼Œå°½ç®¡è¿™äº›å‘½åå«ç³Šä¸æ¸…ï¼Œä½†è¿˜æ˜¯ç»å¸¸å‡ºç°ã€‚è¯·ä¸è¦åœ¨ä»£ç ä¸­ä½¿ç”¨å®ƒä»¬äº†ã€‚</p><p>ã€€ã€€å½“éœ€è¦ä¸€ä¸ªå˜é‡æ¥ä¿å­˜æ¸©åº¦æ•°æ®çš„ç»Ÿè®¡æ–¹å·®æ—¶ï¼Œè¯·ä½¿ç”¨<code>temperatureVariance</code>è¿™ä¸ªåç§°ã€‚æ¯«æ— ç–‘é—®ï¼Œ<code>tempVarData</code>ä¸æ˜¯ä¸€ä¸ªå¥½é€‰æ‹©ã€‚</p><h2 id="4-8-å°ç»“"><a href="#4-8-å°ç»“" class="headerlink" title="4.8ã€€å°ç»“"></a>4.8ã€€å°ç»“</h2><p>ã€€ã€€å‘½åä¸ç®—æ³•æˆ–è€…è®¡ç®—æœºç§‘å­¦æ— å…³ï¼Œä½†å®ƒæ˜¯èƒ½å¦ç¼–å†™å¯è¯»ä»£ç çš„ä¸€ä¸ªé‡è¦å› ç´ ã€‚ä»£ç ä¸­ä½¿ç”¨ä»€ä¹ˆåç§°çš„æœ€ç»ˆå†³å®šæƒåœ¨ä½ æ‰‹é‡Œï¼Œä½†è¦æ³¨æ„ç°æœ‰çš„ä¸€äº›å‡†åˆ™ã€‚PEP 8æ–‡æ¡£æ¨èäº†å‡ ä¸ªå‘½åè§„åˆ™ï¼Œæ¯”å¦‚æ¨¡å—çš„åç§°ç”¨å°å†™ï¼Œç±»çš„åç§°ç”¨Pascalå‘½åæ³•ã€‚åç§°é•¿åº¦åº”è¯¥é€‚ä¸­ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå®æ„¿æä¾›è¿‡å¤šæè¿°æ€§ä¿¡æ¯ï¼Œä¹Ÿä¸è¦ä¿¡æ¯è¿‡å°‘ã€‚</p><p>ã€€ã€€åç§°åº”å½“ç®€æ´ï¼Œä½†è¦å…¼å…·æè¿°æ€§ã€‚èƒ½å¦ä½¿ç”¨CTRL-Fæœç´¢åŠŸèƒ½å¿«é€Ÿæ‰¾åˆ°æŸä¸ªåç§°æ˜¯è¡¡é‡å®ƒæ˜¯å¦å…·å¤‡ç‰¹æ®Šæ€§å’Œæè¿°æ€§çš„æ ‡å¿—ã€‚æƒ³ä¸€æƒ³ä½ èµ·çš„åç§°ä¾¿äºæœç´¢çš„ç¨‹åº¦ï¼Œè¿™å¯ä»¥å¸®åŠ©ä½ åˆ¤æ–­æ˜¯å¦ä½¿ç”¨äº†å¤ªè¿‡å¸¸è§çš„åç§°ã€‚æ­¤å¤–ï¼Œè¿˜è¦è€ƒè™‘è‹±è¯­ä¸æµåˆ©çš„ç¨‹åºå‘˜èƒ½å¦ç†è§£è¿™ä¸ªåç§°ã€‚é¿å…åœ¨åç§°ä¸­ä½¿ç”¨ç¬‘è¯ã€åŒå…³è¯­å’Œéœ€è¦æœ‰æ–‡åŒ–èƒŒæ™¯çŸ¥è¯†æ‰èƒ½ç†è§£çš„è¯æ±‡ï¼Œè€Œæ˜¯è¦é€‰æ‹©ç¤¼è²Œã€ç›´æ¥ã€ä¸ææ€ªçš„åç§°ã€‚</p><p>ã€€ã€€å°½ç®¡æœ¬ç« çš„è®¸å¤šå»ºè®®åªæ˜¯æ¨èåšæ³•ï¼Œä½†åº”è¯¥é¿å…ä½¿ç”¨Pythonæ ‡å‡†åº“å·²ç»ä½¿ç”¨è¿‡çš„åç§°ï¼Œæ¯”å¦‚<code>all</code>ã€<code>any</code>ã€<code>date</code>ã€<code>email</code>ã€<code>file</code>ã€<code>format</code>ã€<code>hash</code>ã€<code>id</code>ã€<code>input</code>ã€<code>list</code>ã€<code>min</code>ã€<code>max</code>ã€<code>object</code>ã€<code>open</code>ã€<code>random</code>ã€<code>set</code>ã€<code>str</code>ã€<code>sum</code>ã€<code>test</code>å’Œ<code>type</code>ã€‚ä½¿ç”¨è¿™äº›åç§°å¯èƒ½å¯¼è‡´ä»£ç ä¸­å‡ºç°éš¾ä»¥å®šä½çš„é”™è¯¯ã€‚</p><p>ã€€ã€€è®¡ç®—æœºå¹¶ä¸åœ¨ä¹åç§°æ˜¯è¨€ç®€æ„èµ…è¿˜æ˜¯è¯­ç„‰ä¸è¯¦ã€‚åç§°çš„ä½œç”¨æ˜¯è®©äººæ›´å®¹æ˜“é˜…è¯»ï¼Œè€Œä¸æ˜¯è®©è®¡ç®—æœºæ›´å®¹æ˜“è¿è¡Œã€‚å¦‚æœä»£ç çš„å¯è¯»æ€§å¾ˆå¼ºï¼Œå°±å¾ˆå®¹æ˜“è¢«ç†è§£ï¼›å¦‚æœå®¹æ˜“è¢«ç†è§£ï¼Œé‚£å°±å®¹æ˜“è¿›è¡Œä¿®æ”¹ï¼›å¦‚æœå®¹æ˜“ä¿®æ”¹ï¼Œé‚£å°±æ„å‘³ç€å®¹æ˜“ä¿®å¤é”™è¯¯æˆ–è€…å¢åŠ æ–°åŠŸèƒ½ã€‚æ‰€ä»¥ï¼Œä½¿ç”¨å¯ç†è§£çš„åç§°æ˜¯ç”Ÿäº§é«˜è´¨é‡è½¯ä»¶çš„å‰æã€‚</p><h1 id="ç¬¬-5-ç« -æªå‡ºä»£ç çš„åå‘³é“"><a href="#ç¬¬-5-ç« -æªå‡ºä»£ç çš„åå‘³é“" class="headerlink" title="ç¬¬ 5 ç« ã€€æªå‡ºä»£ç çš„åå‘³é“"></a>ç¬¬ 5 ç« ã€€æªå‡ºä»£ç çš„åå‘³é“</h1><blockquote><p>å¯¼è‡´ç¨‹åºå´©æºƒçš„ä»£ç æ˜¾ç„¶æ˜¯é”™äº†ï¼Œä½†å´©æºƒå¹¶ä¸æ˜¯è¡¡é‡ç¨‹åºé—®é¢˜çš„å”¯ä¸€æŒ‡æ ‡ã€‚å…¶ä»–è¿¹è±¡ä¹Ÿä¼šè¡¨æ˜ç¨‹åºä¸­å­˜åœ¨ç€éš¾ä»¥å¯Ÿè§‰çš„æ¼æ´æˆ–è€…ä¸å¯è¯»çš„ä»£ç ã€‚å°±åƒå—…åˆ°çš„ä¸€è‚¡æ€ªå‘³å„¿å‘Šè¯‰ä½ ç…¤æ°”å¯èƒ½æ­£åœ¨æ³„æ¼ï¼Œé—»åˆ°çš„çƒŸå‘³å„¿æç¤ºä½ å“ªé‡Œç€ç«äº†ä¸€æ ·ï¼Œä»£ç çš„åå‘³é“æŒ‡çš„æ˜¯ä¸€ç§æ­ç¤ºæ½œåœ¨é—®é¢˜çš„ä»£ç æ¨¡å¼ã€‚è¿™ç§åå‘³é“å¹¶ä¸æ„å‘³ç€ä¸€å®šå­˜åœ¨é—®é¢˜ï¼Œä½†å®ƒè¯´æ˜è¯¥æ˜¯æ£€æŸ¥ç¨‹åºçš„æ—¶å€™äº†ã€‚</p></blockquote><p>ã€€ã€€æœ¬ç« åˆ—ä¸¾äº†å‡ ç§å¸¸è§çš„ä»£ç åå‘³é“ã€‚é¢„é˜²é”™è¯¯èŠ±è´¹çš„æ—¶é—´å’Œç²¾åŠ›è¦æ¯”é‡åˆ°é”™è¯¯ã€ç†è§£é”™è¯¯ç„¶åä¿®å¤é”™è¯¯å°‘å¾—å¤šã€‚æ¯ä¸ªç¨‹åºå‘˜éƒ½æ›¾ç¢°ä¸Šè¿‡è¿™æ ·çš„äº‹æƒ…ï¼šèŠ±äº†å‡ å°æ—¶è°ƒè¯•æ¥è°ƒè¯•å»ï¼Œæœ€ç»ˆå‘ç°åªéœ€è¦ä¿®æ”¹ä¸€è¡Œä»£ç å°±å¯ä»¥ä¿®å¤ã€‚å‡ºäºè¿™ä¸ªåŸå› ï¼Œå³ä½¿é‡åˆ°ä¸€ç‚¹å„¿æ½œåœ¨çš„é”™è¯¯ï¼Œä½ ä¹Ÿåº”è¯¥åœä¸‹æ¥ï¼Œä»”ç»†æ£€æŸ¥æ˜¯å¦åœ¨ä¸ºæœªæ¥çš„å·¥ä½œâ€œæŒ–å‘â€ã€‚</p><p>ã€€ã€€å½“ç„¶ï¼Œä»£ç çš„åå‘³é“ä¸ä¸€å®šéƒ½æ˜¯é—®é¢˜ã€‚ç©¶ç«Ÿæ˜¯å¤„ç†è¿˜æ˜¯å¿½ç•¥è¦ä¾é ä½ è‡ªå·±çš„åˆ¤æ–­ã€‚</p><h2 id="5-1-é‡å¤çš„ä»£ç "><a href="#5-1-é‡å¤çš„ä»£ç " class="headerlink" title="5.1ã€€é‡å¤çš„ä»£ç "></a>5.1ã€€é‡å¤çš„ä»£ç </h2><p>ã€€æœ€å¸¸è§çš„ä»£ç åå‘³é“æ˜¯é‡å¤çš„ä»£ç ã€‚é‡å¤çš„ä»£ç æ˜¯æŒ‡é€šè¿‡åœ¨ç¨‹åºä¸­å¤åˆ¶ç²˜è´´äº§ç”Ÿçš„æºä»£ç ã€‚ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªç®€çŸ­çš„ç¨‹åºä¸­å°±åŒ…å«äº†é‡å¤çš„ä»£ç ï¼Œå®ƒè¯¢é—®äº†3æ¬¡ç”¨æˆ·çš„æ„Ÿè§‰å¦‚ä½•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">print(&#x27;Good morning!&#x27;)<br>print(&#x27;How are you feeling?&#x27;)<br>feeling = input()<br>print(&#x27;I am happy to hear that you are feeling &#x27; + feeling + &#x27;.&#x27;)<br>print(&#x27;Good afternoon!&#x27;)<br>print(&#x27;How are you feeling?&#x27;)<br>feeling = input()<br>print(&#x27;I am happy to hear that you are feeling &#x27; + feeling + &#x27;.&#x27;)<br>print(&#x27;Good evening!&#x27;)<br>print(&#x27;How are you feeling?&#x27;)<br>feeling = input()<br>print(&#x27;I am happy to hear that you are feeling &#x27; + feeling + &#x27;.&#x27;)<br></code></pre></td></tr></table></figure><p>è§£å†³é‡å¤ä»£ç çš„æ–¹æ³•æ˜¯å»é‡ï¼Œç®€å•åœ°è¯´ï¼Œé€šè¿‡æŠŠä»£ç æ”¾åœ¨ä¸€ä¸ªå‡½æ•°æˆ–è€…å¾ªç¯ä¸­ï¼Œä½¿å…¶åœ¨ä»£ç ä¸­åªå‡ºç°ä¸€æ¬¡ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œé‡å¤ä»£ç è¢«ç§»åŠ¨åˆ°ä¸€ä¸ªå‡½æ•°ä¸­ï¼Œé€šè¿‡åå¤è°ƒç”¨å‡½æ•°ä»¥è¾¾åˆ°åŒæ ·çš„æ•ˆæœï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell">def askFeeling():<br>    print(&#x27;How are you feeling?&#x27;)<br>    feeling = input()<br>    print(&#x27;I am happy to hear that you are feeling &#x27; + feeling + &#x27;.&#x27;)<br><br>print(&#x27;Good morning!&#x27;)<br>askFeeling()<br>print(&#x27;Good afternoon!&#x27;)<br>askFeeling()<br>print(&#x27;Good evening!&#x27;)<br>askFeeling()<br></code></pre></td></tr></table></figure><h2 id="5-2-é­”æ•°"><a href="#5-2-é­”æ•°" class="headerlink" title="5.2ã€€é­”æ•°"></a>5.2ã€€é­”æ•°</h2><p>ç¨‹åºåŒ…å«æ•°å­—å¾ˆæ­£å¸¸ï¼Œä½†ä»£ç ä¸­å‡ºç°çš„ä¸€äº›æ•°å­—å¯èƒ½ä¼šè®©å…¶ä»–ç¨‹åºå‘˜ï¼ˆæˆ–è€…å‡ å‘¨å‰å†™ä¸‹è¿™ä¸²æ•°å­—çš„ä½ ï¼‰æ„Ÿåˆ°å›°æƒ‘ã€‚ä¾‹å¦‚æ¥ä¸‹æ¥è¿™è¡Œä»£ç ä¸­çš„æ•°å­—604800ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">expiration = time.time() + <span class="hljs-number">604800</span><br></code></pre></td></tr></table></figure><p><code>time.time()</code>å‡½æ•°è¿”å›ä¸€ä¸ªä»£è¡¨å½“å‰æ—¶é—´çš„æ•´æ•°ã€‚çŒœå¾—å‡ºæ¥ï¼Œ<code>expiration</code>å˜é‡ä»£è¡¨çš„æ˜¯æœªæ¥çš„æŸä¸ªæ—¶é—´ç‚¹ã€‚ä½†<code>604800</code>ç›¸å½“ç¥ç§˜ï¼šè¿™ä¸ªè¿‡æœŸæ—¥æœŸçš„æ„ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿå¯ä»¥æ·»åŠ ä¸€è¡Œæ³¨é‡Šè¿›è¡Œè§£é‡Šï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">expiration = time.time() + <span class="hljs-number">604800</span> <span class="hljs-comment"># ä¸€å‘¨åè¿‡æœŸ</span><br></code></pre></td></tr></table></figure><p>è¿™ä¸ªå†™æ³•æ˜¯å¯è¡Œçš„ï¼Œä½†æ›´å¥½çš„åšæ³•æ˜¯ä½¿ç”¨å¸¸é‡ä»£æ›¿è¿™äº›â€œç¥å¥‡â€çš„æ•°å­—ã€‚å¸¸é‡æ˜¯ä¸€ç±»ç”¨å¤§å†™å­—æ¯ä¹¦å†™çš„é‡ï¼Œå…¶æ•°å€¼åœ¨åˆå§‹èµ‹å€¼åä¸åº”è¯¥æ”¹å˜ã€‚é€šå¸¸ï¼Œåœ¨æºä»£ç æ–‡ä»¶çš„é¡¶éƒ¨æ¥å®šä¹‰ä½œä¸ºå…¨å±€å˜é‡çš„å¸¸é‡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># è®¾ç½®ä¸åŒæ—¶é—´é‡çš„å¸¸é‡ï¼š</span><br>SECONDS_PER_MINUTE = <span class="hljs-number">60</span><br>SECONDS_PER_HOUR   = <span class="hljs-number">60</span> * SECONDS_PER_MINUTE<br>SECONDS_PER_DAY    = <span class="hljs-number">24</span> * SECONDS_PER_HOUR<br>SECONDS_PER_WEEK   = <span class="hljs-number">7</span>  * SECONDS_PER_DAY<br><br>--snip--<br><br>expiration = time.time() + SECONDS_PER_WEEK <span class="hljs-comment"># ä¸€å‘¨åè¿‡æœŸ</span><br></code></pre></td></tr></table></figure><p>å³ä½¿æ•°å€¼ç›¸åŒï¼Œä¹Ÿåº”è¯¥ä¸ºæœ‰ç€ä¸åŒç›®çš„çš„é­”æ•°é‡‡ç”¨ä¸åŒçš„å¸¸é‡ã€‚æ¯”å¦‚ä¸€å‰¯æ‰‘å…‹ç‰Œæœ‰52å¼ ï¼Œä¸€å¹´ä¹Ÿæœ‰52å‘¨ã€‚ä½†å¦‚æœç¨‹åºä¸­åŒæ—¶å­˜åœ¨è¿™ä¸¤ç§é‡ï¼Œé‚£ä¹ˆæ­£ç¡®çš„åšæ³•åº”è¯¥æ˜¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">NUM_CARDS_IN_DECK = <span class="hljs-number">52</span><br>NUM_WEEKS_IN_YEAR = <span class="hljs-number">52</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;This deck contains&#x27;</span>, NUM_CARDS_IN_DECK, <span class="hljs-string">&#x27;cards.&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;The 2-year contract lasts for&#x27;</span>, <span class="hljs-number">2</span> * NUM_WEEKS_IN_YEAR, <span class="hljs-string">&#x27;weeks.&#x27;</span>)<br></code></pre></td></tr></table></figure><p>è¿™æ®µä»£ç è¿è¡Œåçš„è¾“å‡ºæ˜¯ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">This deck contains <span class="hljs-number">52</span> cards.<br>The <span class="hljs-number">2</span>-year contract lasts <span class="hljs-keyword">for</span> <span class="hljs-number">104</span> weeks.<br></code></pre></td></tr></table></figure><p>ã€€ã€€ä½¿ç”¨ä¸åŒçš„å¸¸é‡æœ‰åˆ©äºå°†æ¥å¯¹å®ƒä»¬è¿›è¡Œç‹¬ç«‹çš„ä¿®æ”¹ã€‚æ³¨æ„ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶ä¸åº”è¯¥æ”¹å˜å¸¸é‡çš„æ•°å€¼ï¼Œä½†è¿™ä¸æ„å‘³ç€ç¨‹åºå‘˜ä¸èƒ½åœ¨ä»£ç ä¸­å¯¹å¸¸é‡è¿›è¡Œæ›´æ–°ã€‚æ¯”å¦‚ï¼Œå½“ä»£ç çš„æœªæ¥æŸä¸ªç‰ˆæœ¬ä¸­åªæœ‰ä¸€å¼ å°ä¸‘ç‰Œ<strong>1</strong>æ—¶ï¼Œåªéœ€è¦æ”¹å˜æ‰‘å…‹ç‰Œæ•°é‡çš„å¸¸é‡ï¼Œè€Œä¸å½±å“å‘¨æ•°é‡çš„å¸¸é‡ï¼š</p><p><strong>1</strong>ä¹Ÿå«ä½œå°ç‹ç‰Œã€‚â€”â€”è¯‘è€…æ³¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">NUM_CARDS_IN_DECK = <span class="hljs-number">53</span><br>NUM_WEEKS_IN_YEAR = <span class="hljs-number">52</span><br></code></pre></td></tr></table></figure><p>ã€€ã€€<strong>é­”æ•°</strong>è¿™ä¸ªæœ¯è¯­ä¹Ÿå¯ä»¥ç”¨æ¥æŒ‡ä»£éæ•°å­—å€¼ï¼Œæ¯”å¦‚ï¼Œä½ ä¹Ÿè®¸ä½¿ç”¨å­—ç¬¦ä¸²ç±»å‹çš„å€¼ä½œä¸ºå¸¸é‡ã€‚ä¸‹é¢è¿™ä¸ªç¨‹åºè¦æ±‚ç”¨æˆ·è¾“å…¥ä¸€ä¸ªæ–¹å‘ï¼Œå¦‚æœæ–¹å‘æ˜¯â€œnorthâ€åˆ™æ˜¾ç¤ºä¸€ä¸ªè­¦å‘Šã€‚â€œnorthâ€è¢«é”™è¯¯æ‹¼å†™æˆâ€œnrthâ€å¯¼è‡´äº†ä¸€ä¸ªbugï¼Œä½¿ç¨‹åºæ— æ³•æ˜¾ç¤ºè­¦å‘Šï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Set solar panel direction:&#x27;</span>)<br>    direction = <span class="hljs-built_in">input</span>().lower()<br>    <span class="hljs-keyword">if</span> direction <span class="hljs-keyword">in</span> (<span class="hljs-string">&#x27;north&#x27;</span>, <span class="hljs-string">&#x27;south&#x27;</span>, <span class="hljs-string">&#x27;east&#x27;</span>, <span class="hljs-string">&#x27;west&#x27;</span>):<br>        <span class="hljs-keyword">break</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Solar panel heading set to:&#x27;</span>, direction)<br><span class="hljs-keyword">if</span> direction == <span class="hljs-string">&#x27;nrth&#x27;</span>: â¶<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Warning: Facing north is inefficient for this panel.&#x27;</span>)<br></code></pre></td></tr></table></figure><p>ã€€ã€€è¿™ä¸ªbugå¯èƒ½å¾ˆéš¾è¢«å‘ç°ï¼šé”™è¯¯çš„æ‹¼å†™â€œnrthâ€â¶åœ¨Pythonè¯­æ³•ä¸­ä»ç„¶æ˜¯ä¸€ä¸ªæ­£ç¡®çš„å­—ç¬¦ä¸²ï¼Œç¨‹åºä¸ä¼šå´©æºƒï¼Œä¹Ÿæ²¡æœ‰è­¦ç¤ºä¿¡æ¯ï¼Œè®©äººéš¾ä»¥å¯Ÿè§‰ã€‚ä½†å¦‚æœæˆ‘ä»¬ä½¿ç”¨å¸¸é‡ï¼Œé”™è¯¯æ‹¼å†™å°±ä¼šå¯¼è‡´ç¨‹åºå´©æºƒï¼Œå› ä¸ºPythonä¼šæ³¨æ„åˆ°<code>NRTH</code>å¸¸é‡å¹¶ä¸å­˜åœ¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ä¸ºæ¯ä¸ªåŸºæœ¬æ–¹å‘è®¾ç½®å¸¸é‡ï¼š</span><br>NORTH = <span class="hljs-string">&#x27;north&#x27;</span><br>SOUTH = <span class="hljs-string">&#x27;south&#x27;</span><br>EAST = <span class="hljs-string">&#x27;east&#x27;</span><br>WEST = <span class="hljs-string">&#x27;west&#x27;</span><br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Set solar panel direction:&#x27;</span>)<br>    direction = <span class="hljs-built_in">input</span>().lower()<br>    <span class="hljs-keyword">if</span> direction <span class="hljs-keyword">in</span> (NORTH, SOUTH, EAST, WEST):<br>        <span class="hljs-keyword">break</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Solar panel heading set to:&#x27;</span>, direction)<br><span class="hljs-keyword">if</span> direction == NRTH: â¶<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Warning: Facing north is inefficient for this panel.&#x27;</span>)<br></code></pre></td></tr></table></figure><p>ã€€ã€€è¿è¡Œä»£ç æ—¶ï¼Œå¸¦æœ‰<code>NRTH</code>é”™è¯¯â¶çš„ä»£ç è¡ŒæŠ›å‡ºäº†<code>NameError</code>ï¼Œé”™è¯¯ä¼šè¢«ç«‹åˆ»å±•ç¤ºå‡ºæ¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-type">Set</span> solar panel direction:<br>west<br>Solar panel heading <span class="hljs-built_in">set</span> to: west<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;panelset.py&quot;</span>, line <span class="hljs-number">14</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>    <span class="hljs-keyword">if</span> direction == NRTH:<br>NameError: name <span class="hljs-string">&#x27;NRTH&#x27;</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> defined<br></code></pre></td></tr></table></figure><p>ã€€ã€€é­”æ•°æ˜¯ä¸€ç§ä»£ç çš„åå‘³é“ï¼Œå› ä¸ºå®ƒä»¬æ²¡æœ‰è¡¨æ˜æ•°å­—çš„ç›®çš„ï¼Œé™ä½äº†ä»£ç çš„å¯è¯»æ€§ï¼Œä½¿å…¶éš¾ä»¥ç»´æŠ¤ï¼Œè€Œä¸”å®¹æ˜“å‡ºç°éš¾ä»¥å¯Ÿè§‰çš„æ‹¼å†™é”™è¯¯ã€‚è§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨å¸¸é‡æ›¿ä»£é­”æ•°ã€‚</p><h2 id="5-3-æ³¨é‡Šæ‰çš„ä»£ç å’Œæ­»ä»£ç "><a href="#5-3-æ³¨é‡Šæ‰çš„ä»£ç å’Œæ­»ä»£ç " class="headerlink" title="5.3ã€€æ³¨é‡Šæ‰çš„ä»£ç å’Œæ­»ä»£ç "></a>5.3ã€€æ³¨é‡Šæ‰çš„ä»£ç å’Œæ­»ä»£ç </h2><p>ç”¨æ³¨é‡Šæ‰ä»£ç çš„æ–¹æ³•ä½¿ä»£ç ä¸èƒ½è¿è¡Œï¼Œè¿™ä½œä¸ºä¸´æ—¶æ‰‹æ®µæ˜¯å¯è¡Œçš„ã€‚ä½ å¯èƒ½æƒ³è·³è¿‡ä¸€äº›ä»£ç è¡Œæ¥æµ‹è¯•å…¶ä»–åŠŸèƒ½ï¼Œè€Œæ³¨é‡Šæ‰ä»£ç çš„å¥½å¤„åœ¨äºä¹‹åå®¹æ˜“æ‰¾åˆ°å¹¶æ¢å¤å®ƒä»¬ã€‚ä½†å¦‚æœæ³¨é‡Šæ‰çš„ä»£ç ä¸€ç›´ä¿ç•™ç€ï¼Œåé¢é˜…è¯»ä»£ç çš„äººå°±ä¼šå›°æƒ‘ä¸ºä»€ä¹ˆè¦åˆ é™¤è¿™æ®µä»£ç ï¼Œä»€ä¹ˆæƒ…å†µä¸‹ä¼šå†ä½¿ç”¨å®ƒã€‚è¯·çœ‹ä¸‹é¢è¿™ä¸ªç¤ºä¾‹ï¼š</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">doSomething</span><span class="hljs-params">()</span></span><br><span class="hljs-selector-id">#doAnotherThing</span>()<br><span class="hljs-function"><span class="hljs-title">doSomeImportantTask</span><span class="hljs-params">()</span></span><br><span class="hljs-function"><span class="hljs-title">doAnotherThing</span><span class="hljs-params">()</span></span><br></code></pre></td></tr></table></figure><p>ã€€ã€€è¿™æ®µä»£ç è®©äººäº§ç”Ÿå¾ˆå¤šç–‘æƒ‘ï¼šä¸ºä»€ä¹ˆ<code>doAnotherThing()</code>è¢«æ³¨é‡Šæ‰äº†ï¼Ÿè¿˜èƒ½å†åŠ å…¥å®ƒå—ï¼Ÿä¸ºä»€ä¹ˆ<code>doAnotherThing()</code>çš„ç¬¬2æ¬¡è°ƒç”¨æ²¡æœ‰è¢«æ³¨é‡Šæ‰ï¼Ÿæ˜¯åŸæœ¬å°±æœ‰ä¸¤æ¬¡<code>doAnotherThing()</code>è°ƒç”¨ï¼Œè¿˜æ˜¯æœ€åˆåªæœ‰ä¸€æ¬¡è°ƒç”¨ï¼Œåæ¥è¢«ç§»åˆ°<code>doSomeImportantTask()</code>ä¹‹åäº†ï¼Ÿä¸åˆ é™¤æ³¨é‡Šæ‰çš„ä»£ç æ˜¯æœ‰ä»€ä¹ˆåŸå› å—ï¼Ÿè¿™äº›ç–‘æƒ‘æ²¡æœ‰å¾—åˆ°è§£ç­”ã€‚</p><p>ã€€ã€€æ­»ä»£ç æ˜¯æŒ‡æ— æ³•åˆ°è¾¾æˆ–è€…é€»è¾‘ä¸Šæ°¸è¿œæ— æ³•è¿è¡Œçš„ä»£ç ã€‚æ¯”å¦‚ï¼Œå‡½æ•°ä¸­è¿”å›è¯­å¥ä¹‹åçš„ä»£ç ï¼Œåœ¨æ¡ä»¶æ°¸è¿œä¸ºå‡çš„<code>if</code>è¯­å¥å—ä¸­çš„ä»£ç ï¼Œæˆ–è€…ä»æœªè¢«è°ƒç”¨çš„å‡½æ•°ä»£ç ã€‚åœ¨äº¤äº’å¼shellä¸­è¾“å…¥ä»¥ä¸‹å†…å®¹çœ‹ä¸€ä¸‹ï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">import</span> random</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">coinFlip</span>():</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">    <span class="hljs-keyword">if</span> random.randint(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>):</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Heads!&#x27;</span></span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">    <span class="hljs-keyword">else</span>:</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Tails!&#x27;</span></span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">    <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;The coin landed on its edge!&#x27;</span></span><br><span class="hljs-meta prompt_">...</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">print</span>(coinFlip())</span><br>Tails!<br></code></pre></td></tr></table></figure><p>ã€€ã€€<code>return &#39;The coin landed on its edge!&#39;</code>è¿™ä¸€è¡Œæ˜¯æ­»ä»£ç ï¼Œå› ä¸ºä»£ç åœ¨<code>if</code>å’Œ<code>else</code>å—ä¸­å°±å·²ç»è¿”å›äº†ã€‚æ­»ä»£ç å…·æœ‰è¯¯å¯¼æ€§ï¼Œç¨‹åºå‘˜åœ¨é˜…è¯»æ—¶ä¼šè®¤ä¸ºå®ƒä»¬æ˜¯ç¨‹åºä¸­çš„æœ‰æ•ˆéƒ¨åˆ†ï¼Œä½†å®é™…ä¸Šå®ƒä»¬å’Œæ³¨é‡Šæ‰çš„ä»£ç æ— å¼‚ã€‚</p><p>ã€€ã€€æ¡©ä»£ç æ˜¯ä¸Šè¿°ä»£ç çš„åå‘³é“è§„åˆ™çš„ä¸€ä¸ªä¾‹å¤–ã€‚å®ƒä»¬æ˜¯ä¸€äº›æœªæ¥å‡ºç°çš„ä»£ç çš„å ä½ç¬¦ï¼Œæ¯”å¦‚å°šæœªå®ç°çš„å‡½æ•°æˆ–è€…ç±»ã€‚ä¸ºäº†ä»£æ›¿çœŸæ­£çš„ä»£ç ï¼Œæ¡©ä»£ç åŒ…å«ä¸€ä¸ª<code>pass</code>è¯­å¥ï¼Œå®ƒä»€ä¹ˆä¹Ÿä¸åšï¼ˆä¹Ÿè¢«ç§°ä¸ºno operationæˆ–è€…no-opï¼‰ã€‚<code>pass</code>è¯­å¥å­˜åœ¨çš„æ„ä¹‰æ˜¯å¯¹åœ¨è¯­æ³•ä¸Šéœ€è¦æœ‰ä»£ç çš„åœ°æ–¹æ‰“æ¡©ï¼š</p><h2 id="5-5-å¸¦æœ‰æ•°å­—åç¼€çš„å˜é‡"><a href="#5-5-å¸¦æœ‰æ•°å­—åç¼€çš„å˜é‡" class="headerlink" title="5.5ã€€å¸¦æœ‰æ•°å­—åç¼€çš„å˜é‡"></a>5.5ã€€å¸¦æœ‰æ•°å­—åç¼€çš„å˜é‡</h2><p>åœ¨ç¼–å†™ç¨‹åºæ—¶ï¼Œå¶å°”éœ€è¦å­˜å‚¨å¤šä¸ªç›¸åŒæ•°æ®ç±»å‹çš„å˜é‡ï¼Œä½ å¯èƒ½æƒ³é€šè¿‡æ·»åŠ æ•°å­—åç¼€æ¥é‡å¤ä½¿ç”¨ä¸€ä¸ªå˜é‡åã€‚æ¯”å¦‚åœ¨å¤„ç†ä¸€ä¸ªè¦æ±‚ç”¨æˆ·è¾“å…¥ä¸¤æ¬¡å¯†ç ä»¥é˜²æ‰“é”™å­—çš„æ³¨å†Œè¡¨å•æ—¶ï¼Œä½ å¯èƒ½ä¼šå°†è¿™äº›å¯†ç å­—ç¬¦ä¸²å­˜å‚¨åœ¨åä¸º<code>password1</code>å’Œ<code>password2</code>çš„å˜é‡ä¸­ã€‚è¿™äº›æ•°å­—åç¼€å¹¶ä¸èƒ½å¾ˆå¥½åœ°æè¿°è¿™äº›å˜é‡æ‰€åŒ…å«çš„å†…å®¹ä»¥åŠå®ƒä»¬ä¹‹é—´çš„å·®å¼‚ã€‚å®ƒä»¬ä¹Ÿæ²¡æœ‰è¯´æ˜è¿™ç±»å˜é‡ç©¶ç«Ÿæœ‰å¤šå°‘ä¸ªï¼Œæ˜¯å¦è¿˜æœ‰<code>password3</code>æˆ–<code>password4</code>ï¼Ÿè¯·å°è¯•åˆ›å»ºç‰¹æ®Šçš„åç§°ï¼Œè€Œä¸æ˜¯ä»…ä»…æ·»åŠ æ•°å­—åç¼€ã€‚å¯¹äºè¿™ä¸¤ä¸ªå¯†ç å‘½åçš„ä¾‹å­è€Œè¨€ï¼Œæ›´å¥½çš„å˜é‡åæ˜¯<code>password</code>å’Œ<code>confirm_password</code>ã€‚</p><p>ã€€ã€€å†æ¥çœ‹å¦å¤–ä¸€ä¸ªä¾‹å­ï¼Œå‡è®¾æœ‰ä¸€ä¸ªå¤„ç†èµ·ç‚¹åæ ‡å’Œç»ˆç‚¹åæ ‡çš„å‡½æ•°ï¼Œå‚æ•°å¯èƒ½ä¼šè¢«å‘½åä¸º<code>x1</code>ã€<code>x2</code>ã€<code>y1</code>å’Œ<code>y2</code>ã€‚ä½†æ•°å­—åç¼€çš„åå­—å¹¶ä¸åƒ<code>start_x</code>ã€<code>start_y</code>ã€<code>end_x</code>ã€<code>end_y</code>è¿™äº›åå­—é‚£æ ·èƒ½ä¼ è¾¾å¾ˆå¤šä¿¡æ¯ã€‚ä¸<code>x1</code>å’Œ<code>y1</code>ç›¸æ¯”ï¼Œ<code>start_x</code>å’Œ<code>start_y</code>è¿™ä¸¤ä¸ªå˜é‡ä¹‹é—´çš„å…³ç³»æ›´æ˜æ˜¾ã€‚å¦‚æœæ•°å­—åç¼€è¶…è¿‡äº†2ï¼Œå¯èƒ½éœ€è¦ä½¿ç”¨åˆ—è¡¨æˆ–è€…setæ•°æ®ç»“æ„å°†æ•°æ®å­˜å‚¨ä¸ºä¸€ä¸ªé›†åˆã€‚æ¯”å¦‚å¯ä»¥å°†<code>pet1Name</code>ã€<code>pet2Name</code>ã€<code>pet3Name</code>çš„å€¼å­˜å‚¨åœ¨ä¸€ä¸ªåä¸º<code>petNames</code>çš„åˆ—è¡¨ä¸­ã€‚</p><p>ã€€ã€€è¿™ç§ä»£ç çš„åå‘³é“å¹¶ä¸èƒ½ç®€å•åœ°å¥—ç”¨åœ¨æ¯ä¸ªä»¥æ•°å­—ç»“å°¾çš„å˜é‡ä¸Šã€‚æ¯”å¦‚åä¸º<code>enableIPv6</code>çš„å˜é‡æ˜¯å®Œå…¨å¯å–çš„ï¼Œå› ä¸º6æ˜¯<code>IPv6</code>æœ¬åçš„ä¸€éƒ¨åˆ†ï¼Œè€Œéä¸€ä¸ªæ•°å­—åç¼€ã€‚ä½†å¦‚æœåœ¨ä¸€ç³»åˆ—çš„å˜é‡ä¸­ä½¿ç”¨æ•°å­—åç¼€ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘ç”¨æŸç§æ•°æ®ç»“æ„ä»£æ›¿å®ƒä»¬ï¼Œæ¯”å¦‚åˆ—è¡¨æˆ–å­—å…¸ã€‚</p><h2 id="5-6-æœ¬è¯¥æ˜¯å‡½æ•°æˆ–è€…æ¨¡å—çš„ç±»"><a href="#5-6-æœ¬è¯¥æ˜¯å‡½æ•°æˆ–è€…æ¨¡å—çš„ç±»" class="headerlink" title="5.6ã€€æœ¬è¯¥æ˜¯å‡½æ•°æˆ–è€…æ¨¡å—çš„ç±»"></a>5.6ã€€æœ¬è¯¥æ˜¯å‡½æ•°æˆ–è€…æ¨¡å—çš„ç±»</h2><p>ä½¿ç”¨Javaç­‰è¯­è¨€çš„ç¨‹åºå‘˜ä¹ æƒ¯é€šè¿‡åˆ›å»ºç±»æ¥ç»„ç»‡ä»£ç ã€‚ä¾‹å¦‚ç¤ºä¾‹ä¸­çš„<code>Dice</code>ç±»ï¼ŒåŒ…å«ä¸€ä¸ª<code>roll()</code>æ–¹æ³•ï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">import</span> random</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Dice</span>:</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, sides=<span class="hljs-number">6</span></span>):</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">        self.sides = sides</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">    <span class="hljs-keyword">def</span> <span class="hljs-title function_">roll</span>(<span class="hljs-params">self</span>):</span><br><span class="hljs-meta prompt_">...</span> <span class="language-python">        <span class="hljs-keyword">return</span> random.randint(<span class="hljs-number">1</span>, self.sides)</span><br><span class="hljs-meta prompt_">...</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python">d = Dice()</span><br><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;You rolled a&#x27;</span>, d.roll())</span><br>You rolled a 1<br></code></pre></td></tr></table></figure><p>ã€€ã€€è¿™çœ‹èµ·æ¥æ˜¯æ¡ç†æ¸…æ™°çš„ä»£ç ï¼Œä½†æƒ³æƒ³å®é™…çš„éœ€æ±‚æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿç»™å‡ºä¸€ä¸ª1åˆ°6çš„éšæœºæ•°ã€‚å…¶å®ï¼Œç”¨ä¸€ä¸ªç®€å•çš„å‡½æ•°å°±å¯ä»¥ä»£æ›¿æ•´ä¸ªç±»ï¼š</p><figure class="highlight python-repl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python-repl"><span class="hljs-meta prompt_">&gt;&gt;&gt;</span> <span class="language-python"><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;You rolled a&#x27;</span>, random.randint(<span class="hljs-number">1</span>, <span class="hljs-number">6</span>))</span><br>You rolled a 6<br></code></pre></td></tr></table></figure><p>ã€€ã€€åŒå…¶ä»–è¯­è¨€ç›¸æ¯”ï¼ŒPythonç”¨æ¥ç»„ç»‡ä»£ç çš„æ–¹æ³•æ›´åŠ éšæ„ï¼Œå®ƒçš„ä»£ç ä¸éœ€è¦å­˜åœ¨äºç±»æˆ–è€…å…¶ä»–æ¨¡æ¿ç»“æ„ä¸­ã€‚å¦‚æœå‘ç°åˆ›å»ºå¯¹è±¡åªæ˜¯ä¸ºäº†è¿›è¡Œå•ä¸€çš„å‡½æ•°è°ƒç”¨ï¼Œæˆ–è€…ç±»ä¸­åªåŒ…å«é™æ€æ–¹æ³•ï¼Œé‚£ä¹ˆè¿™äº›éƒ½æ˜¯ä»£ç çš„åå‘³é“ï¼Œè­¦ç¤ºæˆ‘ä»¬æœ€å¥½è¿˜æ˜¯ç¼–å†™å‡½æ•°ã€‚</p><p>ã€€ã€€Pythonä¸­çš„å‡½æ•°æ˜¯é€šè¿‡æ¨¡å—è€Œéç±»ç»„åˆåœ¨ä¸€èµ·çš„ï¼Œå› ä¸ºæ— è®ºæ€æ ·ï¼Œç±»éƒ½å¿…é¡»æ”¾åœ¨ä¸€ä¸ªæ¨¡å—ä¸­ï¼ŒæŠŠè¿™äº›ä»£ç æ”¾åœ¨ç±»ä¸­åªæ˜¯ç»™ä»£ç å¢åŠ äº†ä¸€ä¸ªä¸å¿…è¦çš„å£³å­ã€‚ç¬¬15~17ç« å°†è¯¦ç»†åœ°è®¨è®ºè¿™äº›é¢å‘å¯¹è±¡çš„è®¾è®¡åŸåˆ™ã€‚Jack Diederichçš„PyCon 2012æ¼”è®²â€œStop Writing Classesâ€ï¼ˆåœæ­¢ç¼–å†™ç±»ï¼‰æ¶µç›–äº†å…¶ä»–å¯èƒ½ä½¿ä½ çš„Pythonä»£ç è¿‡äºå¤æ‚çš„æ–¹å¼ã€‚</p><h2 id="5-9-ä»£ç åå‘³é“çš„è°¬è¯¯"><a href="#5-9-ä»£ç åå‘³é“çš„è°¬è¯¯" class="headerlink" title="5.9ã€€ä»£ç åå‘³é“çš„è°¬è¯¯"></a>5.9ã€€ä»£ç åå‘³é“çš„è°¬è¯¯</h2><p>æœ‰äº›ä»£ç çš„åå‘³é“æ ¹æœ¬ä¸æ˜¯çœŸæ­£çš„åå‘³é“ã€‚åœ¨å­¦ä¹ ç¼–ç¨‹çš„è¿‡ç¨‹ä¸­ï¼Œä½ ç»å¸¸ä¼šå¬åˆ°ä¸€äº›ä¸€çŸ¥åŠè§£çš„ç³Ÿç³•å»ºè®®ï¼Œå®ƒä»¬æˆ–æ˜¯æ–­ç« å–ä¹‰ï¼Œæˆ–æ˜¯æ—©å°±è¿‡æ—¶ã€‚é‚£äº›è¯•å›¾æŠŠè‡ªå·±çš„ä¸»è§‚æ„è§å½“ä½œæœ€ä½³å®è·µçš„æŠ€æœ¯ä¹¦ä½œè€…åº”è¯¥ä¸ºæ­¤è´Ÿè´£ã€‚</p><p>ã€€ã€€ä½ å¯èƒ½å·²ç»äº†è§£ä»¥ä¸‹è¿™äº›åšæ³•æ˜¯ä»£ç çš„åå‘³é“ï¼Œä½†å…¶å®å¤§å¤šæ•°æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œæˆ‘ç§°ä¹‹ä¸ºâ€œä»£ç åå‘³é“çš„è°¬è¯¯â€ã€‚å®ƒä»¬æ˜¯ä½ èƒ½å¤Ÿä¸”åº”è¯¥å¿½ç•¥çš„è­¦å‘Šï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å…¶ä¸­å‡ ä¸ªã€‚</p><h3 id="5-9-1-è°¬è¯¯ï¼šå‡½æ•°åº”è¯¥ä»…åœ¨æœ«å°¾å¤„æœ‰ä¸€ä¸ªreturnè¯­å¥"><a href="#5-9-1-è°¬è¯¯ï¼šå‡½æ•°åº”è¯¥ä»…åœ¨æœ«å°¾å¤„æœ‰ä¸€ä¸ªreturnè¯­å¥" class="headerlink" title="5.9.1ã€€è°¬è¯¯ï¼šå‡½æ•°åº”è¯¥ä»…åœ¨æœ«å°¾å¤„æœ‰ä¸€ä¸ªreturnè¯­å¥"></a>5.9.1ã€€è°¬è¯¯ï¼šå‡½æ•°åº”è¯¥ä»…åœ¨æœ«å°¾å¤„æœ‰ä¸€ä¸ª<code>return</code>è¯­å¥</h3><p>è¿™ç§â€œä¸€è¿›ä¸€å‡ºâ€çš„æƒ³æ³•æ¥è‡ªå¯¹æ±‡ç¼–è¯­è¨€å’ŒFortranè¯­è¨€ç¼–ç¨‹æ—¶ä»£çš„è¯¯è§£ã€‚è¿™äº›è¯­è¨€å…è®¸ä½ åœ¨å­ä¾‹ç¨‹ï¼ˆä¸€ç§ç±»ä¼¼äºå‡½æ•°çš„ç»“æ„ï¼‰çš„ä»»ä½•ä¸€ä¸ªä½ç½®è¿›å…¥ï¼ˆåŒ…æ‹¬ç¨‹åºä¸­é—´ï¼‰ï¼Œä½¿å¾—è°ƒè¯•å­ä¾‹ç¨‹çš„æ‰§è¡Œéƒ¨åˆ†å¾ˆå›°éš¾ã€‚å‡½æ•°åˆ™æ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼ˆå› ä¸ºæ‰§è¡Œæ€»æ˜¯ä»å‡½æ•°çš„å¼€å¤´å¼€å§‹çš„ï¼‰ï¼Œä½†è¿™ä¸ªå»ºè®®ä¸€ç›´è¢«ä¿ç•™äº†ä¸‹æ¥ï¼Œå¹¶æ”¹ç¼–æˆäº†â€œå‡½æ•°å’Œæ–¹æ³•åº”è¯¥åªæœ‰ä¸€ä¸ª<code>return</code>è¯­å¥ï¼Œä½ç½®åœ¨å…¶æœ«å°¾â€ã€‚æƒ³è¦ä¿è¯æ¯ä¸ªå‡½æ•°æˆ–æ–¹æ³•åªæœ‰ä¸€ä¸ª<code>return</code>è¯­å¥å¾€å¾€éœ€è¦ä¸€ç³»åˆ—é”™ç»¼å¤æ‚çš„<code>if-else</code>è¯­å¥ï¼Œè¿™å¯æ¯”ä½¿ç”¨å¤šä¸ª<code>return</code>è¯­å¥è¦éº»çƒ¦å¾—å¤šã€‚åœ¨ä¸€ä¸ªå‡½æ•°æˆ–æ–¹æ³•ä¸­æœ‰å¤šä¸ª<code>return</code>è¯­å¥å¹¶æ— ä¸å¦¥</p><h3 id="5-9-2-è°¬è¯¯ï¼šå‡½æ•°æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªtryè¯­å¥"><a href="#5-9-2-è°¬è¯¯ï¼šå‡½æ•°æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªtryè¯­å¥" class="headerlink" title="5.9.2ã€€è°¬è¯¯ï¼šå‡½æ•°æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªtryè¯­å¥"></a>5.9.2ã€€è°¬è¯¯ï¼šå‡½æ•°æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ª<code>try</code>è¯­å¥</h3><p>ã€€ã€€åœ¨é€šå¸¸æƒ…å†µä¸‹ï¼Œâ€œå‡½æ•°å’Œæ–¹æ³•åº”è¯¥åªåšä¸€ä»¶äº‹æƒ…â€æ˜¯ä¸ªå¥½å»ºè®®ï¼Œä½†å¦‚æœæŠŠè¿™å¥è¯ç†è§£ä¸ºæ¯ä¸ªå¼‚å¸¸å¤„ç†åº”è¯¥æ”¾åœ¨ä¸€ä¸ªå•ç‹¬çš„å‡½æ•°ä¸­ï¼Œé‚£å°±è¿‡å¤´äº†ã€‚æ¥çœ‹ä¸€ä¸ªå‡½æ•°çš„ä¾‹å­ï¼Œå®ƒçš„åŠŸèƒ½æ˜¯ç¡®è®¤è¦åˆ é™¤çš„æ–‡ä»¶å·²ç»ä¸å­˜åœ¨ï¼š</p><h3 id="5-9-3-è°¬è¯¯ï¼šä½¿ç”¨flagå‚æ•°ä¸å¥½"><a href="#5-9-3-è°¬è¯¯ï¼šä½¿ç”¨flagå‚æ•°ä¸å¥½" class="headerlink" title="5.9.3ã€€è°¬è¯¯ï¼šä½¿ç”¨flagå‚æ•°ä¸å¥½"></a>5.9.3ã€€è°¬è¯¯ï¼šä½¿ç”¨<code>flag</code>å‚æ•°ä¸å¥½</h3><p>ã€€ã€€å‡½æ•°è°ƒç”¨æˆ–è€…æ–¹æ³•è°ƒç”¨ä¸­çš„å¸ƒå°”å‹å‚æ•°æœ‰æ—¶è¢«ç§°ä¸º<code>flag</code>å‚æ•°ã€‚åœ¨ç¼–ç¨‹ä¸­ï¼Œ<code>flag</code>æ˜¯æŒ‡ä¸€ä¸ªè¡¨ç¤ºäºŒå…ƒè®¾ç½®çš„å€¼ï¼Œæ¯”å¦‚â€œå¯ç”¨â€å’Œâ€œç¦ç”¨â€é€šå¸¸ç”¨å¸ƒå°”å€¼è¡¨ç¤ºã€‚å®ƒå¯ä»¥è¡¨ç¤ºä¸ºè®¾ç½®ï¼ˆ<code>True</code>ï¼‰æˆ–è€…æ¸…é™¤ï¼ˆ<code>False</code>ï¼‰ã€‚</p><p>ã€€ã€€è®¤ä¸ºå‡½æ•°è°ƒç”¨ä¸­çš„<code>flag</code>å‚æ•°ä¸å¥½æ˜¯åŸºäºè¿™æ ·ä¸€ä¸ªæƒ³æ³•ï¼šæ ¹æ®<code>flag</code>å€¼çš„æ§åˆ¶ï¼Œå‡½æ•°åŒ…å«äº†ä¸¤ç§æˆªç„¶ä¸åŒçš„åŠŸèƒ½ï¼Œæ¯”å¦‚ä¸‹é¢è¿™ä¸ªç¤ºä¾‹ï¼š</p><figure class="highlight nestedtext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs nestedtext"><span class="hljs-attribute">def someFunction(flagArgument)</span><span class="hljs-punctuation">:</span><br>    <span class="hljs-attribute">if flagArgument</span><span class="hljs-punctuation">:</span><br>        <span class="hljs-comment"># è¿è¡Œä»£ç â€¦â€¦</span><br>    <span class="hljs-attribute">else</span><span class="hljs-punctuation">:</span><br>        <span class="hljs-comment"># è¿è¡Œæˆªç„¶ä¸åŒçš„ä»£ç â€¦â€¦</span><br></code></pre></td></tr></table></figure><p>ã€€ã€€äº‹å®ä¸Šï¼Œå¦‚æœä½ çš„å‡½æ•°çœŸæ˜¯è¿™æ ·ï¼Œé‚£åº”è¯¥åˆ›å»ºä¸¤ä¸ªå‡½æ•°ï¼Œè€Œä¸æ˜¯è®©ä¸€ä¸ªå‚æ•°æ¥å†³å®šè¿è¡Œå‡½æ•°çš„å“ªä¸€éƒ¨åˆ†ä»£ç ã€‚ä½†å¤§å¤šæ•°å¸¦æœ‰<code>flag</code>å‚æ•°çš„å‡½æ•°å¹¶éå¦‚æ­¤ã€‚æ¯”å¦‚ä½ å¯ä»¥ä¸º<code>sorted()</code>å‡½æ•°çš„<code>reverse</code>å‚æ•°ä¼ é€’ä¸€ä¸ªå¸ƒå°”ç±»å‹çš„å€¼æ¥å†³å®šæ˜¯æ­£åºè¿˜æ˜¯ååºã€‚æŠŠè¿™ä¸ªå‡½æ•°åˆ†æˆåä¸º<code>sorted()</code>å’Œ<code>reverseSorted()</code>çš„ä¸¤ä¸ªå‡½æ•°å¹¶æ— ç›Šå¤„ï¼Œåè€Œå¢åŠ äº†ä¸å¿…è¦çš„ä»£ç é‡ã€‚æ‰€ä»¥ï¼Œè®¤ä¸ºä½¿ç”¨<code>flag</code>å‚æ•°ä¸å¥½çš„æƒ³æ³•æ˜¯ä¸ªè°¬è¯¯ã€‚</p><h3 id="5-9-4-è°¬è¯¯ï¼šå…¨å±€å˜é‡ä¸å¥½"><a href="#5-9-4-è°¬è¯¯ï¼šå…¨å±€å˜é‡ä¸å¥½" class="headerlink" title="5.9.4ã€€è°¬è¯¯ï¼šå…¨å±€å˜é‡ä¸å¥½"></a>5.9.4ã€€è°¬è¯¯ï¼šå…¨å±€å˜é‡ä¸å¥½</h3><p>ã€€ã€€å‡½æ•°åƒæ˜¯ç¨‹åºä¸­çš„â€œç¨‹åºâ€ï¼šå®ƒä»¬åŒ…å«ä»£ç ï¼Œæœ‰å±€éƒ¨å˜é‡ï¼Œå½“å‡½æ•°è¿”å›æ—¶å±€éƒ¨å˜é‡å°±ä¸å¤å­˜åœ¨ã€‚è¿™è·Ÿç¨‹åºç»“æŸåå˜é‡å°±ä¼šè¢«é—å¿˜çš„æƒ…å†µç±»ä¼¼ã€‚å‡½æ•°æ˜¯ç›¸å¯¹éš”ç¦»çš„ï¼Œå®ƒä»¬çš„ä»£ç æ‰§è¡Œç»“æœæ­£ç¡®ä¸å¦ä»…ä»…å–å†³äºè¢«è°ƒç”¨æ—¶ä¼ é€’çš„å‚æ•°ã€‚</p><p>ã€€ã€€ä½†å¯¹ä½¿ç”¨å…¨å±€å˜é‡çš„å‡½æ•°è€Œè¨€ï¼Œè¿™ç§æœ‰ç”¨çš„éš”ç¦»æ€§æœ‰æ‰€å‰Šå¼±ã€‚åœ¨å‡½æ•°ä¸­ä½¿ç”¨çš„æ¯ä¸ªå…¨å±€å˜é‡éƒ½æ˜¯å‡½æ•°çš„ä¸€ä¸ªè¾“å…¥ï¼Œå°±åƒå‚æ•°ä¸€æ ·ã€‚æ›´å¤šçš„å‚æ•°æ„å‘³ç€æ›´å¤šçš„å¤æ‚æ€§ï¼Œä¹Ÿæ„å‘³ç€æ›´å¤šçš„æ½œåœ¨bugã€‚å¦‚æœç¨‹åºè¿è¡Œå‡ºé”™æ˜¯ç”±å…¨å±€å˜é‡ä¸­çš„æŸä¸ªå€¼çš„å¼‚å¸¸å¼•èµ·çš„ï¼Œé‚£ä¹ˆé—®é¢˜æ’æŸ¥ä¼šå¾ˆå›°éš¾ï¼Œå› ä¸ºéš¾ä»¥ç¡®å®šè¿™ä¸ªå¼‚å¸¸å€¼è¢«è®¾å®šçš„ä½ç½®ï¼Œå®ƒå¯èƒ½å­˜åœ¨äºç¨‹åºä¸­çš„ä»»ä½•åœ°æ–¹ã€‚ä¸ºäº†å¯»æ‰¾è¿™ä¸ªå¼‚å¸¸å€¼å‡ºç°çš„åŸå› ï¼Œä½ ä¸èƒ½åªåˆ†æå‡½æ•°å†…éƒ¨çš„ä»£ç æˆ–è€…å‡½æ•°è°ƒç”¨çš„é‚£è¡Œä»£ç ï¼Œè€Œæ˜¯å¿…é¡»æŸ¥çœ‹æ•´ä¸ªç¨‹åºçš„ä»£ç ã€‚å‡ºäºè¿™ä¸ªåŸå› ï¼Œåº”è¯¥é™åˆ¶å¯¹å…¨å±€å˜é‡çš„ä½¿ç”¨ã€‚</p><h3 id="5-9-5-è°¬è¯¯ï¼šæ³¨é‡Šæ˜¯ä¸å¿…è¦çš„"><a href="#5-9-5-è°¬è¯¯ï¼šæ³¨é‡Šæ˜¯ä¸å¿…è¦çš„" class="headerlink" title="5.9.5ã€€è°¬è¯¯ï¼šæ³¨é‡Šæ˜¯ä¸å¿…è¦çš„"></a>5.9.5ã€€è°¬è¯¯ï¼šæ³¨é‡Šæ˜¯ä¸å¿…è¦çš„</h3><p>ç³Ÿç³•çš„æ³¨é‡Šç¡®å®æ¯”æ²¡æœ‰æ³¨é‡Šæ›´ç³Ÿç³•ã€‚å¸¦æœ‰è¿‡æ—¶æˆ–è€…è¯¯å¯¼æ€§ä¿¡æ¯çš„æ³¨é‡Šä¸ä»…ä¸èƒ½å¸®åŠ©ç†è§£ä»£ç ï¼Œåè€Œä¼šå¢åŠ ç¨‹åºå‘˜çš„å·¥ä½œé‡ã€‚ä¸Šè¿°è¿™ä¸ªæ½œåœ¨çš„é—®é¢˜æœ‰æ—¶å€™è¢«æ‹¿æ¥è¯æ˜â€œæ‰€æœ‰æ³¨é‡Šéƒ½æ˜¯ä¸å¥½çš„â€è¿™ä¸€è§‚ç‚¹ã€‚è¯¥è§‚ç‚¹è®¤ä¸ºï¼Œåº”è¯¥å°½é‡ä½¿ç”¨æ›´å…·å¯è¯»æ€§çš„ä»£ç æ›¿ä»£æ³¨é‡Šï¼Œç”šè‡³ä»£ç ä¸­å‹æ ¹å„¿å°±ä¸è¯¥æœ‰æ³¨é‡Šã€‚</p><p>ã€€æ³¨é‡Šæ˜¯ç”¨è‹±æ–‡ï¼ˆæˆ–è€…æ˜¯ç¨‹åºå‘˜æ‰€ä½¿ç”¨çš„ä»»ä½•è¯­è¨€ï¼‰ç¼–å†™çš„ï¼Œé€šè¿‡å®ƒä»¬ä¼ é€’å˜é‡ã€å‡½æ•°å’Œç±»ç­‰åç§°æ‰€ä¸èƒ½ä¼ é€’çš„ä¿¡æ¯ã€‚ä½†ç¼–å†™ç®€æ˜æœ‰æ•ˆçš„æ³¨é‡Šå¹¶éæ˜“äº‹ã€‚æ³¨é‡ŠåŒä»£ç ä¸€æ ·ï¼Œéœ€è¦é‡å†™å’Œå¤šæ¬¡è¿­ä»£æ‰èƒ½è¾¾åˆ°å®Œç¾ã€‚åœ¨å†™ä»£ç æ—¶ï¼Œç¨‹åºå‘˜æ˜¯èƒ½å¤ŸåŒæ­¥ç†è§£ä»£ç çš„ï¼Œæ‰€ä»¥å†™æ³¨é‡Šçœ‹èµ·æ¥åƒæ˜¯ç”»è›‡æ·»è¶³ã€‚å› æ­¤ï¼Œä»–ä»¬å€¾å‘äºæ¥å—â€œæ³¨é‡Šæ˜¯ä¸å¿…è¦çš„â€è¿™ç§è§‚ç‚¹ã€‚</p><p>ã€€ã€€è€Œé€šå¸¸æƒ…å†µæ˜¯ç¨‹åºä¸­çš„æ³¨é‡Šå¤ªå°‘æˆ–è€…å°±æ²¡æœ‰æ³¨é‡Šï¼Œè¿™æ¯”æ³¨é‡Šå¤ªå¤šæˆ–è€…å…·æœ‰è¯¯å¯¼æ€§çš„æƒ…å†µå¤šå¾—å¤šã€‚æ‹’ç»æ³¨é‡Šå°±å¦‚åŒåœ¨è¯´ï¼šâ€œåé£æœºé£è¶Šå¤§è¥¿æ´‹åªæœ‰99.999991%çš„å®‰å…¨æ€§ï¼Œæ‰€ä»¥æˆ‘æ‰“ç®—æ¸¸æ³³ã€‚</p><p>å¯ä»¥çœ‹ä¸‹ç¯‡</p>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Pythonã€‘ç¬”è®°ä¹‹åˆ¤æ–­ä¸€ä¸ªå­—æ®µä¸²æ˜¯å¦åŒ…å«æŸä¸€å­—ç¬¦ä¸²ï¼ˆå››ï¼‰</title>
    <link href="/2024/01/02/614Python%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%88%A4%E6%96%AD%E4%B8%80%E4%B8%AA%E5%AD%97%E6%AE%B5%E4%B8%B2%E6%98%AF%E5%90%A6%E5%8C%85%E5%90%AB%E6%9F%90%E4%B8%80%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%9B%9B/"/>
    <url>/2024/01/02/614Python%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8B%E5%88%A4%E6%96%AD%E4%B8%80%E4%B8%AA%E5%AD%97%E6%AE%B5%E4%B8%B2%E6%98%AF%E5%90%A6%E5%8C%85%E5%90%AB%E6%9F%90%E4%B8%80%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%9B%9B/</url>
    
    <content type="html"><![CDATA[<h1 id="Pythonç¬”è®°ä¹‹åˆ¤æ–­ä¸€ä¸ªå­—æ®µä¸²æ˜¯å¦åŒ…å«æŸä¸€å­—ç¬¦ä¸²"><a href="#Pythonç¬”è®°ä¹‹åˆ¤æ–­ä¸€ä¸ªå­—æ®µä¸²æ˜¯å¦åŒ…å«æŸä¸€å­—ç¬¦ä¸²" class="headerlink" title="Pythonç¬”è®°ä¹‹åˆ¤æ–­ä¸€ä¸ªå­—æ®µä¸²æ˜¯å¦åŒ…å«æŸä¸€å­—ç¬¦ä¸²"></a>Pythonç¬”è®°ä¹‹åˆ¤æ–­ä¸€ä¸ªå­—æ®µä¸²æ˜¯å¦åŒ…å«æŸä¸€å­—ç¬¦ä¸²</h1><h3 id="æˆå‘˜åˆ¤æ–­ä¹‹-in"><a href="#æˆå‘˜åˆ¤æ–­ä¹‹-in" class="headerlink" title="æˆå‘˜åˆ¤æ–­ä¹‹ in"></a>æˆå‘˜åˆ¤æ–­ä¹‹ <code>in</code></h3><p>ä¸€èˆ¬ç”¨çš„å¤šçš„æ˜¯ç”¨in æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨ è¿”å›<code>Ture</code> æˆ– <code>False</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">str</span> = <span class="hljs-string">&quot;string test string test&quot;</span><br>find1 = <span class="hljs-string">&quot;str&quot;</span><br>find2 = <span class="hljs-string">&quot;test&quot;</span><br><span class="hljs-built_in">print</span>(find1 <span class="hljs-keyword">in</span> <span class="hljs-built_in">str</span>)      <span class="hljs-comment"># True</span><br><span class="hljs-built_in">print</span>(find1 <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> <span class="hljs-built_in">str</span>)  <span class="hljs-comment"># False</span><br></code></pre></td></tr></table></figure><h2 id="ä½¿ç”¨å­—ç¬¦ä¸²å¯¹è±¡çš„æ–¹æ³•find-ã€rfind-ã€index-ã€rindex"><a href="#ä½¿ç”¨å­—ç¬¦ä¸²å¯¹è±¡çš„æ–¹æ³•find-ã€rfind-ã€index-ã€rindex" class="headerlink" title="ä½¿ç”¨å­—ç¬¦ä¸²å¯¹è±¡çš„æ–¹æ³•find()ã€rfind()ã€index()ã€rindex()"></a>ä½¿ç”¨å­—ç¬¦ä¸²å¯¹è±¡çš„æ–¹æ³•<code>find()</code>ã€<code>rfind()</code>ã€<code>index()</code>ã€<code>rindex()</code></h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">str</span> = <span class="hljs-string">&quot;string test string test&quot;</span><br>find1 = <span class="hljs-string">&quot;str&quot;</span><br>find2 = <span class="hljs-string">&quot;test&quot;</span><br> <span class="hljs-comment"># find</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>.find(find1))<span class="hljs-comment"># 0</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>.find(find2))<span class="hljs-comment"># 7</span><br> <br><span class="hljs-comment"># rfind</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>.rfind(find1))<span class="hljs-comment"># 12</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>.rfind(find2))<span class="hljs-comment"># 19</span><br><br><span class="hljs-comment"># index</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>.index(find1))<span class="hljs-comment"># 0</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>.index(find2))<span class="hljs-comment"># 7</span><br><br><span class="hljs-comment"># rindex</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>.rindex(find1))<span class="hljs-comment"># 12</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>.rindex(find2))<span class="hljs-comment"># 19</span><br><br><span class="hljs-comment"># count</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>.count(find1))<span class="hljs-comment"># 2</span><br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">str</span>.count(find2))<span class="hljs-comment"># 2</span><br></code></pre></td></tr></table></figure><h2 id="åŒºåˆ«ï¼š"><a href="#åŒºåˆ«ï¼š" class="headerlink" title="åŒºåˆ«ï¼š"></a>åŒºåˆ«ï¼š</h2><ul><li><p>find() è·å–å€¼æ—¶ï¼Œå¦‚æœè¦æŸ¥æ‰¾çš„å€¼ä¸å­˜åœ¨ï¼Œä¼šè¿”å›-1</p></li><li><p>index() è·å–å€¼çš„ç´¢å¼•æ—¶ï¼Œå¦‚æœä¸å­˜åœ¨å€¼ï¼Œä¼šæŠ¥é”™</p></li><li><p>find() ä»å­—ç¬¦ä¸²å·¦è¾¹å¼€å§‹æŸ¥è¯¢å­å­—ç¬¦ä¸²åŒ¹é…åˆ°çš„ç¬¬ä¸€ä¸ªç´¢å¼•ï¼ˆä»0å¼€å§‹ï¼‰</p></li><li><p>rfind()  ä»å­—ç¬¦ä¸²å³è¾¹å¼€å§‹æŸ¥è¯¢å­—ç¬¦ä¸²åŒ¹é…åˆ°çš„ç¬¬ä¸€ä¸ªç´¢å¼•ï¼ˆä»0å¼€å§‹ï¼‰</p></li><li><p>index() ä»å­—ç¬¦ä¸²å·¦è¾¹å¼€å§‹æŸ¥è¯¢å­å­—ç¬¦ä¸²åŒ¹é…åˆ°çš„ç¬¬ä¸€ä¸ªç´¢å¼•ï¼ˆä»0å¼€å§‹ï¼‰</p></li><li><p>rindex() ä»å­—ç¬¦ä¸²å³è¾¹å¼€å§‹æŸ¥è¯¢å­—ç¬¦ä¸²åŒ¹é…åˆ°çš„ç¬¬ä¸€ä¸ªç´¢å¼•ï¼ˆä»0å¼€å§‹ï¼‰</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€pythonã€‘ä¹‹UIè‡ªåŠ¨åŒ–åˆçª¥</title>
    <link href="/2023/12/25/694Python%E4%B9%8BUI%E8%87%AA%E5%8A%A8%E5%8C%96%E5%88%9D%E7%AA%A5/"/>
    <url>/2023/12/25/694Python%E4%B9%8BUI%E8%87%AA%E5%8A%A8%E5%8C%96%E5%88%9D%E7%AA%A5/</url>
    
    <content type="html"><![CDATA[<h1 id="UIè‡ªåŠ¨åŒ–ä¹‹Selenium-å’Œ-Playwright"><a href="#UIè‡ªåŠ¨åŒ–ä¹‹Selenium-å’Œ-Playwright" class="headerlink" title="UIè‡ªåŠ¨åŒ–ä¹‹Selenium å’Œ Playwright"></a>UIè‡ªåŠ¨åŒ–ä¹‹Selenium å’Œ Playwright</h1><h1 id="Selenium"><a href="#Selenium" class="headerlink" title="Selenium"></a>Selenium</h1><h2 id="æ¦‚è¿°ï¼š"><a href="#æ¦‚è¿°ï¼š" class="headerlink" title="æ¦‚è¿°ï¼š"></a>æ¦‚è¿°ï¼š</h2><p>Selenium æ˜¯æœ€å¹¿æ³›ä½¿ç”¨çš„å¼€æº Web UIï¼ˆç”¨æˆ·ç•Œé¢ï¼‰è‡ªåŠ¨åŒ–æµ‹è¯•å¥—ä»¶ä¹‹ä¸€ã€‚Selenium æ”¯æŒçš„è¯­è¨€åŒ…æ‹¬C#ï¼ŒJavaï¼ŒPerlï¼ŒPHPï¼ŒPython å’Œ Rubyã€‚ç›®å‰ï¼ŒSelenium Web é©±åŠ¨ç¨‹åºæœ€å— Python å’Œ Cï¼ƒæ¬¢è¿ã€‚ Selenium æµ‹è¯•è„šæœ¬å¯ä»¥ä½¿ç”¨ä»»ä½•æ”¯æŒçš„ç¼–ç¨‹è¯­è¨€è¿›è¡Œç¼–ç ï¼Œå¹¶ä¸”å¯ä»¥ç›´æ¥åœ¨å¤§å¤šæ•°ç°ä»£ Web æµè§ˆå™¨ä¸­è¿è¡Œã€‚åœ¨çˆ¬è™«é¢†åŸŸ selenium åŒæ ·æ˜¯ä¸€æŠŠåˆ©å™¨ï¼Œèƒ½å¤Ÿè§£å†³å¤§éƒ¨åˆ†çš„ç½‘é¡µçš„åçˆ¬é—®é¢˜</p><p>å®‰è£…ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">pip install selenium -i -i http://pypi.douban.com/simple --trusted-host pypi.douban.com<br></code></pre></td></tr></table></figure><p>ä¸‹è½½Driver </p><p>éœ€è¦ä½¿ç”¨å¯¹åº”çš„é©±åŠ¨æ‰èƒ½æ‰“å¼€å¯¹åº”çš„æµè§ˆå™¨</p><h2 id="ç®€å•æ‰“å¼€æµè§ˆå™¨"><a href="#ç®€å•æ‰“å¼€æµè§ˆå™¨" class="headerlink" title="ç®€å•æ‰“å¼€æµè§ˆå™¨"></a>ç®€å•æ‰“å¼€æµè§ˆå™¨</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver<br><span class="hljs-keyword">import</span> time<br><span class="hljs-comment"># åŠ è½½é©±åŠ¨</span><br>driver = webdriver.Chrome()<br><span class="hljs-comment"># è®¿é—®ç½‘å€ï¼Œ</span><br>driver.get(<span class="hljs-string">&quot;http://www.baidu.com&quot;</span>)<br><span class="hljs-comment"># è¯·æ±‚ æµè§ˆå™¨ä¿¡æ¯ </span><br>title = driver.title<br><span class="hljs-comment"># å»ºç«‹ç­‰å¾…ç­–ç•¥</span><br>driver.implicitly_wait(<span class="hljs-number">0.5</span>)<br><span class="hljs-comment"># æ‰¾åˆ°æœç´¢æ¡†</span><br>input_element = driver.find_<br></code></pre></td></tr></table></figure><h2 id="åˆå§‹åŒ–ç­‰ç®€å•æ“ä½œ"><a href="#åˆå§‹åŒ–ç­‰ç®€å•æ“ä½œ" class="headerlink" title="åˆå§‹åŒ–ç­‰ç®€å•æ“ä½œ"></a>åˆå§‹åŒ–ç­‰ç®€å•æ“ä½œ</h2><p>1ã€åˆå§‹åŒ–æµè§ˆå™¨ã€åˆ·æ–°ã€æœ€å¤§åŒ–ã€åé€€ã€å‰è¿›ã€æˆªå›¾</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">from</span> selenium <span class="hljs-keyword">import</span> webdriver<br><span class="hljs-keyword">from</span> selenium.webdriver.common.by <span class="hljs-keyword">import</span> By<br><span class="hljs-comment"># åŠ è½½é©±åŠ¨</span><br>driver = webdriver.Chrome()<br><span class="hljs-comment"># è®¿é—®ç½‘å€ï¼Œ</span><br>driver.get(<span class="hljs-string">&quot;http://www.baidu.com&quot;</span>)<br><span class="hljs-comment"># æœ€å¤§åŒ–ï¼Œ</span><br>driver.maximize_window()<br><span class="hljs-comment"># åé€€</span><br>driver.back()<br><span class="hljs-comment"># æš‚åœ2s  æ˜¾å¼ç­‰å¾…</span><br>timl.sleep(<span class="hljs-number">2</span>)<br><span class="hljs-comment"># å‰è¿›</span><br>driver.forward()<br><span class="hljs-comment"># åˆ·æ–°</span><br><span class="hljs-built_in">chr</span>.refresh()<br><span class="hljs-comment"># æˆªå›¾</span><br>driver.get_screenshot_as_file(<span class="hljs-string">&quot;1.png&quot;</span>)<br><span class="hljs-comment"># è¾“å…¥æ¡†è¾“å…¥å†…å®¹</span><br>driver.find_element(By.ID,<span class="hljs-string">&#x27;kw&#x27;</span>).send_keys(<span class="hljs-string">&quot;saa&quot;</span>)<br><span class="hljs-comment"># ç‚¹å‡»</span><br>driver.find_element(By.ID,<span class="hljs-string">&#x27;su&#x27;</span>).click()<br><span class="hljs-comment">#æ¸…é™¤è¾“å…¥æ¡†å†…å®¹</span><br>driver.find_element(By.ID,<span class="hljs-string">&#x27;kw&#x27;</span>).clear()<br><span class="hljs-comment">#å…³é—­æµè§ˆå™¨</span><br>driver.close()<br></code></pre></td></tr></table></figure><h2 id="å•ä¸ªå…ƒç´ å®šä½8å¤§ã€é‡ç‚¹ã€‘"><a href="#å•ä¸ªå…ƒç´ å®šä½8å¤§ã€é‡ç‚¹ã€‘" class="headerlink" title="å•ä¸ªå…ƒç´ å®šä½8å¤§ã€é‡ç‚¹ã€‘"></a>å•ä¸ªå…ƒç´ å®šä½8å¤§ã€é‡ç‚¹ã€‘</h2><p>å®šä½ç”¨ä»€ä¹ˆæ–¹æ³•ï¼Œç”¨driverçš„find_elementå¯»æ‰¾å…ƒç´ æ–¹æ³•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">find_element</span>(<span class="hljs-params">self, by=By.ID, value: <span class="hljs-type">Optional</span>[<span class="hljs-built_in">str</span>] = <span class="hljs-literal">None</span></span>) -&gt; WebElement:<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ï¼Œç„¶ååœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢ä½¿ç”¨Byé‡Œé¢çš„å±æ€§by&#x3D;By.XXX</p><p>æˆ‘ä»¬å†çœ‹ä¸€ä¸‹Byé‡Œé¢çš„å±æ€§å°±çŸ¥é“æœ‰å‡ ç§æ–¹å¼äº†</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> selenium.webdriver.common.by <span class="hljs-keyword">import</span> By<br><span class="hljs-keyword">class</span> <span class="hljs-title class_">By</span>:<br>    <span class="hljs-string">&quot;&quot;&quot;Set of supported locator strategies.&quot;&quot;&quot;</span><br><br>    ID = <span class="hljs-string">&quot;id&quot;</span> <br>    XPATH = <span class="hljs-string">&quot;xpath&quot;</span><br>    LINK_TEXT = <span class="hljs-string">&quot;link text&quot;</span><br>    PARTIAL_LINK_TEXT = <span class="hljs-string">&quot;partial link text&quot;</span><br>    NAME = <span class="hljs-string">&quot;name&quot;</span><br>    TAG_NAME = <span class="hljs-string">&quot;tag name&quot;</span><br>    CLASS_NAME = <span class="hljs-string">&quot;class name&quot;</span><br>    CSS_SELECTOR = <span class="hljs-string">&quot;css selector&quot;</span><br></code></pre></td></tr></table></figure><h3 id="ä»¥åœ¨ç™¾åº¦é¦–é¡µçš„è¾“å…¥æ¡†ä¸ºä¾‹å…ƒç´ å®šä½"><a href="#ä»¥åœ¨ç™¾åº¦é¦–é¡µçš„è¾“å…¥æ¡†ä¸ºä¾‹å…ƒç´ å®šä½" class="headerlink" title="ä»¥åœ¨ç™¾åº¦é¦–é¡µçš„è¾“å…¥æ¡†ä¸ºä¾‹å…ƒç´ å®šä½"></a>ä»¥åœ¨ç™¾åº¦é¦–é¡µçš„è¾“å…¥æ¡†ä¸ºä¾‹å…ƒç´ å®šä½</h3><p><img src="/home/wang/%E5%9B%BE%E7%89%87/2024-03-13_16-03.png" alt="baidu"></p><p>1ã€é€šè¿‡å…ƒç´ idå®šä½ã€å”¯ä¸€ã€‘</p><p>idå®šä½æ¯”è¾ƒå”¯ä¸€ï¼Œä½†æ˜¯æœ‰idçš„å…ƒç´ å°‘</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">driver = webdriver.Chrome()<br>driver.find_element(By.ID,<span class="hljs-string">&#x27;kw&#x27;</span>).send_keys(<span class="hljs-string">&quot;Seleniumæ˜¯ä»€ä¹ˆ&quot;</span>)<br></code></pre></td></tr></table></figure><p>2ã€é€šè¿‡å…ƒç´ çš„class</p><p>class nameå®šä½</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">driver.find_element(By.CLASS_NAME,<span class="hljs-string">&#x27;s_ipt&#x27;</span>).send_keys(<span class="hljs-string">&quot;Seleniumæ˜¯ä»€ä¹ˆ&quot;</span>)<br></code></pre></td></tr></table></figure><p>3ã€é€šè¿‡å…ƒç´ çš„name</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">driver.find_element(By.NAME,<span class="hljs-string">&#x27;wd&#x27;</span>).send_keys(<span class="hljs-string">&quot;Seleniumæ˜¯ä»€ä¹ˆ&quot;</span>)<br></code></pre></td></tr></table></figure><p>4ã€é€šè¿‡å…ƒç´ æ ‡ç­¾</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">driver.find_element(By.TAG_NAME, <span class="hljs-string">&quot;lname&quot;</span>)<br></code></pre></td></tr></table></figure><p>5ã€é€šè¿‡è¶…é“¾æ¥æ–‡æœ¬â€“&gt;è¿™ä¸ªæ˜¯å®šä½è·³è½¬é“¾æ¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">driver.find_element(By.LINK_TEXT, <span class="hljs-string">&quot;xxx&quot;</span>)<br></code></pre></td></tr></table></figure><p>6ã€é€šè¿‡è¶…é“¾æ¥æ–‡æœ¬ï¼ˆæ¨¡ç³ŠåŒ¹é…ï¼‰â€“&gt;è¿™ä¸ªæ˜¯å®šä½è·³è½¬é“¾æ¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">driver.find_element(By.PARTIAL_LINK_TEXT, <span class="hljs-string">&quot;xxx&quot;</span>)<br></code></pre></td></tr></table></figure><p>7ã€é€šè¿‡xpathã€ä¸‡èƒ½ï¼Œé‡ç‚¹ã€‘</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">driver.find_element(By.XPATH,<span class="hljs-string">&#x27;//*[@id=&quot;kw&quot;]&#x27;</span>).send_keys(<span class="hljs-string">&quot;Seleniumæ˜¯ä»€ä¹ˆ&quot;</span>)<br></code></pre></td></tr></table></figure><p>8ã€é€šè¿‡cssé€‰æ‹©å™¨ï¼ˆä¸‡èƒ½ï¼Œé‡ç‚¹ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">driver.find_element(By.CSS_SELECTOR,<span class="hljs-string">&#x27;#kw&#x27;</span>).send_keys(<span class="hljs-string">&quot;Seleniumæ˜¯ä»€ä¹ˆ&quot;</span>)<br></code></pre></td></tr></table></figure><p>9ã€å¤šä¸ªå…ƒç´ å®šä½çš„æ–¹æ³•</p><p>ä¸å•ä¸ªå…ƒç´ çš„å®šä½æ–¹å¼ç±»ä¼¼ï¼ŒæŠŠfind_elementæ”¹æˆfind_elementså³å¯</p><p>10ã€å®šä½ä¸‹æ‹‰æ¡†</p><p>å¯ä»¥ä¸‹æ‹‰é€‰æ‹©ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å®šä½åˆ°å¯¹åº”çš„ä¸‹æ‹‰é€‰é¡¹ï¼Œå› ä¸ºä½ çš„ç›®çš„æ˜¯ä¸ºäº†æ‰¾åˆ°è¿™ä¸ªå…ƒç´ </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">select_by_index()           <span class="hljs-comment"># é€šè¿‡ç´¢å¼•å®šä½ï¼›æ³¨æ„ï¼š&gt;indexç´¢å¼•æ˜¯ä»â€œ0â€å¼€å§‹ã€‚</span><br>select_by_value()           <span class="hljs-comment"># é€šè¿‡valueå€¼å®šä½ï¼Œva&gt;lueæ ‡ç­¾çš„å±æ€§å€¼ã€‚</span><br>select_by_visible_text()    <span class="hljs-comment"># é€šè¿‡æ–‡æœ¬å€¼å®šä½ï¼Œå³æ˜¾&gt;ç¤ºåœ¨ä¸‹æ‹‰æ¡†çš„å€¼ã€‚</span><br>Select(driver.find_element_by_name(<span class="hljs-string">&quot;å§“å&quot;</span>)).select_by_index(<span class="hljs-number">1</span>)<br><span class="hljs-comment"># æˆ–è€…åˆ†å¼€å†™</span><br>a=driver.find_element_by_name(<span class="hljs-string">&quot;å§“å&quot;</span>)<br>Select(a).select_by_index(<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure><h2 id="é’ˆå¯¹æµè§ˆå™¨çš„æ“ä½œ"><a href="#é’ˆå¯¹æµè§ˆå™¨çš„æ“ä½œ" class="headerlink" title="é’ˆå¯¹æµè§ˆå™¨çš„æ“ä½œ"></a>é’ˆå¯¹æµè§ˆå™¨çš„æ“ä½œ</h2><p>æ§åˆ¶æµè§ˆå™¨æ“ä½œï¼š</p><ul><li>è·å–å½“å‰é¡µé¢çš„titleæ ‡é¢˜ã€urlä¿¡æ¯</li><li>æœ€å¤§åŒ–ã€æœ€å°åŒ–æµè§ˆå™¨</li><li>æ§åˆ¶ã€è·å–æµè§ˆå™¨çš„å¤§å°ï¼ˆé¡µé¢å¤§å°ï¼‰</li><li>å‰è¿›ã€åé€€ã€åˆ·æ–°é¡µé¢</li><li>æ‰§è¡ŒJSè¯­å¥</li><li>æ»šåŠ¨æ»‘åŠ¨é¡µé¢</li><li>æˆªå›¾ä¿å­˜</li></ul><p>è·å–å½“å‰é¡µé¢çš„titleæ ‡é¢˜ã€urlä¿¡æ¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æ ‡ç­¾é¡µtitleï¼š<span class="hljs-subst">&#123;driver.title&#125;</span>&quot;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">f&quot;æ ‡ç­¾é¡µurlï¼š<span class="hljs-subst">&#123;driver.current_url&#125;</span>&quot;</span>)<br></code></pre></td></tr></table></figure><p>æœ€å¤§åŒ–ã€æœ€å°åŒ–æµè§ˆå™¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">driver.maximize_window()<br>driver.minimize_window()<br>driver.fullscreen_window() <span class="hljs-comment"># å…¨å±</span><br></code></pre></td></tr></table></figure><p>æ§åˆ¶ã€è·å–æµè§ˆå™¨çš„å¤§å°ï¼ˆé¡µé¢å¤§å°ï¼‰</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">driver.set_window_size(<span class="hljs-number">1024</span>, <span class="hljs-number">768</span>)<br><span class="hljs-comment"># åˆ†åˆ«è·å–æ¯ä¸ªå°ºå¯¸</span><br>width = driver.get_window_size().get(<span class="hljs-string">&quot;width&quot;</span>)<br>height = driver.get_window_size().get(<span class="hljs-string">&quot;height&quot;</span>)<br><span class="hljs-comment"># æˆ–è€…å­˜å‚¨å°ºå¯¸å¹¶åœ¨ä»¥åæŸ¥è¯¢å®ƒä»¬</span><br>size = driver.get_window_size()<br>width1 = size.get(<span class="hljs-string">&quot;width&quot;</span>)<br>height1 = size.get(<span class="hljs-string">&quot;height&quot;</span>)<br></code></pre></td></tr></table></figure><p>å‰è¿›ã€åé€€ã€åˆ·æ–°é¡µé¢</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å‰è¿›</span><br>driver.forward()<br><br><span class="hljs-comment"># åé€€</span><br>driver.back()<br><br><span class="hljs-comment"># åˆ·æ–°</span><br>driver.refresh()<br></code></pre></td></tr></table></figure><p>å±å¹•æˆªå›¾ã€å…ƒç´ å±å¹•æˆªå›¾</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">driver.save_screenshot(<span class="hljs-string">&#x27;./image.png&#x27;</span>)<br><span class="hljs-comment"># å…ƒç´ å±å¹•æˆªå›¾</span><br>ele = driver.find_element(By.CSS_SELECTOR, <span class="hljs-string">&#x27;h1&#x27;</span>)<br><br><span class="hljs-comment"># Returns and base64 encoded string into image</span><br>ele.screenshot(<span class="hljs-string">&#x27;./image.png&#x27;</span>)<br></code></pre></td></tr></table></figure><h2 id="é’ˆå¯¹å…ƒç´ çš„ç®€å•æ“ä½œ"><a href="#é’ˆå¯¹å…ƒç´ çš„ç®€å•æ“ä½œ" class="headerlink" title="é’ˆå¯¹å…ƒç´ çš„ç®€å•æ“ä½œ"></a>é’ˆå¯¹å…ƒç´ çš„ç®€å•æ“ä½œ</h2><p>å¸¸è§å…ƒç´ æ“ä½œåŒ…å«ï¼š</p><ul><li>ç‚¹å‡»</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">driver.find_element(By.NAME, <span class="hljs-string">&quot;color_input&quot;</span>).click()<br></code></pre></td></tr></table></figure><ul><li>è¾“å…¥å†…å®¹ã€æ¸…é™¤å†…å®¹</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">driver.find_element(By.NAME, <span class="hljs-string">&quot;email_input&quot;</span>).clear()<br></code></pre></td></tr></table></figure><ul><li>è¿”å›å…ƒç´ å°ºå¯¸ã€åæ ‡</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">login_btn = driver.find_element_by_class_name(<span class="hljs-string">&quot;login&quot;</span>)<br></code></pre></td></tr></table></figure><ul><li>è·å–å…ƒç´ æ ‡ç­¾æ–‡æœ¬</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">a_text = driver.find_element_by_tag_name(<span class="hljs-string">&quot;a&quot;</span>)<br></code></pre></td></tr></table></figure><ul><li>è·å–å…ƒç´ å±æ€§å€¼</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">a_attr = driver.find_element_by_class_name(<span class="hljs-string">&quot;mnav&quot;</span>)<br></code></pre></td></tr></table></figure><ul><li>æ£€æŸ¥å…ƒç´ ï¼šæ˜¯å¦å¯è§ã€æ˜¯å¦å¯ç‚¹å‡»ã€æ˜¯å¦å·²è¢«é€‰æ‹©</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># æ‰¾åˆ° ä¸å¯è§å…ƒç´ </span><br>ant_btn3 = driver.find_element_by_class_name(<span class="hljs-string">&quot;ant-btn3&quot;</span>)<br><span class="hljs-comment"># æ‰¾åˆ° å¯è§å…ƒç´ </span><br>ant_btn4 = driver.find_element_by_class_name(<span class="hljs-string">&quot;ant-btn4&quot;</span>)<br></code></pre></td></tr></table></figure><h2 id="é¼ æ ‡æ“ä½œ"><a href="#é¼ æ ‡æ“ä½œ" class="headerlink" title="é¼ æ ‡æ“ä½œ"></a>é¼ æ ‡æ“ä½œ</h2><ul><li>æ‰§è¡Œæ“ä½œ</li><li>å·¦é”®ã€å³é”®å•å‡»ã€åŒå‡»</li><li>é¼ æ ‡æ‚¬åœåˆ°å…ƒç´ ã€åç§»å¤„</li><li>é•¿æŒ‰</li><li>æ‹–åŠ¨</li></ul><h1 id="Playwrightâ€“UIè‡ªåŠ¨åŒ–ç¥å™¨ã€åˆçª¥ã€‘"><a href="#Playwrightâ€“UIè‡ªåŠ¨åŒ–ç¥å™¨ã€åˆçª¥ã€‘" class="headerlink" title="Playwrightâ€“UIè‡ªåŠ¨åŒ–ç¥å™¨ã€åˆçª¥ã€‘"></a>Playwrightâ€“UIè‡ªåŠ¨åŒ–ç¥å™¨ã€åˆçª¥ã€‘</h1><h2 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h2><p>playwrightæ˜¯ç”±å¾®è½¯å¼€å‘çš„Web UIè‡ªåŠ¨åŒ–æµ‹è¯•å·¥å…·ï¼Œ æ”¯æŒçš„æµè§ˆå™¨åŒ…æ‹¬ï¼šChromium, Firefox and WebKitï¼Œæ”¯æŒçš„ç¼–ç è¯­è¨€åŒ…æ‹¬ï¼šNode.jsã€Pythonã€C# å’Œ Javaè¯­è¨€ã€‚</p><p>ç‰¹ç‚¹ï¼š</p><ul><li><p>ä¸€ã€æ”¯æŒæ‰€æœ‰ä¸»æµæµè§ˆå™¨å¹¶è·¨å¹³å°</p><ul><li>è·¨æµè§ˆå™¨ï¼šåŸºäºChromiumå†…æ ¸çš„Google Chrome å’Œ Microsoft Edgeæµè§ˆå™¨), WebKitå†…æ ¸çš„Apple Safari å’Œ Mozilla Firefoxæµè§ˆå™¨ï¼Œä¸æ”¯æŒIE11ã€‚</li><li>è·¨å¹³å°ï¼šWindowsã€Linux å’ŒmacOS</li><li>è·¨è¯­è¨€ã€‚ åœ¨ TypeScript, JavaScript, Python, .NET, Java ä¸­ä½¿ç”¨ Playwright API</li><li>å¯ç”¨äºæ¨¡æ‹Ÿç§»åŠ¨ç«¯WEBåº”ç”¨çš„æµ‹è¯•ï¼Œä¸æ”¯æŒåœ¨çœŸæœºä¸Šæµ‹è¯•</li><li>æ”¯æŒ<strong>æ— å¤´æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰</strong>å’Œæœ‰å¤´æ¨¡å¼â€”â€“å¼ºå¤§ä¹‹å¤„ï¼š<code>æ— å¤´</code></li></ul></li><li><p>äºŒã€å¿«é€Ÿå¯é çš„æ‰§è¡Œ</p><ul><li>è‡ªåŠ¨ç­‰å¾…å…ƒç´ </li><li>PlaywrightåŸºäºWebsocketåè®®ï¼Œå¯ä»¥æ¥å—æµè§ˆå™¨ï¼ˆæœåŠ¡ç«¯ï¼‰çš„ä¿¡å·</li><li>æµè§ˆå™¨ä¸Šä¸‹æ–‡å¹¶è¡Œï¼šå•ä¸ªæµè§ˆå™¨å®ä¾‹ä¸‹åˆ›å»ºå¤šä¸ªæµè§ˆå™¨ä¸Šä¸‹æ–‡ï¼Œæ¯ä¸ªæµè§ˆå™¨ä¸Šä¸‹æ–‡å¯ä»¥å¤„ç†å¤šä¸ªé¡µé¢ã€‚</li><li>æœ‰å¼¹æ€§çš„å…ƒç´ é€‰æ‹©ï¼šå¯ä»¥ä½¿ç”¨æ–‡æœ¬ã€å¯è®¿é—®æ ‡ç­¾é€‰æ‹©å…ƒç´ </li></ul></li><li><p>Playwrightä½¿ç”¨ Chrome DevTools åè®® ï¼ˆCDPï¼‰ ä¸ Chromium é€šä¿¡ã€‚å¯¹äºFirefoxå’ŒWebKitï¼ŒPlaywrightå®ç°äº†è‡ªå·±çš„åè®®ï¼Œç±»ä¼¼äºCDPã€‚ä¸€æ—¦è§¦å‘æµ‹è¯•ï¼Œclientç«¯ä»£ç å°†è¢«è½¬æ¢ä¸ºJSONæ ¼å¼ï¼Œç„¶åä½¿ç”¨websocket åè®®å‘é€åˆ°æœåŠ¡å™¨ã€‚palywrighté€šè¿‡å•ä¸ª websocket åè®®è¿æ¥ä¼ è¾¾æ‰€æœ‰è¯·æ±‚ï¼Œè¯¥è¿æ¥å°†ä¿æŒä¸å˜ï¼Œç›´åˆ°æ‰€æœ‰æµ‹è¯•æ‰§è¡Œå®Œæˆã€‚ç”±äºå‘½ä»¤æ˜¯åœ¨å•ä¸ªè¿æ¥ä¸Šå‘é€çš„ï¼Œå› æ­¤æµ‹è¯•å¤±è´¥æˆ–ä¸ç¨³å®šçš„å¯èƒ½æ€§è¾ƒå°ï¼Œå¹¶ä¸”å‘½ä»¤å¯ä»¥å¿«é€Ÿæ‰§è¡Œã€‚è¿™ç§æ¶æ„ä¸Seleniumç›¸åï¼ŒSeleniumä½¿ç”¨HTTPè¿æ¥åè®®ï¼Œå¹¶å°†æ¯ä¸ªå‘½ä»¤ï¼ˆå¦‚æµè§ˆå™¨æ‰“å¼€ï¼Œå•å‡»ï¼Œå‘é€å¯†é’¥æˆ–å…³é—­æµè§ˆå™¨ï¼‰ä½œä¸ºå•ç‹¬çš„HTTPè¯·æ±‚å‘é€ã€‚æ­¤å¤–ï¼Œåœ¨Seleniumä¸­ï¼ŒæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„è¿æ¥å°†åœ¨æ¯æ¬¡è¯·æ±‚åç»ˆæ­¢ï¼Œå¹¶ä¸ºä¸‹ä¸€ä¸ªè¯·æ±‚é‡æ–°å»ºç«‹ã€‚æœ€ååˆ’é‡ç‚¹ï¼š<code>è¿™å°±æ˜¯Playwrightæ¯”seleniumå¿«çš„åŸå› ï¼</code></p></li></ul><p>å¼ºé€‚åº”æ€§ â€¢ æµ‹è¯•ä¸å†å®¹æ˜“å¤±æ•ˆ<br>è‡ªåŠ¨ç­‰å¾…ï¼šPlaywright èƒ½å¤Ÿè‡ªåŠ¨ç­‰å¾…å…ƒç´ è¾¾åˆ°å¯æ“ä½œçš„çŠ¶æ€ï¼Œå¤–åŠ ä¸€ç³»åˆ—ä¸°å¯Œçš„å†…ç½®æ—¶é—´ã€‚ä¸ç”¨å†äººå·¥å®šä¹‰è¶…æ—¶â€”-è¿™æ˜¯æµ‹è¯•å®¹æ˜“å¤±è´¥çš„ä¸»è¦åŸå› ã€‚</p><p>Webæœ‰é™çš„æ–­è¨€ã€‚Playwright æ–­è¨€ä¸“é—¨ä¸ºåŠ¨æ€åŠ è½½çš„webåº”ç”¨è®¾è®¡ã€‚èƒ½å¤Ÿåœ¨æ»¡è¶³éœ€è¦çš„æ¡ä»¶å‰è‡ªåŠ¨é‡è¯•ã€‚</p><p>å¯è¿½è¸ªã€‚é€šè¿‡é…ç½®é‡è¯•ç­–ç•¥ï¼Œé‡‡ç”¨æ•æ‰æ‰§è¡Œè½¨è¿¹ã€è§†é¢‘ã€æˆªå›¾æ¥è§£å†³æµ‹è¯•å®¹æ˜“å¤±æ•ˆçš„é—®é¢˜ã€‚</p><p>ä¸ç”¨å†æƒè¡¡å–èˆã€ä¸å†æœ‰é™åˆ¶ã€‚</p><p>ä¸€åˆ‡å¹¶è¡Œã€‚è·¨è¶Šå¤šä¸ªtabsã€å¤šä¸ªoriginså’Œå¤šä¸ªusersçš„æµ‹è¯•åœºæ™¯ã€‚åœ¨ä¸€ä¸ªæµ‹è¯•ä¸­èƒ½å¤Ÿä¸ºä¸åŒçš„ç”¨æˆ·åˆ›å»ºå…·æœ‰ä¸åŒä¸Šä¸‹æ–‡çš„åœºæ™¯ï¼Œå¹¶èƒ½åœ¨ä½ çš„æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œ</p><p>å¯ä¿¡äº‹ä»¶ï¼šå…ƒç´ æ‚¬åœï¼ˆhoverï¼‰ã€åŠ¨æ€æ§ä»¶çš„äº¤äº’ã€ç”Ÿäº§å¯ä¿¡æ—¶é—´ï¼ŒPlaywright ä½¿ç”¨ä¸çœŸå®ç”¨æˆ·ä¸€è‡´çš„è¾“å…¥æ–¹å¼ï¼ˆpipelineï¼‰ã€‚</p><p><strong>æµ‹è¯• framesï¼Œç©¿é€ Shadow</strong> <strong>DOM****ã€‚</strong> Playwright çš„é€‰æ‹©å™¨èƒ½å¤Ÿç©¿é€ shadowDOM å’Œå…è®¸æ— ç¼è¾“å…¥ frameã€‚</p><p><strong>ä¸€æ¬¡ç™»å½•ã€‚</strong> ä¿å­˜ä¸Šä¸‹æ–‡çš„èº«ä»½éªŒè¯çŠ¶æ€å¹¶åœ¨æ‰€æœ‰æµ‹è¯•ä¸­é‡ç”¨å®ƒã€‚è¿™ç»•è¿‡äº†æ¯ä¸ªæµ‹è¯•ä¸­çš„é‡å¤ç™»å½•æ“ä½œï¼Œä½†æä¾›äº†ç‹¬ç«‹æµ‹è¯•çš„å®Œå…¨éš”ç¦»ã€‚</p><p>å¼ºå¤§çš„å·¥å…·</p><p><strong>Codegen ã€‚</strong> é€šè¿‡è®°å½•æ‚¨çš„æ“ä½œæ¥ç”Ÿæˆæµ‹è¯•ã€‚å°†å®ƒä»¬ä¿å­˜ä¸ºå„ç§è¯­è¨€ã€‚</p><h2 id="å®æ“"><a href="#å®æ“" class="headerlink" title="å®æ“"></a>å®æ“</h2><h3 id="æ‰“å¼€æµè§ˆå™¨ç½‘é¡µ"><a href="#æ‰“å¼€æµè§ˆå™¨ç½‘é¡µ" class="headerlink" title="æ‰“å¼€æµè§ˆå™¨ç½‘é¡µ"></a>æ‰“å¼€æµè§ˆå™¨ç½‘é¡µ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> sync_playwright<br><span class="hljs-keyword">with</span> sync_playwright() <span class="hljs-keyword">as</span> p:<br>    browser = p.chromium.launch(channel=<span class="hljs-string">&quot;chrome&quot;</span>, headless=<span class="hljs-literal">False</span>) <span class="hljs-comment"># headlessæ— å¤´</span><br>    page = browser.new_page()<br>    page.goto(<span class="hljs-string">&quot;http://www.baidu.com&quot;</span>) <span class="hljs-comment"># gotoæ‰“å¼€ç½‘é¡µ</span><br>    <span class="hljs-built_in">print</span>(page.title()) <span class="hljs-comment"># æ‰“å°title</span><br>    browser.close()<br></code></pre></td></tr></table></figure><h3 id="è„šæœ¬å½•åˆ¶ï¼š"><a href="#è„šæœ¬å½•åˆ¶ï¼š" class="headerlink" title="è„šæœ¬å½•åˆ¶ï¼š"></a>è„šæœ¬å½•åˆ¶ï¼š</h3><p>ä½¿ç”¨å‘½ä»¤</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">playwright codegen --target python -o baidu_test.py -b chromium https://www.baidu.com/<br></code></pre></td></tr></table></figure><p>å½•åˆ¶ç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> playwright.sync_api <span class="hljs-keyword">import</span> Playwright, sync_playwright, expect<br><br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">run</span>(<span class="hljs-params">playwright: Playwright</span>) -&gt; <span class="hljs-literal">None</span>:<br>    browser = playwright.chromium.launch(headless=<span class="hljs-literal">False</span>)<br>    context = browser.new_context()<br>    page = context.new_page() <span class="hljs-comment"># é¡µé¢</span><br>    page.goto(<span class="hljs-string">&quot;https://www.baidu.com/&quot;</span>) <span class="hljs-comment"># ç½‘å€</span><br>    page.locator(<span class="hljs-string">&quot;#kw&quot;</span>).click()  <span class="hljs-comment"># æœç´¢æ¡† ç‚¹å‡» click</span><br>    page.locator(<span class="hljs-string">&quot;#kw&quot;</span>).fill(<span class="hljs-string">&quot;ä¸­å›½å¥½å£°éŸ³&quot;</span>) <span class="hljs-comment"># æœç´¢æ¡†è¾“å…¥ fill</span><br>    page.get_by_role(<span class="hljs-string">&quot;button&quot;</span>, name=<span class="hljs-string">&quot;ç™¾åº¦ä¸€ä¸‹&quot;</span>).click() <span class="hljs-comment"># è¾“å…¥å®Œä¹‹åç‚¹å‡»æœç´¢</span><br>    <span class="hljs-keyword">with</span> page.expect_popup() <span class="hljs-keyword">as</span> page1_info:<br>        page.get_by_role(<span class="hljs-string">&quot;link&quot;</span>, name=<span class="hljs-string">&quot;ä¸­å›½å¥½å£°éŸ³ - ç™¾åº¦ç™¾ç§‘&quot;</span>).click() <span class="hljs-comment"># ç‚¹è¿›ç™¾ç§‘é¡µé¢</span><br>    page1 = page1_info.value <span class="hljs-comment"># æ–°çš„é¡µé¢æ¥äº†</span><br>    <span class="hljs-keyword">with</span> page1.expect_popup() <span class="hljs-keyword">as</span> page2_info: <span class="hljs-comment"># æ‰“å¼€ æ–°çš„é¡µé¢äº†</span><br>        page1.locator(<span class="hljs-string">&quot;div&quot;</span>).<span class="hljs-built_in">filter</span>(has_text=re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r&quot;^è–›ä¹‹è°¦$&quot;</span>)).get_by_role(<span class="hljs-string">&quot;link&quot;</span>).click()  <span class="hljs-comment"># åœ¨æ–°çš„é¡µé¢å»ç‚¹å‡»äº†</span><br>    page2 = page2_info.value   <span class="hljs-comment"># ç¬¬ä¸‰ä¸ªé¡µé¢æ¥äº†ã€‚</span><br>    page2.close() <span class="hljs-comment"># å…³é—­é¡µé¢3 </span><br>    page1.close() <span class="hljs-comment"># å…³é—­é¡µé¢2 </span><br>    page.close() <span class="hljs-comment"># å…³é—­é¡µé¢1 </span><br><br>    <span class="hljs-comment"># ---------------------</span><br>    context.close() <span class="hljs-comment"># å…³é—­ç¨‹åº</span><br>    browser.close() <span class="hljs-comment"># å…³é—­æµè§ˆå™¨</span><br><br><br><span class="hljs-keyword">with</span> sync_playwright() <span class="hljs-keyword">as</span> playwright:<br>    run(playwright)<br><br></code></pre></td></tr></table></figure><h3 id="è¯†åˆ«å…ƒç´ "><a href="#è¯†åˆ«å…ƒç´ " class="headerlink" title="è¯†åˆ«å…ƒç´ "></a>è¯†åˆ«å…ƒç´ </h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python">page.get_by_role() <span class="hljs-comment"># é€šè¿‡æ˜¾å¼å’Œéšå¼å¯è®¿é—®æ€§å±æ€§å®šä½ã€‚</span><br><br>page.get_by_text() <span class="hljs-comment"># æŒ‰æ–‡æœ¬å†…å®¹å®šä½ã€‚</span><br><br>page.get_by_label() <span class="hljs-comment"># é€šè¿‡å…³è”æ ‡ç­¾çš„æ–‡æœ¬æŸ¥æ‰¾è¡¨å•æ§ä»¶ã€‚</span><br><br>page.get_by_placeholder() <span class="hljs-comment"># å…¶æ–‡æœ¬æ›¿ä»£å“å®šä½å…ƒç´ ï¼Œé€šå¸¸æ˜¯å›¾åƒã€‚</span><br><br>page.get_by_title() <span class="hljs-comment"># é€šè¿‡æ ‡é¢˜å±æ€§å®šä½å…ƒç´ ã€‚</span><br><br>page.get_by_test_id() <span class="hljs-comment"># æ ¹æ®å…¶data-testidå±æ€§å®šä½å…ƒç´ ï¼ˆå¯ä»¥é…ç½®å…¶ä»–å±æ€§ï¼‰ã€‚</span><br><br><br><br></code></pre></td></tr></table></figure><p>playwrighté™¤äº†ä¸Šè¿°å®šä½æ–¹å¼ï¼Œè¿˜æ”¯æŒseleniumçš„8ç§byå…ƒç´ å®šä½ï¼Œidã€xpathã€cssç­‰ç­‰ï¼Œå¦å¤–è¿˜æœ‰W3Cæ ‡å‡†è§„å®šçš„webDriveråè®®ä¸º5ç§å®šä½æ–¹å¼</p><p>CSSã€Link textã€Partial link textã€Tag nameã€XPath</p><p>playwrightæŠŠè¿™äº›å®šä½å½’ç±»æˆ3ç§ï¼Œåˆ†åˆ«æ˜¯ï¼šcssã€xpathã€text</p><h3 id="åˆ¤æ–­å…ƒç´ çŠ¶æ€"><a href="#åˆ¤æ–­å…ƒç´ çŠ¶æ€" class="headerlink" title="åˆ¤æ–­å…ƒç´ çŠ¶æ€"></a>åˆ¤æ–­å…ƒç´ çŠ¶æ€</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">is_checked<br><br>is_disabled<br><br>is_editable<br><br>is_enabled<br><br>is_hidden<br><br>is_visible<br></code></pre></td></tr></table></figure><h3 id="å…ƒç´ æ“æ§"><a href="#å…ƒç´ æ“æ§" class="headerlink" title="å…ƒç´ æ“æ§"></a>å…ƒç´ æ“æ§</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python">å†™ç›¸å…³æ“ä½œï¼šclearã€fill<br><br>ç‚¹å‡»ï¼šclickã€dbclick<br><br>ä¸‹æ‹‰é€‰æ‹©æ¡†ï¼šselect_option<br><br>æ–‡ä»¶ä¸Šä¼ ï¼šset_input_files<br><br>é¼ æ ‡æ‹–åŠ¨ï¼šdownã€upã€moveã€wheel<br><br>è§¦æ‘¸å±å¹•ï¼štap<br><br>é”®ç›˜æŒ‰é”®ï¼špress<br><br>æˆªå±ï¼šscreenshot<br><br>é¡µé¢åˆ‡æ¢expect_popup<br><br>æ‰§è¡Œjsï¼ševaluate<br><br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç¬”è®°</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€pythonã€‘httprunneræ¥å£è‡ªåŠ¨åŒ–æ¡†æ¶</title>
    <link href="/2023/12/24/httprunner%E6%8E%A5%E5%8F%A3%E8%87%AA%E5%8A%A8%E5%8C%96%E6%A1%86%E6%9E%B6/"/>
    <url>/2023/12/24/httprunner%E6%8E%A5%E5%8F%A3%E8%87%AA%E5%8A%A8%E5%8C%96%E6%A1%86%E6%9E%B6/</url>
    
    <content type="html"><![CDATA[<h1 id="httprunneræ¥å£è‡ªåŠ¨åŒ–æ¡†æ¶"><a href="#httprunneræ¥å£è‡ªåŠ¨åŒ–æ¡†æ¶" class="headerlink" title="httprunneræ¥å£è‡ªåŠ¨åŒ–æ¡†æ¶"></a>httprunneræ¥å£è‡ªåŠ¨åŒ–æ¡†æ¶</h1><h1 id="ä¸€ã€ä¸ºä»€ä¹ˆé€‰æ‹©httprunnerï¼Ÿ"><a href="#ä¸€ã€ä¸ºä»€ä¹ˆé€‰æ‹©httprunnerï¼Ÿ" class="headerlink" title="ä¸€ã€ä¸ºä»€ä¹ˆé€‰æ‹©httprunnerï¼Ÿ"></a>ä¸€ã€ä¸ºä»€ä¹ˆé€‰æ‹©httprunnerï¼Ÿ</h1><ul><li>HttpRunneræ˜¯ä¸€ä¸ªå¼€æºçš„ API æµ‹è¯•å·¥å…·ç¯å¢ƒæ­å»ºï¼Œç›¸æ¯”äºå…¶å®ƒ API æµ‹è¯•å·¥å…·ï¼ŒHttpRunner æœ€å¤§çš„ä¸åŒåœ¨äºè®¾è®¡ç†å¿µï¼š</li><li>çº¦å®šå¤§äºé…ç½®ï¼šæµ‹è¯•ç”¨ä¾‹æ˜¯æ ‡å‡†ç»“æ„åŒ–çš„ï¼Œæ ¼å¼ç»Ÿä¸€ï¼Œæ–¹ä¾¿åä½œå’Œç»´æŠ¤ï¼›</li><li>æ ‡å‡†å¼€æ”¾ï¼šåŸºäºå¼€æ”¾çš„æ ‡å‡†ï¼Œæ”¯æŒHAR&#x2F;Postman&#x2F;Swaggerç­‰å·¥å…·å¯¹æ¥ï¼Œè½»æ¾å®ç°ç”¨ä¾‹ç”Ÿæˆå’Œè½¬æ¢ï¼›</li><li>ä¸€æ¬¡æŠ•å…¥å¤šç»´å¤ç”¨ï¼šä¸€å¥—è„šæœ¬å¯åŒæ—¶æ”¯æŒæ¥å£è‡ªåŠ¨åŒ–æµ‹è¯•ã€æ€§èƒ½æµ‹è¯•ï¼›</li><li>è¿½æ±‚ä¸é‡å¤é€ è½®å­ï¼Œè¿½æ±‚æŠ•å…¥äº§å‡ºæ¯”ï¼›</li><li>Httprunnerå’Œå…¶ä»–å¼€æºæ¡†æ¶ç›¸æ¯”ï¼Œæˆ‘ä»¬åªéœ€åœ¨yamlæ–‡ä»¶ç»´æŠ¤æµ‹è¯•ç”¨ä¾‹å³å¯ï¼Œä¸éœ€è¦ä»£ç è¦æ±‚ï¼Œä½†æ˜¯éœ€è¦ä¸¥æ ¼éµå¾ªyanlæ ¼å¼ç¼–å†™ï¼Œå¦åˆ™åœ¨åç»­ä¸å¥½æ’æŸ¥é”™è¯¯ï¼Œè¿™ä¹Ÿæ˜¯httprunnerçš„ä¸€ä¸ªç¼ºç‚¹ï¼›</li><li>ç›®å‰å¸‚é¢ä¸Šæ¥å£å·¥å…·å¤šï¼Œå­¦ä¹ æˆæœ¬é«˜ï¼Œå›¢é˜Ÿåä½œè¾ƒå›°éš¾ï¼Œå¯¹è¯­è¨€èƒ½åŠ›æœ‰ä¸€å®šè¦æ±‚ï¼Œé—¨æ§›è¾ƒé«˜ï¼›</li></ul><h1 id="äºŒã€ç¯å¢ƒæ­å»ºï¼ˆPythonå®‰è£…ï¼‰"><a href="#äºŒã€ç¯å¢ƒæ­å»ºï¼ˆPythonå®‰è£…ï¼‰" class="headerlink" title="äºŒã€ç¯å¢ƒæ­å»ºï¼ˆPythonå®‰è£…ï¼‰"></a>äºŒã€ç¯å¢ƒæ­å»ºï¼ˆPythonå®‰è£…ï¼‰</h1><h2 id="1ã€pythonç‰ˆæœ¬ï¼š2-7-3-7åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œå»ºè®®3-7åŠä»¥ä¸Šç‰ˆæœ¬"><a href="#1ã€pythonç‰ˆæœ¬ï¼š2-7-3-7åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œå»ºè®®3-7åŠä»¥ä¸Šç‰ˆæœ¬" class="headerlink" title="1ã€pythonç‰ˆæœ¬ï¼š2.7&#x2F;3.7åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œå»ºè®®3.7åŠä»¥ä¸Šç‰ˆæœ¬"></a>1ã€pythonç‰ˆæœ¬ï¼š2.7&#x2F;3.7åŠä»¥ä¸Šç‰ˆæœ¬ï¼Œå»ºè®®3.7åŠä»¥ä¸Šç‰ˆæœ¬</h2><ul><li>ä¸‹è½½åœ°å€ï¼š<a href="https://www.python.org/downloads/">https://www.python.org/downloads/</a></li></ul><h2 id="2ã€éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ"><a href="#2ã€éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ" class="headerlink" title="2ã€éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ"></a>2ã€éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸ</h2><ul><li>æ‰“å¼€cmdå‘½ä»¤è¡Œ è¾“å…¥pythonï¼Œå¦‚æœèƒ½è¿›å…¥pythonå‘½ä»¤æ¨¡å¼å°±è¯æ˜æˆåŠŸäº†</li><li></li></ul><p><img src="/img/httprunner/Untitled.png" alt="Untitled"></p><h2 id="3ã€å®‰è£…httprunnerç¬¬ä¸‰æ–¹åº“"><a href="#3ã€å®‰è£…httprunnerç¬¬ä¸‰æ–¹åº“" class="headerlink" title="3ã€å®‰è£…httprunnerç¬¬ä¸‰æ–¹åº“"></a>3ã€å®‰è£…httprunnerç¬¬ä¸‰æ–¹åº“</h2><p>pip install httprunner&#x3D;&#x3D;2.5.7 å¦‚æœå®˜ç½‘æ— æ³•ä¸‹è½½å°±åŠ å›½å†…é•œåƒ -i <a href="https://pypi.doubanio.com/simple">https://pypi.doubanio.com/simple</a></p><h2 id="4ã€æŸ¥çœ‹å‘½ä»¤è¡ŒæŒ‡ä»¤ï¼ˆæŒæ¡å‡ ä¸ªå¸¸ç”¨å³å¯ï¼‰"><a href="#4ã€æŸ¥çœ‹å‘½ä»¤è¡ŒæŒ‡ä»¤ï¼ˆæŒæ¡å‡ ä¸ªå¸¸ç”¨å³å¯ï¼‰" class="headerlink" title="4ã€æŸ¥çœ‹å‘½ä»¤è¡ŒæŒ‡ä»¤ï¼ˆæŒæ¡å‡ ä¸ªå¸¸ç”¨å³å¯ï¼‰"></a>4ã€æŸ¥çœ‹å‘½ä»¤è¡ŒæŒ‡ä»¤ï¼ˆæŒæ¡å‡ ä¸ªå¸¸ç”¨å³å¯ï¼‰</h2><ul><li>åˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œå¯ä»¥åœ¨å‘½ä»¤è¡ŒæŸ¥çœ‹httprunnerå¸®åŠ©</li><li>httprunner -h æˆ–è€… hrun -h</li></ul><p><img src="/img/httprunner/Untitled%201.png" alt="Untitled"></p><p><img src="/img/httprunner/Untitled%202.png" alt="Untitled"></p><h2 id="5ã€åˆ›å»ºè„šæ‰‹æ¶"><a href="#5ã€åˆ›å»ºè„šæ‰‹æ¶" class="headerlink" title="5ã€åˆ›å»ºè„šæ‰‹æ¶"></a>5ã€åˆ›å»ºè„šæ‰‹æ¶</h2><ul><li>åˆ›å»ºé¡¹ç›®ï¼šhrun â€“startproject demo</li></ul><p><img src="/img/httprunner/Untitled%203.png" alt="Untitled"></p><h2 id="6ã€å®‰è£…ç¬¬ä¸‰æ–¹ä¾èµ–ï¼ˆï¼‰"><a href="#6ã€å®‰è£…ç¬¬ä¸‰æ–¹ä¾èµ–ï¼ˆï¼‰" class="headerlink" title="6ã€å®‰è£…ç¬¬ä¸‰æ–¹ä¾èµ–ï¼ˆï¼‰"></a>6ã€å®‰è£…ç¬¬ä¸‰æ–¹ä¾èµ–ï¼ˆï¼‰</h2><ul><li>å¯ä»¥åœ¨æ ¹ç›®å½•ä¸‹å»ºä¸ªrequirements.txtæ–‡ä»¶ï¼Œéœ€è¦å®‰è£…çš„pythonä¾èµ–éƒ½åœ¨è¿™ä¸ªæ–‡ä»¶é‡Œé¢ï¼Œè¿›å…¥åˆ°ç›®å½•ä¸‹ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…ï¼š</li></ul><p>pip install â€“r requirements2.txt</p><h1 id="ä¸‰ã€æ¡†æ¶ç»“æ„"><a href="#ä¸‰ã€æ¡†æ¶ç»“æ„" class="headerlink" title="ä¸‰ã€æ¡†æ¶ç»“æ„"></a>ä¸‰ã€æ¡†æ¶ç»“æ„</h1><h2 id="1ã€ç›®å½•ç»“æ„"><a href="#1ã€ç›®å½•ç»“æ„" class="headerlink" title="1ã€ç›®å½•ç»“æ„"></a>1ã€ç›®å½•ç»“æ„</h2><p><img src="/img/httprunner/Untitled%204.png" alt="Untitled"></p><h3 id="åˆ†å±‚æ€æƒ³ï¼š"><a href="#åˆ†å±‚æ€æƒ³ï¼š" class="headerlink" title="åˆ†å±‚æ€æƒ³ï¼š"></a>åˆ†å±‚æ€æƒ³ï¼š</h3><ul><li>apiå®šä¹‰å±‚ï¼šæœ€åº•ä¸‹çš„ä¸€å±‚æ˜¯apiçš„å®šä¹‰å±‚ï¼Œæœ€åº•</li><li>testcaseå±‚ï¼šæµ‹è¯•ç”¨ä¾‹å±‚ï¼Œè°ƒç”¨å®šä¹‰å±‚çš„å†…å®¹ï¼Œä¸­é—´</li><li>testsuiteï¼šæµ‹è¯•å¥—ä»¶å±‚ï¼ŒæŠŠç”¨ä¾‹è£…èµ·æ¥ï¼Œæœ€ä¸Š</li><li></li></ul><p><img src="/img/httprunner/Untitled%205.png" alt="Untitled"></p><h3 id="apiç›®å½•ï¼šå­˜æ”¾æè¿°apiä¿¡æ¯çš„yamlæ–‡ä»¶"><a href="#apiç›®å½•ï¼šå­˜æ”¾æè¿°apiä¿¡æ¯çš„yamlæ–‡ä»¶" class="headerlink" title="apiç›®å½•ï¼šå­˜æ”¾æè¿°apiä¿¡æ¯çš„yamlæ–‡ä»¶"></a>apiç›®å½•ï¼šå­˜æ”¾æè¿°apiä¿¡æ¯çš„yamlæ–‡ä»¶</h3><ul><li>ç‰¹åˆ«æ³¨æ„ï¼šymlæ–‡ä»¶éœ€éµå¾ªä¸¥æ ¼çš„ç¼©è¿›ï¼Œç¼©è¿›å¤šå°‘æ ¼æ— æ‰€è°“ï¼Œåªè¦ä¿è¯åŒä¸€å±‚çº§çš„keyå¯¹é½å³å¯</li></ul><p><img src="/img/httprunner/Untitled%206.png" alt="Untitled"></p><h3 id="å­—æ®µè§£é‡Šï¼š"><a href="#å­—æ®µè§£é‡Šï¼š" class="headerlink" title="å­—æ®µè§£é‡Šï¼š"></a>å­—æ®µè§£é‡Šï¼š</h3><ul><li>nameï¼šå¯¹apiè¿›è¡Œæè¿°</li><li>variablesï¼šæŠŠå‚æ•°ä½œä¸ºå˜é‡ä»å¤–éƒ¨ä¼ ç»™apiï¼Œå¯ä»¥å°†å˜é‡çš„å‚æ•°éƒ½å®šä¹‰åœ¨variables</li><li>requestï¼šè¿™ä¸ªå­—æ®µä¸‹æ”¾çš„éƒ½æ˜¯apiçš„åŸºæœ¬ä¿¡æ¯å¦‚<ul><li>url(è¯·æ±‚åœ°å€)ï¼Œ</li><li>method(è¯·æ±‚æ–¹æ³•)ï¼Œ</li><li>headers(è¯·æ±‚å¤´)ï¼Œ</li><li>data&#x2F;params&#x2F;json&#x2F;file (è¯·æ±‚å‚æ•°)</li></ul></li></ul><h3 id="ä¸€èˆ¬æ¥å£æœ‰3ç§æ–¹å¼çš„è¯·æ±‚å‚æ•°"><a href="#ä¸€èˆ¬æ¥å£æœ‰3ç§æ–¹å¼çš„è¯·æ±‚å‚æ•°" class="headerlink" title="ä¸€èˆ¬æ¥å£æœ‰3ç§æ–¹å¼çš„è¯·æ±‚å‚æ•°"></a>ä¸€èˆ¬æ¥å£æœ‰3ç§æ–¹å¼çš„è¯·æ±‚å‚æ•°</h3><ul><li>1.paramså­—æ®µä¼ å‚ï¼š<ul><li>ä»¥keyï¼Œvalueé”®å€¼å¯¹æ–¹å¼æ”¾åœ¨urlåé¢çš„å‚æ•°ç”¨paramså­—æ®µå»å®šä¹‰</li></ul></li><li>2.jsonå­—æ®µä¼ å‚ï¼š<ul><li>æ”¾åœ¨bodyä»¥jsonæ ¼å¼å‚æ•°çš„ç”¨jsonå­—æ®µå»å®šä¹‰</li></ul></li><li>3.c.dataå­—æ®µä¼ å‚ï¼š<ul><li>æ”¾åœ¨bodyéjsonæ ¼å¼çš„å‚æ•°ç”¨dataå­—æ®µå»å®šä¹‰ï¼Œå¦‚headersä¸­</li></ul></li></ul><p>content-type&#x3D;application&#x2F;x-www-form-urlencoded</p><h3 id="å‚æ•°å¼•ç”¨ï¼šå¼•ç”¨ç¬¦ï¼š"><a href="#å‚æ•°å¼•ç”¨ï¼šå¼•ç”¨ç¬¦ï¼š" class="headerlink" title="å‚æ•°å¼•ç”¨ï¼šå¼•ç”¨ç¬¦ï¼š$"></a>å‚æ•°å¼•ç”¨ï¼šå¼•ç”¨ç¬¦ï¼š$</h3><p><img src="/img/httprunner/Untitled%207.png" alt="Untitled"></p><ul><li>variablesï¼šapiçš„ymalæ–‡ä»¶ä¸‹ï¼šå¦‚æœæˆ‘ä»¬è¦æŠŠå‚æ•°ä½œä¸ºå˜é‡ä»å¤–éƒ¨ä¼ ç»™apiï¼Œé‚£å°±æŠŠä½œä¸ºå˜é‡çš„å‚æ•°éƒ½å®šä¹‰åœ¨variableså­—æ®µä¸‹ï¼Œå¦‚ä¸‹å›¾ä¸­çš„loginParaå°±å¯ä»¥è¢«å…¶å®ƒä»»ä½•åœ°æ–¹å¼•ç”¨ã€‚</li></ul><p><img src="/img/httprunner/Untitled%208.png" alt="Untitled"></p><ul><li>validateï¼šæ ¡éªŒå­—æ®µï¼Œéœ€è¦æ ¡éªŒçš„æ•°æ®éƒ½å†™åœ¨è¿™ä¸ªå­—æ®µä¸‹</li></ul><p><img src="/img/httprunner/Untitled%209.png" alt="Untitled"></p><h3 id="1-2-testcasesç›®å½•ï¼šå­˜æ”¾æè¿°æµ‹è¯•ç”¨ä¾‹çš„yamlæ–‡ä»¶"><a href="#1-2-testcasesç›®å½•ï¼šå­˜æ”¾æè¿°æµ‹è¯•ç”¨ä¾‹çš„yamlæ–‡ä»¶" class="headerlink" title="1.2 testcasesç›®å½•ï¼šå­˜æ”¾æè¿°æµ‹è¯•ç”¨ä¾‹çš„yamlæ–‡ä»¶"></a>1.2 testcasesç›®å½•ï¼šå­˜æ”¾æè¿°æµ‹è¯•ç”¨ä¾‹çš„yamlæ–‡ä»¶</h3><ul><li>config:æŒ‡è¿™æ¡ç”¨ä¾‹çš„é…ç½®ä¿¡æ¯ï¼Œç”¨ä¾‹çš„ä¸€äº›é…ç½®ä¿¡æ¯å¯ä»¥å†™åœ¨è¿™ä¸ªå­—æ®µä¸‹é¢ï¼Œæ¯”å¦‚ï¼š<ul><li>name(å¿…é¡»çš„)ï¼šã€€è¿™æ¡ç”¨ä¾‹çš„åå­—ï¼Œ</li><li>base_url(å¯é€‰æ‹©çš„)ï¼š æ¥å£çš„hoståœ°å€ï¼Œä¸€èˆ¬å†™åŸŸå</li><li>variables(å¯é€‰æ‹©çš„)ï¼š è¿™æ¡ç”¨ä¾‹çš„ä¸€äº›å˜é‡ï¼Œä¿å­˜çš„å˜é‡ï¼Œå¯ä»¥è¢«ä¸‹é¢å¼•ç”¨</li><li>verify(å¯é€‰ï¼Œä½†é»˜è®¤false)ï¼šæŒ‡å®šæ˜¯å¦éªŒè¯æœåŠ¡å™¨çš„TLSè¯ä¹¦ã€‚å¦‚æœæƒ³è¦è®°å½•testcaseä¸­çš„httpæ•°æ®ç‰¹åˆ«æœ‰ç”¨ã€‚å¦‚æœä¸è®¾ç½®æˆ–è€…è®¾ç½®ä¸ºtrueåˆ™ä¼šäº§ç”ŸSSLErroré”™è¯¯ã€‚</li><li>export(å¯é€‰æ‹©çš„ï¼Œå¿…é¡»ä¼š)ï¼šæå–testcaseçš„sessionå˜é‡ã€‚æµ‹è¯•ç”¨ä¾‹æ˜¯ä¸ºé»‘ç›’ï¼Œconfigä¸­çš„çš„variablesè§†ä¸ºè¾“å…¥ï¼Œexportä¸ºè¾“å‡ºã€‚ç‰¹åˆ«æ˜¯ï¼Œå½“è¯¥testcaseä¸­çš„æŸä¸ªè¾“å‡ºä½œä¸ºä¸‹ä¸€ä¸ªtestcaseä¸­çš„è¾“å…¥çš„æ—¶å€™ç‰¹åˆ«æœ‰ç”¨ã€‚å‚æ•°ä¼ é€’ç”¨çš„ï¼Œ</li><li>output(å¯é€‰æ‹©çš„)ï¼šä¸ºäº†æŠŠå˜é‡æš´éœ²å‡ºæ¥ï¼Œæ‰“å°æ—¥å¿—æ—¶çœ‹çš„æ›´æ¸…æ¥šï¼ˆæ¯”å¦‚è¯´ä½ æå–äº†token,å¯ä»¥æ‰“å°ä¸€ä¸‹è¿™ä¸ªtokençœ‹çœ‹è‡ªå·±æœ‰æ²¡æœ‰æå–æˆåŠŸï¼‰</li></ul></li></ul><h3 id="teststeps-ï¼šæŒ‡ç”¨ä¾‹ä¸­çš„æ­¥éª¤ï¼Œæ¯ä¸€æ­¥å°±æ˜¯è°ƒç”¨ä¸€ä¸ªapiï¼Œtestä¸‹é¢é…ç½®çš„å­—æ®µå°±æ˜¯è¿™ä¸ªæ­¥éª¤ä¸­æ¶‰åŠçš„å­—æ®µï¼Œæ¯”å¦‚ï¼š"><a href="#teststeps-ï¼šæŒ‡ç”¨ä¾‹ä¸­çš„æ­¥éª¤ï¼Œæ¯ä¸€æ­¥å°±æ˜¯è°ƒç”¨ä¸€ä¸ªapiï¼Œtestä¸‹é¢é…ç½®çš„å­—æ®µå°±æ˜¯è¿™ä¸ªæ­¥éª¤ä¸­æ¶‰åŠçš„å­—æ®µï¼Œæ¯”å¦‚ï¼š" class="headerlink" title="teststeps:ï¼šæŒ‡ç”¨ä¾‹ä¸­çš„æ­¥éª¤ï¼Œæ¯ä¸€æ­¥å°±æ˜¯è°ƒç”¨ä¸€ä¸ªapiï¼Œtestä¸‹é¢é…ç½®çš„å­—æ®µå°±æ˜¯è¿™ä¸ªæ­¥éª¤ä¸­æ¶‰åŠçš„å­—æ®µï¼Œæ¯”å¦‚ï¼š"></a>teststeps:ï¼šæŒ‡ç”¨ä¾‹ä¸­çš„æ­¥éª¤ï¼Œæ¯ä¸€æ­¥å°±æ˜¯è°ƒç”¨ä¸€ä¸ªapiï¼Œtestä¸‹é¢é…ç½®çš„å­—æ®µå°±æ˜¯è¿™ä¸ªæ­¥éª¤ä¸­æ¶‰åŠçš„å­—æ®µï¼Œæ¯”å¦‚ï¼š</h3><ul><li><p>nameï¼šæ­¥éª¤æè¿°</p></li><li><p>apiï¼š æŒ‡å®šè°ƒç”¨çš„apiè·¯å¾„æ–‡ä»¶ã€‚åŸºäºæ ¹ç›®å½•çš„ç›¸å¯¹è·¯å¾„</p></li><li><p>testcaseï¼š æŒ‡å®štestcaseçš„è·¯å¾„æ–‡ä»¶</p></li><li><p>extractï¼š æå–å“åº”ä¸­çš„å­—æ®µï¼ˆæ¯”å¦‚è¿™ä¸ªæ¥å£è¿”å›ä¸­çš„æŸä¸ªå­—æ®µä½œä¸ºä¸‹ä¸€ä¸ªæ¥å£çš„å‚æ•°ï¼‰ï¼Œå¯ä»¥æå–çš„å†…å®¹åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p><ul><li>atus_codeã€cookiesã€elapsedï¼ˆå“åº”æ—¶é—´ï¼‰ã€headersã€contentã€ textã€jsonã€encodingã€okã€ reasonã€url</li></ul></li><li><p>variablesï¼šå¦‚æœè¦æŠŠå‚æ•°ä½œä¸ºå˜é‡ä»å¤–éƒ¨ä¼ ç»™apiï¼Œé‚£å°±æŠŠä½œä¸ºå˜é‡çš„ å‚æ•°éƒ½å®šä¹‰åœ¨variableså­—æ®µä¸‹ï¼Œè®¾ç½®å˜é‡ä¾›ä¸‹é¢ç”¨</p><ul><li><h2 id="å¼•ç”¨debugtalké‡Œé¢çš„æ•°æ®åº“æŸ¥è¯¢æ–¹æ³•æ—¶ï¼Œè¦åœ¨è¿™é‡Œå®šä¹‰ä¸€ä¸ªå­—æ®µï¼Œ-å…ˆæŠŠsqlè¯­å¥å®šä¹‰æˆä¸€ä¸ªå­—æ®µï¼Œç„¶åæŠŠsqlè¯­å¥å¼•ç”¨åˆ°æ–¹æ³•é‡Œé¢å»ï¼Œå¦‚ä¸‹ï¼š-å‚æ•°å¼•ç”¨-ENV-STATIONNAME-çš„æ—¶å€™ï¼Œè¦åœ¨variablesä¸‹é¢å…ˆå®šä¹‰å†å¼•ç”¨"><a href="#å¼•ç”¨debugtalké‡Œé¢çš„æ•°æ®åº“æŸ¥è¯¢æ–¹æ³•æ—¶ï¼Œè¦åœ¨è¿™é‡Œå®šä¹‰ä¸€ä¸ªå­—æ®µï¼Œ-å…ˆæŠŠsqlè¯­å¥å®šä¹‰æˆä¸€ä¸ªå­—æ®µï¼Œç„¶åæŠŠsqlè¯­å¥å¼•ç”¨åˆ°æ–¹æ³•é‡Œé¢å»ï¼Œå¦‚ä¸‹ï¼š-å‚æ•°å¼•ç”¨-ENV-STATIONNAME-çš„æ—¶å€™ï¼Œè¦åœ¨variablesä¸‹é¢å…ˆå®šä¹‰å†å¼•ç”¨" class="headerlink" title="å¼•ç”¨debugtalké‡Œé¢çš„æ•°æ®åº“æŸ¥è¯¢æ–¹æ³•æ—¶ï¼Œè¦åœ¨è¿™é‡Œå®šä¹‰ä¸€ä¸ªå­—æ®µï¼Œ  - å…ˆæŠŠsqlè¯­å¥å®šä¹‰æˆä¸€ä¸ªå­—æ®µï¼Œç„¶åæŠŠsqlè¯­å¥å¼•ç”¨åˆ°æ–¹æ³•é‡Œé¢å»ï¼Œå¦‚ä¸‹ï¼š  - å‚æ•°å¼•ç”¨${ENV(STATIONNAME)çš„æ—¶å€™ï¼Œè¦åœ¨variablesä¸‹é¢å…ˆå®šä¹‰å†å¼•ç”¨"></a>å¼•ç”¨debugtalké‡Œé¢çš„æ•°æ®åº“æŸ¥è¯¢æ–¹æ³•æ—¶ï¼Œè¦åœ¨è¿™é‡Œå®šä¹‰ä¸€ä¸ªå­—æ®µï¼Œ<br>  - å…ˆæŠŠsqlè¯­å¥å®šä¹‰æˆä¸€ä¸ªå­—æ®µï¼Œç„¶åæŠŠsqlè¯­å¥å¼•ç”¨åˆ°æ–¹æ³•é‡Œé¢å»ï¼Œå¦‚ä¸‹ï¼š<br>  - <code>å‚æ•°å¼•ç”¨$&#123;ENV(STATIONNAME)çš„æ—¶å€™ï¼Œè¦åœ¨variablesä¸‹é¢å…ˆå®šä¹‰å†å¼•ç”¨</code></h2>  <img src="/img/httprunner/Untitled%2010.png" alt="Untitled"></li></ul></li><li><p>validateï¼šæ ¡éªŒå­—æ®µï¼Œéœ€è¦æ ¡éªŒçš„æ•°æ®éƒ½å†™åœ¨è¿™ä¸ªå­—æ®µä¸‹ï¼Œå°±æ˜¯æ–­è¨€ï¼Œä¸‹é¢ä¼šè®²æ–­è¨€ç”¨æ³•</p></li><li><p>â‘¦ã€€ç¢°åˆ°åˆ—è¡¨çš„æ—¶å€™ï¼Œç”¨list.0å»æå–ã€‚ç‚¹0æ˜¯è¡¨ç¤ºæå–ç´¢å¼•ä¸‹æ ‡ä¸º0çš„åˆ—è¡¨è¿›è¡Œæå–</p><ul><li><code>- eq: [ json.data.list.0.couponName, &quot;è‡ªåŠ¨åŒ–æµ‹è¯•å…‘æ¢&quot; ]</code></li></ul></li></ul><h2 id="testsuitesç›®å½•ï¼šå­˜æ”¾ç”¨ä¾‹é›†çš„yamlæ–‡ä»¶"><a href="#testsuitesç›®å½•ï¼šå­˜æ”¾ç”¨ä¾‹é›†çš„yamlæ–‡ä»¶" class="headerlink" title="testsuitesç›®å½•ï¼šå­˜æ”¾ç”¨ä¾‹é›†çš„yamlæ–‡ä»¶"></a>testsuitesç›®å½•ï¼šå­˜æ”¾ç”¨ä¾‹é›†çš„yamlæ–‡ä»¶</h2><p><img src="/img/httprunner/Untitled%2011.png" alt="Untitled"></p><h3 id="å­—æ®µè§£é‡Šï¼š-1"><a href="#å­—æ®µè§£é‡Šï¼š-1" class="headerlink" title="å­—æ®µè§£é‡Šï¼š"></a>å­—æ®µè§£é‡Šï¼š</h3><ol><li>testcasesï¼šæŒ‡è¿™æ¡ç”¨ä¾‹é›†ï¼Œè¦æ‰§è¡Œçš„ç”¨ä¾‹éƒ½ç°åœ¨è¿™ä¸ªå­—æ®µä¸‹é¢</li><li>testcaseï¼šç”¨ä¾‹çš„è·¯å¾„å­—æ®µ</li><li>parametersï¼šå‚æ•°åŒ–å­—æ®µï¼Œå¤–éƒ¨ä¼ çš„å‚ç»™ç”¨ä¾‹ï¼Œéƒ½å¯ä»¥å†™åœ¨è¿™ä¸ªå­—æ®µä¸‹é¢ï¼Œæµ‹è¯•æ•°æ®ä¸­çš„å‚æ•°å¯ä»¥å†™åœ¨è¿™ä¸‹é¢</li></ol><h3 id="ç”¨ä¾‹ç¼–å†™"><a href="#ç”¨ä¾‹ç¼–å†™" class="headerlink" title="ç”¨ä¾‹ç¼–å†™"></a>ç”¨ä¾‹ç¼–å†™</h3><ul><li>å‚æ•°å¼•ç”¨ï¼šåœ¨yamlæ–‡ä»¶ä¸­ç”¨â€œ$â€ç¬¦å·å®ç°å¯¹å‚æ•°çš„å¼•ç”¨ æ¯”å¦‚:</li></ul><p><img src="/img/httprunner/Untitled%2012.png" alt="Untitled"></p><ul><li>2.2å‡½æ•°å¼•ç”¨ï¼šåœ¨yamlæ–‡ä»¶ä¸­é€šè¿‡â€œ${}â€å®ç°å¯¹å‡½æ•°çš„å¼•ç”¨ï¼Œæ¯”å¦‚ï¼š</li></ul><p><img src="/img/httprunner/Untitled%2013.png" alt="Untitled"></p><ul><li>æ‰€æœ‰å‡½æ•°éƒ½å®šä¹‰åœ¨debugtalk.pyæ–‡ä»¶ä¸­ï¼Œ</li><li>å¦‚æœåœ¨æµ‹è¯•ä¸­æœ‰éœ€è¦å†™ä»£ç å¤„ç†çš„ï¼Œå°±å¯ä»¥æŠŠä»£ç å†™åœ¨debugtalk.pyæ–‡ä»¶ä¸­ï¼Œç„¶åç”¨ä¾‹ä¸­å°±å¯ä»¥ç›´æ¥å¼•ç”¨äº†ã€‚</li></ul><p><img src="/img/httprunner/Untitled%2014.png" alt="Untitled"></p><h1 id="è¿è¡Œæ¥å£"><a href="#è¿è¡Œæ¥å£" class="headerlink" title="è¿è¡Œæ¥å£"></a>è¿è¡Œæ¥å£</h1><h2 id="æ–¹å¼ä¸€ï¼š"><a href="#æ–¹å¼ä¸€ï¼š" class="headerlink" title="æ–¹å¼ä¸€ï¼š"></a>æ–¹å¼ä¸€ï¼š</h2><ul><li>ä½¿ç”¨å‘½ä»¤è¡Œè°ƒè¯•ï¼šhrun .\testsuites\xxæµ‹è¯•é›†.yml</li><li>å¦‚æœè¦æ‰“å°è¿è¡Œè¯¦ç»†æ—¥å¿—ï¼Œåœ¨å‘½ä»¤åé¢åŠ ä¸Šâ€“log-level</li></ul><p>hrun .\testsuites\xxæµ‹è¯•é›†.yml â€“log-level debug</p><p><img src="/img/httprunner/Untitled%2015.png" alt="Untitled"></p><p><img src="/img/httprunner/Untitled%2016.png" alt="Untitled"></p><h2 id="æ–¹å¼äºŒï¼š"><a href="#æ–¹å¼äºŒï¼š" class="headerlink" title="æ–¹å¼äºŒï¼š"></a>æ–¹å¼äºŒï¼š</h2><ul><li>åœ¨å·¥ç¨‹è·Ÿç›®å½•ä¸‹æœ‰ä¸€ä¸ªruntest.pyæ–‡ä»¶ï¼Œé‡Œé¢æŒ‡å®šè¦æ‰§è¡Œçš„æ–‡ä»¶è·¯å¾„å°±å¯ä»¥è¿ç”¨ç”¨ä¾‹äº†ï¼Œå³é”®â€”â€”Run rentest å°±å¯ä»¥æ‰§è¡Œï¼Œæ‰§è¡Œåä¼šåœ¨reportç›®å½•ä¸‹ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š</li><li>é€šè¿‡<code>os.system</code>å¯ä»¥è°ƒç”¨cmdå‘½ä»¤ï¼Œæ–¹ä¾¿è‡ªå·±è°ƒè¯•ç”¨ã€‚</li><li>æ³¨æ„ä¸€ä¸‹ï¼Œcmdå‘½ä»¤çš„æ–œæ æ˜¯åæ–œæ ï¼Œæ³¨æ„æ–œæ åŠ téœ€è¦åŒæ–œæ ï¼Œä¸ç„¶ä¼šç¼–è¯‘é”™è¯¯</li><li></li></ul><p><img src="/img/httprunner/Untitled%2017.png" alt="Untitled"></p><p><img src="/img/httprunner/Untitled%2018.png" alt="Untitled"></p><h1 id="æµ‹è¯•æŠ¥å‘Š"><a href="#æµ‹è¯•æŠ¥å‘Š" class="headerlink" title="æµ‹è¯•æŠ¥å‘Š"></a>æµ‹è¯•æŠ¥å‘Š</h1><p>æŠ¥å‘Šä¿å­˜åœ¨reportç›®å½•ä¸‹ï¼Œæ¯æ¬¡æ‰§è¡Œå®Œéƒ½ä¼šç”Ÿæˆæµ‹è¯•æŠ¥å‘Šï¼Œç”¨æµè§ˆå™¨å³å¯æ‰“å¼€è¿›è¡ŒæŸ¥çœ‹</p><p><img src="/img/httprunner/Untitled%2019.png" alt="Untitled"></p><p><img src="/img/httprunner/Untitled%2020.png" alt="Untitled"></p><h2 id="ä¸€äº›ç‰¹æ®Šæ¥å£â€”å›¾ç‰‡ä¸Šä¼ æ¥å£"><a href="#ä¸€äº›ç‰¹æ®Šæ¥å£â€”å›¾ç‰‡ä¸Šä¼ æ¥å£" class="headerlink" title="ä¸€äº›ç‰¹æ®Šæ¥å£â€”å›¾ç‰‡ä¸Šä¼ æ¥å£"></a>ä¸€äº›ç‰¹æ®Šæ¥å£â€”å›¾ç‰‡ä¸Šä¼ æ¥å£</h2><p>ç”¨æŠ“åŒ…è½¯ä»¶çœ‹åˆ°æ¥å£ä¼ å‚å¦‚å›¾æ‰€ç¤º</p><p>æ³¨æ„ï¼šrequestsåº“ä¼šè‡ªåŠ¨æ·»åŠ è¿™ä¸ªå…ƒç´ Â {â€œContent-Typeâ€:â€multipart&#x2F;form-dataâ€}Â ï¼›åŠ äº†åè€Œä¼šæŠ¥é”™ï¼Œä»è€Œå¯¼è‡´è¯·æ±‚ä¸æˆåŠŸã€‚</p><p>åœ¨å‰ç«¯å…è®¸å’Œæ”¯æŒä¸Šä¼ çš„æ‰€æœ‰æ ¼å¼æ–‡ä»¶ä¸­ï¼Œå½“é€‰æ‹©ä¸åŒæ ¼å¼æ–‡ä»¶æ—¶å¯¹æ¥å£å‘èµ·è¯·æ±‚æ—¶ï¼Œ</p><p>Form Dataä¼šè‡ªåŠ¨è¯†åˆ«æ–‡ä»¶çš„Content-Typeã€æ ¹æ®ä¼ å…¥çš„æ–‡ä»¶æ ¼å¼è‡ªåŠ¨è§£æä¸ºheadersä¸­çš„Content-Typeã€‘ä»¥åŠContent-Dispositionã€è¯¥å­—æ®µä¸­åŒ…æ‹¬æ¥å£çš„ä¼ å‚ç±»å‹ï¼ˆä¾‹å¦‚ä¸‹å›¾çš„form-dataï¼‰ï¼Œä¼ å…¥æ–‡ä»¶åï¼ˆä¾‹å¦‚ä¸‹å›¾çš„filenameï¼‰ç­‰ã€‘ã€‚</p><p><img src="/img/httprunner/Untitled%2021.png" alt="Untitled"></p><p>æ‰€ä»¥å‚æ•°æˆ‘ä»¬å¯ä»¥å¦‚å›¾ä¸­fileså­—æ®µé‚£æ ·å®šä¹‰</p><p><img src="/img/httprunner/Untitled%2022.png" alt="Untitled"></p><h2 id="æµ‹è¯•æ•°æ®"><a href="#æµ‹è¯•æ•°æ®" class="headerlink" title="æµ‹è¯•æ•°æ®"></a>æµ‹è¯•æ•°æ®</h2><p><img src="/img/httprunner/Untitled%2023.png" alt="Untitled"></p><p>dataç›®å½•ä¸‹å°±æ˜¯å­˜æ”¾æµ‹è¯•æ•°æ®æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦ä¸Šä¼ æ–‡ä»¶æˆ–å›¾ç‰‡çš„æ•°æ®å¯ä»¥æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹ï¼Œæˆ–apiä¸­çš„ä¸€äº›å‚æ•°æ•°æ®å¯ä»¥ä»¥csvæ–‡ä»¶æ ¼å¼å­˜æ”¾åœ¨è¿™ä¸ªç›®å½•ä¸‹</p><h1 id="å‚æ•°åŒ–ï¼š"><a href="#å‚æ•°åŒ–ï¼š" class="headerlink" title="å‚æ•°åŒ–ï¼š"></a>å‚æ•°åŒ–ï¼š</h1><h2 id="å¯¹æµ‹è¯•æ•°æ®çš„å¼•ç”¨"><a href="#å¯¹æµ‹è¯•æ•°æ®çš„å¼•ç”¨" class="headerlink" title="å¯¹æµ‹è¯•æ•°æ®çš„å¼•ç”¨"></a>å¯¹æµ‹è¯•æ•°æ®çš„å¼•ç”¨</h2><ul><li>åœ¨ç”¨ä¾‹ä¸­æ€ä¹ˆä½¿ç”¨æµ‹è¯•æ•°æ®æ–‡ä»¶ä¸­çš„æ•°æ®å‘¢ï¼Œ</li><li>æ¡†æ¶ä¸­æœ‰ä¸ªè¯»å–æ•°æ®æ–‡ä»¶çš„å‡½æ•°Pï¼Œ</li><li>å¼•ç”¨æ—¶å‚å…¥æ•°æ®æ–‡ä»¶åœ°å€ä½œä¸ºå‚æ•° ${P(data&#x2F;å¯¹åº”çš„csv.csv)} å¯¹åº”çš„csv.csv æ–‡ä»¶å†…å®¹å¦‚å›¾ï¼Œ</li></ul><p><img src="/img/httprunner/Untitled%2024.png" alt="Untitled"></p><ul><li>æ³¨æ„ï¼šåªèƒ½åœ¨testsuiteä¸­å¯¹æµ‹è¯•æ•°æ®çš„å¼•ç”¨ï¼Œæµ‹è¯•æ•°æ®ä¸­çš„å‚æ•°å¯ä»¥ å­—æ®µå-å­—æ®µåçš„æ–¹å¼è¿›è¡Œè·å–ã€‚qudaologin.csvä¸­æœ‰å‡ æ¡è®°å½•ï¼Œè¿™æ ·ç”¨ä¾‹å°±ä¼šæ‰§è¡Œå‡ æ¬¡</li><li>å†è¯´ä¸€éï¼Œåªèƒ½åœ¨testsuiteé‡Œé¢å¼•ç”¨csvå‚æ•°ï¼Œ<ul><li>åœ¨testcaseçš„ä¸‹é¢åŠ ä¸€ä¸ªå­—æ®µparametersï¼šä¸‹é¢å†æ¥éœ€è¦è¢«ä¼ å‚çš„å­—æ®µå</li><li>csvçš„å‚æ•°æœ‰å¤šå°‘è¡Œï¼Œå¯¹åº”çš„ç”¨ä¾‹å°±ä¼šè¢«æ‰§è¡Œå¤šå°‘æ¬¡</li></ul></li></ul><p><img src="/img/httprunner/Untitled%2025.png" alt="Untitled"></p><h2 id="ç›´æ¥èµ‹å€¼å‚æ•°"><a href="#ç›´æ¥èµ‹å€¼å‚æ•°" class="headerlink" title="ç›´æ¥èµ‹å€¼å‚æ•°"></a>ç›´æ¥èµ‹å€¼å‚æ•°</h2><ul><li>å¤šä¸ªå…³è”å‚æ•°ï¼Œå¯ä»¥æŒ‰ç…§ä¸‹å›¾ä¸­çš„æ–¹å¼å¯¹ç”¨ä¾‹å‚æ•°è¿›è¡Œèµ‹å€¼ï¼Œè¿›è¡Œè¯¥é…ç½®åï¼Œæµ‹è¯•ç”¨ä¾‹åœ¨è¿è¡Œæ—¶å°±ä¼šå¯¹ nameï¼Œresultå®ç°æ•°æ®é©±åŠ¨ï¼Œå³åˆ†åˆ«è¿è¡Œ 3æ¬¡æµ‹è¯•ï¼Œå¹¶ä¸”ä¿è¯å‚æ•°å€¼æ€»æ˜¯æˆå¯¹ä½¿ç”¨ã€‚</li></ul><p><img src="/img/httprunner/Untitled%2026.png" alt="Untitled"></p><h2 id="å•ä¸ªå‚æ•°å…³è”"><a href="#å•ä¸ªå‚æ•°å…³è”" class="headerlink" title="å•ä¸ªå‚æ•°å…³è”"></a>å•ä¸ªå‚æ•°å…³è”</h2><ul><li>å•ä¸ªå‚æ•°å¯ä»¥ç›´æ¥å°±å¯ä»¥æŒ‰ç…§å¦‚ä¸‹æ–¹å¼è¿›è¡Œé…ç½®ï¼Œå³åˆ†åˆ«ä½¿ç”¨ [1,2,3,4,5,6,7] 7ä¸ªå€¼è¿è¡Œæµ‹è¯•ç”¨ä¾‹ã€‚</li></ul><p><img src="/img/httprunner/Untitled%2027.png" alt="Untitled"></p><h1 id="ç¯å¢ƒå˜é‡ï¼š"><a href="#ç¯å¢ƒå˜é‡ï¼š" class="headerlink" title="ç¯å¢ƒå˜é‡ï¼š"></a>ç¯å¢ƒå˜é‡ï¼š</h1><ul><li>å·¥ç¨‹ç›®å½•ä¸‹æœ‰ä¸ª.envæ–‡ä»¶ï¼Œé‡Œé¢å¯ä»¥é…ç½®æµ‹è¯•ç¯å¢ƒçš„åœ°å€ï¼Œå¦‚å›¾æ‰€ç¤º</li></ul><p><img src="/img/httprunner/Untitled%2028.png" alt="Untitled"></p><ul><li>æ¡†æ¶æœ‰ä¸ªè·å–ç¯å¢ƒæ–‡ä»¶çš„å‡½æ•°ENV, è°ƒç”¨æ—¶å¯ä»¥å¼•ç”¨å‡½æ•°è·å–å˜é‡${ENV(TESTENV)}</li></ul><p><img src="/img/httprunner/Untitled%2029.png" alt="Untitled"></p><h1 id="9-æ–­è¨€æ ¡éªŒ"><a href="#9-æ–­è¨€æ ¡éªŒ" class="headerlink" title="9. æ–­è¨€æ ¡éªŒ"></a>9. æ–­è¨€æ ¡éªŒ</h1><h2 id="æ¡†æ¶ä¸­å·²å®ç°å¦‚ä¸‹æ ¡éªŒ"><a href="#æ¡†æ¶ä¸­å·²å®ç°å¦‚ä¸‹æ ¡éªŒ" class="headerlink" title="æ¡†æ¶ä¸­å·²å®ç°å¦‚ä¸‹æ ¡éªŒ"></a>æ¡†æ¶ä¸­å·²å®ç°å¦‚ä¸‹æ ¡éªŒ</h2><p><img src="/img/httprunner/Untitled%2030.png" alt="Untitled"></p><p><img src="/img/httprunner/Untitled%2031.png" alt="Untitled"></p><h2 id="9-2è‡ªå®šä¹‰æ ¡éªŒå‡½æ•°"><a href="#9-2è‡ªå®šä¹‰æ ¡éªŒå‡½æ•°" class="headerlink" title="9.2è‡ªå®šä¹‰æ ¡éªŒå‡½æ•°"></a>9.2è‡ªå®šä¹‰æ ¡éªŒå‡½æ•°</h2><p>å¯¹äºè‡ªå®šä¹‰çš„æ ¡éªŒå‡½æ•°ï¼Œéœ€è¦éµå¾ªä¸‰ä¸ªè§„åˆ™ï¼š</p><ol><li>ïƒ˜è‡ªå®šä¹‰æ ¡éªŒå‡½æ•°éœ€æ”¾ç½®åˆ°debugtalk.pyä¸­</li><li>ïƒ˜å‚æ•°æœ‰ä¸¤ä¸ªï¼šç¬¬ä¸€ä¸ªä¸ºåŸå§‹æ•°æ®ï¼Œç¬¬äºŒä¸ªä¸ºåŸå§‹æ•°æ®ç»è¿‡è¿ç®—åå¾—åˆ°çš„é¢„æœŸç»“æœå€¼</li><li>ïƒ˜åœ¨æ ¡éªŒå‡½æ•°ä¸­é€šè¿‡assertå°†å®é™…è¿ç®—ç»“æœä¸é¢„æœŸç»“æœå€¼è¿›è¡Œæ¯”è¾ƒ</li></ol><p>å¦‚å›¾ï¼šåœ¨debugtalk.pyæ–‡ä»¶ä¸­å®šä¹‰æ ¡éªŒå‡½æ•°</p><p><img src="/img/httprunner/Untitled%2032.png" alt="Untitled"></p><p>ç„¶ååœ¨ç”¨ä¾‹æ ¡éªŒçš„æ—¶å€™å¼•ç”¨è¿™ä¸ªæ ¡éªŒå‡½æ•°</p><p><img src="/img/httprunner/Untitled%2033.png" alt="Untitled"></p><h2 id="9-3ä¿®æ”¹æ¡†æ¶æ ¡éªŒå‡½æ•°ï¼šä¸å»ºè®®"><a href="#9-3ä¿®æ”¹æ¡†æ¶æ ¡éªŒå‡½æ•°ï¼šä¸å»ºè®®" class="headerlink" title="9.3ä¿®æ”¹æ¡†æ¶æ ¡éªŒå‡½æ•°ï¼šä¸å»ºè®®"></a>9.3ä¿®æ”¹æ¡†æ¶æ ¡éªŒå‡½æ•°ï¼šä¸å»ºè®®</h2><ul><li>åœ¨httprunner&gt;builtin&gt;comparatoræ–°å¢è‡ªå®šä¹‰æ ¡éªŒï¼Œç„¶ååœ¨parseræ–‡ä»¶ä¸­å®šä¹‰æ ¡éªŒç¼©å†™æ–¹æ³•</li></ul><p><img src="/img/httprunner/Untitled%2034.png" alt="Untitled"></p><p><img src="/img/httprunner/Untitled%2035.png" alt="Untitled"></p><h2 id="9-4æ ¡éªŒæ”¯æŒæ­£åˆ™æ ¡éªŒï¼š"><a href="#9-4æ ¡éªŒæ”¯æŒæ­£åˆ™æ ¡éªŒï¼š" class="headerlink" title="9.4æ ¡éªŒæ”¯æŒæ­£åˆ™æ ¡éªŒï¼š"></a>9.4æ ¡éªŒæ”¯æŒæ­£åˆ™æ ¡éªŒï¼š</h2><p><img src="/img/httprunner/Untitled%2036.png" alt="Untitled"></p><p><img src="/img/httprunner/Untitled%2037.png" alt="Untitled"></p><h2 id="9-5æ•°æ®åº“æ ¡éªŒï¼š"><a href="#9-5æ•°æ®åº“æ ¡éªŒï¼š" class="headerlink" title="9.5æ•°æ®åº“æ ¡éªŒï¼š"></a>9.5æ•°æ®åº“æ ¡éªŒï¼š</h2><p>æ¡†æ¶å®ç°äº†å¯¹æ•°æ®åº“çš„æŸ¥è¯¢ï¼Œæ“ä½œæ•°æ®åº“çš„åŸç†æ˜¯æ ¹æ®è¾“å…¥çš„SQLè¯­å¥ è¿‡æ»¤å‡ºè¦æ“ä½œçš„tableName, ç„¶åå»é…ç½®æ–‡ä»¶ä¸­æ‰¾åˆ°å¯¹åº”å¾—tableNameæ‰€åœ¨çš„åœ°å€å’Œåº“è¿›è¡Œè¿æ¥å’Œæ“ä½œï¼Œæ“ä½œæ•°æ®åº“éœ€è¦åšå¦‚ä¸‹é…ç½®ï¼Œåœ¨è·Ÿç›®å½•ä¸‹æœ‰ä¸ªdatabase.iniæ–‡ä»¶ï¼Œåœ¨é‡Œé¢é…ç½®æ•°æ®åº“ç›¸å…³ä¿¡æ¯</p><p><img src="/img/httprunner/Untitled%2038.png" alt="Untitled"></p><p><img src="/img/httprunner/Untitled%2039.png" alt="Untitled"></p>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>éƒ¨ç½²</tag>
      
      <tag>æ¥å£è‡ªåŠ¨åŒ–</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€otherã€‘WSLåŸºç¡€ä½¿ç”¨æŒ‡å—</title>
    <link href="/2023/12/23/WSL%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/"/>
    <url>/2023/12/23/WSL%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/</url>
    
    <content type="html"><![CDATA[<h1 id="WSLä½¿ç”¨æŒ‡å—"><a href="#WSLä½¿ç”¨æŒ‡å—" class="headerlink" title="WSLä½¿ç”¨æŒ‡å—"></a>WSLä½¿ç”¨æŒ‡å—</h1><h1 id="1ã€WSLä»‹ç»å’Œå®‰è£…"><a href="#1ã€WSLä»‹ç»å’Œå®‰è£…" class="headerlink" title="1ã€WSLä»‹ç»å’Œå®‰è£…"></a>1ã€WSLä»‹ç»å’Œå®‰è£…</h1><h4 id="ä¸€ã€ç®€ä»‹"><a href="#ä¸€ã€ç®€ä»‹" class="headerlink" title="ä¸€ã€ç®€ä»‹"></a>ä¸€ã€ç®€ä»‹</h4><ul><li>Windows Subsystem for Linuxï¼ˆç®€ç§°WSLï¼‰æ˜¯ä¸€ä¸ªåœ¨Windows 10\11ä¸Šèƒ½å¤Ÿè¿è¡ŒåŸç”ŸLinuxäºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆELFæ ¼å¼ï¼‰çš„å…¼å®¹å±‚ã€‚å®ƒæ˜¯ç”±å¾®è½¯ä¸Canonicalå…¬å¸åˆä½œå¼€å‘ï¼Œå…¶ç›®æ ‡æ˜¯ä½¿çº¯æ­£çš„Ubuntuã€Debianç­‰æ˜ åƒèƒ½ä¸‹è½½å’Œè§£å‹åˆ°ç”¨æˆ·çš„æœ¬åœ°è®¡ç®—æœºï¼Œå¹¶ä¸”æ˜ åƒå†…çš„å·¥å…·å’Œå®ç”¨å·¥å…·èƒ½åœ¨æ­¤å­ç³»ç»Ÿä¸ŠåŸç”Ÿè¿è¡Œã€‚</li><li><strong>ä¼˜åŠ¿</strong>ï¼šå¼€å‘äººå‘˜å¯ä»¥åœ¨ Windows è®¡ç®—æœºä¸ŠåŒæ—¶è®¿é—® Windows å’Œ Linux çš„å¼ºå¤§åŠŸèƒ½ã€‚ é€šè¿‡é€‚ç”¨äº Linux çš„ Windows å­ç³»ç»Ÿ (WSL)ï¼Œå¼€å‘äººå‘˜å¯ä»¥å®‰è£… Linux å‘è¡Œç‰ˆï¼ˆä¾‹å¦‚ Ubuntuã€OpenSUSEã€Kaliã€Debianã€Arch Linux ç­‰ï¼‰ï¼Œå¹¶ç›´æ¥åœ¨ Windows ä¸Šä½¿ç”¨ Linux åº”ç”¨ç¨‹åºã€å®ç”¨ç¨‹åºå’Œ Bash å‘½ä»¤è¡Œå·¥å…·ï¼Œä¸ç”¨è¿›è¡Œä»»ä½•ä¿®æ”¹ï¼Œä¹Ÿæ— éœ€æ‰¿æ‹…ä¼ ç»Ÿè™šæ‹Ÿæœºæˆ–åŒå¯åŠ¨è®¾ç½®çš„è´¹ç”¨ã€‚</li><li>ä¸€å¥è¯ï¼Œ<strong>åœ¨windowsä¸Šä¸éœ€è¦é€šè¿‡è™šæ‹Ÿæœºè¿è¡ŒLinux</strong> ï¼Œ</li></ul><h4 id="äºŒã€å‡†å¤‡å·¥ä½œ"><a href="#äºŒã€å‡†å¤‡å·¥ä½œ" class="headerlink" title="äºŒã€å‡†å¤‡å·¥ä½œ"></a>äºŒã€å‡†å¤‡å·¥ä½œ</h4><p>å…ˆå¼€å¯Windowså¯¹å­ç³»ç»Ÿçš„æ”¯æŒï¼š<strong>æ§åˆ¶é¢æ¿â€“&gt;ç¨‹åºâ€“&gt;å¯ç”¨æˆ–å…³é—­WindowsåŠŸèƒ½</strong></p><ul><li>æ‰“å¼€Hyper-V</li><li>æ‰“å¼€é€‚ç”¨äºLinuxçš„Windowså­ç³»ç»Ÿ</li></ul><h4 id="ä¸‰ã€å®‰è£…WSL"><a href="#ä¸‰ã€å®‰è£…WSL" class="headerlink" title="ä¸‰ã€å®‰è£…WSL"></a>ä¸‰ã€å®‰è£…WSL</h4><h5 id="1-å¯ç”¨é€‚ç”¨äº-Linux-çš„-Windows-å­ç³»ç»Ÿ"><a href="#1-å¯ç”¨é€‚ç”¨äº-Linux-çš„-Windows-å­ç³»ç»Ÿ" class="headerlink" title="1 å¯ç”¨é€‚ç”¨äº Linux çš„ Windows å­ç³»ç»Ÿ"></a>1 å¯ç”¨é€‚ç”¨äº Linux çš„ Windows å­ç³»ç»Ÿ</h5><p>éœ€è¦å…ˆå¯ç”¨â€œé€‚ç”¨äº Linux çš„ Windows å­ç³»ç»Ÿâ€å¯é€‰åŠŸèƒ½ï¼Œç„¶åæ‰èƒ½åœ¨ Windows ä¸Šå®‰è£… Linux åˆ†å‘ã€‚</p><p>ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€ PowerShellï¼ˆâ€œå¼€å§‹â€èœå• &gt;â€œPowerShellâ€ &gt;å•å‡»å³é”® &gt;â€œä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œâ€ï¼‰ï¼Œç„¶åè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart<br></code></pre></td></tr></table></figure><h5 id="2-å¯ç”¨è™šæ‹ŸæœºåŠŸèƒ½"><a href="#2-å¯ç”¨è™šæ‹ŸæœºåŠŸèƒ½" class="headerlink" title="2 å¯ç”¨è™šæ‹ŸæœºåŠŸèƒ½"></a>2 å¯ç”¨è™šæ‹ŸæœºåŠŸèƒ½</h5><p>å®‰è£… WSL 2 ä¹‹å‰ï¼Œå¿…é¡»å¯ç”¨â€œè™šæ‹Ÿæœºå¹³å°â€å¯é€‰åŠŸèƒ½ã€‚ è®¡ç®—æœºéœ€è¦è™šæ‹ŸåŒ–åŠŸèƒ½æ‰èƒ½ä½¿ç”¨æ­¤åŠŸèƒ½ã€‚</p><p>ä»¥ç®¡ç†å‘˜èº«ä»½æ‰“å¼€ PowerShell å¹¶è¿è¡Œï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart<br></code></pre></td></tr></table></figure><p><strong>é‡æ–°å¯åŠ¨è®¡ç®—æœºï¼Œä»¥å®Œæˆ WSL å®‰è£…å¹¶æ›´æ–°åˆ° WSL 2ã€‚</strong></p><p>å®‰è£…å®Œé‡å¯ååœ¨PowerShellä¸­è®¾ç½®é»˜è®¤ä¸ºWSL2ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">wsl --set-default-version 2<br></code></pre></td></tr></table></figure><h5 id="3-å®‰è£…æ‰€é€‰çš„-Linux-åˆ†å‘"><a href="#3-å®‰è£…æ‰€é€‰çš„-Linux-åˆ†å‘" class="headerlink" title="3  å®‰è£…æ‰€é€‰çš„ Linux åˆ†å‘"></a>3  å®‰è£…æ‰€é€‰çš„ Linux åˆ†å‘</h5><p>åœ¨MicroSoft Storeä¸­æœç´¢å¹¶ä¸‹è½½æƒ³è¦ä½¿ç”¨çš„linuxç‰ˆæœ¬ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨çš„ubuntu 20ç‰ˆæœ¬ï¼ˆæˆ–22ç‰ˆæœ¬ï¼‰</p><p><strong>4  è¿è¡ŒWSL</strong></p><p>ç»ˆç«¯ä½¿ç”¨å‘½ä»¤</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs shell">wsl -h # æŸ¥çœ‹å‘½ä»¤help<br>wsl # è¿è¡Œwsl<br></code></pre></td></tr></table></figure><h1 id="2ã€è¿›å…¥WSL-å®‰è£…å¼€å¯sshè¿œç¨‹"><a href="#2ã€è¿›å…¥WSL-å®‰è£…å¼€å¯sshè¿œç¨‹" class="headerlink" title="2ã€è¿›å…¥WSL å®‰è£…å¼€å¯sshè¿œç¨‹"></a>2ã€è¿›å…¥WSL å®‰è£…å¼€å¯sshè¿œç¨‹</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo passwd root   #è®¾ç½®rootè´¦å·å¯†ç ã€‚æ ¹æ®æç¤ºè¾“å…¥rootå¯†ç å³å¯ã€‚<br>12345678<br>su User  #åˆ‡æ¢è´¦å·. rootè´¦å·æ˜¯ # ç»“å°¾ï¼Œérootè´¦å·æ˜¯ $ç»“å°¾<br><br>// æ›´æ–°ç¯å¢ƒ<br>sudo apt-get update<br><br>ifconfig # å¦‚æœæ²¡æœ‰å°±æ‰§è¡Œä¸‹é¢çš„<br>sudo apt-get install net-tools<br><br>// å®‰è£…ssh<br>sudo apt-get install openssh-server<br><br>sudo apt-get install openssh-server<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">ç¼–è¾‘sshd_configæ–‡ä»¶</span><br>vim /etc/ssh/sshd_config<br><br>Port 2222   #è®¾ç½®sshçš„ç«¯å£å·, ç”±äº22åœ¨windowsä¸­æœ‰åˆ«çš„ç”¨å¤„, å°½é‡ä¸ä¿®æ”¹ç³»ç»Ÿçš„ç«¯å£å·<br>PermitRootLogin yes   # å¯ä»¥rootè¿œç¨‹ç™»å½•<br>PasswordAuthentication yes     # å¯†ç éªŒè¯ç™»å½•<br><span class="hljs-meta prompt_">#</span><span class="language-bash">è®¾ç½®SSHçš„ç«¯å£å·,å°½é‡é¿å…ä¸Windowsç«¯å£å·å†²çª</span><br>Port 2345<br><span class="hljs-meta prompt_">#</span><span class="language-bash">å…è®¸è¿œç¨‹ç™»å½•</span><br>PermitRootLogin yes   <br><span class="hljs-meta prompt_">#</span><span class="language-bash">ä½¿ç”¨å¯†ç ç™»å½•</span><br>PasswordAuthentication yes<br><span class="hljs-meta prompt_">#</span><span class="language-bash">SSHç™»å½•æ—¶çš„ç”¨æˆ·åå­—</span><br>AllowUsers wsl_username<br><br>å®‰è£…ssh<br>apt-get install ssh<br><br>å¼€å¯ ssh<br>/etc/init.d/ssh start<br><br>å‡ºç°* Starting OpenBSD Secure Shell server sshdæŠ¥é”™å°±<br><span class="hljs-meta prompt_">$ </span><span class="language-bash">ssh-keygen -A</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">/etc/init.d/ssh start</span><br>å¯ä»¥è¿œç¨‹è¿æ¥äº†<br>sudo ps -e | grep ssh # è¾“å…¥æŸ¥çœ‹æœ‰æ²¡æœ‰å¯åŠ¨æˆåŠŸ<br>å¦‚æœæ˜¾ç¤ºå¯¹åº”çš„ç«¯å£å·ï¼Œå°±è¯´æ˜å¯åŠ¨æˆåŠŸäº†<br><br></code></pre></td></tr></table></figure><h1 id="3ã€æ›´æ–°æœåŠ¡å™¨è½¯ä»¶æºï¼ˆé˜¿é‡Œäº‘æºï¼‰å¹¶æ›´æ–°è½¯ä»¶"><a href="#3ã€æ›´æ–°æœåŠ¡å™¨è½¯ä»¶æºï¼ˆé˜¿é‡Œäº‘æºï¼‰å¹¶æ›´æ–°è½¯ä»¶" class="headerlink" title="3ã€æ›´æ–°æœåŠ¡å™¨è½¯ä»¶æºï¼ˆé˜¿é‡Œäº‘æºï¼‰å¹¶æ›´æ–°è½¯ä»¶"></a><strong>3ã€æ›´æ–°æœåŠ¡å™¨è½¯ä»¶æºï¼ˆé˜¿é‡Œäº‘æºï¼‰å¹¶æ›´æ–°è½¯ä»¶</strong></h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä½¿ç”¨ root æƒé™ç™»å½•ï¼Œåç»­è¾“å…¥å¯†ç </span><br>sudo -i<br><span class="hljs-meta prompt_"> </span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ¥ä¸‹æ¥å¤‡ä»½å½“å‰æºï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤</span><br>cp /etc/apt/sources.list /etc/apt/sources.list.old <br><span class="hljs-meta prompt_"> </span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">è¿™ä¸ªsources.listæ–‡ä»¶å°±æ˜¯æºæ–‡ä»¶ï¼Œåˆ é™¤è¯¥æ–‡ä»¶ï¼Œé‡æ–°å†™ä¸€ä¸ª</span><br>rm /etc/apt/sources.list<br>vim /etc/apt/sources.list<br><br></code></pre></td></tr></table></figure><h2 id="æ›´æ–°è½¯ä»¶æºï¼ˆé˜¿é‡Œäº‘æºï¼‰å¹¶æ›´æ–°è½¯ä»¶"><a href="#æ›´æ–°è½¯ä»¶æºï¼ˆé˜¿é‡Œäº‘æºï¼‰å¹¶æ›´æ–°è½¯ä»¶" class="headerlink" title="æ›´æ–°è½¯ä»¶æºï¼ˆé˜¿é‡Œäº‘æºï¼‰å¹¶æ›´æ–°è½¯ä»¶"></a><strong>æ›´æ–°è½¯ä»¶æºï¼ˆé˜¿é‡Œäº‘æºï¼‰å¹¶æ›´æ–°è½¯ä»¶</strong></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">ä½¿ç”¨ root æƒé™ç™»å½•ï¼Œåç»­è¾“å…¥å¯†ç </span><br>sudo -i<br><span class="hljs-meta prompt_"> </span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">æ¥ä¸‹æ¥å¤‡ä»½å½“å‰æºï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤</span><br>cp /etc/apt/sources.list /etc/apt/sources.list.old <br><span class="hljs-meta prompt_"> </span><br><span class="hljs-meta prompt_">#</span><span class="language-bash">è¿™ä¸ªsources.listæ–‡ä»¶å°±æ˜¯æºæ–‡ä»¶ï¼Œåˆ é™¤è¯¥æ–‡ä»¶ï¼Œé‡æ–°å†™ä¸€ä¸ª</span><br>rm /etc/apt/sources.list<br>vim /etc/apt/sources.list<br></code></pre></td></tr></table></figure><p>å¤åˆ¶ä¸‹é¢å†…å®¹ï¼Œç„¶åå•å‡»å³é”®ç²˜è´´è¿›å»å³å¯ï¼Œä¹‹åæŒ‰ESCï¼Œè¾“å…¥wqä¿å­˜å¹¶é€€å‡ºã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs shell">deb http://mirrors.aliyun.com/ubuntu/ jammy main restricted universe multiverse<br>deb http://mirrors.aliyun.com/ubuntu/ jammy-security main restricted universe multiverse<br>deb http://mirrors.aliyun.com/ubuntu/ jammy-updates main restricted universe multiverse<br>deb http://mirrors.aliyun.com/ubuntu/ jammy-backports main restricted universe multiverse<br><span class="hljs-meta prompt_"> </span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">deb-src http://mirrors.aliyun.com/ubuntu/ jammy main restricted universe multiverse</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">deb-src http://mirrors.aliyun.com/ubuntu/ jammy-security main restricted universe multiverse</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">deb-src http://mirrors.aliyun.com/ubuntu/ jammy-updates main restricted universe multiverse</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">deb-src http://mirrors.aliyun.com/ubuntu/ jammy-backports main restricted universe multiverse</span><br><span class="hljs-meta prompt_"> </span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># Pre-released source, not recommended.</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">deb http://mirrors.aliyun.com/ubuntu/ jammy-proposed main restricted universe multiverse</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">deb-src http://mirrors.aliyun.com/ubuntu/ jammy-proposed main restricted universe multiverse</span><br> <br>deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy main restricted universe multiverse<br>deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-updates main restricted universe multiverse<br>deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-backports main restricted universe multiverse<br>deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-security main restricted universe multiverse<br><span class="hljs-meta prompt_"> </span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy main restricted universe multiverse</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-updates main restricted universe multiverse</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-backports main restricted universe multiverse</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-security main restricted universe multiverse</span><br><span class="hljs-meta prompt_"> </span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># Pre-released source, not recommended.</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-proposed main restricted universe multiverse</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-proposed main restricted universe multiverse</span><br><span class="hljs-meta prompt_"> </span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># Pre-released source, not recommended.</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">deb https://mirrors.ustc.edu.cn/ubuntu/ jammy-proposed main restricted universe multiverse</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">deb-src https://mirrors.ustc.edu.cn/ubuntu/ jammy-proposed main restricted universe multiverse</span><br> <br>deb http://mirrors.163.com/ubuntu/ jammy main restricted universe multiverse<br>deb http://mirrors.163.com/ubuntu/ jammy-security main restricted universe multiverse<br>deb http://mirrors.163.com/ubuntu/ jammy-updates main restricted universe multiverse<br>deb http://mirrors.163.com/ubuntu/ jammy-backports main restricted universe multiverse<br><span class="hljs-meta prompt_"> </span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">deb-src http://mirrors.163.com/ubuntu/ jammy main restricted universe multiverse</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">deb-src http://mirrors.163.com/ubuntu/ jammy-security main restricted universe multiverse</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">deb-src http://mirrors.163.com/ubuntu/ jammy-updates main restricted universe multiverse</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">deb-src http://mirrors.163.com/ubuntu/ jammy-backports main restricted universe multiverse</span><br><span class="hljs-meta prompt_"> </span><br><span class="hljs-meta prompt_">#</span><span class="language-bash"><span class="hljs-comment"># Pre-released source, not recommended.</span></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">deb http://mirrors.163.com/ubuntu/ jammy-proposed main restricted universe multiverse</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">deb-src http://mirrors.163.com/ubuntu/ jammy-proposed main restricted universe multiverse</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å¼€å§‹æ›´æ–°è½¯ä»¶é•œåƒæºå’Œè½¯ä»¶åŒ…</span><br>sudo apt update      <span class="hljs-comment">#æ›´æ–°è½¯ä»¶æº</span><br>sudo apt upgrade     <span class="hljs-comment">#æ›´æ–°è½¯ä»¶åŒ…</span><br></code></pre></td></tr></table></figure><h1 id="4ã€docker-å®‰è£…"><a href="#4ã€docker-å®‰è£…" class="headerlink" title="4ã€docker å®‰è£…"></a>4ã€docker å®‰è£…</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs shell">1. å…ˆå¸è½½æ—§ç‰ˆæœ¬çš„docke<br>sudo apt-get remove docker docker-engine docker.io<br>2. æ›´æ–°ä¸€ä¸‹apt-getæº<br>sudo apt-get update<br>3. å®‰è£…GPGè¯ä¹¦<br><span class="hljs-meta prompt_">#</span><span class="language-bash">åˆ«å¿˜äº†æœ€åçš„â€œ-â€</span><br>curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -<br>4. å†™å…¥è½¯ä»¶æºä¿¡æ¯<br>sudo add-apt-repository &quot;deb [arch=amd64] http://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable&quot;<br>5. åˆ—å‡ºå¯ç”¨ç‰ˆæœ¬<br>sudo apt-cache madison docker-ce<br>6. æ›´æ–°å¹¶å®‰è£… Docker-CE<br>sudo apt-get update<br>sudo apt-get install docker-ce=5:23.0.5-1~ubuntu.20.04~focal<br>sudo apt-get install docker-ce=5:24.0.4-1~ubuntu.22.04~jammy<br>7. å¼€å¯dockeræœåŠ¡ï¼ŒæŸ¥çœ‹dockerçŠ¶æ€<br>sudo service docker start<br>sudo service docker status<br>systemctl restart docker<br>8.ä½¿ç”¨dockerçš„å‘½ä»¤ï¼ŒæŸ¥çœ‹ç°æœ‰é•œåƒå’Œæ­£åœ¨è¿è¡Œçš„å®¹å™¨<br>docker images<br>docker ps<br><span class="hljs-meta prompt_"># </span><span class="language-bash">docker composeå®‰è£…</span><br>curl -L &quot;https://github.com/docker/compose/releases/download/1.29.0/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo apt-get update<br>sudo apt-get install apt-transport-https ca-certificates curl gnupg-agent software-properties-common<br>curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -<br>sudo add-apt-repository &quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable&quot;<br><br>sudo apt-get update<br>sudo apt-get install docker-ce docker-ce-cli containerd.io<br></code></pre></td></tr></table></figure><h3 id="docker-æ¢æº"><a href="#docker-æ¢æº" class="headerlink" title="docker æ¢æº"></a>docker æ¢æº</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs shell">[root@localhost henryhzy]# vim /etc/docker/daemon.json  # åˆ›å»ºæˆ–ä¿®æ”¹ /etc/docker/daemon.json æ–‡ä»¶ï¼Œä¿®æ”¹ä¸ºå¦‚ä¸‹å½¢å¼<br>&#123;<br>    &quot;registry-mirrors&quot; : [<br>    &quot;https://docker.mirrors.ustc.edu.cn&quot;,<br>    &quot;http://hub-mirror.c.163.com&quot;,<br>    &quot;https://cr.console.aliyun.com/&quot;<br>  ]<br>&#125;<br><span class="hljs-meta prompt_">$ </span><span class="language-bash">systemctl daemon-reload</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">systemctl restart docker</span><br><span class="hljs-meta prompt_">$ </span><span class="language-bash">docker info</span><br></code></pre></td></tr></table></figure><h1 id="5ã€dockeræ­å»ºä¸ªäººåšå®¢"><a href="#5ã€dockeræ­å»ºä¸ªäººåšå®¢" class="headerlink" title="5ã€dockeræ­å»ºä¸ªäººåšå®¢"></a>5ã€dockeræ­å»ºä¸ªäººåšå®¢</h1><h3 id="å®‰è£…docker-compose"><a href="#å®‰è£…docker-compose" class="headerlink" title="å®‰è£…docker-compose"></a>å®‰è£…docker-compose</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell">å…ˆè¾“å…¥å‘½ä»¤å®‰è£…docker-compose<br>sudo curl -L &quot;https://github.com/docker/compose/releases/download/1.26.0/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose<br>sudo chmod +x /usr/local/bin/docker-compose<br>sudo ln -s /usr/local/bin/docker-compose /usr/bin/docker-compose<br><br>æµ‹è¯•å·²ä¸‹ç‰ˆæœ¬<br>docker-compose --version<br>æ˜¾ç¤ºdocker-compose version 1.26.0, build d4451659<br><br>å†æ‹‰ä¸¤ä¸ªé•œåƒ<br>docker pull wordpress<br><br>docker pull mysql:5.6<br><br>å»ºä¸€ä¸ªæ–‡ä»¶å¤¹æ”¾wordpress bolg<br>mkdir -p /wang/wordpress<br></code></pre></td></tr></table></figure><h3 id="viå‘½ä»¤-åˆ›å»ºä¸€ä¸ªdocker-compose-yml"><a href="#viå‘½ä»¤-åˆ›å»ºä¸€ä¸ªdocker-compose-yml" class="headerlink" title="viå‘½ä»¤ åˆ›å»ºä¸€ä¸ªdocker-compose.yml"></a>viå‘½ä»¤ åˆ›å»ºä¸€ä¸ªdocker-compose.yml</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">vim docker-compose.yml<br></code></pre></td></tr></table></figure><h3 id="æŠŠä¸‹æ–‡å†…å®¹å†™è¿›docker-compose-ymlé‡Œé¢"><a href="#æŠŠä¸‹æ–‡å†…å®¹å†™è¿›docker-compose-ymlé‡Œé¢" class="headerlink" title="æŠŠä¸‹æ–‡å†…å®¹å†™è¿›docker-compose.ymlé‡Œé¢"></a>æŠŠä¸‹æ–‡å†…å®¹å†™è¿›docker-compose.ymlé‡Œé¢</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs shell">version: &#x27;3&#x27;<br>services:<br>  wordpress:<br>    image: wordpress<br>    restart: always<br>    ports:<br>      - 80:9090<br>    environment:<br>      WORDPRESS_DB_HOST: db<br>      WORDPRESS_DB_USER: exampleuser<br>      WORDPRESS_DB_PASSWORD: examplepass<br>      WORDPRESS_DB_NAME: exampledb<br>    networks:<br>      - wang-net<br>    volumes:<br>      - wordpress:/var/www/html<br><br>  db:<br>    image: mysql:5.6<br>    restart: always<br>    environment:<br>      MYSQL_DATABASE: exampledb<br>      MYSQL_USER: exampleuser<br>      MYSQL_PASSWORD: examplepass<br>      MYSQL_RANDOM_ROOT_PASSWORD: &#x27;1&#x27;<br>    volumes:<br>      - db:/var/lib/mysql<br>    networks:<br>      - wang-net<br><br>volumes:<br>  wordpress:<br>  db:<br>  <br>networks:<br>  wang-net:<br>    driver: bridge<br></code></pre></td></tr></table></figure><h3 id="å†æ‰§è¡Œå‘½ä»¤å¯åŠ¨è¿™ä¸ªcompose"><a href="#å†æ‰§è¡Œå‘½ä»¤å¯åŠ¨è¿™ä¸ªcompose" class="headerlink" title="å†æ‰§è¡Œå‘½ä»¤å¯åŠ¨è¿™ä¸ªcompose"></a>å†æ‰§è¡Œå‘½ä»¤å¯åŠ¨è¿™ä¸ªcompose</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">docker-compose up -d<br></code></pre></td></tr></table></figure><h1 id="6ã€dockeré…ç½®æ•°æ®åº“"><a href="#6ã€dockeré…ç½®æ•°æ®åº“" class="headerlink" title="6ã€dockeré…ç½®æ•°æ®åº“"></a>6ã€dockeré…ç½®æ•°æ®åº“</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>other</category>
      
    </categories>
    
    
    <tags>
      
      <tag>éƒ¨ç½²</tag>
      
      <tag>wsl</tag>
      
      <tag>windows</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€pythonã€‘djangoAdminéƒ¨ç½²è®°å½•</title>
    <link href="/2023/12/15/djangoAdmin%E9%83%A8%E7%BD%B2%E8%AE%B0%E5%BD%95/"/>
    <url>/2023/12/15/djangoAdmin%E9%83%A8%E7%BD%B2%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<h1 id="éƒ¨ç½²ç¬”è®°"><a href="#éƒ¨ç½²ç¬”è®°" class="headerlink" title="éƒ¨ç½²ç¬”è®°"></a>éƒ¨ç½²ç¬”è®°</h1><h1 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h1><blockquote><p>Python &gt;&#x3D; 3.8.0 (æ¨è3.9+ç‰ˆæœ¬)<br>nodejs &gt;&#x3D; 14.0 (æ¨èæœ€æ–°)<br>Mysql &gt;&#x3D; 5.7.0 (å¯é€‰ï¼Œé»˜è®¤æ•°æ®åº“sqlite3ï¼Œæ¨è8.0ç‰ˆæœ¬)<br>Redis(å¯é€‰ï¼Œæœ€æ–°ç‰ˆ)</p></blockquote><h2 id="åç«¯ä»£ç "><a href="#åç«¯ä»£ç " class="headerlink" title="åç«¯ä»£ç "></a>åç«¯ä»£ç </h2><h3 id="æ‹‰ä»£ç éƒ¨ç½²"><a href="#æ‹‰ä»£ç éƒ¨ç½²" class="headerlink" title="æ‹‰ä»£ç éƒ¨ç½²"></a>æ‹‰ä»£ç éƒ¨ç½²</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_"># </span><span class="language-bash">æ‹‰ä»£ç </span><br>è¿›å…¥åç«¯é¡¹ç›®ç›®å½•:cd backend<br>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸­ï¼Œå¤åˆ¶ ./conf/env.example.py æ–‡ä»¶ä¸ºä¸€ä»½æ–°çš„åˆ° ./conf/env.py ä¸‹ï¼Œå¹¶é‡å‘½åä¸ºenv.py<br>åœ¨ env.py ä¸­é…ç½®æ•°æ®åº“ä¿¡æ¯(é»˜è®¤æ•°æ®åº“ä¸ºsqlite3ï¼Œæµ‹è¯•æ¼”ç¤ºå¯å¿½ç•¥æ­¤æ­¥éª¤)<br><span class="hljs-meta prompt_"># </span><span class="language-bash">docker éƒ¨ç½²mysql</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">dockeråˆ›å»ºæ•°æ®åº“ DATABASE_NAME = <span class="hljs-string">&#x27;django-vue-admin&#x27;</span> <span class="hljs-comment"># mysql æ—¶ä½¿</span></span><br>å®‰è£…ä¾èµ–ç¯å¢ƒ: pip3 install -r requirements.txt<br>å¦‚æœæœ‰ç¢°åˆ°mysqlclient æ— æ³•å®‰è£…çš„æ—¶å€™ï¼ŒæŸ¥ä¸€ä¸‹æ‰‹å†Œï¼Œmacæ˜¯è¦brew install mysql <br>æ‰§è¡Œè¿ç§»å‘½ä»¤: python3 manage.py makemigrations python3 manage.py migrate<br>åˆå§‹åŒ–æ•°æ®: python3 manage.py init<br>åˆå§‹åŒ–çœå¸‚å¿æ•°æ®: python3 manage.py init_area<br>å¯åŠ¨é¡¹ç›®: python3 manage.py runserver 0.0.0.0:8000<br><span class="hljs-meta prompt_"># </span><span class="language-bash">docker éƒ¨ç½²mysql</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">dockeråˆ›å»ºæ•°æ®åº“ DATABASE_NAME = <span class="hljs-string">&#x27;django-vue-admin&#x27;</span> <span class="hljs-comment"># mysql æ—¶ä½¿ç”¨</span></span><br><br></code></pre></td></tr></table></figure><h3 id="æ”¹éªŒè¯ç é€»è¾‘"><a href="#æ”¹éªŒè¯ç é€»è¾‘" class="headerlink" title="æ”¹éªŒè¯ç é€»è¾‘"></a>æ”¹éªŒè¯ç é€»è¾‘</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># åœ¨ login.pyæ–‡ä»¶çš„ç¬¬85è¡Œ æ”¹</span><br>            <span class="hljs-keyword">else</span>:<br>                <span class="hljs-keyword">if</span> self.image_code <span class="hljs-keyword">and</span> ((<br>                                                self.image_code.response == captcha<br>                                                <span class="hljs-keyword">or</span> self.image_code.challenge == captcha<br>                                        ) <span class="hljs-keyword">or</span> captcha.isdigit() <span class="hljs-keyword">and</span> <span class="hljs-built_in">len</span>(captcha) == <span class="hljs-number">6</span>):<br>                    self.image_code <span class="hljs-keyword">and</span> self.image_code.delete()<br>                <span class="hljs-keyword">else</span>:<br>                    self.image_code <span class="hljs-keyword">and</span> self.image_code.delete()<br>                    <span class="hljs-keyword">raise</span> CustomValidationError(<span class="hljs-string">&quot;å›¾ç‰‡éªŒè¯ç é”™è¯¯&quot;</span>)<br></code></pre></td></tr></table></figure><h3 id="å†å¯æœåŠ¡"><a href="#å†å¯æœåŠ¡" class="headerlink" title="å†å¯æœåŠ¡"></a>å†å¯æœåŠ¡</h3><p>æ‰§è¡Œè¿ç§»å‘½ä»¤: python3 manage.py makemigrations python3 manage.py migrate<br>åˆå§‹åŒ–æ•°æ®: python3 manage.py init<br>åˆå§‹åŒ–çœå¸‚å¿æ•°æ®: python3 manage.py init_area<br>å¯åŠ¨é¡¹ç›®: python3 manage.py runserver 0.0.0.0:8000</p><p>è®¿é—®åœ°å€ï¼š[<a href="http://localhost:8000/">http://localhost:8000</a></p><h1 id="å‰ç«¯éƒ¨ç½²"><a href="#å‰ç«¯éƒ¨ç½²" class="headerlink" title="å‰ç«¯éƒ¨ç½²"></a>å‰ç«¯éƒ¨ç½²</h1><ol><li>è¿›å…¥å‰ç«¯é¡¹ç›®ç›®å½• <code>cd web</code></li><li>å®‰è£…ä¾èµ– <code>npm install --registry= https://registry.npmmirror.com</code><ol><li>æ³¨æ„ä¸€ä¸‹npmçš„æº npm config set registry <a href="https://registry.npmmirror.com/">https://registry.npmmirror.com</a></li><li>ä½ å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥çœ‹å½“å‰npmçš„ä¸‹è½½æºè®¾ç½®ï¼šnpm config get registry</li><li>å®‰è£…nodejs &gt;&#x3D; 14.0 (æ¨èæœ€æ–°)</li></ol></li><li>å¯åŠ¨æœåŠ¡ <code>npm run dev</code></li></ol><h1 id="è®¿é—®é¡¹ç›®"><a href="#è®¿é—®é¡¹ç›®" class="headerlink" title="è®¿é—®é¡¹ç›®"></a>è®¿é—®é¡¹ç›®</h1><ul><li>è®¿é—®åœ°å€ï¼š<a href="http://localhost:8080/">http://localhost:8080 (opens new window)</a>(é»˜è®¤ä¸ºæ­¤åœ°å€ï¼Œå¦‚æœ‰ä¿®æ”¹è¯·æŒ‰ç…§é…ç½®æ–‡ä»¶1)</li><li>è´¦å·ï¼š<code>superadmin</code> å¯†ç ï¼š<code>admin123456</code></li></ul>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>éƒ¨ç½²</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Golangã€‘goè¯­è¨€ä¹‹å¹¶å‘ç¼–ç¨‹åŸºç¡€ï¼ˆgoroutineã€channelã€SELECTï¼‰</title>
    <link href="/2023/12/07/802go%E8%AF%AD%E8%A8%80%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80%EF%BC%88goroutine%E3%80%81channel%E3%80%81SELECT%EF%BC%89/"/>
    <url>/2023/12/07/802go%E8%AF%AD%E8%A8%80%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%9F%BA%E7%A1%80%EF%BC%88goroutine%E3%80%81channel%E3%80%81SELECT%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<h1 id="å¹¶å‘ç¼–ç¨‹"><a href="#å¹¶å‘ç¼–ç¨‹" class="headerlink" title="å¹¶å‘ç¼–ç¨‹"></a>å¹¶å‘ç¼–ç¨‹</h1><h2 id="goä¸­çš„ä¸²è¡Œå’Œå¹¶è¡Œè¿˜æœ‰å¹¶å‘çš„æ¦‚å¿µ"><a href="#goä¸­çš„ä¸²è¡Œå’Œå¹¶è¡Œè¿˜æœ‰å¹¶å‘çš„æ¦‚å¿µ" class="headerlink" title="goä¸­çš„ä¸²è¡Œå’Œå¹¶è¡Œè¿˜æœ‰å¹¶å‘çš„æ¦‚å¿µ"></a>goä¸­çš„ä¸²è¡Œå’Œå¹¶è¡Œè¿˜æœ‰å¹¶å‘çš„æ¦‚å¿µ</h2><ul><li>ä¸²è¡Œï¼ˆSequentialï¼‰ï¼š<ul><li>ä¸²è¡Œæ˜¯ä¸€ç§<strong>æ‰§è¡Œæ–¹å¼</strong>ï¼Œä¸²è”è¡Œèµ°ï¼ŒæŒ‰ç…§é¡ºåºé€ä¸€çš„æ‰§è¡Œä»»åŠ¡æˆ–è€…æ“ä½œï¼Œ</li><li>åœ¨ä¸²è¡Œæ‰§è¡Œä¸­ï¼Œæ¯ä¸ªä»»åŠ¡å¿…é¡»ç­‰å¾…å‰ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œäº†ä¹‹åæ‰èƒ½å¼€å§‹æ‰§è¡Œ</li><li>åœºæ™¯ï¼šä¸²è¡Œæ‰§è¡Œé€šå¸¸ç”¨äºå•æ ¸æˆ–è€…å•çº¿ç¨‹ç¯å¢ƒï¼Œå…¶ä¸­ä¸€æ¬¡åªèƒ½æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œæ„å‘³ç€ä»»åŠ¡è¦æ‰¾ç°è¡Œé¡ºåºæ‰§è¡Œï¼Œä¸€ä¸ªæ¥ä¸€ä¸ªï¼Œç›´åˆ°æ‰€æœ‰çš„ä»»åŠ¡éƒ½å®Œæˆ</li><li>ä¸²è¡Œæ‰§è¡Œé€šå¸¸å…·æœ‰å¯é¢„æµ‹è¡Œï¼Œå› ä¸ºä»»åŠ¡çš„æ‰§è¡Œé¡ºåºæ˜¯ç¡®å®šçš„ï¼Œ</li><li>ç¼ºç‚¹å°±æ˜¯åœ¨å¤šæ ¸ç³»ç»Ÿä¸­ï¼Œæ— æ³•å……åˆ†çš„åˆ©ç”¨ç¡¬ä»¶èµ„æº</li></ul></li><li>å¹¶è¡Œï¼ˆParallelï¼‰ï¼š<ul><li>å¹¶è¡Œä¹Ÿæ˜¯ä¸€ç§<strong>æ‰§è¡Œæ–¹å¼</strong> ï¼Œ</li><li>å¤šä¸ªä»»åŠ¡æˆ–è€…æ“ä½œå¯ä»¥åŒæ—¶çš„æ‰§è¡Œï¼Œä¸å¿…ç­‰å¾…å‰ä¸€ä¸ªä»»åŠ¡å®Œæˆï¼Œ</li><li>å……åˆ†åˆ©ç”¨å¤šæ ¸å¤„ç†å™¨æˆ–è€…å¤šçº¿ç¨‹ç¯å¢ƒçš„ä¼˜åŠ¿</li></ul></li><li>å¹¶å‘ï¼ˆConcurrencyï¼‰ï¼š<ul><li>å¹¶å‘æ˜¯ä¸€ä¸ªæ›´å¹¿æ³›çš„<strong>æ¦‚å¿µ</strong>ï¼Œåœ¨åŒä¸€æ—¶é—´æ®µå†…å¤„ç†å¤šä¸ªä»»åŠ¡ï¼Œä½†ä¸ä¸€å®šè¦æ±‚åŒæ—¶æ‰§è¡Œã€‚åœ¨å¹¶å‘ä¸­ï¼Œä»»åŠ¡å¯ä»¥äº¤æ›¿æ‰§è¡Œï¼Œæ¯ä¸ªä»»åŠ¡éƒ½æœ‰è‡ªå·±çš„æ‰§è¡Œå‘¨æœŸï¼Œå¹¶å‘é€šå¸¸æ¶‰åŠçš„æ˜¯å¤šä¸ªç‹¬ç«‹çš„æ‰§è¡Œçº¿ç¨‹ã€è¿›ç¨‹æˆ–è€…åç¨‹ã€‚</li><li>å¹¶å‘ä¸ä¸€å®šéœ€è¦å¤šæ ¸å¤„ç†å™¨ï¼Œå®ƒå¯ä»¥åœ¨å•æ ¸å¤„ç†å™¨ä¸Šæ¨¡æ‹Ÿé€šè¿‡å¿«é€Ÿåˆ‡æ¢æ‰§è¡Œçº¿ç¨‹æ¥å®ç°ã€‚</li><li>å¹¶å‘é€šå¸¸ç”¨äºæé«˜ç³»ç»Ÿçš„ååé‡ã€èµ„æºåˆ©ç”¨ç‡å’Œå“åº”æ€§ï¼Œç‰¹åˆ«æ˜¯IOå¯†é›†å‹åº”ç”¨ä¸­ã€‚</li><li>å¹¶å‘ä»»åŠ¡ä¹‹é—´å¯èƒ½éœ€è¦åè°ƒã€åŒæ­¥å’Œå…±äº«æ•°æ®ï¼Œå› æ­¤éœ€è¦å°å¿ƒå¤„ç†å¹¶å‘é—®é¢˜ï¼Œå¦‚ç«äº‰æ¡ä»¶å’Œæ­»é”ç­‰</li></ul></li><li>æ€»ç»“ï¼š<ul><li>ä¸²è¡Œæ˜¯æŒ‡æŒ‰é¡ºåºæ‰§è¡Œä»»åŠ¡çš„æ–¹æ³•ï¼Œä¸æ¶‰åŠå¤šä¸ªä»»åŠ¡ä¹‹é—´çš„äº¤æ›¿æ‰§è¡Œ</li><li>å¹¶è¡Œæ˜¯å¤šä¸ªä»»åŠ¡åŒæ—¶æ‰§è¡Œçš„æ–¹å¼ï¼Œé€šå¸¸éœ€è¦å¤šæ ¸å¤„ç†å™¨æˆ–å¤šçº¿ç¨‹ç¯å¢ƒ</li><li>å¹¶å‘æ˜¯å¤šä¸ªä»»åŠ¡åœ¨åŒä¸€æ—¶é—´æ®µå†…å¤„ç†çš„æ–¹å¼ï¼Œå¯ä»¥æ˜¯äº¤æ›¿æ‰§è¡Œï¼Œé€šå¸¸æ¶‰åŠå¤šçº¿ç¨‹æˆ–åç¨‹ã€å¹¶éœ€è¦å¤„ç†å¹¶å‘ç›¸å…³é—®é¢˜ã€‚</li></ul></li></ul><h2 id="ã€æ‹“å±•ã€‘å¹¶å‘æ¨¡å‹"><a href="#ã€æ‹“å±•ã€‘å¹¶å‘æ¨¡å‹" class="headerlink" title="ã€æ‹“å±•ã€‘å¹¶å‘æ¨¡å‹"></a>ã€æ‹“å±•ã€‘å¹¶å‘æ¨¡å‹</h2><ul><li>ä¸»æµå¹¶å‘æ¨¡å‹æ— å¤–ä¹ä¸‰ç§<ul><li>1ã€å¤šçº¿ç¨‹ï¼šæ¯ä¸ªçº¿ç¨‹ä¸€æ¬¡å¤„ç†ä¸€ä¸ªè¯·æ±‚ï¼Œçº¿ç¨‹è¶Šå¤šå¯å¹¶å‘å¤„ç†çš„è¯·æ±‚æ•°å°±è¶Šå¤šï¼Œ<ul><li>ä½†æ˜¯åœ¨é«˜å¹¶å‘ä¸‹ï¼Œå¤šçº¿ç¨‹çš„å¼€é”€ä¼šæ¯”è¾ƒå¤§</li></ul></li><li>2ã€åç¨‹ï¼šæ— éœ€æŠ¢å å¼çš„è°ƒåº¦ï¼Œå¼€é”€å°ï¼Œå¯ä»¥æœ‰æ•ˆçš„æé«˜çº¿ç¨‹çš„å¹¶å‘æ€§ï¼Œä»è€Œé¿å…äº†çº¿ç¨‹çš„ç¼ºç‚¹é‚£éƒ¨åˆ†</li><li>3ã€åŸºäºå¼‚æ­¥å›è°ƒçš„IOæ¨¡å‹ï¼šå¼‚æ­¥ç¼–ç¨‹ï¼Œå½“é‡åˆ°å¯†é›†IOçš„æ—¶å€™ï¼Œç­‰å¾…ï¼Œè®©å…¶ä»–ç¨‹åºç»§ç»­è·‘</li></ul></li></ul><h2 id="goroutineçš„åŸºæœ¬æ¦‚å¿µ"><a href="#goroutineçš„åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="goroutineçš„åŸºæœ¬æ¦‚å¿µ"></a>goroutineçš„åŸºæœ¬æ¦‚å¿µ</h2><ul><li><strong>æ¦‚å¿µ</strong>ï¼šæ˜¯ä¸€ç§<strong>è½»é‡çº§çš„çº¿ç¨‹</strong>ï¼Œç”¨äºæ‰§è¡Œç¨‹åºå¹¶å‘ä»»åŠ¡ï¼Œä¸ä¼ ç»Ÿçº¿ç¨‹ç›¸æ¯”ï¼Œgoroutinesæ›´åŠ è½»é‡ä¸”æ¶ˆè€—æ›´å°‘ï¼Œ</li></ul><p><em>routine:å¸¸è§„ï¼›ä¾‹è¡Œç¨‹åºï¼›æ—¥å¸¸å·¥ä½œ</em></p><p>ä¸åˆ›å»ºçº¿ç¨‹ç›¸æ¯”ï¼Œåˆ›å»ºæˆæœ¬å’Œå¼€é”€éƒ½å¾ˆå°ï¼Œæ¯ä¸ªgoroutineçš„å †æ ˆåªæœ‰å‡ kbï¼Œå¹¶ä¸”å †æ ˆå¯æ ¹æ®ç¨‹åºçš„éœ€è¦å¢é•¿å’Œç¼©å°ï¼ˆçº¿ç¨‹çš„å †æ ˆæ˜¯éœ€è¦æŒ‡æ˜å’Œå›ºå®šçš„ï¼‰ï¼Œæ‰€ä»¥goè¯­è¨€ä»è¯­è¨€å±‚é¢å°±æ”¯æŒé«˜å¹¶å‘ã€‚</p><ul><li>å¹¶å‘æ‰§è¡Œï¼šå¤šä¸ªgoroutineså¯ä»¥åŒæ—¶è¿è¡Œï¼Œä¸”ä¸éœ€è¦æ˜¾å¼çš„çº¿ç¨‹ç®¡ç†ï¼Œæœ‰åŠ©äºå……åˆ†åˆ©ç”¨å¤šæ ¸å¤„ç†å™¨ï¼Œæé«˜ç¨‹åºçš„æ€§èƒ½</li><li>è½»é‡çº§ï¼šgoroutinesæ¯”ä¼ ç»Ÿçº¿ç¨‹æ›´è½»é‡ã€‚è¿™ä¸ªè½»é‡å¯ä»¥é€šä¿—ç†è§£ä¸ºåˆ›å»ºå’Œé”€æ¯ä»–ä»¬çš„æˆæœ¬å¾ˆä½ï¼Œé€šå¸¸æ•°ç™¾ä¸Šåƒçš„goroutineså¯ä»¥åœ¨åŒä¸€ä¸ªç¨‹åºä¸­è¿è¡Œè€Œä¸ä¼šå¼•å‘æ€§èƒ½é—®é¢˜</li><li>å¹¶å‘é€šä¿¡ï¼šgoruntinesä¹‹é—´çš„å¯ä»¥é€šè¿‡é€šé“ï¼ˆchannelï¼‰è¿›è¡Œå®‰å…¨çš„å¹¶å‘é€šä¿¡ï¼Œé€šé“æ˜¯goroutinesä¹‹é—´äº¤æ¢æ•°æ®çš„ä¸€ç§æœºåˆ¶ï¼Œé¿å…äº†ç«äº‰æ¡ä»¶å’Œåè°ƒä»»åŠ¡</li><li>å¹¶å‘æ¨¡å‹ï¼šGo è¯­è¨€çš„å¹¶å‘æ¨¡å‹æ˜¯åŸºäº CSPï¼ˆCommunicating Sequential Processesï¼‰çš„ï¼Œå®ƒå¼ºè°ƒé€šè¿‡é€šä¿¡æ¥å…±äº«æ•°æ®ï¼Œè€Œä¸æ˜¯å…±äº«æ•°æ®æ¥é€šä¿¡ã€‚è¿™ç§æ¨¡å‹ä½¿å¹¶å‘ç¼–ç¨‹æ›´åŠ å®‰å…¨å’Œå¯ç»´æŠ¤ã€‚</li><li>å¦‚ä½•<strong>å¯åŠ¨ goroutine</strong>ï¼šè¦å¯åŠ¨ä¸€ä¸ªgoroutineï¼Œåªéœ€è¦åœ¨å‡½æ•°æˆ–æ–¹æ³•è°ƒç”¨å‰åŠ ä¸Šå…³é”®å­—â€™goâ€™ å³å¯åˆ›å»ºä¸€ä¸ªæ–°çš„goroutineæ¥æ‰§è¡Œè¯¥å‡½æ•°ï¼Œç¨‹åºç»§ç»­æ‰§è¡Œåç»­ä»»åŠ¡ï¼Œè€Œä¸ä¼šç­‰å¾…goroutineå®Œæˆ</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    <span class="hljs-comment">// å¯åŠ¨ä¸€ä¸ª Goroutine æ‰§è¡Œ hello å‡½æ•°</span><br>    <span class="hljs-keyword">go</span> hello()<br><br>    <span class="hljs-comment">// ä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡</span><br>    fmt.Println(<span class="hljs-string">&quot;Main function&quot;</span>)<br><br>    <span class="hljs-comment">// ç­‰å¾…ä¸€æ®µæ—¶é—´ä»¥ç¡®ä¿ Goroutine æœ‰è¶³å¤Ÿçš„æ—¶é—´æ‰§è¡Œ</span><br>    time.Sleep(time.Second)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">hello</span><span class="hljs-params">()</span></span> &#123;<br>    fmt.Println(<span class="hljs-string">&quot;Hello, Goroutine!&quot;</span>)<br>&#125;<br><br></code></pre></td></tr></table></figure><ul><li>ç¨‹åºæ‰§è¡Œçš„èƒŒåï¼šå½“ç¨‹åºå¯åŠ¨çš„æ—¶å€™ï¼Œåªæœ‰ä¸€ä¸ªgoroutineæ¥è°ƒç”¨mainå‡½æ•°ï¼Œå¯ä»¥ç†è§£ä¸ºä¸»goroutineï¼Œæ–°çš„goroutineé€šè¿‡goè¯­å¥è¿›è¡Œåˆ›å»º</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;time&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">DelayPrint</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">for</span> i := <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">4</span>; i++ &#123;<br>time.Sleep(<span class="hljs-number">250</span> * time.Millisecond)<br>fmt.Println(i)<br>&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">HelloWorld</span><span class="hljs-params">()</span></span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;Hello world goroutine&quot;</span>)<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">go</span> DelayPrint()    <span class="hljs-comment">// å¼€å¯ç¬¬ä¸€ä¸ªgoroutine</span><br><span class="hljs-keyword">go</span> HelloWorld()    <span class="hljs-comment">// å¼€å¯ç¬¬äºŒä¸ªgoroutine</span><br>time.Sleep(<span class="hljs-number">2</span>*time.Second)<br>fmt.Println(<span class="hljs-string">&quot;main function&quot;</span>)<br>&#125;<br><br></code></pre></td></tr></table></figure><ul><li><em>tipsï¼šDelayPrinté‡Œé¢çš„sleep ï¼Œä¼šå¯¼è‡´ç¬¬äºŒä¸ªgoroutineé˜»å¡æˆ–è€…ç­‰å¾…å—ï¼Ÿ</em><ul><li>ç­”æ¡ˆè‚¯å®šæ˜¯ä¸ä¼š</li></ul></li><li>å½“ç¨‹åºæ‰§è¡Œgo func()çš„æ—¶å€™ï¼Œåªæ˜¯ç®€å•çš„è°ƒç”¨ç„¶åå°±ç«‹å³è¿”å›äº†ï¼Œå¹¶ä¸å…³å¿ƒå‡½æ•°å†…éƒ¨å‘ç”Ÿçš„äº‹æƒ…ï¼Œæ‰€ä»¥ä¸åŒçš„goroutineç›´æ¥ä¸å½±å“ï¼Œmainä¼šç»§ç»­æŒ‰é¡ºåºæ‰§è¡Œè¯­å¥ï¼Œæ‰€ä»¥ä¸¤ä¸ªgo rountineåŒæ—¶åœ¨è·‘ï¼Œä½†æ˜¯è‚¯å®šæ˜¯ç¬¬ä¸€ä¸ªgorounineå…ˆæ‰§è¡Œ</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;time&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sayHello</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++ &#123;<br>fmt.Println(<span class="hljs-string">&quot;hello&quot;</span>)<br>fmt.Printf(<span class="hljs-string">&quot;è¿™æ˜¯sayHelloå‡½æ•°å†…æ‰“å°çš„ç¬¬%væ¬¡\n&quot;</span>, i)<br>time.Sleep(time.Millisecond * <span class="hljs-number">100</span>) <span class="hljs-comment">// æš‚åœç­‰å¾…100æ¯«ç§’</span><br>&#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">sayWorld</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++ &#123;<br>fmt.Println(<span class="hljs-string">&quot;world&quot;</span>)<br>fmt.Printf(<span class="hljs-string">&quot;è¿™æ˜¯sayWorldå‡½æ•°å†…æ‰“å°çš„ç¬¬%væ¬¡\n&quot;</span>, i)<br>time.Sleep(time.Millisecond * <span class="hljs-number">100</span>) <span class="hljs-comment">// æš‚åœç­‰å¾…100æ¯«ç§’</span><br><br>&#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-comment">// sayHello()</span><br><span class="hljs-keyword">go</span> sayHello() <span class="hljs-comment">//åœ¨å‡½æ•°å‰é¢åŠ ä¸€ä¸ªgoå…³é”®å­—å°±å°†è¿™ä¸ªå‡½æ•°å•ç‹¬çš„æ”¾åœ¨ä¸€ä¸ªGoroutineä¸­æ‰§è¡Œï¼Œä¸ä¸»Goroutineå¹¶è¡Œæ‰§è¡Œ</span><br><span class="hljs-keyword">go</span> sayWorld()<br>fmt.Println(<span class="hljs-string">&quot;è¿™å¥è¯å…ˆèµ°è¿˜æ˜¯åèµ°&quot;</span>)<br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++ &#123;<br>fmt.Println(<span class="hljs-string">&quot;yes&quot;</span>)<br>fmt.Printf(<span class="hljs-string">&quot;è¿™æ˜¯mainå‡½æ•°å†…æ‰“å°çš„ç¬¬%væ¬¡\n&quot;</span>, i)<br>time.Sleep(time.Millisecond * <span class="hljs-number">100</span>) <span class="hljs-comment">// æš‚åœç­‰å¾…100æ¯«ç§’</span><br>&#125;<br><br><span class="hljs-comment">// time.Sleep(time.Second)</span><br>&#125;<br><span class="hljs-comment">/*</span><br><span class="hljs-comment">è¾“å‡ºå†…å®¹å¦‚ä¸‹ï¼š</span><br><span class="hljs-comment">è¿™å¥è¯å…ˆèµ°è¿˜æ˜¯åèµ°</span><br><span class="hljs-comment">yes</span><br><span class="hljs-comment">è¿™æ˜¯mainå‡½æ•°å†…æ‰“å°çš„ç¬¬0æ¬¡</span><br><span class="hljs-comment">world</span><br><span class="hljs-comment">è¿™æ˜¯sayWorldå‡½æ•°å†…æ‰“å°çš„ç¬¬0æ¬¡</span><br><span class="hljs-comment">hello</span><br><span class="hljs-comment">è¿™æ˜¯sayHelloå‡½æ•°å†…æ‰“å°çš„ç¬¬0æ¬¡</span><br><span class="hljs-comment">*/</span><br></code></pre></td></tr></table></figure><ul><li>è¿™é‡Œä»è¾“å‡ºå†…å®¹çœ‹å¾—å‡ºæ¥ï¼Œå½“ç¨‹åºç¢°åˆ°go func()çš„æ—¶å€™ï¼Œå¹¶ä¸ç®¡go func()çš„å†…å®¹ï¼Œç›´æ¥å°±å»æ‰§è¡Œåé¢çš„ä»£ç äº†</li></ul><h2 id="é€šé“ï¼ˆchannelï¼‰"><a href="#é€šé“ï¼ˆchannelï¼‰" class="headerlink" title="é€šé“ï¼ˆchannelï¼‰"></a>é€šé“ï¼ˆchannelï¼‰</h2><p>æ¦‚å¿µï¼š</p><ul><li>é€šé“æ˜¯ä»€ä¹ˆï¼šæ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œæ‰€ä»¥é€šé“å¯ä»¥ç”¨var æ¥å£°æ˜æ•°æ®çš„ç±»å‹çš„</li><li>å¹²ä»€ä¹ˆï¼Ÿï¼šé€šé“æ˜¯ä¸€ç§åœ¨goroutinesä¹‹é—´ä¼ é€’çš„æ•°æ®ç»“æ„ï¼Œå®ƒç±»ä¼¼äºä¸€ä¸ª<strong>é˜Ÿåˆ—</strong>ï¼ŒåŒäºåœ¨é€šé“ä¸é€šé“ä¹‹é—´<strong>å‘é€å’Œæ¥æ”¶æ•°æ®çš„</strong></li><li>é€šé“çš„ç±»å‹ï¼šé“ä¸­ä¼ é€’çš„æ•°æ®å¿…é¡»ä¸é€šé“çš„ç±»å‹åŒ¹é…ã€‚é€šé“ç±»å‹ä½¿ç”¨ <code>chan</code> å…³é”®å­—ï¼Œå¦‚ <code>chan int</code> è¡¨ç¤ºä¸€ä¸ªæ•´æ•°ç±»å‹çš„é€šé“ã€‚</li><li>å‘é€å’Œæ¥æ”¶ï¼šé€šé“çš„åŸºæœ¬æ“ä½œæœ‰å‘é€ï¼ˆ<code>send</code>ï¼‰å’Œæ¥æ”¶ï¼ˆ<code>receive</code>ï¼‰ã€‚é€šè¿‡é€šé“å‘é€æ•°æ®æ—¶ï¼Œæ•°æ®ä¼šè¢«å‘é€åˆ°é€šé“ï¼Œç„¶åå¯ä»¥åœ¨å¦ä¸€ä¸ª Goroutine ä¸­æ¥æ”¶ã€‚</li><li>é˜»å¡ï¼šå½“å‘é€æˆ–æ¥æ”¶æ“ä½œå‘ç”Ÿæ—¶ï¼Œå®ƒä»¬å¯èƒ½ä¼š<strong>é˜»å¡</strong>å½“å‰ Goroutineï¼Œç›´åˆ°æœ‰å¦ä¸€ä¸ª Goroutine å‡†å¤‡å¥½æ¥æ”¶æˆ–å‘é€æ•°æ®ã€‚è¿™æœ‰åŠ©äºåŒæ­¥ä¸åŒ Goroutines ä¹‹é—´çš„æ“ä½œã€‚<ul><li><strong>ä»channelä¸­è¯»å–æ•°æ®ï¼Œå¦‚æœchannelä¹‹å‰æ²¡æœ‰å†™å…¥æ•°æ®ï¼Œä¹Ÿä¼šå¯¼è‡´é˜»å¡ï¼Œç›´åˆ°channelä¸­è¢«å†™å…¥æ•°æ®ä¸ºæ­¢</strong></li></ul></li></ul><p>å¼ºè°ƒä¸€ä¸‹ï¼š</p><ul><li>é€šé“æ˜¯åœ¨ä¼ é€’æ•°æ®ï¼Œè€Œä¸æ˜¯åœ¨èµ‹å€¼æ•°æ®ï¼Œå½“é€šé“A ä½“å†…çš„æ•°æ®ï¼Œä¼ ç»™äº†Bçš„æ—¶å€™ï¼ŒAå°±æ²¡æœ‰æ•°æ®äº†ï¼Œå°±ç©ºäº†ï¼ŒBå°±æ¥æ”¶åˆ°äº†Bå°±æœ‰äº†</li></ul><p>æ¥æ”¶æ“ä½œï¼ˆ<code>&lt;-channel</code>ï¼‰ã€å‘é€æ“ä½œï¼ˆ<code>channel &lt;- data</code>ï¼‰æˆ–å…³é—­æ“ä½œï¼ˆ<code>close(channel)</code>ï¼‰ã€‚</p><p>å£°æ˜ï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> ch <span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>      <span class="hljs-comment">// å£°æ˜ä¸€ä¸ªä¼ é€’intç±»å‹çš„channel</span><br>ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>) <span class="hljs-comment">// ä½¿ç”¨å†…ç½®å‡½æ•°make()å®šä¹‰ä¸€ä¸ªchannel</span><br><br>ch &lt;- value          <span class="hljs-comment">// å°†ä¸€ä¸ªæ•°æ®valueå†™å…¥è‡³channelï¼Œè¿™ä¼šå¯¼è‡´é˜»å¡ï¼Œç›´åˆ°æœ‰å…¶ä»–goroutineä»è¿™ä¸ªchannelä¸­è¯»å–æ•°æ®</span><br>value := &lt;-ch        <span class="hljs-comment">// ä»channelä¸­è¯»å–æ•°æ®ï¼Œå¦‚æœchannelä¹‹å‰æ²¡æœ‰å†™å…¥æ•°æ®ï¼Œä¹Ÿä¼šå¯¼è‡´é˜»å¡ï¼Œç›´åˆ°channelä¸­è¢«å†™å…¥æ•°æ®ä¸ºæ­¢</span><br><span class="hljs-comment">//=========</span><br><span class="hljs-built_in">close</span>(ch)            <span class="hljs-comment">// å…³é—­channel</span><br>c := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>)<br>fmt.Println(<span class="hljs-built_in">len</span>(c))  <span class="hljs-comment">// é€šé“å†…å®é™…ä½¿ç”¨é•¿åº¦ï¼Œ</span><br>fmt.Println(<span class="hljs-built_in">cap</span>(c))  <span class="hljs-comment">// é€šé“çš„å®¹ç§¯é•¿åº¦ï¼Œ</span><br><br></code></pre></td></tr></table></figure><p>ç±»å‹ï¼šé€šé“ç†è®ºä¸Šæ¥è¯´å¯ä»¥åˆ†2ç§</p><ul><li><p>æ— ç¼“å†²é€šé“å’Œç¼“å†²é€šé“</p></li><li><p>æ— ç¼“å†²é€šé“ï¼šæ— ç¼“å†²é€šé“ä¸Šçš„<strong>å‘é€</strong>æ“ä½œå°†ä¼šè¢«é˜»å¡ï¼Œ<strong>ç›´åˆ°</strong>å¦ä¸€ä¸ªgoroutineåœ¨å¯¹åº”çš„é€šé“ä¸Šæ‰§è¡Œ<strong>æ¥æ”¶</strong>æ“ä½œï¼Œæ­¤æ—¶å€¼æ‰ä¼ é€å®Œæˆï¼Œä¸¤ä¸ªGoroutineéƒ½ç»§ç»­æ‰§è¡Œï¼ˆå‘é€æ—¶é˜»å¡ï¼Œç›´åˆ°æ¥æ”¶æ‰ä¼šç•…é€šç»§ç»­ï¼‰ </p><ul><li>å®šä¹‰çš„æ—¶å€™ï¼Œä¸ç»™å¤§å°å°±æ˜¯ä¸€ä¸ªæ— ç¼“å†²é€šé“äº†ï¼Œch:&#x3D;make(chan int) int<strong>åé¢ä¸è®¾å®¹é‡</strong></li></ul></li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> done <span class="hljs-keyword">chan</span> <span class="hljs-type">bool</span> <span class="hljs-comment">//ï¼šè¿™é‡Œå£°æ˜äº†ä¸€ä¸ªåä¸º done çš„å¸ƒå°”ç±»å‹é€šé“ ç”¨æ¥è¿›è¡Œé€šé“ä¹‹é—´æ•°æ®é€šè®¯</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">HelloWorld</span><span class="hljs-params">()</span></span> &#123;<br>fmt.Println(<span class="hljs-string">&quot; hello world channel&quot;</span>) <span class="hljs-comment">//æ‰“å°ï¼Œè¿™é‡Œæ³¨æ„ä¸‹ï¼Œä¸‹é¢æœ‰ç”¨</span><br>time.Sleep(time.Millisecond * <span class="hljs-number">500</span>)  <span class="hljs-comment">// ç­‰å¾…500ms</span><br>done &lt;- <span class="hljs-literal">true</span>                        <span class="hljs-comment">// è¿™é‡Œæ˜¯å‘doneè¿™ä¸ªchannel å‘é€æ•°æ®ï¼Œå‘é€çš„å†…å®¹æ˜¯ true å› ä¸ºä»–æ˜¯ä¸€ä¸ªboolç±»å‹çš„channel æ³¨æ„ï¼Œå‘é€æ•°æ®çš„æ—¶å€™å°†ä¼šé˜»å¡</span><br>&#125;<br><br><span class="hljs-comment">// func main() &#123;</span><br><span class="hljs-comment">// done = make(chan bool) //  åˆ›å»ºä¸€ä¸ªboolç±»å‹çš„channel åå­—å«done è¿™ä¸ªé€šé“å°†ç”¨äºç­‰å¾…helloWorldå‡½æ•°çš„å®Œæˆ åˆ†é…å†…å­˜äº†</span><br><span class="hljs-comment">// go HelloWorld() //å¯åŠ¨ä¸€ä¸ªæ–°çš„goroutine ç”¨æ¥æ‰§è¡ŒhelloWorldå‡½æ•°</span><br><span class="hljs-comment">// &lt;-done  // æ¥æ”¶æ“ä½œï¼Œå®ƒä» done é€šé“æ¥æ”¶æ•°æ®</span><br><span class="hljs-comment">// è¿™ä¸ªæ“ä½œä¼šé˜»å¡ï¼Œç›´åˆ° HelloWorld å‡½æ•°å‘é€æ•°æ®åˆ° done é€šé“ã€‚ä¸€æ—¦æ•°æ®åˆ°è¾¾ï¼Œç¨‹åºå°†ç»§ç»­æ‰§è¡Œï¼Œç„¶åé€€å‡º</span><br><span class="hljs-comment">// å¦‚æœæ²¡æœ‰å‘é€å’Œæ¥æ”¶é€šé“çš„æ“ä½œï¼Œé‚£ä¹ˆä¸»goroutineå‡½æ•°mainå°†ä¸ä¼šç­‰å¾…goroutineå‡½æ•°helloWorldç›´æ¥å®Œæˆå°±ä¼šç›´æ¥é€€å‡ºmianç»“æŸ</span><br><span class="hljs-comment">// &#125;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>)   <span class="hljs-comment">// makeå°±æ˜¯åˆ›å»ºäº†ä¸€ä¸ªchannelç±»å‹æ²¡æœ‰å®¹é‡ï¼ˆæ— ç¼“å†²ï¼‰ç±»å‹çš„å˜é‡åç§°ä¸ºch  åé¢æ²¡è®¾ç½®ç¼“å†²é€šé“çš„å¤§å°ï¼Œå°±æ˜¯æ— ç¼“å†² åˆ†é…å†…å­˜äº† </span><br><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(ch <span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>)</span></span> &#123; <span class="hljs-comment">// funcåŒ¿åå‡½æ•°ï¼Œgoæ˜¯è¡¨ç¤ºä»–æ˜¯goroutine å…¥å‚æ˜¯æ— ç¼“å†²channelç±»å‹ï¼Œ</span><br>fmt.Println(&lt;-ch) <span class="hljs-comment">// ä½¿ç”¨&lt;-channelæ¥æ¥æ”¶channelç±»å‹ ä½œç”¨æ˜¯å†²é€šé“chæ¥æ”¶æ•°æ®ï¼Œå¹¶ä¸”ç­”åº”å‡ºæ¥ï¼Œæ¥æ”¶åˆ°çš„æ˜¯å¤šå°‘å°±æ‰“å°å¤šå°‘</span><br>&#125;(ch)<br>ch &lt;- <span class="hljs-number">10</span> <span class="hljs-comment">//ä¸»å‡½æ•°mainå°†æ•´æ•°10å‘é€åˆ°ché€šé“ä¸­ï¼Œä½¿ç”¨&lt;- ç”¨æ¥å‘é€å’Œæ¥æ”¶ &lt;-å·¦è¾¹æ˜¯channelå°±ä»£è¡¨æƒ³chå‘é€ï¼Œ&lt;-å³è¾¹æ˜¯chå°±ä»£è¡¨åœ¨æ¥æ”¶channel</span><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">æ€»ä½“æ¥è¯´ï¼Œè¿™æ®µä»£ç çš„ä¸»è¦ç›®çš„æ˜¯åˆ›å»ºä¸€ä¸ªé€šé“ chï¼Œç„¶åå¯åŠ¨ä¸€ä¸ªåç¨‹ï¼Œ</span><br><span class="hljs-comment">è¯¥åç¨‹ä»é€šé“ ch ä¸­æ¥æ”¶æ•°æ®å¹¶å°†å…¶æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºã€‚</span><br><span class="hljs-comment">åŒæ—¶ï¼Œä¸»å‡½æ•°å°†æ•´æ•°å€¼ 10 å‘é€åˆ°é€šé“ ch ä¸­ã€‚ç”±äºé€šé“æ˜¯æ— ç¼“å†²çš„ï¼Œ</span><br><span class="hljs-comment">è¿™ä¸ªå‘é€æ“ä½œä¼šå¯¼è‡´åç¨‹è§£é™¤é˜»å¡ï¼Œæ¥æ”¶å¹¶æ‰“å°å€¼ 10ã€‚å› æ­¤ï¼Œä½ ä¼šåœ¨æ ‡å‡†è¾“å‡ºä¸­çœ‹åˆ° &quot;10&quot;ã€‚è¿™ä¸ªç¤ºä¾‹å±•ç¤ºäº† Go è¯­è¨€ä¸­çš„å¹¶å‘å’Œé€šé“çš„åŸºæœ¬ä½¿ç”¨ã€‚</span><br><span class="hljs-comment">*/</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li>é€šé“å¯ä»¥ç”¨æ¥è¿æ¥goroutineï¼Œè¿™æ ·ä¸€ä¸ªçš„è¾“å‡ºæ˜¯å¦ä¸€ä¸ªè¾“å…¥ã€‚è¿™å°±å«åšç®¡é“ã€‚</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> echo <span class="hljs-keyword">chan</span> <span class="hljs-type">string</span><br><span class="hljs-keyword">var</span> receive <span class="hljs-keyword">chan</span> <span class="hljs-type">string</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Echo</span><span class="hljs-params">()</span></span> &#123;<br>time.Sleep(time.Microsecond * <span class="hljs-number">500</span>)<br>echo &lt;- <span class="hljs-string">&quot;å’–å•¡è‰²çš„ç¾Šé©¼&quot;</span> <span class="hljs-comment">// è¿™é‡Œåœ¨å‘echoè¿™ä¸ªé€šé“å‘é€æ•°æ®</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Receive</span><span class="hljs-params">()</span></span> &#123;<br>temp := &lt;-echo <span class="hljs-comment">// æ¥æ”¶echoé€šé“ä¼ è¿‡æ¥çš„æ•°æ® è¿™é‡Œä¼šé˜»å¡ï¼Œç­‰å¾…æ•°æ®ä¼ è¾“ç»“æŸåï¼Œ</span><br>receive &lt;- temp <span class="hljs-comment">// å°†tempæ¥æ”¶è¿‡æ¥çš„é€šé“æ•°æ®ï¼Œä¼ ç»™receiveï¼Œ</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>echo = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">string</span>)<br>receive = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">string</span>)<br><br><span class="hljs-keyword">go</span> Echo()<br><span class="hljs-keyword">go</span> Receive()<br>getStrt := &lt;-receive  <span class="hljs-comment">// æ¥æ”¶ receive é€šé“ä¼ è¿‡æ¥çš„æ•°æ® </span><br>fmt.Println(getStrt) <br>&#125;<br><span class="hljs-comment">// åœ¨è¿™é‡Œä¸ä¸€å®šè¦å»å…³é—­channelï¼Œå› ä¸ºåº•å±‚çš„åƒåœ¾å›æ”¶æœºåˆ¶ä¼šæ ¹æ®å®ƒæ˜¯å¦å¯ä»¥è®¿é—®æ¥å†³å®šæ˜¯å¦è‡ªåŠ¨å›æ”¶å®ƒã€‚(è¿™é‡Œä¸æ˜¯æ ¹æ®channelæ˜¯å¦å…³é—­æ¥å†³å®šçš„)</span><br></code></pre></td></tr></table></figure><ul><li>å•å‘é€šé“ï¼š<ul><li>å•å‘å°±æ˜¯æŒ‡é™åˆ¶ä¸€å¤´é€šä¿¡ï¼Œæ¯”å¦‚é™åˆ¶ä»…æ¥æ”¶ï¼Œæˆ–è€…é™åˆ¶ä»…å‘é€æ•°æ®</li><li>åŒå‘é€šé“å¯ä»¥ä¿®æ”¹ä¸ºå•å‘é€šé“ï¼Œåä¹‹ä¸è¡Œ</li><li>å½“ç¨‹åºåˆ™å¤Ÿå¤æ‚çš„æ—¶å€™ï¼Œä¸ºäº†ä»£ç å¯è¯»æ€§æ›´é«˜ï¼Œæ‹†åˆ†æˆä¸€ä¸ªä¸€ä¸ªçš„å°å‡½æ•°æ˜¯éœ€è¦çš„ã€‚</li></ul></li></ul><p>goroutineçš„é€šé“é»˜è®¤æ˜¯é˜»å¡çš„ï¼Œé‚£ä¹ˆæœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥å»ç¼“è§£é˜»å¡å‘¢ï¼šï¼Ÿ</p><p><em>ç­”æ¡ˆï¼šåŠ ä¸€ä¸ªç¼“å†²åŒº</em></p><ul><li>ç¼“å†²é€šé“ï¼š ä¸€ä¸ªæœ‰å®¹é‡çš„é€šé“ï¼Œå¯ä»¥å®šä¹‰ä»–çš„å®¹ç§¯å¤§å°ã€‚</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs go">ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">string</span>, <span class="hljs-number">3</span>) <span class="hljs-comment">// åˆ›å»ºäº†ç¼“å†²åŒºä¸º3çš„é€šé“</span><br><br><span class="hljs-comment">//=========</span><br><span class="hljs-built_in">len</span>(ch)   <span class="hljs-comment">// é•¿åº¦è®¡ç®—</span><br><span class="hljs-built_in">cap</span>(ch)   <span class="hljs-comment">// å®¹é‡è®¡ç®—</span><br><br></code></pre></td></tr></table></figure><p><img src="/img/channel.png" alt="channel"></p><ul><li><strong>å½“ä»–ä½“å†…çš„å®¹ç§¯è¢«å¡æ»¡åï¼Œå°±ä¼šé˜»å¡</strong> ï¼Œå°±ä¼šæ­»é”</li><li>å¿…é¡»è¦è®©é€šé“ä½“å†…å…ƒç´ ä¸ªæ•°ä¸å¤§äºå…¶è®¾å®šçš„å®¹ç§¯å¤§å°ï¼Œä¸ç„¶å°±ä¼šæŠ¥é”™</li></ul><p>é€šé“æœ‰ç‚¹ç±»ä¼¼äºpythonçš„é”ä¸€æ ·ï¼Œè°æ‹¿åˆ°è¿™ä¸ªé”ï¼Œè°å°±å¯ä»¥æ“ä½œæ•°æ®ï¼Œé€šé“å°±æ˜¯è°è¿›å»äº†è¿™ä¸ªé€šé“ï¼Œè°å°±å¯ä»¥æ“ä½œè¿™ä¸ªé€šé“å†…çš„æ•°æ®ï¼Œå½“è¿™ä¸ªé€šé“å†…å¡æ»¡äº†çš„æ—¶å€™ï¼Œå°±å…³é—¨äº†ï¼Œè¿›ä¸å»äº†ã€‚</p><ul><li>å¯¹é€šé“å¾ªç¯å–å€¼ï¼š</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// å¯¹channelå¾ªç¯å–å€¼</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>ch1 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>, <span class="hljs-number">100</span>) <span class="hljs-comment">// ç»™ch1è¿™ä¸ªå˜é‡åˆ†é…äº†å†…å­˜ï¼ˆå®ä¾‹åŒ–äº†ï¼‰ æ˜¯ä¸€ä¸ªchanï¼Œé‡Œé¢çš„å†…å®¹æ˜¯intç±»å‹ï¼Œ100ä¸ªç©ºé—´</span><br>time.Sleep(time.Millisecond * <span class="hljs-number">100</span>)<br><span class="hljs-keyword">for</span> i := <span class="hljs-number">1</span>; i &lt; <span class="hljs-number">100</span>; i++ &#123;<br>ch1 &lt;- i <span class="hljs-comment">// å¾€è¿™ä¸ªch1é‡Œé¢å¡æ•°æ®ï¼ŒæŠŠiå¡è¿›å»äº†</span><br>&#125;<br><span class="hljs-built_in">close</span>(ch1) <span class="hljs-comment">// æ³¨æ„è¦å…³é—­é€šé“</span><br><span class="hljs-comment">// æ–¹å¼ 1 </span><br><br><span class="hljs-comment">// for &#123;</span><br><span class="hljs-comment">// a, err := &lt;-ch1</span><br><span class="hljs-comment">// if !err &#123;</span><br><span class="hljs-comment">// return</span><br><span class="hljs-comment">// &#125;</span><br><span class="hljs-comment">// fmt.Println(a)</span><br><span class="hljs-comment">// &#125;</span><br><span class="hljs-comment">// æ–¹å¼ 2 </span><br><span class="hljs-keyword">for</span> a := <span class="hljs-keyword">range</span> ch1 &#123;<br>fmt.Println(a)<br>&#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="goroutine-é˜»å¡æ­»é”å’Œå‹å¥½é€€å‡º"><a href="#goroutine-é˜»å¡æ­»é”å’Œå‹å¥½é€€å‡º" class="headerlink" title="goroutine é˜»å¡æ­»é”å’Œå‹å¥½é€€å‡º"></a>goroutine é˜»å¡æ­»é”å’Œå‹å¥½é€€å‡º</h2><h3 id="é”ï¼š"><a href="#é”ï¼š" class="headerlink" title="é”ï¼š"></a>é”ï¼š</h3><p>é”ç”¨æ¥æ§åˆ¶å¹¶å‘è®¿é—®å…±äº«èµ„æºçš„ä¸€ç§åŒæ­¥æœºåˆ¶é¿å…å¤šä¸ªgoroutineåŒäº‹è®¿é—®å’Œä¿®æ”¹ç›¸åŒçš„æ•°æ®ï¼Œä»è€Œå¯¼è‡´æ•°æ®ç«äº‰æˆ–è€…ä¸ä¸€è‡´çš„çŠ¶æ€ï¼Œ</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-comment">// é”çš„æ¦‚å¿µä¸ç†è§£</span><br><span class="hljs-comment">// å…ˆåˆ›å»ºä¸€ä¸ªé˜»å¡</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">//func main() &#123;</span><br><span class="hljs-comment">//ch1 := make(chan int) // åˆ›å»ºäº†ä¸€ä¸ªé€šé“ch1 å®ƒæ˜¯ä¸ªæ— ç¼“å†²é€šé“ï¼Œå®¹ç§¯æ˜¯0ï¼Œä½“å†…ç›®å‰æ•°æ®ä¹Ÿæ˜¯0</span><br><span class="hljs-comment">//&lt;-ch1 //æŠŠch1ä½“å†…çš„æ•°æ®ç»™å‡ºå»ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™ch1ä½“å†…æ˜¯æ²¡æ•°æ®çš„ï¼Œå°±é˜»å¡ï¼ˆdeadlockæ­»é”ï¼‰äº†ï¼Œè¿™ä¸ªæ—¶å€™é˜»å¡çš„mainå‡½æ•°goroutine ï¼Œé€šé“è¢«é”äº†</span><br><span class="hljs-comment">//// æç¤ºï¼šfatal error: all goroutines are asleep - deadlock!æ‰€æœ‰çš„goroutineéƒ½ç¡çœ é˜»å¡äº†ï¼Œ</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">// func main() &#123;</span><br><span class="hljs-comment">// ch1, ch2 := make(chan int), make(chan int) // åˆ›å»ºäº†ä¸¤ä¸ªé€šé“ï¼Œæ— ç¼“å†²çš„</span><br><span class="hljs-comment">// go func() &#123;</span><br><span class="hljs-comment">// ch1 &lt;- 1 // å¾€ch1é‡Œé¢å¡äº†ä¸ª1</span><br><span class="hljs-comment">// ch2 &lt;- 0 // ch2 é‡Œé¢ä¹Ÿå¡äº†ä¸ª0</span><br><br><span class="hljs-comment">// &#125;() //åé¢åŠ æ‹¬å·æ˜¯è¡¨ç¤ºè¿”å›å€¼</span><br><br><span class="hljs-comment">// &lt;-ch2 // æŠŠch2çš„æ•°æ®å–èµ°ï¼Œ</span><br><span class="hljs-comment">// // è¿™æ ·è¿è¡Œä¼šé˜»å¡ï¼ˆdeadlockæ­»é”ï¼‰ï¼Œå› ä¸ºå¾€ch1é‡Œé¢å¡äº†ä¸€ä¸ªæ•°æ®ï¼Œ</span><br><span class="hljs-comment">// // ä½†æ˜¯ch1æ˜¯ä¸ªæ— ç¼“å†²çš„é€šé“ï¼Œç°åœ¨ä»–çš„ä½“å†…è¢«å¡äº†ä¸€ä¸ªæ•°æ®ï¼Œå¦‚æœä¸æŠŠè¿™ä¸ªæ•°æ®å–èµ°ï¼Œå°±ä¼šé˜»å¡ï¼Œ</span><br><span class="hljs-comment">// // åä¹‹ï¼Œch2çš„æ•°æ®è¢«å–èµ°äº†ï¼Œä»–ä½“å†…çš„æ•°æ®å›åˆ°äº†å®šä¹‰çš„å®¹ç§¯0ä¸ªï¼Œæ‰€ä»¥å®ƒæ²¡æœ‰é˜»å¡ï¼Œ</span><br><br><span class="hljs-comment">// &#125;</span><br><br><span class="hljs-comment">// æ¥ä¸‹æ¥è§£é”æ€è·¯ æ–¹å¼ä¸€ï¼ŒæŠŠä½“å†…æ•°æ®ç»™å‡ºå»ï¼Œè®©ä½“å†…æ•°æ®å›åˆ°ä¹‹å‰å®šä¹‰çš„å¤§å°</span><br><span class="hljs-comment">// func main() &#123;</span><br><span class="hljs-comment">// ch1, ch2 := make(chan int), make(chan int) // åˆ›å»ºäº†ä¸¤ä¸ªé€šé“ï¼Œæ— ç¼“å†²çš„</span><br><span class="hljs-comment">// go func() &#123;</span><br><span class="hljs-comment">// ch1 &lt;- 1 // å¾€ch1é‡Œé¢å¡äº†ä¸ª1</span><br><span class="hljs-comment">// ch2 &lt;- 0 // ch2 é‡Œé¢ä¹Ÿå¡äº†ä¸ª0</span><br><br><span class="hljs-comment">// &#125;() //åé¢åŠ æ‹¬å·æ˜¯è¡¨ç¤ºè¿”å›å€¼</span><br><span class="hljs-comment">// &lt;-ch1 //  è§£é”æ€è·¯ï¼ŒæŠŠch1çš„æ•°æ®ä¹Ÿå–èµ°ç»™å‡ºå»ï¼Œch1å°±å›åˆ°äº†ä½“å†…æ•°æ®ä¸º0çš„çŠ¶æ€ï¼Œè¿™ä¸ªæ—¶å€™å°±æ²¡é˜»å¡äº†</span><br><span class="hljs-comment">// &lt;-ch2 // æŠŠch2çš„æ•°æ®å–èµ°ï¼Œ</span><br><span class="hljs-comment">// // è¿™æ ·è¿è¡Œä¼šé˜»å¡ï¼Œå› ä¸ºå¾€ch1é‡Œé¢å¡äº†ä¸€ä¸ªæ•°æ®ï¼Œ</span><br><span class="hljs-comment">// // ä½†æ˜¯ch1æ˜¯ä¸ªæ— ç¼“å†²çš„é€šé“ï¼Œç°åœ¨ä»–çš„ä½“å†…è¢«å¡äº†ä¸€ä¸ªæ•°æ®ï¼Œå¦‚æœä¸æŠŠè¿™ä¸ªæ•°æ®å–èµ°ï¼Œå°±ä¼šé˜»å¡ï¼Œ</span><br><span class="hljs-comment">// // åä¹‹ï¼Œch2çš„æ•°æ®è¢«å–èµ°äº†ï¼Œä»–ä½“å†…çš„æ•°æ®å›åˆ°äº†å®šä¹‰çš„å®¹ç§¯0ä¸ªï¼Œæ‰€ä»¥å®ƒæ²¡æœ‰é˜»å¡ï¼Œ</span><br><br><span class="hljs-comment">// &#125;</span><br><br><span class="hljs-comment">// æ¥ä¸‹æ¥è§£é”æ€è·¯ æ–¹å¼äºŒï¼ŒæŠŠä½“å†…å®¹ç§¯æ‰©å®¹ï¼Œ</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>ch1, ch2 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>, <span class="hljs-number">1</span>), <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>) <span class="hljs-comment">// åˆ›å»ºäº†ä¸¤ä¸ªé€šé“ï¼Œæ— ç¼“å†²çš„</span><br><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br>ch1 &lt;- <span class="hljs-number">1</span> <span class="hljs-comment">// å¾€ch1é‡Œé¢å¡äº†ä¸ª1 ,è¿™ä¸ªæ—¶å€™ch1ä½“å†…æ•°æ®1å°äºå…¶å®¹ç§¯2ï¼Œæ‰€ä»¥ä¸ä¼šé˜»å¡</span><br>ch2 &lt;- <span class="hljs-number">0</span> <span class="hljs-comment">// ch2 é‡Œé¢ä¹Ÿå¡äº†ä¸ª0ï¼Œè¿™ä¸ªæ—¶å€™ch2ä½“å†…æ•°æ®1å¤§äºå…¶å®¹ç§¯1ï¼Œå¦‚æœä¸æŠŠä½“å†…æ•°æ®ç»™å‡ºå»å°±ä¼šé˜»å¡</span><br><br>&#125;() <span class="hljs-comment">//åé¢åŠ æ‹¬å·æ˜¯è¡¨ç¤ºè¿”å›å€¼</span><br><span class="hljs-comment">// &lt;-ch1 //  è§£é”æ€è·¯ï¼ŒæŠŠch1çš„æ•°æ®ä¹Ÿå–èµ°ç»™å‡ºå»ï¼Œch1å°±å›åˆ°äº†ä½“å†…æ•°æ®ä¸º0çš„çŠ¶æ€ï¼Œè¿™ä¸ªæ—¶å€™å°±æ²¡é˜»å¡äº†</span><br>&lt;-ch2 <span class="hljs-comment">// æŠŠch2çš„æ•°æ®å–èµ°ï¼Œ è¿™ä¸ªæ—¶å€™ch2çš„ä½“å†…æ•°æ®å›åˆ°0ï¼Œç­‰äºå…¶å®¹ç§¯ï¼Œæ‰€ä»¥ä¸ä¼šé˜»å¡</span><br><span class="hljs-comment">// è¿™æ ·è¿è¡Œä¼šé˜»å¡ï¼Œå› ä¸ºå¾€ch1é‡Œé¢å¡äº†ä¸€ä¸ªæ•°æ®ï¼Œ</span><br><span class="hljs-comment">// ä½†æ˜¯ch1æ˜¯ä¸ªæ— ç¼“å†²çš„é€šé“ï¼Œç°åœ¨ä»–çš„ä½“å†…è¢«å¡äº†ä¸€ä¸ªæ•°æ®ï¼Œå¦‚æœä¸æŠŠè¿™ä¸ªæ•°æ®å–èµ°ï¼Œå°±ä¼šé˜»å¡ï¼Œ</span><br><span class="hljs-comment">// åä¹‹ï¼Œch2çš„æ•°æ®è¢«å–èµ°äº†ï¼Œä»–ä½“å†…çš„æ•°æ®å›åˆ°äº†å®šä¹‰çš„å®¹ç§¯0ä¸ªï¼Œæ‰€ä»¥å®ƒæ²¡æœ‰é˜»å¡ï¼Œ</span><br><br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="SELECT-CASE-å¤šè·¯å¤ç”¨"><a href="#SELECT-CASE-å¤šè·¯å¤ç”¨" class="headerlink" title="SELECT + CASE å¤šè·¯å¤ç”¨"></a>SELECT + CASE å¤šè·¯å¤ç”¨</h2><ul><li>selectè¯­å¥ç”¨äºå¤„ç†å¹¶å‘æ“ä½œä¸­çš„å¤šä¸ªé€šé“æ“ä½œï¼Œå®ƒå¯ä»¥è®©ä½ åŒäº‹ç­‰å¾…å¤šä¸ªé€šé“ï¼Œå¹¶åœ¨å…¶ä¸­ä»»æ„ä¸€ä¸ªé€šé“å°±ç»ªæ—¶æ‰§è¡Œå¯¹è±¡çš„æ“ä½œ</li><li>ä¸switch caseè¯­å¥ç±»ä¼¼ï¼Œä»–æœ‰ä¸€ç³»åˆ—çš„caseåˆ†æ”¯å’Œä¸€ä¸ªé»˜è®¤çš„åˆ†æ”¯ï¼Œ</li><li>æ¯ä¸ªåˆ†æ”¯case<strong>éƒ½ä¼šå¯¹åº”ä¸€ä¸ªé€šé“çš„é€šä¿¡</strong>ï¼ˆå‘é€æˆ–è€…æ¥æ”¶ï¼‰è¿‡ç¨‹ï¼Œselectä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°æŸä¸ªcaseçš„é€šä¿¡æ“ä½œå®Œæˆæ—¶ï¼Œå°±ä¼šæ‰§è¡Œcaseåˆ†æ”¯å¯¹åº”çš„è¯­å¥ï¼Œ</li><li>å¦‚æœå¤šä¸ªcaseåŒæ—¶æ»¡è¶³ï¼Œselectä¼š<strong>éšæœº</strong>é€‰æ‹©ä¸€ä¸ªå»è¿è¡Œï¼Œ</li><li>å¦‚æœæ²¡æœ‰æ»¡è¶³çš„caseï¼Œ<strong>åˆ™ä¸€ç›´ç­‰å¾…ç›´åˆ°</strong>æœ€åæ‰§è¡Œdefaultåˆ†æ”¯ï¼Œ</li><li>å¦‚æœæ²¡æœ‰ä»»ä½•é€šé“å°±ç»ªï¼Œ<strong>ä¸”æ²¡æœ‰defaultå­å¥ï¼Œåˆ™sselectè¯­å¥ä¼šé˜»å¡</strong>ï¼Œç›´åˆ°è‡³å°‘æœ‰ä¸€ä¸ªé€šé“å°±ç»ªã€‚</li><li>selectåº”ç”¨åœºæ™¯ä¸€ï¼šå¤šè·¯å¤ç”¨ï¼Œé€šè®¯ï¼ŒåŒæ—¶ç›‘å¬å¤šä¸ªé€šé“ï¼Œä¸€æ—¦æŸä¸ªé€šé“å¯ä»¥è¿›è¡Œè¯»å†™æ“ä½œï¼Œå¯¹åº”çš„caseè¯­å¥å°±ä¼šè¢«æ‰§è¡Œã€‚è¿™ç§æ–¹å¼å¯ä»¥æœ‰æ•ˆå®ç°å¤šä¸ªå¹¶å‘ä»»åŠ¡ä¹‹é—´çš„åè°ƒå’ŒåŒæ­¥</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>ch1 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>, <span class="hljs-number">1</span>)<br>ch2 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>, <span class="hljs-number">100</span>)<br><span class="hljs-comment">// ch1 &lt;- 1</span><br><span class="hljs-comment">// select &#123;</span><br><span class="hljs-comment">// case a := &lt;-ch1:</span><br><span class="hljs-comment">// fmt.Println(&quot;èµ°äº†ç¬¬ä¸€æ¡ï¼Œå¦‚æœch1é‡Œé¢æœ‰å…ƒç´ å‘é€ç»™açš„æƒ…å†µä¸‹ï¼Œæ‰ä¼šèµ°è¿™æ¡è·¯&quot;, a)</span><br><span class="hljs-comment">// case ch1 &lt;- 5:</span><br><span class="hljs-comment">// fmt.Println(&quot;èµ°äº†ç¬¬äºŒæ¡ï¼Œå¾€ch1é‡Œé¢å‘é€ä¸€ä¸ªå…ƒç´ ï¼Œå¦‚æœch1æœ‰ä½ç½®å¡æ•°æ®çš„è¯ï¼Œå°±ä¼šèµ°è¿™æ¡è·¯&quot;)</span><br><span class="hljs-comment">// default:</span><br><span class="hljs-comment">// fmt.Println(&quot;è¿™æ˜¯æœ€åä¸€æ¡ï¼Œå¦‚æœä»¥ä¸Šéƒ½ä¸æ»¡è¶³ï¼Œå°±ä¼šèµ°è¿™é‡Œæ¥ã€‚&quot;)</span><br><span class="hljs-comment">// &#125;</span><br>ch2 &lt;- <span class="hljs-number">1</span><br><span class="hljs-keyword">select</span> &#123;<br><span class="hljs-keyword">case</span> a := &lt;-ch1: <span class="hljs-comment">// æŠŠch1é‡Œçš„æ•°æ®å‘é€ç»™aï¼Œå¦‚æœch1é‡Œæœ‰æ•°æ®çš„è¯ï¼Œå¦‚æœæ²¡æœ‰å°±ä¸ä¼šè§¦å‘è¿™æ¡åˆ¤æ–­</span><br>fmt.Println(<span class="hljs-string">&quot;ç¬¬ä¸€æ¡&quot;</span>, a)<br><span class="hljs-keyword">case</span> ch1 &lt;- <span class="hljs-number">19</span>: <span class="hljs-comment">// ch1æ¥æ”¶å‘é€ç»™ä»–çš„æ•°æ®19 ï¼Œ å¦‚æœch1é‡Œé¢è¿˜æœ‰ç©ºä½çš„è¯ï¼Œå°±ä¼šè§¦å‘è¿™ä¸€æ¡åˆ¤æ–­</span><br>fmt.Println(<span class="hljs-string">&quot;èµ°äº†ç¬¬äºŒæ¡&quot;</span>)<br><span class="hljs-keyword">case</span> ch2 &lt;- <span class="hljs-number">20</span>: <span class="hljs-comment">// ch2æ¥æ”¶å‘é€ç»™ä»–çš„æ•°æ®20ï¼Œå¦‚æœch2é‡Œé¢è¿˜æœ‰ç©ºä½çš„è¯ï¼Œå°±ä¼šè§¦å‘è¿™ä¸€æ¡åˆ¤æ–­</span><br>fmt.Println(<span class="hljs-string">&quot;èµ°äº†ç¬¬ä¸‰æ¡&quot;</span>)<br><span class="hljs-keyword">case</span> b := &lt;-ch2: <span class="hljs-comment">// å°†ch2é‡Œé¢çš„æ•°æ®å‘é€å‡ºæ¥ç»™åˆ°bï¼Œå¦‚æœch2é‡Œé¢æœ‰æ•°æ®åŒ–ï¼Œå°±ä¼šè§¦å‘è¿™ä¸€æ¡</span><br>fmt.Println(<span class="hljs-string">&quot;èµ°äº†ç¬¬å››æ¡&quot;</span>, b)<br><span class="hljs-keyword">default</span>: <span class="hljs-comment">// æ³¨æ„ä¸‹ï¼Œå¦‚æœä¸Šé¢çš„é€šé“éƒ½æ— æ³•æ»¡è¶³ï¼Œä¸”æ²¡æœ‰å®šä¹‰defaultï¼Œé‚£ä¹ˆselectå°±ä¼šé˜»å¡ æŠ¥é”™select case must be receive, send or assign recv</span><br>fmt.Println(<span class="hljs-string">&quot;éƒ½èµ°ä¸é€šï¼Œå°±ä¼šèµ°è¿™æ¡&quot;</span>)<br>&#125;<br><span class="hljs-comment">// ä¸Šé¢è¿™æ®µä»£ç åˆ¤æ–­é‡Œé¢,ç¬¬äºŒæ¡ç¬¬ä¸‰æ¡ç¬¬å››æ¡éƒ½ä¼šæ»¡è¶³æ¡ä»¶ï¼Œæ‰€ä»¥ä¼šåœ¨è¿™ä¸‰æ¡åˆ¤æ–­é‡Œé¢éšæœºèµ°ä¸€æ¡</span><br>    <span class="hljs-comment">// å¦‚æœæ²¡æœ‰è¿è¡Œcase,å°±ä¼šé˜»å¡äº‹ä»¶å‘é€æŠ¥é”™ï¼ˆæ­»é”ï¼‰</span><br>    <span class="hljs-comment">// fatal error: all goroutines are asleep - deadlock!</span><br><br>&#125;<br><br><br></code></pre></td></tr></table></figure><ul><li>select åº”ç”¨çš„åœºæ™¯äºŒï¼šè¶…æ—¶å¤„ç†ï¼Œç»“åˆselcetå’Œtime.Afterå‡½æ•°ï¼Œäº‹ä»¶å¯¹æŸä¸ªæ“ä½œçš„è¶…æ—¶æ§åˆ¶ï¼Œå½“æŸä¸ªæ“ä½œè¶…è¿‡ä¸€å®šæ—¶é—´æ²¡æœ‰å®Œæˆæ—¶ï¼Œå¯ä»¥æ‰§è¡Œå“åº”çš„è¶…æ—¶å¤„ç†é€»è¾‘ï¼Œä¸€ä¸‹ä¸¤æ–­ä»£ç ä¸€ä¸ªåŸºç¡€ç‰ˆä¸€ä¸ªç®€å•ç‰ˆçš„ï¼Œï¼š</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// æˆ‘ä»¬å¼€è§£æä¸‹è¿™æ®µä»£ç </span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>timeOut := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">bool</span>, <span class="hljs-number">1</span>) <span class="hljs-comment">// å®šä¹‰timeOutä¸ºchanï¼Œå†…éƒ¨ç±»å‹ä¸ºboolï¼Œå®¹ç§¯ä¸º1ï¼Œä¸”åˆ†é…å†…å­˜ï¼ˆåˆ›å»ºtimeOutè¿™ä¸ªé€šé“ï¼‰ </span><br><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;   <span class="hljs-comment">// func()&#123;ä»£ç å—&#125;()åˆ›å»ºåŒ¿åå‡½æ•°</span><br>time.Sleep(time.Second * <span class="hljs-number">1</span>) <span class="hljs-comment">//sleepç¡1ç§’é’Ÿ</span><br>timeOut &lt;- <span class="hljs-literal">true</span> <span class="hljs-comment">// å¾€timeOutè¿™ä¸ªé€šé“å‘é€ä¸€ä¸ªæ•°æ®ï¼Œæ•°æ®æ˜¯ture  ï¼ˆboolï¼‰</span><br>&#125;()<br>ch1 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>) <span class="hljs-comment">// / å®šä¹‰timeOutä¸ºchanï¼Œå†…éƒ¨ç±»å‹ä¸ºintï¼Œå®¹ç§¯ä¸º0ï¼Œæ— ç¼“å†²é€šé“ï¼Œä¸”åˆ†é…å†…å­˜ï¼ˆåˆ›å»ºtimeOutè¿™ä¸ªé€šé“ï¼‰ </span><br><span class="hljs-keyword">select</span> &#123; <span class="hljs-comment">//select case</span><br><span class="hljs-keyword">case</span> &lt;-ch1: <span class="hljs-comment">// ç¬¬ä¸€ä¸ªcase å°†ch1é€šé“é‡Œé¢çš„æ•°æ®å‘å‡ºæ¥ï¼Œä½†æ˜¯ch1é‡Œé¢æ˜¯ç©ºçš„ï¼Œæ‰€ä»¥æ²¡ä¸œè¥¿å‘å‡ºæ¥æ‰€ä»¥ä¸ä¼šèµ°è¿™æ¡case</span><br><span class="hljs-keyword">case</span> &lt;-timeOut: <span class="hljs-comment">// ç¬¬äºŒä¸ªcaseï¼ŒæŠŠtimeOuté€šé“é‡Œé¢çš„æ•°æ®å‘å‡ºæ¥ï¼Œå› ä¸ºtimeOuté‡Œé¢æœ‰ä¸ªtureè¿™ä¸ªæ•°æ®ï¼Œæ‰€ä»¥æ»¡è¶³ï¼Œä¼šèµ°è¿™æ¡case </span><br>fmt.Println(<span class="hljs-string">&quot;è¶…æ—¶äº†ï¼Œèµ°äº†è¿™ä¸€æ­¥&quot;</span>) <span class="hljs-comment">// </span><br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>ä¸‹é¢è¿™ä¸ªæ˜¯å¸¸ç”¨çš„ç®€åŒ–ç‰ˆçš„</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs GO"><span class="hljs-comment">// ç®€åŒ–å†™ä¸€ä¸ªé€šä¿—ç‰ˆï¼Œè¿™æ®µä»£ç åŸç†å’Œä¸Šé¢ç±»å‹ï¼Œä½†æœ‰ä¸ªå°æŠ€å·§ï¼Œæˆ‘ä»¬è§£è¯»ä¸€ä¸‹</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>ch1 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>, <span class="hljs-number">1</span>) <span class="hljs-comment">// åˆ›å»ºch1é€šé“ï¼Œå®¹ç§¯ä¸º0</span><br>ch1 &lt;- <span class="hljs-number">8</span><br><span class="hljs-keyword">select</span> &#123;<br><span class="hljs-keyword">case</span> &lt;-ch1: <span class="hljs-comment">// ä»ch1é€šé“è¯»å–æ•°æ®ï¼ˆæŠŠch1çš„æ•°æ®å‘é€å‡ºæ¥ï¼‰ï¼Œch1ä¸ºç©ºï¼Œä¸æ»¡è¶³è¯¥åˆ¤æ–­</span><br>fmt.Println(<span class="hljs-string">&quot;æ²¡æœ‰è¶…æ—¶å°±ä¼šèµ°è¿™æ¡è·¯&quot;</span>)<br><span class="hljs-keyword">case</span> &lt;-time.After(time.Second * <span class="hljs-number">1</span>): <span class="hljs-comment">// è¿™é‡Œä¼šæœ‰ç–‘é—®çš„ï¼šå› ä¸ºè¿™é‡Œçš„å‡½æ•°time.After()çš„è¿”å›å€¼å°±æ˜¯ä¸€ä¸ªæœ‰æ•°æ®çš„é€šé“ï¼Œæ‰€ä»¥æ»¡è¶³è¯¥caseåˆ¤æ–­</span><br><span class="hljs-comment">// ç¿»çœ‹æºç å°±çŸ¥é“ï¼šfunc After(d Duration) &lt;-chan Time &#123;return NewTimer(d).C &#125;è¿”å›çš„æ˜¯ä¸€ä¸ªchanç±»å‹ Time</span><br>fmt.Println(<span class="hljs-string">&quot;è¶…æ—¶1ç§’ä¸”èµ°äº†è¿™æ¡è·¯&quot;</span>)<br><span class="hljs-comment">// è¿™é‡Œè¦æ³¨æ„ä¸€ä¸‹ï¼Œtime.Afterå¿…é¡»è¦ç­‰å¾…æ—¶é—´ç»“æŸåæ‰ä¼šè¿”å›ä¸€ä¸ªchanï¼Œå¦‚æœåœ¨ç­‰å¾…æ—¶é—´å†…ï¼Œæœ‰å…¶ä»–caseæ»¡è¶³äº†ï¼Œå°±ä¼šå»è¿è¡Œå…¶ä»–case.</span><br><br>&#125;<br><span class="hljs-comment">// ch1 &lt;- 8 // æˆ‘ä»¬è¯•ä¸€ä¸‹å¾€è¿™ä¸ªch1é‡Œå¡ä¸€ä¸ªæ•°æ®ï¼Œè®©ä»–æ»¡è¶³ç¬¬ä¸€ä¸ªcaseçš„åˆ¤æ–­ã€‚åœ¨Second*1çš„æ—¶é—´å†…ã€‚æ»¡è¶³äº†ç¬¬ä¸€ä¸ªcaseï¼Œæ‰€ä»¥ä¸ä¼šè¿è¡Œæ‰“å°ç¬¬äºŒä¸ªcaseçš„å†…å®¹</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li>select åœºæ™¯ä¸‰ï¼šéé˜»å¡é€šä¿¡ï¼Œé€šè¿‡å®šä¹‰defaultè¯­å¥ï¼Œå®ç°éé˜»å¡çš„é€šä¿¡æ“ä½œï¼Œå½“æ²¡æœ‰ä»»ä½•é€šä¿¡æ“ä½œå¯ä»¥ç«‹å³è¿›è¡Œæ—¶ï¼Œdefaultè¯­å¥ä¼šè¢«æ‰§è¡Œï¼Œå¯ä»¥å†™ä¸€ä¸‹é»˜è®¤é€»è¾‘ã€‚ï¼ˆåˆ¤æ–­channelæ˜¯å¦é˜»å¡(æˆ–è€…è¯´channelæ˜¯å¦å·²ç»æ»¡äº†)ï¼‰</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>ch := <span class="hljs-built_in">make</span> (<span class="hljs-keyword">chan</span> <span class="hljs-type">int</span>, <span class="hljs-number">1</span>)  <span class="hljs-comment">// æ³¨æ„è¿™é‡Œç»™çš„å®¹é‡æ˜¯1</span><br>ch &lt;- <span class="hljs-number">1</span><br><span class="hljs-keyword">select</span> &#123;<br><span class="hljs-keyword">case</span> ch &lt;- <span class="hljs-number">2</span>:<br><span class="hljs-keyword">default</span>: <span class="hljs-comment">// èµ°åˆ°è¿™é‡Œè¯´æ˜select caseé˜»å¡äº†ï¼Œå› ä¸ºé€šé“æ»¡äº†</span><br>fmt.Println(<span class="hljs-string">&quot;é€šé“channelå·²ç»æ»¡å•¦ï¼Œå¡ä¸ä¸‹ä¸œè¥¿äº†!&quot;</span>) <br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>slelectåœºæ™¯å››ï¼š.é€€å‡ºæœºåˆ¶</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// è§£è¯»ä¸‹è¿™æ®µä»£ç </span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>i := <span class="hljs-number">0</span>                      <span class="hljs-comment">// åˆå§‹åŒ–i å€¼ä¸º1</span><br>ch1 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">string</span>, <span class="hljs-number">0</span>) <span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªé€šé“ï¼Œå†…å®¹ä¸ºå­—ç¬¦ä¸²ï¼Œå®¹ç§¯ä¸º0</span><br><span class="hljs-keyword">defer</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;              <span class="hljs-comment">// defer mainå‡½æ•°ç»“æŸçš„æ—¶å€™æ‰§è¡Œè¿™ä¸ªæ–¹æ³•</span><br><span class="hljs-built_in">close</span>(ch1) <span class="hljs-comment">// å…³é—­é€šé“</span><br>&#125;()<br><br><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123; <span class="hljs-comment">// goroutineæ‰§è¡ŒåŒ¿åæ–¹æ³•</span><br>DONE: <span class="hljs-comment">// DONE:åªæ˜¯åœ¨æ‰“æ ‡ç­¾ï¼Œæ ‡è®°ä¸€ä¸‹å¾ªç¯å¼€å§‹äº†ï¼Œæ²¡æœ‰å®é™…ä½œç”¨</span><br><span class="hljs-keyword">for</span> &#123;<br>time.Sleep(time.Second * <span class="hljs-number">1</span>) <span class="hljs-comment">// æš‚åœä¸€ç§’</span><br><span class="hljs-comment">// fmt.Println(time.Now().Unix()) // æ‰“å°Unixæ—¶é—´æˆ³</span><br>fmt.Println(time.Now().UTC()) <span class="hljs-comment">// æ‰“å°UTCå›½é™…æ ‡å‡†æ—¶é—´</span><br>i++                           <span class="hljs-comment">// å¾ªç¯ä¸€æ¬¡ åŠ ç­‰ä¸1</span><br><br><span class="hljs-keyword">select</span> &#123; <span class="hljs-comment">// å¼€å¯select case</span><br><span class="hljs-keyword">case</span> m := &lt;-ch1: <span class="hljs-comment">// å°†ch1é‡Œé¢çš„æ•°æ®ç»™må˜é‡ï¼Œä½†æ˜¯ch1é‡Œæ˜¯ç©ºçš„ï¼Œæ‰€ä»¥ä¸ä¼šè§¦å‘è¿™ä¸ª</span><br>fmt.Println(<span class="hljs-string">&quot;æ‰“å°ch1é‡Œé¢çš„å†…å®¹ :&quot;</span>, m) <span class="hljs-comment">// æ‰“å°æ¥æ”¶é€šé“æ•°æ®çš„m,å°±æ˜¯ä¸‹é¢çš„stopä¼šè¢«å¡è¿›æ¥</span><br><span class="hljs-comment">// è¿™é‡Œçš„DONEä¹Ÿæ˜¯ä¸€ä¸ªæ„æ€æ ‡è®°ä¸€ä¸‹å¾ªç¯ä»è¿™é‡Œç»“æŸï¼Œæ”¶å°¾å‘¼åº”</span><br><span class="hljs-keyword">break</span> DONE <span class="hljs-comment">// å½“è¿™ä¸ªé€šé“é‡Œé¢æœ‰å†…å®¹æ—¶ï¼Œç»“æŸè¿™ä¸ªæ— é™å¾ªç¯</span><br><span class="hljs-keyword">default</span>: <span class="hljs-comment">// æ²¡æœ‰é€šé“æ»¡è¶³caseï¼Œè§¦å‘default æ‰“å°ä¸‹é¢çš„è¯</span><br>fmt.Println(<span class="hljs-string">&quot;ä»¥ä¸Šä¹°æ»¡è¶³çš„æ¡ä»¶&quot;</span>)<br>&#125;<br>&#125;<br>&#125;()<br>time.Sleep(time.Second * <span class="hljs-number">5</span>)   <span class="hljs-comment">// ä¼šä¸€ç›´ç­‰5ç§’ï¼Œä½†æ˜¯ç­‰å¾…çš„æ—¶å€™ï¼Œgo funcåŒ¿åå‡½æ•°é‡Œé¢çš„æ­»å¾ªç¯ä¼šä¸€ç›´å»å¾ªç¯</span><br>ch1 &lt;- <span class="hljs-string">&quot;stop,å¡è¿›é€šé“é‡Œé¢å»&quot;</span>         <span class="hljs-comment">// äº”ç§’ç»“æŸï¼Œå¾€ ch1é€šé“é‡Œé¢å¡äº†ä¸€ä¸ªæ•°æ® &quot;stop&quot; , ch1é‡Œé¢å¡æ•°æ®çš„æ—¶å€™ï¼Œç­‰å¾…åˆ°æ— é™å¾ªç¯é‡Œé¢å°±ä¼šè¢«ç»ˆæ­¢çš„</span><br>fmt.Println(<span class="hljs-string">&quot;çœ‹ä¸€ä¸‹è¿™æ®µä»£ç åœ¨ä»€ä¹ˆæ—¶å€™æ‰§è¡Œ&quot;</span>) <span class="hljs-comment">// è¿™ä¸ªæ˜¯åœ¨å¾ªç¯ç»“æŸåæ‰ä¼šæ‰§è¡Œ</span><br>&#125;<br></code></pre></td></tr></table></figure><ul><li>å¼ºè°ƒä¸€ä¸‹ï¼š è¦è·³å‡ºå¾ªç¯ï¼Œä¸€å®šè¦ç”¨break+ å…·ä½“æ ‡è®°ï¼Œæˆ–è€…goto æ ‡è®°ä¹Ÿå¯ä»¥ï¼Œå¦åˆ™å…¶å®ä¸æ˜¯çœŸçš„é€€å‡ºï¼Œå› ä¸ºåœ¨goroutineé‡Œé¢ï¼Œä¼šä¸åœåœ°è·‘</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>i := <span class="hljs-number">0</span><br>ch := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> <span class="hljs-type">string</span>, <span class="hljs-number">0</span>)<br><span class="hljs-keyword">defer</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-built_in">close</span>(ch)<br>&#125;()<br><br><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">()</span></span> &#123;<br><br><span class="hljs-keyword">for</span> &#123;<br>time.Sleep(<span class="hljs-number">1</span>*time.Second)<br>fmt.Println(time.Now().Unix())<br>i++<br><br><span class="hljs-keyword">select</span> &#123;<br><span class="hljs-keyword">case</span> m := &lt;-ch:<br><span class="hljs-built_in">println</span>(m)<br><span class="hljs-keyword">goto</span> DONE <span class="hljs-comment">// è·³å‡º select å’Œ for å¾ªç¯</span><br><span class="hljs-keyword">default</span>:<br>&#125;<br>&#125;<br>DONE:<br>&#125;()<br><br>time.Sleep(time.Second * <span class="hljs-number">4</span>)<br>ch&lt;-<span class="hljs-string">&quot;stop&quot;</span><br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="é”"><a href="#é”" class="headerlink" title="é”"></a>é”</h2><p>é”æ˜¯ä¸€ç§åŒæ­¥æœºåˆ¶ï¼Œç”¨äºæ§åˆ¶å¯¹å…±äº«èµ„æºçš„è®¿é—®ï¼Œç¡®ä¿ä¸€æ¬¡åªæœ‰ä¸€ä¸ªgoroutineå¯ä»¥åé—®å…±äº«èµ„æºã€‚</p><p>é”æœ‰ä¸¤ç§çŠ¶æ€ï¼šé”å®šå’Œè§£é”ï¼Œä¸€æ—¦æœ‰ä¸€ä¸ªgoroutineè·å¾—äº†é”ï¼Œé‚£å…¶ä»–goroutineså°†è¢«é˜»å¡ã€‚ç›´åˆ°é”è¢«é‡Šæ”¾</p><p>é”ï¼šäº’æ–¥é”ã€è¯»å†™é”</p><h2 id="é”ï¼ˆäº’æ–¥é”ï¼‰ç®€å•è§£æ"><a href="#é”ï¼ˆäº’æ–¥é”ï¼‰ç®€å•è§£æ" class="headerlink" title="é”ï¼ˆäº’æ–¥é”ï¼‰ç®€å•è§£æ"></a>é”ï¼ˆäº’æ–¥é”ï¼‰ç®€å•è§£æ</h2><p>äº’æ–¥é”ï¼šåœ¨å¹¶å‘æ‰§è¡Œæ—¶ï¼Œå¤šä¸ªgoroutineåŒäº‹è¯»å†™ä¸€ä¸ªæ•°æ®ï¼Œå°±ä¼šé€ æˆæ•°æ®çš„è¯»å†™æ··ä¹±ï¼Œ</p><p>è§£å†³æ–¹å¼ï¼šåŠ é”ï¼ŒåŠ äº’æ–¥é”ï¼Œ</p><p>æ–¹å¼ï¼šæ§åˆ¶å¯¹å…±äº«èµ„æºçš„è®¿é—®ï¼Œè®©å®ƒå¯ä»¥å´é“åœ¨ä»»ä½•ç»™å®šçš„æ—¶åˆ»éƒ½åªæœ‰ä¸€ä¸ªçº¿ç¨‹æˆ–è€…è¯´goroutineèƒ½å¤Ÿè®¿é—®åˆ°è¢«ä¿æŠ¤çš„ä¸´ç•ŒåŒºã€‚ </p><p>æ¯ä¸€ä¸ª</p><p>channelé€šé“æ˜¯è§£å†³åç¨‹åŒæ­¥ï¼Œé”æ˜¯è§£å†³åç¨‹ï¼ˆçº¿ç¨‹ï¼‰è®¿é—®èµ„æºä¼˜å…ˆæ€§ï¼Œ</p><p>ä½¿ç”¨äº’æ–¥é”æ—¶ä¸€å®šè¦æ³¨æ„ï¼Œå¯¹èµ„æºï¼ˆæ–‡ä»¶ã€æ•°æ®ç­‰ï¼‰æ“ä½œå®Œæˆ</p><p>å¼Šç«¯ï¼šåŠ äº†äº’æ–¥é”ä¹‹åï¼Œå¹¶å‘å°±å˜æˆäº†ä¸²è¡Œäº†ï¼Œæˆ–è€…è¯´ï¼Œèµ°åˆ°æ­¤å¤„æ—¶ï¼Œæ˜¯ä¸²è¡Œï¼Œç‰ºç‰²äº†æ•ˆç‡ï¼Œä½†æ˜¯ä¿è¯äº†æ•°æ®å®‰å…¨æ€§</p><h3 id="äº’æ–¥é”ç­‰å¾…ç»„"><a href="#äº’æ–¥é”ç­‰å¾…ç»„" class="headerlink" title="äº’æ–¥é”ç­‰å¾…ç»„"></a>äº’æ–¥é”ç­‰å¾…ç»„</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> x <span class="hljs-type">int</span>             <span class="hljs-comment">// å®šä¹‰äº†ä¸€ä¸ªæ•´å½¢å˜é‡</span><br><span class="hljs-keyword">var</span> wg sync.WaitGroup <span class="hljs-comment">// å®šä¹‰äº†ä¸€ä¸ªç­‰å¾…ç»„WaitGroup</span><br><span class="hljs-keyword">var</span> lock sync.Mutex   <span class="hljs-comment">// å®šä¹‰äº†ä¸€ä¸ªMutexäº’æ–¥é”</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">add</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++ &#123;<br>lock.Lock() <span class="hljs-comment">// å¼€å¯é”</span><br>fmt.Println(<span class="hljs-string">&quot;xå¼€å§‹å‰ä¸º=&quot;</span>, x)<br>x++<br>fmt.Println(<span class="hljs-string">&quot;xæ­¤æ—¶ä¸º=&quot;</span>, x)<br>lock.Unlock() <span class="hljs-comment">// å…³é—­é”</span><br>&#125;<br>wg.Done() <span class="hljs-comment">// é€šçŸ¥ç­‰å¾…ç»„wgå®Œæˆäº†</span><br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;x=&quot;</span>, x)<br>wg.Add(<span class="hljs-number">2</span>) <span class="hljs-comment">// ç­‰å¾…ç»„æ·»åŠ äº†2ä¸ª å°±æ˜¯æŠŠä¸¤ä¸ªgoroutineæ”¾è¿›ç­‰å¾…ç»„é‡Œé¢ï¼Œä»–ä»¬ä¸¤ä¸ªåœ¨æŠ¢é”</span><br><span class="hljs-comment">// ä¸¤ä¸ªaddæ–¹æ³•éƒ½åœ¨åŒæ—¶è¿è¡Œï¼Œä½†æ˜¯åªæœ‰ä¸€æŠŠé”ï¼Œè°æ‹¿åˆ°äº†é”å°±æ˜¯è°åœ¨æ‰§è¡Œx++çš„è¿™ä¸ªæ“ä½œ</span><br><span class="hljs-keyword">go</span> add()<br><span class="hljs-keyword">go</span> add()<br><span class="hljs-comment">// go add()</span><br>wg.Wait() <span class="hljs-comment">// ç­‰å¾…ç»„è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç­‰è¿™ä¸¤ä¸ªgoroutineså®Œæˆä»»åŠ¡</span><br>fmt.Println(x)<br>&#125;<br><span class="hljs-comment">// è¾“å‡ºä¸º2000 </span><br></code></pre></td></tr></table></figure><h2 id="è¯»å†™é”"><a href="#è¯»å†™é”" class="headerlink" title="è¯»å†™é”"></a>è¯»å†™é”</h2><ul><li>åœºæ™¯ï¼šè¯»å¤šå†™å°‘ï¼Œè¯»æ˜¯ä¸éœ€è¦åŠ é”çš„ï¼Œå†™éœ€è¦åŠ é”</li><li>è§£å†³ï¼šè¯»å†™äº’æ–¥é”</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go">- å½“ä¸€ä¸ªgoroutineè·å–è¯»é”ä¹‹åï¼Œå…¶ä»–çš„goroutineå¦‚æœæ˜¯è·å–è¯»é”ä¼šç»§ç»­è·å¾—é”ï¼Œå¦‚æœæ˜¯è·å–å†™é”ï¼Œå°±ä¼šç­‰å¾…ï¼›<br>- å½“ä¸€ä¸ª<span class="hljs-string">`goroutine`</span>è·å–å†™é”ä¹‹åï¼Œå…¶ä»–çš„<span class="hljs-string">`goroutine`</span>æ— è®ºæ˜¯è·å–è¯»é”è¿˜æ˜¯å†™é”éƒ½ä¼šç­‰å¾…<br></code></pre></td></tr></table></figure><h2 id="sync-Map-å¹¶å‘å®‰å…¨æ˜ å°„ï¼ˆMapï¼‰"><a href="#sync-Map-å¹¶å‘å®‰å…¨æ˜ å°„ï¼ˆMapï¼‰" class="headerlink" title="sync.Map å¹¶å‘å®‰å…¨æ˜ å°„ï¼ˆMapï¼‰"></a>sync.Map å¹¶å‘å®‰å…¨æ˜ å°„ï¼ˆMapï¼‰</h2><ul><li>Goå†…ç½®çš„map å¹¶ä¸æ˜¯å¹¶å‘å®‰å…¨çš„ï¼Œæ‰€ä»¥é«˜å¹¶å‘ä¸‹ä½¿ç”¨sync.Mapç±»å‹</li><li>sync.Mapä¸éœ€è¦ä½¿ç”¨make()åˆ†é…å†…å­˜ï¼Œä½¿ç”¨å¦ä¸€ç§ä¾¿æ·æ–¹å¼ï¼šStore&#x2F;Loadç­‰</li></ul><p>1ã€å¹¶å‘å®‰å…¨æ€§ï¼š<code>sync.Map</code> åœ¨å¤šä¸ªgoroutinesä¹‹é—´æä¾›äº†å¹¶å‘å®‰å…¨çš„è¯»å–å’Œå†™å…¥æ“ä½œï¼Œè¿™æ„å‘³ç€ä½ å¯ä»¥åŒæ—¶åœ¨å¤šä¸ªgoroutinesä¸­è®¿é—®å’Œä¿®æ”¹åŒä¸€ä¸ªæ˜ å°„ï¼Œè€Œä¸éœ€è¦é¢å¤–çš„é”æˆ–è€…åŒæ­¥æœºåˆ¶å»é™åˆ¶</p><p>2ã€è‡ªåŠ¨æ‰©å®¹ï¼š<code>sync.map</code>åœ¨éœ€è¦æ—¶ä¼šè‡ªåŠ¨æ‰©å®¹ä»¥é€‚åº”æ›´å¤šçš„é”®å€¼å¯¹ï¼Œæ— éœ€æ‰‹åŠ¨ç®¡ç†å®¹é‡é—®é¢˜</p><p>3ã€æ€§èƒ½ä¼˜åŒ–ï¼š<code>sync.map</code>åœ¨å†…éƒ¨ä½¿ç”¨äº†ä¸€äº›æ€§èƒ½ä¼˜åŒ–ç­–ç•¥ï¼Œä»¥æé«˜å¹¶å‘è®¿é—®çš„æ€§èƒ½</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-comment">// // å†™å…¥é”®å€¼å¯¹</span><br><span class="hljs-comment">// m.Store(&quot;key1&quot;, &quot;value1&quot;)</span><br><span class="hljs-comment">// m.Store(&quot;key2&quot;, &quot;value2&quot;)</span><br><br><span class="hljs-comment">// // è¯»å–é”®çš„å€¼</span><br><span class="hljs-comment">// value, found := m.Load(&quot;key1&quot;)</span><br><span class="hljs-comment">// if found &#123;</span><br><span class="hljs-comment">// fmt.Println(&quot;Value:&quot;, value)</span><br><span class="hljs-comment">// &#125;</span><br><br><span class="hljs-comment">// // åˆ é™¤é”®å€¼å¯¹</span><br><span class="hljs-comment">// // m.Delete(&quot;key2&quot;)</span><br><br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++ &#123; <span class="hljs-comment">// å¾ªç¯10æ¬¡ï¼Œ10ä¸ªgoroutine</span><br>wg3.Add(<span class="hljs-number">1</span>) <span class="hljs-comment">// æ·»åŠ ç­‰å¾…ç»„ï¼Œæ·»åŠ 1ä¸ªï¼Œå¾ªç¯äº†ié</span><br><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(n <span class="hljs-type">int</span>)</span></span> &#123;<br>key := strconv.Itoa(n) <span class="hljs-comment">//å°†nè½¬åŒ–æˆå­—ç¬¦ä¸²ï¼Œç”¨keyæ¥æ”¶ï¼ŒItoaè½¬æ¢</span><br>m.Store(key, n)        <span class="hljs-comment">// ç»„è£…ä¸€ä¸ªsync.Map é”®æ˜¯kycå­—ç¬¦ä¸²ï¼Œå€¼æ˜¯nï¼Œæ‰€ä»¥å°±æ˜¯ &quot;1&quot;:1è¿™æ ·çš„å½¢å¼</span><br><span class="hljs-comment">//è¯»å–sync,Maoçš„å†…å®¹ï¼Œé€šè¿‡Keyæ‹¿å€¼ï¼Œ</span><br><span class="hljs-comment">// ä¸‹åˆ’çº¿è¡¨ç¤ºä¸å¤„ç†é‚£ä¸ªè¿”å›å€¼ï¼ŒLoadä¼šè¿”å›ä¸¤ä¸ªå€¼ï¼Œå‰é¢çš„æ˜¯kycå¯¹åº”çš„valueï¼Œåé¢çš„æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œæœ‰å°±çœŸï¼Œæ— å°±å‡</span><br>value, _ := m.Load(key)<br>fmt.Println(value) <span class="hljs-comment">//æ‰“å°çš„æ˜¯key çš„å€¼</span><br>wg3.Done()         <span class="hljs-comment">// ç»“æŸè¿™ä¸ªç­‰å¾…ç»„</span><br><br>&#125;(i)<br>wg3.Wait() <span class="hljs-comment">// ç­‰å¾…æ‰€æœ‰ç­‰å¾…ç»„å®Œæˆ</span><br>&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Golang</category>
      
    </categories>
    
    
    <tags>
      
      <tag>go</tag>
      
      <tag>ç¼–ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Golangã€‘goè¯­è¨€æ‰¹é‡ç”Ÿæˆ5Wåœ°å€</title>
    <link href="/2023/12/07/808go%E8%AF%AD%E8%A8%80%E6%89%B9%E9%87%8F%E7%94%9F%E6%88%905W%E5%9C%B0%E5%9D%80/"/>
    <url>/2023/12/07/808go%E8%AF%AD%E8%A8%80%E6%89%B9%E9%87%8F%E7%94%9F%E6%88%905W%E5%9C%B0%E5%9D%80/</url>
    
    <content type="html"><![CDATA[<h1 id="åŸºäºgoè¯­è¨€ç¼–å†™æ‰¹é‡ç”Ÿæˆç”¨æˆ·åœ°å€"><a href="#åŸºäºgoè¯­è¨€ç¼–å†™æ‰¹é‡ç”Ÿæˆç”¨æˆ·åœ°å€" class="headerlink" title="åŸºäºgoè¯­è¨€ç¼–å†™æ‰¹é‡ç”Ÿæˆç”¨æˆ·åœ°å€"></a>åŸºäºgoè¯­è¨€ç¼–å†™æ‰¹é‡ç”Ÿæˆç”¨æˆ·åœ°å€</h1><p>1ã€æ‰§è¡ŒäºŒè¿›åˆ¶</p><p>2ã€åˆ‡åˆ†æ•°æ®</p><p>3ã€åˆ›å»º<code>goroutine</code>å¹¶å‘æ‰§è¡Œ</p><p>goè¯­è¨€éœ€è¦åˆ›å»ºç»“æ„ä½“å»æ¥æ”¶æ•°æ®</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;encoding/csv&quot;</span><br><span class="hljs-string">&quot;gopkg.in/yaml.v3&quot;</span><br><br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-comment">//&quot;gopkg.in/yaml.v3&quot;</span><br><span class="hljs-string">&quot;log&quot;</span><br><span class="hljs-string">&quot;os&quot;</span><br><span class="hljs-string">&quot;os/exec&quot;</span><br><span class="hljs-string">&quot;strings&quot;</span><br><span class="hljs-string">&quot;sync&quot;</span><br><span class="hljs-string">&quot;time&quot;</span><br>)<br><br><span class="hljs-keyword">var</span> (<br><span class="hljs-comment">// Execute binary file</span><br>binaryPath  = <span class="hljs-string">&quot;/home/wang/code/pressure-me/me-chaind&quot;</span><br>userChan    = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">chan</span> User, <span class="hljs-number">100000</span>)<br>outputMutex sync.Mutex<br>dirPath     = <span class="hljs-string">&quot;--home=./me-chain&quot;</span><br>csvName     = <span class="hljs-string">&quot;users.csv&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> User <span class="hljs-keyword">struct</span> &#123;<br>Id         <span class="hljs-type">string</span><br>Address    <span class="hljs-type">string</span><br>PrivateKey <span class="hljs-type">string</span><br>Mnemonic   <span class="hljs-type">string</span><br>&#125;<br><br><span class="hljs-keyword">type</span> addResponse <span class="hljs-keyword">struct</span> &#123;<br>Name     <span class="hljs-type">string</span><br>Type     <span class="hljs-type">string</span><br>Address  <span class="hljs-type">string</span><br>Pubkey   <span class="hljs-type">string</span><br>Mnemonic <span class="hljs-type">string</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">NewUser</span><span class="hljs-params">(id <span class="hljs-type">uint64</span>)</span></span> (User, <span class="hljs-type">error</span>) &#123;<br>addRes, err := add(id)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> User&#123;&#125;, err<br>&#125;<br>pk, _, err := export(id)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> User&#123;&#125;, err<br>&#125;<br>userInfo := User&#123;Id: addRes.Name, Address: addRes.Address, PrivateKey: pk, Mnemonic: addRes.Mnemonic&#125;<br><span class="hljs-keyword">return</span> userInfo, <span class="hljs-literal">nil</span><br>&#125;<br><br><span class="hljs-comment">// æ·»åŠ ä¸€ä¸ªç”¨æˆ· ä¼ å…¥ç”¨æˆ·id</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">add</span><span class="hljs-params">(id <span class="hljs-type">uint64</span>)</span></span> (addResponse, <span class="hljs-type">error</span>) &#123;<br>formattedNumber := fmt.Sprintf(<span class="hljs-string">&quot;u-%06d&quot;</span>, id)<br><br>args := []<span class="hljs-type">string</span>&#123;<span class="hljs-string">&quot;keys&quot;</span>, <span class="hljs-string">&quot;add&quot;</span>, formattedNumber, <span class="hljs-string">&quot;--keyring-backend=test&quot;</span>, dirPath&#125;<br><br>cmd := exec.Command(binaryPath, args...) <span class="hljs-comment">// æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä¼ å…¥å‚æ•°</span><br>cmd.Stdin = strings.NewReader(<span class="hljs-string">&quot;y\n&quot;</span>)     <span class="hljs-comment">// yå›è½¦</span><br><br>stdout, stderr := &amp;strings.Builder&#123;&#125;, &amp;strings.Builder&#123;&#125;<br>cmd.Stdout, cmd.Stderr = stdout, stderr<br><br>err := cmd.Run()<br><br>outputMutex.Lock()<br><span class="hljs-keyword">defer</span> outputMutex.Unlock()<br><br><span class="hljs-keyword">var</span> data []addResponse<br><span class="hljs-keyword">if</span> err := yaml.Unmarshal([]<span class="hljs-type">byte</span>(stdout.String()), &amp;data); err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatalf(<span class="hljs-string">&quot;Error parsing YAML: %v&quot;</span>, err)<br>&#125;<br><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(data) &lt;= <span class="hljs-number">0</span> &#123;<br>log.Fatalf(<span class="hljs-string">&quot;Data is nil: %v&quot;</span>, err)<br><span class="hljs-keyword">return</span> addResponse&#123;&#125;, err<br>&#125;<br><br><span class="hljs-comment">// handle Mnemonic</span><br>text := strings.Join([]<span class="hljs-type">string</span>&#123;stderr.String()&#125;, <span class="hljs-string">&quot;\n&quot;</span>)<br>splitText := strings.SplitAfter(text, <span class="hljs-string">&quot;It is the only way to recover your account if you ever forget your password.&quot;</span>)<br><span class="hljs-keyword">if</span> <span class="hljs-built_in">len</span>(splitText) &lt; <span class="hljs-number">2</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;Could not find &#x27;It is the only way to recover your account if you ever forget your password.&#x27;&quot;</span>)<br><span class="hljs-keyword">return</span> addResponse&#123;&#125;, err<br>&#125;<br><span class="hljs-comment">// Extract the mnemonic phrase</span><br>mnemonic := strings.TrimSpace(splitText[<span class="hljs-number">1</span>])<br>data[<span class="hljs-number">0</span>].Mnemonic = mnemonic<br><span class="hljs-keyword">return</span> data[<span class="hljs-number">0</span>], <span class="hljs-literal">nil</span><br>&#125;<br><br><span class="hljs-comment">// Export private key</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">export</span><span class="hljs-params">(id <span class="hljs-type">uint64</span>)</span></span> (<span class="hljs-type">string</span>, <span class="hljs-type">string</span>, <span class="hljs-type">error</span>) &#123;<br>formattedNumber := fmt.Sprintf(<span class="hljs-string">&quot;u-%06d&quot;</span>, id)<br><br>args := []<span class="hljs-type">string</span>&#123;<span class="hljs-string">&quot;keys&quot;</span>, <span class="hljs-string">&quot;export&quot;</span>, formattedNumber, <span class="hljs-string">&quot;--unsafe&quot;</span>, <span class="hljs-string">&quot;--unarmored-hex&quot;</span>, <span class="hljs-string">&quot;--keyring-backend=test&quot;</span>, dirPath&#125;<br><br>cmd := exec.Command(binaryPath, args...)<br>cmd.Stdin = strings.NewReader(<span class="hljs-string">&quot;y\n&quot;</span>)<br><br>stdout, stderr := &amp;strings.Builder&#123;&#125;, &amp;strings.Builder&#123;&#125;<br>cmd.Stdout, cmd.Stderr = stdout, stderr<br><br>err := cmd.Run()<br><br><span class="hljs-keyword">return</span> strings.TrimRight(stdout.String(), <span class="hljs-string">&quot;\n&quot;</span>), stderr.String(), err<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">Batch</span><span class="hljs-params">()</span></span> &#123;<br>start := time.Now()<br>goroutineNum := <span class="hljs-number">30</span><br>totalUsers := <span class="hljs-number">50000</span><br><br>wg := sync.WaitGroup&#123;&#125;<br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; goroutineNum; i++ &#123;<br>wg.Add(<span class="hljs-number">1</span>)<br><span class="hljs-keyword">go</span> <span class="hljs-function"><span class="hljs-keyword">func</span><span class="hljs-params">(startID <span class="hljs-type">int</span>)</span></span> &#123;<br><span class="hljs-keyword">defer</span> wg.Done()<br><br><span class="hljs-keyword">for</span> j := startID; j &lt;= totalUsers; j += goroutineNum &#123;<br>user, err := NewUser(<span class="hljs-type">uint64</span>(j))<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span><br>&#125;<br>userChan &lt;- user<br>&#125;<br>&#125;(i + <span class="hljs-number">1</span>)<br>&#125;<br><span class="hljs-comment">// Close the channel after all goroutines finish</span><br>wg.Wait()<br>elapsed := time.Since(start)<br>fmt.Printf(<span class="hljs-string">&quot;åˆ›é€ æ•°æ®æ‰§è¡Œè€—æ—¶ï¼š%v \n&quot;</span>, elapsed.Seconds())<br><span class="hljs-built_in">close</span>(userChan)<br><br>start1 := time.Now()<br><span class="hljs-comment">// Collect the generated users</span><br><span class="hljs-keyword">var</span> users []User<br><span class="hljs-keyword">for</span> user := <span class="hljs-keyword">range</span> userChan &#123;<br>users = <span class="hljs-built_in">append</span>(users, user)<br>&#125;<br><br><span class="hljs-comment">// Write users to CSV file</span><br>err := writeUsersToCSV(users, csvName)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>fmt.Println(<span class="hljs-string">&quot;Error writing to CSV file:&quot;</span>, err)<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>fmt.Printf(<span class="hljs-string">&quot;Users written to [%s] file successfully. \n&quot;</span>, csvName)<br>&#125;<br>elapsed2 := time.Since(start1)<br>fmt.Printf(<span class="hljs-string">&quot;å†™å…¥æ•°æ®æ‰§è¡Œè€—æ—¶ï¼š%v \n&quot;</span>, elapsed2.Seconds())<br><br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">writeUsersToCSV</span><span class="hljs-params">(users []User, filename <span class="hljs-type">string</span>)</span></span> <span class="hljs-type">error</span> &#123;<br><span class="hljs-comment">// Create the CSV file</span><br>file, err := os.Create(filename)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> err<br>&#125;<br><span class="hljs-keyword">defer</span> file.Close()<br><br><span class="hljs-comment">// Create the CSV writer</span><br>writer := csv.NewWriter(file)<br><span class="hljs-keyword">defer</span> writer.Flush()<br><br><span class="hljs-comment">// Write the header row</span><br>header := []<span class="hljs-type">string</span>&#123;<span class="hljs-string">&quot;ID&quot;</span>, <span class="hljs-string">&quot;Address&quot;</span>, <span class="hljs-string">&quot;PrivateKey&quot;</span>, <span class="hljs-string">&quot;Mnemonic&quot;</span>&#125;<br>err = writer.Write(header)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> err<br>&#125;<br><br><span class="hljs-comment">// Write the user data rows</span><br><span class="hljs-keyword">for</span> _, user := <span class="hljs-keyword">range</span> users &#123;<br>row := []<span class="hljs-type">string</span>&#123;user.Id, user.Address, user.PrivateKey, user.Mnemonic&#125;<br>err := writer.Write(row)<br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br><span class="hljs-keyword">return</span> err<br>&#125;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span><br>&#125;<br><br><span class="hljs-comment">/*</span><br><span class="hljs-comment">PrivFromAddrString</span><br><span class="hljs-comment">@Description: ç§é’¥è½¬åœ°å€, gea/cosmos-sdk/types/address.go è¦æ›´æ”¹é»˜è®¤åœ°å€å‰ç¼€</span><br><span class="hljs-comment">@param privStr</span><br><span class="hljs-comment">@return string</span><br><span class="hljs-comment">@return error</span><br><span class="hljs-comment">*/</span><br><span class="hljs-comment">//func PrivFromAddrString(privStr string) (string, error) &#123;</span><br><span class="hljs-comment">//priBytes, err := hex.DecodeString(privStr)</span><br><span class="hljs-comment">//if err != nil &#123;</span><br><span class="hljs-comment">//return &quot;&quot;, err</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//priv := &amp;secp256k1.PrivKey&#123;Key: priBytes&#125;</span><br><span class="hljs-comment">//accAddr := sdk.AccAddress(priv.PubKey().Address().Bytes())</span><br><span class="hljs-comment">//return accAddr.String(), nil</span><br><span class="hljs-comment">//&#125;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-comment">//s, err := add(001)</span><br><span class="hljs-comment">//s, s2, err := export(001)</span><br><span class="hljs-comment">//if err != nil &#123;</span><br><span class="hljs-comment">//return</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//fmt.Println(s)</span><br><span class="hljs-comment">//fmt.Println(s2)</span><br><br><span class="hljs-comment">//addrString, err := PrivFromAddrString(&quot;108c7ca3d2bdf462c4af5504fcbda1c1ffec3213ef9b02f39edbafc20bc068a2&quot;)</span><br><span class="hljs-comment">//if err != nil &#123;</span><br><span class="hljs-comment">//return</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">////gea1adezarkjat6gz79sh2svr66k2ltf0ks052256v</span><br><span class="hljs-comment">//fmt.Println(addrString)</span><br><span class="hljs-comment">//if addrString != &quot;gea1adezarkjat6gz79sh2svr66k2ltf0ks052256v&quot; &#123;</span><br><span class="hljs-comment">//fmt.Println(&quot;Fail&quot;)</span><br><span class="hljs-comment">//&#125;</span><br><br><span class="hljs-comment">//user, err := NewUser(2)</span><br><span class="hljs-comment">//if err != nil &#123;</span><br><span class="hljs-comment">//return</span><br><span class="hljs-comment">//&#125;</span><br><span class="hljs-comment">//fmt.Println(user)</span><br><br>start := time.Now()<br><br>Batch()<br><br>elapsed := time.Since(start)<br>fmt.Printf(<span class="hljs-string">&quot;ç¨‹åºæ‰§è¡Œè€—æ—¶ï¼š%v \n&quot;</span>, elapsed.Seconds())<br>&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Golang</category>
      
    </categories>
    
    
    <tags>
      
      <tag>go</tag>
      
      <tag>ç¼–ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Golangã€‘goè¯­è¨€ä¹‹åŸºç¡€ä»‹ç»</title>
    <link href="/2023/12/06/801go%E8%AF%AD%E8%A8%80%E4%B9%8B%E5%9F%BA%E7%A1%80%E4%BB%8B%E7%BB%8D/"/>
    <url>/2023/12/06/801go%E8%AF%AD%E8%A8%80%E4%B9%8B%E5%9F%BA%E7%A1%80%E4%BB%8B%E7%BB%8D/</url>
    
    <content type="html"><![CDATA[<h1 id="å˜é‡çš„å®šä¹‰å’Œèµ‹å€¼"><a href="#å˜é‡çš„å®šä¹‰å’Œèµ‹å€¼" class="headerlink" title="å˜é‡çš„å®šä¹‰å’Œèµ‹å€¼"></a>å˜é‡çš„å®šä¹‰å’Œèµ‹å€¼</h1><h2 id="å®šä¹‰-å£°æ˜-ä¸€ä¸ªå˜é‡"><a href="#å®šä¹‰-å£°æ˜-ä¸€ä¸ªå˜é‡" class="headerlink" title="å®šä¹‰(å£°æ˜)ä¸€ä¸ªå˜é‡"></a>å®šä¹‰(å£°æ˜)ä¸€ä¸ªå˜é‡</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> a, b <span class="hljs-type">int</span><span class="hljs-comment">// å£°æ˜åŒç±»å‹</span><br><span class="hljs-keyword">var</span> a, b <span class="hljs-type">int</span> = <span class="hljs-number">10</span>, <span class="hljs-number">20</span><span class="hljs-comment">// ä»…åŒç±»å‹ blockchain making transactions safer and faster</span><br><br><span class="hljs-comment">// å£°æ˜ä¸åŒç±»å‹</span><br><span class="hljs-keyword">var</span> (<br>a    <span class="hljs-type">int</span><br>b    <span class="hljs-type">string</span><br>c, d <span class="hljs-type">int</span><br>)<br></code></pre></td></tr></table></figure><h2 id="å˜é‡åˆå§‹åŒ–"><a href="#å˜é‡åˆå§‹åŒ–" class="headerlink" title="å˜é‡åˆå§‹åŒ–"></a>å˜é‡åˆå§‹åŒ–</h2><p>ä¸‰ç§æ–¹å¼ï¼šå®Œæ•´å¼ã€ç±»å‹æ¨å¯¼ã€ç®€çŸ­å¼</p><h2 id="å¸¸é‡"><a href="#å¸¸é‡" class="headerlink" title="å¸¸é‡"></a>å¸¸é‡</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-comment">// const å¸¸é‡å ç±»å‹ = å€¼</span><br><span class="hljs-keyword">const</span> a <span class="hljs-type">int</span> = <span class="hljs-number">100</span><br><span class="hljs-keyword">const</span> b = <span class="hljs-number">200</span> <span class="hljs-comment">// ç±»å‹æ¨å¯¼</span><br>fmt.Println(b)<br>    <span class="hljs-comment">// æ–¹å¼2</span><br><span class="hljs-keyword">const</span> (<br>n1 = <span class="hljs-number">100</span><br>n2 = <span class="hljs-number">200</span><span class="hljs-comment">// n2</span><br>n3 = <span class="hljs-number">300</span><br>)<br><br>&#125;<br></code></pre></td></tr></table></figure><h1 id="å‘½åè§„èŒƒ"><a href="#å‘½åè§„èŒƒ" class="headerlink" title="å‘½åè§„èŒƒ"></a>å‘½åè§„èŒƒ</h1><h2 id="å®šä¹‰è§„èŒƒ"><a href="#å®šä¹‰è§„èŒƒ" class="headerlink" title="å®šä¹‰è§„èŒƒ"></a>å®šä¹‰è§„èŒƒ</h2><ul><li>Goè¯­è¨€ä¸­çš„å˜é‡åã€å¸¸é‡åã€å‡½æ•°åã€ç±»å‹åã€è¯­å¥æ ‡å·å’ŒåŒ…åç­‰æ‰€æœ‰çš„å‘½åï¼Œéƒ½éµå¾ªä¸€ä¸ªç®€å•çš„å‘½åè§„åˆ™ï¼š</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-number">1</span> ç”±å­—ç¬¦ï¼Œä¸‹åˆ’çº¿ï¼Œæ•°å­—ç»„æˆï¼Œä½†æ˜¯ä¸èƒ½ä»¥æ•°å­—å¼€å¤´<br><span class="hljs-number">2</span> å¤§å†™å­—æ¯å’Œå°å†™å­—æ¯æ˜¯ä¸åŒçš„ï¼šNameå’Œnameæ˜¯ä¸¤ä¸ªä¸åŒçš„å˜é‡<br><span class="hljs-number">3</span> å…³é”®å­—ä¸èƒ½ç”¨åšå‘½åï¼›ä¿ç•™å­—éƒ½ä¸å»ºè®®ç”¨ä½œå˜é‡å<br></code></pre></td></tr></table></figure><h2 id="å‘½åé£æ ¼"><a href="#å‘½åé£æ ¼" class="headerlink" title="å‘½åé£æ ¼"></a>å‘½åé£æ ¼</h2><ul><li>Goè¯­è¨€ç¨‹åºå‘˜æ¨èä½¿ç”¨ <strong>é©¼å³°å¼</strong> å‘½åï¼Œå½“åå­—ç”±å‡ ä¸ªå•è¯ç»„æˆæ—¶ä¼˜å…ˆä½¿ç”¨å¤§å°å†™åˆ†éš”ï¼Œè€Œä¸æ˜¯ä¼˜å…ˆç”¨ä¸‹åˆ’çº¿åˆ†éš”ã€‚</li><li>goæ–‡ä»¶çš„åå­—ï¼Œå»ºè®®ç”¨ä¸‹åˆ’çº¿çš„æ–¹å¼å‘½åã€‚</li><li>åå­—çš„é•¿åº¦æ²¡æœ‰é€»è¾‘é™åˆ¶ï¼Œä½†æ˜¯Goè¯­è¨€çš„é£æ ¼æ˜¯å°½é‡ä½¿ç”¨çŸ­å°æœ‰æ„ä¹‰çš„åå­—</li></ul><h2 id="å…³é”®å­—"><a href="#å…³é”®å­—" class="headerlink" title="å…³é”®å­—"></a>å…³é”®å­—</h2><ul><li>Goè¯­è¨€ä¸­å…³é”®å­—æœ‰25ä¸ªï¼›å…³é”®å­—ä¸èƒ½ç”¨äºè‡ªå®šä¹‰åå­—ï¼Œåªèƒ½åœ¨ç‰¹å®šè¯­æ³•ç»“æ„ä¸­ä½¿ç”¨ã€‚</li></ul><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">break</span>      <span class="hljs-keyword">default</span>       func     <span class="hljs-keyword">interface</span>   <span class="hljs-symbol">select</span><br><span class="hljs-symbol">case</span>       <span class="hljs-symbol">defer</span>         <span class="hljs-symbol">go</span>       <span class="hljs-symbol">map</span>         <span class="hljs-symbol">struct</span><br><span class="hljs-symbol">chan</span>       <span class="hljs-symbol">else</span>          <span class="hljs-symbol">goto</span>     <span class="hljs-symbol">package</span>     <span class="hljs-symbol">switch</span><br><span class="hljs-symbol">const</span>      <span class="hljs-symbol">fallthrough</span>   <span class="hljs-symbol">if</span>       <span class="hljs-symbol">range</span>       <span class="hljs-symbol">type</span><br><span class="hljs-symbol">continue</span>   <span class="hljs-symbol">for</span>           <span class="hljs-symbol">import</span>   <span class="hljs-symbol">return</span>      <span class="hljs-symbol">var</span><br></code></pre></td></tr></table></figure><h2 id="ä¿ç•™å­—"><a href="#ä¿ç•™å­—" class="headerlink" title="ä¿ç•™å­—"></a>ä¿ç•™å­—</h2><ul><li>goè¯­è¨€ä¸­æœ‰37ä¸ªä¿ç•™å­—ï¼Œä¸»è¦å¯¹åº”å†…å»ºçš„å¸¸é‡ã€ç±»å‹å’Œå‡½æ•°</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go">å†…å»ºå¸¸é‡: <span class="hljs-literal">true</span> <span class="hljs-literal">false</span> <span class="hljs-literal">iota</span> <span class="hljs-literal">nil</span><br><br>å†…å»ºç±»å‹:  <span class="hljs-type">int</span> <span class="hljs-type">int8</span> <span class="hljs-type">int16</span> <span class="hljs-type">int32</span> <span class="hljs-type">int64</span><br>          <span class="hljs-type">uint</span> <span class="hljs-type">uint8</span> <span class="hljs-type">uint16</span> <span class="hljs-type">uint32</span> <span class="hljs-type">uint64</span> <span class="hljs-type">uintptr</span><br>          <span class="hljs-type">float32</span> <span class="hljs-type">float64</span> <span class="hljs-type">complex128</span> <span class="hljs-type">complex64</span><br>          <span class="hljs-type">bool</span> <span class="hljs-type">byte</span> <span class="hljs-type">rune</span> <span class="hljs-type">string</span> <span class="hljs-type">error</span><br><br>å†…å»ºå‡½æ•°: <span class="hljs-built_in">make</span> <span class="hljs-built_in">len</span> <span class="hljs-built_in">cap</span> <span class="hljs-built_in">new</span> <span class="hljs-built_in">append</span> <span class="hljs-built_in">copy</span> <span class="hljs-built_in">close</span> <span class="hljs-built_in">delete</span><br>          <span class="hljs-built_in">complex</span> <span class="hljs-built_in">real</span> <span class="hljs-built_in">imag</span><br>          <span class="hljs-built_in">panic</span> <span class="hljs-built_in">recover</span><br></code></pre></td></tr></table></figure><h1 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h1><h2 id="åŸºç¡€æ•°æ®ç±»å‹"><a href="#åŸºç¡€æ•°æ®ç±»å‹" class="headerlink" title="åŸºç¡€æ•°æ®ç±»å‹"></a>åŸºç¡€æ•°æ®ç±»å‹</h2><p>åŸºæœ¬æ•°æ®ç±»å‹æœ‰ä¸‰ç±»ï¼šæ•°å­—ã€å­—ç¬¦ä¸²ã€å¸ƒå°”</p><ul><li><strong>æ•°å­—ç±»å‹</strong><ul><li>æ•´å‹ã€æµ®ç‚¹æ•°ã€å¤æ•°</li><li><strong>ä¸åŒç±»å‹çš„æ•°å­—ä¸èƒ½åšè¿ç®—</strong></li></ul></li><li><strong>æ•´å‹</strong>åˆ†ä¸ºä¸¤ä¸ªå¤§ç±»ï¼š <ul><li>æŒ‰é•¿åº¦åˆ†ä¸ºï¼š<code>int int8ã€int16ã€int32ã€int64</code> </li><li>æ— ç¬¦å·æ•´å‹ï¼š<code>uint uint8ã€uint16ã€uint32ã€uint64</code></li><li>æ“ä½œç³»ç»Ÿä¸ä¸€æ ·ï¼Œintå’Œuintè¡¨ç¤ºçš„èŒƒå›´ä¸ä¸€æ ·</li></ul></li></ul><table><thead><tr><th align="center">ç±»å‹</th><th align="center">æè¿°</th></tr></thead><tbody><tr><td align="center">uint8</td><td align="center">æ— ç¬¦å· 8ä½æ•´å‹ (0 åˆ° 255)</td></tr><tr><td align="center">uint16</td><td align="center">æ— ç¬¦å· 16ä½æ•´å‹ (0 åˆ° 65535)</td></tr><tr><td align="center">uint32</td><td align="center">æ— ç¬¦å· 32ä½æ•´å‹ (0 åˆ° 4294967295)</td></tr><tr><td align="center">uint64</td><td align="center">æ— ç¬¦å· 64ä½æ•´å‹ (0 åˆ° 18446744073709551615)</td></tr><tr><td align="center">int8</td><td align="center">æœ‰ç¬¦å· 8ä½æ•´å‹ (-128 åˆ° 127)</td></tr><tr><td align="center">int16</td><td align="center">æœ‰ç¬¦å· 16ä½æ•´å‹ (-32768 åˆ° 32767)</td></tr><tr><td align="center">int32</td><td align="center">æœ‰ç¬¦å· 32ä½æ•´å‹ (-2147483648 åˆ° 2147483647)</td></tr><tr><td align="center">int64</td><td align="center">æœ‰ç¬¦å· 64ä½æ•´å‹ (-9223372036854775808 åˆ° 9223372036854775807)</td></tr></tbody></table><p><strong>æµ®ç‚¹æ•°</strong>åˆ†ä¸ºä¸¤ä¸ªå¤§ç±»ï¼š </p><ul><li>float32ï¼š <code>float32</code> çš„æµ®ç‚¹æ•°çš„æœ€å¤§èŒƒå›´çº¦ä¸º <code>3.4e38</code>ï¼Œå¯ä»¥ä½¿ç”¨å¸¸é‡å®šä¹‰ï¼š<code>math.MaxFloat32</code>ã€‚</li><li>float64ï¼š <code>float64</code> çš„æµ®ç‚¹æ•°çš„æœ€å¤§èŒƒå›´çº¦ä¸º <code>1.8e308</code>ï¼Œå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå¸¸é‡å®šä¹‰ï¼š<code>math.MaxFloat64</code></li><li>é»˜è®¤å®šä¹‰çš„æµ®ç‚¹æ•°æ˜¯<code>float64</code></li><li>æ‰“å°æµ®ç‚¹æ•°æ—¶ï¼Œå¯ä»¥ä½¿ç”¨<code>fmt</code>åŒ…é…åˆåŠ¨è¯<code>%f</code>ï¼Œ</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> (<br>   <span class="hljs-string">&quot;fmt&quot;</span><br>   <span class="hljs-string">&quot;math&quot;</span><br>)<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>   s1 := <span class="hljs-number">1.34</span><br>   fmt.Printf(<span class="hljs-string">&quot;%T\n&quot;</span>, s1) <span class="hljs-comment">// float64</span><br>   fmt.Println(math.MaxFloat32)<br>   fmt.Printf(<span class="hljs-string">&quot;%.2f\n&quot;</span>, math.Pi)<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><strong>å¤æ•°</strong>åˆ†ä¸ºä¸¤ä¸ªå¤§ç±»ï¼š <ul><li>complex64å’Œcomplex128</li><li>å¤æ•°æœ‰å®éƒ¨å’Œè™šéƒ¨</li></ul></li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> c1 <span class="hljs-type">complex64</span><br><span class="hljs-keyword">var</span> c2 <span class="hljs-type">complex128</span><br>c1 = <span class="hljs-number">3</span> + <span class="hljs-number">5i</span><br>c2 = <span class="hljs-number">4</span> + <span class="hljs-number">8i</span><br>fmt.Printf(<span class="hljs-string">&quot;c1:%v, type: %T\n&quot;</span>, c1, c1)<span class="hljs-comment">// c1:(3+5i), type: complex64</span><br>fmt.Printf(<span class="hljs-string">&quot;c2:%v, type: %T\n&quot;</span>, c2, c2)<span class="hljs-comment">// c2:(4+8i), type: complex128</span><br></code></pre></td></tr></table></figure><ul><li><p><strong>å¸ƒå°”å€¼</strong></p><ul><li>å¸ƒå°”å‹çš„å€¼åªå¯ä»¥æ˜¯å¸¸é‡ <code>true</code> æˆ–è€… <code>false</code></li><li>å¸ƒå°”ç±»å‹å˜é‡çš„é›¶å€¼ä¸º<code>false</code></li><li>å¸ƒå°”å‹ä¸èƒ½å‚ä¸æ•°å­—è¿ç®—ï¼Œä¹Ÿä¸èƒ½ä¸å…¶ä»–ç±»å‹ç›¸äº’è½¬æ¢</li></ul></li><li><p><strong>å­—ç¬¦ä¸²</strong></p><ul><li>å­—ç¬¦ä¸²å°±æ˜¯ä¸€ä¸²å›ºå®šé•¿åº¦çš„å­—ç¬¦è¿æ¥èµ·æ¥çš„å­—ç¬¦åºåˆ—ï¼Œç”±åŒå¼•å·åŒ…è£¹</li><li>å­—ç¬¦ä¸²ä¸å¯ä¿®æ”¹</li><li>å­—ç¬¦ä¸²çš„é›¶å€¼æ˜¯ç©ºå­—ç¬¦ä¸²â€â€</li><li>Go è¯­è¨€çš„å­—ç¬¦ä¸²çš„å­—èŠ‚ä½¿ç”¨ UTF-8 ç¼–ç æ ‡è¯† Unicode æ–‡æœ¬</li><li>å¤šè¡Œå­—ç¬¦ä¸²çš„å®ç°æœ‰ä¸¤ç§æ–¹å¼ï¼šè½¬è¯‘ç¬¦å·<code>\n</code>ã€åå¼•å·ï¼ˆé”®ç›˜ä¸ŠTabé”®ä¸Šé¢é‚£ä¸ªé”®ï¼‰</li><li>åå¼•å·é—´æ¢è¡Œå°†è¢«ä½œä¸ºå­—ç¬¦ä¸²ä¸­çš„æ¢è¡Œï¼Œä½†æ˜¯æ‰€æœ‰çš„è½¬ä¹‰å­—ç¬¦å‡æ— æ•ˆï¼Œæ–‡æœ¬å°†ä¼šåŸæ ·è¾“å‡ºã€‚</li></ul></li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go">s1 := <span class="hljs-string">&quot;hello world&quot;</span><br>s2 := <span class="hljs-string">&quot;ä½ å¥½ ä¸–ç•Œ&quot;</span><br><br>s3 := <span class="hljs-string">`ç¬¬ä¸€è¡Œ</span><br><span class="hljs-string">ç¬¬äºŒè¡Œ</span><br><span class="hljs-string">ç¬¬ä¸‰è¡Œ</span><br><span class="hljs-string">`</span><br></code></pre></td></tr></table></figure><ul><li><p>å­—ç¬¦ä¸²æœ¬è´¨æ˜¯ç”±å­—ç¬¦ç»„æˆï¼Œ</p><ul><li><p>å­—ç¬¦ç”±å•å¼•å·åŒ…è£¹</p></li><li><p>å­—ç¬¦æœ‰ä¸¤ç§ç±»å‹ï¼š<code>byte</code>å’Œ<code>rune</code></p></li><li><p>å­—èŠ‚<code>byte</code>ç”¨æ¥å¤„ç†asciiç è¡¨ä¸­çš„å­—ç¬¦</p></li><li><p>ç¬¦æ–‡<code>rune</code>æ¥å¤„ç†å…¶ä»–å­—ç¬¦ï¼Œå¦‚æ±‰å­ã€‚æ—¥æ–‡ç­‰</p></li><li><p>å­—ç¬¦å­˜å‚¨çš„æœ¬è´¨æ‰€ä»¥æ•°å­—ï¼š<code>byte</code>ç­‰äº<code>int8</code>ï¼Œ<code>rune</code>ç­‰äº<code>int32</code></p></li></ul></li></ul><h2 id="ç±»å‹è½¬æ¢"><a href="#ç±»å‹è½¬æ¢" class="headerlink" title="ç±»å‹è½¬æ¢"></a>ç±»å‹è½¬æ¢</h2><ul><li>Goè¯­è¨€ä¸­æ²¡æœ‰éšå¼ç±»å‹è½¬æ¢ï¼Œç±»å‹è½¬æ¢éƒ½æ˜¯æ˜¾å¼çš„å¼ºåˆ¶è½¬æ¢ã€‚</li><li>å¼ºåˆ¶ç±»å‹è½¬æ¢åªèƒ½åœ¨ä¸¤ä¸ªç±»å‹ä¹‹é—´æ”¯æŒç›¸äº’è½¬æ¢çš„æ—¶å€™ä½¿ç”¨ã€‚</li><li>æ³¨æ„ï¼šæµ®ç‚¹æ•°è½¬æ•´å‹æ—¶ï¼Œå°æ•°ç‚¹åçš„æ•°æ®ä¼šä¸¢å¤±</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>n1 := <span class="hljs-number">10</span><br>n2 := <span class="hljs-number">1.2</span><br>    n3 := <span class="hljs-type">float64</span>(n1) + n2<span class="hljs-comment">// å¼ºåˆ¶å°†int -&gt; float64,å¼ºåˆ¶è½¬æ¢çš„æ–¹å¼ T(è¡¨è¾¾å¼)</span><br>fmt.Println(n3)<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="å®¹å™¨å‹æ•°æ®ç»“æ„"><a href="#å®¹å™¨å‹æ•°æ®ç»“æ„" class="headerlink" title="å®¹å™¨å‹æ•°æ®ç»“æ„"></a>å®¹å™¨å‹æ•°æ®ç»“æ„</h2><p>ä»£è¡¨ï¼šæ•°ç»„(Array)ã€åˆ‡ç‰‡(Slice)ã€æ˜ å°„(Map)</p><h3 id="æ•°ç»„Array"><a href="#æ•°ç»„Array" class="headerlink" title="æ•°ç»„Array"></a>æ•°ç»„Array</h3><ul><li>æ•°ç»„æ˜¯ä¸€ä¸ªç”±<strong>å›ºå®šé•¿åº¦</strong>çš„<strong>ç›¸åŒç±»å‹</strong>å…ƒç´ ç»„æˆçš„åºåˆ—ã€‚</li><li>æ•°ç»„ä¸€æ—¦ç¡®å®šï¼Œæ•°ç»„çš„é•¿åº¦å°±ä¸èƒ½å†æ”¹å˜ã€‚</li><li>ç±»ä¼¼pythonçš„å…ƒç»„</li></ul><p>å£°æ˜æ•°ç»„</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> æ•°ç»„å [é•¿åº¦]å…ƒç´ ç±»å‹<br><span class="hljs-comment">// varæ˜¯å…³é”®å­—</span><br><span class="hljs-comment">// æ•°ç»„åå’Œæ™®é€šçš„å˜é‡åéµå¾ªç›¸åŒçš„ååˆ†è§„èŒƒå’Œé£æ ¼</span><br><span class="hljs-comment">// []ï¼Œå†…çš„æ•°å­—è¡¨ç¤ºè¯¥æ•°ç»„å¯ä»¥å­˜æ”¾å…ƒç´ çš„ä¸ªæ•°ï¼ŒåŠæ•°ç»„çš„é•¿åº¦</span><br><span class="hljs-comment">// å…ƒç´ ç±»å‹ï¼Œæ•°ç»„å†…å­˜æ”¾å…ƒç´ çš„ç±»å‹ï¼Œä¸€ä¸ªæ•°ç»„å†…å…ƒç´ çš„ç±»å‹å¿…é¡»ä¸€è‡´</span><br></code></pre></td></tr></table></figure><p>æ•°ç»„çš„é›¶å€¼</p><ul><li>æ•°ç»„æ˜¯å€¼ç±»å‹ï¼Œæ‰€ä»¥æ•°ç»„çš„é›¶å€¼æ˜¯å¯¹åº”å…ƒç´ é›¶å€¼çš„é›†åˆ</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> nums [<span class="hljs-number">3</span>]<span class="hljs-type">int</span><br><br>fmt.Println(nums)<span class="hljs-comment">// è¾“å‡ºï¼š [0 0 0]</span><br></code></pre></td></tr></table></figure><p>æ•°ç»„çš„ç±»å‹</p><ul><li>æ•°ç»„çš„ç±»å‹ï¼š<code>[æ•°ç»„é•¿åº¦å…ƒç´ ç±»å‹</code></li><li>æ•°ç»„çš„é•¿åº¦æ˜¯ç±»å‹çš„ä¸€éƒ¨åˆ†ï¼Œé•¿åº¦ä¸åŒçš„ä¸¤ä¸ªæ•°ç»„ï¼Œç±»å‹ä¸ä¸€æ ·</li><li>æ‰“å°æ•°ç»„ç±»å‹ï¼š<code>fmt.Printf(&quot;%T&quot;, nums)</code></li></ul><p>æ•°ç»„çš„é•¿åº¦</p><ul><li>æ•°ç»„é•¿åº¦ï¼šå°±æ˜¯æ•°ç»„å†…å…ƒç´ çš„ä¸ªæ•°</li><li>æŸ¥çœ‹æ•°ç»„é•¿åº¦ï¼šå†…ç½®å‡½æ•°<code>len</code></li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> nums = [<span class="hljs-number">3</span>]<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;<span class="hljs-comment">// é•¿åº¦ä¸º3çš„æ•°ç»„</span><br>fmt.Println(<span class="hljs-built_in">len</span>(nums))<span class="hljs-comment">// è¾“å‡º3</span><br></code></pre></td></tr></table></figure><p>æ•°ç»„çš„å–å€¼æ–¹å¼</p><ul><li>é€šè¿‡ç´¢å¼•è®¿é—®æ•°ç»„ä¸­çš„æ¯ä¸ªå…ƒç´ </li><li>ç´¢å¼•ä»æ•°ç»„0å¼€å§‹ï¼Œåˆ°æ•°ç»„é•¿åº¦å‡1ä½ç½®</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> nums [<span class="hljs-number">5</span>]<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>&#125;<br>nums[<span class="hljs-number">0</span>]<span class="hljs-comment">// æ•°ç»„ç¬¬ä¸€ä¸ªå…ƒç´ </span><br>nums[<span class="hljs-number">1</span>]<span class="hljs-comment">// æ•°ç»„ç¬¬äºŒä¸ªå…ƒç´ </span><br>nums[<span class="hljs-number">4</span>]<span class="hljs-comment">// æ•°ç»„æœ€åä¸€ä¸ªå…ƒç´ </span><br>nums[<span class="hljs-number">5</span>]<span class="hljs-comment">// æŠ¥é”™ï¼šç´¢å¼•å€¼è¶Šç•Œ</span><br></code></pre></td></tr></table></figure><p>æ•°ç»„èµ‹å€¼åˆå§‹åŒ–</p><ul><li>ç±»æ¯”å˜é‡çš„èµ‹å€¼å’Œåˆå§‹åŒ–</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> nums = [<span class="hljs-number">3</span>]<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;<span class="hljs-comment">// ç±»å‹æ¨å¯¼</span><br>nums := [<span class="hljs-number">3</span>]<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;<span class="hljs-comment">// ç®€çŸ­å¼</span><br></code></pre></td></tr></table></figure><ul><li>æŒ‡å®šä½ç½®èµ‹å€¼</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">nums := [<span class="hljs-number">5</span>]<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>:<span class="hljs-number">10</span>, <span class="hljs-number">3</span>: <span class="hljs-number">30</span>&#125;<br></code></pre></td></tr></table></figure><ul><li>è‡ªåŠ¨èµ‹å€¼</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">nums := [...]<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>&#125;<br></code></pre></td></tr></table></figure><p>æ•°ç»„é•¿åº¦</p><ul><li>é€šè¿‡å†…ç½®å‡½æ•°ï¼š<code>len</code></li></ul><p>éå†æ•°ç»„</p><ul><li>ä½¿ç”¨forå¾ªç¯</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">for</span> i:=<span class="hljs-number">0</span>; i&lt;<span class="hljs-built_in">len</span>(nums); i++&#123;<br>    fmt.Println(nums[i])<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>ä½¿ç”¨rangeè¯­å¥</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">for</span> index, value := <span class="hljs-keyword">range</span> nums&#123;<br>    fmt.Print(index, value)<br>&#125;<br><span class="hljs-comment">// indexæ˜¯ç´¢å¼•ï¼Œvalueæ˜¯å…ƒç´ å€¼; ä¸æƒ³è¦çš„å¯ä»¥é€šè¿‡ _ æ¥æ”¶</span><br></code></pre></td></tr></table></figure><h3 id="åˆ‡ç‰‡Slice"><a href="#åˆ‡ç‰‡Slice" class="headerlink" title="åˆ‡ç‰‡Slice"></a>åˆ‡ç‰‡Slice</h3><ul><li>æ•°ç»„çš„é•¿åº¦æ˜¯å›ºå®šçš„ï¼Œä¸æ”¯æŒæ‰©å®¹ï¼Œä½¿ç”¨èµ·æ¥ä¸æ–¹ä¾¿</li><li>æ•°ç»„æ˜¯å€¼ç±»å‹ï¼Œå½“å‚æ•°ä¼ ç»™å‡½æ•°æ—¶å€¼æ‹·è´ï¼Œæ— æ³•é€šè¿‡å‡½æ•°ä¿®æ”¹æ•°ç»„å…ƒç´ </li></ul><p>åˆ‡ç‰‡æ¦‚å¿µ:</p><ul><li>åˆ‡ç‰‡æ˜¯ä¸€ç»„ç›¸åŒç±»å‹å…ƒç´ çš„çš„åºåˆ—ï¼Œå¯ä»¥ä¿®æ”¹é•¿åº¦ï¼Œä½¿ç”¨çµæ´»ï¼Œè‡ªåŠ¨æ‰©å®¹ã€‚</li><li>åˆ‡ç‰‡æ˜¯å¯¹æ•°ç»„çš„ä¸€ä¸ªè¿ç»­ç‰‡æ®µçš„å¼•ç”¨ï¼Œæ‰€ä»¥åˆ‡ç‰‡æ˜¯ä¸€ä¸ªå¼•ç”¨ç±»å‹ã€‚</li></ul><p>å£°æ˜åˆ‡ç‰‡</p><ul><li>åŸºäºæ•°ç»„å£°æ˜ä¸€ä¸ªåˆ‡ç‰‡</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go">nums := [<span class="hljs-number">5</span>]<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>&#125;<br><br>nums_slice := nums[<span class="hljs-number">1</span>:<span class="hljs-number">3</span>]<span class="hljs-comment">// å·¦é—­å³å¼€åŒºé—´,</span><br>fmt.Println(nums_slice)<span class="hljs-comment">// [2,3]</span><br></code></pre></td></tr></table></figure><ul><li>å…¶å®ä½ç½®å’Œç»“æŸä½ç½®éƒ½ä¸èƒ½ä¸ºè´Ÿæ•°ï¼Œéƒ½å¯ä»¥çœç•¥</li></ul><p>åˆ‡ç‰‡çš„ç±»å‹<code>[]å…ƒç´ ç±»å‹</code></p><p><strong>ä¸‰å¤§ç‰¹å¾</strong></p><ul><li>åˆ‡ç‰‡å†…éƒ¨ç»“æ„åŒ…å«ï¼š<strong>åœ°å€</strong>ã€<strong>å¤§å°</strong>ã€<strong>å®¹é‡</strong></li><li>åœ°å€ï¼šåˆ‡ç‰‡åº•å±‚æ˜¯å¯¹æ•°ç»„çš„å°è£…ï¼Œåœ°å€å°±æ˜¯åº•å±‚æ•°ç»„çš„æŒ‡é’ˆ</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go">nums := [...]<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>&#125;<br>numsSlice := nums[:]<br><br>fmt.Printf(<span class="hljs-string">&quot;%p\n&quot;</span>, &amp;nums)<span class="hljs-comment">// 0xc00000c2d0</span><br>fmt.Printf(<span class="hljs-string">&quot;%p\n&quot;</span>, numsSlice)<span class="hljs-comment">// 0xc00000c2d0</span><br></code></pre></td></tr></table></figure><ul><li>å¤§å°ï¼šåˆ‡ç‰‡å†…å…ƒç´ çš„æ•°é‡ï¼Œå†…ç½®æ–¹æ³•<code>len</code></li><li>å®¹é‡ï¼šåˆ‡ç‰‡æœ€å¤šå¯ä»¥æ”¾å¤šå°‘ä¸ªå…ƒç´ ï¼Œå†…ç½®æ–¹æ³•<code>cap</code></li></ul><p>åˆ‡ç‰‡çš„é›¶å€¼ nil</p><p>åˆ‡ç‰‡æ‰©å®¹</p><ul><li>ä½¿ç”¨å†…ç½®å‡½æ•°ç»™åˆ‡ç‰‡æ·»åŠ å…ƒç´ ï¼š<code>append</code></li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs go">b := [<span class="hljs-number">10</span>]&#123;&#125;[:]<br>a = <span class="hljs-built_in">append</span>(a, <span class="hljs-number">1</span>)<br>a = <span class="hljs-built_in">append</span>(a, <span class="hljs-number">2</span>)<br>a = <span class="hljs-built_in">append</span>(a, b...)<span class="hljs-comment">// å°†åˆ‡ç‰‡bå†…æ‰€æœ‰å…ƒç´ è¿½åŠ ç»™a</span><br></code></pre></td></tr></table></figure><ul><li>å½“å…ƒç´ ä¸ªæ•°è¾¾åˆ°åˆ‡ç‰‡å®¹é‡æ—¶ï¼Œåˆ‡ç‰‡å°†è‡ªåŠ¨æ‰©å®¹</li><li>æ‰©å®¹çš„è§„å¾‹ï¼šæŒ‰å®¹é‡çš„2å€è¿›è¡Œæ‰©å±•</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> numbers []<span class="hljs-type">int</span><br><span class="hljs-keyword">for</span> i := <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++ &#123;<br>    nums = <span class="hljs-built_in">append</span>(nums, i)<br>    fmt.Printf(<span class="hljs-string">&quot;len: %d  cap: %d pointer: %p\n&quot;</span>, <span class="hljs-built_in">len</span>(nums), <span class="hljs-built_in">cap</span>(nums), nums)<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>åˆ‡ç‰‡æ¯ä¸€æ¬¡æ‰©å®¹ï¼Œåº•å±‚å…³è”çš„æ•°ç»„éƒ½ä¼šéšä¹‹åˆ‡æ¢ã€‚</li><li>åˆ‡ç‰‡æ‰©å®¹çš„æœ¬è´¨ï¼Œæ˜¯å…³è”åº•å±‚æ•°ç»„çš„åˆ‡æ¢ã€‚</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>a := [<span class="hljs-number">2</span>]<span class="hljs-type">int</span>&#123;&#125;<br>b := a[:]<br>fmt.Printf(<span class="hljs-string">&quot;%p, %p\n&quot;</span>, &amp;a, b)<span class="hljs-comment">// 0xc00000a0c0, 0xc00000a0c0</span><br>b = <span class="hljs-built_in">append</span>(b, <span class="hljs-number">1</span>)<span class="hljs-comment">// è¾¾åˆ°bçš„å®¹é‡ï¼Œå‘ç”Ÿæ‰©å®¹</span><br>fmt.Printf(<span class="hljs-string">&quot;%p, %p\n&quot;</span>, &amp;a, b)<span class="hljs-comment">// 0xc00000a0c0, 0xc0000101e0</span><br>&#125;<br></code></pre></td></tr></table></figure><p><code>åˆ›å»ºåˆ‡ç‰‡çš„å››ç§æ–¹å¼</code></p><p>åŸºäºæ•°ç»„</p><ul><li>åŸºäºæ•°ç»„åˆ‡ç‰‡ä¸€ä¸ªåˆ‡ç‰‡</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go">nums := [<span class="hljs-number">3</span>]<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>&#125;<br>numSlice := nums[<span class="hljs-number">1</span>:<span class="hljs-number">3</span>]<br></code></pre></td></tr></table></figure><p>åŸºäºåˆ‡ç‰‡</p><ul><li>ä¸åŸºäºæ•°ç»„åˆ›å»ºç±»ä¼¼ï¼Œåœ¨åˆ‡ç‰‡ä¸Šå†åˆ‡å‡ºä¸€ä¸ªåˆ‡ç‰‡</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go">nums := [<span class="hljs-number">3</span>]<span class="hljs-type">int</span>&#123;<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>&#125;<br>numSlice := nums[:]<br>numSlice2 := numSlice[<span class="hljs-number">1</span>:]<br></code></pre></td></tr></table></figure><p>ç›´æ¥å£°æ˜åˆ‡ç‰‡</p><ul><li>ç›´æ¥ä½¿ç”¨åˆ‡ç‰‡çš„ç±»å‹å£°æ˜åˆ‡ç‰‡ï¼š<code>var sliceName []å…ƒç´ ç±»å‹</code></li><li>å¦‚æœä»…å£°æ˜ä¸€ä¸ªåˆ‡ç‰‡ï¼Œå®ƒæ˜¯æ²¡æœ‰åˆ†é…å†…å­˜çš„ã€‚</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> strSlice []<span class="hljs-type">string</span><span class="hljs-comment">// å£°æ˜å­—ç¬¦ä¸²åˆ‡ç‰‡</span><br><span class="hljs-keyword">var</span> numSlice []<span class="hljs-type">int</span><span class="hljs-comment">// å£°æ˜æ•´å‹åˆ‡ç‰‡</span><br><span class="hljs-keyword">var</span> numSlice2 = []<span class="hljs-type">int</span>&#123;&#125;<span class="hljs-comment">// å£°æ˜å¹¶åˆå§‹åŒ–</span><br><br>fmt.Println(strSlice, numSlice, numSlice2)<span class="hljs-comment">// [] [] []</span><br>fmt.Println(<span class="hljs-built_in">len</span>(strSlice), <span class="hljs-built_in">len</span>(numSlice), <span class="hljs-built_in">len</span>(numSlice2))<span class="hljs-comment">// 0,0,0</span><br>fmt.Println(strSlice == <span class="hljs-literal">nil</span>)<span class="hljs-comment">// true</span><br>fmt.Println(numSlice == <span class="hljs-literal">nil</span>)<span class="hljs-comment">// true</span><br>fmt.Println(numSlice2 == <span class="hljs-literal">nil</span>)<span class="hljs-comment">// false</span><br></code></pre></td></tr></table></figure><p>makeå‡½æ•°æ„é€ åˆ‡ç‰‡</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs go">sliceName := <span class="hljs-built_in">make</span>([]T, size, <span class="hljs-built_in">cap</span>)<span class="hljs-comment">// æ ¼å¼</span><br>sliceTest := <span class="hljs-built_in">make</span>([]<span class="hljs-type">string</span>,<span class="hljs-number">10</span>)<br></code></pre></td></tr></table></figure><ul><li>ä½¿ç”¨å†…ç½®å‡½æ•°makeæ„é€ åˆ‡ç‰‡</li><li>åˆ›å»ºçš„åˆ‡ç‰‡å·²ç»åˆ†é…äº†å†…å­˜ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨</li><li><code>T</code>æ˜¯åˆ‡ç‰‡å…ƒç´ ç±»å‹</li><li><code>size</code>æ˜¯åˆ‡ç‰‡çš„é•¿åº¦</li><li><code>cap</code>æ˜¯æå‰åˆ†é…çš„å…ƒç´ æ•°é‡ï¼Œè¿™ä¸ªå€¼è®¾å®šåä¸å½±å“ sizeï¼Œåªæ˜¯èƒ½æå‰åˆ†é…ç©ºé—´ï¼Œé™ä½å¤šæ¬¡åˆ†é…ç©ºé—´é€ æˆçš„æ€§èƒ½é—®é¢˜ã€‚å¦‚æœä¸æŒ‡å®šåˆ™ä½¿ç”¨é»˜è®¤å€¼ã€‚</li></ul><p>å¤åˆ¶åˆ‡ç‰‡</p><ul><li>å¤åˆ¶åˆ‡ç‰‡ï¼Œä¹Ÿå°±æ‹·è´åˆ‡ç‰‡ï¼Œä½¿ç”¨å†…ç½®å‡½æ•°ï¼š<code>copy</code></li><li>å°†ä¸€ä¸ªåˆ‡ç‰‡çš„å…ƒç´ å¯¹åº”ä½ç½®æ‹·è´ç»™å¦ä¸€ä¸ªåˆ‡ç‰‡ï¼Œå¤åˆ¶çš„å…ƒç´ ä¸ªæ•°ä»¥é•¿åº¦è¾ƒå°çš„åˆ‡ç‰‡ä¸ºå‡†ã€‚</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-built_in">copy</span>(a, b)<span class="hljs-comment">// å°†åˆ‡ç‰‡bçš„å…ƒç´ æ‹·è´ç»™åˆ‡ç‰‡a</span><br></code></pre></td></tr></table></figure><p>åˆ é™¤åˆ‡ç‰‡</p><ul><li>goæ²¡æœ‰æä¾›ä¸“é—¨åˆ é™¤åˆ‡ç‰‡å†…å…ƒç´ çš„æ–¹æ³•ï¼Œä½†å¯ä»¥åˆ©ç”¨åˆ‡ç‰‡çš„ç‰¹æ€§åˆ é™¤å…ƒç´ ã€‚</li><li>æ–¹å¼ï¼šç§»åŠ¨åˆ‡ç‰‡çš„ä½ç½®ï¼Œappendï¼Œcopyç­‰</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// æ–¹å¼1:</span><br>a = a[<span class="hljs-number">1</span>:]<span class="hljs-comment">// åˆ é™¤åˆ‡ç‰‡aä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ </span><br>a = a[<span class="hljs-number">5</span>:]<span class="hljs-comment">// åˆ é™¤åˆ‡ç‰‡aä¸­å‰ä¸ªå…ƒç´ </span><br><br><span class="hljs-comment">// append</span><br>a = <span class="hljs-built_in">append</span>(a[:<span class="hljs-number">0</span>], a[<span class="hljs-number">1</span>:])<span class="hljs-comment">// åˆ é™¤åˆ‡ç‰‡aä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ </span><br>a = <span class="hljs-built_in">append</span>(a[:<span class="hljs-number">0</span>], a[<span class="hljs-number">5</span>:])<span class="hljs-comment">// åˆ é™¤åˆ‡ç‰‡aä¸­å‰ä¸ªå…ƒç´ </span><br><br><span class="hljs-comment">// copy</span><br>a = a[:<span class="hljs-built_in">copy</span>(a, a[<span class="hljs-number">1</span>:])]<span class="hljs-comment">// åˆ é™¤åˆ‡ç‰‡aä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ </span><br>a = a[:<span class="hljs-built_in">copy</span>(a, a[<span class="hljs-number">5</span>:])] <span class="hljs-comment">// åˆ é™¤åˆ‡ç‰‡aä¸­å‰ä¸ªå…ƒç´ </span><br></code></pre></td></tr></table></figure><p>åˆ‡ç‰‡åšå‡½æ•°çš„å‚æ•°</p><p>åˆ‡ç‰‡æ˜¯å¼•ç”¨ç±»å‹</p><ul><li><p>åˆ‡ç‰‡å› ä¸ºæ²¡æœ‰é•¿åº¦é™åˆ¶ï¼Œæ‰€ä»¥æ–¹ä¾¿åšå‡½æ•°å‚æ•°ã€‚</p></li><li><p>åˆ‡ç‰‡åšå‡½æ•°å‚æ•°æ˜¯å¼•ç”¨ä¼ é€’ï¼Œä¿®æ”¹å½¢å‚å°†å½±å“å®å‚ã€‚</p></li><li><p>æ³¨æ„ï¼šå½“åˆ‡ç‰‡å‘ç”Ÿæ‰©å®¹æ—¶ï¼Œåˆ™å¯¹åˆ‡ç‰‡åšçš„ä¿®æ”¹å°±ä¸å†å½±å“åŸåº•å±‚æ•°ç»„ã€‚</p></li></ul><h3 id="æ˜ å°„map"><a href="#æ˜ å°„map" class="headerlink" title="æ˜ å°„map"></a>æ˜ å°„map</h3><ul><li>Goè¯­è¨€ä¸­ mapï¼ˆåˆå«æ˜ å°„ï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ•°æ®ç±»å‹ï¼šä¸€ç§é”®(key)å€¼(value)å¯¹ç»„æˆçš„æ— åºé›†åˆ.</li><li>mapæŒ‰ç…§keyå¯ä»¥å¿«é€ŸæŸ¥æ‰¾åˆ°value</li><li>keyæ˜¯å­—ç¬¦ä¸²æˆ–è€…æ•°å­—ï¼Œvalueå¯ä»¥æ˜¯ä»»æ„æ•°æ®ç±»å‹ï¼Œåœ¨ä¸€ä¸ªmapä¸­é€šå¸¸keyå’Œvalueçš„ç±»å‹å›ºå®š</li><li>mapæ”¯æŒæ‰©å®¹</li><li>mapæ˜¯å¼•ç”¨ç±»å‹</li></ul><p>å£°æ˜mapï¼š</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">var</span> mapName <span class="hljs-keyword">map</span>[keyType]valueType<br></code></pre></td></tr></table></figure><ul><li>è¿™ç§æ–¹å¼å£°æ˜çš„mapæ˜¯æ²¡æœ‰é•¿åº¦ï¼Œæœªåˆå§‹åŒ–çš„mapé›¶å€¼æ˜¯<code>nil</code></li></ul><p>èµ‹å€¼map</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go">map1 = <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span>&#123;<span class="hljs-string">&quot;class1&quot;</span>:<span class="hljs-number">10</span>, <span class="hljs-string">&quot;class2&quot;</span>:<span class="hljs-number">50</span>&#125;<br><br>map1[<span class="hljs-string">&quot;class3&quot;</span>] = <span class="hljs-number">80</span><br></code></pre></td></tr></table></figure><p>é•¿åº¦å’Œå®¹é‡</p><ul><li><p>è·å–é•¿åº¦ï¼š<code>len</code></p></li><li><p>è·å–å®¹é‡ï¼š<code>cap</code></p></li><li><p>è¾¾åˆ°æœ€å¤§å®¹é‡æ—¶å°†è‡ªåŠ¨æ‰©å®¹ï¼Œä¸€èˆ¬ä¼šé¢„æ‰©å®¹ï¼Œé¿å…åŠ¨æ€æ‰©å®¹æ—¶çš„æ€§èƒ½æŸè€—ã€‚</p></li></ul><p>makeåˆ›å»ºmap</p><ul><li>ä½¿ç”¨makeåˆ›å»ºmapï¼Œè·å–ä¸€ä¸ªmapå¯¹è±¡</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">map1 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span>, <span class="hljs-number">10</span>)<span class="hljs-comment">// é¢„æ‰©å®¹ä¸º10</span><br></code></pre></td></tr></table></figure><p>mapçš„é•¿åº¦å’Œå®¹é‡</p><p>å†…ç½®å‡½æ•°ï¼š<code>len</code>å’Œ<code>cap</code></p><p>æ‹¿é”®å–å€¼</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">fmt.Println(map1[<span class="hljs-string">&quot;cleas&quot;</span>])<br></code></pre></td></tr></table></figure><p>å¢åŠ é”®å€¼å¯¹</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs go">map1 := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span>, <span class="hljs-number">10</span>)<br><br>map1[<span class="hljs-string">&quot;class1&quot;</span>] = <span class="hljs-number">50</span><span class="hljs-comment">// å¢åŠ é”®å€¼å¯¹</span><br></code></pre></td></tr></table></figure><p>ä¿®æ”¹é”®å€¼å¯¹</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go">map1[<span class="hljs-string">&quot;class1&quot;</span>] = <span class="hljs-number">59</span><span class="hljs-comment">// ä¿®æ”¹é”®å€¼å¯¹</span><br></code></pre></td></tr></table></figure><p>åˆ é™¤é”®å€¼å¯¹</p><ul><li>ä½¿ç”¨å†…ç½®æ–¹æ³•ï¼š<code>delete</code></li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-built_in">delete</span>(map1, <span class="hljs-string">&quot;class1&quot;</span>)<span class="hljs-comment">// é”®ä¸å­˜åœ¨æ—¶ï¼Œä¸æ“ä½œï¼Œä¸æŠ¥é”™</span><br></code></pre></td></tr></table></figure><p>æ¸…ç©ºmap</p><ul><li>æ²¡æœ‰ä¸“é—¨çš„æ¸…ç©ºmapçš„æ–¹æ³•ï¼šæ¸…ç©ºå°±æ˜¯é‡æ–°makeä¸€ä¸ª</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs go">a := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span>, <span class="hljs-number">10</span>)<br>a[<span class="hljs-string">&quot;class1&quot;</span>] = <span class="hljs-number">50</span><br>a[<span class="hljs-string">&quot;class2&quot;</span>] = <span class="hljs-number">60</span><br><br>a = <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span>, <span class="hljs-number">10</span><span class="hljs-comment">// æ¸…ç©ºmap</span><br></code></pre></td></tr></table></figure><p>mapæ˜¯å¼•ç”¨ç±»å‹ï¼Œåšå‡½æ•°å‚æ•°ä¿®æ”¹å½¢å‚å°†å½±å“å®å‚</p><h1 id="newå’Œmakeçš„åŒºåˆ«"><a href="#newå’Œmakeçš„åŒºåˆ«" class="headerlink" title="newå’Œmakeçš„åŒºåˆ«"></a>newå’Œmakeçš„åŒºåˆ«</h1><h3 id="ç›¸åŒç‚¹"><a href="#ç›¸åŒç‚¹" class="headerlink" title="ç›¸åŒç‚¹"></a>ç›¸åŒç‚¹</h3><ul><li>new å’Œ make æ˜¯ä¸¤ä¸ªå†…ç½®å‡½æ•°ï¼Œéƒ½æ˜¯ç”¨æ¥åˆ›å»ºå¹¶åˆ†é…ç±»å‹çš„å†…å­˜ã€‚</li></ul><h3 id="ä¸åŒç‚¹"><a href="#ä¸åŒç‚¹" class="headerlink" title="ä¸åŒç‚¹"></a>ä¸åŒç‚¹</h3><ul><li><strong>newä¸€èˆ¬ç”¨åœ¨å€¼ç±»å‹ï¼Œmakeç”¨åœ¨å¼•ç”¨ç±»å‹ã€‚</strong></li><li>newåªæ¥å—ä¸€ä¸ªå‚æ•°ï¼šç±»å‹ï¼Œè¿”å›è¯¥ç±»å‹çš„æŒ‡é’ˆï¼ŒåŒæ—¶åˆ†é…çš„å†…å­˜ä¼šç½®ä¸ºè¯¥ç±»å‹çš„é›¶å€¼ï¼›</li><li>makeåªç”¨äº chanã€map ä»¥åŠ slice çš„å†…å­˜åˆ›å»ºï¼Œè€Œä¸”å®ƒè¿”å›çš„ç±»å‹å°±æ˜¯è¿™ä¸‰ä¸ªç±»å‹æœ¬èº«ï¼Œè€Œä¸æ˜¯ä»–ä»¬çš„æŒ‡é’ˆç±»å‹ã€‚</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// new</span><br><span class="hljs-keyword">var</span> a []<span class="hljs-type">int</span><span class="hljs-comment">// a == nil</span><br>b := <span class="hljs-built_in">new</span>([]<span class="hljs-type">int</span>)<span class="hljs-comment">// b != nil</span><br><br><span class="hljs-comment">// make</span><br><span class="hljs-keyword">var</span> a <span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span><span class="hljs-comment">// a == nil</span><br>b := <span class="hljs-built_in">make</span>(<span class="hljs-keyword">map</span>[<span class="hljs-type">string</span>]<span class="hljs-type">int</span>)<span class="hljs-comment">// b != nil</span><br></code></pre></td></tr></table></figure><h3 id="é‡ç‚¹"><a href="#é‡ç‚¹" class="headerlink" title="é‡ç‚¹"></a>é‡ç‚¹</h3><ul><li>new åªåˆ†é…å†…å­˜ï¼Œè€Œ make åªèƒ½ç”¨äº sliceã€map å’Œ channel çš„åˆå§‹åŒ–ã€‚</li></ul>]]></content>
    
    
    <categories>
      
      <category>Golang</category>
      
    </categories>
    
    
    <tags>
      
      <tag>go</tag>
      
      <tag>ç¼–ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Golangã€‘goè¯­è¨€ä¹‹æ¥å£(interface)</title>
    <link href="/2023/12/06/804go%E8%AF%AD%E8%A8%80%E4%B9%8B%E6%8E%A5%E5%8F%A3(interface)/"/>
    <url>/2023/12/06/804go%E8%AF%AD%E8%A8%80%E4%B9%8B%E6%8E%A5%E5%8F%A3(interface)/</url>
    
    <content type="html"><![CDATA[<h1 id="æ¥å£interface"><a href="#æ¥å£interface" class="headerlink" title="æ¥å£interface"></a>æ¥å£interface</h1><h2 id="å…³äºæ¥å£çš„æ¦‚å¿µ"><a href="#å…³äºæ¥å£çš„æ¦‚å¿µ" class="headerlink" title="å…³äºæ¥å£çš„æ¦‚å¿µ"></a>å…³äºæ¥å£çš„æ¦‚å¿µ</h2><ul><li><p>æ¥å£interfaceæ˜¯å®šä¹‰äº†ä¸€ç»„æ–¹æ³•çš„é›†åˆï¼Œ</p></li><li><p>æ¥å£æä¾›äº†ä¸€ç§æ ‡å‡†åŒ–çš„æ–¹å¼ï¼Œç”¨æ¥è§„å®šå¯¹è±¡çš„è¡Œä¸ºï¼Œã€‚</p></li><li><p>é€šè¿‡æ¥å£ï¼Œä½ å®šä¹‰äº†å¯¹è±¡å¿…é¡»å…·å¤‡çš„æ–¹æ³•ã€‚è€Œä¸å¿…å…³å¿ƒå¯¹è±¡çš„å…·ä½“å®ç°ã€‚è¿™ç§æŠ½è±¡çš„æ–¹å¼ï¼Œå¯ä»¥æ›´åŠ çµæ´»å’Œå¤ç”¨</p></li><li><p>é€šè¿‡å®šä¹‰æ¥å£interfaceï¼Œç„¶åè®©å¯¹è±¡æ¥è°ƒç”¨æˆ–è€…å®ç°</p></li><li><p>æ¥å£interfaceå¯ä»¥ä½œä¸ºå‡½æ•°çš„å…¥å‚å‚æ•°ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºè¿”å›å€¼ å®ç°å¤šæ€</p></li><li><p>æ¥å£Interface æ˜¯ä¸€ç§è§„èŒƒï¼Œæ˜¯ä¸€ç§é™åˆ¶ï¼Œ</p></li></ul><p> <strong>å½“ä½ æŠŠæ¥å£interfaceå®šä¹‰å¥½åï¼Œä½œä¸ºå…¥å‚ï¼Œé‚£ä½ è¿™ä¸ªå‡½æ•°çš„å…¥å‚ï¼Œå°±å¿…é¡»æœ‰ä½ å®šä¹‰çš„æ¥å£interfaceæœ‰çš„æ–¹æ³•ï¼Œä¸ç„¶å°±ä¼šæŠ¥é”™ï¼Œ</strong></p><ul><li><p>åŒç†ä½ æŠŠinterfaceç±»å‹çš„ä¸œè¥¿ä½œä¸ºreturnå‡ºå»çš„ä¸œè¥¿ï¼Œé‚£ä½ å°±åœ¨å®šä¹‰returnçš„å¯¹è±¡æ—¶å°±å¿…é¡»å®šä¹‰ä»–æœ‰å“ªäº›æ–¹æ³•ï¼Œ</p></li><li><p>æ€»çš„è¯´ï¼Œæ¥å£ç­‰åŒäºpythonçš„åŸºç±»ï¼ŒåŸºç±»ç”¨äºå­ç±»å¿…é¡»å®ç°æ–¹æ³•ï¼Œæ¥å£ä¹Ÿæ˜¯å­ç±»å¿…é¡»å®ç°æ–¹æ³•ã€‚</p></li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-keyword">type</span> animal <span class="hljs-keyword">interface</span> &#123; <span class="hljs-comment">//åœ¨å®šä¹‰æ¥å£interfaceç±»å‹ï¼Œè¿™ä¸ªç±»å‹æœ‰ä¸€ä¸ªsayæ–¹æ³•</span><br>say()<br>&#125;<br><span class="hljs-keyword">type</span> cat <span class="hljs-keyword">struct</span> &#123; <span class="hljs-comment">// ç»“æ„ä½“</span><br>Name <span class="hljs-type">string</span><br>&#125;<br><span class="hljs-keyword">type</span> dog <span class="hljs-keyword">struct</span> &#123; <span class="hljs-comment">// ç»“æ„ä½“</span><br>Name <span class="hljs-type">string</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c cat)</span></span> say() &#123; <span class="hljs-comment">// è¿™ä¸ªæ˜¯æ–¹æ³•ï¼Œç»“æ„ä½“çš„æ–¹æ³•</span><br>fmt.Printf(<span class="hljs-string">&quot;%vå°èŠ±çŒ«ï¼Œå–µå–µå«\n&quot;</span>, c.Name)<br>&#125;<br><br><span class="hljs-comment">// è¿™ä¸¤ä¸ªç»“æ„ä½“éƒ½æœ‰sayæ–¹æ³•</span><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(d dog)</span></span> say() &#123; <span class="hljs-comment">// è¿™ä¸ªsayä¹Ÿæ˜¯æ–¹æ³•ï¼Œç»“æ„ä½“çš„æ–¹æ³•</span><br>fmt.Printf(<span class="hljs-string">&quot;%vå°åœŸç‹—ï¼Œæ±ªæ±ªå«\n&quot;</span>, d.Name)<br><br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">aaa</span><span class="hljs-params">(a animal)</span></span> <span class="hljs-type">string</span> &#123; <span class="hljs-comment">//è¿™ä¸ªæ–¹æ³•çš„å…¥å‚æ˜¯ä¸€ä¸ªanimalæ¥å£ç±»ï¼Œæ‰€ä»¥ä¼ è¿›æ¥çš„å‚æ•°å¿…é¡»è¦æ˜¯animalç±»å‹ï¼Œå¿…é¡»è¦æœ‰sayæ–¹æ³•</span><br>a.say()<br><span class="hljs-keyword">return</span> <span class="hljs-string">&quot;aaa&quot;</span><br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">bbb</span><span class="hljs-params">(s <span class="hljs-type">string</span>)</span></span> animal &#123; <span class="hljs-comment">// è¿™æ˜¯åœ¨å®šä¹‰ä¸€ä¸ªè¿”å›å€¼ä¸ºinterfaceæ¥å£ç±»å‹çš„å‡½æ•°</span><br><span class="hljs-comment">//a.say()</span><br><span class="hljs-comment">//a.say()</span><br>c := cat&#123;<span class="hljs-string">&quot;å°ç™½&quot;</span>&#125;<br><span class="hljs-keyword">return</span> c<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>c := cat&#123;<span class="hljs-string">&quot;å°ç™½&quot;</span>&#125;    <span class="hljs-comment">//è¿™ä¸ªCæ˜¯catç»“æ„ä½“çš„å®ä¾‹åŒ–å¯¹è±¡</span><br>d := aaa(c)       <span class="hljs-comment">//è¿™ä¸ªdæ˜¯å‡½æ•°aaaçš„å®ä¾‹åŒ–å¯¹è±¡ éœ€è¦ä¼ å…¥å‚ï¼Œå…¥å‚å°±æ˜¯C ä¸”è¿™ä¸ªå…¥å‚å¿…é¡»è¦æœ‰sayæ–¹æ³•ï¼Œä¸ç„¶å°±ä¼šæŠ¥é”™</span><br>fmt.Printf(d)     <span class="hljs-comment">//æ‰“å°è¿™ä¸ªdï¼Œæ­¤æ—¶dæ˜¯æœ‰è¿”å›å€¼stringçš„æ‰€ä»¥å¯ä»¥æ‰“å°å‡ºæ¥</span><br>e := bbb(<span class="hljs-string">&quot;hello&quot;</span>) <span class="hljs-comment">//è¿™æ˜¯åœ¨å®ä¾‹åŒ–bbbå‡½æ•°ï¼Œeå°±æ˜¯ä¸Šé¢çš„cï¼Œæ˜¯ä¸€ä¸ªinterfaceæ¥å£ç±»å‹çš„ã€‚</span><br>e.say()           <span class="hljs-comment">// eæ˜¯ä¸å¯ä»¥ç›´æ¥æ‰“å°çš„ï¼Œå› ä¸ºä½ æ— æ³•æ‰“å°æ¥å£ç±»å‹ã€‚ä½†æ˜¯ä½ å¯ä»¥è°ƒç”¨è¿™ä¸ªinterfaceæ¥å£çš„æ–¹æ³•</span><br><br>&#125;<br><br></code></pre></td></tr></table></figure><h1 id="æ¥å£ä¹Ÿæ˜¯ä¸€ç§ç±»å‹ï¼Œå¯ä»¥å®šä¹‰å˜é‡"><a href="#æ¥å£ä¹Ÿæ˜¯ä¸€ç§ç±»å‹ï¼Œå¯ä»¥å®šä¹‰å˜é‡" class="headerlink" title="æ¥å£ä¹Ÿæ˜¯ä¸€ç§ç±»å‹ï¼Œå¯ä»¥å®šä¹‰å˜é‡"></a>æ¥å£ä¹Ÿæ˜¯ä¸€ç§ç±»å‹ï¼Œå¯ä»¥å®šä¹‰å˜é‡</h1><ul><li>ç»“æ„ä½“â€”ç»“æ„ä½“æ–¹æ³•â€”æ¥å£</li><li>æ¥å£ç±»å‹çš„å˜é‡ï¼Œèƒ½å¤Ÿå‚¨å­˜æ‰€æœ‰å®ç°äº†è¯¥æ¥å£çš„ç»“æ„ä½“ã€‚</li><li>å®ä¾‹åŒ–ä¸€ä¸ªå˜é‡ï¼ˆå¯¹è±¡ï¼‰</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">package</span> main<br><br><span class="hljs-keyword">import</span> <span class="hljs-string">&quot;fmt&quot;</span><br><br><span class="hljs-keyword">type</span> animal <span class="hljs-keyword">interface</span> &#123;<br>say()<br>&#125;<br><br><span class="hljs-keyword">type</span> cat <span class="hljs-keyword">struct</span> &#123;<br>Name <span class="hljs-type">string</span><br>&#125;<br><span class="hljs-keyword">type</span> dog <span class="hljs-keyword">struct</span> &#123;<br>Name <span class="hljs-type">string</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(c cat)</span></span> say() &#123;<br>fmt.Printf(<span class="hljs-string">&quot;%vå°çŒ«å–µå–µå«\n&quot;</span>, c.Name)<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-params">(d dog)</span></span> say() &#123;<br>fmt.Printf(<span class="hljs-string">&quot;%vå°ç‹—æ±ªæ±ªå«\n&quot;</span>, d.Name)<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-keyword">var</span> a animal<br>fmt.Printf(<span class="hljs-string">&quot;ç±»å‹æ˜¯:%T\n&quot;</span>, a)    <span class="hljs-comment">//æ‰“å°çš„ç±»å‹æ˜¯nil ç±»å‹</span><br>fmt.Printf(<span class="hljs-string">&quot;æ‰“å°çš„å†…å®¹æ˜¯:%v\n&quot;</span>, a) <span class="hljs-comment">// è¿™ä¸ªa æ˜¯ä¸€ä¸ªæ¥å£ç±»å‹çš„å®ä¾‹åŒ–å¯¹è±¡ï¼Œæ‰€ä»¥æ‰“å°æ˜¯æ²¡æœ‰æ•°æ®çš„ æ‰“å°çš„æ˜¯nil</span><br>c := cat&#123;<span class="hljs-string">&quot;å°èŠ±&quot;</span>&#125;<br>a = c          <span class="hljs-comment">//è¿™ä¸ªæ—¶å€™æŠŠcèµ‹å€¼ç»™äº†aï¼Œæ‰€ä»¥aæœ‰cçš„å±æ€§</span><br>fmt.Println(a) <span class="hljs-comment">//æ‰€ä»¥æ‰“å°çš„æ—¶å€™ï¼Œå°±å¯ä»¥æ‰“å°aäº†ï¼Œ</span><br>a.say()<br><br>&#125;<br><br></code></pre></td></tr></table></figure><h1 id="å®šä¹‰æŒ‡é’ˆç±»å‹å’Œå€¼ç±»å‹æ¥æ”¶å™¨å®ç°æ¥å£"><a href="#å®šä¹‰æŒ‡é’ˆç±»å‹å’Œå€¼ç±»å‹æ¥æ”¶å™¨å®ç°æ¥å£" class="headerlink" title="å®šä¹‰æŒ‡é’ˆç±»å‹å’Œå€¼ç±»å‹æ¥æ”¶å™¨å®ç°æ¥å£"></a>å®šä¹‰æŒ‡é’ˆç±»å‹å’Œå€¼ç±»å‹æ¥æ”¶å™¨å®ç°æ¥å£</h1><ul><li>å€¼ç±»å‹æ¥å£å®ç°åï¼Œä¸ç®¡æ˜¯ç»“æ„ä½“è¿˜æ˜¯ç»“æ„ä½“æŒ‡é’ˆçš„å˜é‡ï¼Œéƒ½å¯ä»¥èµ‹å€¼ç»™æ¥å£å˜é‡</li><li>åªè¦æ˜¯å€¼æ¥æ”¶å™¨ï¼Œä¿®æ”¹çš„éƒ½æ˜¯æ–°çš„ã€‚</li><li>ä½¿ç”¨æŒ‡é’ˆæ¥æ”¶å™¨å®ç°æ¥å£ä¹‹åï¼Œåªèƒ½å°†ç»“æ„ä½“æŒ‡é’ˆå˜é‡èµ‹å€¼ç»™è¯¥æ¥å£å˜é‡</li><li>åªè¦æ˜¯æŒ‡é’ˆæ¥æ”¶å™¨ï¼Œä¿®æ”¹çš„éƒ½æ˜¯åŸæ¥çš„ã€‚ã€</li></ul><p><strong>ä½ åœ¨å®šä¹‰ç»“æ„ä½“æ–¹æ³•çš„æ—¶å€™ï¼Œå°†å…¥å‚å®šä¹‰ä¸ºæŒ‡é’ˆç±»å‹å…¥å‚å³å¯ï¼Œ</strong></p><p><strong>è¿™æ ·ä½ åœ¨å®ä¾‹åŒ–è¿™ä¸ªç»“æ„ä½“çš„æ—¶å€™ï¼Œä¼ å…¥æŒ‡é’ˆç±»å‹å³å¯</strong> </p>]]></content>
    
    
    <categories>
      
      <category>Golang</category>
      
    </categories>
    
    
    <tags>
      
      <tag>go</tag>
      
      <tag>ç¼–ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ã€Golangã€‘goè¯­è¨€ä¹‹jsonã€YAMLçš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–</title>
    <link href="/2023/12/06/803go%E8%AF%AD%E8%A8%80json%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/"/>
    <url>/2023/12/06/803go%E8%AF%AD%E8%A8%80json%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/</url>
    
    <content type="html"><![CDATA[<h1 id="11-1-jsonåºåˆ—åŒ–"><a href="#11-1-jsonåºåˆ—åŒ–" class="headerlink" title="11.1 jsonåºåˆ—åŒ–"></a>11.1 jsonåºåˆ—åŒ–</h1><p>Goè¯­è¨€ä¸­çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ˜¯ä¸€ç§è§£ç <strong>æ€è·¯</strong></p><p>å¯ä»¥å°†ç»“æ„ä½“è¿›è¡Œåºåˆ—åŒ–ä¸º<strong>JSONå­—ç¬¦ä¸²æ ¼å¼</strong>ï¼Œ</p><p><code>æ³¨æ„ï¼šä¸æ˜¯å°†ç±»å‹è½¬åŒ–ä¸ºJSONï¼Œgoè¯­è¨€æ²¡æœ‰JSONæ ¼å¼ç±»å‹ï¼Œ</code></p><p>æ˜¯å°†æ•°æ®ï¼Œè½¬åŒ–ä¸º JSONæ ¼å¼é£æ ¼çš„æ•°æ®ï¼Œä¾›å…¶ä»–è¯­è¨€ä½¿ç”¨ï¼Œ</p><p>æ¯”å¦‚è¯´ï¼Œpythonä¸­ï¼Œä¹Ÿæ²¡æœ‰jsonè¿™ç§æ•°æ®æ ¼å¼ï¼ŒæŠŠä¸€ä¸²jsonå¯¼å…¥åˆ°Pythonï¼Œæ‰“å°å®ƒçš„ç±»å‹ï¼Œæ‰“å°å‡ºæ¥å°±æ˜¯stringå­—ç¬¦ä¸²ç±»å‹ï¼Œå°†jsonè½¬åŒ–æˆå­—å…¸ï¼Œå°±æ˜¯å°†å­—ç¬¦ä¸²è½¬æˆå­—å…¸</p><p>å¸¦å…¥åˆ°goè¯­è¨€ä¸­ä¹Ÿæ˜¯ä¸€æ ·çš„æ¦‚å¿µï¼Œåªæ˜¯goè¯­è¨€å¯ä»¥é€šè¿‡ç»“æ„ä½“å»è½¬åŒ–æˆjson(åºåˆ—åŒ–)ï¼Œå˜æˆä¸€ç§é”®å€¼å¯¹çš„æ ¼å¼ï¼ˆä¹Ÿæœ‰ä¸æ˜¯é”®å€¼å¯¹æ ¼å¼çš„jsonï¼‰</p><p>goè¯­è¨€åºåˆ—åŒ–ï¼ˆç»“æ„ä½“è½¬jsonï¼‰å’Œååºåˆ—åŒ–çš„å®ç°æ–¹å¼ï¼šé€šè¿‡json.Marshal(person) personå°±æ˜¯ç»“æ„ä½“å®ä¾‹åŒ–çš„æ•°æ®ï¼Œjson.Unmarshal(jsondata)å°±æ˜¯ååºåˆ—åŒ–ï¼ˆç»“æ„ä½“è½¬jsonï¼‰</p><p>ç»“æ„ä½“è½¬JSON</p><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;encoding/json&quot;</span><br><span class="hljs-string">&quot;fmt&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> Myaccount <span class="hljs-keyword">struct</span> &#123;<br>Name   <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;name&quot;`</span><br>PWD    <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;pwd&quot;`</span><br>Amount <span class="hljs-type">int</span>    <span class="hljs-string">`json:&quot;amount&quot;`</span><br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>account := Myaccount&#123;<span class="hljs-string">&quot;and&quot;</span>, <span class="hljs-string">&quot;123&quot;</span>, <span class="hljs-number">18</span>&#125;<br>fmt.Println(<span class="hljs-string">&quot;æ‰“å°ä¸€ä¸‹ï¼š&quot;</span>, account) <span class="hljs-comment">// æ‰“å°ä¸€ä¸‹ï¼š &#123;and 123 18&#125;</span><br><span class="hljs-comment">// åºåˆ—åŒ–æ–¹æ³•</span><br>data1, _ := json.Marshal(account)<br>    fmt.Println(<span class="hljs-string">&quot;åºåˆ—åŒ–åçš„data1:&quot;</span>, <span class="hljs-type">string</span>(data1)) <span class="hljs-comment">// åºåˆ—åŒ–åçš„data1: &#123;&quot;name&quot;:&quot;and&quot;,&quot;pwd&quot;:&quot;123&quot;,&quot;amount&quot;:18&#125;</span><br>fmt.Printf(<span class="hljs-string">&quot;%T\n&quot;</span>, data1) <span class="hljs-comment">// æ‰“å°å‡ºæ¥çš„ç±»å‹æ˜¯æ— ç¬¦å·8ä½æ•´å½¢[]uint8ï¼Œæ— æ­£è´Ÿç¬¦å·8ä½æ•´å½¢</span><br>data2, _ := json.MarshalIndent(account, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot; &quot;</span>)<span class="hljs-comment">// MarshalIndentå¸¦ç¼©è¿›</span><br><br>fmt.Println(<span class="hljs-string">&quot;åºåˆ—åŒ–åçš„data2=&quot;</span>, <span class="hljs-type">string</span>(data2))    <span class="hljs-comment">// åºåˆ—åŒ–åçš„data2= &#123;</span><br> <span class="hljs-string">&quot;name&quot;</span>: <span class="hljs-string">&quot;and&quot;</span>,<br> <span class="hljs-string">&quot;pwd&quot;</span>: <span class="hljs-string">&quot;123&quot;</span>,<br> <span class="hljs-string">&quot;amount&quot;</span>: <span class="hljs-number">18</span><br>&#125;<br>fmt.Printf(<span class="hljs-string">&quot;data2çš„æ ¼å¼æ˜¯ï¼š%T\n&quot;</span>, data2) <span class="hljs-comment">// []uint8</span><br><span class="hljs-comment">// ååºåˆ—åŒ–æ–¹æ³•ï¼Œå°±ç”¨json.Unmarshal()æ–¹æ³•</span><br><span class="hljs-keyword">var</span> account2 Myaccount <span class="hljs-comment">// å®šä¹‰ä¸€ä¸ªå˜é‡account2ï¼Œç±»å‹æ˜¯Myaccountç»“æ„ä½“</span><br>json.Ummarshal(data1,&amp;account2)<br>fmt.Println(<span class="hljs-string">&quot;account2=&quot;</span>, account2)<span class="hljs-comment">// account2=&#123;and 123 18&#125; ,æ‰“å°å‡ºæ¥çš„å°±æ˜¯ç»“æ„ä½“äº†</span><br>fmt.Printf(<span class="hljs-string">&quot;%T\n&quot;</span>, account2) <span class="hljs-comment">// ç±»å‹å°±æ˜¯main.Myaccount</span><br><br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-comment">// å†å†™ä¸€ä¸ª</span><br><span class="hljs-keyword">type</span> MyScore <span class="hljs-keyword">struct</span> &#123;<br>Name  <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;name&quot;`</span><br>Class <span class="hljs-type">string</span> <span class="hljs-string">`json:&quot;class&quot;`</span><br>Score <span class="hljs-type">int</span>    <span class="hljs-string">`json:&quot;score&quot;`</span><br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br>    TomScore := MyScore&#123;<span class="hljs-string">&quot;Tom&quot;</span>, <span class="hljs-string">&quot;2ç­&quot;</span>, <span class="hljs-number">99</span>&#125;<br>fmt.Println(<span class="hljs-string">&quot;TomSocre=&quot;</span>, TomScore)<br><span class="hljs-comment">// å°†TomScoreè¿›è¡Œåºåˆ—åŒ–</span><br>JsonTomScore, _ := json.Marshal(TomScore)<br>fmt.Println(<span class="hljs-string">&quot;JsonTomScore=&quot;</span>, <span class="hljs-type">string</span>(JsonTomScore))<br><span class="hljs-comment">// ä¼˜åŒ–ç¼©è¿›åçš„</span><br>JsonTomScore2, _ := json.MarshalIndent(TomScore, <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot; &quot;</span>)<br>fmt.Println(<span class="hljs-string">&quot;JsonTomScore2=&quot;</span>, <span class="hljs-type">string</span>(JsonTomScore2))<br><span class="hljs-comment">// ååºåˆ—åŒ–</span><br><span class="hljs-keyword">var</span> tom MyScore<br>json.Unmarshal(JsonTomScore, &amp;tom)<br>fmt.Println(<span class="hljs-string">&quot;tom=&quot;</span>, tom)<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œç›®å‰ç”¨åˆ°çš„æ˜¯ç»“æ„ä½“ç±»å‹æ•°æ®è½¬æˆjsonæ ¼å¼ï¼Œå’Œjsonæ ¼å¼è½¬æˆç»“æ„ä½“ç±»å‹çš„æ•°æ®</p></blockquote><h1 id="Yaml-åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼ˆyamlä¸ç»“æ„ä½“äº’è½¬ï¼‰"><a href="#Yaml-åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼ˆyamlä¸ç»“æ„ä½“äº’è½¬ï¼‰" class="headerlink" title="Yaml åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼ˆyamlä¸ç»“æ„ä½“äº’è½¬ï¼‰"></a>Yaml åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼ˆyamlä¸ç»“æ„ä½“äº’è½¬ï¼‰</h1><ul><li>æ€è·¯å’Œæ–¹å¼è·Ÿjsonçš„æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯ç”¨äº†ä¸€ä¸ªåº“ï¼š**â€gopkg.in&#x2F;yaml.v3â€**</li></ul><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs go"><span class="hljs-keyword">import</span> (<br><span class="hljs-string">&quot;fmt&quot;</span><br><span class="hljs-string">&quot;gopkg.in/yaml.v3&quot;</span><br><span class="hljs-string">&quot;io/ioutil&quot;</span><br><span class="hljs-string">&quot;log&quot;</span><br>)<br><br><span class="hljs-keyword">type</span> MyYAML <span class="hljs-keyword">struct</span> &#123;<br>Name  <span class="hljs-type">string</span> <span class="hljs-string">`yaml:&quot;name&quot;`</span><br>Age   <span class="hljs-type">int</span>    <span class="hljs-string">`yaml:&quot;age&quot;`</span><br>Email <span class="hljs-type">string</span> <span class="hljs-string">`yaml:&quot;email,omitempty&quot;`</span><br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span> &#123;<br><span class="hljs-comment">// åºåˆ—åŒ–yaml å’Œåºåˆ—åŒ–jsonä¸€æ ·çš„  yaml.Marshal</span><br>YamlStruct := MyYAML&#123;<span class="hljs-string">&quot;andy&quot;</span>, <span class="hljs-number">11</span>, <span class="hljs-string">&quot;110@163.com&quot;</span>&#125;<br>fmt.Println(<span class="hljs-string">&quot;YamlStruct=&quot;</span>, YamlStruct)<br>YamlDate, _ := yaml.Marshal(YamlStruct)<br>fmt.Println(<span class="hljs-string">&quot;YamlDate=&quot;</span>, <span class="hljs-type">string</span>(YamlDate))<br><span class="hljs-comment">// ä¸‹é¢ååºåˆ—åŒ–yaml,ä¹Ÿæ˜¯å’Œjsonä¸€æ ·æ€è·¯ï¼Œyaml.UnMarshal</span><br><span class="hljs-comment">// ä¸è¿‡åœ¨è¿™ä¹‹å‰ä½ è¦æœ‰ä¸€ä¸ªyamlæ–‡ä»¶ï¼Œè¯»å–è¿™ä¸ªyamlæ–‡ä»¶åæ‰èƒ½å»æ‰“å°å‡ºæ¥</span><br>yamlDataFile, err := ioutil.ReadFile(<span class="hljs-string">&quot;data.yml&quot;</span>) <span class="hljs-comment">// è¯»å–ymlæ–‡ä»¶</span><br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatalf(<span class="hljs-string">&quot;Failed to read YAML file: %v&quot;</span>, err)<br>&#125;<br><span class="hljs-keyword">var</span> MyYamlStruct MyYAML<br>err = yaml.Unmarshal(yamlDataFile, &amp;MyYamlStruct) <span class="hljs-comment">// æŠŠæ•°æ®èµ‹å€¼åˆ°ç»“æ„ä½“é‡Œï¼Œç”¨æŒ‡é’ˆï¼Œæ”¹å˜ä»–çš„å€¼</span><br><span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> &#123;<br>log.Fatalf(<span class="hljs-string">&quot;Failed to unmarshal YAML: %v&quot;</span>, err)<br>&#125;<br><span class="hljs-comment">// æ‰“å°æ•°æ®å‡ºæ¥ï¼Œ</span><br>fmt.Printf(<span class="hljs-string">&quot;Name: %s, Age: %d, Email: %s\n&quot;</span>, MyYamlStruct.Name, MyYamlStruct.Age, MyYamlStruct.Email)<br>&#125;<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Golang</category>
      
    </categories>
    
    
    <tags>
      
      <tag>go</tag>
      
      <tag>ç¼–ç¨‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
